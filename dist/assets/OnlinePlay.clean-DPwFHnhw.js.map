{"version":3,"file":"OnlinePlay.clean-DPwFHnhw.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  allGames,\n  type GameKey,\n  getStartOptionsForGame,\n} from \"../../utils/games\";\nimport { useUserSettings } from \"../../store/userSettings\";\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (payload: any) => void;\n};\n\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\n  const [portalEl] = useState(() => document.createElement(\"div\"));\n  const [game, setGame] = useState<GameKey>(\"X01\");\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\n  const [legs, setLegs] = useState<number>(3);\n  const legsRef = useRef<HTMLInputElement | null>(null);\n  const [avgChoice, setAvgChoice] = useState<number>(0);\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\n    const opts = getStartOptionsForGame(game);\n    return opts?.[0];\n  });\n  const user = (useUserSettings() as any).username || \"Anonymous\";\n\n  useLayoutEffect(() => {\n    portalEl.className = \"ndn-create-match-portal\";\n    document.body.appendChild(portalEl);\n    return () => {\n      try {\n        portalEl && portalEl.remove();\n      } catch {}\n    };\n  }, [portalEl]);\n\n  // Close modal on Escape key\n  useLayoutEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      if (e.key === \"Escape\") onClose();\n    }\n    if (open) document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open, onClose]);\n\n  const handleCreate = () => {\n    const payload = {\n      createdBy: user,\n      game,\n      modeType,\n      legs,\n      avgChoice,\n      startingScore,\n    };\n    onCreate(payload);\n    onClose();\n  };\n\n  if (!open) return null;\n\n  if (!portalEl) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\">\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\n      <button\n        aria-label=\"Close dialog\"\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\n        onClick={onClose}\n      />\n      <div\n        className=\"card rounded-xl p-6 max-w-lg w-full relative text-white\"\n        role=\"dialog\"\n      >\n        <button\n          aria-label=\"Close\"\n          className=\"absolute top-3 right-3 text-rose-400 font-bold\"\n          onClick={onClose}\n        >\n          ‚úï\n        </button>\n        <h2 className=\"text-lg font-semibold mb-3\">Create Match üéØ</h2>\n        <div className=\"grid grid-cols-1 gap-3\">\n          <div>\n            <div className=\"text-sm opacity-80\">Created By üéØ</div>\n            <div className=\"mt-1 p-2 bg-white/5 rounded text-white\">\n              {user} üéØ\n            </div>\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-game\">\n              Match Name (Game) üéØ\n            </label>\n            <select\n              id=\"match-game\"\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n              value={game}\n              onChange={(e) => {\n                const v = e.target.value as GameKey;\n                setGame(v);\n                const opts = getStartOptionsForGame(v);\n                setStartingScore(opts?.[0]);\n              }}\n              onPointerDown={(e) => {\n                (e as any).stopPropagation();\n              }}\n              onMouseDown={(e) => {\n                e.stopPropagation();\n              }}\n              onTouchStart={(e) => {\n                (e as any).stopPropagation?.();\n              }}\n            >\n              {allGames.map((g) => (\n                <option key={g} value={g}>\n                  {g}\n                </option>\n              ))}\n            </select>\n          </div>\n          {getStartOptionsForGame(game).length > 0 ? (\n            <div>\n              <label className=\"text-sm opacity-80\" htmlFor=\"match-start\">\n                {`${game} Starting Score üéØ`}\n              </label>\n              <select\n                id=\"match-start\"\n                className=\"ml-2 p-2 border border-white/10 bg-white/5 rounded text-white w-full\"\n                value={startingScore}\n                onChange={(e) => setStartingScore(Number(e.target.value))}\n                onPointerDown={(e) => {\n                  (e as any).stopPropagation();\n                }}\n                onMouseDown={(e) => {\n                  e.stopPropagation();\n                }}\n                onTouchStart={(e) => {\n                  (e as any).stopPropagation?.();\n                }}\n              >\n                {getStartOptionsForGame(game).map((opt) => (\n                  <option key={opt} value={opt}>\n                    {opt}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : null}\n          <div>\n            <div className=\"text-sm opacity-80\">Mode üéØ</div>\n            <div className=\"flex gap-2 mt-1 justify-center\">\n              <label\n                className={`btn ${modeType === \"bestof\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"bestof\"\n                  checked={modeType === \"bestof\"}\n                  onChange={() => {\n                    setModeType(\"bestof\");\n                    setLegs((prev) => {\n                      const base = Math.max(1, prev || 3);\n                      // Ensure odd for Best Of\n                      return base % 2 === 1 ? base : base + 1;\n                    });\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                Best Of üéØ\n              </label>\n              <label\n                className={`btn ${modeType === \"firstto\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"firstto\"\n                  checked={modeType === \"firstto\"}\n                  onChange={() => {\n                    setModeType(\"firstto\");\n                    setLegs((prev) => Math.max(1, prev || 3));\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                First To üéØ\n              </label>\n            </div>\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-legs\">\n              {modeType === \"bestof\" ? \"Best Of üéØ\" : \"First To üéØ\"}\n            </label>\n            <input\n              id=\"match-legs\"\n              type=\"number\"\n              min={1}\n              value={legs}\n              onChange={(e) =>\n                setLegs(Math.max(1, Number(e.target.value || 1)))\n              }\n              ref={legsRef}\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n            />\n          </div>\n          <div>\n            <label className=\"text-sm opacity-80\" htmlFor=\"match-avg\">\n              Average Choice (¬±) üéØ\n            </label>\n            <input\n              id=\"match-avg\"\n              type=\"number\"\n              value={avgChoice}\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\n              className=\"w-full p-2 border border-white/10 bg-white/5 rounded text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex justify-end mt-4\">\n          <button className=\"btn btn-primary\" onClick={handleCreate}>\n            Create Match üéØ\n          </button>\n        </div>\n      </div>\n    </div>,\n    portalEl,\n  );\n}\n","import React, { useState, useMemo, useEffect, useRef } from \"react\";\nimport {\n  Search,\n  Zap,\n  Target,\n  Trophy,\n  Users,\n  Clock,\n  ChevronDown,\n} from \"lucide-react\";\nimport CreateMatchModal from \"./ui/CreateMatchModal\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase\";\nimport { useMatch } from \"../store/match\";\nimport { useWS } from \"./WSProvider\";\nimport { launchInPlayDemo } from \"../utils/inPlayDemo\";\nimport { openMatchWindow } from \"../utils/matchWindow\";\n\nexport default function OnlinePlayClean({ user }: { user?: any }) {\n  const username = user?.username || \"You\";\n  const [currentRoomIdx, setCurrentRoomIdx] = useState(0);\n  const [rooms, setRooms] = useState(() => [\n    { id: 1, name: \"room-1\", matches: [] as any[] },\n  ]);\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\n  const inProgress = useMatch((s) => s.inProgress);\n  const players = useMatch((s) => s.players);\n  const [focusMode, setFocusMode] = useState(false);\n  const matchesRef = useRef<HTMLDivElement | null>(null);\n  const showDemoControls =\n    (import.meta as any).env?.DEV ||\n    String(user?.email || \"\").toLowerCase() === \"daviesfamily108@gmail.com\";\n\n  useEffect(() => {\n    if (!focusMode) return;\n    function onDocClick(e: MouseEvent) {\n      try {\n        if (!matchesRef.current) return;\n        if (!matchesRef.current.contains(e.target as Node)) {\n          setFocusMode(false);\n        }\n      } catch {}\n    }\n    document.addEventListener(\"mousedown\", onDocClick);\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\n  }, [focusMode]);\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\n  const startedShowcasedRef = React.useRef(false);\n  useEffect(() => {\n    if (!inProgress) return;\n    if (startedShowcasedRef.current) return;\n    startedShowcasedRef.current = true;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  // Auto-open the dedicated match window for online X01 matches.\n  useEffect(() => {\n    if (!inProgress) return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress]);\n\n  // Allow the overlay to show again the next time a match starts.\n  useEffect(() => {\n    if (inProgress) return;\n    startedShowcasedRef.current = false;\n  }, [inProgress]);\n\n  // Announce presence to server so it knows our username\n  useEffect(() => {\n    if (wsGlobal?.connected && user?.username) {\n      try {\n        wsGlobal.send({\n          type: \"presence\",\n          username: user.username,\n          email: user.email || \"\",\n        });\n      } catch {}\n    }\n  }, [wsGlobal?.connected, user]);\n\n  // Global quit handler (from CameraView Quit / Pause modal)\n  useEffect(() => {\n    const onQuit = () => {\n      try {\n        useMatch.getState().endGame();\n      } catch (e) {}\n    };\n    try {\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\n    } catch {}\n    return () => {\n      try {\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\n      } catch {}\n    };\n  }, []);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\n  const [_selfId, setSelfId] = useState<string | null>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n  const [joinTimer, setJoinTimer] = useState(30);\n  // Keep latest matches in a ref so the WS listener can update synchronously\n  // for tests (avoids a stale closure / async state timing issue).\n  const serverMatchesRef = useRef<any[]>([]);\n  useEffect(() => {\n    serverMatchesRef.current = serverMatches || [];\n  }, [serverMatches]);\n  const serverPrestartRef = React.useRef(false);\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\n  const [remoteChoices, setRemoteChoices] = useState<\n    Record<string, \"bull\" | \"skip\">\n  >({});\n  const [bullActive, setBullActive] = useState(false);\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\n  const [bullThrown, setBullThrown] = useState(false);\n\n  // Filter & Sort State\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterGame, setFilterGame] = useState<\n    \"all\" | \"x01\" | \"cricket\" | \"bermuda\" | \"gotcha\"\n  >(\"all\");\n  const [filterMode, setFilterMode] = useState<\"all\" | \"first_to\" | \"best_of\">(\n    \"all\",\n  );\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\">(\"newest\");\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 16;\n\n  const currentRoom = rooms[currentRoomIdx];\n  // NOTE: This is a *UX* hint for when to show a \"room is full\" message.\n  // We do not hard-cap rendering at this number (tests and pagination rely on\n  // the full list being renderable).\n  const maxMatchesPerRoom = 999;\n\n  const normalizeMatch = React.useCallback((m: any) => {\n    if (!m) return m;\n    const modeType = m.modeType || m.mode || \"\";\n    const legs = m.legs ?? m.value ?? m.bestOf ?? m.sets ?? m.games ?? 1;\n    const createdBy = m.createdBy || m.creatorName || m.creator || m.host || \"\";\n    const createdAt = m.createdAt || m.ts || Date.now();\n\n    return {\n      ...m,\n      modeType,\n      mode: modeType || m.mode,\n      legs,\n      value: typeof m.value === \"number\" ? m.value : legs,\n      createdBy,\n      creatorName: m.creatorName || createdBy,\n      createdAt,\n    };\n  }, []);\n\n  const filterMatches = useMemo(() => {\n    return (list: any[] = []) =>\n      (list || [])\n        .map(normalizeMatch)\n        .filter(\n          (m: any) =>\n            !(\n              m?.isTest ||\n              m?.test ||\n              m?.migrated ||\n              m?.isMigration ||\n              m?.migration ||\n              m?.seeded ||\n              (typeof m?.createdBy === \"string\" &&\n                m.createdBy.toLowerCase().includes(\"test\")) ||\n              (typeof m?.creatorName === \"string\" &&\n                m.creatorName.toLowerCase().includes(\"test\")) ||\n              (typeof m?.createdBy === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.createdBy)) ||\n              (typeof m?.creatorName === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.creatorName)) ||\n              !(m?.game && m?.modeType && m?.legs)\n            ),\n        );\n    // NOTE: do NOT hard-cap here; tests and pagination expect the full\n    // list to render (page size controls how many are visible).\n  }, [normalizeMatch]);\n\n  // NOTE: worldLobby was previously used for an alternate lobby view; keep the\n  // computation removed to avoid unused-vars warnings.\n\n  // Combined matches: show only current room, filtered\n  const combinedMatches = useMemo(() => {\n    let all = filterMatches(currentRoom?.matches || []);\n\n    // In WS-driven mode, serverMatches is the canonical list. Fall back to it\n    // if the current room hasn't been hydrated yet.\n    if ((all?.length || 0) === 0 && (serverMatches?.length || 0) > 0) {\n      all = filterMatches(serverMatches);\n    }\n\n    // Last-resort fallback for test environments where state updates are\n    // async and the memo can run before serverMatches is visible.\n    if (\n      (all?.length || 0) === 0 &&\n      (serverMatchesRef.current?.length || 0) > 0\n    ) {\n      all = filterMatches(serverMatchesRef.current);\n    }\n\n    // 1. Search\n    if (searchQuery.trim()) {\n      const q = searchQuery.toLowerCase();\n      all = all.filter(\n        (m: any) =>\n          (m.game || \"\").toLowerCase().includes(q) ||\n          (m.createdBy || m.creatorName || \"\").toLowerCase().includes(q) ||\n          (m.id || \"\").toLowerCase().includes(q),\n      );\n    }\n\n    // 2. Filter Game\n    if (filterGame !== \"all\") {\n      all = all.filter((m: any) => (m.game || \"\").toLowerCase() === filterGame);\n    }\n\n    // 3. Filter Mode\n    if (filterMode !== \"all\") {\n      // normalize modeType. Some might be 'first_to' or 'bestof'\n      all = all.filter((m: any) => {\n        const mt = (m.modeType || \"\").replace(\"_\", \"\").toLowerCase(); // 'firstto', 'bestof'\n        const target = filterMode.replace(\"_\", \"\").toLowerCase();\n        return mt.includes(target);\n      });\n    }\n\n    // 4. Sort\n    all = (all || []).slice();\n    all.sort((a: any, b: any) => {\n      const tA = a.createdAt || 0;\n      const tB = b.createdAt || 0;\n      return sortBy === \"newest\" ? tB - tA : tA - tB;\n    });\n\n    return all.slice(0, maxMatchesPerRoom);\n  }, [\n    currentRoom,\n    serverMatches,\n    filterMatches,\n    searchQuery,\n    filterGame,\n    filterMode,\n    sortBy,\n    maxMatchesPerRoom,\n  ]);\n\n  // Reset page when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [searchQuery, filterGame, filterMode, sortBy, currentRoomIdx]);\n\n  const totalPages = Math.ceil(combinedMatches.length / itemsPerPage);\n  const paginatedMatches = combinedMatches.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage,\n  );\n\n  const handleQuickJoin = () => {\n    if (combinedMatches.length > 0) {\n      requestJoin(combinedMatches[0]);\n    }\n  };\n\n  const handleCreateMatch = (payload: any) => {\n    const newMatch = {\n      id: `m-${Date.now()}`,\n      createdBy: payload.createdBy || username,\n      game: payload.game,\n      modeType: payload.modeType,\n      legs: payload.legs,\n      startingScore: payload.startingScore,\n      createdAt: Date.now(),\n    };\n\n    // Only add optimistically if we are NOT connected to the server\n    // Otherwise, we wait for the server to broadcast the new match to avoid duplicates\n    if (!wsGlobal?.connected) {\n      setRooms((prev) =>\n        prev.map((r, idx) =>\n          idx === currentRoomIdx\n            ? { ...r, matches: [newMatch, ...r.matches] }\n            : r,\n        ),\n      );\n    }\n\n    // If we have a server WS connection, send a create-match message\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before creating match to guarantee correct attribution\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n\n        wsGlobal.send({\n          type: \"create-match\",\n          game: payload.game,\n          mode: payload.modeType,\n          value: payload.legs,\n          startingScore: payload.startingScore,\n          creatorAvg: payload.avgChoice || 0,\n        });\n      }\n    } catch {}\n  };\n\n  const newRoom = () => {\n    setServerMatches([]);\n    setRooms((prev) => {\n      const id = prev.length + 1;\n      const newRooms = [...prev, { id, name: `room-${id}`, matches: [] }];\n      setCurrentRoomIdx(newRooms.length - 1);\n      return newRooms;\n    });\n  };\n\n  // WS: subscribe to lobby and prestart events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"joined\") {\n          if (msg.id) setSelfId(msg.id);\n        }\n        if (msg?.type === \"presence\") {\n          // presence carries id and username\n          try {\n            if (msg.id)\n              setParticipants((prev) => ({\n                ...prev,\n                [msg.id]: msg.username || msg.name || msg.id,\n              }));\n          } catch {}\n        }\n        if (msg?.type === \"matches\") {\n          const filtered = filterMatches(msg.matches || []);\n          setServerMatches(filtered);\n          serverMatchesRef.current = filtered;\n          setRooms((prev) =>\n            prev.map((r, idx) =>\n              idx === currentRoomIdx ? { ...r, matches: filtered } : r,\n            ),\n          );\n        }\n        if (msg?.type === \"match-prestart\") {\n          // Someone accepted the invite; show prestart and update join match if it matches\n          const m = normalizeMatch(msg.match || null);\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Ensure we know the creator's username\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          // store on joinMatch as prestartEndsAt\n          // reset diffuse state\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrow(null);\n          setBullWinner(null);\n        }\n        if (msg?.type === \"match-start\") {\n          // If the started match matches our current join request, close the modal\n          if (joinMatch && msg.roomId === joinMatch.id) {\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setRemoteChoices({});\n            // (joinPrestart ends were attached to joinMatch; no-op)\n          }\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [wsGlobal, joinChoice, filterMatches, currentRoomIdx]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Focus the accept button when the join modal is shown\n  useEffect(() => {\n    if (!joinMatch) return;\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\n  }, [joinMatch]);\n\n  const handleJoinAccept = () => {\n    // Show the pre-game overlay immediately for snappy UX.\n    setShowStartShowcase(true);\n    // Send accept (invite-response) to server if we have a match prestart\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"invite-response\",\n          matchId: joinMatch.id,\n          accept: true,\n          toId: joinMatch.creatorId,\n        });\n      }\n    } catch {}\n    setJoinMatch(null);\n  };\n\n  const requestJoin = (m: any) => {\n    setJoinMatch(m);\n    // Show the pre-game overlay immediately while the server processes the join.\n    setShowStartShowcase(true);\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before joining\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\n      }\n    } catch {}\n  };\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\n\n  const runOnlineInPlayDemo = () => {\n    launchInPlayDemo({\n      players: [username, \"Opponent\"],\n      startingScore: 501,\n      roomId: \"online-demo\",\n      visits: [{ score: 60 }, { score: 85 }, { score: 100 }],\n    });\n  };\n\n  return (\n    <div\n      className=\"flex-1 min-h-0 ndn-page\"\n      style={{ position: \"relative\", marginTop: 0 }}\n    >\n      <div className=\"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col\">\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n            onRequestClose={() => setShowStartShowcase(false)}\n          />\n        )}\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title\">\n          Online Lobby üåê\n        </h2>\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\n          <div className=\"h-full flex flex-col gap-3\">\n            {/* Top row: Room, New Room, Create Match */}\n            <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap\">\n              <div className=\"flex items-center gap-3 flex-wrap\">\n                <div className=\"text-sm text-white/70\">Room</div>\n                <div className=\"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium\">\n                  Room ({currentRoom?.id})\n                </div>\n                <button\n                  className=\"btn btn-ghost btn-sm rounded-lg\"\n                  onClick={newRoom}\n                >\n                  New Room\n                </button>\n              </div>\n              <div className=\"shrink-0 flex items-center gap-2\">\n                <button\n                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg\"\n                  onClick={() => setShowCreateModal(true)}\n                  disabled={\n                    (currentRoom?.matches?.length || 0) >= maxMatchesPerRoom\n                  }\n                >\n                  <Trophy className=\"w-4 h-4\" />\n                  Create Match +\n                </button>\n                {showDemoControls && (\n                  <button\n                    className=\"btn btn-sm btn-ghost rounded-lg\"\n                    onClick={runOnlineInPlayDemo}\n                  >\n                    Demo In-Play\n                  </button>\n                )}\n                {(currentRoom?.matches?.length || 0) >= maxMatchesPerRoom && (\n                  <div className=\"text-xs text-rose-400\">\n                    Room full ‚Äî create a new room\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Filters & Controls */}\n            {!inProgress && (\n              <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3\">\n                <div className=\"ndn-filterbar\">\n                  <div className=\"flex-1 min-w-[240px] relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40\" />\n                    <input\n                      type=\"text\"\n                      placeholder=\"Search matches, players...\"\n                      className=\"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterGame}\n                      onChange={(e) => setFilterGame(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Games</option>\n                      <option value=\"x01\">X01</option>\n                      <option value=\"cricket\">Cricket</option>\n                      <option value=\"bermuda\">Bermuda</option>\n                      <option value=\"gotcha\">Gotcha</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterMode}\n                      onChange={(e) => setFilterMode(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Modes</option>\n                      <option value=\"first_to\">First To</option>\n                      <option value=\"best_of\">Best Of</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={sortBy}\n                      onChange={(e) => setSortBy(e.target.value as any)}\n                    >\n                      <option value=\"newest\">Newest First</option>\n                      <option value=\"oldest\">Oldest First</option>\n                    </select>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${focusMode ? \"bg-red-600 text-white border-red-500\" : \"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900\"}`}\n                      onClick={() => setFocusMode((s) => !s)}\n                      aria-pressed={focusMode}\n                      title=\"Toggle focus mode: hide small details and show focused view\"\n                    >\n                      {focusMode ? \"Exit Focus\" : \"Focus Mode\"}\n                    </button>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg\"\n                      onClick={handleQuickJoin}\n                      disabled={combinedMatches.length === 0}\n                    >\n                      <Zap className=\"w-4 h-4 fill-current\" />\n                      Quick Join\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-auto flex flex-col\">\n              <h3 className=\"font-semibold text-lg mb-3 flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-indigo-400\" />\n                Active Matches ÔøΩÔ∏è\n              </h3>\n              <div className=\"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col\">\n                <div className=\"flex-1 overflow-auto\">\n                  {(combinedMatches.length || 0) === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center opacity-60\">\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4\">\n                        <Target className=\"w-8 h-8 text-white/20\" />\n                      </div>\n                      <p className=\"text-lg font-medium mb-1\">\n                        No matches found\n                      </p>\n                      <p className=\"text-sm max-w-xs mx-auto\">\n                        Create a new match to get started or try adjusting your\n                        filters.\n                      </p>\n                    </div>\n                  ) : null}\n\n                  {(combinedMatches.length || 0) !== 0 && (\n                    <div className=\"relative\">\n                      {focusMode && (\n                        <div className=\"absolute inset-0 z-10 flex items-center justify-center pointer-events-none\">\n                          <div className=\"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out\">\n                            <button\n                              onClick={() => setFocusMode(false)}\n                              className=\"w-full text-center\"\n                            >\n                              FOCUS MODE ‚Äî Click to exit\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      <div\n                        ref={matchesRef}\n                        className={`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${focusMode ? \"opacity-90\" : \"\"}`}\n                        data-testid=\"matches-grid\"\n                      >\n                        {paginatedMatches.map((m: any) => (\n                          <div\n                            key={m.id}\n                            className=\"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]\"\n                            data-testid={`match-${m.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  {!focusMode && (\n                                    <div className=\"w-9 h-9 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 group-hover:border-indigo-500/40 transition-colors text-xs font-bold\">\n                                      {m.createdBy\n                                        ? (m.createdBy || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()\n                                        : (m.creatorName || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()}\n                                    </div>\n                                  )}\n                                  <div className=\"min-w-0\">\n                                    <div className=\"font-bold text-white group-hover:text-indigo-300 transition-colors truncate\">\n                                      {m.game}\n                                    </div>\n                                    <div className=\"text-xs text-white/50 flex items-center gap-1\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      {new Date(m.createdAt).toLocaleTimeString(\n                                        [],\n                                        { hour: \"2-digit\", minute: \"2-digit\" },\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                              {m.roomName && (\n                                <div className=\"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70\">\n                                  {m.roomName}\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850\">\n                                  {m.modeType === \"bestof\"\n                                    ? \"Best Of\"\n                                    : \"First To\"}\n                                </span>\n                                <span className=\"font-mono text-indigo-300\">\n                                  {m.legs}\n                                </span>\n                                <span>legs</span>\n                                {m.startingScore && (\n                                  <>\n                                    <span className=\"w-1 h-1 rounded-full bg-white/20\" />\n                                    <span className=\"font-mono text-amber-300\">\n                                      {m.startingScore}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                              {!focusMode && (\n                                <div className=\"text-xs text-white/40 flex items-center gap-1 mt-1\">\n                                  <Users className=\"w-3 h-3\" />\n                                  Created by:{\" \"}\n                                  <span className=\"text-white/60\">\n                                    {m.createdBy || m.creatorName || \"Unknown\"}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex items-center justify-between mt-auto pt-2 border-t border-white/5\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                {!focusMode && (\n                                  <div className=\"flex items-center gap-3 min-w-0\">\n                                    <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white\">\n                                      {(m.createdBy || m.creatorName || \"U\")\n                                        .substring(0, 2)\n                                        .toUpperCase()}\n                                    </div>\n                                    <span className=\"text-xs text-white/60 truncate max-w-[120px]\">\n                                      {m.createdBy || m.creatorName}\n                                    </span>\n                                  </div>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center justify-end\">\n                                <button\n                                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none\"\n                                  onClick={() => requestJoin(m)}\n                                >\n                                  Join\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Pagination Controls */}\n                  {totalPages > 1 && (\n                    <div className=\"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5\">\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === 1}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.max(1, p - 1))\n                        }\n                      >\n                        <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                        Previous\n                      </button>\n                      <div className=\"flex items-center gap-1\">\n                        {Array.from(\n                          { length: Math.min(5, totalPages) },\n                          (_, i) => {\n                            // Logic to show window of pages around current\n                            let p = i + 1;\n                            if (totalPages > 5) {\n                              if (currentPage > 3) p = currentPage - 2 + i;\n                              if (p > totalPages) p = totalPages - 4 + i;\n                            }\n                            return (\n                              <button\n                                key={p}\n                                className={`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${\n                                  currentPage === p\n                                    ? \"bg-indigo-600 text-white shadow-sm\"\n                                    : \"bg-slate-950 text-white/70 hover:bg-slate-900\"\n                                }`}\n                                onClick={() => setCurrentPage(p)}\n                              >\n                                {p}\n                              </button>\n                            );\n                          },\n                        )}\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === totalPages}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.min(totalPages, p + 1))\n                        }\n                      >\n                        Next\n                        <ChevronDown className=\"w-4 h-4 -rotate-90\" />\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n              {/* World Lobby removed: combined matches are displayed above */}\n            </div>\n          </div>\n        </div>\n\n        {/* Create Match modal */}\n        <CreateMatchModal\n          open={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onCreate={(p) => {\n            handleCreateMatch(p);\n            setShowCreateModal(false);\n          }}\n        />\n\n        {/* Join Modal (simplified) */}\n        {joinMatch && (\n          <div\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"join-heading\"\n            tabIndex={-1}\n            className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60 p-4\"\n          >\n            <div className=\"bg-slate-800 rounded-2xl p-6 max-w-md w-full\">\n              <div id=\"join-heading\" className=\"text-lg font-bold mb-2\">\n                Join Match ‚öîÔ∏è\n              </div>\n              <div className=\"mb-3\">\n                {joinMatch.game} - {joinMatch.modeType} ¬∑ {joinMatch.legs} legs\n              </div>\n              <div className=\"text-sm opacity-80 mb-3\">\n                Created by {joinMatch.createdBy}\n              </div>\n              {joinMatch.startingScore && (\n                <div className=\"mb-3\">\n                  Starting score:{\" \"}\n                  <span className=\"font-mono\">{joinMatch.startingScore}</span>\n                </div>\n              )}\n              {/* Match start showcase overlay */}\n              <MatchStartShowcase\n                open={showStartShowcase}\n                players={players as any}\n                user={user}\n                onRequestClose={() => {}}\n                onDone={() => {}}\n              />\n              <div className=\"mb-3\">\n                Timer: <span className=\"font-mono\">{joinTimer}s</span>\n              </div>\n              {(joinTimer <= 15 || (joinMatch as any)?.prestartEndsAt) && (\n                <div className=\"mb-3\">\n                  Choose:{\" \"}\n                  <div className=\"flex gap-2\">\n                    <button\n                      className={`btn ${joinChoice === \"bull\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"bull\")}\n                    >\n                      Bull Up\n                    </button>\n                    <button\n                      className={`btn ${joinChoice === \"skip\" ? \"btn-primary\" : \"btn-ghost\"}`}\n                      onClick={() => sendPrestartChoice(\"skip\")}\n                    >\n                      Skip\n                    </button>\n                  </div>\n                  <div className=\"text-xs opacity-70 mt-2\">\n                    {joinChoice\n                      ? `You chose: ${joinChoice}`\n                      : \"Please choose Bull Up or Skip before accepting\"}\n                  </div>\n                  {Object.keys(remoteChoices).length > 0 && (\n                    <div\n                      className=\"text-xs opacity-70 mt-2\"\n                      role=\"status\"\n                      aria-live=\"polite\"\n                    >\n                      {Object.entries(remoteChoices).map(([pid, choice]) => (\n                        <div key={pid}>\n                          {participants[pid] || pid} chose: {choice}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Skip requires both players to click Skip. Waiting for\n                      other player‚Ä¶\n                    </div>\n                  )}\n                  {joinChoice === \"skip\" &&\n                    Object.values(remoteChoices).some((c) => c === \"skip\") && (\n                      <div className=\"text-sm font-semibold mt-2\">\n                        Both players skipped ‚Äî Left player throws first\n                      </div>\n                    )}\n                  {bullActive && (\n                    <div className=\"text-xs opacity-70 mt-2\">\n                      Bull Up active ‚Äî\n                      {bullThrown\n                        ? ` you threw ${bullLocalThrow ?? 50}`\n                        : \" throw to win the bull!\"}\n                    </div>\n                  )}\n                  {bullActive && !bullThrown && (\n                    <div className=\"flex items-center gap-2 mt-2\">\n                      <input\n                        className=\"input input-sm\"\n                        aria-label=\"bull-throw\"\n                        type=\"number\"\n                        min={0}\n                        max={50}\n                        value={bullThrow ?? 50}\n                        onChange={(e) =>\n                          setBullThrow(\n                            Math.max(\n                              0,\n                              Math.min(50, Number(e.target.value || 0)),\n                            ),\n                          )\n                        }\n                      />\n                      <button\n                        className=\"btn btn-primary\"\n                        onClick={() => {\n                          try {\n                            if (wsGlobal?.connected && joinMatch?.id)\n                              wsGlobal.send({\n                                type: \"prestart-bull-throw\",\n                                roomId: joinMatch.id,\n                                score: bullThrow ?? 50,\n                              });\n                          } catch {}\n                          setBullLocalThrow(bullThrow ?? 50);\n                          setBullThrown(true);\n                        }}\n                      >\n                        Throw Bull\n                      </button>\n                    </div>\n                  )}\n                  {bullThrown && (\n                    <div className=\"text-sm font-semibold mt-2 animate-pulse\">\n                      You threw: {bullLocalThrow ?? 50}\n                    </div>\n                  )}\n                  {bullWinner && (\n                    <div className=\"text-sm font-semibold mt-2\">\n                      Bull winner: {bullWinner}\n                    </div>\n                  )}\n                </div>\n              )}\n              <div className=\"flex items-center gap-2\">\n                <button\n                  ref={joinAcceptRef}\n                  aria-label=\"Accept invitation\"\n                  className=\"btn btn-primary\"\n                  onClick={handleJoinAccept}\n                  disabled={joinTimer <= 15 && !joinChoice}\n                >\n                  Accept\n                </button>\n                <button\n                  className=\"btn btn-ghost\"\n                  onClick={() => {\n                    setJoinMatch(null);\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","user","useUserSettings","useLayoutEffect","onKey","e","handleCreate","createPortal","jsxs","jsx","v","opts","allGames","g","opt","prev","base","OnlinePlayClean","username","currentRoomIdx","setCurrentRoomIdx","rooms","setRooms","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","useMatch","s","players","focusMode","setFocusMode","matchesRef","showDemoControls","useEffect","onDocClick","showStartShowcase","setShowStartShowcase","startedShowcasedRef","React","st","flagKey","openMatchWindow","onQuit","showCreateModal","setShowCreateModal","joinMatch","setJoinMatch","joinAcceptRef","_selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverMatchesRef","serverPrestartRef","joinChoice","setJoinChoice","remoteChoices","setRemoteChoices","bullActive","setBullActive","bullThrow","setBullThrow","bullWinner","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","searchQuery","setSearchQuery","filterGame","setFilterGame","filterMode","setFilterMode","sortBy","setSortBy","currentPage","setCurrentPage","itemsPerPage","currentRoom","maxMatchesPerRoom","normalizeMatch","m","createdBy","createdAt","filterMatches","useMemo","list","combinedMatches","all","q","mt","target","a","b","tA","tB","totalPages","paginatedMatches","handleQuickJoin","requestJoin","handleCreateMatch","payload","newMatch","r","idx","newRoom","id","newRooms","msg","filtered","endsAt","roomId","playerId","choice","handleJoinAccept","sendPrestartChoice","runOnlineInPlayDemo","launchInPlayDemo","MatchStartShowcase","Trophy","Search","Zap","Users","Target","Clock","Fragment","p","ChevronDown","_","i","pid","c"],"mappings":"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"}
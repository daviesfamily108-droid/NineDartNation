{"version":3,"file":"OnlinePlay.clean-DSZcG23Q.js","sources":["../../src/components/ui/CreateMatchModal.tsx","../../src/components/ui/MatchPrestart.tsx","../../src/components/InGameShell.tsx","../../src/components/OnlinePlay.clean.tsx"],"sourcesContent":["import React, { useLayoutEffect, useState, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  allGames,\n  type GameKey,\n  getStartOptionsForGame,\n} from \"../../utils/games.js\";\nimport { useUserSettings } from \"../../store/userSettings.js\";\n\ntype Props = {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (payload: any) => void;\n};\n\nexport default function CreateMatchModal({ open, onClose, onCreate }: Props) {\n  const [portalEl] = useState(() => document.createElement(\"div\"));\n  const [game, setGame] = useState<GameKey>(\"X01\");\n  const [modeType, setModeType] = useState<\"bestof\" | \"firstto\">(\"bestof\");\n  const [legs, setLegs] = useState<number>(3);\n  const legsRef = useRef<HTMLInputElement | null>(null);\n  const [avgChoice, setAvgChoice] = useState<number>(0);\n  const [startingScore, setStartingScore] = useState<number | undefined>(() => {\n    const opts = getStartOptionsForGame(game);\n    return opts?.[0];\n  });\n  const user = (useUserSettings() as any).username || \"Anonymous\";\n\n  useLayoutEffect(() => {\n    portalEl.className = \"ndn-create-match-portal\";\n    document.body.appendChild(portalEl);\n    return () => {\n      try {\n        portalEl && portalEl.remove();\n      } catch {}\n    };\n  }, [portalEl]);\n\n  // Close modal on Escape key\n  useLayoutEffect(() => {\n    function onKey(e: KeyboardEvent) {\n      if (e.key === \"Escape\") onClose();\n    }\n    if (open) document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open, onClose]);\n\n  const handleCreate = () => {\n    const payload = {\n      createdBy: user,\n      game,\n      modeType,\n      legs,\n      avgChoice,\n      startingScore,\n    };\n    onCreate(payload);\n    onClose();\n  };\n\n  if (!open) return null;\n\n  if (!portalEl) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-2 sm:p-6\">\n      {/* A dedicated, accessible button covers the backdrop to capture clicks and keyboard input */}\n      <button\n        aria-label=\"Close dialog\"\n        className=\"absolute inset-0 w-full h-full bg-transparent\"\n        onClick={onClose}\n      />\n      <div\n        className=\"rounded-2xl p-5 sm:p-6 max-w-lg w-full relative text-white shadow-2xl border border-indigo-500/30 max-h-[85vh] overflow-y-auto\"\n        style={{ background: \"var(--ndn-card-bg, #0f172a)\" }}\n        role=\"dialog\"\n      >\n        <button\n          aria-label=\"Close\"\n          className=\"absolute top-3 right-3 w-7 h-7 rounded-full bg-indigo-500/20 hover:bg-indigo-500/40 flex items-center justify-center text-xs transition-colors\"\n          onClick={onClose}\n        >\n          âœ•\n        </button>\n        <h2 className=\"text-base sm:text-lg font-bold tracking-tight mb-3\">\n          ğŸ¯ Create Match\n        </h2>\n        <div className=\"grid grid-cols-1 gap-3\">\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Created By\n            </div>\n            <div className=\"p-2 rounded-lg border border-indigo-500/20 bg-indigo-500/10 text-sm text-white\">\n              {user}\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-game\"\n            >\n              Game\n            </label>\n            <select\n              id=\"match-game\"\n              className=\"w-full p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white\"\n              value={game}\n              onChange={(e) => {\n                const v = e.target.value as GameKey;\n                setGame(v);\n                const opts = getStartOptionsForGame(v);\n                setStartingScore(opts?.[0]);\n              }}\n              onPointerDown={(e) => {\n                (e as any).stopPropagation();\n              }}\n              onMouseDown={(e) => {\n                e.stopPropagation();\n              }}\n              onTouchStart={(e) => {\n                (e as any).stopPropagation?.();\n              }}\n            >\n              {allGames.map((g) => (\n                <option key={g} value={g} className=\"bg-slate-900 text-white\">\n                  {g}\n                </option>\n              ))}\n            </select>\n          </div>\n          {getStartOptionsForGame(game).length > 0 ? (\n            <div>\n              <label\n                className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n                htmlFor=\"match-start\"\n              >\n                {`${game} Starting Score`}\n              </label>\n              <select\n                id=\"match-start\"\n                className=\"p-2 border border-indigo-500/20 bg-slate-900 rounded-lg text-sm text-white w-full\"\n                value={startingScore}\n                onChange={(e) => setStartingScore(Number(e.target.value))}\n                onPointerDown={(e) => {\n                  (e as any).stopPropagation();\n                }}\n                onMouseDown={(e) => {\n                  e.stopPropagation();\n                }}\n                onTouchStart={(e) => {\n                  (e as any).stopPropagation?.();\n                }}\n              >\n                {getStartOptionsForGame(game).map((opt) => (\n                  <option\n                    key={opt}\n                    value={opt}\n                    className=\"bg-slate-900 text-white\"\n                  >\n                    {opt}\n                  </option>\n                ))}\n              </select>\n            </div>\n          ) : null}\n          <div>\n            <div className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1\">\n              Mode\n            </div>\n            <div className=\"flex gap-2 mt-1 justify-center\">\n              <label\n                className={`btn ${modeType === \"bestof\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"bestof\"\n                  checked={modeType === \"bestof\"}\n                  onChange={() => {\n                    setModeType(\"bestof\");\n                    setLegs((prev) => {\n                      const base = Math.max(1, prev || 3);\n                      // Ensure odd for Best Of\n                      return base % 2 === 1 ? base : base + 1;\n                    });\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                Best Of\n              </label>\n              <label\n                className={`btn ${modeType === \"firstto\" ? \"btn-primary\" : \"btn-ghost\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"mode\"\n                  value=\"firstto\"\n                  checked={modeType === \"firstto\"}\n                  onChange={() => {\n                    setModeType(\"firstto\");\n                    setLegs((prev) => Math.max(1, prev || 3));\n                    setTimeout(() => legsRef.current?.focus(), 0);\n                  }}\n                  className=\"sr-only\"\n                />{\" \"}\n                First To\n              </label>\n            </div>\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-legs\"\n            >\n              {modeType === \"bestof\" ? \"Best Of\" : \"First To\"}\n            </label>\n            <input\n              id=\"match-legs\"\n              type=\"number\"\n              min={1}\n              value={legs}\n              onChange={(e) =>\n                setLegs(Math.max(1, Number(e.target.value || 1)))\n              }\n              ref={legsRef}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n          <div>\n            <label\n              className=\"text-[10px] font-bold uppercase tracking-widest text-indigo-300/70 mb-1 block\"\n              htmlFor=\"match-avg\"\n            >\n              Average Choice (Â±)\n            </label>\n            <input\n              id=\"match-avg\"\n              type=\"number\"\n              value={avgChoice}\n              onChange={(e) => setAvgChoice(Number(e.target.value || 0))}\n              className=\"w-full p-2 border border-indigo-500/20 bg-indigo-500/10 rounded-lg text-sm text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2 mt-4 pt-3 border-t border-indigo-500/20\">\n          <button className=\"flex-1 btn btn-ghost text-xs\" onClick={onClose}>\n            Cancel\n          </button>\n          <button className=\"flex-1 btn text-xs\" onClick={handleCreate}>\n            Create Match\n          </button>\n        </div>\n      </div>\n    </div>,\n    portalEl,\n  );\n}\n","import React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  useCallback,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport CameraTile from \"../CameraTile.js\";\nimport {\n  getAllTimeAvg,\n  getAllTimeFirstNineAvg,\n  getAllTimeBestCheckout,\n  getAllTimeBestLeg,\n  getAllTime,\n  getAllTime180s,\n  getHeadToHeadLegDiff,\n} from \"../../store/profileStats.js\";\nimport {\n  Target,\n  Trophy,\n  Zap,\n  Crown,\n  Timer,\n  ArrowRight,\n  X,\n  BarChart2,\n  Camera,\n} from \"lucide-react\";\n\n/* â”€â”€ Board constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst BOARD_SIZE = 400;\nconst CX = BOARD_SIZE / 2;\nconst CY = BOARD_SIZE / 2;\nconst BULL_INNER_R = 6.35;\nconst BULL_OUTER_R = 15.9;\nconst TREBLE_INNER_R = 99;\nconst TREBLE_OUTER_R = 107;\nconst DOUBLE_INNER_R = 162;\nconst DOUBLE_OUTER_R = 170;\nconst SCALE = (BOARD_SIZE / 2 - 15) / DOUBLE_OUTER_R;\n\nconst SECTOR_ORDER = [\n  20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5,\n];\n\nconst SECTOR_COLORS: Record<number, { dark: string; light: string }> = {};\nSECTOR_ORDER.forEach((s, i) => {\n  SECTOR_COLORS[s] =\n    i % 2 === 0\n      ? { dark: \"#1a1a2e\", light: \"#c0392b\" }\n      : { dark: \"#f0e6d3\", light: \"#27ae60\" };\n});\n\n/* â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport type MatchPrestartProps = {\n  open: boolean;\n  matchInfo: {\n    id: string;\n    game: string;\n    modeType: string;\n    legs: number;\n    startingScore?: number;\n    createdBy?: string;\n    creatorName?: string;\n  } | null;\n  localUser: { username: string; email?: string; [k: string]: any } | null;\n  opponentName: string;\n  opponentStats?: {\n    avg3?: string;\n    best9?: string;\n    bestCheckout?: string | number;\n    bestLeg?: string | number;\n    career180s?: number;\n  } | null;\n  countdown?: number;\n  onChoice: (choice: \"bull\" | \"skip\") => void;\n  onBullThrow: (distanceMm: number) => void;\n  onAccept: () => void;\n  onCancel: () => void;\n  /** Remote player's choice */\n  remoteChoice?: \"bull\" | \"skip\" | null;\n  /** Whether the bull-up phase is active (server confirmed both chose bull) */\n  bullActive?: boolean;\n  /** Winner of the bull-up (username) */\n  bullWinner?: string | null;\n  /** Whether the bull-up tied (another round) */\n  bullTied?: boolean;\n};\n\n/* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction getPlayerStats(name: string) {\n  try {\n    const avg3 = getAllTimeAvg(name).toFixed(1);\n    const best9 = getAllTimeFirstNineAvg(name).toFixed(1);\n    const bestCheckout = getAllTimeBestCheckout(name);\n    const bestLeg = getAllTimeBestLeg(name);\n    const all = getAllTime(name);\n    const career180s = getAllTime180s(name);\n    return {\n      avg3,\n      best9,\n      bestCheckout: bestCheckout || \"â€“\",\n      bestLeg: bestLeg || \"â€“\",\n      lifetimeScored: all.scored || 0,\n      lifetimeDarts: all.darts || 0,\n      career180s: career180s || 0,\n    };\n  } catch {\n    return {\n      avg3: \"0.0\",\n      best9: \"0.0\",\n      bestCheckout: \"â€“\",\n      bestLeg: \"â€“\",\n      lifetimeScored: 0,\n      lifetimeDarts: 0,\n      career180s: 0,\n    };\n  }\n}\n\nfunction polarToXY(cx: number, cy: number, r: number, angleDeg: number) {\n  const rad = ((angleDeg - 90) * Math.PI) / 180;\n  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };\n}\n\nfunction distFromBull(x: number, y: number): number {\n  const dx = x - CX;\n  const dy = y - CY;\n  return Math.sqrt(dx * dx + dy * dy) / SCALE;\n}\n\n/* â”€â”€ Stat pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction StatPill({\n  label,\n  value,\n  highlight,\n}: {\n  label: string;\n  value: string | number;\n  highlight?: boolean;\n}) {\n  return (\n    <div\n      className={`flex flex-col items-center px-1.5 py-1 rounded-lg ${highlight ? \"bg-indigo-500/20 ring-1 ring-indigo-500/30\" : \"bg-white/5\"}`}\n    >\n      <span className=\"text-[7px] sm:text-[8px] uppercase tracking-wider font-bold text-white/50\">\n        {label}\n      </span>\n      <span\n        className={`text-xs sm:text-sm font-black ${highlight ? \"text-indigo-300\" : \"text-white\"}`}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n\n/* â”€â”€ Interactive dartboard SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction DartboardBullUp({\n  onSelect,\n  selectedPoint,\n  disabled,\n  label,\n}: {\n  onSelect: (x: number, y: number, distMm: number) => void;\n  selectedPoint: { x: number; y: number } | null;\n  disabled?: boolean;\n  label?: string;\n}) {\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  const coordsFromEvent = useCallback((clientX: number, clientY: number) => {\n    const svg = svgRef.current;\n    if (!svg) return null;\n    const rect = svg.getBoundingClientRect();\n    const x = ((clientX - rect.left) / rect.width) * BOARD_SIZE;\n    const y = ((clientY - rect.top) / rect.height) * BOARD_SIZE;\n    const dist = distFromBull(x, y);\n    return { x, y, dist: Math.round(dist * 10) / 10 };\n  }, []);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      const c = coordsFromEvent(e.clientX, e.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  const handleTouch = useCallback(\n    (e: React.TouchEvent<SVGSVGElement>) => {\n      if (disabled) return;\n      e.preventDefault();\n      const touch = e.changedTouches[0];\n      if (!touch) return;\n      const c = coordsFromEvent(touch.clientX, touch.clientY);\n      if (c) onSelect(c.x, c.y, c.dist);\n    },\n    [onSelect, disabled, coordsFromEvent],\n  );\n\n  // Build sector paths\n  const sectorPaths = useMemo(() => {\n    const paths: React.ReactNode[] = [];\n    const degPerSector = 18;\n\n    for (let i = 0; i < 20; i++) {\n      const sector = SECTOR_ORDER[i];\n      const startAngle = i * degPerSector - degPerSector / 2;\n      const endAngle = startAngle + degPerSector;\n      const colors = SECTOR_COLORS[sector];\n\n      // Each sector has: outer single, double, inner single, treble\n      const rings = [\n        {\n          inner: TREBLE_OUTER_R,\n          outer: DOUBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: DOUBLE_INNER_R,\n          outer: DOUBLE_OUTER_R,\n          fill: colors.light,\n        },\n        {\n          inner: BULL_OUTER_R,\n          outer: TREBLE_INNER_R,\n          fill: colors.dark,\n        },\n        {\n          inner: TREBLE_INNER_R,\n          outer: TREBLE_OUTER_R,\n          fill: colors.light,\n        },\n      ];\n\n      rings.forEach((ring, ri) => {\n        const r1 = ring.inner * SCALE;\n        const r2 = ring.outer * SCALE;\n        const p1 = polarToXY(CX, CY, r1, startAngle);\n        const p2 = polarToXY(CX, CY, r2, startAngle);\n        const p3 = polarToXY(CX, CY, r2, endAngle);\n        const p4 = polarToXY(CX, CY, r1, endAngle);\n        const largeArc = degPerSector > 180 ? 1 : 0;\n        const d = [\n          `M ${p1.x} ${p1.y}`,\n          `L ${p2.x} ${p2.y}`,\n          `A ${r2} ${r2} 0 ${largeArc} 1 ${p3.x} ${p3.y}`,\n          `L ${p4.x} ${p4.y}`,\n          `A ${r1} ${r1} 0 ${largeArc} 0 ${p1.x} ${p1.y}`,\n          \"Z\",\n        ].join(\" \");\n        paths.push(\n          <path\n            key={`s${sector}-r${ri}`}\n            d={d}\n            fill={ring.fill}\n            stroke=\"rgba(255,255,255,0.08)\"\n            strokeWidth={0.5}\n            opacity={0.85}\n          />,\n        );\n      });\n\n      // Number label\n      const labelPos = polarToXY(\n        CX,\n        CY,\n        (DOUBLE_OUTER_R + 12) * SCALE,\n        i * degPerSector,\n      );\n      paths.push(\n        <text\n          key={`label-${sector}`}\n          x={labelPos.x}\n          y={labelPos.y}\n          textAnchor=\"middle\"\n          dominantBaseline=\"central\"\n          fill=\"rgba(255,255,255,0.8)\"\n          fontSize=\"11\"\n          fontWeight=\"bold\"\n          fontFamily=\"system-ui, sans-serif\"\n        >\n          {sector}\n        </text>,\n      );\n    }\n\n    return paths;\n  }, []);\n\n  return (\n    <div className=\"relative\">\n      {label && (\n        <div className=\"text-center mb-2\">\n          <span\n            className={`text-xs font-bold uppercase tracking-widest ${\n              disabled && selectedPoint ? \"text-emerald-400\" : \"text-white/50\"\n            }`}\n          >\n            {label}\n          </span>\n        </div>\n      )}\n      <svg\n        ref={svgRef}\n        viewBox={`0 0 ${BOARD_SIZE} ${BOARD_SIZE}`}\n        className={`w-full h-full touch-none select-none ${\n          disabled ? \"pointer-events-none\" : \"cursor-crosshair\"\n        }`}\n        style={{ opacity: disabled && !selectedPoint ? 0.5 : 1 }}\n        onClick={handleClick}\n        onTouchEnd={handleTouch}\n      >\n        {/* Background */}\n        <circle cx={CX} cy={CY} r={CX} fill=\"#0a0a1a\" />\n\n        {/* Sector paths */}\n        {sectorPaths}\n\n        {/* Wire rings for realism */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={TREBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_INNER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.15)\"\n          strokeWidth={0.8}\n        />\n        <circle\n          cx={CX}\n          cy={CY}\n          r={DOUBLE_OUTER_R * SCALE}\n          fill=\"none\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={1}\n        />\n\n        {/* Bull outer (green) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_OUTER_R * SCALE}\n          fill=\"#27ae60\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n        {/* Bull inner (red) */}\n        <circle\n          cx={CX}\n          cy={CY}\n          r={BULL_INNER_R * SCALE}\n          fill=\"#c0392b\"\n          stroke=\"rgba(192,192,192,0.2)\"\n          strokeWidth={0.8}\n        />\n\n        {/* Pulsing bullseye guide when no dart placed */}\n        {!selectedPoint && !disabled && (\n          <circle\n            cx={CX}\n            cy={CY}\n            r={BULL_OUTER_R * SCALE * 1.8}\n            fill=\"none\"\n            stroke=\"rgba(234,179,8,0.4)\"\n            strokeWidth={1.5}\n            strokeDasharray=\"4,4\"\n          >\n            <animate\n              attributeName=\"r\"\n              values={`${BULL_OUTER_R * SCALE * 1.5};${BULL_OUTER_R * SCALE * 2.2};${BULL_OUTER_R * SCALE * 1.5}`}\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n            <animate\n              attributeName=\"opacity\"\n              values=\"0.5;0.15;0.5\"\n              dur=\"2s\"\n              repeatCount=\"indefinite\"\n            />\n          </circle>\n        )}\n\n        {/* Crosshair at center */}\n        <line\n          x1={CX - 6}\n          y1={CY}\n          x2={CX + 6}\n          y2={CY}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n        <line\n          x1={CX}\n          y1={CY - 6}\n          x2={CX}\n          y2={CY + 6}\n          stroke=\"rgba(255,255,255,0.25)\"\n          strokeWidth={0.5}\n        />\n\n        {/* Selected dart position */}\n        {selectedPoint && (\n          <>\n            {/* Line from bull to dart */}\n            <line\n              x1={CX}\n              y1={CY}\n              x2={selectedPoint.x}\n              y2={selectedPoint.y}\n              stroke={disabled ? \"rgba(34,197,94,0.6)\" : \"rgba(234,179,8,0.5)\"}\n              strokeWidth={1}\n              strokeDasharray=\"3,3\"\n            />\n            {/* Dart shadow */}\n            <circle\n              cx={selectedPoint.x + 1}\n              cy={selectedPoint.y + 1}\n              r={6}\n              fill=\"rgba(0,0,0,0.4)\"\n            />\n            {/* Dart marker - green when locked, yellow when editable */}\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={6}\n              fill={disabled ? \"#22c55e\" : \"#eab308\"}\n              stroke=\"#fff\"\n              strokeWidth={2}\n              className=\"drop-shadow-lg\"\n            />\n            <circle\n              cx={selectedPoint.x}\n              cy={selectedPoint.y}\n              r={2.5}\n              fill=\"#fff\"\n            />\n            {/* Lock icon indicator when locked */}\n            {disabled && (\n              <text\n                x={selectedPoint.x}\n                y={selectedPoint.y - 14}\n                textAnchor=\"middle\"\n                fill=\"#22c55e\"\n                fontSize=\"10\"\n                fontWeight=\"bold\"\n              >\n                ğŸ”’\n              </text>\n            )}\n          </>\n        )}\n      </svg>\n    </div>\n  );\n}\n\n/* â”€â”€ Player Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction PlayerCard({\n  name,\n  stats,\n  isLocal,\n  showCamera,\n  isWinner,\n  legDiff,\n}: {\n  name: string;\n  stats: ReturnType<typeof getPlayerStats>;\n  isLocal: boolean;\n  showCamera?: boolean;\n  isWinner?: boolean;\n  legDiff?: number | null;\n}) {\n  const legDiffValue =\n    typeof legDiff === \"number\" ? `${legDiff > 0 ? \"+\" : \"\"}${legDiff}` : null;\n  return (\n    <div\n      className={`relative rounded-xl border p-2 sm:p-3 transition-all duration-500 ${\n        isWinner\n          ? \"border-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/5 shadow-xl shadow-amber-500/10 ring-1 ring-amber-400/30\"\n          : \"border-white/10 bg-white/5\"\n      }`}\n    >\n      {isWinner && (\n        <div className=\"absolute -top-2.5 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-amber-500 text-black text-[9px] font-black uppercase tracking-widest rounded-full shadow-lg\">\n          <Crown className=\"w-2.5 h-2.5 inline mr-0.5\" />\n          Throws First\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-2\">\n        <div\n          className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${\n            isLocal\n              ? \"bg-gradient-to-br from-indigo-500 to-purple-600 text-white\"\n              : \"bg-gradient-to-br from-rose-500 to-orange-500 text-white\"\n          }`}\n        >\n          {name.substring(0, 2).toUpperCase()}\n        </div>\n        <div>\n          <div className=\"font-bold text-white text-sm sm:text-base tracking-tight\">\n            {name}\n          </div>\n          <div className=\"text-[9px] text-white/50 font-semibold uppercase tracking-wider\">\n            {isLocal ? \"You\" : \"Opponent\"}\n          </div>\n        </div>\n      </div>\n\n      {/* Stats grid */}\n      <div className=\"grid grid-cols-4 gap-1 mb-2\">\n        <StatPill label=\"Avg\" value={stats.avg3} highlight />\n        <StatPill label=\"F9\" value={stats.best9} />\n        <StatPill label=\"CO\" value={String(stats.bestCheckout)} />\n        <StatPill\n          label={legDiffValue !== null ? \"Leg Î”\" : \"Leg\"}\n          value={legDiffValue ?? String(stats.bestLeg)}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-1 text-[9px]\">\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">180s</span>\n          <span className=\"font-bold text-white\">{stats.career180s}</span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Scored</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeScored.toLocaleString()}\n          </span>\n        </div>\n        <div className=\"flex items-center justify-between px-1.5 py-0.5 rounded-lg bg-white/5 border border-white/5\">\n          <span className=\"text-white/50\">Darts</span>\n          <span className=\"font-bold text-white\">\n            {stats.lifetimeDarts.toLocaleString()}\n          </span>\n        </div>\n      </div>\n\n      {/* Camera preview */}\n      {showCamera && (\n        <div className=\"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/40\">\n          <div className=\"px-2 py-1 flex items-center gap-1.5 text-[9px] text-white/60 border-b border-white/5\">\n            <Camera className=\"w-2.5 h-2.5\" />\n            <span className=\"font-semibold uppercase tracking-wider\">\n              {isLocal ? \"Your Camera\" : \"Opponent Camera\"}\n            </span>\n            <span className=\"ml-auto text-emerald-400 font-bold\">â— Live</span>\n          </div>\n          <div className=\"aspect-video relative bg-black\">\n            {isLocal ? (\n              <CameraTile\n                autoStart\n                forceAutoStart\n                fill\n                aspect=\"free\"\n                tileFitModeOverride=\"fit\"\n                scale={1}\n              />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center text-white/30 text-[10px]\">\n                <div className=\"text-center\">\n                  <Camera className=\"w-6 h-6 mx-auto mb-1 opacity-30\" />\n                  Waiting for opponent's feedâ€¦\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* â”€â”€ Main Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nexport default function MatchPrestart({\n  open,\n  matchInfo,\n  localUser,\n  opponentName,\n  opponentStats,\n  countdown = 15,\n  onChoice,\n  onBullThrow,\n  onAccept,\n  onCancel,\n  remoteChoice,\n  bullActive,\n  bullWinner,\n  bullTied,\n}: MatchPrestartProps) {\n  const [seconds, setSeconds] = useState(countdown);\n  const [phase, setPhase] = useState<\n    \"preview\" | \"choice\" | \"bull\" | \"result\" | \"go\"\n  >(\"preview\");\n  const [localChoice, setLocalChoice] = useState<\"bull\" | \"skip\" | null>(null);\n  const [dartPoint, setDartPoint] = useState<{ x: number; y: number } | null>(\n    null,\n  );\n  const [dartDistMm, setDartDistMm] = useState<number | null>(null);\n  const [dartLocked, setDartLocked] = useState(false); // Lock dart position after first tap\n  const [dartSubmitted, setDartSubmitted] = useState(false);\n  const portalElRef = useRef<HTMLElement | null>(\n    typeof document !== \"undefined\" ? document.createElement(\"div\") : null,\n  );\n\n  const localStats = useMemo(\n    () => getPlayerStats(localUser?.username || \"\"),\n    [localUser?.username],\n  );\n  const oppStats = useMemo(() => {\n    if (opponentStats) {\n      return {\n        avg3: opponentStats.avg3 || \"0.0\",\n        best9: opponentStats.best9 || \"0.0\",\n        bestCheckout: opponentStats.bestCheckout || \"â€“\",\n        bestLeg: opponentStats.bestLeg || \"â€“\",\n        career180s: opponentStats.career180s || 0,\n        lifetimeScored: 0,\n        lifetimeDarts: 0,\n      };\n    }\n    return getPlayerStats(opponentName);\n  }, [opponentName, opponentStats]);\n\n  // Portal\n  useEffect(() => {\n    const el = portalElRef.current;\n    if (!el || typeof document === \"undefined\") return;\n    el.className = \"ndn-match-prestart-portal\";\n    document.body.appendChild(el);\n    return () => {\n      try {\n        el.parentNode?.removeChild(el);\n      } catch {}\n    };\n  }, []);\n\n  // Countdown timer\n  useEffect(() => {\n    if (!open) return;\n    setSeconds(countdown);\n    setPhase(\"preview\");\n    setLocalChoice(null);\n    setDartPoint(null);\n    setDartDistMm(null);\n    setDartLocked(false);\n    setDartSubmitted(false);\n  }, [open, countdown]);\n\n  useEffect(() => {\n    if (!open || phase === \"result\" || phase === \"go\") return;\n    const id = window.setInterval(() => {\n      setSeconds((s) => {\n        const next = s - 1;\n        if (next <= 0) {\n          window.clearInterval(id);\n          // Auto-transition based on phase\n          if (phase === \"preview\") {\n            setPhase(\"choice\");\n            return countdown;\n          }\n          if (phase === \"choice\" && !localChoice) {\n            // Time ran out without choosing â†’ auto-skip\n            setLocalChoice(\"skip\");\n            onChoice(\"skip\");\n          }\n          return 0;\n        }\n        // After 5 seconds of preview, move to choice automatically\n        if (phase === \"preview\" && countdown - next >= 5) {\n          setPhase(\"choice\");\n        }\n        return next;\n      });\n    }, 1000);\n    return () => window.clearInterval(id);\n  }, [open, phase, countdown, localChoice, onChoice]);\n\n  // React to bull-up activation from server\n  useEffect(() => {\n    if (bullActive) {\n      setPhase(\"bull\");\n      setDartPoint(null);\n      setDartDistMm(null);\n      setDartLocked(false);\n      setDartSubmitted(false);\n    }\n  }, [bullActive]);\n\n  // React to bull winner\n  useEffect(() => {\n    if (bullWinner) {\n      setPhase(\"result\");\n      // After 3 seconds, show \"GO\"\n      const t = setTimeout(() => setPhase(\"go\"), 3000);\n      return () => clearTimeout(t);\n    }\n  }, [bullWinner]);\n\n  // React to bull tied â€” reset for another round\n  useEffect(() => {\n    if (bullTied) {\n      setDartPoint(null);\n      setDartDistMm(null);\n      setDartLocked(false);\n      setDartSubmitted(false);\n      setPhase(\"bull\");\n    }\n  }, [bullTied]);\n\n  // When both skip, go directly\n  useEffect(() => {\n    if (localChoice === \"skip\" && remoteChoice === \"skip\") {\n      setPhase(\"result\");\n      const t = setTimeout(() => setPhase(\"go\"), 2000);\n      return () => clearTimeout(t);\n    }\n  }, [localChoice, remoteChoice]);\n\n  // Auto-accept when \"go\" phase completes\n  useEffect(() => {\n    if (phase !== \"go\") return;\n    const t = setTimeout(() => {\n      onAccept();\n    }, 1500);\n    return () => clearTimeout(t);\n  }, [phase, onAccept]);\n\n  const handleDartSelect = useCallback(\n    (x: number, y: number, distMm: number) => {\n      // Once a dart is placed, lock it - no further changes allowed\n      if (dartLocked) return;\n      setDartPoint({ x, y });\n      setDartDistMm(distMm);\n      setDartLocked(true); // Lock immediately after first placement\n    },\n    [dartLocked],\n  );\n\n  const handleSubmitDart = useCallback(() => {\n    if (dartDistMm == null) return;\n    setDartSubmitted(true);\n    onBullThrow(dartDistMm);\n  }, [dartDistMm, onBullThrow]);\n\n  const handleChoice = useCallback(\n    (c: \"bull\" | \"skip\") => {\n      setLocalChoice(c);\n      onChoice(c);\n    },\n    [onChoice],\n  );\n\n  const localName = localUser?.username || \"You\";\n  const headToHead = useMemo(\n    () => getHeadToHeadLegDiff(localName, opponentName),\n    [localName, opponentName],\n  );\n  const localLegDiff = headToHead.played ? headToHead.diffA : null;\n  const opponentLegDiff = headToHead.played ? headToHead.diffB : null;\n\n  if (!open || !portalElRef.current || !matchInfo) return null;\n\n  const isLocalWinner = bullWinner === localName;\n  const isOpponentWinner = bullWinner === opponentName;\n  const bothSkipped = localChoice === \"skip\" && remoteChoice === \"skip\";\n\n  const overlay = (\n    <div\n      className=\"fixed inset-0 z-[9998] bg-black/95 backdrop-blur-xl flex flex-col\"\n      style={{ height: \"100dvh\", maxHeight: \"100dvh\", overflow: \"hidden\" }}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Match pre-start\"\n    >\n      {/* Decorative background */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px]\" />\n        <div className=\"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent\" />\n      </div>\n\n      <div className=\"flex-1 flex items-center justify-center p-2 sm:p-4 min-h-0\">\n        <div className=\"relative w-full max-w-5xl max-h-full flex flex-col\">\n          {/* Close button */}\n          <button\n            className=\"absolute -top-2 -right-2 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white/60 hover:text-white transition-all border border-white/10\"\n            onClick={onCancel}\n            aria-label=\"Cancel match\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n\n          {/* Match info header */}\n          <div className=\"text-center mb-2 sm:mb-4 flex-shrink-0\">\n            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] sm:text-[11px] font-bold uppercase tracking-widest text-white/60 mb-2\">\n              <Target className=\"w-3 h-3\" />\n              {matchInfo.game} Â·{\" \"}\n              {matchInfo.modeType === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n              {matchInfo.legs} Â· {matchInfo.startingScore || 501}\n            </div>\n\n            {phase === \"preview\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-white to-white/50 tracking-tighter\">\n                  Match Found\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Reviewing opponent statsâ€¦\n                </p>\n              </div>\n            )}\n\n            {phase === \"choice\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-3xl font-black text-white tracking-tighter\">\n                  Who Throws First?\n                </h2>\n                <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                  Bull up to decide, or skip and let the creator go first\n                </p>\n              </div>\n            )}\n\n            {phase === \"bull\" && (\n              <div className=\"animate-in fade-in duration-500\">\n                <h2 className=\"text-2xl sm:text-3xl font-black text-amber-300 tracking-tighter\">\n                  ğŸ¯ Bull Up!\n                </h2>\n                <p className=\"text-[10px] sm:text-xs text-white/50 mt-0.5\">\n                  Throw your dart at the bullseye, then tap where it landed on\n                  the board\n                </p>\n                <p className=\"text-[9px] text-white/30\">\n                  Both players mark their throw â€” closest to the bull throws\n                  first\n                </p>\n              </div>\n            )}\n\n            {phase === \"result\" && (\n              <div className=\"animate-in fade-in zoom-in-95 duration-700\">\n                {bullWinner ? (\n                  <>\n                    <h2 className=\"text-2xl sm:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-amber-500 tracking-tighter\">\n                      ğŸ‰ {bullWinner} Wins the Bull!\n                    </h2>\n                    <p className=\"text-xs sm:text-sm text-white/50 mt-1\">\n                      {bullWinner} throws first\n                    </p>\n                  </>\n                ) : bothSkipped ? (\n                  <>\n                    <h2 className=\"text-2xl sm:text-3xl font-black text-white tracking-tighter\">\n                      Both Players Skipped\n                    </h2>\n                    <p className=\"text-xs sm:text-sm text-white/50 mt-0.5\">\n                      {matchInfo.createdBy ||\n                        matchInfo.creatorName ||\n                        localName}{\" \"}\n                      throws first\n                    </p>\n                  </>\n                ) : null}\n              </div>\n            )}\n\n            {phase === \"go\" && (\n              <div className=\"animate-in fade-in zoom-in-50 duration-300\">\n                <h2 className=\"text-5xl sm:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500 tracking-tighter\">\n                  GO!\n                </h2>\n              </div>\n            )}\n          </div>\n\n          {/* Timer bar */}\n          {phase !== \"result\" && phase !== \"go\" && (\n            <div className=\"mb-2 sm:mb-4 flex-shrink-0\">\n              <div className=\"flex items-center justify-center gap-2 mb-1\">\n                <Timer className=\"w-3 h-3 sm:w-4 sm:h-4 text-white/40\" />\n                <span className=\"text-xl sm:text-2xl font-black text-white tabular-nums\">\n                  {seconds}\n                </span>\n                <span className=\"text-[10px] sm:text-xs text-white/40 font-semibold\">\n                  seconds\n                </span>\n              </div>\n              <div className=\"h-0.5 sm:h-1 bg-white/5 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000 ease-linear\"\n                  style={{\n                    width: `${(seconds / countdown) * 100}%`,\n                  }}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Player cards + VS */}\n          {(phase === \"preview\" ||\n            phase === \"choice\" ||\n            phase === \"result\") && (\n            <div className=\"grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-2 sm:gap-4 items-start mb-2 sm:mb-4 flex-shrink-0\">\n              <PlayerCard\n                name={localName}\n                stats={localStats}\n                isLocal\n                showCamera={phase === \"preview\"}\n                legDiff={localLegDiff}\n                isWinner={\n                  phase === \"result\" &&\n                  (isLocalWinner ||\n                    (bothSkipped &&\n                      (matchInfo.createdBy === localName ||\n                        matchInfo.creatorName === localName)))\n                }\n              />\n\n              {/* VS divider */}\n              <div className=\"hidden md:flex flex-col items-center justify-center py-8\">\n                <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-indigo-500/30 ring-2 ring-white/10\">\n                  VS\n                </div>\n                <div className=\"w-px h-12 bg-gradient-to-b from-indigo-500/30 to-transparent mt-2\" />\n              </div>\n              <div className=\"flex md:hidden items-center justify-center py-2\">\n                <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-xl shadow-indigo-500/30\">\n                  VS\n                </div>\n              </div>\n\n              <PlayerCard\n                name={opponentName}\n                stats={oppStats}\n                isLocal={false}\n                showCamera={phase === \"preview\"}\n                legDiff={opponentLegDiff}\n                isWinner={\n                  phase === \"result\" &&\n                  (isOpponentWinner ||\n                    (bothSkipped &&\n                      (matchInfo.createdBy === opponentName ||\n                        matchInfo.creatorName === opponentName)))\n                }\n              />\n            </div>\n          )}\n\n          {/* Choice phase */}\n          {phase === \"choice\" && !localChoice && (\n            <div className=\"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 flex-shrink-0\">\n              <div className=\"flex gap-3\">\n                <button\n                  className=\"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white font-black text-base sm:text-lg hover:shadow-xl hover:shadow-amber-500/30 hover:scale-105 transition-all duration-200 border border-amber-400/30\"\n                  onClick={() => handleChoice(\"bull\")}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <Target className=\"w-5 h-5\" />\n                    <span>Bull Up</span>\n                  </div>\n                  <div className=\"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-80\">\n                    Throw at the bullseye to decide\n                  </div>\n                </button>\n\n                <button\n                  className=\"group relative px-5 sm:px-8 py-3 sm:py-4 rounded-xl bg-white/5 border border-white/10 text-white font-bold text-base sm:text-lg hover:bg-white/10 hover:border-white/20 hover:scale-105 transition-all duration-200\"\n                  onClick={() => handleChoice(\"skip\")}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <ArrowRight className=\"w-5 h-5\" />\n                    <span>Skip</span>\n                  </div>\n                  <div className=\"text-[9px] sm:text-[10px] mt-0.5 font-medium opacity-50\">\n                    Creator throws first\n                  </div>\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* Choice made â€” waiting */}\n          {phase === \"choice\" && localChoice && !bullActive && (\n            <div className=\"text-center animate-in fade-in duration-300\">\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-white/70\">\n                <Zap className=\"w-4 h-4 text-amber-400\" />\n                You chose{\" \"}\n                <span className=\"font-bold text-white\">\n                  {localChoice === \"bull\" ? \"Bull Up\" : \"Skip\"}\n                </span>\n                {remoteChoice ? (\n                  <>\n                    {\" \"}\n                    Â· Opponent chose{\" \"}\n                    <span className=\"font-bold text-white\">\n                      {remoteChoice === \"bull\" ? \"Bull Up\" : \"Skip\"}\n                    </span>\n                  </>\n                ) : (\n                  <>\n                    {\" \"}\n                    Â· Waiting for opponent\n                    <span className=\"animate-pulse\">â€¦</span>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Bull-up phase â€” camera feed + dartboard */}\n          {phase === \"bull\" && (\n            <div className=\"flex flex-col items-center gap-2 sm:gap-3 animate-in fade-in zoom-in-95 duration-500 flex-1 min-h-0 overflow-hidden\">\n              {/* Live camera feed so the player can see their dart on the board */}\n              <div className=\"w-full max-w-[280px] sm:max-w-sm mx-auto rounded-xl border border-white/10 bg-black/60 overflow-hidden shadow-xl shadow-black/40 flex-shrink-0\">\n                <div className=\"relative aspect-[16/10]\">\n                  <CameraTile\n                    autoStart\n                    forceAutoStart\n                    fill\n                    aspect=\"free\"\n                    className=\"w-full h-full\"\n                  />\n                  <div className=\"absolute top-1 left-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 backdrop-blur-sm border border-white/10\">\n                    <Camera className=\"w-2.5 h-2.5 text-emerald-400\" />\n                    <span className=\"text-[9px] font-bold text-white/80 uppercase tracking-wider\">\n                      Live Feed\n                    </span>\n                  </div>\n                  <div className=\"absolute top-1 right-1 flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30\">\n                    <span className=\"text-[9px] font-bold text-emerald-400\">\n                      â— LIVE\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-1.5 text-[10px] sm:text-xs text-white/50 flex-shrink-0\">\n                <Target className=\"w-3 h-3 text-amber-400\" />\n                <span>\n                  See your dart above, then tap the board below where it landed\n                </span>\n              </div>\n\n              {/* Interactive dartboard for marking position */}\n              <div className=\"w-full max-w-[240px] sm:max-w-[280px] md:max-w-xs mx-auto rounded-xl border border-white/10 bg-black/40 p-2 sm:p-3 shadow-2xl shadow-black/50 flex-1 min-h-0\">\n                <DartboardBullUp\n                  onSelect={handleDartSelect}\n                  selectedPoint={dartPoint}\n                  disabled={dartLocked || dartSubmitted}\n                  label={\n                    dartLocked\n                      ? \"Dart position locked\"\n                      : \"Tap where your dart landed\"\n                  }\n                />\n              </div>\n\n              {/* Distance readout + button row */}\n              <div className=\"flex flex-wrap items-center justify-center gap-2 sm:gap-3 flex-shrink-0\">\n                {dartDistMm != null && (\n                  <div className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-white/5 border border-white/10 animate-in fade-in duration-300\">\n                    <Target className=\"w-4 h-4 text-amber-400\" />\n                    <span className=\"text-xl font-black text-white tabular-nums\">\n                      {dartDistMm.toFixed(1)}\n                    </span>\n                    <span className=\"text-sm text-white/50\">mm</span>\n                  </div>\n                )}\n\n                {/* Confirm / Waiting */}\n                {!dartSubmitted ? (\n                  <button\n                    className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-emerald-500/30 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:pointer-events-none border border-emerald-400/30\"\n                    disabled={dartDistMm == null}\n                    onClick={handleSubmitDart}\n                  >\n                    âœ… Confirm\n                  </button>\n                ) : (\n                  <div className=\"flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-xs text-white/70\">\n                    <div className=\"w-3 h-3 border-2 border-amber-400/30 border-t-amber-400 rounded-full animate-spin\" />\n                    Waiting for opponentâ€¦\n                  </div>\n                )}\n              </div>\n\n              {bullTied && (\n                <div className=\"text-xs text-amber-300 font-bold animate-bounce px-3 py-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 flex-shrink-0\">\n                  ğŸ”„ It's a tie! Throw again.\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Accept / Cancel row (for preview phase) */}\n          {phase === \"preview\" && (\n            <div className=\"flex items-center justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 flex-shrink-0\">\n              <button\n                className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold text-sm sm:text-base hover:shadow-xl hover:shadow-indigo-500/30 hover:scale-105 transition-all\"\n                onClick={() => setPhase(\"choice\")}\n              >\n                Ready â€” Continue\n              </button>\n              <button\n                className=\"px-4 sm:px-6 py-2 sm:py-3 rounded-xl bg-white/5 border border-white/10 text-white/70 font-semibold text-sm sm:text-base hover:bg-white/10 transition-all\"\n                onClick={onCancel}\n              >\n                Cancel\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return createPortal(overlay, portalElRef.current);\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport CameraView from \"./CameraView.js\";\nimport GameScoreboard from \"./scoreboards/GameScoreboard.js\";\nimport { useOnlineGameStats } from \"./scoreboards/useGameStats.js\";\nimport { useMatch } from \"../store/match.js\";\nimport { useMatchControl } from \"../store/matchControl.js\";\nimport { usePendingVisit } from \"../store/pendingVisit.js\";\nimport PauseTimerBadge from \"./ui/PauseTimerBadge.js\";\nimport PauseQuitModal from \"./ui/PauseQuitModal.js\";\nimport PauseOverlay from \"./ui/PauseOverlay.js\";\nimport { useUserSettings } from \"../store/userSettings.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport { suggestCheckouts, sayScore } from \"../utils/checkout.js\";\nimport { getPreferredUserName } from \"../utils/userName.js\";\nimport LetterboxScoreboardOverlay from \"./ui/LetterboxScoreboardOverlay.js\";\nimport { broadcastMessage } from \"../utils/broadcast.js\";\n\nexport default function InGameShell({\n  user,\n  showStartShowcase: showStartShowcaseProp,\n  onShowStartShowcaseChange,\n  onCommitVisit,\n  onQuit: onQuitProp,\n  onPause: onPauseProp,\n  onResume: onResumeProp,\n  onPauseDurationSelected: onPauseDurationSelectedProp,\n  onStateChange,\n  localPlayerIndexOverride,\n  gameModeOverride,\n  isOnline,\n}: {\n  user: any;\n  showStartShowcase?: boolean;\n  onShowStartShowcaseChange?: (open: boolean) => void;\n  /** Override default visit commit (for online WS sync). */\n  onCommitVisit?: (score: number, darts: number, meta?: any) => void;\n  /** Override default quit behaviour. */\n  onQuit?: () => void;\n  /** Override default pause behaviour (for online WS sync). */\n  onPause?: () => void;\n  /** Override default resume behaviour (for online WS sync). */\n  onResume?: () => void;\n  /** Called when pause duration is selected (for online WS sync). */\n  onPauseDurationSelected?: (minutes: number, endsAt: number) => void;\n  /** Called after any match state mutation for external sync. */\n  onStateChange?: () => void;\n  /** Explicit local player index for online (skips name matching). */\n  localPlayerIndexOverride?: number;\n  /** Override game mode label (e.g. online tracks currentGame separately). */\n  gameModeOverride?: string;\n  /** True when this is an online match â€” adds visual indicators. */\n  isOnline?: boolean;\n}) {\n  const match = useMatch();\n  useUserSettings((s: any) => s.hideInGameSidebar ?? true);\n  useMatchControl((s: any) => s.setPaused);\n  useMatchControl();\n  usePendingVisit();\n\n  const [winningShot, setWinningShot] = useState<{\n    label?: string;\n    ring?: string;\n    frame?: string | null;\n    ts?: number;\n  } | null>(null);\n  const [remoteFrame] = useState<string | null>(null);\n\n  const lastOfflineStart = useUserSettings(\n    (s: any) => s.lastOffline?.x01Start || 501,\n  );\n\n  const settingsUser = useUserSettings((s: any) => s.user);\n  const localPlayerName =\n    getPreferredUserName(user, \"\") ||\n    getPreferredUserName(settingsUser, \"\") ||\n    user?.email?.split(\"@\")[0] ||\n    settingsUser?.email?.split(\"@\")[0] ||\n    \"You\";\n\n  const resolvedLocalIndex =\n    typeof localPlayerIndexOverride === \"number\" &&\n    localPlayerIndexOverride >= 0\n      ? localPlayerIndexOverride\n      : (match.players || []).findIndex(\n          (p: any) => p?.name && p.name === localPlayerName,\n        );\n  const localPlayerIndex = resolvedLocalIndex >= 0 ? resolvedLocalIndex : 0;\n  const isUsersTurn = (match.currentPlayerIdx ?? 0) === localPlayerIndex;\n\n  const localPlayer = match.players?.[localPlayerIndex];\n  const localLeg = localPlayer?.legs?.[localPlayer.legs.length - 1];\n  const localRemaining =\n    localLeg?.totalScoreRemaining ?? match.startingScore ?? lastOfflineStart;\n  const awayIdx = (match.players || []).findIndex(\n    (_p: any, idx: number) => idx !== localPlayerIndex,\n  );\n  const awayPlayer = (match.players || [])[awayIdx >= 0 ? awayIdx : 0];\n  const awayLeg = awayPlayer?.legs?.[awayPlayer.legs.length - 1];\n  const awayRemaining =\n    awayLeg?.totalScoreRemaining ?? match.startingScore ?? lastOfflineStart;\n\n  // Compute per-player stats for hero banner (last visit, 3-dart average)\n  const playerStats = useMemo(() => {\n    const compute = (p: any) => {\n      if (!p) return { lastVisit: 0, avg3: 0 };\n      let pts = 0,\n        darts = 0;\n      for (const L of p.legs || []) {\n        pts += (L.totalScoreStart ?? 0) - (L.totalScoreRemaining ?? 0);\n        darts += (L.visits || []).reduce(\n          (a: number, v: any) => a + (v.darts || 0) - (v.preOpenDarts || 0),\n          0,\n        );\n      }\n      const lastV = (p.legs?.[p.legs.length - 1]?.visits || []).slice(-1)[0];\n      return {\n        lastVisit: lastV?.score ?? lastV?.visitTotal ?? 0,\n        avg3: darts > 0 ? (pts / darts) * 3 : 0,\n      };\n    };\n    return { local: compute(localPlayer), away: compute(awayPlayer) };\n  }, [\n    localPlayer,\n    awayPlayer,\n    localLeg?.visits?.length,\n    awayLeg?.visits?.length,\n  ]);\n\n  // Checkout suggestions for the current thrower (local or away)\n  const throwerRemaining = isUsersTurn ? localRemaining : awayRemaining;\n\n  const gameMode = gameModeOverride || (match as any)?.game || \"X01\";\n  const isX01 = gameMode === \"X01\";\n  const scoreboardPlayers = useOnlineGameStats(gameMode, match as any);\n\n  // Game-mode-aware hero display values for each player\n  const heroValues = useMemo(() => {\n    const forPlayer = (p: any, sbIdx: number) => {\n      const sb = scoreboardPlayers[sbIdx];\n      if (isX01) {\n        const leg = p?.legs?.[p.legs.length - 1];\n        return {\n          primary: String(\n            leg?.totalScoreRemaining ?? match.startingScore ?? lastOfflineStart,\n          ),\n          primaryLabel: \"Remaining\",\n        };\n      }\n      if (gameMode === \"Cricket\" || gameMode === \"American Cricket\") {\n        return {\n          primary: String(sb?.points ?? 0),\n          primaryLabel: \"Points\",\n        };\n      }\n      if (gameMode === \"Killer\") {\n        const lives = sb?.lives ?? 0;\n        return {\n          primary: sb?.eliminated ? \"OUT\" : String(lives),\n          primaryLabel: sb?.eliminated ? \"Eliminated\" : \"Lives\",\n        };\n      }\n      // Generic score-based games\n      return {\n        primary: String(sb?.score ?? sb?.points ?? 0),\n        primaryLabel: \"Score\",\n      };\n    };\n    return {\n      local: forPlayer(localPlayer, localPlayerIndex),\n      away: forPlayer(awayPlayer, awayIdx >= 0 ? awayIdx : 0),\n    };\n  }, [\n    isX01,\n    gameMode,\n    scoreboardPlayers,\n    localPlayer,\n    awayPlayer,\n    localPlayerIndex,\n    awayIdx,\n    match.startingScore,\n    lastOfflineStart,\n  ]);\n\n  const callerEnabled = useUserSettings((s: any) => s.callerEnabled);\n  const callerVoice = useUserSettings((s: any) => s.callerVoice);\n  const callerVolume = useUserSettings((s: any) => s.callerVolume);\n  const speakCheckoutOnly = useUserSettings((s: any) => s.speakCheckoutOnly);\n\n  const [showQuitPause, setShowQuitPause] = useState(false);\n  const setPaused = useMatchControl((s: any) => s.setPaused);\n  const paused = useMatchControl((s: any) => s.paused);\n  const pauseEndsAt = useMatchControl((s: any) => s.pauseEndsAt);\n  const pauseInitiator = useMatchControl((s: any) => s.pauseInitiator);\n  const [pauseNow, setPauseNow] = useState(Date.now());\n\n  // Signal the app shell to go full-screen on mobile while in-game\n  useEffect(() => {\n    document.documentElement.setAttribute(\"data-ndn-ingame\", \"true\");\n    return () => {\n      document.documentElement.removeAttribute(\"data-ndn-ingame\");\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!paused || !pauseEndsAt) return;\n    const t = setInterval(() => {\n      const now = Date.now();\n      setPauseNow(now);\n      if (now >= pauseEndsAt) {\n        setPaused(false, null);\n      }\n    }, 250);\n    return () => clearInterval(t);\n  }, [paused, pauseEndsAt, setPaused]);\n\n  const checkoutRoutes = useMemo(() => {\n    if (!isX01 || localRemaining > 170 || localRemaining <= 0) return null;\n    const routes = suggestCheckouts(localRemaining);\n    return routes && routes.length > 0 ? routes : null;\n  }, [isX01, localRemaining]);\n\n  // Checkout for the current thrower (shown in hero strip for both players)\n  const throwerCheckout = useMemo(() => {\n    if (!isX01 || throwerRemaining > 170 || throwerRemaining <= 0) return null;\n    const routes = suggestCheckouts(throwerRemaining);\n    return routes && routes.length > 0 ? routes : null;\n  }, [isX01, throwerRemaining]);\n\n  const numpadMax = isX01 ? 180 : 999;\n\n  const legsInfo = useMemo(() => {\n    const players = match.players || [];\n    return players.map((p: any) => ({\n      name: p.name || \"Player\",\n      legsWon: p.legsWon || 0,\n    }));\n  }, [match.players]);\n\n  const showStartShowcaseLocal =\n    typeof showStartShowcaseProp === \"boolean\" ? showStartShowcaseProp : true;\n  const setShowStartShowcase = (open: boolean) => {\n    onShowStartShowcaseChange?.(open);\n  };\n  const showcaseLockedOpenRef = useRef(true);\n  useEffect(() => {\n    if (!showcaseLockedOpenRef.current) return;\n    setShowStartShowcase(true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const [showNumpad, setShowNumpad] = useState(false);\n  const [numpadValue, setNumpadValue] = useState(\"\");\n  const numpadInputRef = useRef<HTMLInputElement>(null);\n\n  // Auto-focus the input when numpad opens\n  useEffect(() => {\n    if (showNumpad && numpadInputRef.current) {\n      numpadInputRef.current.focus();\n    }\n  }, [showNumpad]);\n\n  // Turn timer: tracks how long the opponent has been throwing\n  const [opponentTurnStart, setOpponentTurnStart] = useState<number | null>(\n    null,\n  );\n  const [opponentTurnElapsed, setOpponentTurnElapsed] = useState(0);\n\n  // Track when turn changes to start/stop timer\n  useEffect(() => {\n    if (!isUsersTurn) {\n      // Opponent's turn started\n      setOpponentTurnStart(Date.now());\n    } else {\n      // Our turn - reset\n      setOpponentTurnStart(null);\n      setOpponentTurnElapsed(0);\n    }\n  }, [isUsersTurn]);\n\n  // Update elapsed time every second when opponent is throwing\n  useEffect(() => {\n    if (!opponentTurnStart) return;\n    const interval = setInterval(() => {\n      setOpponentTurnElapsed(\n        Math.floor((Date.now() - opponentTurnStart) / 1000),\n      );\n    }, 1000);\n    return () => clearInterval(interval);\n  }, [opponentTurnStart]);\n\n  // Format seconds as mm:ss\n  const formatTurnTime = (seconds: number) => {\n    const mm = Math.floor(seconds / 60)\n      .toString()\n      .padStart(2, \"0\");\n    const ss = (seconds % 60).toString().padStart(2, \"0\");\n    return `${mm}:${ss}`;\n  };\n\n  const commitVisit = (score: number, darts: number, meta?: any) => {\n    if (onCommitVisit) {\n      onCommitVisit(score, darts, meta);\n      return;\n    }\n    const p = match.players?.[match.currentPlayerIdx];\n    const leg = p?.legs?.[p.legs.length - 1];\n    const prevRemaining = leg ? leg.totalScoreRemaining : match.startingScore;\n    const numericScore = typeof score === \"number\" ? score : 0;\n    let newRemaining = prevRemaining - numericScore;\n    if (!Number.isFinite(newRemaining) || newRemaining < 0) newRemaining = 0;\n\n    if (callerEnabled) {\n      const playerName = p?.name || getPreferredUserName(user, \"Player\");\n      try {\n        sayScore(playerName, numericScore, newRemaining, callerVoice, {\n          volume: callerVolume,\n          checkoutOnly: speakCheckoutOnly,\n        });\n      } catch {}\n    }\n\n    match.addVisit(numericScore, darts, meta ?? { visitTotal: numericScore });\n    if (newRemaining === 0) {\n      match.endLeg(numericScore);\n    } else {\n      match.nextPlayer();\n    }\n    onStateChange?.();\n  };\n\n  const deriveWinningLabel = useCallback(() => {\n    try {\n      const legs: Array<{ ts: number; visit?: any; player?: any }> = [];\n      (match.players || []).forEach((p: any) => {\n        (p.legs || []).forEach((leg: any) => {\n          if (leg?.finished) {\n            const lastVisit = (leg.visits || []).slice(-1)[0];\n            legs.push({\n              ts: leg.endTime || Date.now(),\n              visit: lastVisit,\n              player: p,\n            });\n          }\n        });\n      });\n      if (!legs.length) return null;\n      const latest = legs.sort((a, b) => b.ts - a.ts)[0];\n      const entry = (latest.visit?.entries || []).slice(-1)[0];\n      if (entry?.label) return entry.label as string;\n      if (entry?.ring === \"DOUBLE\" && typeof entry?.value === \"number\")\n        return `Double ${entry.value / 2}`;\n      if (typeof latest.visit?.visitTotal === \"number\")\n        return `Checkout ${latest.visit.visitTotal}`;\n    } catch {}\n    return null;\n  }, [match.players]);\n\n  useEffect(() => {\n    if (match.inProgress) {\n      setWinningShot(null);\n      return;\n    }\n    if (!winningShot?.label) {\n      const derived = deriveWinningLabel();\n      if (derived) setWinningShot((prev) => ({ ...prev, label: derived }));\n    }\n  }, [match.inProgress, deriveWinningLabel, winningShot?.label]);\n\n  return (\n    <div className=\"card ndn-game-shell ndn-page ndn-ingame-active relative overflow-hidden md:overflow-hidden overflow-y-auto pb-20\">\n      {/* â”€â”€ Ambient background glow â”€â”€ */}\n      <div className=\"pointer-events-none absolute inset-0 overflow-hidden\">\n        <div className=\"absolute -top-32 -left-32 w-96 h-96 rounded-full bg-indigo-600/10 blur-[120px]\" />\n        <div className=\"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-amber-500/8 blur-[120px]\" />\n      </div>\n\n      {showStartShowcaseLocal && (\n        <MatchStartShowcase\n          open={showStartShowcaseLocal}\n          players={(match.players || []) as any}\n          onDone={() => {\n            showcaseLockedOpenRef.current = false;\n            setShowStartShowcase(false);\n          }}\n          onRequestClose={() => {\n            showcaseLockedOpenRef.current = false;\n            setShowStartShowcase(false);\n          }}\n          showCalibrationDefault={true}\n        />\n      )}\n\n      {/* â”€â”€ Premium sticky header â”€â”€ */}\n      <div className=\"sticky top-0 z-20 mb-3\">\n        <div className=\"relative flex items-center justify-between gap-2 px-3 sm:px-5 py-2.5 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg\">\n          <div className=\"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-indigo-500/10 via-transparent to-amber-500/10\" />\n          <div className=\"flex items-center gap-3 text-sm leading-none z-10\">\n            {isOnline && (\n              <span className=\"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-[10px] sm:text-xs font-semibold tracking-wide\">\n                ğŸŒ Online\n              </span>\n            )}\n            <span className=\"px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-xs font-semibold tracking-wide\">\n              {gameMode}\n              {isX01 ? ` / ${match.startingScore || lastOfflineStart}` : \"\"}\n            </span>\n            {legsInfo.length >= 2 && (\n              <span className=\"font-bold text-white/90 text-sm tabular-nums\">\n                Legs: {legsInfo[0].legsWon} â€“ {legsInfo[1].legsWon}\n              </span>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2 z-10\">\n            <PauseTimerBadge />\n            <button\n              className=\"px-4 py-1.5 rounded-xl text-sm font-semibold bg-rose-600/90 hover:bg-rose-500 text-white border border-rose-400/30 shadow-lg shadow-rose-500/20 transition-all\"\n              onClick={() => setShowQuitPause(true)}\n            >\n              â¸ Quit / Pause\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* â”€â”€ Hero scoreboard banner â€” big remaining scores â”€â”€ */}\n      <div className=\"relative mb-4 rounded-2xl border border-white/10 overflow-hidden\">\n        {/* Gradient backdrop */}\n        <div className=\"absolute inset-0 bg-gradient-to-r from-indigo-950/80 via-slate-900/90 to-amber-950/80\" />\n        <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(255,255,255,0.03),transparent_70%)]\" />\n\n        <div className=\"relative grid grid-cols-[minmax(0,1fr)_minmax(120px,auto)_minmax(0,1fr)] items-center py-4 sm:py-6 px-3 sm:px-8\">\n          {/* Player 1 (local) */}\n          <div className=\"flex flex-col items-center gap-1\">\n            <div\n              className={`text-xs sm:text-sm font-bold uppercase tracking-widest ${isUsersTurn ? \"text-emerald-400\" : \"text-slate-400\"}`}\n            >\n              {localPlayer?.name || \"You\"}\n            </div>\n            <div className=\"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium\">\n              {heroValues.local.primaryLabel}\n            </div>\n            <div\n              className={`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${isUsersTurn ? \"text-white\" : \"text-white/60\"}`}\n            >\n              {heroValues.local.primary}\n            </div>\n            {isUsersTurn ? (\n              <div className=\"mt-1 px-3 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/40 text-emerald-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse\">\n                â— Throwing\n              </div>\n            ) : (\n              <div\n                className=\"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible\"\n                aria-hidden\n              >\n                â— &nbsp;\n              </div>\n            )}\n            <div className=\"flex items-center gap-3 mt-1\">\n              {isX01 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\n                  Legs: {localPlayer?.legsWon || 0}\n                </div>\n              )}\n              {playerStats.local.avg3 > 0 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\n                  Avg: {playerStats.local.avg3.toFixed(1)}\n                </div>\n              )}\n              {playerStats.local.lastVisit > 0 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-500 tabular-nums\">\n                  Last: {playerStats.local.lastVisit}\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Centre divider â€” VS + Online score box */}\n          <div className=\"flex flex-col items-center gap-2 px-2 sm:px-4 min-w-[120px]\">\n            <div className=\"flex flex-col items-center gap-1\">\n              <div className=\"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent\" />\n              <div className=\"text-xs sm:text-lg font-black text-white/30 tracking-widest\">\n                VS\n              </div>\n              <div className=\"w-px h-6 sm:h-10 bg-gradient-to-b from-transparent via-white/20 to-transparent\" />\n            </div>\n            {isOnline && (\n              <button\n                type=\"button\"\n                className={`w-full rounded-xl border px-3 py-2 text-center transition-all ${\n                  isUsersTurn\n                    ? \"bg-emerald-500/15 border-emerald-400/30 text-emerald-100 hover:bg-emerald-500/25\"\n                    : \"bg-white/5 border-white/10 text-white/40 cursor-not-allowed\"\n                }`}\n                onClick={() => {\n                  if (!isUsersTurn) return;\n                  setNumpadValue(\"\");\n                  setShowNumpad(true);\n                }}\n                disabled={!isUsersTurn}\n              >\n                <div className=\"text-[9px] sm:text-[10px] uppercase tracking-widest font-semibold opacity-80\">\n                  {isUsersTurn ? \"Enter Score\" : \"Waiting\"}\n                </div>\n                <div className=\"font-mono text-2xl sm:text-3xl font-black tabular-nums\">\n                  {isUsersTurn ? \"Tap\" : \"â€”\"}\n                </div>\n                <div className=\"text-[9px] sm:text-[10px] uppercase tracking-wider opacity-70\">\n                  {isUsersTurn ? \"Open Numpad\" : \"Opponent Turn\"}\n                </div>\n              </button>\n            )}\n          </div>\n\n          {/* Player 2 (away) */}\n          <div className=\"flex flex-col items-center gap-1\">\n            <div\n              className={`text-xs sm:text-sm font-bold uppercase tracking-widest ${!isUsersTurn ? \"text-amber-400\" : \"text-slate-400\"}`}\n            >\n              {awayPlayer?.name || \"Opponent\"}\n            </div>\n            <div className=\"text-[10px] sm:text-xs uppercase tracking-wider text-slate-500 font-medium\">\n              {heroValues.away.primaryLabel}\n            </div>\n            <div\n              className={`font-mono text-5xl sm:text-7xl md:text-8xl font-black tabular-nums leading-none ${!isUsersTurn ? \"text-white\" : \"text-white/60\"}`}\n            >\n              {heroValues.away.primary}\n            </div>\n            {!isUsersTurn ? (\n              <div className=\"mt-1 px-3 py-0.5 rounded-full bg-amber-500/20 border border-amber-400/40 text-amber-300 text-[10px] sm:text-xs font-semibold uppercase tracking-wider animate-pulse\">\n                â— Throwing\n              </div>\n            ) : (\n              <div\n                className=\"mt-1 px-3 py-0.5 text-[10px] sm:text-xs invisible\"\n                aria-hidden\n              >\n                â— &nbsp;\n              </div>\n            )}\n            <div className=\"flex items-center gap-3 mt-1\">\n              {isX01 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\n                  Legs: {awayPlayer?.legsWon || 0}\n                </div>\n              )}\n              {playerStats.away.avg3 > 0 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-400 tabular-nums\">\n                  Avg: {playerStats.away.avg3.toFixed(1)}\n                </div>\n              )}\n              {playerStats.away.lastVisit > 0 && (\n                <div className=\"text-[10px] sm:text-xs text-slate-500 tabular-nums\">\n                  Last: {playerStats.away.lastVisit}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Checkout suggestion strip â€” shows for whoever is currently throwing */}\n        {throwerCheckout && (\n          <div\n            className={`relative border-t px-4 py-2 flex items-center gap-3 ${\n              isUsersTurn\n                ? \"border-emerald-400/20 bg-emerald-500/10\"\n                : \"border-amber-400/20 bg-amber-500/10\"\n            }`}\n          >\n            <span\n              className={`text-[10px] sm:text-xs uppercase tracking-wider font-semibold whitespace-nowrap ${\n                isUsersTurn ? \"text-emerald-300/80\" : \"text-amber-300/80\"\n              }`}\n            >\n              Checkout {throwerRemaining}:\n            </span>\n            <div className=\"flex flex-wrap gap-1.5\">\n              {throwerCheckout.map((route: string, i: number) => (\n                <span\n                  key={i}\n                  className={`px-2 py-0.5 rounded-lg text-xs sm:text-sm font-medium ${\n                    isUsersTurn\n                      ? \"bg-emerald-500/20 border border-emerald-400/20 text-emerald-100\"\n                      : \"bg-amber-500/20 border border-amber-400/20 text-amber-100\"\n                  }`}\n                >\n                  {route}\n                </span>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* â”€â”€ Main content â€” context-sensitive layout â”€â”€ */}\n      <div className=\"ndn-shell-body\">\n        {/* â”€â”€â”€â”€â”€ OPPONENT'S TURN: Camera + Scoreboard (spectator view) â”€â”€â”€â”€â”€ */}\n        {!isUsersTurn && (\n          <div className=\"flex flex-col gap-3\">\n            {/* Camera â€” full width, prominent */}\n            <div className=\"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 overflow-hidden\">\n              <div className=\"flex items-center justify-between px-3 py-2 border-b border-white/5 bg-white/5\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-2 h-2 rounded-full bg-amber-400 shadow-lg shadow-amber-400/50 animate-pulse\" />\n                  <span className=\"text-xs sm:text-sm font-semibold text-white/80\">\n                    Opponent&apos;s Camera\n                  </span>\n                </div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-amber-300\">\n                  Waiting for {awayPlayer?.name || \"opponent\"}&hellip;\n                </span>\n              </div>\n              <div className=\"relative min-h-[12rem] max-h-[50vh] bg-black\">\n                <CameraView hideInlinePanels={true} forceAutoStart={true} />\n                {isX01 && (\n                  <LetterboxScoreboardOverlay\n                    checkoutRemaining={localRemaining}\n                    away={{\n                      side: \"Away\",\n                      name: awayPlayer?.name || \"Away\",\n                      legsWon: awayPlayer?.legsWon || 0,\n                      remaining: awayRemaining,\n                    }}\n                    home={{\n                      side: \"Home\",\n                      name: localPlayer?.name || \"Home\",\n                      legsWon: localPlayer?.legsWon || 0,\n                      remaining: localRemaining,\n                    }}\n                  />\n                )}\n              </div>\n            </div>\n\n            {/* Scoreboard â€” full width */}\n            <div className=\"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden\">\n              <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-br from-white/[0.02] to-transparent\" />\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-sm sm:text-base font-bold text-white/90 tracking-wide\">\n                  Scoreboard\n                </h3>\n                <div className=\"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-amber-500/20 border border-amber-400/30 text-amber-300\">\n                  {awayPlayer?.name || \"Opponent\"}&apos;s turn\n                </div>\n              </div>\n              <GameScoreboard gameMode={gameMode} players={scoreboardPlayers} />\n            </div>\n          </div>\n        )}\n\n        {/* â”€â”€â”€â”€â”€ YOUR TURN: Scoreboard + Score Entry Box â”€â”€â”€â”€â”€ */}\n        {isUsersTurn && (\n          <div className=\"flex flex-col gap-3\">\n            {/* Scoreboard â€” full width */}\n            <div className=\"relative rounded-2xl border border-white/10 bg-slate-950/70 shadow-2xl ring-1 ring-white/5 p-3 sm:p-4 overflow-hidden\">\n              <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-br from-emerald-500/[0.03] to-transparent\" />\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-sm sm:text-base font-bold text-white/90 tracking-wide\">\n                  Scoreboard\n                </h3>\n                <div className=\"px-3 py-1 rounded-full text-[10px] sm:text-xs font-semibold bg-emerald-500/20 border border-emerald-400/30 text-emerald-300 animate-pulse\">\n                  â— Your turn\n                </div>\n              </div>\n              <GameScoreboard gameMode={gameMode} players={scoreboardPlayers} />\n            </div>\n\n            {/* Score Entry Box â€” tappable card that opens the numpad */}\n            <button\n              type=\"button\"\n              className=\"relative w-full rounded-2xl border-2 border-dashed border-emerald-400/40 bg-emerald-500/5 hover:bg-emerald-500/10 active:scale-[0.98] transition-all p-6 sm:p-8 text-center group cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-400/50\"\n              onClick={() => {\n                setNumpadValue(\"\");\n                setShowNumpad(true);\n              }}\n            >\n              <div className=\"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-br from-emerald-500/[0.05] to-transparent\" />\n              <div className=\"text-emerald-300/60 text-xs sm:text-sm uppercase tracking-widest font-semibold mb-2\">\n                Enter Score\n              </div>\n              <div className=\"font-mono text-4xl sm:text-5xl font-black text-emerald-200 group-hover:text-emerald-100 transition-colors\">\n                {heroValues.local.primary}\n              </div>\n              <div className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 text-sm font-semibold\">\n                <svg\n                  className=\"w-4 h-4\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                  strokeWidth={2}\n                >\n                  <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" />\n                  <path\n                    d=\"M8 8h.01M12 8h.01M16 8h.01M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 16h.01M16 16h.01\"\n                    strokeLinecap=\"round\"\n                  />\n                </svg>\n                Tap to enter score\n              </div>\n              {checkoutRoutes && (\n                <div className=\"mt-3 flex flex-wrap justify-center gap-1.5\">\n                  {checkoutRoutes.map((route: string, i: number) => (\n                    <span\n                      key={i}\n                      className=\"px-2 py-0.5 rounded-lg bg-emerald-500/20 border border-emerald-400/20 text-emerald-100 text-xs font-medium\"\n                    >\n                      {route}\n                    </span>\n                  ))}\n                </div>\n              )}\n            </button>\n\n            {/* Quick score buttons row */}\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              {(isX01\n                ? [180, 140, 100, 85, 60, 45, 26, 0]\n                : [100, 80, 60, 45, 26, 20, 10, 0]\n              ).map((v) => (\n                <button\n                  key={v}\n                  className=\"px-4 py-2.5 rounded-xl text-sm font-bold bg-white/5 hover:bg-white/10 active:bg-white/15 border border-white/10 text-white/90 transition-all active:scale-95\"\n                  onClick={() => commitVisit(v, 3, { visitTotal: v })}\n                >\n                  {v}\n                </button>\n              ))}\n            </div>\n\n            {/* Winning shot banner */}\n            {winningShot?.label && (\n              <div className=\"rounded-2xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 text-center\">\n                <span className=\"text-xs text-emerald-400/70 uppercase tracking-wider font-semibold\">\n                  {isX01 ? \"Winning Double\" : \"Winning Shot\"}\n                </span>\n                <div className=\"text-lg font-bold text-emerald-200 mt-0.5\">\n                  {winningShot.label}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* â”€â”€ Number Pad Modal â”€â”€ */}\n      {showNumpad && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center\"\n          onClick={() => setShowNumpad(false)}\n          onKeyDown={(e) => {\n            if (e.key === \"Escape\") {\n              setShowNumpad(false);\n            }\n          }}\n        >\n          {/* Backdrop */}\n          <div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" />\n          {/* Panel */}\n          <div\n            className=\"relative w-full max-w-sm mx-auto mb-0 sm:mb-0 rounded-t-3xl sm:rounded-3xl border border-white/10 bg-slate-900/95 backdrop-blur-xl shadow-2xl p-4 sm:p-6 animate-[slideUp_0.2s_ease-out]\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Score input field â€” typeable on both mobile and PC */}\n            <div className=\"mb-4 rounded-2xl bg-black/40 border border-white/10 p-4 text-center\">\n              <div className=\"text-[10px] uppercase tracking-widest text-slate-400 mb-1\">\n                Score\n              </div>\n              {/* Score input â€” auto-focused via useEffect */}\n              <input\n                ref={numpadInputRef}\n                type=\"number\"\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n                className=\"w-full bg-transparent font-mono text-5xl sm:text-6xl font-black text-white tabular-nums min-h-[3.5rem] leading-none text-center outline-none border-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/20\"\n                placeholder=\"0\"\n                value={numpadValue}\n                onChange={(e) => {\n                  const raw = e.target.value.replace(/[^0-9]/g, \"\");\n                  if (raw === \"\" || Number(raw) <= numpadMax) {\n                    setNumpadValue(raw);\n                  }\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") {\n                    e.preventDefault();\n                    const score = Math.max(\n                      0,\n                      Math.min(numpadMax, Number(numpadValue) || 0),\n                    );\n                    commitVisit(score, 3, { visitTotal: score });\n                    setNumpadValue(\"\");\n                    setShowNumpad(false);\n                  }\n                }}\n              />\n              {numpadValue &&\n                checkoutRoutes &&\n                Number(numpadValue) === localRemaining && (\n                  <div className=\"mt-2 text-xs text-emerald-300 font-semibold\">\n                    âœ“ Checkout!\n                  </div>\n                )}\n            </div>\n\n            {/* Numpad grid */}\n            <div className=\"grid grid-cols-3 gap-2 mb-3\">\n              {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((n) => (\n                <button\n                  key={n}\n                  className=\"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95\"\n                  onClick={() => {\n                    const next = numpadValue + String(n);\n                    if (Number(next) <= numpadMax) setNumpadValue(next);\n                    numpadInputRef.current?.focus();\n                  }}\n                >\n                  {n}\n                </button>\n              ))}\n              {/* Bottom row: backspace, 0, submit */}\n              <button\n                className=\"py-3.5 rounded-xl text-lg font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white/60 transition-all active:scale-95\"\n                onClick={() => {\n                  setNumpadValue((v) => v.slice(0, -1));\n                  numpadInputRef.current?.focus();\n                }}\n              >\n                âŒ«\n              </button>\n              <button\n                className=\"py-3.5 rounded-xl text-xl font-bold bg-white/5 hover:bg-white/10 active:bg-white/20 border border-white/10 text-white transition-all active:scale-95\"\n                onClick={() => {\n                  const next = numpadValue + \"0\";\n                  if (Number(next) <= numpadMax) setNumpadValue(next);\n                  numpadInputRef.current?.focus();\n                }}\n              >\n                0\n              </button>\n              <button\n                className=\"py-3.5 rounded-xl text-lg font-bold bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border border-emerald-400/30 text-white shadow-lg shadow-emerald-600/30 transition-all active:scale-95\"\n                onClick={() => {\n                  const score = Math.max(\n                    0,\n                    Math.min(numpadMax, Number(numpadValue) || 0),\n                  );\n                  commitVisit(score, 3, { visitTotal: score });\n                  setNumpadValue(\"\");\n                  setShowNumpad(false);\n                }}\n              >\n                âœ“\n              </button>\n            </div>\n\n            {/* Quick buttons inside numpad */}\n            <div className=\"flex flex-wrap gap-2 justify-center mb-3\">\n              {(isX01\n                ? [180, 140, 100, 85, 60, 45, 26, 0]\n                : [100, 80, 60, 45, 26, 20, 10, 0]\n              ).map((v) => (\n                <button\n                  key={v}\n                  className=\"px-3 py-1.5 rounded-lg text-xs font-bold bg-white/5 hover:bg-white/10 border border-white/10 text-white/80 transition-all active:scale-95\"\n                  onClick={() => {\n                    commitVisit(v, 3, { visitTotal: v });\n                    setNumpadValue(\"\");\n                    setShowNumpad(false);\n                  }}\n                >\n                  {v}\n                </button>\n              ))}\n            </div>\n\n            {/* Cancel */}\n            <button\n              className=\"w-full py-2.5 rounded-xl text-sm font-semibold text-white/50 hover:text-white/80 hover:bg-white/5 transition-all\"\n              onClick={() => setShowNumpad(false)}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* â”€â”€ Fixed bottom score input bar (always visible) â”€â”€ */}\n      {!showNumpad && !showQuitPause && !paused && (\n        <div className=\"fixed bottom-0 left-0 right-0 z-30 bg-slate-900/95 backdrop-blur-xl border-t border-white/10 px-3 py-2 safe-bottom\">\n          <div className=\"flex items-center gap-2 max-w-lg mx-auto\">\n            <input\n              type=\"number\"\n              inputMode=\"numeric\"\n              pattern=\"[0-9]*\"\n              className={`flex-1 border rounded-xl px-4 py-3 font-mono text-xl font-bold text-center outline-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none placeholder:text-white/30 ${\n                isUsersTurn\n                  ? \"bg-white/5 border-white/15 text-white focus:border-emerald-400/50 focus:ring-1 focus:ring-emerald-400/30\"\n                  : \"bg-white/3 border-white/10 text-white/50\"\n              }`}\n              placeholder={isUsersTurn ? \"Type score...\" : \"Waiting for opponent...\"}\n              value={numpadValue}\n              disabled={!isUsersTurn}\n              onChange={(e) => {\n                const raw = e.target.value.replace(/[^0-9]/g, \"\");\n                if (raw === \"\" || Number(raw) <= numpadMax) {\n                  setNumpadValue(raw);\n                }\n              }}\n              onKeyDown={(e) => {\n                if (e.key === \"Enter\") {\n                  e.preventDefault();\n                  const score = Math.max(\n                    0,\n                    Math.min(numpadMax, Number(numpadValue) || 0),\n                  );\n                  if (numpadValue !== \"\") {\n                    commitVisit(score, 3, { visitTotal: score });\n                    setNumpadValue(\"\");\n                  }\n                }\n              }}\n            />\n            <button\n              className={`px-5 py-3 rounded-xl text-sm font-bold text-white border transition-all active:scale-95 whitespace-nowrap ${\n                isUsersTurn && numpadValue !== \"\"\n                  ? \"bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-400 border-emerald-400/30 shadow-lg shadow-emerald-600/20\"\n                  : \"bg-slate-700 border-white/10 opacity-50 cursor-not-allowed\"\n              }`}\n              disabled={!isUsersTurn || numpadValue === \"\"}\n              onClick={() => {\n                const score = Math.max(\n                  0,\n                  Math.min(numpadMax, Number(numpadValue) || 0),\n                );\n                commitVisit(score, 3, { visitTotal: score });\n                setNumpadValue(\"\");\n              }}\n            >\n              Submit\n            </button>\n            {isUsersTurn && (\n              <button\n                className=\"px-3 py-3 rounded-xl text-sm font-semibold bg-white/5 hover:bg-white/10 text-white/70 border border-white/10 transition-all\"\n                onClick={() => {\n                  setNumpadValue(\"\");\n                  setShowNumpad(true);\n                }}\n              >\n                âŒ¨\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* â”€â”€ Quit / Pause modal â”€â”€ */}\n      {showQuitPause && (\n        <PauseQuitModal\n          onClose={() => setShowQuitPause(false)}\n          onQuit={() => {\n            setShowQuitPause(false);\n            if (onQuitProp) {\n              onQuitProp();\n            } else {\n              try {\n                match.endGame();\n              } catch {}\n              try {\n                window.dispatchEvent(new Event(\"ndn:match-quit\"));\n              } catch {}\n            }\n          }}\n          onPause={() => {\n            try {\n              setPaused(true, null, localPlayerName);\n            } catch {}\n            try {\n              broadcastMessage({\n                type: \"pause\",\n                pauseStartedAt: Date.now(),\n                pauseInitiator: localPlayerName,\n              });\n            } catch {}\n            // Notify opponent via WS (online matches)\n            if (onPauseProp) onPauseProp();\n            setShowQuitPause(false);\n          }}\n        />\n      )}\n\n      <PauseOverlay\n        localPlayerName={localPlayerName}\n        onResume={() => {\n          setPaused(false, null);\n          try {\n            broadcastMessage({ type: \"unpause\" });\n          } catch {}\n          // Notify opponent via WS (online matches)\n          if (onResumeProp) onResumeProp();\n        }}\n        onDurationSelected={(minutes, endsAt) => {\n          // Notify opponent via WS when duration is selected (online matches)\n          if (onPauseDurationSelectedProp)\n            onPauseDurationSelectedProp(minutes, endsAt);\n        }}\n      />\n    </div>\n  );\n}\n","import React, { useState, useMemo, useEffect, useRef } from \"react\";\nimport {\n  Search,\n  Zap,\n  Target,\n  Trophy,\n  Users,\n  Clock,\n  ChevronDown,\n} from \"lucide-react\";\nimport CreateMatchModal from \"./ui/CreateMatchModal.js\";\nimport MatchStartShowcase from \"./ui/MatchStartShowcase.js\";\nimport MatchPrestart from \"./ui/MatchPrestart.js\";\nimport InGameShell from \"./InGameShell.js\";\nimport { useMatch } from \"../store/match.js\";\nimport { useMatchControl } from \"../store/matchControl.js\";\nimport { useWS } from \"./WSProvider.js\";\nimport { launchInPlayDemo } from \"../utils/inPlayDemo.js\";\nimport { openMatchWindow } from \"../utils/matchWindow.js\";\n\nexport default function OnlinePlayClean({ user }: { user?: any }) {\n  const username = user?.username || \"You\";\n  const [currentRoomIdx, setCurrentRoomIdx] = useState(0);\n  const [rooms, setRooms] = useState(() => [\n    { id: 1, name: \"room-1\", matches: [] as any[] },\n  ]);\n  const wsGlobal = (() => {\n    try {\n      return useWS();\n    } catch {\n      return null;\n    }\n  })();\n  const [serverMatches, setServerMatches] = useState<any[]>([]);\n  const inProgress = useMatch((s) => s.inProgress);\n  const players = useMatch((s) => s.players);\n  const [focusMode, setFocusMode] = useState(false);\n  const matchesRef = useRef<HTMLDivElement | null>(null);\n  const showDemoControls =\n    (import.meta as any).env?.DEV ||\n    String(user?.email || \"\").toLowerCase() === \"daviesfamily108@gmail.com\";\n\n  useEffect(() => {\n    if (!focusMode) return;\n    function onDocClick(e: MouseEvent) {\n      try {\n        if (!matchesRef.current) return;\n        if (!matchesRef.current.contains(e.target as Node)) {\n          setFocusMode(false);\n        }\n      } catch {}\n    }\n    document.addEventListener(\"mousedown\", onDocClick);\n    return () => document.removeEventListener(\"mousedown\", onDocClick);\n  }, [focusMode]);\n  const [showStartShowcase, setShowStartShowcase] = useState<boolean>(false);\n  const startedShowcasedRef = React.useRef(false);\n  useEffect(() => {\n    if (!inProgress) return;\n    if (startedShowcasedRef.current) return;\n    startedShowcasedRef.current = true;\n    setShowStartShowcase(true);\n  }, [inProgress]);\n\n  // Auto-open the dedicated match window for online X01 matches.\n  useEffect(() => {\n    if (!inProgress) return;\n    try {\n      const st = useMatch.getState();\n      const game = ((st as any)?.game || \"X01\") as string;\n      if (game !== \"X01\") return;\n      if (!st.roomId) return;\n\n      const flagKey = `ndn:matchWindowOpened:${st.roomId}`;\n      if (window.sessionStorage.getItem(flagKey) === \"1\") return;\n      window.sessionStorage.setItem(flagKey, \"1\");\n      openMatchWindow();\n    } catch {}\n  }, [inProgress]);\n\n  // Allow the overlay to show again the next time a match starts.\n  useEffect(() => {\n    if (inProgress) return;\n    startedShowcasedRef.current = false;\n  }, [inProgress]);\n\n  // Announce presence to server so it knows our username\n  useEffect(() => {\n    if (wsGlobal?.connected && user?.username) {\n      try {\n        wsGlobal.send({\n          type: \"presence\",\n          username: user.username,\n          email: user.email || \"\",\n        });\n      } catch {}\n    }\n  }, [wsGlobal?.connected, user]);\n\n  // Signal to App.tsx that OnlinePlay is mounted so it doesn't double-dispatch\n  // invite/prestart events (OnlinePlay's own WS listener handles them directly)\n  useEffect(() => {\n    (window as any).__ndn_online_mounted = true;\n    return () => {\n      (window as any).__ndn_online_mounted = false;\n    };\n  }, []);\n\n  // Global quit handler (from CameraView Quit / Pause modal)\n  useEffect(() => {\n    const onQuit = () => {\n      try {\n        useMatch.getState().endGame();\n      } catch (e) {}\n      // Clear all prestart / invite state to prevent phantom popups\n      setPendingInvite(null);\n      setWaitingForCreator(null);\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setOpponentQuitName(null);\n      pendingMatchRef.current = null;\n      try {\n        (window as any).__ndn_pending_invite = null;\n      } catch {}\n    };\n    try {\n      window.addEventListener(\"ndn:match-quit\" as any, onQuit as any);\n    } catch {}\n    return () => {\n      try {\n        window.removeEventListener(\"ndn:match-quit\" as any, onQuit as any);\n      } catch {}\n    };\n  }, []);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [joinMatch, setJoinMatch] = useState<any | null>(null);\n  const joinAcceptRef = React.useRef<HTMLButtonElement | null>(null);\n  // Incoming invite popup: shown to the creator when a joiner wants to join\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null);\n  // Waiting state: shown to the joiner while waiting for the creator to accept\n  const [waitingForCreator, setWaitingForCreator] = useState<string | null>(\n    null,\n  );\n  // Preserve match info across handleJoinAccept â†’ match-start gap\n  // (handleJoinAccept clears joinMatch before the server sends match-start)\n  const pendingMatchRef = useRef<any | null>(null);\n  const [_selfId, setSelfId] = useState<string | null>(null);\n  const [participants, setParticipants] = useState<Record<string, string>>({});\n  const [joinTimer, setJoinTimer] = useState(30);\n  // Keep latest matches in a ref so the WS listener can update synchronously\n  // for tests (avoids a stale closure / async state timing issue).\n  const serverMatchesRef = useRef<any[]>([]);\n  useEffect(() => {\n    serverMatchesRef.current = serverMatches || [];\n  }, [serverMatches]);\n  // Keep pendingMatchRef in sync with joinMatch so the WS listener\n  // (which has a stale closure over joinMatch) can always read current data.\n  useEffect(() => {\n    if (joinMatch) pendingMatchRef.current = { ...joinMatch };\n  }, [joinMatch]);\n  const serverPrestartRef = React.useRef(false);\n  const [joinChoice, setJoinChoice] = useState<null | \"bull\" | \"skip\">(null);\n  const [remoteChoices, setRemoteChoices] = useState<\n    Record<string, \"bull\" | \"skip\">\n  >({});\n  const [bullActive, setBullActive] = useState(false);\n  const [bullThrow, setBullThrow] = useState<number | null>(null);\n  const [bullWinner, setBullWinner] = useState<string | null>(null);\n  const [bullLocalThrow, setBullLocalThrow] = useState<number | null>(null);\n  const [bullThrown, setBullThrown] = useState(false);\n  const [bullTied, setBullTied] = useState(false);\n  // Opponent quit notification â€” shown when the remote player leaves mid-match\n  const [opponentQuitName, setOpponentQuitName] = useState<string | null>(null);\n\n  // Filter & Sort State\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterGame, setFilterGame] = useState<\n    \"all\" | \"x01\" | \"cricket\" | \"bermuda\" | \"gotcha\"\n  >(\"all\");\n  const [filterMode, setFilterMode] = useState<\"all\" | \"first_to\" | \"best_of\">(\n    \"all\",\n  );\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\">(\"newest\");\n\n  // Pagination State\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 16;\n\n  const currentRoom = rooms[currentRoomIdx];\n  // NOTE: This is a *UX* hint for when to show a \"room is full\" message.\n  // We do not hard-cap rendering at this number (tests and pagination rely on\n  // the full list being renderable).\n  const maxMatchesPerRoom = 999;\n\n  const normalizeMatch = React.useCallback((m: any) => {\n    if (!m) return m;\n    const modeType = m.modeType || m.mode || \"\";\n    const legs = m.legs ?? m.value ?? m.bestOf ?? m.sets ?? m.games ?? 1;\n    const createdBy = m.createdBy || m.creatorName || m.creator || m.host || \"\";\n    const createdAt = m.createdAt || m.ts || Date.now();\n\n    return {\n      ...m,\n      modeType,\n      mode: modeType || m.mode,\n      legs,\n      value: typeof m.value === \"number\" ? m.value : legs,\n      createdBy,\n      creatorName: m.creatorName || createdBy,\n      createdAt,\n    };\n  }, []);\n\n  const filterMatches = useMemo(() => {\n    return (list: any[] = []) =>\n      (list || [])\n        .map(normalizeMatch)\n        .filter(\n          (m: any) =>\n            !(\n              m?.isTest ||\n              m?.test ||\n              m?.migrated ||\n              m?.isMigration ||\n              m?.migration ||\n              m?.seeded ||\n              (typeof m?.createdBy === \"string\" &&\n                m.createdBy.toLowerCase().includes(\"test\")) ||\n              (typeof m?.creatorName === \"string\" &&\n                m.creatorName.toLowerCase().includes(\"test\")) ||\n              (typeof m?.createdBy === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.createdBy)) ||\n              (typeof m?.creatorName === \"string\" &&\n                /^(alice-|host-|demo|dummy|sample)/i.test(m.creatorName)) ||\n              !(m?.game && m?.modeType && m?.legs)\n            ),\n        );\n    // NOTE: do NOT hard-cap here; tests and pagination expect the full\n    // list to render (page size controls how many are visible).\n  }, [normalizeMatch]);\n\n  // NOTE: worldLobby was previously used for an alternate lobby view; keep the\n  // computation removed to avoid unused-vars warnings.\n\n  // Combined matches: show only current room, filtered\n  const combinedMatches = useMemo(() => {\n    let all = filterMatches(currentRoom?.matches || []);\n\n    // In WS-driven mode, serverMatches is the canonical list. Fall back to it\n    // if the current room hasn't been hydrated yet.\n    if ((all?.length || 0) === 0 && (serverMatches?.length || 0) > 0) {\n      all = filterMatches(serverMatches);\n    }\n\n    // Last-resort fallback for test environments where state updates are\n    // async and the memo can run before serverMatches is visible.\n    if (\n      (all?.length || 0) === 0 &&\n      (serverMatchesRef.current?.length || 0) > 0\n    ) {\n      all = filterMatches(serverMatchesRef.current);\n    }\n\n    // 1. Search\n    if (searchQuery.trim()) {\n      const q = searchQuery.toLowerCase();\n      all = all.filter(\n        (m: any) =>\n          (m.game || \"\").toLowerCase().includes(q) ||\n          (m.createdBy || m.creatorName || \"\").toLowerCase().includes(q) ||\n          (m.id || \"\").toLowerCase().includes(q),\n      );\n    }\n\n    // 2. Filter Game\n    if (filterGame !== \"all\") {\n      all = all.filter((m: any) => (m.game || \"\").toLowerCase() === filterGame);\n    }\n\n    // 3. Filter Mode\n    if (filterMode !== \"all\") {\n      // normalize modeType. Some might be 'first_to' or 'bestof'\n      all = all.filter((m: any) => {\n        const mt = (m.modeType || \"\").replace(\"_\", \"\").toLowerCase(); // 'firstto', 'bestof'\n        const target = filterMode.replace(\"_\", \"\").toLowerCase();\n        return mt.includes(target);\n      });\n    }\n\n    // 4. Sort\n    all = (all || []).slice();\n    all.sort((a: any, b: any) => {\n      const tA = a.createdAt || 0;\n      const tB = b.createdAt || 0;\n      return sortBy === \"newest\" ? tB - tA : tA - tB;\n    });\n\n    return all.slice(0, maxMatchesPerRoom);\n  }, [\n    currentRoom,\n    serverMatches,\n    filterMatches,\n    searchQuery,\n    filterGame,\n    filterMode,\n    sortBy,\n    maxMatchesPerRoom,\n  ]);\n\n  // Reset page when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [searchQuery, filterGame, filterMode, sortBy, currentRoomIdx]);\n\n  const totalPages = Math.ceil(combinedMatches.length / itemsPerPage);\n  const paginatedMatches = combinedMatches.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage,\n  );\n\n  const handleQuickJoin = () => {\n    if (combinedMatches.length > 0) {\n      requestJoin(combinedMatches[0]);\n    }\n  };\n\n  const handleCreateMatch = (payload: any) => {\n    const newMatch = {\n      id: `m-${Date.now()}`,\n      createdBy: payload.createdBy || username,\n      game: payload.game,\n      modeType: payload.modeType,\n      legs: payload.legs,\n      startingScore: payload.startingScore,\n      createdAt: Date.now(),\n    };\n\n    // Only add optimistically if we are NOT connected to the server\n    // Otherwise, we wait for the server to broadcast the new match to avoid duplicates\n    if (!wsGlobal?.connected) {\n      setRooms((prev) =>\n        prev.map((r, idx) =>\n          idx === currentRoomIdx\n            ? { ...r, matches: [newMatch, ...r.matches] }\n            : r,\n        ),\n      );\n    }\n\n    // If we have a server WS connection, send a create-match message\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before creating match to guarantee correct attribution\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n\n        wsGlobal.send({\n          type: \"create-match\",\n          game: payload.game,\n          mode: payload.modeType,\n          value: payload.legs,\n          startingScore: payload.startingScore,\n          creatorAvg: payload.avgChoice || 0,\n        });\n      }\n    } catch {}\n  };\n\n  const newRoom = () => {\n    setServerMatches([]);\n    setRooms((prev) => {\n      const id = prev.length + 1;\n      const newRooms = [...prev, { id, name: `room-${id}`, matches: [] }];\n      setCurrentRoomIdx(newRooms.length - 1);\n      return newRooms;\n    });\n  };\n\n  // Shared handler for invite / prestart messages\n  const handleInviteOrPrestart = React.useCallback(\n    (msg: any) => {\n      try {\n        console.log(\"[OnlinePlay] handleInviteOrPrestart:\", msg?.type, msg);\n        if (msg?.type === \"invite\") {\n          // Creator receives an invite â€” show accept/decline popup\n          const inviteData = {\n            id: msg.matchId,\n            game: msg.game,\n            mode: msg.mode || \"firstto\",\n            value: msg.value || 1,\n            startingScore: msg.startingScore || 501,\n            fromName: msg.fromName || \"Opponent\",\n            fromId: msg.fromId,\n          };\n          setPendingInvite(inviteData);\n          // Play a notification sound if available\n          try {\n            const audio = new Audio(\"/sounds/notify.mp3\");\n            audio.volume = 0.5;\n            audio.play().catch(() => {});\n          } catch {}\n        }\n        if (msg?.type === \"invite-waiting\") {\n          // Joiner is waiting for the creator to accept\n          setWaitingForCreator(msg.creatorName || \"Creator\");\n        }\n        if (msg?.type === \"match-prestart\") {\n          // Ignore if a match is already running (prevents phantom prestart\n          // after quitting a match while a stale server message arrives)\n          if (useMatch.getState().inProgress) return;\n          // Both players enter prestart after creator accepted the invite\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          const m = normalizeMatch(msg.match || null);\n          if (m) m.prestartEndsAt = msg.prestartEndsAt;\n          // Determine if the local user is the creator so we can set the\n          // correct opponent name and send the right toId in handleJoinAccept\n          if (m) {\n            const localName = (user?.username || \"\").toLowerCase();\n            const creatorLower = (\n              m.creatorName ||\n              m.createdBy ||\n              \"\"\n            ).toLowerCase();\n            if (localName && creatorLower === localName) {\n              m._isCreatorView = true;\n            }\n          }\n          try {\n            if (m?.creatorId && m?.creatorName)\n              setParticipants((prev) => ({\n                ...prev,\n                [m.creatorId]: m.creatorName,\n              }));\n          } catch {}\n          serverPrestartRef.current = true;\n          setJoinMatch(m);\n          const endsAt = msg.prestartEndsAt || Date.now();\n          setJoinTimer(\n            Math.max(\n              0,\n              Math.ceil(((endsAt || Date.now()) - Date.now()) / 1000),\n            ),\n          );\n          setTimeout(() => {\n            serverPrestartRef.current = false;\n          }, 0);\n          setJoinChoice(null);\n          setRemoteChoices({});\n          setBullActive(false);\n          setBullThrow(null);\n          setBullWinner(null);\n          setBullTied(false);\n        }\n        if (msg?.type === \"invite-expired\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n        if (msg?.type === \"declined\") {\n          setPendingInvite(null);\n          setWaitingForCreator(null);\n          setJoinMatch((prev: any) =>\n            prev && msg.matchId === prev.id ? null : prev,\n          );\n        }\n      } catch {}\n    },\n    [normalizeMatch, user],\n  );\n\n  // Shared handler for match-start messages (used by WS listener and forwarded events)\n  const handleMatchStart = React.useCallback(\n    (msg: any) => {\n      if (msg?.type !== \"match-start\") return;\n      // Prevent double-init if match is already running\n      if (useMatch.getState().inProgress) return;\n\n      const serverMatch = msg.match || {};\n      const saved = pendingMatchRef.current || {};\n      const roomId = msg.roomId || saved.id || \"\";\n      const startScore =\n        serverMatch.startingScore || saved.startingScore || 501;\n      const localName = username;\n      const creatorName =\n        serverMatch.creatorName || saved.creatorName || saved.createdBy || \"\";\n      const joinerName = serverMatch.joinerName || saved.joinerName || \"\";\n\n      // Determine player order: first thrower goes first\n      // Dev server sends firstPlayerId, deployed server sends firstThrowerId\n      const firstId = msg.firstThrowerId || msg.firstPlayerId || null;\n      const isLocalCreator =\n        saved._isCreatorView ||\n        creatorName.toLowerCase() === localName.toLowerCase();\n      const opponentName = isLocalCreator\n        ? joinerName || \"Opponent\"\n        : creatorName || \"Opponent\";\n\n      let localGoesFirst: boolean;\n      if (firstId) {\n        const creatorId = serverMatch.creatorId || saved.creatorId;\n        localGoesFirst = isLocalCreator\n          ? firstId === creatorId\n          : firstId !== creatorId;\n      } else {\n        localGoesFirst = isLocalCreator;\n      }\n\n      const playerNames = localGoesFirst\n        ? [localName, opponentName]\n        : [opponentName, localName];\n\n      // Initialize the match in the store â€” sets inProgress = true\n      try {\n        useMatch.getState().newMatch(playerNames, startScore, roomId);\n      } catch (e) {\n        console.error(\"[OnlinePlay] newMatch failed:\", e);\n      }\n\n      // Join the WS room so we receive real-time score updates\n      try {\n        if (wsGlobal?.connected) {\n          wsGlobal.send({ type: \"join\", roomId });\n        }\n      } catch {}\n\n      // Clean up prestart state\n      pendingMatchRef.current = null;\n      setJoinMatch(null);\n      setJoinChoice(null);\n      setRemoteChoices({});\n    },\n    [username, wsGlobal],\n  );\n\n  // WS: subscribe to lobby and prestart events\n  useEffect(() => {\n    if (!wsGlobal) return;\n    if (wsGlobal.connected) wsGlobal.send({ type: \"list-matches\" });\n    const unsub = wsGlobal.addListener((msg) => {\n      try {\n        if (msg?.type === \"joined\") {\n          if (msg.id) setSelfId(msg.id);\n        }\n        if (msg?.type === \"presence\") {\n          // presence carries id and username\n          try {\n            if (msg.id)\n              setParticipants((prev) => ({\n                ...prev,\n                [msg.id]: msg.username || msg.name || msg.id,\n              }));\n          } catch {}\n        }\n        if (msg?.type === \"matches\") {\n          const filtered = filterMatches(msg.matches || []);\n          setServerMatches(filtered);\n          serverMatchesRef.current = filtered;\n          setRooms((prev) =>\n            prev.map((r, idx) =>\n              idx === currentRoomIdx ? { ...r, matches: filtered } : r,\n            ),\n          );\n        }\n        // Invite / prestart / expired / declined\n        handleInviteOrPrestart(msg);\n\n        if (msg?.type === \"match-start\") {\n          handleMatchStart(msg);\n        }\n        if (msg?.type === \"prestart-choice-notify\") {\n          const { roomId, playerId, choice } = msg;\n          if (!roomId || !choice) return;\n          setRemoteChoices((prev) => ({ ...(prev || {}), [playerId]: choice }));\n        }\n        if (msg?.type === \"prestart-bull\") {\n          setBullActive(true);\n          setBullThrown(false);\n          setBullLocalThrow(null);\n        }\n        if (msg?.type === \"prestart-bull-winner\") {\n          setBullWinner(msg.winnerName || msg.winnerId || null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(false);\n        }\n        if (msg?.type === \"prestart-bull-tie\") {\n          // reset to allow another round\n          setBullWinner(null);\n          setBullActive(false);\n          setBullThrown(false);\n          setBullTied(true);\n          // Auto-reset tied state after 2s so the dartboard reappears\n          setTimeout(() => setBullTied(false), 2000);\n        }\n        // Opponent quit â€” show overlay so this player can leave gracefully\n        if (msg?.type === \"opponent-quit\") {\n          setOpponentQuitName(msg.quitterName || \"Opponent\");\n        }\n        // Opponent paused â€” sync pause state locally\n        if (msg?.type === \"opponent-paused\") {\n          try {\n            useMatchControl\n              .getState()\n              .setPaused(true, null, msg.pauserName || \"Opponent\");\n          } catch {}\n        }\n        // Opponent resumed â€” sync unpause state locally\n        if (msg?.type === \"opponent-unpaused\") {\n          try {\n            useMatchControl.getState().setPaused(false, null);\n          } catch {}\n        }\n      } catch (err) {}\n    });\n    return unsub;\n  }, [\n    wsGlobal,\n    joinChoice,\n    filterMatches,\n    currentRoomIdx,\n    handleInviteOrPrestart,\n    handleMatchStart,\n  ]);\n\n  // Listen for forwarded invite/prestart/match-start events from App.tsx (global listener)\n  // This fires when the user is on a different tab and App.tsx switches to\n  // the online tab + dispatches the WS message via a CustomEvent.\n  // Also check for a stashed pending message on mount (the event may have fired\n  // before this component mounted).\n  useEffect(() => {\n    // Check for a pending message stashed by App.tsx before we mounted\n    try {\n      const pending = (window as any).__ndn_pending_invite;\n      if (pending) {\n        (window as any).__ndn_pending_invite = null;\n        if (pending.type === \"match-start\") {\n          handleMatchStart(pending);\n        } else {\n          handleInviteOrPrestart(pending);\n        }\n      }\n    } catch {}\n\n    const onInviteEvent = (e: Event) => {\n      try {\n        const msg = (e as CustomEvent).detail;\n        if (!msg) return;\n        if (msg.type === \"match-start\") {\n          handleMatchStart(msg);\n        } else {\n          handleInviteOrPrestart(msg);\n        }\n      } catch {}\n    };\n    window.addEventListener(\"ndn:match-invite\", onInviteEvent);\n    return () => window.removeEventListener(\"ndn:match-invite\", onInviteEvent);\n  }, [handleInviteOrPrestart, handleMatchStart]);\n\n  // Join timer\n  useEffect(() => {\n    if (!joinMatch) return;\n    if (serverPrestartRef.current) return;\n    // If a server-supplied prestart exists, do not override joinTimer\n    if ((joinMatch as any).prestartEndsAt) return;\n    setJoinTimer(30);\n    setJoinChoice(null);\n    setRemoteChoices({});\n    const t = setInterval(() => setJoinTimer((v) => Math.max(0, v - 1)), 1000);\n    return () => clearInterval(t);\n  }, [joinMatch]);\n\n  // Focus the accept button when the join modal is shown\n  useEffect(() => {\n    if (!joinMatch) return;\n    setTimeout(() => joinAcceptRef.current?.focus(), 0);\n  }, [joinMatch]);\n\n  const handleJoinAccept = () => {\n    // Show the pre-game overlay immediately for snappy UX.\n    setShowStartShowcase(true);\n    // Save match info so the match-start handler can use it after joinMatch is cleared\n    if (joinMatch) {\n      pendingMatchRef.current = { ...joinMatch };\n    }\n    // Send accept (invite-response) to server\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        // If the local user is the creator accepting an invite, toId is the joiner\n        // If the local user is the joiner, toId is the creator\n        const isCreatorAccepting = !!joinMatch._isCreatorView;\n        wsGlobal.send({\n          type: \"invite-response\",\n          matchId: joinMatch.id,\n          accept: true,\n          toId: isCreatorAccepting ? joinMatch.joinerId : joinMatch.creatorId,\n        });\n      }\n    } catch {}\n    setJoinMatch(null);\n  };\n\n  const requestJoin = (m: any) => {\n    setJoinMatch(m);\n    // MatchPrestart overlay handles the pre-game flow now; MatchStartShowcase\n    // is shown later when the user accepts via handleJoinAccept.\n    try {\n      if (wsGlobal?.connected) {\n        // Ensure presence is sent before joining\n        if (user?.username) {\n          wsGlobal.send({\n            type: \"presence\",\n            username: user.username,\n            email: user.email || \"\",\n          });\n        }\n        wsGlobal.send({ type: \"join-match\", matchId: m.id, calibrated: true });\n      }\n    } catch {}\n  };\n\n  const sendPrestartChoice = (choice: \"bull\" | \"skip\") => {\n    setJoinChoice(choice);\n    try {\n      if (wsGlobal?.connected && joinMatch?.id) {\n        wsGlobal.send({\n          type: \"prestart-choice\",\n          roomId: joinMatch.id,\n          choice,\n        });\n      }\n    } catch {}\n  };\n\n  // No local state for the start showcase; MatchStartShowcase reads from `match.inProgress` directly\n\n  const sendState = React.useCallback(() => {\n    try {\n      if (wsGlobal?.connected) {\n        const st = useMatch.getState();\n        wsGlobal.send({ type: \"state\", payload: st });\n      }\n    } catch {}\n  }, [wsGlobal]);\n\n  const runOnlineInPlayDemo = () => {\n    launchInPlayDemo({\n      players: [username, \"Opponent\"],\n      startingScore: 501,\n      roomId: \"online-demo\",\n      visits: [{ score: 60 }, { score: 85 }, { score: 100 }],\n    });\n  };\n\n  // â”€â”€ When a match is in progress, render the full in-game shell â”€â”€\n  if (inProgress) {\n    const matchState = useMatch.getState();\n    const localIdx = (matchState.players || []).findIndex(\n      (p: any) => p?.name && p.name.toLowerCase() === username.toLowerCase(),\n    );\n    return (\n      <>\n        <InGameShell\n          user={user}\n          showStartShowcase={showStartShowcase}\n          onShowStartShowcaseChange={setShowStartShowcase}\n          onCommitVisit={(score, _darts, _meta) => {\n            try {\n              const m = useMatch.getState();\n              const p = m.players[m.currentPlayerIdx];\n              const leg = p?.legs?.[p.legs.length - 1];\n              const preRem = leg ? leg.totalScoreRemaining : m.startingScore;\n              const postRem = Math.max(0, preRem - score);\n              const attempts = preRem <= 50 ? 3 : postRem <= 50 ? 1 : 0;\n              const finished = postRem === 0;\n              m.addVisit(score, 3, {\n                preOpenDarts: 0,\n                doubleWindowDarts: attempts,\n                finishedByDouble: finished,\n                visitTotal: score,\n              });\n              if (leg && leg.totalScoreRemaining === 0) {\n                m.endLeg(score);\n              } else {\n                m.nextPlayer();\n              }\n            } catch {\n              useMatch.getState().addVisit(score, 3);\n              useMatch.getState().nextPlayer();\n            }\n            sendState();\n          }}\n          onQuit={() => {\n            try {\n              useMatch.getState().endGame();\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-quit\" });\n              }\n            } catch {}\n            // Clear any stale prestart / invite state so popups don't reappear\n            setPendingInvite(null);\n            setWaitingForCreator(null);\n            setJoinMatch(null);\n            setJoinChoice(null);\n            setOpponentQuitName(null);\n            pendingMatchRef.current = null;\n            try {\n              (window as any).__ndn_pending_invite = null;\n            } catch {}\n            sendState();\n            try {\n              window.dispatchEvent(new Event(\"ndn:match-quit\"));\n            } catch {}\n          }}\n          onPause={() => {\n            try {\n              useMatchControl.getState().setPaused(true, null, username);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-pause\" });\n              }\n            } catch {}\n          }}\n          onResume={() => {\n            try {\n              useMatchControl.getState().setPaused(false, null);\n            } catch {}\n            // Notify opponent via WebSocket\n            try {\n              if (wsGlobal?.connected) {\n                wsGlobal.send({ type: \"match-unpause\" });\n              }\n            } catch {}\n          }}\n          onStateChange={sendState}\n          localPlayerIndexOverride={localIdx >= 0 ? localIdx : undefined}\n          isOnline={true}\n        />\n        {/* Opponent quit overlay */}\n        {opponentQuitName && (\n          <div className=\"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm\">\n            <div className=\"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl\">\n              <div className=\"text-4xl mb-3\">ğŸšª</div>\n              <h3 className=\"text-lg font-bold text-white mb-2\">\n                {opponentQuitName} left the match\n              </h3>\n              <p className=\"text-sm text-white/60 mb-5\">\n                Your opponent has quit. You can leave the match now.\n              </p>\n              <button\n                className=\"w-full py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold hover:scale-[1.02] active:scale-[0.98] transition-all\"\n                onClick={() => {\n                  try {\n                    useMatch.getState().endGame();\n                  } catch {}\n                  setOpponentQuitName(null);\n                  setPendingInvite(null);\n                  setWaitingForCreator(null);\n                  setJoinMatch(null);\n                  setJoinChoice(null);\n                  pendingMatchRef.current = null;\n                  try {\n                    (window as any).__ndn_pending_invite = null;\n                  } catch {}\n                  try {\n                    window.dispatchEvent(new Event(\"ndn:match-quit\"));\n                  } catch {}\n                }}\n              >\n                Leave Match\n              </button>\n            </div>\n          </div>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <div\n      className=\"flex-1 min-h-0 ndn-page\"\n      style={{ position: \"relative\", marginTop: 0 }}\n    >\n      <div className=\"card ndn-game-shell relative overflow-hidden md:overflow-hidden overflow-y-auto h-full flex flex-col\">\n        {showStartShowcase && (\n          <MatchStartShowcase\n            players={(players || []) as any}\n            user={user}\n            onDone={() => setShowStartShowcase(false)}\n            onRequestClose={() => setShowStartShowcase(false)}\n          />\n        )}\n        <h2 className=\"text-3xl font-bold text-black dark:text-white mb-4 ndn-section-title\">\n          Online Lobby ğŸŒ\n        </h2>\n        <div className=\"ndn-shell-body flex-1 overflow-hidden p-3 pb-0\">\n          <div className=\"h-full flex flex-col gap-3\">\n            {/* Top row: Room, New Room, Create Match */}\n            <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex items-center justify-between gap-3 flex-wrap\">\n              <div className=\"flex items-center gap-3 flex-wrap\">\n                <div className=\"text-sm text-white/70\">Room</div>\n                <div className=\"px-3 py-1.5 bg-slate-800/60 rounded-lg border border-slate-700/50 text-white/90 font-medium\">\n                  Room ({currentRoom?.id})\n                </div>\n                <button\n                  className=\"btn btn-ghost btn-sm rounded-lg\"\n                  onClick={newRoom}\n                >\n                  New Room\n                </button>\n              </div>\n              <div className=\"shrink-0 flex items-center gap-2\">\n                <button\n                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 rounded-lg\"\n                  onClick={() => setShowCreateModal(true)}\n                  disabled={\n                    (currentRoom?.matches?.length || 0) >= maxMatchesPerRoom\n                  }\n                >\n                  <Trophy className=\"w-4 h-4\" />\n                  Create Match +\n                </button>\n                {showDemoControls && (\n                  <button\n                    className=\"btn btn-sm btn-ghost rounded-lg\"\n                    onClick={runOnlineInPlayDemo}\n                  >\n                    Demo In-Play\n                  </button>\n                )}\n                {(currentRoom?.matches?.length || 0) >= maxMatchesPerRoom && (\n                  <div className=\"text-xs text-rose-400\">\n                    Room full â€” create a new room\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Filters & Controls */}\n            {!inProgress && (\n              <div className=\"p-4 rounded-lg bg-slate-900/50 border border-slate-800/50 flex flex-col gap-3\">\n                <div className=\"ndn-filterbar\">\n                  <div className=\"flex-1 min-w-[240px] relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40\" />\n                    <input\n                      type=\"text\"\n                      placeholder=\"Search matches, players...\"\n                      className=\"w-full pl-9 pr-3 py-2 rounded-lg bg-slate-950/80 border border-slate-700/50 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/40 transition-all\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterGame}\n                      onChange={(e) => setFilterGame(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Games</option>\n                      <option value=\"x01\">X01</option>\n                      <option value=\"cricket\">Cricket</option>\n                      <option value=\"bermuda\">Bermuda</option>\n                      <option value=\"gotcha\">Gotcha</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={filterMode}\n                      onChange={(e) => setFilterMode(e.target.value as any)}\n                    >\n                      <option value=\"all\">All Modes</option>\n                      <option value=\"first_to\">First To</option>\n                      <option value=\"best_of\">Best Of</option>\n                    </select>\n                    <select\n                      className=\"input input-compact cursor-pointer font-semibold bg-slate-950/80 border border-slate-700/50 rounded-lg\"\n                      value={sortBy}\n                      onChange={(e) => setSortBy(e.target.value as any)}\n                    >\n                      <option value=\"newest\">Newest First</option>\n                      <option value=\"oldest\">Oldest First</option>\n                    </select>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className={`px-3 py-2 rounded-lg text-sm font-semibold transition-all border ${focusMode ? \"bg-red-600 text-white border-red-500\" : \"bg-slate-950/80 border-slate-700/50 text-white/80 hover:bg-slate-900\"}`}\n                      onClick={() => setFocusMode((s) => !s)}\n                      aria-pressed={focusMode}\n                      title=\"Toggle focus mode: hide small details and show focused view\"\n                    >\n                      {focusMode ? \"Exit Focus\" : \"Focus Mode\"}\n                    </button>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm flex items-center gap-2 px-4 rounded-lg\"\n                      onClick={handleQuickJoin}\n                      disabled={combinedMatches.length === 0}\n                    >\n                      <Zap className=\"w-4 h-4 fill-current\" />\n                      Quick Join\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex-1 overflow-auto flex flex-col\">\n              <h3 className=\"font-semibold text-lg mb-3 flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-indigo-400\" />\n                Active Matches ï¿½ï¸\n              </h3>\n              <div className=\"flex-1 p-4 rounded-lg border border-slate-800/50 bg-slate-900/30 flex flex-col\">\n                <div className=\"flex-1 overflow-auto\">\n                  {(combinedMatches.length || 0) === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center opacity-60\">\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4\">\n                        <Target className=\"w-8 h-8 text-white/20\" />\n                      </div>\n                      <p className=\"text-lg font-medium mb-1\">\n                        No matches found\n                      </p>\n                      <p className=\"text-sm max-w-xs mx-auto\">\n                        Create a new match to get started or try adjusting your\n                        filters.\n                      </p>\n                    </div>\n                  ) : null}\n\n                  {(combinedMatches.length || 0) !== 0 && (\n                    <div className=\"relative\">\n                      {focusMode && (\n                        <div className=\"absolute inset-0 z-10 flex items-center justify-center pointer-events-none\">\n                          <div className=\"pointer-events-auto bg-red-600/95 text-white px-6 py-3 rounded-none shadow-lg text-lg font-bold transform transition-all duration-200 ease-out\">\n                            <button\n                              onClick={() => setFocusMode(false)}\n                              className=\"w-full text-center\"\n                            >\n                              FOCUS MODE â€” Click to exit\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      <div\n                        ref={matchesRef}\n                        className={`ndn-card-grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 max-h-[28rem] overflow-auto p-1 ${focusMode ? \"opacity-90\" : \"\"}`}\n                        data-testid=\"matches-grid\"\n                      >\n                        {paginatedMatches.map((m: any) => (\n                          <div\n                            key={m.id}\n                            className=\"group relative p-4 rounded-lg border border-slate-700/30 bg-slate-950/40 hover:border-indigo-500/50 hover:bg-slate-900/50 transition-all duration-150 shadow-sm hover:shadow-[0_8px_24px_-12px_rgba(99,102,241,0.4)] flex flex-col gap-3 min-h-[6.5rem]\"\n                            data-testid={`match-${m.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  {!focusMode && (\n                                    <div className=\"w-9 h-9 rounded-full bg-indigo-500/10 flex items-center justify-center border border-indigo-500/20 group-hover:border-indigo-500/40 transition-colors text-xs font-bold\">\n                                      {m.createdBy\n                                        ? (m.createdBy || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()\n                                        : (m.creatorName || \"U\")\n                                            .substring(0, 2)\n                                            .toUpperCase()}\n                                    </div>\n                                  )}\n                                  <div className=\"min-w-0\">\n                                    <div className=\"font-bold text-white group-hover:text-indigo-300 transition-colors truncate\">\n                                      {m.game}\n                                    </div>\n                                    <div className=\"text-xs text-white/50 flex items-center gap-1\">\n                                      <Clock className=\"w-3 h-3\" />\n                                      {new Date(m.createdAt).toLocaleTimeString(\n                                        [],\n                                        { hour: \"2-digit\", minute: \"2-digit\" },\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                              {m.roomName && (\n                                <div className=\"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-none bg-slate-950 border border-slate-850 text-white/70\">\n                                  {m.roomName}\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex flex-col gap-1 text-sm text-white/70 bg-transparent border-t border-slate-850 pt-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"px-1.5 py-0.5 rounded-none bg-white/5 text-xs font-medium border border-slate-850\">\n                                  {m.modeType === \"bestof\"\n                                    ? \"Best Of\"\n                                    : \"First To\"}\n                                </span>\n                                <span className=\"font-mono text-indigo-300\">\n                                  {m.legs}\n                                </span>\n                                <span>legs</span>\n                                {m.startingScore && (\n                                  <>\n                                    <span className=\"w-1 h-1 rounded-full bg-white/20\" />\n                                    <span className=\"font-mono text-amber-300\">\n                                      {m.startingScore}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                              {!focusMode && (\n                                <div className=\"text-xs text-white/40 flex items-center gap-1 mt-1\">\n                                  <Users className=\"w-3 h-3\" />\n                                  Created by:{\" \"}\n                                  <span className=\"text-white/60\">\n                                    {m.createdBy || m.creatorName || \"Unknown\"}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n\n                            <div className=\"flex items-center justify-between mt-auto pt-2 border-t border-white/5\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                {!focusMode && (\n                                  <div className=\"flex items-center gap-3 min-w-0\">\n                                    <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white\">\n                                      {(m.createdBy || m.creatorName || \"U\")\n                                        .substring(0, 2)\n                                        .toUpperCase()}\n                                    </div>\n                                    <span className=\"text-xs text-white/60 truncate max-w-[120px]\">\n                                      {m.createdBy || m.creatorName}\n                                    </span>\n                                  </div>\n                                )}\n                              </div>\n\n                              <div className=\"flex items-center justify-end\">\n                                <button\n                                  className=\"btn btn-sm bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-sm px-4 rounded-none\"\n                                  onClick={() => requestJoin(m)}\n                                >\n                                  Join\n                                </button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Pagination Controls */}\n                  {totalPages > 1 && (\n                    <div className=\"flex items-center justify-center gap-4 mt-4 pt-2 border-t border-white/5\">\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === 1}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.max(1, p - 1))\n                        }\n                      >\n                        <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                        Previous\n                      </button>\n                      <div className=\"flex items-center gap-1\">\n                        {Array.from(\n                          { length: Math.min(5, totalPages) },\n                          (_, i) => {\n                            // Logic to show window of pages around current\n                            let p = i + 1;\n                            if (totalPages > 5) {\n                              if (currentPage > 3) p = currentPage - 2 + i;\n                              if (p > totalPages) p = totalPages - 4 + i;\n                            }\n                            return (\n                              <button\n                                key={p}\n                                className={`w-8 h-8 rounded-none text-xs font-bold transition-all border border-slate-850 ${\n                                  currentPage === p\n                                    ? \"bg-indigo-600 text-white shadow-sm\"\n                                    : \"bg-slate-950 text-white/70 hover:bg-slate-900\"\n                                }`}\n                                onClick={() => setCurrentPage(p)}\n                              >\n                                {p}\n                              </button>\n                            );\n                          },\n                        )}\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-ghost text-white/60 hover:text-white disabled:opacity-30\"\n                        disabled={currentPage === totalPages}\n                        onClick={() =>\n                          setCurrentPage((p) => Math.min(totalPages, p + 1))\n                        }\n                      >\n                        Next\n                        <ChevronDown className=\"w-4 h-4 -rotate-90\" />\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n              {/* World Lobby removed: combined matches are displayed above */}\n            </div>\n          </div>\n        </div>\n\n        {/* Create Match modal */}\n        <CreateMatchModal\n          open={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onCreate={(p) => {\n            handleCreateMatch(p);\n            setShowCreateModal(false);\n          }}\n        />\n\n        {/* â”€â”€ Incoming invite popup (creator sees this) â”€â”€ */}\n        {pendingInvite && (\n          <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\n            <div className=\"relative w-full max-w-md mx-4 p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-indigo-500/30 shadow-2xl shadow-indigo-500/20\">\n              {/* Glow accent */}\n              <div className=\"absolute -top-12 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none\" />\n\n              <div className=\"relative z-10\">\n                <div className=\"flex items-center gap-3 mb-4\">\n                  <div className=\"w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 ring-2 ring-indigo-500/30\">\n                    <Zap className=\"w-6 h-6\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-xl font-black text-white\">\n                      Match Invite!\n                    </h3>\n                    <p className=\"text-sm text-white/60\">\n                      Someone wants to play\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 mb-5\">\n                  <div className=\"flex items-center gap-3 mb-3\">\n                    <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white font-bold text-sm\">\n                      {(pendingInvite.fromName || \"?\")\n                        .substring(0, 2)\n                        .toUpperCase()}\n                    </div>\n                    <div>\n                      <div className=\"font-bold text-white text-lg\">\n                        {pendingInvite.fromName || \"Opponent\"}\n                      </div>\n                      <div className=\"text-xs text-white/50\">\n                        wants to join your match\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap text-sm text-white/70\">\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-medium\">\n                      {pendingInvite.game || \"X01\"}\n                    </span>\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10\">\n                      {pendingInvite.mode === \"bestof\" ? \"Best Of\" : \"First To\"}{\" \"}\n                      {pendingInvite.value || 1}\n                    </span>\n                    <span className=\"px-2 py-1 rounded-lg bg-white/5 border border-white/10 font-mono text-amber-300\">\n                      {pendingInvite.startingScore || 501}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-3\">\n                  <button\n                    className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold text-lg shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40 transition-all hover:scale-[1.02] active:scale-95\"\n                    onClick={() => {\n                      // Send invite-accept to start prestart for both\n                      try {\n                        if (wsGlobal?.connected && pendingInvite?.id) {\n                          wsGlobal.send({\n                            type: \"invite-accept\",\n                            matchId: pendingInvite.id,\n                          });\n                        }\n                      } catch {}\n                      setPendingInvite(null);\n                    }}\n                  >\n                    âœ… Accept\n                  </button>\n                  <button\n                    className=\"flex-1 py-3 rounded-xl bg-white/5 hover:bg-rose-600/80 text-white/80 hover:text-white font-bold text-lg border border-white/10 hover:border-rose-500/50 transition-all hover:scale-[1.02] active:scale-95\"\n                    onClick={() => {\n                      // Send invite-decline\n                      try {\n                        if (wsGlobal?.connected && pendingInvite?.id) {\n                          wsGlobal.send({\n                            type: \"invite-decline\",\n                            matchId: pendingInvite.id,\n                          });\n                        }\n                      } catch {}\n                      setPendingInvite(null);\n                    }}\n                  >\n                    âŒ Decline\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* â”€â”€ Waiting for creator (joiner sees this) â”€â”€ */}\n        {waitingForCreator && !joinMatch && (\n          <div className=\"fixed inset-0 z-[9998] flex items-center justify-center bg-black/70 backdrop-blur-sm\">\n            <div className=\"w-full max-w-sm mx-4 p-6 rounded-2xl bg-slate-900 border border-slate-700/50 text-center\">\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-indigo-500/10 flex items-center justify-center\">\n                <Clock className=\"w-8 h-8 text-indigo-400 animate-pulse\" />\n              </div>\n              <h3 className=\"text-xl font-bold text-white mb-2\">\n                Waiting for {waitingForCreator}\n              </h3>\n              <p className=\"text-sm text-white/50 mb-5\">\n                The match creator needs to accept your requestâ€¦\n              </p>\n              <button\n                className=\"px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/10 transition-all text-sm font-medium\"\n                onClick={() => setWaitingForCreator(null)}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Modern join / prestart overlay */}\n        <MatchPrestart\n          open={!!joinMatch}\n          matchInfo={joinMatch}\n          localUser={user}\n          opponentName={(() => {\n            if (!joinMatch) return \"Opponent\";\n            const localName = (user?.username || \"\").toLowerCase();\n            const creatorName =\n              joinMatch.createdBy || joinMatch.creatorName || \"\";\n            // If local user is the creator, opponent is the joiner\n            if (\n              joinMatch._isCreatorView ||\n              creatorName.toLowerCase() === localName\n            ) {\n              return (\n                joinMatch.joinerName ||\n                (joinMatch.joinerId\n                  ? participants[joinMatch.joinerId] || joinMatch.joinerId\n                  : \"Opponent\")\n              );\n            }\n            // Otherwise, local user is the joiner â€” opponent is the creator\n            return (\n              creatorName ||\n              (joinMatch.creatorId\n                ? participants[joinMatch.creatorId] || joinMatch.creatorId\n                : \"Opponent\")\n            );\n          })()}\n          countdown={15}\n          onChoice={sendPrestartChoice}\n          onBullThrow={(distanceMm: number) => {\n            try {\n              if (wsGlobal?.connected && joinMatch?.id) {\n                wsGlobal.send({\n                  type: \"prestart-bull-throw\",\n                  roomId: joinMatch.id,\n                  score: distanceMm,\n                });\n              }\n            } catch {}\n            setBullLocalThrow(distanceMm);\n            setBullThrown(true);\n          }}\n          onAccept={handleJoinAccept}\n          onCancel={() => {\n            // If the creator cancels during prestart, notify the server\n            try {\n              if (\n                wsGlobal?.connected &&\n                joinMatch?.id &&\n                joinMatch._isCreatorView\n              ) {\n                wsGlobal.send({\n                  type: \"invite-decline\",\n                  matchId: joinMatch.id,\n                });\n              }\n            } catch {}\n            setJoinMatch(null);\n          }}\n          remoteChoice={Object.values(remoteChoices)[0] || null}\n          bullActive={bullActive}\n          bullWinner={bullWinner}\n          bullTied={bullTied}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":["CreateMatchModal","open","onClose","onCreate","portalEl","useState","game","setGame","modeType","setModeType","legs","setLegs","legsRef","useRef","avgChoice","setAvgChoice","startingScore","setStartingScore","getStartOptionsForGame","user","useUserSettings","useLayoutEffect","onKey","e","handleCreate","createPortal","jsxs","jsx","v","opts","allGames","g","opt","prev","base","BOARD_SIZE","CX","CY","BULL_INNER_R","BULL_OUTER_R","TREBLE_INNER_R","TREBLE_OUTER_R","DOUBLE_INNER_R","DOUBLE_OUTER_R","SCALE","SECTOR_ORDER","SECTOR_COLORS","s","i","getPlayerStats","name","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","all","getAllTime","career180s","getAllTime180s","polarToXY","cx","cy","r","angleDeg","rad","distFromBull","x","y","dx","dy","StatPill","label","value","highlight","DartboardBullUp","onSelect","selectedPoint","disabled","svgRef","coordsFromEvent","useCallback","clientX","clientY","svg","rect","dist","handleClick","c","handleTouch","touch","sectorPaths","useMemo","paths","sector","startAngle","endAngle","colors","ring","ri","r1","r2","p1","p2","p3","p4","largeArc","d","labelPos","Fragment","PlayerCard","stats","isLocal","showCamera","isWinner","legDiff","legDiffValue","Crown","Camera","CameraTile","MatchPrestart","matchInfo","localUser","opponentName","opponentStats","countdown","onChoice","onBullThrow","onAccept","onCancel","remoteChoice","bullActive","bullWinner","bullTied","seconds","setSeconds","phase","setPhase","localChoice","setLocalChoice","dartPoint","setDartPoint","dartDistMm","setDartDistMm","dartLocked","setDartLocked","dartSubmitted","setDartSubmitted","portalElRef","localStats","oppStats","useEffect","el","id","next","t","handleDartSelect","distMm","handleSubmitDart","handleChoice","localName","headToHead","getHeadToHeadLegDiff","localLegDiff","opponentLegDiff","isLocalWinner","isOpponentWinner","bothSkipped","overlay","X","Target","Timer","ArrowRight","Zap","InGameShell","showStartShowcaseProp","onShowStartShowcaseChange","onCommitVisit","onQuitProp","onPauseProp","onResumeProp","onPauseDurationSelectedProp","onStateChange","localPlayerIndexOverride","gameModeOverride","isOnline","match","useMatch","useMatchControl","usePendingVisit","winningShot","setWinningShot","remoteFrame","lastOfflineStart","settingsUser","localPlayerName","getPreferredUserName","resolvedLocalIndex","p","localPlayerIndex","isUsersTurn","localPlayer","localLeg","localRemaining","awayIdx","_p","idx","awayPlayer","awayLeg","awayRemaining","playerStats","compute","pts","darts","L","a","lastV","throwerRemaining","gameMode","isX01","scoreboardPlayers","useOnlineGameStats","heroValues","forPlayer","sbIdx","sb","leg","lives","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","showQuitPause","setShowQuitPause","setPaused","paused","pauseEndsAt","pauseNow","setPauseNow","now","checkoutRoutes","routes","suggestCheckouts","throwerCheckout","numpadMax","legsInfo","showStartShowcaseLocal","setShowStartShowcase","showcaseLockedOpenRef","showNumpad","setShowNumpad","numpadValue","setNumpadValue","numpadInputRef","opponentTurnStart","setOpponentTurnStart","opponentTurnElapsed","setOpponentTurnElapsed","interval","commitVisit","score","meta","prevRemaining","numericScore","newRemaining","playerName","sayScore","deriveWinningLabel","lastVisit","latest","b","entry","derived","MatchStartShowcase","PauseTimerBadge","route","CameraView","LetterboxScoreboardOverlay","GameScoreboard","raw","n","PauseQuitModal","broadcastMessage","PauseOverlay","minutes","endsAt","OnlinePlayClean","username","currentRoomIdx","setCurrentRoomIdx","rooms","setRooms","wsGlobal","useWS","serverMatches","setServerMatches","inProgress","players","focusMode","setFocusMode","matchesRef","showDemoControls","onDocClick","showStartShowcase","startedShowcasedRef","React","st","flagKey","openMatchWindow","onQuit","setPendingInvite","setWaitingForCreator","setJoinMatch","setJoinChoice","setOpponentQuitName","pendingMatchRef","showCreateModal","setShowCreateModal","joinMatch","joinAcceptRef","pendingInvite","waitingForCreator","_selfId","setSelfId","participants","setParticipants","joinTimer","setJoinTimer","serverMatchesRef","serverPrestartRef","joinChoice","remoteChoices","setRemoteChoices","setBullActive","bullThrow","setBullThrow","setBullWinner","bullLocalThrow","setBullLocalThrow","bullThrown","setBullThrown","setBullTied","opponentQuitName","searchQuery","setSearchQuery","filterGame","setFilterGame","filterMode","setFilterMode","sortBy","setSortBy","currentPage","setCurrentPage","itemsPerPage","currentRoom","maxMatchesPerRoom","normalizeMatch","m","createdBy","createdAt","filterMatches","list","combinedMatches","q","mt","target","tA","tB","totalPages","paginatedMatches","handleQuickJoin","requestJoin","handleCreateMatch","payload","newMatch","newRoom","newRooms","handleInviteOrPrestart","msg","inviteData","audio","creatorLower","handleMatchStart","serverMatch","saved","roomId","startScore","creatorName","joinerName","firstId","isLocalCreator","localGoesFirst","creatorId","playerNames","filtered","playerId","choice","pending","onInviteEvent","handleJoinAccept","isCreatorAccepting","sendPrestartChoice","sendState","runOnlineInPlayDemo","launchInPlayDemo","localIdx","_darts","_meta","preRem","postRem","attempts","finished","Trophy","Search","Users","Clock","ChevronDown","_","distanceMm"],"mappings":"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"}
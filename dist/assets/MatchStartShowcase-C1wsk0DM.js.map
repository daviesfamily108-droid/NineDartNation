{"version":3,"file":"MatchStartShowcase-C1wsk0DM.js","sources":["../../src/components/ui/MatchStartShowcase.tsx"],"sourcesContent":["import { useEffect, useMemo, useState, useRef } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { getAllTimeAvg, getAllTimeFirstNineAvg, getAllTimeBestCheckout, getAllTimeBestLeg, getAllTime, getAllTime180s } from '../../store/profileStats'\r\nimport type { Player } from '../../store/match'\r\n\r\nfunction StatBlock({ label, value, className = '', scale = 1 }: { label: string; value: string | number; className?: string; scale?: number }) {\r\n  return (\r\n    <div className={`flex flex-col items-center gap-1 ${className}`}>\r\n      <div className=\"text-xs opacity-70\">{label}</div>\r\n      <div className=\"text-2xl sm:text-3xl font-bold transform transition-transform duration-200 ease-out\" style={{ transform: `scale(${scale})` }}>{value}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nimport FocusLock from 'react-focus-lock'\r\nexport default function MatchStartShowcase({ players, onDone }: { players: Player[]; onDone?: () => void }) {\r\n  const [seconds, setSeconds] = useState(15)\r\n  const [scaleState, setScaleState] = useState(1)\r\n  const [visible, setVisible] = useState(true)\r\n  const hostRef = useRef<HTMLDivElement | null>(null)\r\n  const startNowRef = useRef<HTMLButtonElement | null>(null)\r\n  const closeRef = useRef<HTMLButtonElement | null>(null)\r\n  const prevActiveElement = useRef<HTMLElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n    // Ensure initial focus is on the Start Now button for convenience\r\n    try { setTimeout(() => { try { startNowRef.current?.focus() } catch {} }, 0) } catch {}\r\n  // remember previous active element so we can restore on close\r\n  try { prevActiveElement.current = document.activeElement as HTMLElement } catch {}\r\n    // Hide app content from screen readers while overlay is open\r\n    const appRoot = document.getElementById('root')\r\n    const prevAria: string | null = appRoot ? (appRoot.getAttribute('aria-hidden')) : null\r\n    try { if (appRoot) appRoot.setAttribute('aria-hidden', 'true') } catch {}\r\n    const t = setInterval(() => setSeconds(s => s - 1), 1000)\r\n  const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        e.preventDefault()\r\n        setVisible(false)\r\n        try { onDone?.() } catch {}\r\n        try { prevActiveElement.current?.focus() } catch {}\r\n      }\r\n    }\r\n  document.addEventListener('keydown', onKey)\r\n    // Cleanup and restore aria-hidden\r\n    return () => {\r\n      try {\r\n        if (appRoot && prevAria === null) { appRoot.setAttribute('aria-hidden', 'false') }\r\n        else if (appRoot && prevAria !== null) { appRoot.setAttribute('aria-hidden', prevAria) }\r\n      } catch {}\r\n      document.removeEventListener('keydown', onKey)\r\n      clearInterval(t)\r\n    }\r\n  }, [visible, onDone])\r\n\r\n  useEffect(() => {\r\n    if (!visible) return\r\n    if (seconds <= 3 && seconds > 0) {\r\n      setScaleState(s => s + 0.4)\r\n    }\r\n    if (seconds <= 0) {\r\n      // Done; small delay to let the \"Game On\" message show\r\n      setTimeout(() => {\r\n        setVisible(false)\r\n        try { onDone?.() } catch {}\r\n        // Return focus to previous element\r\n        try { prevActiveElement.current?.focus() } catch {}\r\n      }, 1000)\r\n    }\r\n  }, [seconds, onDone, visible])\r\n\r\n  const stats = useMemo(() => players.map(p => {\r\n    const avg3 = getAllTimeAvg(p.name)\r\n    const best9 = getAllTimeFirstNineAvg(p.name)\r\n    const bestCheckout = getAllTimeBestCheckout(p.name)\r\n    const bestLeg = getAllTimeBestLeg(p.name)\r\n    const all = getAllTime(p.name)\r\n    const career180s = getAllTime180s(p.name)\r\n    // Count match 180s for the provided player\r\n    let match180s = 0\r\n    try {\r\n      for (const L of (p.legs || [])) {\r\n        for (const v of (L.visits || [])) {\r\n          if (Number(v.score || 0) === 180) match180s += 1\r\n        }\r\n      }\r\n    } catch {}\r\n    const one80s = `${match180s}/${career180s}`\r\n    return { id: p.id, name: p.name, avg3: avg3.toFixed(1), best9: best9.toFixed(1), bestCheckout, bestLeg, one80s }\r\n  }), [players])\r\n\r\n  if (!visible) return null\r\n\r\n  const getScaleFor = (s: number) => {\r\n    if (s <= 0) return 1.8\r\n    if (s === 1) return 1.6\r\n    if (s === 2) return 1.4\r\n    if (s === 3) return 1.2\r\n    return 1\r\n  }\r\n\r\n  const overlay = (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4\">\r\n          <div role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"match-start-heading\" tabIndex={-1}>\r\n        <FocusLock returnFocus={true}>\r\n          <div ref={hostRef}>\r\n        <div className=\"bg-white/5 border border-white/10 rounded-2xl p-4 md:p-6 max-w-3xl w-full backdrop-blur-sm\">\r\n            <div className=\"flex items-center justify-between\">\r\n            <div id=\"match-start-heading\" className=\"text-sm opacity-80\">Match starting in</div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-4xl font-extrabold\" aria-live=\"polite\">{seconds > 0 ? seconds : 'GO'}</div>\r\n              <button ref={startNowRef} className=\"btn btn-sm\" onClick={() => { setVisible(false); try{ onDone?.() } catch{} }} aria-label=\"Start match now\">Start now</button>\r\n              <button ref={closeRef} className=\"btn btn-ghost btn-sm\" onClick={() => { setVisible(false); try{ onDone?.() } catch{} }} aria-label=\"Close match start showcase\">Close</button>\r\n            </div>\r\n          </div>\r\n        <div className=\"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          {stats.map(st => (\r\n            <div key={st.id} className=\"p-3 rounded-lg bg-white/6 border border-white/8 flex flex-col items-center\">\r\n              <div className=\"text-sm mb-2 font-semibold\">{st.name}</div>\r\n              <div className=\"grid grid-cols-2 gap-2 w-full\">\r\n                <StatBlock label=\"3-Dart Avg\" value={st.avg3} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"First-9 Avg\" value={st.best9} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Checkout\" value={st.bestCheckout || '—'} scale={getScaleFor(seconds)} />\r\n                <StatBlock label=\"Best Leg\" value={st.bestLeg || '—'} scale={getScaleFor(seconds)} />\r\n              </div>\r\n              <div className=\"mt-3 opacity-70 text-xs\">180s (match / career): {st.one80s}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n  <div className=\"mt-4 text-center\">\r\n          {seconds <= 1 ? (\r\n            <div className=\"text-lg font-bold\">Good luck — Game on! {players.map(p=>p.name).join(' vs ')}</div>\r\n          ) : (\r\n            <div className=\"text-sm opacity-70\">Players: {players.map(p=>p.name).join(' vs ')}</div>\r\n          )}\r\n        </div>\r\n          </div>\r\n          </div>\r\n  </FocusLock>\r\n      </div>\r\n    </div>\r\n  )\r\n  return createPortal(overlay, document.body)\r\n}\r\n"],"names":["StatBlock","label","value","className","scale","jsxs","jsx","MatchStartShowcase","players","onDone","seconds","setSeconds","useState","scaleState","setScaleState","visible","setVisible","hostRef","useRef","startNowRef","closeRef","prevActiveElement","useEffect","appRoot","prevAria","t","s","onKey","e","stats","useMemo","p","avg3","getAllTimeAvg","best9","getAllTimeFirstNineAvg","bestCheckout","getAllTimeBestCheckout","bestLeg","getAllTimeBestLeg","getAllTime","career180s","getAllTime180s","match180s","L","v","one80s","getScaleFor","overlay","FocusLock","st","createPortal"],"mappings":"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"}
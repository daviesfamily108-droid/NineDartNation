{"version":3,"file":"index-BS8cKKcV.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/utils/quota.ts","../../src/utils/admin.ts","../../src/utils/config.ts","../../src/utils/api.ts","../../src/components/Sidebar.tsx","../../node_modules/zustand/esm/vanilla.mjs","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js","../../node_modules/use-sync-external-store/shim/index.js","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js","../../node_modules/use-sync-external-store/shim/with-selector.js","../../node_modules/zustand/esm/index.mjs","../../src/store/toast.ts","../../src/utils/stats.ts","../../src/store/profileStats.ts","../../src/store/userSettings.ts","../../src/components/Home.tsx","../../src/components/ScrollFade.tsx","../../src/components/DartLoader.tsx","../../node_modules/qrcode/lib/can-promise.js","../../node_modules/qrcode/lib/core/utils.js","../../node_modules/qrcode/lib/core/error-correction-level.js","../../node_modules/qrcode/lib/core/bit-buffer.js","../../node_modules/qrcode/lib/core/bit-matrix.js","../../node_modules/qrcode/lib/core/alignment-pattern.js","../../node_modules/qrcode/lib/core/finder-pattern.js","../../node_modules/qrcode/lib/core/mask-pattern.js","../../node_modules/qrcode/lib/core/error-correction-code.js","../../node_modules/qrcode/lib/core/galois-field.js","../../node_modules/qrcode/lib/core/polynomial.js","../../node_modules/qrcode/lib/core/reed-solomon-encoder.js","../../node_modules/qrcode/lib/core/version-check.js","../../node_modules/qrcode/lib/core/regex.js","../../node_modules/qrcode/lib/core/mode.js","../../node_modules/qrcode/lib/core/version.js","../../node_modules/qrcode/lib/core/format-info.js","../../node_modules/qrcode/lib/core/numeric-data.js","../../node_modules/qrcode/lib/core/alphanumeric-data.js","../../node_modules/qrcode/lib/core/byte-data.js","../../node_modules/qrcode/lib/core/kanji-data.js","../../node_modules/dijkstrajs/dijkstra.js","../../node_modules/qrcode/lib/core/segments.js","../../node_modules/qrcode/lib/core/qrcode.js","../../node_modules/qrcode/lib/renderer/utils.js","../../node_modules/qrcode/lib/renderer/canvas.js","../../node_modules/qrcode/lib/renderer/svg-tag.js","../../node_modules/qrcode/lib/browser.js","../../src/utils/qr.ts","../../node_modules/zustand/esm/middleware.mjs","../../src/store/calibration.ts","../../src/store/cameraSession.ts","../../src/utils/vision.ts","../../node_modules/js-aruco/src/cv.js","../../node_modules/js-aruco/src/aruco.js","../../node_modules/js-aruco/src/svd.js","../../node_modules/js-aruco/src/posit1.js","../../node_modules/js-aruco/src/posit2.js","../../node_modules/js-aruco/index.js","../../src/utils/markerCalibration.ts","../../src/utils/boardDetection.ts","../../src/utils/networkDevices.ts","../../src/components/Calibrator.tsx","../../src/utils/checkout.ts","../../src/utils/gameCalibrationRequirements.ts","../../src/components/GameCalibrationStatus.tsx","../../src/components/CameraTile.tsx","../../src/store/audit.ts","../../src/store/match.ts","../../src/utils/autoscore.ts","../../src/utils/dartDetector.ts","../../src/utils/scoring.ts","../../src/components/ui/ResizablePanel.tsx","../../src/components/ui/ResizableModal.tsx","../../src/store/heatmap.ts","../../src/store/pendingVisit.ts","../../src/store/matchControl.ts","../../src/components/CameraView.tsx","../../src/components/HeatMap.tsx","../../src/game/types.ts","../../src/game/aroundTheClock.ts","../../src/game/cricket.ts","../../src/game/shanghai.ts","../../src/game/halveIt.ts","../../src/game/highLow.ts","../../src/game/killer.ts","../../src/game/baseball.ts","../../src/game/golf.ts","../../src/game/ticTacToe.ts","../../src/game/scamFivesSevens.ts","../../src/game/americanCricket.ts","../../src/components/ui/GameHeaderBar.tsx","../../src/components/scoreboards/GameScoreboard.tsx","../../src/components/scoreboards/useGameStats.ts","../../src/utils/games.ts","../../src/components/OfflinePlay.tsx","../../src/store/messages.ts","../../src/utils/profanity.ts","../../src/components/ui/TabPills.tsx","../../src/components/Friends.tsx","../../src/components/Toaster.tsx","../../src/components/BarChart.tsx","../../src/components/WSProvider.tsx","../../src/components/ui/StatusDot.tsx","../../src/components/CameraStatusBadge.tsx","../../src/utils/helpDeskAI.ts","../../src/components/HelpdeskChat.tsx","../../src/components/AdminDashboard.tsx","../../src/components/SettingsPanel.tsx","../../src/components/Auth.tsx","../../src/components/ThemeContext.tsx","../../src/components/MatchSummaryModal.tsx","../../src/store/blocklist.ts","../../src/components/OnlinePlay.tsx","../../src/components/StatsPanel.tsx","../../src/components/Tournaments.tsx","../../src/components/AdminAccess.tsx","../../src/components/ui/Drawer.tsx","../../src/components/OpsDashboard.tsx","../../src/components/HelpAssistant.tsx","../../src/components/GlobalCameraLogger.tsx","../../src/components/GlobalPhoneVideoSink.tsx","../../src/components/Footer.tsx","../../src/App.tsx","../../src/components/ResetPassword.tsx","../../src/components/ErrorBoundary.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// Simple localStorage-based weekly quota for free online games\r\n// 3 free online games per week per user (by username). Premium users are exempt.\r\n\r\nconst KEY = (user: string) => `ndn_online_quota_${user}`\r\n\r\ntype Usage = {\r\n  week: string // e.g., YYYY-WW\r\n  used: number\r\n}\r\n\r\nfunction getWeekId(d = new Date()): string {\r\n  // ISO week-numbering year and week\r\n  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()))\r\n  // Thursday in current week decides the year\r\n  const dayNum = date.getUTCDay() || 7\r\n  date.setUTCDate(date.getUTCDate() + 4 - dayNum)\r\n  const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1))\r\n  const weekNo = Math.ceil(((date.getTime() - yearStart.getTime()) / 86400000 + 1) / 7)\r\n  const week = String(weekNo).padStart(2, '0')\r\n  return `${date.getUTCFullYear()}-${week}`\r\n}\r\n\r\nexport function getOnlineUsage(user: string): Usage {\r\n  try {\r\n    const raw = localStorage.getItem(KEY(user))\r\n    if (!raw) return { week: getWeekId(), used: 0 }\r\n    const u = JSON.parse(raw)\r\n    const currentWeek = getWeekId()\r\n    if (!u.week || u.week !== currentWeek) return { week: currentWeek, used: 0 }\r\n    return { week: String(u.week), used: Number(u.used) || 0 }\r\n  } catch {\r\n    return { week: getWeekId(), used: 0 }\r\n  }\r\n}\r\n\r\nexport function setOnlineUsage(user: string, usage: Usage) {\r\n  try { localStorage.setItem(KEY(user), JSON.stringify(usage)) } catch {}\r\n}\r\n\r\nexport function incOnlineUsage(user: string, cap = 3): Usage {\r\n  const currentWeek = getWeekId()\r\n  const u = getOnlineUsage(user)\r\n  const next: Usage = { week: currentWeek, used: (u.week === currentWeek ? u.used : 0) + 1 }\r\n  // clamp to cap, though we still store the number\r\n  setOnlineUsage(user, next)\r\n  return next\r\n}\r\n\r\nexport function getFreeRemaining(user: string, cap = 3): number {\r\n  const u = getOnlineUsage(user)\r\n  return Math.max(0, cap - (u.used || 0))\r\n}\r\n","import { useEffect, useState } from 'react'\r\n\r\nconst LS_KEY = 'ndn:isAdmin:v1'\r\n\r\ntype Cache = { [email: string]: { v: boolean; ts: number } }\r\n\r\nfunction getCache(): Cache {\r\n  try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : {} } catch { return {} }\r\n}\r\nfunction setCache(email: string, v: boolean) {\r\n  try {\r\n    const c = getCache()\r\n    c[(email||'').toLowerCase()] = { v, ts: Date.now() }\r\n    localStorage.setItem(LS_KEY, JSON.stringify(c))\r\n  } catch {}\r\n}\r\n\r\nexport async function fetchIsAdmin(email?: string|null): Promise<boolean> {\r\n  const e = String(email || '').toLowerCase()\r\n  if (!e) return false\r\n  // Immediate fallbacks: owner env or local override (dev)\r\n  try {\r\n    const owner = String((import.meta as any)?.env?.VITE_OWNER_EMAIL || '').toLowerCase()\r\n    if (owner && e === owner) return true\r\n  } catch {}\r\n  // Hard fallback to known owner (repo default) if nothing else is set\r\n  if (e === 'daviesfamily108@gmail.com') return true\r\n  try {\r\n    const force = localStorage.getItem('ndn:forceAdmin')\r\n    if (force === '1' || force === 'true') return true\r\n  } catch {}\r\n  // try cache first (5 minutes)\r\n  const c = getCache()\r\n  const hit = c[e]\r\n  if (hit && (Date.now() - hit.ts) < 5 * 60 * 1000) return !!hit.v\r\n  try {\r\n    const res = await fetch(`/api/admins/check?email=${encodeURIComponent(e)}`)\r\n    const data = await res.json().catch(()=>({}))\r\n    const v = !!data?.isAdmin\r\n    setCache(e, v)\r\n    return v\r\n  } catch {\r\n    return !!(hit?.v)\r\n  }\r\n}\r\n\r\nexport function useIsAdmin(email?: string|null) {\r\n  const e = String(email || '').toLowerCase()\r\n  const [isAdmin, setIsAdmin] = useState(false)\r\n  useEffect(() => {\r\n    let on = true\r\n    if (!e) { setIsAdmin(false); return }\r\n    // Instant fallbacks before API\r\n    try {\r\n      const owner = String((import.meta as any)?.env?.VITE_OWNER_EMAIL || '').toLowerCase()\r\n      const force = ((): boolean => { try { const v = localStorage.getItem('ndn:forceAdmin'); return v === '1' || v === 'true' } catch { return false } })()\r\n      if (owner && e === owner) { setIsAdmin(true); return }\r\n      if (force) { setIsAdmin(true); return }\r\n    } catch {}\r\n    if (e === 'daviesfamily108@gmail.com') { setIsAdmin(true); return }\r\n    fetchIsAdmin(e).then(v => { if (on) setIsAdmin(!!v) })\r\n    return () => { on = false }\r\n  }, [e])\r\n  return isAdmin\r\n}\r\n","// Demo pricing: base is £5 GBP. Convert to user currency for display.\r\nexport const BASE_PRICE_GBP = 5\r\n\r\n// Simple static FX rates for display (not for real billing). Updated rarely.\r\nconst FX: Record<string, number> = {\r\n\tGBP: 1,\r\n\tEUR: 1.16, // € per £\r\n\tUSD: 1.26, // $ per £\r\n\tAUD: 1.92,\r\n\tNZD: 2.08,\r\n\tCAD: 1.73,\r\n}\r\n\r\nexport function formatPriceInCurrency(currency: string, gbpAmount = BASE_PRICE_GBP) {\r\n\tconst cur = (currency || 'GBP').toUpperCase()\r\n\tconst rate = FX[cur] ?? 1\r\n\tconst val = gbpAmount * rate\r\n\ttry {\r\n\t\treturn new Intl.NumberFormat(undefined, { style: 'currency', currency: cur }).format(val)\r\n\t} catch {\r\n\t\t// Fallback\r\n\t\treturn `${cur} ${val.toFixed(2)}`\r\n\t}\r\n}\r\n\r\nexport function getUserCurrency(): string {\r\n\ttry {\r\n\t\t// Heuristic: infer from locale\r\n\t\tconst parts = new Intl.NumberFormat().resolvedOptions()\r\n\t\t// Example: en-GB -> GBP, en-US -> USD, en-AU -> AUD, etc. Not 100% accurate.\r\n\t\tconst m = String(parts.locale).toLowerCase()\r\n\t\tif (m.includes('-gb')) return 'GBP'\r\n\t\tif (m.includes('-ie') || m.includes('-de') || m.includes('-fr') || m.includes('-es') || m.includes('-it') || m.includes('-nl')) return 'EUR'\r\n\t\tif (m.includes('-us')) return 'USD'\r\n\t\tif (m.includes('-au')) return 'AUD'\r\n\t\tif (m.includes('-nz')) return 'NZD'\r\n\t\tif (m.includes('-ca')) return 'CAD'\r\n\t\treturn 'GBP'\r\n\t} catch {\r\n\t\treturn 'GBP'\r\n\t}\r\n}\r\n\r\n// Centralized Discord invite; override via VITE_DISCORD_INVITE_URL in Render/Netlify\r\nexport const DISCORD_INVITE_URL: string = (import.meta as any).env?.VITE_DISCORD_INVITE_URL || 'https://discord.gg/nCfT4hJz'\r\n","export type ApiPath = string;\r\n\r\nlet cachedBaseUrl: string | null = null;\r\n\r\nfunction computeApiBase(): string {\r\n  if (cachedBaseUrl) return cachedBaseUrl;\r\n  const envUrl = ((import.meta as any)?.env?.VITE_API_URL as string | undefined)?.trim();\r\n  if (envUrl) {\r\n    cachedBaseUrl = envUrl.replace(/\\/$/, '');\r\n    return cachedBaseUrl;\r\n  }\r\n  if (typeof window !== 'undefined') {\r\n    const { protocol, host, hostname } = window.location;\r\n    const sameOrigin = `${protocol}//${host}`;\r\n    if (hostname.endsWith('onrender.com') || hostname === 'localhost' || hostname === '127.0.0.1') {\r\n      cachedBaseUrl = sameOrigin.replace(/\\/$/, '');\r\n    } else {\r\n      cachedBaseUrl = 'https://ninedartnation.onrender.com';\r\n    }\r\n    return cachedBaseUrl;\r\n  }\r\n  // Fallback for build/test environments without window\r\n  cachedBaseUrl = 'https://ninedartnation.onrender.com';\r\n  return cachedBaseUrl;\r\n}\r\n\r\nfunction normalizePath(path: ApiPath): string {\r\n  if (/^https?:\\/\\//i.test(path)) return path;\r\n  const base = computeApiBase();\r\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\r\n  return `${base}${cleanPath}`;\r\n}\r\n\r\nexport function resolveApiUrl(path: ApiPath): string {\r\n  return normalizePath(path);\r\n}\r\n\r\nexport function apiFetch(path: ApiPath, init?: RequestInit) {\r\n  const url = resolveApiUrl(path);\r\n  return fetch(url, init);\r\n}\r\n\r\nexport function installApiInterceptor() {\r\n  if (typeof window === 'undefined' || typeof window.fetch !== 'function') return;\r\n  const anyWindow = window as typeof window & { __ndnApiPatched?: boolean };\r\n  if (anyWindow.__ndnApiPatched) return;\r\n  const originalFetch = window.fetch.bind(window);\r\n  window.fetch = (input: RequestInfo | URL, init?: RequestInit) => {\r\n    try {\r\n      if (typeof input === 'string') {\r\n        if (input.startsWith('/')) {\r\n          return originalFetch(resolveApiUrl(input), init);\r\n        }\r\n        return originalFetch(input, init);\r\n      }\r\n      if (input instanceof Request) {\r\n        const reqUrl = input.url.startsWith('/') ? resolveApiUrl(input.url) : input.url;\r\n        if (reqUrl === input.url) {\r\n          return originalFetch(input, init);\r\n        }\r\n        const cloned = new Request(reqUrl, input);\r\n        return originalFetch(cloned, init);\r\n      }\r\n      if (input instanceof URL) {\r\n        const href = input.href.startsWith('/') ? resolveApiUrl(input.href) : input.href;\r\n        return originalFetch(href, init);\r\n      }\r\n    } catch (err) {\r\n      console.warn('[API] Interceptor failed, falling back to original fetch', err);\r\n    }\r\n    return originalFetch(input as any, init);\r\n  };\r\n  anyWindow.__ndnApiPatched = true;\r\n}\r\n","import { LayoutDashboard, Camera, Users, Trophy, Settings, MessageCircle, Lock, PoundSterling, Bell } from 'lucide-react';\r\nimport { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { getFreeRemaining } from '../utils/quota'\r\nimport { useIsAdmin } from '../utils/admin'\r\nimport { DISCORD_INVITE_URL } from '../utils/config'\r\nimport { apiFetch } from '../utils/api'\r\n\r\nexport type TabKey = 'score' | 'online' | 'offline' | 'friends' | 'stats' | 'calibrate' | 'settings' | 'admin' | 'tournaments' | 'fullaccess';\r\n\r\nexport function getTabs(user: any) {\r\n  const baseTabs = [\r\n    { key: 'score', label: 'Home', icon: LayoutDashboard },\r\n    { key: 'online', label: 'Online', icon: Users },\r\n    { key: 'offline', label: 'Offline', icon: Trophy },\r\n    { key: 'tournaments', label: 'Tournaments', icon: Trophy },\r\n    { key: 'friends', label: 'Friends', icon: Users },\r\n    { key: 'stats', label: 'Stats', icon: Trophy },\r\n    { key: 'calibrate', label: 'Calibrate', icon: Camera },\r\n    { key: 'settings', label: 'Settings', icon: Settings },\r\n  ];\r\n  // Admin tab visibility handled in Sidebar via hook (client-side fetch)\r\n  if (!user?.fullAccess) {\r\n    baseTabs.push({ key: 'fullaccess', label: 'PREMIUM £€$', icon: PoundSterling });\r\n  }\r\n  return baseTabs;\r\n}\r\n\r\nexport function Sidebar({\r\n  active,\r\n  onChange,\r\n  user,\r\n  className,\r\n}: {\r\n  active: TabKey;\r\n  onChange: (key: TabKey) => void;\r\n  user: any;\r\n  className?: string;\r\n}) {\r\n  const tabs = getTabs(user);\r\n  const isAdmin = useIsAdmin(user?.email)\r\n  // IMPORTANT: Admin tab is ONLY shown for explicitly granted admin users\r\n  // Premium status does NOT automatically grant admin access\r\n  // Admin access must be granted via /api/admins/grant endpoint by the owner\r\n  if (isAdmin && !tabs.some(t => t.key === 'admin')) {\r\n    const idx = tabs.findIndex(t => t.key === 'settings')\r\n    const adminTab = { key: 'admin', label: 'Admin', icon: Settings } as const\r\n    if (idx >= 0) tabs.splice(idx, 0, adminTab as any); else tabs.push(adminTab as any)\r\n  }\r\n  const [showDiscord, setShowDiscord] = useState(false);\r\n  const [showNDNDiscord, setShowNDNDiscord] = useState(false);\r\n  const freeLeft = user?.username && !user?.fullAccess ? getFreeRemaining(user.username) : Infinity\r\n  \r\n  // Notification counts\r\n  const [notifications, setNotifications] = useState({\r\n    friendRequests: 0,\r\n    messages: 0,\r\n    tournaments: 0\r\n  });\r\n  \r\n  // Fetch notification counts\r\n  useEffect(() => {\r\n    if (!user?.email) return;\r\n    \r\n    const fetchNotifications = async () => {\r\n      try {\r\n        const [requestsRes, messagesRes] = await Promise.all([\r\n          apiFetch(`/api/friends/requests?email=${encodeURIComponent(user.email)}`),\r\n          apiFetch(`/api/friends/messages?email=${encodeURIComponent(user.email)}`)\r\n        ]);\r\n        \r\n        const requests = requestsRes.ok ? await requestsRes.json() : { requests: [] };\r\n        const messages = messagesRes.ok ? await messagesRes.json() : { messages: [] };\r\n        \r\n        // Count unread messages (messages without read status, assuming all are unread for now)\r\n        const unreadMessages = messages.messages?.filter((m: any) => !m.read).length || 0;\r\n        \r\n        setNotifications({\r\n          friendRequests: requests.requests?.length || 0,\r\n          messages: unreadMessages,\r\n          tournaments: 0 // TODO: Add tournament notifications\r\n        });\r\n      } catch (err) {\r\n        console.error('Failed to fetch notifications:', err);\r\n      }\r\n    };\r\n    \r\n    fetchNotifications();\r\n    // Refresh every 30 seconds\r\n    const interval = setInterval(fetchNotifications, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [user?.email]);\r\n  \r\n  useEffect(() => {\r\n    if (!showDiscord) return\r\n    const onKey = (e: KeyboardEvent) => { if (e.key === 'Escape' || e.key === 'Enter') setShowDiscord(false) }\r\n    document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [showDiscord])\r\n  return (\r\n    <aside className={`${user?.fullAccess ? 'premium-sidebar' : ''} sidebar glass ${className ? '' : 'w-60'} p-2 sm:p-4 rounded-2xl ${className ?? 'hidden sm:flex'} flex-col gap-2 overflow-y-auto overflow-x-hidden ${className ? '' : 'fixed top-2 bottom-2 sm:top-4 sm:bottom-4'}`}>\r\n      {tabs.map(({ key, label, icon: Icon }) => {\r\n  if (key === 'admin' && !isAdmin) return null\r\n        return (\r\n        <button\r\n          key={key}\r\n          className={`tab whitespace-nowrap flex items-center justify-start gap-3 ${active === key ? 'tab--active' : 'tab--inactive'} ${key === 'fullaccess' ? '' : ''}`}\r\n          onClick={() => onChange(key as TabKey)}\r\n          title={label}\r\n          style={{ fontWeight: 700, fontSize: '1.1rem', color: active === key ? '#fff' : '#E5E7EB', letterSpacing: '0.02em' }}\r\n        >\r\n          <Icon className=\"w-6 h-6\" />\r\n          <span className=\"flex items-center gap-2\">\r\n            {label}\r\n            {key === 'online' && !user?.fullAccess && freeLeft <= 0 && (\r\n              <span title=\"Weekly free games used\" className=\"inline-flex items-center gap-1 text-[0.65rem] px-2 py-0.5 rounded-full bg-rose-600 text-white\">\r\n                <Lock className=\"w-3 h-3\" />\r\n                Locked\r\n              </span>\r\n            )}\r\n            {/* Notification badges */}\r\n            {key === 'friends' && notifications.friendRequests > 0 && (\r\n              <span className=\"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full\">\r\n                {notifications.friendRequests > 9 ? '9+' : notifications.friendRequests}\r\n              </span>\r\n            )}\r\n            {key === 'score' && (notifications.messages > 0 || notifications.tournaments > 0) && (\r\n              <span className=\"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-orange-500 rounded-full\">\r\n                {(notifications.messages + notifications.tournaments) > 9 ? '9+' : (notifications.messages + notifications.tournaments)}\r\n              </span>\r\n            )}\r\n          </span>\r\n          {/* Only the tab label should show PREMIUM; remove extra badge */}\r\n        </button>\r\n        )\r\n      })}\r\n      {/* Discord tab at the end */}\r\n      <button\r\n        className=\"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-2\"\r\n        onClick={() => setShowDiscord(true)}\r\n        title=\"BullseyeDartsLeague\"\r\n        style={{ fontWeight: 700, fontSize: '1.1rem', letterSpacing: '0.02em' }}\r\n      >\r\n        <MessageCircle className=\"w-6 h-6\" />\r\n        <span className=\"truncate\">BullseyeDartsLeague</span>\r\n      </button>\r\n      {/* NineDartNation Discord tab */}\r\n      <button\r\n        className=\"tab tab--compact whitespace-nowrap flex items-center justify-start gap-3 bg-[#5865F2] text-white mt-1\"\r\n        onClick={() => setShowNDNDiscord(true)}\r\n        title=\"NineDartNation\"\r\n        style={{ fontWeight: 700, fontSize: '1.1rem', letterSpacing: '0.02em' }}\r\n      >\r\n        <MessageCircle className=\"w-6 h-6\" />\r\n        <span className=\"truncate\">NineDartNation</span>\r\n      </button>\r\n      {/* Discord about dialog via portal */}\r\n      {showDiscord && createPortal(\r\n        <div className=\"fixed inset-0 z-[1000]\">\r\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setShowDiscord(false)} onTouchStart={() => setShowDiscord(false)} />\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <div role=\"dialog\" aria-modal=\"true\" className=\"card max-w-md w-full relative text-left p-6 rounded-xl\">\r\n              <button className=\"absolute -top-3 -right-3 btn px-3 py-1\" aria-label=\"Close\" onClick={() => setShowDiscord(false)}>✕</button>\r\n              <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]\">\r\n                <MessageCircle className=\"w-6 h-6\" /> BullseyeDartsLeague\r\n              </h3>\r\n              <div className=\"mb-4 text-lg font-semibold\">Join this fantastic Online Darts League with divisions and other cool stuff included</div>\r\n        <a\r\n          href={DISCORD_INVITE_URL}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer nofollow\"\r\n                className=\"btn bg-[#5865F2] text-white w-full font-bold text-lg\"\r\n              >\r\n                Join Discord\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n      {/* NineDartNation Discord about dialog via portal */}\r\n      {showNDNDiscord && createPortal(\r\n        <div className=\"fixed inset-0 z-[1000]\">\r\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setShowNDNDiscord(false)} onTouchStart={() => setShowNDNDiscord(false)} />\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <div role=\"dialog\" aria-modal=\"true\" className=\"card max-w-md w-full relative text-left p-6 rounded-xl\">\r\n              <button className=\"absolute -top-3 -right-3 btn px-3 py-1\" aria-label=\"Close\" onClick={() => setShowNDNDiscord(false)}>✕</button>\r\n              <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-[#8ea1e1]\">\r\n                <MessageCircle className=\"w-6 h-6\" /> NineDartNation\r\n              </h3>\r\n              <div className=\"mb-4 text-lg font-semibold\">Join the NineDartNation Discord community</div>\r\n        <a\r\n          href=\"https://discord.gg/Q33J5FTVve\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer nofollow\"\r\n                className=\"btn bg-[#5865F2] text-white w-full font-bold text-lg\"\r\n              >\r\n                Join Discord\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </aside>\r\n  )\r\n}\r\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (!Object.is(nextState, state)) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\" || nextState === null) ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const getInitialState = () => initialState;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected.\"\n      );\n    }\n    listeners.clear();\n  };\n  const api = { setState, getState, getInitialState, subscribe, destroy };\n  const initialState = state = createState(setState, getState, api);\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\nvar vanilla = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use import { createStore } from 'zustand/vanilla'.\"\n    );\n  }\n  return createStore(createState);\n};\n\nexport { createStore, vanilla as default };\n","/**\n * @license React\n * use-sync-external-store-shim.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useState = React.useState,\n  useEffect = React.useEffect,\n  useLayoutEffect = React.useLayoutEffect,\n  useDebugValue = React.useDebugValue;\nfunction useSyncExternalStore$2(subscribe, getSnapshot) {\n  var value = getSnapshot(),\n    _useState = useState({ inst: { value: value, getSnapshot: getSnapshot } }),\n    inst = _useState[0].inst,\n    forceUpdate = _useState[1];\n  useLayoutEffect(\n    function () {\n      inst.value = value;\n      inst.getSnapshot = getSnapshot;\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n    },\n    [subscribe, value, getSnapshot]\n  );\n  useEffect(\n    function () {\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      return subscribe(function () {\n        checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      });\n    },\n    [subscribe]\n  );\n  useDebugValue(value);\n  return value;\n}\nfunction checkIfSnapshotChanged(inst) {\n  var latestGetSnapshot = inst.getSnapshot;\n  inst = inst.value;\n  try {\n    var nextValue = latestGetSnapshot();\n    return !objectIs(inst, nextValue);\n  } catch (error) {\n    return !0;\n  }\n}\nfunction useSyncExternalStore$1(subscribe, getSnapshot) {\n  return getSnapshot();\n}\nvar shim =\n  \"undefined\" === typeof window ||\n  \"undefined\" === typeof window.document ||\n  \"undefined\" === typeof window.document.createElement\n    ? useSyncExternalStore$1\n    : useSyncExternalStore$2;\nexports.useSyncExternalStore =\n  void 0 !== React.useSyncExternalStore ? React.useSyncExternalStore : shim;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","/**\n * @license React\n * use-sync-external-store-shim/with-selector.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\"),\n  shim = require(\"use-sync-external-store/shim\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useSyncExternalStore = shim.useSyncExternalStore,\n  useRef = React.useRef,\n  useEffect = React.useEffect,\n  useMemo = React.useMemo,\n  useDebugValue = React.useDebugValue;\nexports.useSyncExternalStoreWithSelector = function (\n  subscribe,\n  getSnapshot,\n  getServerSnapshot,\n  selector,\n  isEqual\n) {\n  var instRef = useRef(null);\n  if (null === instRef.current) {\n    var inst = { hasValue: !1, value: null };\n    instRef.current = inst;\n  } else inst = instRef.current;\n  instRef = useMemo(\n    function () {\n      function memoizedSelector(nextSnapshot) {\n        if (!hasMemo) {\n          hasMemo = !0;\n          memoizedSnapshot = nextSnapshot;\n          nextSnapshot = selector(nextSnapshot);\n          if (void 0 !== isEqual && inst.hasValue) {\n            var currentSelection = inst.value;\n            if (isEqual(currentSelection, nextSnapshot))\n              return (memoizedSelection = currentSelection);\n          }\n          return (memoizedSelection = nextSnapshot);\n        }\n        currentSelection = memoizedSelection;\n        if (objectIs(memoizedSnapshot, nextSnapshot)) return currentSelection;\n        var nextSelection = selector(nextSnapshot);\n        if (void 0 !== isEqual && isEqual(currentSelection, nextSelection))\n          return (memoizedSnapshot = nextSnapshot), currentSelection;\n        memoizedSnapshot = nextSnapshot;\n        return (memoizedSelection = nextSelection);\n      }\n      var hasMemo = !1,\n        memoizedSnapshot,\n        memoizedSelection,\n        maybeGetServerSnapshot =\n          void 0 === getServerSnapshot ? null : getServerSnapshot;\n      return [\n        function () {\n          return memoizedSelector(getSnapshot());\n        },\n        null === maybeGetServerSnapshot\n          ? void 0\n          : function () {\n              return memoizedSelector(maybeGetServerSnapshot());\n            }\n      ];\n    },\n    [getSnapshot, getServerSnapshot, selector, isEqual]\n  );\n  var value = useSyncExternalStore(subscribe, instRef[0], instRef[1]);\n  useEffect(\n    function () {\n      inst.hasValue = !0;\n      inst.value = value;\n    },\n    [value]\n  );\n  useDebugValue(value);\n  return value;\n};\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.development.js');\n}\n","import { createStore } from 'zustand/vanilla';\nexport * from 'zustand/vanilla';\nimport ReactExports from 'react';\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector.js';\n\nconst { useDebugValue } = ReactExports;\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports;\nlet didWarnAboutEqualityFn = false;\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity, equalityFn) {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && equalityFn && !didWarnAboutEqualityFn) {\n    console.warn(\n      \"[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937\"\n    );\n    didWarnAboutEqualityFn = true;\n  }\n  const slice = useSyncExternalStoreWithSelector(\n    api.subscribe,\n    api.getState,\n    api.getServerState || api.getInitialState,\n    selector,\n    equalityFn\n  );\n  useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && typeof createState !== \"function\") {\n    console.warn(\n      \"[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.\"\n    );\n  }\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useBoundStore = (selector, equalityFn) => useStore(api, selector, equalityFn);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = (createState) => createState ? createImpl(createState) : createImpl;\nvar react = (createState) => {\n  if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n    console.warn(\n      \"[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`.\"\n    );\n  }\n  return create(createState);\n};\n\nexport { create, react as default, useStore };\n","import { create } from 'zustand'\r\n\r\ntype Toast = { id: number; message: string; type?: 'info'|'success'|'error'; timeout?: number }\r\n\r\ntype ToastState = {\r\n  toasts: Toast[]\r\n  push: (message: string, opts?: { type?: 'info'|'success'|'error'; timeout?: number }) => void\r\n  remove: (id: number) => void\r\n  clear: () => void\r\n}\r\n\r\nlet nextId = 1\r\n\r\nexport const useToastStore = create<ToastState>((set) => ({\r\n  toasts: [],\r\n  push: (message, opts) => set((s) => {\r\n    const id = nextId++\r\n    const t: Toast = { id, message, type: opts?.type || 'info', timeout: opts?.timeout ?? 3000 }\r\n    // auto-remove after timeout\r\n    if (t.timeout && t.timeout > 0) {\r\n      setTimeout(() => {\r\n        set((cur) => ({ toasts: cur.toasts.filter(x => x.id !== id) }))\r\n      }, t.timeout)\r\n    }\r\n    return { toasts: [...s.toasts, t] }\r\n  }),\r\n  remove: (id) => set((s) => ({ toasts: s.toasts.filter(t => t.id !== id) })),\r\n  clear: () => set({ toasts: [] }),\r\n}))\r\n\r\nexport function useToast() {\r\n  const push = useToastStore(s => s.push)\r\n  return push\r\n}\r\n","export function threeDartAverage(totalScore: number, darts: number): number {\r\n  if (darts === 0) return 0\r\n  return (totalScore / darts) * 3\r\n}\r\n\r\nexport function formatAvg(n?: number) {\r\n  return (n ?? 0).toFixed(2)\r\n}\r\n","export type AllTimeTotals = {\r\n  darts: number\r\n  scored: number\r\n  fnDarts?: number\r\n  fnScored?: number\r\n  // All-time quality metrics\r\n  best3?: number // highest 3-dart avg achieved in a finished leg\r\n  worst3?: number // lowest 3-dart avg achieved in a finished leg\r\n  bestLegDarts?: number // fewest darts to finish a winning leg\r\n  bestCheckout?: number // highest checkout score achieved\r\n  worstLegDarts?: number // most darts in a winning leg (optional)\r\n  bestFNAvg?: number // best per-leg first-nine average\r\n  worstFNAvg?: number // worst per-leg first-nine average\r\n}\r\ntype StatEntry = { t: number; darts: number; scored: number; fnDarts?: number; fnScored?: number }\r\nexport type GameModeStat = { played: number; won: number }\r\nexport type GameModeStats = Record<string, GameModeStat>\r\n\r\nconst keyFor = (name: string) => `ndn_stats_${name}`\r\nconst keySeriesFor = (name: string) => `ndn_stats_ts_${name}`\r\nconst keyDailyFor = (name: string) => `ndn_stats_daily_${name}`\r\n\r\nexport function getAllTime(name: string): AllTimeTotals {\r\n  try {\r\n    const raw = localStorage.getItem(keyFor(name))\r\n    if (!raw) return { darts: 0, scored: 0 }\r\n    const parsed = JSON.parse(raw)\r\n    return {\r\n      darts: Number(parsed.darts) || 0,\r\n      scored: Number(parsed.scored) || 0,\r\n      fnDarts: Number(parsed.fnDarts) || 0,\r\n      fnScored: Number(parsed.fnScored) || 0,\r\n      best3: typeof parsed.best3 === 'number' ? parsed.best3 : 0,\r\n      worst3: typeof parsed.worst3 === 'number' ? parsed.worst3 : 0,\r\n      bestLegDarts: typeof parsed.bestLegDarts === 'number' ? parsed.bestLegDarts : 0,\r\n      bestCheckout: typeof parsed.bestCheckout === 'number' ? parsed.bestCheckout : 0,\r\n      worstLegDarts: typeof parsed.worstLegDarts === 'number' ? parsed.worstLegDarts : 0,\r\n      bestFNAvg: typeof parsed.bestFNAvg === 'number' ? parsed.bestFNAvg : 0,\r\n      worstFNAvg: typeof parsed.worstFNAvg === 'number' ? parsed.worstFNAvg : 0,\r\n    }\r\n  } catch {\r\n    return { darts: 0, scored: 0 }\r\n  }\r\n}\r\n\r\nexport function setAllTime(name: string, totals: AllTimeTotals) {\r\n  try {\r\n    localStorage.setItem(keyFor(name), JSON.stringify(totals))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name, totals } }))\r\n  } catch {}\r\n}\r\n\r\n// Clear all stored stats for a user (all-time totals, time-series, and daily snapshot)\r\nexport function clearAllStats(name: string) {\r\n  try {\r\n    localStorage.removeItem(keyFor(name))\r\n    localStorage.removeItem(keySeriesFor(name))\r\n    localStorage.removeItem(keyDailyFor(name))\r\n  } catch {}\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name, cleared: true } }))\r\n  } catch {}\r\n}\r\n\r\nexport function getAllTimeAvg(name: string): number {\r\n  const { darts, scored } = getAllTime(name)\r\n  if (!darts) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\nexport function getAllTimeFirstNineAvg(name: string): number {\r\n  const { fnDarts = 0, fnScored = 0 } = getAllTime(name)\r\n  if (!fnDarts) return 0\r\n  return (fnScored / fnDarts) * 3\r\n}\r\n\r\n// All-time quality metric getters\r\nexport function getAllTimeBestWorst(name: string): { best3: number; worst3: number } {\r\n  const { best3 = 0, worst3 = 0 } = getAllTime(name)\r\n  return { best3, worst3 }\r\n}\r\nexport function getAllTimeBestLeg(name: string): number {\r\n  const { bestLegDarts = 0 } = getAllTime(name)\r\n  return bestLegDarts || 0\r\n}\r\nexport function getAllTimeBestCheckout(name: string): number {\r\n  const { bestCheckout = 0 } = getAllTime(name)\r\n  return bestCheckout || 0\r\n}\r\n\r\n// --- Per-game-mode played/won stats (local-only demo) ---\r\nconst keyGameModes = 'ndn_game_mode_stats'\r\n\r\nexport function getGameModeStats(allModeKeys?: string[]): GameModeStats {\r\n  let obj: GameModeStats = {}\r\n  try {\r\n    const raw = localStorage.getItem(keyGameModes)\r\n    if (raw) obj = JSON.parse(raw)\r\n  } catch {}\r\n  // Ensure requested keys exist with zeros so charts are stable\r\n  if (Array.isArray(allModeKeys)) {\r\n    for (const k of allModeKeys) {\r\n      if (!obj[k]) obj[k] = { played: 0, won: 0 }\r\n    }\r\n  }\r\n  return obj\r\n}\r\n\r\nexport function setGameModeStats(stats: GameModeStats) {\r\n  try {\r\n    localStorage.setItem(keyGameModes, JSON.stringify(stats))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { gameModes: true } }))\r\n  } catch {}\r\n}\r\n\r\nexport function bumpGameMode(mode: string, won: boolean) {\r\n  const current = getGameModeStats()\r\n  const entry = current[mode] || { played: 0, won: 0 }\r\n  entry.played += 1\r\n  if (won) entry.won += 1\r\n  current[mode] = entry\r\n  setGameModeStats(current)\r\n}\r\n\r\n// Time-series helpers for rolling averages\r\nfunction getSeries(name: string): StatEntry[] {\r\n  try {\r\n    const raw = localStorage.getItem(keySeriesFor(name))\r\n    if (!raw) return []\r\n    const arr = JSON.parse(raw)\r\n    if (!Array.isArray(arr)) return []\r\n    return arr.map((e: any) => ({\r\n      t: Number(e.t)||0,\r\n      darts: Number(e.darts)||0,\r\n      scored: Number(e.scored)||0,\r\n      fnDarts: Number(e.fnDarts)||0,\r\n      fnScored: Number(e.fnScored)||0,\r\n    })).filter(e => e.t > 0)\r\n  } catch { return [] }\r\n}\r\n\r\nfunction setSeries(name: string, entries: StatEntry[]) {\r\n  try {\r\n    localStorage.setItem(keySeriesFor(name), JSON.stringify(entries))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name } }))\r\n  } catch {}\r\n}\r\n\r\nfunction pruneOld(entries: StatEntry[], maxAgeMs: number): StatEntry[] {\r\n  const now = Date.now()\r\n  return entries.filter(e => now - e.t <= maxAgeMs)\r\n}\r\n\r\nexport function addSample(name: string, darts: number, scored: number, when: number = Date.now(), fnDarts?: number, fnScored?: number) {\r\n  if (darts <= 0) return\r\n  const list = getSeries(name)\r\n  const next = pruneOld([...list, { t: when, darts, scored, fnDarts, fnScored }], 1000 * 60 * 60 * 24 * 30) // keep ~30 days\r\n  setSeries(name, next)\r\n}\r\n\r\nexport function getRollingAvg(name: string, windowMs: number = 1000 * 60 * 60 * 24): number {\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  let darts = 0, scored = 0\r\n  for (const e of list) {\r\n    if (now - e.t <= windowMs) { darts += e.darts; scored += e.scored }\r\n  }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\nexport function getRollingFirstNineAvg(name: string, windowMs: number = 1000 * 60 * 60 * 24 * 30): number {\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  let darts = 0, scored = 0\r\n  for (const e of list) {\r\n    if (now - e.t <= windowMs) {\r\n      darts += (e.fnDarts || 0)\r\n      scored += (e.fnScored || 0)\r\n    }\r\n  }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\n\r\n// Daily adjusted average: recompute from last 24h at most once per 24h and persist the last value\r\ntype DailySnapshot = { avg: number; ts: number }\r\n\r\nfunction getDailySnapshot(name: string): DailySnapshot | null {\r\n  try {\r\n    const raw = localStorage.getItem(keyDailyFor(name))\r\n    if (!raw) return null\r\n    const j = JSON.parse(raw)\r\n    return { avg: Number(j.avg) || 0, ts: Number(j.ts) || 0 }\r\n  } catch { return null }\r\n}\r\n\r\nfunction setDailySnapshot(name: string, snap: DailySnapshot) {\r\n  try {\r\n    localStorage.setItem(keyDailyFor(name), JSON.stringify(snap))\r\n    window.dispatchEvent(new CustomEvent('ndn:stats-updated', { detail: { name } }))\r\n  } catch {}\r\n}\r\n\r\nexport function getDailyAdjustedAvg(name: string): number {\r\n  const snap = getDailySnapshot(name)\r\n  const now = Date.now()\r\n  const DAY = 1000 * 60 * 60 * 24\r\n  if (snap && now - snap.ts < DAY) return snap.avg\r\n  // Need to compute a new daily value from the last 24h of samples\r\n  const ra = getRollingAvg(name, DAY)\r\n  const next: DailySnapshot = { avg: ra, ts: now }\r\n  setDailySnapshot(name, next)\r\n  return ra\r\n}\r\n\r\n// Convenience helpers for monthly (last ~30 days) averages\r\nexport function getMonthlyAvg3(name: string): number {\r\n  const THIRTY_DAYS = 1000 * 60 * 60 * 24 * 30\r\n  const list = getSeries(name)\r\n  if (!list.length) return 0\r\n  const now = Date.now()\r\n  // Prefer match-aggregated entries (those with fnDarts defined) to avoid double counting with per-visit samples\r\n  const windowed = list.filter(e => now - e.t <= THIRTY_DAYS)\r\n  const matchOnly = windowed.filter(e => typeof e.fnDarts === 'number')\r\n  const use = matchOnly.length ? matchOnly : windowed\r\n  let darts = 0, scored = 0\r\n  for (const e of use) { darts += e.darts; scored += e.scored }\r\n  if (darts <= 0) return 0\r\n  return (scored / darts) * 3\r\n}\r\nexport function getMonthlyFirstNineAvg(name: string): number {\r\n  const THIRTY_DAYS = 1000 * 60 * 60 * 24 * 30\r\n  return getRollingFirstNineAvg(name, THIRTY_DAYS)\r\n}\r\n\r\n// Update all players' all-time totals given a finished match roster\r\nimport type { Player, Leg } from './match'\r\nexport function addMatchToAllTime(players: Player[]) {\r\n  for (const p of players) {\r\n    // Sum over finished legs\r\n    let darts = 0\r\n    let scored = 0\r\n    let fnDarts = 0\r\n    let fnScored = 0\r\n    // Per-match quality metrics\r\n    let matchBest3 = 0\r\n    let matchWorst3 = 0\r\n    let matchBestLegDarts = 0 // track fewest darts on a winning leg only\r\n    let matchBestCheckout = 0\r\n    let matchWorstLegDarts = 0 // most darts on a winning leg\r\n    let matchBestFNAvg = 0\r\n    let matchWorstFNAvg = 0\r\n    for (const leg of p.legs) {\r\n      if (!leg.finished) continue\r\n      darts += leg.dartsThrown\r\n      scored += Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining)\r\n      // First nine darts aggregation (or fewer if leg ended earlier)\r\n      const { d: legFnDarts, s: legFnScored } = sumFirstNine(leg)\r\n      fnDarts += legFnDarts\r\n      fnScored += legFnScored\r\n      // Quality metrics per leg\r\n      const legDarts = Math.max(0, leg.dartsThrown)\r\n      const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining)\r\n      const legAvg = legDarts > 0 ? (legScored / legDarts) * 3 : 0\r\n      const legFNAvg = legFnDarts > 0 ? (legFnScored / legFnDarts) * 3 : 0\r\n      if (legAvg > 0) {\r\n        matchBest3 = Math.max(matchBest3, legAvg)\r\n        matchWorst3 = matchWorst3 === 0 ? legAvg : Math.min(matchWorst3, legAvg)\r\n      }\r\n      if (legFNAvg > 0) {\r\n        matchBestFNAvg = Math.max(matchBestFNAvg, legFNAvg)\r\n        matchWorstFNAvg = matchWorstFNAvg === 0 ? legFNAvg : Math.min(matchWorstFNAvg, legFNAvg)\r\n      }\r\n      const wasCheckout = leg.totalScoreRemaining === 0\r\n      if (wasCheckout) {\r\n        if (matchBestLegDarts === 0 || legDarts < matchBestLegDarts) matchBestLegDarts = legDarts\r\n        if (matchWorstLegDarts === 0 || legDarts > matchWorstLegDarts) matchWorstLegDarts = legDarts\r\n        const co = typeof leg.checkoutScore === 'number' ? leg.checkoutScore : 0\r\n        if (co > matchBestCheckout) matchBestCheckout = co\r\n      }\r\n    }\r\n    if (darts > 0) {\r\n      const prev = getAllTime(p.name)\r\n      const next: AllTimeTotals = {\r\n        darts: prev.darts + darts,\r\n        scored: prev.scored + scored,\r\n        fnDarts: (prev.fnDarts || 0) + fnDarts,\r\n        fnScored: (prev.fnScored || 0) + fnScored,\r\n        best3: Math.max(prev.best3 || 0, matchBest3 || 0),\r\n        // For worst3, treat 0 as \"unset\"; choose the min positive across history\r\n        worst3: (() => {\r\n          const prior = prev.worst3 || 0\r\n          if (prior === 0) return matchWorst3 || 0\r\n          if (matchWorst3 === 0) return prior\r\n          return Math.min(prior, matchWorst3)\r\n        })(),\r\n        // Fewest darts on winning leg; 0 means no winning legs recorded yet\r\n        bestLegDarts: (() => {\r\n          const prior = prev.bestLegDarts || 0\r\n          if (prior === 0) return matchBestLegDarts || 0\r\n          if (matchBestLegDarts === 0) return prior\r\n          return Math.min(prior, matchBestLegDarts)\r\n        })(),\r\n        bestCheckout: Math.max(prev.bestCheckout || 0, matchBestCheckout || 0),\r\n        worstLegDarts: (() => {\r\n          const prior = prev.worstLegDarts || 0\r\n          if (prior === 0) return matchWorstLegDarts || 0\r\n          if (matchWorstLegDarts === 0) return prior\r\n          return Math.max(prior, matchWorstLegDarts)\r\n        })(),\r\n        bestFNAvg: Math.max(prev.bestFNAvg || 0, matchBestFNAvg || 0),\r\n        worstFNAvg: (() => {\r\n          const prior = prev.worstFNAvg || 0\r\n          if (prior === 0) return matchWorstFNAvg || 0\r\n          if (matchWorstFNAvg === 0) return prior\r\n          return Math.min(prior, matchWorstFNAvg)\r\n        })(),\r\n      }\r\n      setAllTime(p.name, next)\r\n      // Also add a time-series sample for rolling averages\r\n      addSample(p.name, darts, scored, Date.now(), fnDarts, fnScored)\r\n    }\r\n  }\r\n}\r\n\r\n// Helper: sum points and darts for the first 9 darts of a leg (or fewer if finished earlier)\r\nfunction sumFirstNine(leg: Leg): { d: number; s: number } {\r\n  let remain = Math.min(9, leg.dartsThrown)\r\n  if (remain <= 0) return { d: 0, s: 0 }\r\n  let s = 0\r\n  for (const v of leg.visits) {\r\n    if (remain <= 0) break\r\n    const take = Math.min(remain, v.darts)\r\n    // Pro-rate score if partial darts from a visit are included\r\n    if (take === v.darts) s += v.score\r\n    else s += Math.round((v.score / v.darts) * take)\r\n    remain -= take\r\n  }\r\n  const d = Math.min(9, leg.dartsThrown)\r\n  return { d, s }\r\n}\r\n","import { create } from 'zustand'\r\n\r\ntype LastOffline = { mode: string; x01Start: number; firstTo: number; aiLevel: string }\r\n\r\ntype SettingsState = {\r\n  favoriteDouble: string\r\n  callerEnabled: boolean\r\n  callerVoice: string // voice name\r\n  callerVolume: number // 0..1\r\n  speakCheckoutOnly: boolean\r\n  avgMode: 'all-time' | '24h'\r\n  autoStartOffline: boolean\r\n  rememberLastOffline: boolean\r\n  lastOffline: LastOffline\r\n  reducedMotion: boolean\r\n  compactHeader: boolean\r\n  allowSpectate: boolean\r\n  // UI tuning\r\n  cameraScale: number // 0.5 .. 1.25\r\n  cameraAspect?: 'wide' | 'square'\r\n  cameraFitMode?: 'fit' | 'fill'\r\n  // External autoscore provider\r\n  autoscoreProvider?: 'built-in' | 'external-ws' | 'manual'\r\n  autoscoreWsUrl?: string\r\n  calibrationGuide: boolean\r\n  // Devices & preferences\r\n  preferredCameraId?: string\r\n  preferredCameraLabel?: string\r\n  preferredCameraLocked?: boolean\r\n  // Camera control\r\n  cameraEnabled: boolean\r\n  // UI variants\r\n  offlineLayout?: 'classic' | 'modern'\r\n  // Text size\r\n  textSize: 'small' | 'medium' | 'large'\r\n  // Box size\r\n  boxSize: 'small' | 'medium' | 'large'\r\n  // Match configuration\r\n  matchType?: 'singles' | 'doubles'\r\n  teamAName?: string\r\n  teamBName?: string\r\n  setFavoriteDouble: (d: string) => void\r\n  setCallerEnabled: (v: boolean) => void\r\n  setCallerVoice: (name: string) => void\r\n  setAvgMode: (mode: 'all-time' | '24h') => void\r\n  setCallerVolume: (v: number) => void\r\n  setSpeakCheckoutOnly: (v: boolean) => void\r\n  setAutoStartOffline: (v: boolean) => void\r\n  setRememberLastOffline: (v: boolean) => void\r\n  setLastOffline: (cfg: Partial<LastOffline>) => void\r\n  setReducedMotion: (v: boolean) => void\r\n  setCompactHeader: (v: boolean) => void\r\n  setAllowSpectate: (v: boolean) => void\r\n  setCameraScale: (n: number) => void\r\n  setCameraAspect: (a: 'wide' | 'square') => void\r\n  setCameraFitMode: (m: 'fit' | 'fill') => void\r\n  setCalibrationGuide: (v: boolean) => void\r\n  setPreferredCamera: (id: string|undefined, label?: string, force?: boolean) => void\r\n  setPreferredCameraLocked: (v: boolean) => void\r\n  setCameraEnabled: (v: boolean) => void\r\n  setOfflineLayout: (mode: 'classic'|'modern') => void\r\n  setAutoscoreProvider: (p: 'built-in' | 'external-ws' | 'manual') => void\r\n  setAutoscoreWsUrl: (u: string) => void\r\n  setTextSize: (size: 'small' | 'medium' | 'large') => void\r\n  setBoxSize: (size: 'small' | 'medium' | 'large') => void\r\n  setMatchType: (t: 'singles' | 'doubles') => void\r\n  setTeamAName: (name: string) => void\r\n  setTeamBName: (name: string) => void\r\n  // Throw timer per dart\r\n  dartTimerEnabled?: boolean\r\n  dartTimerSeconds?: number\r\n  setDartTimerEnabled: (v: boolean) => void\r\n  setDartTimerSeconds: (n: number) => void\r\n  // X01 rules\r\n  x01DoubleIn?: boolean\r\n  setX01DoubleIn: (v: boolean) => void\r\n}\r\nconst KEY = 'ndn_user_settings'\r\n\r\nfunction load(): Pick<SettingsState, 'favoriteDouble' | 'callerEnabled' | 'callerVoice' | 'avgMode' | 'callerVolume' | 'speakCheckoutOnly' | 'autoStartOffline' | 'rememberLastOffline' | 'lastOffline' | 'reducedMotion' | 'compactHeader' | 'allowSpectate' | 'cameraScale' | 'cameraAspect' | 'cameraFitMode' | 'calibrationGuide' | 'preferredCameraId' | 'preferredCameraLabel' | 'preferredCameraLocked' | 'cameraEnabled' | 'offlineLayout' | 'autoscoreProvider' | 'autoscoreWsUrl' | 'textSize' | 'boxSize' | 'matchType' | 'teamAName' | 'teamBName' | 'dartTimerEnabled' | 'dartTimerSeconds' | 'x01DoubleIn'> {\r\n  try {\r\n    const raw = localStorage.getItem(KEY)\r\n  if (!raw) return { favoriteDouble: 'D16', callerEnabled: true, callerVoice: '', callerVolume: 1, speakCheckoutOnly: false, avgMode: 'all-time', autoStartOffline: false, rememberLastOffline: true, lastOffline: { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' }, reducedMotion: false, compactHeader: false, allowSpectate: true, cameraScale: 1.0, cameraAspect: 'wide', cameraFitMode: 'fit', calibrationGuide: true, preferredCameraId: undefined, preferredCameraLabel: undefined, cameraEnabled: true, offlineLayout: 'modern', autoscoreProvider: 'built-in', autoscoreWsUrl: '', textSize: 'medium', boxSize: 'medium', matchType: 'singles', teamAName: 'Team A', teamBName: 'Team B', dartTimerEnabled: false, dartTimerSeconds: 10, x01DoubleIn: false }\r\n    const j = JSON.parse(raw)\r\n    return {\r\n      favoriteDouble: j.favoriteDouble || 'D16',\r\n      callerEnabled: typeof j.callerEnabled === 'boolean' ? j.callerEnabled : true,\r\n      callerVoice: j.callerVoice || '',\r\n      callerVolume: (typeof j.callerVolume === 'number') ? Math.max(0, Math.min(1, j.callerVolume)) : 1,\r\n      speakCheckoutOnly: !!j.speakCheckoutOnly,\r\n      avgMode: j.avgMode === '24h' ? '24h' : 'all-time',\r\n      autoStartOffline: !!j.autoStartOffline,\r\n      rememberLastOffline: (typeof j.rememberLastOffline === 'boolean') ? j.rememberLastOffline : true,\r\n      lastOffline: j.lastOffline && typeof j.lastOffline === 'object' ? {\r\n        mode: j.lastOffline.mode || 'X01',\r\n        x01Start: Number(j.lastOffline.x01Start) || 501,\r\n        firstTo: Number(j.lastOffline.firstTo) || 1,\r\n        aiLevel: j.lastOffline.aiLevel || 'None'\r\n      } : { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' },\r\n      reducedMotion: !!j.reducedMotion,\r\n      compactHeader: !!j.compactHeader,\r\n      allowSpectate: (typeof j.allowSpectate === 'boolean') ? j.allowSpectate : true,\r\n  cameraScale: (typeof j.cameraScale === 'number' && isFinite(j.cameraScale)) ? Math.max(0.5, Math.min(1.25, j.cameraScale)) : 1.0,\r\n  cameraAspect: j.cameraAspect === 'square' ? 'square' : 'wide',\r\n  cameraFitMode: (j.cameraFitMode === 'fit' || j.cameraFitMode === 'fill') ? j.cameraFitMode : 'fit',\r\n  autoscoreProvider: (j.autoscoreProvider === 'external-ws') ? 'external-ws' : (j.autoscoreProvider === 'manual' ? 'manual' : 'built-in'),\r\n  autoscoreWsUrl: typeof j.autoscoreWsUrl === 'string' ? j.autoscoreWsUrl : '',\r\n      calibrationGuide: (typeof j.calibrationGuide === 'boolean') ? j.calibrationGuide : true,\r\n  preferredCameraId: typeof j.preferredCameraId === 'string' ? j.preferredCameraId : undefined,\r\n  preferredCameraLabel: typeof j.preferredCameraLabel === 'string' ? j.preferredCameraLabel : undefined,\r\n  preferredCameraLocked: (typeof j.preferredCameraLocked === 'boolean') ? j.preferredCameraLocked : false,\r\n      cameraEnabled: (typeof j.cameraEnabled === 'boolean') ? j.cameraEnabled : true,\r\n      offlineLayout: j.offlineLayout === 'classic' ? 'classic' : 'modern',\r\n      textSize: (j.textSize === 'small' || j.textSize === 'large') ? j.textSize : 'medium',\r\n      boxSize: (j.boxSize === 'small' || j.boxSize === 'large') ? j.boxSize : 'medium',\r\n      matchType: (j.matchType === 'doubles') ? 'doubles' : 'singles',\r\n      teamAName: typeof j.teamAName === 'string' ? j.teamAName : 'Team A',\r\n      teamBName: typeof j.teamBName === 'string' ? j.teamBName : 'Team B',\r\n      dartTimerEnabled: (typeof j.dartTimerEnabled === 'boolean') ? j.dartTimerEnabled : false,\r\n      dartTimerSeconds: (typeof j.dartTimerSeconds === 'number' && isFinite(j.dartTimerSeconds)) ? Math.max(3, Math.min(60, j.dartTimerSeconds)) : 10,\r\n      x01DoubleIn: (typeof j.x01DoubleIn === 'boolean') ? j.x01DoubleIn : false,\r\n    }\r\n  } catch {\r\n  return { favoriteDouble: 'D16', callerEnabled: true, callerVoice: '', callerVolume: 1, speakCheckoutOnly: false, avgMode: 'all-time', autoStartOffline: false, rememberLastOffline: true, lastOffline: { mode: 'X01', x01Start: 501, firstTo: 1, aiLevel: 'None' }, reducedMotion: false, compactHeader: false, allowSpectate: true, cameraScale: 1.0, cameraAspect: 'wide', cameraFitMode: 'fit', calibrationGuide: true, preferredCameraId: undefined, preferredCameraLabel: undefined, preferredCameraLocked: false, cameraEnabled: true, offlineLayout: 'modern', autoscoreProvider: 'built-in', autoscoreWsUrl: '', textSize: 'medium', boxSize: 'medium', matchType: 'singles', teamAName: 'Team A', teamBName: 'Team B', dartTimerEnabled: false, dartTimerSeconds: 10, x01DoubleIn: false }\r\n  }\r\n}\r\n\r\nfunction save(partial: Partial<SettingsState>) {\r\n  try {\r\n    const prev = load()\r\n    localStorage.setItem(KEY, JSON.stringify({ ...prev, ...partial }))\r\n  } catch {}\r\n}\r\n\r\nexport const useUserSettings = create<SettingsState>((set, get) => ({\r\n  ...load(),\r\n  setFavoriteDouble: (d) => { save({ favoriteDouble: d }); set({ favoriteDouble: d }) },\r\n  setCallerEnabled: (v) => { save({ callerEnabled: v }); set({ callerEnabled: v }) },\r\n  setCallerVoice: (name) => { save({ callerVoice: name }); set({ callerVoice: name }) },\r\n  setAvgMode: (mode) => { save({ avgMode: mode }); set({ avgMode: mode }) },\r\n  setCallerVolume: (v) => { const vol = Math.max(0, Math.min(1, v)); save({ callerVolume: vol }); set({ callerVolume: vol }) },\r\n  setSpeakCheckoutOnly: (v) => { save({ speakCheckoutOnly: v }); set({ speakCheckoutOnly: v }) },\r\n  setAutoStartOffline: (v) => { save({ autoStartOffline: v }); set({ autoStartOffline: v }) },\r\n  setRememberLastOffline: (v) => { save({ rememberLastOffline: v }); set({ rememberLastOffline: v }) },\r\n  setLastOffline: (cfg) => { const prev = load().lastOffline; const next = { ...prev, ...cfg }; save({ lastOffline: next }); set({ lastOffline: next }) },\r\n  setReducedMotion: (v) => { save({ reducedMotion: v }); set({ reducedMotion: v }) },\r\n  setCompactHeader: (v) => { save({ compactHeader: v }); set({ compactHeader: v }) },\r\n  setAllowSpectate: (v) => { save({ allowSpectate: v }); set({ allowSpectate: v }) },\r\n  // Temporarily suppress external camera-mode syncing (used while user is interacting with device picker)\r\n  ignorePreferredCameraSync: false,\r\n  setIgnorePreferredCameraSync: (v: boolean) => { save({} as any); set({ ignorePreferredCameraSync: v }) },\r\n  setCameraScale: (n) => { const s = Math.max(0.5, Math.min(1.25, n)); save({ cameraScale: s }); set({ cameraScale: s }) },\r\n  setCameraAspect: (a) => { const v = (a === 'square') ? 'square' : 'wide'; save({ cameraAspect: v }); set({ cameraAspect: v }) },\r\n  setCameraFitMode: (m) => { const v = (m === 'fit') ? 'fit' : 'fill'; save({ cameraFitMode: v }); set({ cameraFitMode: v }) },\r\n  setAutoscoreProvider: (p) => { save({ autoscoreProvider: p }); set({ autoscoreProvider: p }) },\r\n  setAutoscoreWsUrl: (u) => { save({ autoscoreWsUrl: u }); set({ autoscoreWsUrl: u }) },\r\n  setCalibrationGuide: (v) => { save({ calibrationGuide: v }); set({ calibrationGuide: v }) },\r\n  setPreferredCamera: (id, label, force = false) => {\r\n    try {\r\n      const state = get()\r\n      console.log('[USERSETTINGS] setPreferredCamera called:', { id, label, force, locked: state.preferredCameraLocked })\r\n      if (state.preferredCameraLocked && !force) {\r\n        // Locked: ignore programmatic updates unless explicitly forced by user action\r\n        console.log('[USERSETTINGS] Camera selection locked and force=false, ignoring update')\r\n        return\r\n      }\r\n    } catch {}\r\n    console.log('[USERSETTINGS] Saving preferred camera:', { id, label })\r\n    save({ preferredCameraId: id, preferredCameraLabel: label });\r\n    set({ preferredCameraId: id, preferredCameraLabel: label })\r\n  },\r\n  setPreferredCameraLocked: (v) => { save({ preferredCameraLocked: v }); set({ preferredCameraLocked: v }) },\r\n  setCameraEnabled: (v) => { save({ cameraEnabled: v }); set({ cameraEnabled: v }) },\r\n  setOfflineLayout: (mode) => { save({ offlineLayout: mode }); set({ offlineLayout: mode }) },\r\n  setTextSize: (size) => { save({ textSize: size }); set({ textSize: size }) },\r\n  setBoxSize: (size) => { save({ boxSize: size }); set({ boxSize: size }) },\r\n  setMatchType: (t) => { const v = (t === 'doubles') ? 'doubles' : 'singles'; save({ matchType: v }); set({ matchType: v }) },\r\n  setTeamAName: (name) => { const v = name?.trim() || 'Team A'; save({ teamAName: v }); set({ teamAName: v }) },\r\n  setTeamBName: (name) => { const v = name?.trim() || 'Team B'; save({ teamBName: v }); set({ teamBName: v }) },\r\n  setDartTimerEnabled: (v) => { save({ dartTimerEnabled: v }); set({ dartTimerEnabled: v }) },\r\n  setDartTimerSeconds: (n) => { const s = Math.max(3, Math.min(60, Math.round(n))); save({ dartTimerSeconds: s }); set({ dartTimerSeconds: s }) },\r\n  setX01DoubleIn: (v) => { save({ x01DoubleIn: v }); set({ x01DoubleIn: v }) },\r\n}))\r\n","import { useEffect, useState } from 'react';\r\nimport { useToast } from '../store/toast';\r\nimport { formatAvg } from '../utils/stats'\r\nimport { getAllTime } from '../store/profileStats'\r\nimport { STRIPE_CHECKOUT_URL } from '../utils/stripe'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useAudit } from '../store/audit'\r\n\r\nfunction goTab(tab: string) {\r\n  try { window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab } })) } catch {}\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function Home({ user }: { user?: any }) {\r\n  const [showLegal, setShowLegal] = useState(false);\r\n  const [showHowTo, setShowHowTo] = useState(false);\r\n  const [fact, setFact] = useState<string>('');\r\n  const { lastOffline } = useUserSettings()\r\n  const toast = useToast();\r\n\r\n  // Rotate a random \"Did you know?\" each time Home mounts\r\n  useEffect(() => {\r\n    const facts: string[] = [\r\n      'The fastest televised 9-darter took roughly 25 seconds!',\r\n      'A perfect leg (501) can be finished in nine darts.',\r\n      'The inner bull is worth 50; the outer bull is 25.',\r\n      'Standard dartboards are made from compressed sisal fibers.',\r\n      'Doubles and trebles are the thin outer and middle rings.',\r\n      'Professional oche (throw line) distance is 7 ft 9¼ in (2.37 m).',\r\n      '“Dartitis” is a real condition affecting a player’s throwing motion.',\r\n      'Phil Taylor holds a record number of World Championship titles.',\r\n      'Checkout routes often end on a double—classic “double-out”.',\r\n      'The highest 3-dart score is 180 (triple 20, triple 20, triple 20).'\r\n    ];\r\n    const idx = Math.floor(Math.random() * facts.length);\r\n    setFact(facts[idx]);\r\n  }, []);\r\n  return (\r\n    <div className={`${user?.fullAccess ? 'premium-main' : ''} relative min-h-[600px] flex flex-col items-center justify-center overflow-hidden`}>\r\n      {/* Background only */}\r\n      <div className=\"absolute inset-0 z-0\">\r\n        <div className=\"w-full h-full bg-gradient-to-br from-purple-700 via-indigo-500 to-blue-600 opacity-60 blur-2xl\"></div>\r\n        <div className=\"absolute top-20 left-1/4 w-40 h-40 bg-pink-400 rounded-full opacity-30 blur-2xl animate-pulse\"></div>\r\n        <div className=\"absolute bottom-10 right-1/4 w-32 h-32 bg-blue-400 rounded-full opacity-30 blur-2xl animate-pulse\"></div>\r\n      </div>\r\n\r\n      {/* Foreground content */}\r\n  <div className=\"relative z-10 w-full max-w-6xl mx-auto bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 lg:p-10 flex flex-col items-center\">\r\n  <h2 className=\"text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-400 to-blue-400 mb-2 sm:mb-3 md:mb-4 drop-shadow-xl text-center leading-tight\">Welcome to Nine Dart Nation</h2>\r\n  <p className=\"text-base sm:text-lg md:text-xl lg:text-2xl text-white/80 mb-2 font-semibold text-center px-2\">Your home for competitive darts, stats, and online play.</p>\r\n  <p className=\"text-xs sm:text-sm md:text-base lg:text-lg text-white/60 mb-3 sm:mb-4 italic text-center px-2\">\"Where every dart counts and every player matters.\"</p>\r\n\r\n        {/* Did You Know - moved up for full visibility and randomized each mount */}\r\n        {fact && (\r\n          <div className=\"w-full mb-4 sm:mb-6 px-2 sm:px-0\">\r\n            <div className=\"mx-auto max-w-xs sm:max-w-xl rounded-full px-3 sm:px-5 py-2 text-center text-indigo-100 bg-gradient-to-r from-indigo-600/80 to-fuchsia-600/80 shadow-md\">\r\n              <span className=\"font-semibold text-sm sm:text-base\">Did you know?</span> <span className=\"opacity-90 text-sm sm:text-base\">{fact}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n  <div className=\"flex flex-wrap gap-3 sm:gap-4 md:gap-6 justify-center mb-6 md:mb-8 w-full max-w-4xl mx-auto\">\r\n          <button\r\n            onClick={()=>{\r\n              // Switch to Offline and auto-start using the last saved offline settings\r\n              goTab('offline');\r\n              try {\r\n                // Preconfigure format and starting score\r\n                window.dispatchEvent(new CustomEvent('ndn:offline-format', {\r\n                  detail: {\r\n                    formatType: 'first',\r\n                    formatCount: Number(lastOffline?.firstTo) || 1,\r\n                    startScore: Number(lastOffline?.x01Start) || 501,\r\n                  }\r\n                }))\r\n              } catch {}\r\n              try {\r\n                // Give the Offline tab a tick to mount, then auto-start the chosen mode\r\n                setTimeout(() => {\r\n                  window.dispatchEvent(new CustomEvent('ndn:auto-start', {\r\n                    detail: { mode: lastOffline?.mode || 'X01' }\r\n                  }))\r\n                }, 50)\r\n              } catch {}\r\n            }}\r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>🎯</span> Start New Match\r\n          </button>\r\n          <button \r\n            onClick={()=>goTab('stats')} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>📊</span> View Stats\r\n          </button>\r\n          <button \r\n            onClick={()=>goTab('online')} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>🏆</span> Join Online Match\r\n          </button>\r\n          <button \r\n            onClick={()=>{ goTab('offline'); try { window.dispatchEvent(new CustomEvent('ndn:auto-start', { detail: { mode: 'Double Practice' } })) } catch {} }} \r\n            className=\"flex-1 min-w-[200px] sm:flex-none px-4 sm:px-6 md:px-8 py-3 md:py-4 rounded-full bg-gradient-to-r from-pink-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 flex items-center justify-center gap-2 text-base sm:text-lg md:text-xl touch-manipulation\"\r\n          >\r\n            <span aria-hidden>💡</span> Practice Doubles\r\n          </button>\r\n        </div>\r\n\r\n        {/* Removed older stat pill grid; now using BEST/WORST grid below */}\r\n\r\n        {/* Replaced Free/Premium cards with BEST/WORST vertical grid */}\r\n        {(() => {\r\n          const name = user?.username || 'Player 1'\r\n          const all = getAllTime(name)\r\n          const isPremium = !!user?.fullAccess\r\n          const GRID = 'grid grid-cols-[120px,1fr,1fr] sm:grid-cols-[160px,1fr,1fr]';\r\n          const Row = ({ label, left, right, lock }: { label: string; left: string; right: string; lock?: boolean }) => (\r\n            <div className={`relative ${GRID} gap-2 items-center p-2 rounded-lg ${lock ? 'bg-white/5 border border-white/10 overflow-hidden' : 'bg-indigo-500/10 border border-indigo-500/40'} mb-2`}>\r\n              <div className=\"text-[12px] opacity-80 pl-2 text-left\">{label}</div>\r\n              <div className={`text-sm font-semibold text-center ${lock ? 'opacity-50 blur-[0.5px]' : ''}`}>{left}</div>\r\n              <div className={`text-sm font-semibold text-center ${lock ? 'opacity-50 blur-[0.5px]' : ''}`}>{right}</div>\r\n              {lock && (\r\n                <button\r\n                  className=\"absolute inset-0 flex items-center justify-center rounded-lg bg-slate-900/35 hover:bg-slate-900/45 transition\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ email: user.email })\r\n                      });\r\n                      const data = await res.json();\r\n                      if (data.ok && data.url) {\r\n                        window.location.href = data.url;\r\n                      } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                        toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                      } else {\r\n                        toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                      }\r\n                    } catch (err) {\r\n                      toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                    }\r\n                  }}\r\n                  title=\"Unlock with PREMIUM\"\r\n                >\r\n                  <span className=\"text-[12px] font-semibold\">Unlock PREMIUM</span>\r\n                </button>\r\n              )}\r\n            </div>\r\n          )\r\n          return (\r\n            <div className=\"w-full mt-2 rounded-2xl p-2 sm:p-3 bg-white/5 border border-white/10 overflow-x-auto\">\r\n              <div className={`${GRID} gap-2 mb-2 px-1 items-center min-w-[280px] sm:min-w-0`}>\r\n                <div className=\"text-[12px] opacity-0 select-none\">label</div>\r\n                <div className=\"text-[12px] font-semibold text-center\">BEST</div>\r\n                <div className=\"text-[12px] font-semibold text-center\">WORST</div>\r\n              </div>\r\n              <Row label=\"3-dart avg\" left={formatAvg(all.best3||0)} right={formatAvg(all.worst3||0)} />\r\n              <Row label=\"9-dart avg\" left={formatAvg(all.bestFNAvg||0)} right={formatAvg(all.worstFNAvg||0)} lock={!isPremium} />\r\n              <Row label=\"Leg (darts)\" left={String(all.bestLegDarts||0)} right={String(all.worstLegDarts||0)} lock={!isPremium} />\r\n              <Row label=\"Checkout\" left={String(all.bestCheckout||0)} right={'—'} lock={!isPremium} />\r\n            </div>\r\n          )\r\n        })()}\r\n\r\n  <button className=\"mt-6 sm:mt-8 md:mt-10 px-6 sm:px-8 md:px-10 py-3 md:py-4 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold shadow-xl hover:scale-105 active:scale-95 transition-transform duration-150 text-base sm:text-lg md:text-xl touch-manipulation\" onClick={() => setShowHowTo(true)}>How to Play / Getting Started</button>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <footer className=\"w-full py-2 md:py-2 text-center text-white/80 text-xs md:text-sm font-medium absolute bottom-0 left-0 z-20 flex items-center justify-center gap-1 md:gap-2\">\r\n        <button className=\"flex items-center gap-1 md:gap-2 hover:text-white transition\" onClick={() => setShowLegal(true)}>\r\n          <span>©</span>\r\n          <span style={{ letterSpacing: '0.05em' }}>NINEDARTNATION</span>\r\n        </button>\r\n      </footer>\r\n\r\n      {/* Legal Dialog */}\r\n      {showLegal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <div className=\"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={() => setShowLegal(false)}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2\">Legal Information</h3>\r\n            <ul className=\"list-disc pl-5 mb-2\">\r\n              <li>Terms & Conditions: All users must follow fair play and site rules.</li>\r\n              <li>Privacy Policy: Your data is protected and never shared without consent.</li>\r\n              <li>Copyright © {new Date().getFullYear()} NINEDARTNATION. All rights reserved.</li>\r\n              <li>Contact: support@ninedartnation.com</li>\r\n            </ul>\r\n            <p className=\"text-sm text-purple-200\">For full legal details, please contact us or visit our legal page.</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* How to Play Dialog */}\r\n      {showHowTo && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <div className=\"card max-w-lg w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={() => setShowHowTo(false)}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2\">Getting Started</h3>\r\n            <ul className=\"list-disc pl-5 mb-2\">\r\n              <li>Choose a game mode and invite friends or play solo.</li>\r\n              <li>Track your stats and progress in the Stats tab.</li>\r\n              <li>Join the BullseyeDartsLeague for online competition.</li>\r\n              <li>Upgrade to PREMIUM for advanced features and modes.</li>\r\n              <li>Need help? Visit the Settings tab for support and tips.</li>\r\n            </ul>\r\n            <p className=\"text-sm text-purple-200\">Ready to play? Hit \"Start New Match\" and let the darts fly!</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { PropsWithChildren, useEffect, useRef, type CSSProperties } from 'react'\r\n\r\ntype ScrollFadeProps = PropsWithChildren<{\r\n  className?: string\r\n  style?: CSSProperties\r\n}>\r\n\r\nexport default function ScrollFade({ children, className, style }: ScrollFadeProps) {\r\n  const ref = useRef<HTMLDivElement | null>(null)\r\n\r\n  // Clip content under the sticky header so text never shows over it\r\n  useEffect(() => {\r\n    let raf = 0\r\n    const updateClip = () => {\r\n      const wrapper = ref.current\r\n      if (!wrapper) return\r\n  const header = document.getElementById('ndn-header') as HTMLElement | null\r\n      if (!header) {\r\n        wrapper.style.clipPath = ''\r\n        return\r\n      }\r\n       const scroller = document.getElementById('ndn-main-scroll') as HTMLElement | null\r\n       const scrollTop = scroller ? scroller.scrollTop : (window.scrollY || 0)\r\n       // Hide content under the sticky header by rendering a lightweight mask\r\n       // element at the top of the wrapper. Using an overlay avoids layout shifts\r\n       // and prevents clip-path + transform interactions that can cause rendering\r\n       // artifacts in some browsers.\r\n       const headerH = header.getBoundingClientRect().height\r\n       const overlap = scrollTop > 0 ? headerH : 0\r\n       try {\r\n         // Find or create the mask node\r\n         let mask = wrapper.querySelector('[data-ndn-top-mask]') as HTMLElement | null\r\n         if (!mask) {\r\n           mask = document.createElement('div')\r\n           mask.setAttribute('data-ndn-top-mask', '1')\r\n           // keep it non-interactive and on top of the wrapper content\r\n           Object.assign(mask.style, {\r\n             position: 'absolute',\r\n             left: '0px',\r\n             right: '0px',\r\n             top: '0px',\r\n             height: '0px',\r\n             pointerEvents: 'none',\r\n             zIndex: '20',\r\n             background: 'linear-gradient(to bottom, rgba(17,24,39,1), rgba(17,24,39,0))'\r\n           })\r\n           wrapper.style.position = wrapper.style.position || 'relative'\r\n           wrapper.insertBefore(mask, wrapper.firstChild)\r\n         }\r\n         if (overlap > 0) {\r\n           mask.style.height = `${overlap}px`\r\n           mask.style.display = ''\r\n         } else {\r\n           mask.style.height = '0px'\r\n           mask.style.display = 'none'\r\n         }\r\n         // keep layout position unchanged\r\n         wrapper.style.marginTop = '0px'\r\n       } catch (e) {\r\n         wrapper.style.marginTop = '0px'\r\n       }\r\n    }\r\n    updateClip()\r\n    const onScrollOrResize = () => {\r\n      if (raf) cancelAnimationFrame(raf)\r\n      raf = requestAnimationFrame(updateClip)\r\n    }\r\n    // Listen to the app's main scroll container instead of window\r\n    const scroller = document.getElementById('ndn-main-scroll')\r\n  scroller?.addEventListener('scroll', onScrollOrResize as any, { passive: true } as any)\r\n    // Fallback to window for safety (mobile or non-standard layouts)\r\n    window.addEventListener('scroll', onScrollOrResize, { passive: true })\r\n    window.addEventListener('resize', onScrollOrResize)\r\n    return () => {\r\n  scroller?.removeEventListener('scroll', onScrollOrResize as any)\r\n      window.removeEventListener('scroll', onScrollOrResize)\r\n      window.removeEventListener('resize', onScrollOrResize)\r\n      if (raf) cancelAnimationFrame(raf)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div ref={ref} className={className} style={style}>\r\n      {children}\r\n    </div>\r\n  )\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\n\r\ninterface DartLoaderProps {\r\n  calibrationComplete: boolean;\r\n}\r\n\r\nconst DartLoader: React.FC<DartLoaderProps> = ({ calibrationComplete }) => {\r\n  const [showTick, setShowTick] = useState(false);\r\n  const [fade, setFade] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (calibrationComplete) {\r\n      setShowTick(true);\r\n      setTimeout(() => setFade(true), 1200);\r\n    } else {\r\n      setShowTick(false);\r\n      setFade(false);\r\n    }\r\n  }, [calibrationComplete]);\r\n\r\n  return (\r\n    <div\r\n      className={`flex flex-col items-center justify-center w-full h-full transition-opacity duration-700 ${fade ? 'opacity-0' : 'opacity-100'}`}\r\n      style={{ pointerEvents: 'none', position: 'absolute', inset: 0, zIndex: 10 }}\r\n    >\r\n      <div className=\"flex items-center justify-center\">\r\n        <svg\r\n          width=\"80\"\r\n          height=\"80\"\r\n          viewBox=\"0 0 80 80\"\r\n          className={`animate-spin-slow ${showTick ? 'opacity-0' : 'opacity-100'} transition-opacity duration-500`}\r\n          style={{ transition: 'opacity 0.5s' }}\r\n        >\r\n          {/* Dart graphic */}\r\n          <g>\r\n            <rect x=\"36\" y=\"10\" width=\"8\" height=\"40\" rx=\"3\" fill=\"#a78bfa\" />\r\n            <polygon points=\"40,10 44,22 36,22\" fill=\"#f472b6\" />\r\n            <rect x=\"36\" y=\"50\" width=\"8\" height=\"18\" rx=\"2\" fill=\"#22d3ee\" />\r\n            <polygon points=\"36,68 44,68 40,78\" fill=\"#10b981\" />\r\n          </g>\r\n        </svg>\r\n        {showTick && (\r\n          <svg width=\"80\" height=\"80\" viewBox=\"0 0 80 80\" className=\"absolute\" style={{ left: 0, top: 0 }}>\r\n            <circle cx=\"40\" cy=\"40\" r=\"32\" fill=\"none\" stroke=\"#10b981\" strokeWidth=\"6\" />\r\n            <polyline points=\"28,44 38,54 54,30\" fill=\"none\" stroke=\"#10b981\" strokeWidth=\"6\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n          </svg>\r\n        )}\r\n      </div>\r\n      <div className=\"mt-4 text-lg font-semibold text-indigo-200\">\r\n        {showTick ? 'Calibration Complete!' : 'Initializing Camera...'}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DartLoader;\r\n","// can-promise has a crash in some versions of react native that dont have\n// standard global objects\n// https://github.com/soldair/node-qrcode/issues/157\n\nmodule.exports = function () {\n  return typeof Promise === 'function' && Promise.prototype && Promise.prototype.then\n}\n","let toSJISFunction\nconst CODEWORDS_COUNT = [\n  0, // Not used\n  26, 44, 70, 100, 134, 172, 196, 242, 292, 346,\n  404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n  1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185,\n  2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706\n]\n\n/**\n * Returns the QR Code size for the specified version\n *\n * @param  {Number} version QR Code version\n * @return {Number}         size of QR code\n */\nexports.getSymbolSize = function getSymbolSize (version) {\n  if (!version) throw new Error('\"version\" cannot be null or undefined')\n  if (version < 1 || version > 40) throw new Error('\"version\" should be in range from 1 to 40')\n  return version * 4 + 17\n}\n\n/**\n * Returns the total number of codewords used to store data and EC information.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Data length in bits\n */\nexports.getSymbolTotalCodewords = function getSymbolTotalCodewords (version) {\n  return CODEWORDS_COUNT[version]\n}\n\n/**\n * Encode data with Bose-Chaudhuri-Hocquenghem\n *\n * @param  {Number} data Value to encode\n * @return {Number}      Encoded value\n */\nexports.getBCHDigit = function (data) {\n  let digit = 0\n\n  while (data !== 0) {\n    digit++\n    data >>>= 1\n  }\n\n  return digit\n}\n\nexports.setToSJISFunction = function setToSJISFunction (f) {\n  if (typeof f !== 'function') {\n    throw new Error('\"toSJISFunc\" is not a valid function.')\n  }\n\n  toSJISFunction = f\n}\n\nexports.isKanjiModeEnabled = function () {\n  return typeof toSJISFunction !== 'undefined'\n}\n\nexports.toSJIS = function toSJIS (kanji) {\n  return toSJISFunction(kanji)\n}\n","exports.L = { bit: 1 }\nexports.M = { bit: 0 }\nexports.Q = { bit: 3 }\nexports.H = { bit: 2 }\n\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'l':\n    case 'low':\n      return exports.L\n\n    case 'm':\n    case 'medium':\n      return exports.M\n\n    case 'q':\n    case 'quartile':\n      return exports.Q\n\n    case 'h':\n    case 'high':\n      return exports.H\n\n    default:\n      throw new Error('Unknown EC Level: ' + string)\n  }\n}\n\nexports.isValid = function isValid (level) {\n  return level && typeof level.bit !== 'undefined' &&\n    level.bit >= 0 && level.bit < 4\n}\n\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n","function BitBuffer () {\n  this.buffer = []\n  this.length = 0\n}\n\nBitBuffer.prototype = {\n\n  get: function (index) {\n    const bufIndex = Math.floor(index / 8)\n    return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) === 1\n  },\n\n  put: function (num, length) {\n    for (let i = 0; i < length; i++) {\n      this.putBit(((num >>> (length - i - 1)) & 1) === 1)\n    }\n  },\n\n  getLengthInBits: function () {\n    return this.length\n  },\n\n  putBit: function (bit) {\n    const bufIndex = Math.floor(this.length / 8)\n    if (this.buffer.length <= bufIndex) {\n      this.buffer.push(0)\n    }\n\n    if (bit) {\n      this.buffer[bufIndex] |= (0x80 >>> (this.length % 8))\n    }\n\n    this.length++\n  }\n}\n\nmodule.exports = BitBuffer\n","/**\n * Helper class to handle QR Code symbol modules\n *\n * @param {Number} size Symbol size\n */\nfunction BitMatrix (size) {\n  if (!size || size < 1) {\n    throw new Error('BitMatrix size must be defined and greater than 0')\n  }\n\n  this.size = size\n  this.data = new Uint8Array(size * size)\n  this.reservedBit = new Uint8Array(size * size)\n}\n\n/**\n * Set bit value at specified location\n * If reserved flag is set, this bit will be ignored during masking process\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n * @param {Boolean} reserved\n */\nBitMatrix.prototype.set = function (row, col, value, reserved) {\n  const index = row * this.size + col\n  this.data[index] = value\n  if (reserved) this.reservedBit[index] = true\n}\n\n/**\n * Returns bit value at specified location\n *\n * @param  {Number}  row\n * @param  {Number}  col\n * @return {Boolean}\n */\nBitMatrix.prototype.get = function (row, col) {\n  return this.data[row * this.size + col]\n}\n\n/**\n * Applies xor operator at specified location\n * (used during masking process)\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n */\nBitMatrix.prototype.xor = function (row, col, value) {\n  this.data[row * this.size + col] ^= value\n}\n\n/**\n * Check if bit at specified location is reserved\n *\n * @param {Number}   row\n * @param {Number}   col\n * @return {Boolean}\n */\nBitMatrix.prototype.isReserved = function (row, col) {\n  return this.reservedBit[row * this.size + col]\n}\n\nmodule.exports = BitMatrix\n","/**\n * Alignment pattern are fixed reference pattern in defined positions\n * in a matrix symbology, which enables the decode software to re-synchronise\n * the coordinate mapping of the image modules in the event of moderate amounts\n * of distortion of the image.\n *\n * Alignment patterns are present only in QR Code symbols of version 2 or larger\n * and their number depends on the symbol version.\n */\n\nconst getSymbolSize = require('./utils').getSymbolSize\n\n/**\n * Calculate the row/column coordinates of the center module of each alignment pattern\n * for the specified QR Code version.\n *\n * The alignment patterns are positioned symmetrically on either side of the diagonal\n * running from the top left corner of the symbol to the bottom right corner.\n *\n * Since positions are simmetrical only half of the coordinates are returned.\n * Each item of the array will represent in turn the x and y coordinate.\n * @see {@link getPositions}\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinate\n */\nexports.getRowColCoords = function getRowColCoords (version) {\n  if (version === 1) return []\n\n  const posCount = Math.floor(version / 7) + 2\n  const size = getSymbolSize(version)\n  const intervals = size === 145 ? 26 : Math.ceil((size - 13) / (2 * posCount - 2)) * 2\n  const positions = [size - 7] // Last coord is always (size - 7)\n\n  for (let i = 1; i < posCount - 1; i++) {\n    positions[i] = positions[i - 1] - intervals\n  }\n\n  positions.push(6) // First coord is always 6\n\n  return positions.reverse()\n}\n\n/**\n * Returns an array containing the positions of each alignment pattern.\n * Each array's element represent the center point of the pattern as (x, y) coordinates\n *\n * Coordinates are calculated expanding the row/column coordinates returned by {@link getRowColCoords}\n * and filtering out the items that overlaps with finder pattern\n *\n * @example\n * For a Version 7 symbol {@link getRowColCoords} returns values 6, 22 and 38.\n * The alignment patterns, therefore, are to be centered on (row, column)\n * positions (6,22), (22,6), (22,22), (22,38), (38,22), (38,38).\n * Note that the coordinates (6,6), (6,38), (38,6) are occupied by finder patterns\n * and are not therefore used for alignment patterns.\n *\n * let pos = getPositions(7)\n * // [[6,22], [22,6], [22,22], [22,38], [38,22], [38,38]]\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const coords = []\n  const pos = exports.getRowColCoords(version)\n  const posLength = pos.length\n\n  for (let i = 0; i < posLength; i++) {\n    for (let j = 0; j < posLength; j++) {\n      // Skip if position is occupied by finder patterns\n      if ((i === 0 && j === 0) || // top-left\n          (i === 0 && j === posLength - 1) || // bottom-left\n          (i === posLength - 1 && j === 0)) { // top-right\n        continue\n      }\n\n      coords.push([pos[i], pos[j]])\n    }\n  }\n\n  return coords\n}\n","const getSymbolSize = require('./utils').getSymbolSize\nconst FINDER_PATTERN_SIZE = 7\n\n/**\n * Returns an array containing the positions of each finder pattern.\n * Each array's element represent the top-left point of the pattern as (x, y) coordinates\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const size = getSymbolSize(version)\n\n  return [\n    // top-left\n    [0, 0],\n    // top-right\n    [size - FINDER_PATTERN_SIZE, 0],\n    // bottom-left\n    [0, size - FINDER_PATTERN_SIZE]\n  ]\n}\n","/**\n * Data mask pattern reference\n * @type {Object}\n */\nexports.Patterns = {\n  PATTERN000: 0,\n  PATTERN001: 1,\n  PATTERN010: 2,\n  PATTERN011: 3,\n  PATTERN100: 4,\n  PATTERN101: 5,\n  PATTERN110: 6,\n  PATTERN111: 7\n}\n\n/**\n * Weighted penalty scores for the undesirable features\n * @type {Object}\n */\nconst PenaltyScores = {\n  N1: 3,\n  N2: 3,\n  N3: 40,\n  N4: 10\n}\n\n/**\n * Check if mask pattern value is valid\n *\n * @param  {Number}  mask    Mask pattern\n * @return {Boolean}         true if valid, false otherwise\n */\nexports.isValid = function isValid (mask) {\n  return mask != null && mask !== '' && !isNaN(mask) && mask >= 0 && mask <= 7\n}\n\n/**\n * Returns mask pattern from a value.\n * If value is not valid, returns undefined\n *\n * @param  {Number|String} value        Mask pattern value\n * @return {Number}                     Valid mask pattern or undefined\n */\nexports.from = function from (value) {\n  return exports.isValid(value) ? parseInt(value, 10) : undefined\n}\n\n/**\n* Find adjacent modules in row/column with the same color\n* and assign a penalty value.\n*\n* Points: N1 + i\n* i is the amount by which the number of adjacent modules of the same color exceeds 5\n*/\nexports.getPenaltyN1 = function getPenaltyN1 (data) {\n  const size = data.size\n  let points = 0\n  let sameCountCol = 0\n  let sameCountRow = 0\n  let lastCol = null\n  let lastRow = null\n\n  for (let row = 0; row < size; row++) {\n    sameCountCol = sameCountRow = 0\n    lastCol = lastRow = null\n\n    for (let col = 0; col < size; col++) {\n      let module = data.get(row, col)\n      if (module === lastCol) {\n        sameCountCol++\n      } else {\n        if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n        lastCol = module\n        sameCountCol = 1\n      }\n\n      module = data.get(col, row)\n      if (module === lastRow) {\n        sameCountRow++\n      } else {\n        if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n        lastRow = module\n        sameCountRow = 1\n      }\n    }\n\n    if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n    if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n  }\n\n  return points\n}\n\n/**\n * Find 2x2 blocks with the same color and assign a penalty value\n *\n * Points: N2 * (m - 1) * (n - 1)\n */\nexports.getPenaltyN2 = function getPenaltyN2 (data) {\n  const size = data.size\n  let points = 0\n\n  for (let row = 0; row < size - 1; row++) {\n    for (let col = 0; col < size - 1; col++) {\n      const last = data.get(row, col) +\n        data.get(row, col + 1) +\n        data.get(row + 1, col) +\n        data.get(row + 1, col + 1)\n\n      if (last === 4 || last === 0) points++\n    }\n  }\n\n  return points * PenaltyScores.N2\n}\n\n/**\n * Find 1:1:3:1:1 ratio (dark:light:dark:light:dark) pattern in row/column,\n * preceded or followed by light area 4 modules wide\n *\n * Points: N3 * number of pattern found\n */\nexports.getPenaltyN3 = function getPenaltyN3 (data) {\n  const size = data.size\n  let points = 0\n  let bitsCol = 0\n  let bitsRow = 0\n\n  for (let row = 0; row < size; row++) {\n    bitsCol = bitsRow = 0\n    for (let col = 0; col < size; col++) {\n      bitsCol = ((bitsCol << 1) & 0x7FF) | data.get(row, col)\n      if (col >= 10 && (bitsCol === 0x5D0 || bitsCol === 0x05D)) points++\n\n      bitsRow = ((bitsRow << 1) & 0x7FF) | data.get(col, row)\n      if (col >= 10 && (bitsRow === 0x5D0 || bitsRow === 0x05D)) points++\n    }\n  }\n\n  return points * PenaltyScores.N3\n}\n\n/**\n * Calculate proportion of dark modules in entire symbol\n *\n * Points: N4 * k\n *\n * k is the rating of the deviation of the proportion of dark modules\n * in the symbol from 50% in steps of 5%\n */\nexports.getPenaltyN4 = function getPenaltyN4 (data) {\n  let darkCount = 0\n  const modulesCount = data.data.length\n\n  for (let i = 0; i < modulesCount; i++) darkCount += data.data[i]\n\n  const k = Math.abs(Math.ceil((darkCount * 100 / modulesCount) / 5) - 10)\n\n  return k * PenaltyScores.N4\n}\n\n/**\n * Return mask value at given position\n *\n * @param  {Number} maskPattern Pattern reference value\n * @param  {Number} i           Row\n * @param  {Number} j           Column\n * @return {Boolean}            Mask value\n */\nfunction getMaskAt (maskPattern, i, j) {\n  switch (maskPattern) {\n    case exports.Patterns.PATTERN000: return (i + j) % 2 === 0\n    case exports.Patterns.PATTERN001: return i % 2 === 0\n    case exports.Patterns.PATTERN010: return j % 3 === 0\n    case exports.Patterns.PATTERN011: return (i + j) % 3 === 0\n    case exports.Patterns.PATTERN100: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0\n    case exports.Patterns.PATTERN101: return (i * j) % 2 + (i * j) % 3 === 0\n    case exports.Patterns.PATTERN110: return ((i * j) % 2 + (i * j) % 3) % 2 === 0\n    case exports.Patterns.PATTERN111: return ((i * j) % 3 + (i + j) % 2) % 2 === 0\n\n    default: throw new Error('bad maskPattern:' + maskPattern)\n  }\n}\n\n/**\n * Apply a mask pattern to a BitMatrix\n *\n * @param  {Number}    pattern Pattern reference number\n * @param  {BitMatrix} data    BitMatrix data\n */\nexports.applyMask = function applyMask (pattern, data) {\n  const size = data.size\n\n  for (let col = 0; col < size; col++) {\n    for (let row = 0; row < size; row++) {\n      if (data.isReserved(row, col)) continue\n      data.xor(row, col, getMaskAt(pattern, row, col))\n    }\n  }\n}\n\n/**\n * Returns the best mask pattern for data\n *\n * @param  {BitMatrix} data\n * @return {Number} Mask pattern reference number\n */\nexports.getBestMask = function getBestMask (data, setupFormatFunc) {\n  const numPatterns = Object.keys(exports.Patterns).length\n  let bestPattern = 0\n  let lowerPenalty = Infinity\n\n  for (let p = 0; p < numPatterns; p++) {\n    setupFormatFunc(p)\n    exports.applyMask(p, data)\n\n    // Calculate penalty\n    const penalty =\n      exports.getPenaltyN1(data) +\n      exports.getPenaltyN2(data) +\n      exports.getPenaltyN3(data) +\n      exports.getPenaltyN4(data)\n\n    // Undo previously applied mask\n    exports.applyMask(p, data)\n\n    if (penalty < lowerPenalty) {\n      lowerPenalty = penalty\n      bestPattern = p\n    }\n  }\n\n  return bestPattern\n}\n","const ECLevel = require('./error-correction-level')\r\n\r\nconst EC_BLOCKS_TABLE = [\r\n// L  M  Q  H\r\n  1, 1, 1, 1,\r\n  1, 1, 1, 1,\r\n  1, 1, 2, 2,\r\n  1, 2, 2, 4,\r\n  1, 2, 4, 4,\r\n  2, 4, 4, 4,\r\n  2, 4, 6, 5,\r\n  2, 4, 6, 6,\r\n  2, 5, 8, 8,\r\n  4, 5, 8, 8,\r\n  4, 5, 8, 11,\r\n  4, 8, 10, 11,\r\n  4, 9, 12, 16,\r\n  4, 9, 16, 16,\r\n  6, 10, 12, 18,\r\n  6, 10, 17, 16,\r\n  6, 11, 16, 19,\r\n  6, 13, 18, 21,\r\n  7, 14, 21, 25,\r\n  8, 16, 20, 25,\r\n  8, 17, 23, 25,\r\n  9, 17, 23, 34,\r\n  9, 18, 25, 30,\r\n  10, 20, 27, 32,\r\n  12, 21, 29, 35,\r\n  12, 23, 34, 37,\r\n  12, 25, 34, 40,\r\n  13, 26, 35, 42,\r\n  14, 28, 38, 45,\r\n  15, 29, 40, 48,\r\n  16, 31, 43, 51,\r\n  17, 33, 45, 54,\r\n  18, 35, 48, 57,\r\n  19, 37, 51, 60,\r\n  19, 38, 53, 63,\r\n  20, 40, 56, 66,\r\n  21, 43, 59, 70,\r\n  22, 45, 62, 74,\r\n  24, 47, 65, 77,\r\n  25, 49, 68, 81\r\n]\r\n\r\nconst EC_CODEWORDS_TABLE = [\r\n// L  M  Q  H\r\n  7, 10, 13, 17,\r\n  10, 16, 22, 28,\r\n  15, 26, 36, 44,\r\n  20, 36, 52, 64,\r\n  26, 48, 72, 88,\r\n  36, 64, 96, 112,\r\n  40, 72, 108, 130,\r\n  48, 88, 132, 156,\r\n  60, 110, 160, 192,\r\n  72, 130, 192, 224,\r\n  80, 150, 224, 264,\r\n  96, 176, 260, 308,\r\n  104, 198, 288, 352,\r\n  120, 216, 320, 384,\r\n  132, 240, 360, 432,\r\n  144, 280, 408, 480,\r\n  168, 308, 448, 532,\r\n  180, 338, 504, 588,\r\n  196, 364, 546, 650,\r\n  224, 416, 600, 700,\r\n  224, 442, 644, 750,\r\n  252, 476, 690, 816,\r\n  270, 504, 750, 900,\r\n  300, 560, 810, 960,\r\n  312, 588, 870, 1050,\r\n  336, 644, 952, 1110,\r\n  360, 700, 1020, 1200,\r\n  390, 728, 1050, 1260,\r\n  420, 784, 1140, 1350,\r\n  450, 812, 1200, 1440,\r\n  480, 868, 1290, 1530,\r\n  510, 924, 1350, 1620,\r\n  540, 980, 1440, 1710,\r\n  570, 1036, 1530, 1800,\r\n  570, 1064, 1590, 1890,\r\n  600, 1120, 1680, 1980,\r\n  630, 1204, 1770, 2100,\r\n  660, 1260, 1860, 2220,\r\n  720, 1316, 1950, 2310,\r\n  750, 1372, 2040, 2430\r\n]\r\n\r\n/**\r\n * Returns the number of error correction block that the QR Code should contain\r\n * for the specified version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction blocks\r\n */\r\nexports.getBlocksCount = function getBlocksCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the number of error correction codewords to use for the specified\r\n * version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction codewords\r\n */\r\nexports.getTotalCodewordsCount = function getTotalCodewordsCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n","const EXP_TABLE = new Uint8Array(512)\nconst LOG_TABLE = new Uint8Array(256)\n/**\n * Precompute the log and anti-log tables for faster computation later\n *\n * For each possible value in the galois field 2^8, we will pre-compute\n * the logarithm and anti-logarithm (exponential) of this value\n *\n * ref {@link https://en.wikiversity.org/wiki/Reed%E2%80%93Solomon_codes_for_coders#Introduction_to_mathematical_fields}\n */\n;(function initTables () {\n  let x = 1\n  for (let i = 0; i < 255; i++) {\n    EXP_TABLE[i] = x\n    LOG_TABLE[x] = i\n\n    x <<= 1 // multiply by 2\n\n    // The QR code specification says to use byte-wise modulo 100011101 arithmetic.\n    // This means that when a number is 256 or larger, it should be XORed with 0x11D.\n    if (x & 0x100) { // similar to x >= 256, but a lot faster (because 0x100 == 256)\n      x ^= 0x11D\n    }\n  }\n\n  // Optimization: double the size of the anti-log table so that we don't need to mod 255 to\n  // stay inside the bounds (because we will mainly use this table for the multiplication of\n  // two GF numbers, no more).\n  // @see {@link mul}\n  for (let i = 255; i < 512; i++) {\n    EXP_TABLE[i] = EXP_TABLE[i - 255]\n  }\n}())\n\n/**\n * Returns log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.log = function log (n) {\n  if (n < 1) throw new Error('log(' + n + ')')\n  return LOG_TABLE[n]\n}\n\n/**\n * Returns anti-log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.exp = function exp (n) {\n  return EXP_TABLE[n]\n}\n\n/**\n * Multiplies two number inside Galois Field\n *\n * @param  {Number} x\n * @param  {Number} y\n * @return {Number}\n */\nexports.mul = function mul (x, y) {\n  if (x === 0 || y === 0) return 0\n\n  // should be EXP_TABLE[(LOG_TABLE[x] + LOG_TABLE[y]) % 255] if EXP_TABLE wasn't oversized\n  // @see {@link initTables}\n  return EXP_TABLE[LOG_TABLE[x] + LOG_TABLE[y]]\n}\n","const GF = require('./galois-field')\n\n/**\n * Multiplies two polynomials inside Galois Field\n *\n * @param  {Uint8Array} p1 Polynomial\n * @param  {Uint8Array} p2 Polynomial\n * @return {Uint8Array}    Product of p1 and p2\n */\nexports.mul = function mul (p1, p2) {\n  const coeff = new Uint8Array(p1.length + p2.length - 1)\n\n  for (let i = 0; i < p1.length; i++) {\n    for (let j = 0; j < p2.length; j++) {\n      coeff[i + j] ^= GF.mul(p1[i], p2[j])\n    }\n  }\n\n  return coeff\n}\n\n/**\n * Calculate the remainder of polynomials division\n *\n * @param  {Uint8Array} divident Polynomial\n * @param  {Uint8Array} divisor  Polynomial\n * @return {Uint8Array}          Remainder\n */\nexports.mod = function mod (divident, divisor) {\n  let result = new Uint8Array(divident)\n\n  while ((result.length - divisor.length) >= 0) {\n    const coeff = result[0]\n\n    for (let i = 0; i < divisor.length; i++) {\n      result[i] ^= GF.mul(divisor[i], coeff)\n    }\n\n    // remove all zeros from buffer head\n    let offset = 0\n    while (offset < result.length && result[offset] === 0) offset++\n    result = result.slice(offset)\n  }\n\n  return result\n}\n\n/**\n * Generate an irreducible generator polynomial of specified degree\n * (used by Reed-Solomon encoder)\n *\n * @param  {Number} degree Degree of the generator polynomial\n * @return {Uint8Array}    Buffer containing polynomial coefficients\n */\nexports.generateECPolynomial = function generateECPolynomial (degree) {\n  let poly = new Uint8Array([1])\n  for (let i = 0; i < degree; i++) {\n    poly = exports.mul(poly, new Uint8Array([1, GF.exp(i)]))\n  }\n\n  return poly\n}\n","const Polynomial = require('./polynomial')\n\nfunction ReedSolomonEncoder (degree) {\n  this.genPoly = undefined\n  this.degree = degree\n\n  if (this.degree) this.initialize(this.degree)\n}\n\n/**\n * Initialize the encoder.\n * The input param should correspond to the number of error correction codewords.\n *\n * @param  {Number} degree\n */\nReedSolomonEncoder.prototype.initialize = function initialize (degree) {\n  // create an irreducible generator polynomial\n  this.degree = degree\n  this.genPoly = Polynomial.generateECPolynomial(this.degree)\n}\n\n/**\n * Encodes a chunk of data\n *\n * @param  {Uint8Array} data Buffer containing input data\n * @return {Uint8Array}      Buffer containing encoded data\n */\nReedSolomonEncoder.prototype.encode = function encode (data) {\n  if (!this.genPoly) {\n    throw new Error('Encoder not initialized')\n  }\n\n  // Calculate EC for this data block\n  // extends data size to data+genPoly size\n  const paddedData = new Uint8Array(data.length + this.degree)\n  paddedData.set(data)\n\n  // The error correction codewords are the remainder after dividing the data codewords\n  // by a generator polynomial\n  const remainder = Polynomial.mod(paddedData, this.genPoly)\n\n  // return EC data blocks (last n byte, where n is the degree of genPoly)\n  // If coefficients number in remainder are less than genPoly degree,\n  // pad with 0s to the left to reach the needed number of coefficients\n  const start = this.degree - remainder.length\n  if (start > 0) {\n    const buff = new Uint8Array(this.degree)\n    buff.set(remainder, start)\n\n    return buff\n  }\n\n  return remainder\n}\n\nmodule.exports = ReedSolomonEncoder\n","/**\n * Check if QR Code version is valid\n *\n * @param  {Number}  version QR Code version\n * @return {Boolean}         true if valid version, false otherwise\n */\nexports.isValid = function isValid (version) {\n  return !isNaN(version) && version >= 1 && version <= 40\n}\n","const numeric = '[0-9]+'\nconst alphanumeric = '[A-Z $%*+\\\\-./:]+'\nlet kanji = '(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|' +\n  '[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|' +\n  '[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|' +\n  '[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+'\nkanji = kanji.replace(/u/g, '\\\\u')\n\nconst byte = '(?:(?![A-Z0-9 $%*+\\\\-./:]|' + kanji + ')(?:.|[\\r\\n]))+'\n\nexports.KANJI = new RegExp(kanji, 'g')\nexports.BYTE_KANJI = new RegExp('[^A-Z0-9 $%*+\\\\-./:]+', 'g')\nexports.BYTE = new RegExp(byte, 'g')\nexports.NUMERIC = new RegExp(numeric, 'g')\nexports.ALPHANUMERIC = new RegExp(alphanumeric, 'g')\n\nconst TEST_KANJI = new RegExp('^' + kanji + '$')\nconst TEST_NUMERIC = new RegExp('^' + numeric + '$')\nconst TEST_ALPHANUMERIC = new RegExp('^[A-Z0-9 $%*+\\\\-./:]+$')\n\nexports.testKanji = function testKanji (str) {\n  return TEST_KANJI.test(str)\n}\n\nexports.testNumeric = function testNumeric (str) {\n  return TEST_NUMERIC.test(str)\n}\n\nexports.testAlphanumeric = function testAlphanumeric (str) {\n  return TEST_ALPHANUMERIC.test(str)\n}\n","const VersionCheck = require('./version-check')\nconst Regex = require('./regex')\n\n/**\n * Numeric mode encodes data from the decimal digit set (0 - 9)\n * (byte values 30HEX to 39HEX).\n * Normally, 3 data characters are represented by 10 bits.\n *\n * @type {Object}\n */\nexports.NUMERIC = {\n  id: 'Numeric',\n  bit: 1 << 0,\n  ccBits: [10, 12, 14]\n}\n\n/**\n * Alphanumeric mode encodes data from a set of 45 characters,\n * i.e. 10 numeric digits (0 - 9),\n *      26 alphabetic characters (A - Z),\n *   and 9 symbols (SP, $, %, *, +, -, ., /, :).\n * Normally, two input characters are represented by 11 bits.\n *\n * @type {Object}\n */\nexports.ALPHANUMERIC = {\n  id: 'Alphanumeric',\n  bit: 1 << 1,\n  ccBits: [9, 11, 13]\n}\n\n/**\n * In byte mode, data is encoded at 8 bits per character.\n *\n * @type {Object}\n */\nexports.BYTE = {\n  id: 'Byte',\n  bit: 1 << 2,\n  ccBits: [8, 16, 16]\n}\n\n/**\n * The Kanji mode efficiently encodes Kanji characters in accordance with\n * the Shift JIS system based on JIS X 0208.\n * The Shift JIS values are shifted from the JIS X 0208 values.\n * JIS X 0208 gives details of the shift coded representation.\n * Each two-byte character value is compacted to a 13-bit binary codeword.\n *\n * @type {Object}\n */\nexports.KANJI = {\n  id: 'Kanji',\n  bit: 1 << 3,\n  ccBits: [8, 10, 12]\n}\n\n/**\n * Mixed mode will contain a sequences of data in a combination of any of\n * the modes described above\n *\n * @type {Object}\n */\nexports.MIXED = {\n  bit: -1\n}\n\n/**\n * Returns the number of bits needed to store the data length\n * according to QR Code specifications.\n *\n * @param  {Mode}   mode    Data mode\n * @param  {Number} version QR Code version\n * @return {Number}         Number of bits\n */\nexports.getCharCountIndicator = function getCharCountIndicator (mode, version) {\n  if (!mode.ccBits) throw new Error('Invalid mode: ' + mode)\n\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid version: ' + version)\n  }\n\n  if (version >= 1 && version < 10) return mode.ccBits[0]\n  else if (version < 27) return mode.ccBits[1]\n  return mode.ccBits[2]\n}\n\n/**\n * Returns the most efficient mode to store the specified data\n *\n * @param  {String} dataStr Input data string\n * @return {Mode}           Best mode\n */\nexports.getBestModeForData = function getBestModeForData (dataStr) {\n  if (Regex.testNumeric(dataStr)) return exports.NUMERIC\n  else if (Regex.testAlphanumeric(dataStr)) return exports.ALPHANUMERIC\n  else if (Regex.testKanji(dataStr)) return exports.KANJI\n  else return exports.BYTE\n}\n\n/**\n * Return mode name as string\n *\n * @param {Mode} mode Mode object\n * @returns {String}  Mode name\n */\nexports.toString = function toString (mode) {\n  if (mode && mode.id) return mode.id\n  throw new Error('Invalid mode')\n}\n\n/**\n * Check if input param is a valid mode object\n *\n * @param   {Mode}    mode Mode object\n * @returns {Boolean} True if valid mode, false otherwise\n */\nexports.isValid = function isValid (mode) {\n  return mode && mode.bit && mode.ccBits\n}\n\n/**\n * Get mode object from its name\n *\n * @param   {String} string Mode name\n * @returns {Mode}          Mode object\n */\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'numeric':\n      return exports.NUMERIC\n    case 'alphanumeric':\n      return exports.ALPHANUMERIC\n    case 'kanji':\n      return exports.KANJI\n    case 'byte':\n      return exports.BYTE\n    default:\n      throw new Error('Unknown mode: ' + string)\n  }\n}\n\n/**\n * Returns mode from a value.\n * If value is not a valid mode, returns defaultValue\n *\n * @param  {Mode|String} value        Encoding mode\n * @param  {Mode}        defaultValue Fallback value\n * @return {Mode}                     Encoding mode\n */\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n","const Utils = require('./utils')\nconst ECCode = require('./error-correction-code')\nconst ECLevel = require('./error-correction-level')\nconst Mode = require('./mode')\nconst VersionCheck = require('./version-check')\n\n// Generator polynomial used to encode version information\nconst G18 = (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0)\nconst G18_BCH = Utils.getBCHDigit(G18)\n\nfunction getBestVersionForDataLength (mode, length, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, mode)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\nfunction getReservedBitsCount (mode, version) {\n  // Character count indicator + mode indicator bits\n  return Mode.getCharCountIndicator(mode, version) + 4\n}\n\nfunction getTotalBitsFromDataArray (segments, version) {\n  let totalBits = 0\n\n  segments.forEach(function (data) {\n    const reservedBits = getReservedBitsCount(data.mode, version)\n    totalBits += reservedBits + data.getBitsLength()\n  })\n\n  return totalBits\n}\n\nfunction getBestVersionForMixedData (segments, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    const length = getTotalBitsFromDataArray(segments, currentVersion)\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, Mode.MIXED)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\n/**\n * Returns version number from a value.\n * If value is not a valid version, returns defaultValue\n *\n * @param  {Number|String} value        QR Code version\n * @param  {Number}        defaultValue Fallback value\n * @return {Number}                     QR Code version number\n */\nexports.from = function from (value, defaultValue) {\n  if (VersionCheck.isValid(value)) {\n    return parseInt(value, 10)\n  }\n\n  return defaultValue\n}\n\n/**\n * Returns how much data can be stored with the specified QR code version\n * and error correction level\n *\n * @param  {Number} version              QR Code version (1-40)\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Mode}   mode                 Data mode\n * @return {Number}                      Quantity of storable data\n */\nexports.getCapacity = function getCapacity (version, errorCorrectionLevel, mode) {\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  // Use Byte mode as default\n  if (typeof mode === 'undefined') mode = Mode.BYTE\n\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  if (mode === Mode.MIXED) return dataTotalCodewordsBits\n\n  const usableBits = dataTotalCodewordsBits - getReservedBitsCount(mode, version)\n\n  // Return max number of storable codewords\n  switch (mode) {\n    case Mode.NUMERIC:\n      return Math.floor((usableBits / 10) * 3)\n\n    case Mode.ALPHANUMERIC:\n      return Math.floor((usableBits / 11) * 2)\n\n    case Mode.KANJI:\n      return Math.floor(usableBits / 13)\n\n    case Mode.BYTE:\n    default:\n      return Math.floor(usableBits / 8)\n  }\n}\n\n/**\n * Returns the minimum version needed to contain the amount of data\n *\n * @param  {Segment} data                    Segment of data\n * @param  {Number} [errorCorrectionLevel=H] Error correction level\n * @param  {Mode} mode                       Data mode\n * @return {Number}                          QR Code version\n */\nexports.getBestVersionForData = function getBestVersionForData (data, errorCorrectionLevel) {\n  let seg\n\n  const ecl = ECLevel.from(errorCorrectionLevel, ECLevel.M)\n\n  if (Array.isArray(data)) {\n    if (data.length > 1) {\n      return getBestVersionForMixedData(data, ecl)\n    }\n\n    if (data.length === 0) {\n      return 1\n    }\n\n    seg = data[0]\n  } else {\n    seg = data\n  }\n\n  return getBestVersionForDataLength(seg.mode, seg.getLength(), ecl)\n}\n\n/**\n * Returns version information with relative error correction bits\n *\n * The version information is included in QR Code symbols of version 7 or larger.\n * It consists of an 18-bit sequence containing 6 data bits,\n * with 12 error correction bits calculated using the (18, 6) Golay code.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Encoded version info bits\n */\nexports.getEncodedBits = function getEncodedBits (version) {\n  if (!VersionCheck.isValid(version) || version < 7) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  let d = version << 12\n\n  while (Utils.getBCHDigit(d) - G18_BCH >= 0) {\n    d ^= (G18 << (Utils.getBCHDigit(d) - G18_BCH))\n  }\n\n  return (version << 12) | d\n}\n","const Utils = require('./utils')\n\nconst G15 = (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0)\nconst G15_MASK = (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1)\nconst G15_BCH = Utils.getBCHDigit(G15)\n\n/**\n * Returns format information with relative error correction bits\n *\n * The format information is a 15-bit sequence containing 5 data bits,\n * with 10 error correction bits calculated using the (15, 5) BCH code.\n *\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Number} mask                 Mask pattern\n * @return {Number}                      Encoded format information bits\n */\nexports.getEncodedBits = function getEncodedBits (errorCorrectionLevel, mask) {\n  const data = ((errorCorrectionLevel.bit << 3) | mask)\n  let d = data << 10\n\n  while (Utils.getBCHDigit(d) - G15_BCH >= 0) {\n    d ^= (G15 << (Utils.getBCHDigit(d) - G15_BCH))\n  }\n\n  // xor final data with mask pattern in order to ensure that\n  // no combination of Error Correction Level and data mask pattern\n  // will result in an all-zero data string\n  return ((data << 10) | d) ^ G15_MASK\n}\n","const Mode = require('./mode')\n\nfunction NumericData (data) {\n  this.mode = Mode.NUMERIC\n  this.data = data.toString()\n}\n\nNumericData.getBitsLength = function getBitsLength (length) {\n  return 10 * Math.floor(length / 3) + ((length % 3) ? ((length % 3) * 3 + 1) : 0)\n}\n\nNumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nNumericData.prototype.getBitsLength = function getBitsLength () {\n  return NumericData.getBitsLength(this.data.length)\n}\n\nNumericData.prototype.write = function write (bitBuffer) {\n  let i, group, value\n\n  // The input data string is divided into groups of three digits,\n  // and each group is converted to its 10-bit binary equivalent.\n  for (i = 0; i + 3 <= this.data.length; i += 3) {\n    group = this.data.substr(i, 3)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, 10)\n  }\n\n  // If the number of input digits is not an exact multiple of three,\n  // the final one or two digits are converted to 4 or 7 bits respectively.\n  const remainingNum = this.data.length - i\n  if (remainingNum > 0) {\n    group = this.data.substr(i)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, remainingNum * 3 + 1)\n  }\n}\n\nmodule.exports = NumericData\n","const Mode = require('./mode')\n\n/**\n * Array of characters available in alphanumeric mode\n *\n * As per QR Code specification, to each character\n * is assigned a value from 0 to 44 which in this case coincides\n * with the array index\n *\n * @type {Array}\n */\nconst ALPHA_NUM_CHARS = [\n  '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',\n  'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',\n  ' ', '$', '%', '*', '+', '-', '.', '/', ':'\n]\n\nfunction AlphanumericData (data) {\n  this.mode = Mode.ALPHANUMERIC\n  this.data = data\n}\n\nAlphanumericData.getBitsLength = function getBitsLength (length) {\n  return 11 * Math.floor(length / 2) + 6 * (length % 2)\n}\n\nAlphanumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nAlphanumericData.prototype.getBitsLength = function getBitsLength () {\n  return AlphanumericData.getBitsLength(this.data.length)\n}\n\nAlphanumericData.prototype.write = function write (bitBuffer) {\n  let i\n\n  // Input data characters are divided into groups of two characters\n  // and encoded as 11-bit binary codes.\n  for (i = 0; i + 2 <= this.data.length; i += 2) {\n    // The character value of the first character is multiplied by 45\n    let value = ALPHA_NUM_CHARS.indexOf(this.data[i]) * 45\n\n    // The character value of the second digit is added to the product\n    value += ALPHA_NUM_CHARS.indexOf(this.data[i + 1])\n\n    // The sum is then stored as 11-bit binary number\n    bitBuffer.put(value, 11)\n  }\n\n  // If the number of input data characters is not a multiple of two,\n  // the character value of the final character is encoded as a 6-bit binary number.\n  if (this.data.length % 2) {\n    bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]), 6)\n  }\n}\n\nmodule.exports = AlphanumericData\n","const Mode = require('./mode')\n\nfunction ByteData (data) {\n  this.mode = Mode.BYTE\n  if (typeof (data) === 'string') {\n    this.data = new TextEncoder().encode(data)\n  } else {\n    this.data = new Uint8Array(data)\n  }\n}\n\nByteData.getBitsLength = function getBitsLength (length) {\n  return length * 8\n}\n\nByteData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nByteData.prototype.getBitsLength = function getBitsLength () {\n  return ByteData.getBitsLength(this.data.length)\n}\n\nByteData.prototype.write = function (bitBuffer) {\n  for (let i = 0, l = this.data.length; i < l; i++) {\n    bitBuffer.put(this.data[i], 8)\n  }\n}\n\nmodule.exports = ByteData\n","const Mode = require('./mode')\nconst Utils = require('./utils')\n\nfunction KanjiData (data) {\n  this.mode = Mode.KANJI\n  this.data = data\n}\n\nKanjiData.getBitsLength = function getBitsLength (length) {\n  return length * 13\n}\n\nKanjiData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nKanjiData.prototype.getBitsLength = function getBitsLength () {\n  return KanjiData.getBitsLength(this.data.length)\n}\n\nKanjiData.prototype.write = function (bitBuffer) {\n  let i\n\n  // In the Shift JIS system, Kanji characters are represented by a two byte combination.\n  // These byte values are shifted from the JIS X 0208 values.\n  // JIS X 0208 gives details of the shift coded representation.\n  for (i = 0; i < this.data.length; i++) {\n    let value = Utils.toSJIS(this.data[i])\n\n    // For characters with Shift JIS values from 0x8140 to 0x9FFC:\n    if (value >= 0x8140 && value <= 0x9FFC) {\n      // Subtract 0x8140 from Shift JIS value\n      value -= 0x8140\n\n    // For characters with Shift JIS values from 0xE040 to 0xEBBF\n    } else if (value >= 0xE040 && value <= 0xEBBF) {\n      // Subtract 0xC140 from Shift JIS value\n      value -= 0xC140\n    } else {\n      throw new Error(\n        'Invalid SJIS character: ' + this.data[i] + '\\n' +\n        'Make sure your charset is UTF-8')\n    }\n\n    // Multiply most significant byte of result by 0xC0\n    // and add least significant byte to product\n    value = (((value >>> 8) & 0xff) * 0xC0) + (value & 0xff)\n\n    // Convert result to a 13-bit binary string\n    bitBuffer.put(value, 13)\n  }\n}\n\nmodule.exports = KanjiData\n","'use strict';\n\n/******************************************************************************\n * Created 2008-08-19.\n *\n * Dijkstra path-finding functions. Adapted from the Dijkstar Python project.\n *\n * Copyright (C) 2008\n *   Wyatt Baldwin <self@wyattbaldwin.com>\n *   All rights reserved\n *\n * Licensed under the MIT license.\n *\n *   http://www.opensource.org/licenses/mit-license.php\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *****************************************************************************/\nvar dijkstra = {\n  single_source_shortest_paths: function(graph, s, d) {\n    // Predecessor map for each node that has been encountered.\n    // node ID => predecessor node ID\n    var predecessors = {};\n\n    // Costs of shortest paths from s to all nodes encountered.\n    // node ID => cost\n    var costs = {};\n    costs[s] = 0;\n\n    // Costs of shortest paths from s to all nodes encountered; differs from\n    // `costs` in that it provides easy access to the node that currently has\n    // the known shortest path from s.\n    // XXX: Do we actually need both `costs` and `open`?\n    var open = dijkstra.PriorityQueue.make();\n    open.push(s, 0);\n\n    var closest,\n        u, v,\n        cost_of_s_to_u,\n        adjacent_nodes,\n        cost_of_e,\n        cost_of_s_to_u_plus_cost_of_e,\n        cost_of_s_to_v,\n        first_visit;\n    while (!open.empty()) {\n      // In the nodes remaining in graph that have a known cost from s,\n      // find the node, u, that currently has the shortest path from s.\n      closest = open.pop();\n      u = closest.value;\n      cost_of_s_to_u = closest.cost;\n\n      // Get nodes adjacent to u...\n      adjacent_nodes = graph[u] || {};\n\n      // ...and explore the edges that connect u to those nodes, updating\n      // the cost of the shortest paths to any or all of those nodes as\n      // necessary. v is the node across the current edge from u.\n      for (v in adjacent_nodes) {\n        if (adjacent_nodes.hasOwnProperty(v)) {\n          // Get the cost of the edge running from u to v.\n          cost_of_e = adjacent_nodes[v];\n\n          // Cost of s to u plus the cost of u to v across e--this is *a*\n          // cost from s to v that may or may not be less than the current\n          // known cost to v.\n          cost_of_s_to_u_plus_cost_of_e = cost_of_s_to_u + cost_of_e;\n\n          // If we haven't visited v yet OR if the current known cost from s to\n          // v is greater than the new cost we just found (cost of s to u plus\n          // cost of u to v across e), update v's cost in the cost list and\n          // update v's predecessor in the predecessor list (it's now u).\n          cost_of_s_to_v = costs[v];\n          first_visit = (typeof costs[v] === 'undefined');\n          if (first_visit || cost_of_s_to_v > cost_of_s_to_u_plus_cost_of_e) {\n            costs[v] = cost_of_s_to_u_plus_cost_of_e;\n            open.push(v, cost_of_s_to_u_plus_cost_of_e);\n            predecessors[v] = u;\n          }\n        }\n      }\n    }\n\n    if (typeof d !== 'undefined' && typeof costs[d] === 'undefined') {\n      var msg = ['Could not find a path from ', s, ' to ', d, '.'].join('');\n      throw new Error(msg);\n    }\n\n    return predecessors;\n  },\n\n  extract_shortest_path_from_predecessor_list: function(predecessors, d) {\n    var nodes = [];\n    var u = d;\n    var predecessor;\n    while (u) {\n      nodes.push(u);\n      predecessor = predecessors[u];\n      u = predecessors[u];\n    }\n    nodes.reverse();\n    return nodes;\n  },\n\n  find_path: function(graph, s, d) {\n    var predecessors = dijkstra.single_source_shortest_paths(graph, s, d);\n    return dijkstra.extract_shortest_path_from_predecessor_list(\n      predecessors, d);\n  },\n\n  /**\n   * A very naive priority queue implementation.\n   */\n  PriorityQueue: {\n    make: function (opts) {\n      var T = dijkstra.PriorityQueue,\n          t = {},\n          key;\n      opts = opts || {};\n      for (key in T) {\n        if (T.hasOwnProperty(key)) {\n          t[key] = T[key];\n        }\n      }\n      t.queue = [];\n      t.sorter = opts.sorter || T.default_sorter;\n      return t;\n    },\n\n    default_sorter: function (a, b) {\n      return a.cost - b.cost;\n    },\n\n    /**\n     * Add a new item to the queue and ensure the highest priority element\n     * is at the front of the queue.\n     */\n    push: function (value, cost) {\n      var item = {value: value, cost: cost};\n      this.queue.push(item);\n      this.queue.sort(this.sorter);\n    },\n\n    /**\n     * Return the highest priority element in the queue.\n     */\n    pop: function () {\n      return this.queue.shift();\n    },\n\n    empty: function () {\n      return this.queue.length === 0;\n    }\n  }\n};\n\n\n// node.js module exports\nif (typeof module !== 'undefined') {\n  module.exports = dijkstra;\n}\n","const Mode = require('./mode')\nconst NumericData = require('./numeric-data')\nconst AlphanumericData = require('./alphanumeric-data')\nconst ByteData = require('./byte-data')\nconst KanjiData = require('./kanji-data')\nconst Regex = require('./regex')\nconst Utils = require('./utils')\nconst dijkstra = require('dijkstrajs')\n\n/**\n * Returns UTF8 byte length\n *\n * @param  {String} str Input string\n * @return {Number}     Number of byte\n */\nfunction getStringByteLength (str) {\n  return unescape(encodeURIComponent(str)).length\n}\n\n/**\n * Get a list of segments of the specified mode\n * from a string\n *\n * @param  {Mode}   mode Segment mode\n * @param  {String} str  String to process\n * @return {Array}       Array of object with segments data\n */\nfunction getSegments (regex, mode, str) {\n  const segments = []\n  let result\n\n  while ((result = regex.exec(str)) !== null) {\n    segments.push({\n      data: result[0],\n      index: result.index,\n      mode: mode,\n      length: result[0].length\n    })\n  }\n\n  return segments\n}\n\n/**\n * Extracts a series of segments with the appropriate\n * modes from a string\n *\n * @param  {String} dataStr Input string\n * @return {Array}          Array of object with segments data\n */\nfunction getSegmentsFromString (dataStr) {\n  const numSegs = getSegments(Regex.NUMERIC, Mode.NUMERIC, dataStr)\n  const alphaNumSegs = getSegments(Regex.ALPHANUMERIC, Mode.ALPHANUMERIC, dataStr)\n  let byteSegs\n  let kanjiSegs\n\n  if (Utils.isKanjiModeEnabled()) {\n    byteSegs = getSegments(Regex.BYTE, Mode.BYTE, dataStr)\n    kanjiSegs = getSegments(Regex.KANJI, Mode.KANJI, dataStr)\n  } else {\n    byteSegs = getSegments(Regex.BYTE_KANJI, Mode.BYTE, dataStr)\n    kanjiSegs = []\n  }\n\n  const segs = numSegs.concat(alphaNumSegs, byteSegs, kanjiSegs)\n\n  return segs\n    .sort(function (s1, s2) {\n      return s1.index - s2.index\n    })\n    .map(function (obj) {\n      return {\n        data: obj.data,\n        mode: obj.mode,\n        length: obj.length\n      }\n    })\n}\n\n/**\n * Returns how many bits are needed to encode a string of\n * specified length with the specified mode\n *\n * @param  {Number} length String length\n * @param  {Mode} mode     Segment mode\n * @return {Number}        Bit length\n */\nfunction getSegmentBitsLength (length, mode) {\n  switch (mode) {\n    case Mode.NUMERIC:\n      return NumericData.getBitsLength(length)\n    case Mode.ALPHANUMERIC:\n      return AlphanumericData.getBitsLength(length)\n    case Mode.KANJI:\n      return KanjiData.getBitsLength(length)\n    case Mode.BYTE:\n      return ByteData.getBitsLength(length)\n  }\n}\n\n/**\n * Merges adjacent segments which have the same mode\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction mergeSegments (segs) {\n  return segs.reduce(function (acc, curr) {\n    const prevSeg = acc.length - 1 >= 0 ? acc[acc.length - 1] : null\n    if (prevSeg && prevSeg.mode === curr.mode) {\n      acc[acc.length - 1].data += curr.data\n      return acc\n    }\n\n    acc.push(curr)\n    return acc\n  }, [])\n}\n\n/**\n * Generates a list of all possible nodes combination which\n * will be used to build a segments graph.\n *\n * Nodes are divided by groups. Each group will contain a list of all the modes\n * in which is possible to encode the given text.\n *\n * For example the text '12345' can be encoded as Numeric, Alphanumeric or Byte.\n * The group for '12345' will contain then 3 objects, one for each\n * possible encoding mode.\n *\n * Each node represents a possible segment.\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction buildNodes (segs) {\n  const nodes = []\n  for (let i = 0; i < segs.length; i++) {\n    const seg = segs[i]\n\n    switch (seg.mode) {\n      case Mode.NUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.ALPHANUMERIC, length: seg.length },\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.ALPHANUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.KANJI:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n        break\n      case Mode.BYTE:\n        nodes.push([\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n    }\n  }\n\n  return nodes\n}\n\n/**\n * Builds a graph from a list of nodes.\n * All segments in each node group will be connected with all the segments of\n * the next group and so on.\n *\n * At each connection will be assigned a weight depending on the\n * segment's byte length.\n *\n * @param  {Array} nodes    Array of object with segments data\n * @param  {Number} version QR Code version\n * @return {Object}         Graph of all possible segments\n */\nfunction buildGraph (nodes, version) {\n  const table = {}\n  const graph = { start: {} }\n  let prevNodeIds = ['start']\n\n  for (let i = 0; i < nodes.length; i++) {\n    const nodeGroup = nodes[i]\n    const currentNodeIds = []\n\n    for (let j = 0; j < nodeGroup.length; j++) {\n      const node = nodeGroup[j]\n      const key = '' + i + j\n\n      currentNodeIds.push(key)\n      table[key] = { node: node, lastCount: 0 }\n      graph[key] = {}\n\n      for (let n = 0; n < prevNodeIds.length; n++) {\n        const prevNodeId = prevNodeIds[n]\n\n        if (table[prevNodeId] && table[prevNodeId].node.mode === node.mode) {\n          graph[prevNodeId][key] =\n            getSegmentBitsLength(table[prevNodeId].lastCount + node.length, node.mode) -\n            getSegmentBitsLength(table[prevNodeId].lastCount, node.mode)\n\n          table[prevNodeId].lastCount += node.length\n        } else {\n          if (table[prevNodeId]) table[prevNodeId].lastCount = node.length\n\n          graph[prevNodeId][key] = getSegmentBitsLength(node.length, node.mode) +\n            4 + Mode.getCharCountIndicator(node.mode, version) // switch cost\n        }\n      }\n    }\n\n    prevNodeIds = currentNodeIds\n  }\n\n  for (let n = 0; n < prevNodeIds.length; n++) {\n    graph[prevNodeIds[n]].end = 0\n  }\n\n  return { map: graph, table: table }\n}\n\n/**\n * Builds a segment from a specified data and mode.\n * If a mode is not specified, the more suitable will be used.\n *\n * @param  {String} data             Input data\n * @param  {Mode | String} modesHint Data mode\n * @return {Segment}                 Segment\n */\nfunction buildSingleSegment (data, modesHint) {\n  let mode\n  const bestMode = Mode.getBestModeForData(data)\n\n  mode = Mode.from(modesHint, bestMode)\n\n  // Make sure data can be encoded\n  if (mode !== Mode.BYTE && mode.bit < bestMode.bit) {\n    throw new Error('\"' + data + '\"' +\n      ' cannot be encoded with mode ' + Mode.toString(mode) +\n      '.\\n Suggested mode is: ' + Mode.toString(bestMode))\n  }\n\n  // Use Mode.BYTE if Kanji support is disabled\n  if (mode === Mode.KANJI && !Utils.isKanjiModeEnabled()) {\n    mode = Mode.BYTE\n  }\n\n  switch (mode) {\n    case Mode.NUMERIC:\n      return new NumericData(data)\n\n    case Mode.ALPHANUMERIC:\n      return new AlphanumericData(data)\n\n    case Mode.KANJI:\n      return new KanjiData(data)\n\n    case Mode.BYTE:\n      return new ByteData(data)\n  }\n}\n\n/**\n * Builds a list of segments from an array.\n * Array can contain Strings or Objects with segment's info.\n *\n * For each item which is a string, will be generated a segment with the given\n * string and the more appropriate encoding mode.\n *\n * For each item which is an object, will be generated a segment with the given\n * data and mode.\n * Objects must contain at least the property \"data\".\n * If property \"mode\" is not present, the more suitable mode will be used.\n *\n * @param  {Array} array Array of objects with segments data\n * @return {Array}       Array of Segments\n */\nexports.fromArray = function fromArray (array) {\n  return array.reduce(function (acc, seg) {\n    if (typeof seg === 'string') {\n      acc.push(buildSingleSegment(seg, null))\n    } else if (seg.data) {\n      acc.push(buildSingleSegment(seg.data, seg.mode))\n    }\n\n    return acc\n  }, [])\n}\n\n/**\n * Builds an optimized sequence of segments from a string,\n * which will produce the shortest possible bitstream.\n *\n * @param  {String} data    Input string\n * @param  {Number} version QR Code version\n * @return {Array}          Array of segments\n */\nexports.fromString = function fromString (data, version) {\n  const segs = getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n\n  const nodes = buildNodes(segs)\n  const graph = buildGraph(nodes, version)\n  const path = dijkstra.find_path(graph.map, 'start', 'end')\n\n  const optimizedSegs = []\n  for (let i = 1; i < path.length - 1; i++) {\n    optimizedSegs.push(graph.table[path[i]].node)\n  }\n\n  return exports.fromArray(mergeSegments(optimizedSegs))\n}\n\n/**\n * Splits a string in various segments with the modes which\n * best represent their content.\n * The produced segments are far from being optimized.\n * The output of this function is only used to estimate a QR Code version\n * which may contain the data.\n *\n * @param  {string} data Input string\n * @return {Array}       Array of segments\n */\nexports.rawSplit = function rawSplit (data) {\n  return exports.fromArray(\n    getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n  )\n}\n","const Utils = require('./utils')\nconst ECLevel = require('./error-correction-level')\nconst BitBuffer = require('./bit-buffer')\nconst BitMatrix = require('./bit-matrix')\nconst AlignmentPattern = require('./alignment-pattern')\nconst FinderPattern = require('./finder-pattern')\nconst MaskPattern = require('./mask-pattern')\nconst ECCode = require('./error-correction-code')\nconst ReedSolomonEncoder = require('./reed-solomon-encoder')\nconst Version = require('./version')\nconst FormatInfo = require('./format-info')\nconst Mode = require('./mode')\nconst Segments = require('./segments')\n\n/**\n * QRCode for JavaScript\n *\n * modified by Ryan Day for nodejs support\n * Copyright (c) 2011 Ryan Day\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/mit-license.php\n *\n//---------------------------------------------------------------------\n// QRCode for JavaScript\n//\n// Copyright (c) 2009 Kazuhiko Arase\n//\n// URL: http://www.d-project.com/\n//\n// Licensed under the MIT license:\n//   http://www.opensource.org/licenses/mit-license.php\n//\n// The word \"QR Code\" is registered trademark of\n// DENSO WAVE INCORPORATED\n//   http://www.denso-wave.com/qrcode/faqpatent-e.html\n//\n//---------------------------------------------------------------------\n*/\n\n/**\n * Add finder patterns bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupFinderPattern (matrix, version) {\n  const size = matrix.size\n  const pos = FinderPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -1; r <= 7; r++) {\n      if (row + r <= -1 || size <= row + r) continue\n\n      for (let c = -1; c <= 7; c++) {\n        if (col + c <= -1 || size <= col + c) continue\n\n        if ((r >= 0 && r <= 6 && (c === 0 || c === 6)) ||\n          (c >= 0 && c <= 6 && (r === 0 || r === 6)) ||\n          (r >= 2 && r <= 4 && c >= 2 && c <= 4)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add timing pattern bits to matrix\n *\n * Note: this function must be called before {@link setupAlignmentPattern}\n *\n * @param  {BitMatrix} matrix Modules matrix\n */\nfunction setupTimingPattern (matrix) {\n  const size = matrix.size\n\n  for (let r = 8; r < size - 8; r++) {\n    const value = r % 2 === 0\n    matrix.set(r, 6, value, true)\n    matrix.set(6, r, value, true)\n  }\n}\n\n/**\n * Add alignment patterns bits to matrix\n *\n * Note: this function must be called after {@link setupTimingPattern}\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupAlignmentPattern (matrix, version) {\n  const pos = AlignmentPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -2; r <= 2; r++) {\n      for (let c = -2; c <= 2; c++) {\n        if (r === -2 || r === 2 || c === -2 || c === 2 ||\n          (r === 0 && c === 0)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add version info bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupVersionInfo (matrix, version) {\n  const size = matrix.size\n  const bits = Version.getEncodedBits(version)\n  let row, col, mod\n\n  for (let i = 0; i < 18; i++) {\n    row = Math.floor(i / 3)\n    col = i % 3 + size - 8 - 3\n    mod = ((bits >> i) & 1) === 1\n\n    matrix.set(row, col, mod, true)\n    matrix.set(col, row, mod, true)\n  }\n}\n\n/**\n * Add format info bits to matrix\n *\n * @param  {BitMatrix} matrix               Modules matrix\n * @param  {ErrorCorrectionLevel}    errorCorrectionLevel Error correction level\n * @param  {Number}    maskPattern          Mask pattern reference value\n */\nfunction setupFormatInfo (matrix, errorCorrectionLevel, maskPattern) {\n  const size = matrix.size\n  const bits = FormatInfo.getEncodedBits(errorCorrectionLevel, maskPattern)\n  let i, mod\n\n  for (i = 0; i < 15; i++) {\n    mod = ((bits >> i) & 1) === 1\n\n    // vertical\n    if (i < 6) {\n      matrix.set(i, 8, mod, true)\n    } else if (i < 8) {\n      matrix.set(i + 1, 8, mod, true)\n    } else {\n      matrix.set(size - 15 + i, 8, mod, true)\n    }\n\n    // horizontal\n    if (i < 8) {\n      matrix.set(8, size - i - 1, mod, true)\n    } else if (i < 9) {\n      matrix.set(8, 15 - i - 1 + 1, mod, true)\n    } else {\n      matrix.set(8, 15 - i - 1, mod, true)\n    }\n  }\n\n  // fixed module\n  matrix.set(size - 8, 8, 1, true)\n}\n\n/**\n * Add encoded data bits to matrix\n *\n * @param  {BitMatrix}  matrix Modules matrix\n * @param  {Uint8Array} data   Data codewords\n */\nfunction setupData (matrix, data) {\n  const size = matrix.size\n  let inc = -1\n  let row = size - 1\n  let bitIndex = 7\n  let byteIndex = 0\n\n  for (let col = size - 1; col > 0; col -= 2) {\n    if (col === 6) col--\n\n    while (true) {\n      for (let c = 0; c < 2; c++) {\n        if (!matrix.isReserved(row, col - c)) {\n          let dark = false\n\n          if (byteIndex < data.length) {\n            dark = (((data[byteIndex] >>> bitIndex) & 1) === 1)\n          }\n\n          matrix.set(row, col - c, dark)\n          bitIndex--\n\n          if (bitIndex === -1) {\n            byteIndex++\n            bitIndex = 7\n          }\n        }\n      }\n\n      row += inc\n\n      if (row < 0 || size <= row) {\n        row -= inc\n        inc = -inc\n        break\n      }\n    }\n  }\n}\n\n/**\n * Create encoded codewords from data input\n *\n * @param  {Number}   version              QR Code version\n * @param  {ErrorCorrectionLevel}   errorCorrectionLevel Error correction level\n * @param  {ByteData} data                 Data input\n * @return {Uint8Array}                    Buffer containing encoded codewords\n */\nfunction createData (version, errorCorrectionLevel, segments) {\n  // Prepare data buffer\n  const buffer = new BitBuffer()\n\n  segments.forEach(function (data) {\n    // prefix data with mode indicator (4 bits)\n    buffer.put(data.mode.bit, 4)\n\n    // Prefix data with character count indicator.\n    // The character count indicator is a string of bits that represents the\n    // number of characters that are being encoded.\n    // The character count indicator must be placed after the mode indicator\n    // and must be a certain number of bits long, depending on the QR version\n    // and data mode\n    // @see {@link Mode.getCharCountIndicator}.\n    buffer.put(data.getLength(), Mode.getCharCountIndicator(data.mode, version))\n\n    // add binary data sequence to buffer\n    data.write(buffer)\n  })\n\n  // Calculate required number of bits\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  // Add a terminator.\n  // If the bit string is shorter than the total number of required bits,\n  // a terminator of up to four 0s must be added to the right side of the string.\n  // If the bit string is more than four bits shorter than the required number of bits,\n  // add four 0s to the end.\n  if (buffer.getLengthInBits() + 4 <= dataTotalCodewordsBits) {\n    buffer.put(0, 4)\n  }\n\n  // If the bit string is fewer than four bits shorter, add only the number of 0s that\n  // are needed to reach the required number of bits.\n\n  // After adding the terminator, if the number of bits in the string is not a multiple of 8,\n  // pad the string on the right with 0s to make the string's length a multiple of 8.\n  while (buffer.getLengthInBits() % 8 !== 0) {\n    buffer.putBit(0)\n  }\n\n  // Add pad bytes if the string is still shorter than the total number of required bits.\n  // Extend the buffer to fill the data capacity of the symbol corresponding to\n  // the Version and Error Correction Level by adding the Pad Codewords 11101100 (0xEC)\n  // and 00010001 (0x11) alternately.\n  const remainingByte = (dataTotalCodewordsBits - buffer.getLengthInBits()) / 8\n  for (let i = 0; i < remainingByte; i++) {\n    buffer.put(i % 2 ? 0x11 : 0xEC, 8)\n  }\n\n  return createCodewords(buffer, version, errorCorrectionLevel)\n}\n\n/**\n * Encode input data with Reed-Solomon and return codewords with\n * relative error correction bits\n *\n * @param  {BitBuffer} bitBuffer            Data to encode\n * @param  {Number}    version              QR Code version\n * @param  {ErrorCorrectionLevel} errorCorrectionLevel Error correction level\n * @return {Uint8Array}                     Buffer containing encoded codewords\n */\nfunction createCodewords (bitBuffer, version, errorCorrectionLevel) {\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewords = totalCodewords - ecTotalCodewords\n\n  // Total number of blocks\n  const ecTotalBlocks = ECCode.getBlocksCount(version, errorCorrectionLevel)\n\n  // Calculate how many blocks each group should contain\n  const blocksInGroup2 = totalCodewords % ecTotalBlocks\n  const blocksInGroup1 = ecTotalBlocks - blocksInGroup2\n\n  const totalCodewordsInGroup1 = Math.floor(totalCodewords / ecTotalBlocks)\n\n  const dataCodewordsInGroup1 = Math.floor(dataTotalCodewords / ecTotalBlocks)\n  const dataCodewordsInGroup2 = dataCodewordsInGroup1 + 1\n\n  // Number of EC codewords is the same for both groups\n  const ecCount = totalCodewordsInGroup1 - dataCodewordsInGroup1\n\n  // Initialize a Reed-Solomon encoder with a generator polynomial of degree ecCount\n  const rs = new ReedSolomonEncoder(ecCount)\n\n  let offset = 0\n  const dcData = new Array(ecTotalBlocks)\n  const ecData = new Array(ecTotalBlocks)\n  let maxDataSize = 0\n  const buffer = new Uint8Array(bitBuffer.buffer)\n\n  // Divide the buffer into the required number of blocks\n  for (let b = 0; b < ecTotalBlocks; b++) {\n    const dataSize = b < blocksInGroup1 ? dataCodewordsInGroup1 : dataCodewordsInGroup2\n\n    // extract a block of data from buffer\n    dcData[b] = buffer.slice(offset, offset + dataSize)\n\n    // Calculate EC codewords for this data block\n    ecData[b] = rs.encode(dcData[b])\n\n    offset += dataSize\n    maxDataSize = Math.max(maxDataSize, dataSize)\n  }\n\n  // Create final data\n  // Interleave the data and error correction codewords from each block\n  const data = new Uint8Array(totalCodewords)\n  let index = 0\n  let i, r\n\n  // Add data codewords\n  for (i = 0; i < maxDataSize; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      if (i < dcData[r].length) {\n        data[index++] = dcData[r][i]\n      }\n    }\n  }\n\n  // Apped EC codewords\n  for (i = 0; i < ecCount; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      data[index++] = ecData[r][i]\n    }\n  }\n\n  return data\n}\n\n/**\n * Build QR Code symbol\n *\n * @param  {String} data                 Input string\n * @param  {Number} version              QR Code version\n * @param  {ErrorCorretionLevel} errorCorrectionLevel Error level\n * @param  {MaskPattern} maskPattern     Mask pattern\n * @return {Object}                      Object containing symbol data\n */\nfunction createSymbol (data, version, errorCorrectionLevel, maskPattern) {\n  let segments\n\n  if (Array.isArray(data)) {\n    segments = Segments.fromArray(data)\n  } else if (typeof data === 'string') {\n    let estimatedVersion = version\n\n    if (!estimatedVersion) {\n      const rawSegments = Segments.rawSplit(data)\n\n      // Estimate best version that can contain raw splitted segments\n      estimatedVersion = Version.getBestVersionForData(rawSegments, errorCorrectionLevel)\n    }\n\n    // Build optimized segments\n    // If estimated version is undefined, try with the highest version\n    segments = Segments.fromString(data, estimatedVersion || 40)\n  } else {\n    throw new Error('Invalid data')\n  }\n\n  // Get the min version that can contain data\n  const bestVersion = Version.getBestVersionForData(segments, errorCorrectionLevel)\n\n  // If no version is found, data cannot be stored\n  if (!bestVersion) {\n    throw new Error('The amount of data is too big to be stored in a QR Code')\n  }\n\n  // If not specified, use min version as default\n  if (!version) {\n    version = bestVersion\n\n  // Check if the specified version can contain the data\n  } else if (version < bestVersion) {\n    throw new Error('\\n' +\n      'The chosen QR Code version cannot contain this amount of data.\\n' +\n      'Minimum version required to store current data is: ' + bestVersion + '.\\n'\n    )\n  }\n\n  const dataBits = createData(version, errorCorrectionLevel, segments)\n\n  // Allocate matrix buffer\n  const moduleCount = Utils.getSymbolSize(version)\n  const modules = new BitMatrix(moduleCount)\n\n  // Add function modules\n  setupFinderPattern(modules, version)\n  setupTimingPattern(modules)\n  setupAlignmentPattern(modules, version)\n\n  // Add temporary dummy bits for format info just to set them as reserved.\n  // This is needed to prevent these bits from being masked by {@link MaskPattern.applyMask}\n  // since the masking operation must be performed only on the encoding region.\n  // These blocks will be replaced with correct values later in code.\n  setupFormatInfo(modules, errorCorrectionLevel, 0)\n\n  if (version >= 7) {\n    setupVersionInfo(modules, version)\n  }\n\n  // Add data codewords\n  setupData(modules, dataBits)\n\n  if (isNaN(maskPattern)) {\n    // Find best mask pattern\n    maskPattern = MaskPattern.getBestMask(modules,\n      setupFormatInfo.bind(null, modules, errorCorrectionLevel))\n  }\n\n  // Apply mask pattern\n  MaskPattern.applyMask(maskPattern, modules)\n\n  // Replace format info bits with correct values\n  setupFormatInfo(modules, errorCorrectionLevel, maskPattern)\n\n  return {\n    modules: modules,\n    version: version,\n    errorCorrectionLevel: errorCorrectionLevel,\n    maskPattern: maskPattern,\n    segments: segments\n  }\n}\n\n/**\n * QR Code\n *\n * @param {String | Array} data                 Input data\n * @param {Object} options                      Optional configurations\n * @param {Number} options.version              QR Code version\n * @param {String} options.errorCorrectionLevel Error correction level\n * @param {Function} options.toSJISFunc         Helper func to convert utf8 to sjis\n */\nexports.create = function create (data, options) {\n  if (typeof data === 'undefined' || data === '') {\n    throw new Error('No input text')\n  }\n\n  let errorCorrectionLevel = ECLevel.M\n  let version\n  let mask\n\n  if (typeof options !== 'undefined') {\n    // Use higher error correction level as default\n    errorCorrectionLevel = ECLevel.from(options.errorCorrectionLevel, ECLevel.M)\n    version = Version.from(options.version)\n    mask = MaskPattern.from(options.maskPattern)\n\n    if (options.toSJISFunc) {\n      Utils.setToSJISFunction(options.toSJISFunc)\n    }\n  }\n\n  return createSymbol(data, version, errorCorrectionLevel, mask)\n}\n","function hex2rgba (hex) {\n  if (typeof hex === 'number') {\n    hex = hex.toString()\n  }\n\n  if (typeof hex !== 'string') {\n    throw new Error('Color should be defined as hex string')\n  }\n\n  let hexCode = hex.slice().replace('#', '').split('')\n  if (hexCode.length < 3 || hexCode.length === 5 || hexCode.length > 8) {\n    throw new Error('Invalid hex color: ' + hex)\n  }\n\n  // Convert from short to long form (fff -> ffffff)\n  if (hexCode.length === 3 || hexCode.length === 4) {\n    hexCode = Array.prototype.concat.apply([], hexCode.map(function (c) {\n      return [c, c]\n    }))\n  }\n\n  // Add default alpha value\n  if (hexCode.length === 6) hexCode.push('F', 'F')\n\n  const hexValue = parseInt(hexCode.join(''), 16)\n\n  return {\n    r: (hexValue >> 24) & 255,\n    g: (hexValue >> 16) & 255,\n    b: (hexValue >> 8) & 255,\n    a: hexValue & 255,\n    hex: '#' + hexCode.slice(0, 6).join('')\n  }\n}\n\nexports.getOptions = function getOptions (options) {\n  if (!options) options = {}\n  if (!options.color) options.color = {}\n\n  const margin = typeof options.margin === 'undefined' ||\n    options.margin === null ||\n    options.margin < 0\n    ? 4\n    : options.margin\n\n  const width = options.width && options.width >= 21 ? options.width : undefined\n  const scale = options.scale || 4\n\n  return {\n    width: width,\n    scale: width ? 4 : scale,\n    margin: margin,\n    color: {\n      dark: hex2rgba(options.color.dark || '#000000ff'),\n      light: hex2rgba(options.color.light || '#ffffffff')\n    },\n    type: options.type,\n    rendererOpts: options.rendererOpts || {}\n  }\n}\n\nexports.getScale = function getScale (qrSize, opts) {\n  return opts.width && opts.width >= qrSize + opts.margin * 2\n    ? opts.width / (qrSize + opts.margin * 2)\n    : opts.scale\n}\n\nexports.getImageWidth = function getImageWidth (qrSize, opts) {\n  const scale = exports.getScale(qrSize, opts)\n  return Math.floor((qrSize + opts.margin * 2) * scale)\n}\n\nexports.qrToImageData = function qrToImageData (imgData, qr, opts) {\n  const size = qr.modules.size\n  const data = qr.modules.data\n  const scale = exports.getScale(size, opts)\n  const symbolSize = Math.floor((size + opts.margin * 2) * scale)\n  const scaledMargin = opts.margin * scale\n  const palette = [opts.color.light, opts.color.dark]\n\n  for (let i = 0; i < symbolSize; i++) {\n    for (let j = 0; j < symbolSize; j++) {\n      let posDst = (i * symbolSize + j) * 4\n      let pxColor = opts.color.light\n\n      if (i >= scaledMargin && j >= scaledMargin &&\n        i < symbolSize - scaledMargin && j < symbolSize - scaledMargin) {\n        const iSrc = Math.floor((i - scaledMargin) / scale)\n        const jSrc = Math.floor((j - scaledMargin) / scale)\n        pxColor = palette[data[iSrc * size + jSrc] ? 1 : 0]\n      }\n\n      imgData[posDst++] = pxColor.r\n      imgData[posDst++] = pxColor.g\n      imgData[posDst++] = pxColor.b\n      imgData[posDst] = pxColor.a\n    }\n  }\n}\n","const Utils = require('./utils')\n\nfunction clearCanvas (ctx, canvas, size) {\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n  if (!canvas.style) canvas.style = {}\n  canvas.height = size\n  canvas.width = size\n  canvas.style.height = size + 'px'\n  canvas.style.width = size + 'px'\n}\n\nfunction getCanvasElement () {\n  try {\n    return document.createElement('canvas')\n  } catch (e) {\n    throw new Error('You need to specify a canvas element')\n  }\n}\n\nexports.render = function render (qrData, canvas, options) {\n  let opts = options\n  let canvasEl = canvas\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!canvas) {\n    canvasEl = getCanvasElement()\n  }\n\n  opts = Utils.getOptions(opts)\n  const size = Utils.getImageWidth(qrData.modules.size, opts)\n\n  const ctx = canvasEl.getContext('2d')\n  const image = ctx.createImageData(size, size)\n  Utils.qrToImageData(image.data, qrData, opts)\n\n  clearCanvas(ctx, canvasEl, size)\n  ctx.putImageData(image, 0, 0)\n\n  return canvasEl\n}\n\nexports.renderToDataURL = function renderToDataURL (qrData, canvas, options) {\n  let opts = options\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!opts) opts = {}\n\n  const canvasEl = exports.render(qrData, canvas, opts)\n\n  const type = opts.type || 'image/png'\n  const rendererOpts = opts.rendererOpts || {}\n\n  return canvasEl.toDataURL(type, rendererOpts.quality)\n}\n","const Utils = require('./utils')\n\nfunction getColorAttrib (color, attrib) {\n  const alpha = color.a / 255\n  const str = attrib + '=\"' + color.hex + '\"'\n\n  return alpha < 1\n    ? str + ' ' + attrib + '-opacity=\"' + alpha.toFixed(2).slice(1) + '\"'\n    : str\n}\n\nfunction svgCmd (cmd, x, y) {\n  let str = cmd + x\n  if (typeof y !== 'undefined') str += ' ' + y\n\n  return str\n}\n\nfunction qrToPath (data, size, margin) {\n  let path = ''\n  let moveBy = 0\n  let newRow = false\n  let lineLength = 0\n\n  for (let i = 0; i < data.length; i++) {\n    const col = Math.floor(i % size)\n    const row = Math.floor(i / size)\n\n    if (!col && !newRow) newRow = true\n\n    if (data[i]) {\n      lineLength++\n\n      if (!(i > 0 && col > 0 && data[i - 1])) {\n        path += newRow\n          ? svgCmd('M', col + margin, 0.5 + row + margin)\n          : svgCmd('m', moveBy, 0)\n\n        moveBy = 0\n        newRow = false\n      }\n\n      if (!(col + 1 < size && data[i + 1])) {\n        path += svgCmd('h', lineLength)\n        lineLength = 0\n      }\n    } else {\n      moveBy++\n    }\n  }\n\n  return path\n}\n\nexports.render = function render (qrData, options, cb) {\n  const opts = Utils.getOptions(options)\n  const size = qrData.modules.size\n  const data = qrData.modules.data\n  const qrcodesize = size + opts.margin * 2\n\n  const bg = !opts.color.light.a\n    ? ''\n    : '<path ' + getColorAttrib(opts.color.light, 'fill') +\n      ' d=\"M0 0h' + qrcodesize + 'v' + qrcodesize + 'H0z\"/>'\n\n  const path =\n    '<path ' + getColorAttrib(opts.color.dark, 'stroke') +\n    ' d=\"' + qrToPath(data, size, opts.margin) + '\"/>'\n\n  const viewBox = 'viewBox=\"' + '0 0 ' + qrcodesize + ' ' + qrcodesize + '\"'\n\n  const width = !opts.width ? '' : 'width=\"' + opts.width + '\" height=\"' + opts.width + '\" '\n\n  const svgTag = '<svg xmlns=\"http://www.w3.org/2000/svg\" ' + width + viewBox + ' shape-rendering=\"crispEdges\">' + bg + path + '</svg>\\n'\n\n  if (typeof cb === 'function') {\n    cb(null, svgTag)\n  }\n\n  return svgTag\n}\n","\nconst canPromise = require('./can-promise')\n\nconst QRCode = require('./core/qrcode')\nconst CanvasRenderer = require('./renderer/canvas')\nconst SvgRenderer = require('./renderer/svg-tag.js')\n\nfunction renderCanvas (renderFunc, canvas, text, opts, cb) {\n  const args = [].slice.call(arguments, 1)\n  const argsNum = args.length\n  const isLastArgCb = typeof args[argsNum - 1] === 'function'\n\n  if (!isLastArgCb && !canPromise()) {\n    throw new Error('Callback required as last argument')\n  }\n\n  if (isLastArgCb) {\n    if (argsNum < 2) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 2) {\n      cb = text\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 3) {\n      if (canvas.getContext && typeof cb === 'undefined') {\n        cb = opts\n        opts = undefined\n      } else {\n        cb = opts\n        opts = text\n        text = canvas\n        canvas = undefined\n      }\n    }\n  } else {\n    if (argsNum < 1) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 1) {\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 2 && !canvas.getContext) {\n      opts = text\n      text = canvas\n      canvas = undefined\n    }\n\n    return new Promise(function (resolve, reject) {\n      try {\n        const data = QRCode.create(text, opts)\n        resolve(renderFunc(data, canvas, opts))\n      } catch (e) {\n        reject(e)\n      }\n    })\n  }\n\n  try {\n    const data = QRCode.create(text, opts)\n    cb(null, renderFunc(data, canvas, opts))\n  } catch (e) {\n    cb(e)\n  }\n}\n\nexports.create = QRCode.create\nexports.toCanvas = renderCanvas.bind(null, CanvasRenderer.render)\nexports.toDataURL = renderCanvas.bind(null, CanvasRenderer.renderToDataURL)\n\n// only svg for now.\nexports.toString = renderCanvas.bind(null, function (data, _, opts) {\n  return SvgRenderer.render(data, opts)\n})\n","import QRCode from 'qrcode'\r\n\r\nasync function loadImage(src: string): Promise<HTMLImageElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image()\r\n    img.onload = () => resolve(img)\r\n    img.onerror = (e) => reject(e)\r\n    img.src = src\r\n  })\r\n}\r\n\r\nexport type QrLogoOptions = {\r\n  logoUrl: string\r\n  // Fraction of the QR's min(width,height) for the logo box. 0.18–0.24 is typical.\r\n  logoScale?: number\r\n  // Add a white rounded mask under the logo to preserve scan contrast\r\n  mask?: boolean\r\n  // Outline color for the mask box\r\n  maskStroke?: string\r\n  // Corner radius for mask box\r\n  radiusPx?: number\r\n  // Shape of the logo area: 'circle' | 'rounded-rect' | 'rect'\r\n  shape?: 'circle' | 'rounded-rect' | 'rect'\r\n}\r\n\r\nexport async function composeQrWithLogo(qrDataUrl: string, opts: QrLogoOptions): Promise<string> {\r\n  const [qrImg, logoImg] = await Promise.all([\r\n    loadImage(qrDataUrl),\r\n    loadImage(opts.logoUrl),\r\n  ])\r\n  const w = Math.max(160, qrImg.width || 160)\r\n  const h = Math.max(160, qrImg.height || 160)\r\n  const canvas = document.createElement('canvas')\r\n  canvas.width = w\r\n  canvas.height = h\r\n  const ctx = canvas.getContext('2d')!\r\n  ctx.fillStyle = '#ffffff'\r\n  ctx.fillRect(0, 0, w, h)\r\n  // Draw QR without smoothing to keep it crisp\r\n  ctx.imageSmoothingEnabled = false\r\n  ctx.drawImage(qrImg, 0, 0, w, h)\r\n\r\n  const cx = w / 2\r\n  const cy = h / 2\r\n  const scale = Math.max(0.14, Math.min(0.28, opts.logoScale ?? 0.2))\r\n  const logoSize = Math.round(Math.min(w, h) * scale)\r\n  const x = Math.round(cx - logoSize / 2)\r\n  const y = Math.round(cy - logoSize / 2)\r\n\r\n  if (opts.mask !== false) {\r\n    const shape = opts.shape || 'rounded-rect'\r\n    const pad = Math.max(2, Math.round(logoSize * 0.08))\r\n    const bx = x - pad\r\n    const by = y - pad\r\n    const bw = logoSize + pad * 2\r\n    const bh = logoSize + pad * 2\r\n    ctx.beginPath()\r\n    if (shape === 'circle') {\r\n      const r = Math.min(bw, bh) / 2\r\n      ctx.arc(bx + bw/2, by + bh/2, r, 0, Math.PI * 2)\r\n    } else if (shape === 'rect') {\r\n      ctx.rect(bx, by, bw, bh)\r\n    } else {\r\n      const radius = Math.max(4, opts.radiusPx ?? Math.round(logoSize * 0.12))\r\n      const r = Math.min(radius, bw/2, bh/2)\r\n      ctx.moveTo(bx + r, by)\r\n      ctx.arcTo(bx + bw, by, bx + bw, by + bh, r)\r\n      ctx.arcTo(bx + bw, by + bh, bx, by + bh, r)\r\n      ctx.arcTo(bx, by + bh, bx, by, r)\r\n      ctx.arcTo(bx, by, bx + bw, by, r)\r\n      ctx.closePath()\r\n    }\r\n    // Fill white mask\r\n    ctx.fillStyle = '#ffffff'\r\n    ctx.fill()\r\n    // Optional subtle stroke to separate from modules\r\n    ctx.lineWidth = 1\r\n    ctx.strokeStyle = opts.maskStroke || 'rgba(0,0,0,0.12)'\r\n    ctx.stroke()\r\n  }\r\n\r\n  // Draw the logo centered (clip to shape if circle desired)\r\n  ctx.save()\r\n  if (opts.shape === 'circle') {\r\n    const r = logoSize / 2\r\n    ctx.beginPath()\r\n    ctx.arc(x + r, y + r, r, 0, Math.PI * 2)\r\n    ctx.clip()\r\n  }\r\n  ctx.imageSmoothingEnabled = true\r\n  ctx.drawImage(logoImg, x, y, logoSize, logoSize)\r\n  ctx.restore()\r\n  return canvas.toDataURL('image/png')\r\n}\r\n\r\nexport type MakeQrOptions = {\r\n  width?: number\r\n  margin?: number\r\n  errorCorrectionLevel?: 'L'|'M'|'Q'|'H'\r\n  color?: { dark?: string; light?: string }\r\n  logo?: QrLogoOptions | false\r\n}\r\n\r\nexport async function makeQrDataUrlWithLogo(text: string, options: MakeQrOptions): Promise<string> {\r\n  const { width = 256, margin = 2, errorCorrectionLevel = 'H', color = { dark: '#000000', light: '#ffffff' }, logo } = options || {}\r\n  const base = await QRCode.toDataURL(text, { width, margin, errorCorrectionLevel, color })\r\n  if (!logo) return base\r\n  return composeQrWithLogo(base, logo)\r\n}\r\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...a) => api.dispatch(...a), ...initial };\n};\nconst redux = reduxImpl;\n\nconst trackedConnections = /* @__PURE__ */ new Map();\nconst getTrackedConnectionState = (name) => {\n  const api = trackedConnections.get(name);\n  if (!api) return {};\n  return Object.fromEntries(\n    Object.entries(api.stores).map(([key, api2]) => [key, api2.getState()])\n  );\n};\nconst extractConnectionInformation = (store, extensionConnector, options) => {\n  if (store === void 0) {\n    return {\n      type: \"untracked\",\n      connection: extensionConnector.connect(options)\n    };\n  }\n  const existingConnection = trackedConnections.get(options.name);\n  if (existingConnection) {\n    return { type: \"tracked\", store, ...existingConnection };\n  }\n  const newConnection = {\n    connection: extensionConnector.connect(options),\n    stores: {}\n  };\n  trackedConnections.set(options.name, newConnection);\n  return { type: \"tracked\", store, ...newConnection };\n};\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, store, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch (_e) {\n  }\n  if (!extensionConnector) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && enabled) {\n      console.warn(\n        \"[zustand devtools middleware] Please install/enable Redux devtools extension\"\n      );\n    }\n    return fn(set, get, api);\n  }\n  const { connection, ...connectionInformation } = extractConnectionInformation(store, extensionConnector, options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording) return r;\n    const action = nameOrAction === void 0 ? { type: anonymousActionType || \"anonymous\" } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction;\n    if (store === void 0) {\n      connection == null ? void 0 : connection.send(action, get());\n      return r;\n    }\n    connection == null ? void 0 : connection.send(\n      {\n        ...action,\n        type: `${store}/${action.type}`\n      },\n      {\n        ...getTrackedConnectionState(options.name),\n        [store]: api.getState()\n      }\n    );\n    return r;\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  if (connectionInformation.type === \"untracked\") {\n    connection == null ? void 0 : connection.init(initialState);\n  } else {\n    connectionInformation.stores[connectionInformation.store] = api;\n    connection == null ? void 0 : connection.init(\n      Object.fromEntries(\n        Object.entries(connectionInformation.stores).map(([key, store2]) => [\n          key,\n          key === connectionInformation.store ? initialState : store2.getState()\n        ])\n      )\n    );\n  }\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...a) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && a[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...a);\n    };\n  }\n  connection.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              if (store === void 0) {\n                setStateFromDevtools(action.state);\n                return;\n              }\n              if (Object.keys(action.state).length !== 1) {\n                console.error(\n                  `\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { \"type\": \"__setState\", \"state\": { \"abc123Store\": { \"foo\": \"bar\" } } }\n                    `\n                );\n              }\n              const stateFromDevtools = action.state[store];\n              if (stateFromDevtools === void 0 || stateFromDevtools === null) {\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(stateFromDevtools)) {\n                setStateFromDevtools(stateFromDevtools);\n              }\n              return;\n            }\n            if (!api.dispatchFromDevtools) return;\n            if (typeof api.dispatch !== \"function\") return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            if (store === void 0) {\n              return connection == null ? void 0 : connection.init(api.getState());\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"COMMIT\":\n            if (store === void 0) {\n              connection == null ? void 0 : connection.init(api.getState());\n              return;\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                connection == null ? void 0 : connection.init(api.getState());\n                return;\n              }\n              setStateFromDevtools(state[store]);\n              connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(state[store])) {\n                setStateFromDevtools(state[store]);\n              }\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState) return;\n            if (store === void 0) {\n              setStateFromDevtools(lastComputedState);\n            } else {\n              setStateFromDevtools(lastComputedState[store]);\n            }\n            connection == null ? void 0 : connection.send(\n              null,\n              // FIXME no-any\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, f) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0) f(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nconst combine = (initialState, create) => (...a) => Object.assign({}, initialState, create(...a));\n\nfunction createJSONStorage(getStorage, options) {\n  let storage;\n  try {\n    storage = getStorage();\n  } catch (_e) {\n    return;\n  }\n  const persistStorage = {\n    getItem: (name) => {\n      var _a;\n      const parse = (str2) => {\n        if (str2 === null) {\n          return null;\n        }\n        return JSON.parse(str2, options == null ? void 0 : options.reviver);\n      };\n      const str = (_a = storage.getItem(name)) != null ? _a : null;\n      if (str instanceof Promise) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (name, newValue) => storage.setItem(\n      name,\n      JSON.stringify(newValue, options == null ? void 0 : options.replacer)\n    ),\n    removeItem: (name) => storage.removeItem(name)\n  };\n  return persistStorage;\n}\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst oldImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    getStorage: () => localStorage,\n    serialize: JSON.stringify,\n    deserialize: JSON.parse,\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage;\n  try {\n    storage = options.getStorage();\n  } catch (_e) {\n  }\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const thenableSerialize = toThenable(options.serialize);\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    let errorInSync;\n    const thenable = thenableSerialize({ state, version: options.version }).then(\n      (serializedValue) => storage.setItem(options.name, serializedValue)\n    ).catch((e) => {\n      errorInSync = e;\n    });\n    if (errorInSync) {\n      throw errorInSync;\n    }\n    return thenable;\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => cb(get()));\n    const postRehydrationCallback = ((_a = options.onRehydrateStorage) == null ? void 0 : _a.call(options, get())) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((storageValue) => {\n      if (storageValue) {\n        return options.deserialize(storageValue);\n      }\n    }).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return deserializedStorageValue.state;\n        }\n      }\n    }).then((migratedState) => {\n      var _a2;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      return setItem();\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.getStorage) {\n        storage = newOptions.getStorage();\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  hydrate();\n  return stateFromStorage || configResult;\n};\nconst newImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    storage: createJSONStorage(() => localStorage),\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage = options.storage;\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    return storage.setItem(options.name, {\n      state,\n      version: options.version\n    });\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  api.getInitialState = () => configResult;\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a, _b;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => {\n      var _a2;\n      return cb((_a2 = get()) != null ? _a2 : configResult);\n    });\n    const postRehydrationCallback = ((_b = options.onRehydrateStorage) == null ? void 0 : _b.call(options, (_a = get()) != null ? _a : configResult)) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return [\n              true,\n              options.migrate(\n                deserializedStorageValue.state,\n                deserializedStorageValue.version\n              )\n            ];\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return [false, deserializedStorageValue.state];\n        }\n      }\n      return [false, void 0];\n    }).then((migrationResult) => {\n      var _a2;\n      const [migrated, migratedState] = migrationResult;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      if (migrated) {\n        return setItem();\n      }\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      stateFromStorage = get();\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.storage) {\n        storage = newOptions.storage;\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  if (!options.skipHydration) {\n    hydrate();\n  }\n  return stateFromStorage || configResult;\n};\nconst persistImpl = (config, baseOptions) => {\n  if (\"getStorage\" in baseOptions || \"serialize\" in baseOptions || \"deserialize\" in baseOptions) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead.\"\n      );\n    }\n    return oldImpl(config, baseOptions);\n  }\n  return newImpl(config, baseOptions);\n};\nconst persist = persistImpl;\n\nexport { combine, createJSONStorage, devtools, persist, redux, subscribeWithSelector };\n","import { create } from 'zustand'\r\nimport { persist, createJSONStorage } from 'zustand/middleware'\r\nimport type { Homography, Point } from '../utils/vision'\r\n\r\ntype CalibrationState = {\r\n  H: Homography | null // board->image\r\n  createdAt: number | null\r\n  errorPx: number | null\r\n  imageSize: { w: number; h: number } | null\r\n  anchors: { src: Point[]; dst: Point[] } | null\r\n  locked: boolean\r\n  _hydrated: boolean // Track hydration state\r\n  setCalibration: (c: Partial<Omit<CalibrationState, 'setCalibration' | 'reset' | '_hydrated'>>) => void\r\n  reset: () => void\r\n}\r\n\r\nexport const useCalibration = create<CalibrationState>()(persist((set, get) => ({\r\n  H: null,\r\n  createdAt: null,\r\n  errorPx: null,\r\n  imageSize: null,\r\n  anchors: null,\r\n  locked: false,\r\n  _hydrated: false,\r\n  setCalibration: (c) => set((s) => ({ ...s, ...c })),\r\n  reset: () => set({ H: null, createdAt: null, errorPx: null, imageSize: null, anchors: null, locked: false }),\r\n}), {\r\n  name: 'ndn-calibration-v1',\r\n  storage: createJSONStorage(() => localStorage),\r\n  // If we ever had alternate keys (legacy), gently import once after hydration\r\n  onRehydrateStorage: () => (state, error) => {\r\n    // No-op on error; best-effort fallback\r\n    if (error || !state) return\r\n    try {\r\n      if (state && !state.H) {\r\n        const legacy = localStorage.getItem('ndn:calibration:v1')\r\n        if (legacy) {\r\n          const j = JSON.parse(legacy)\r\n          if (j && (j.H || j.imageSize)) {\r\n            state.setCalibration({\r\n              H: j.H ?? null,\r\n              createdAt: j.createdAt ?? null,\r\n              errorPx: j.errorPx ?? null,\r\n              imageSize: j.imageSize ?? null,\r\n              anchors: j.anchors ?? null,\r\n              locked: !!j.locked,\r\n            })\r\n          }\r\n        }\r\n      }\r\n      // Mark as hydrated\r\n      state._hydrated = true\r\n    } catch {}\r\n  },\r\n}))\r\n","import { create } from 'zustand'\r\nimport { persist, createJSONStorage } from 'zustand/middleware'\r\n\r\nexport type CameraStreamMode = 'local' | 'phone' | 'wifi'\r\n\r\n// CRITICAL: All non-serializable objects kept OUTSIDE state to avoid React #185 error\r\n// These must NOT be in Zustand state, even though we set them there momentarily\r\nlet videoElementRefHolder: HTMLVideoElement | null = null\r\nlet mediaStreamRefHolder: MediaStream | null = null\r\nlet pcRefHolder: RTCPeerConnection | null = null\r\nlet wsRefHolder: WebSocket | null = null\r\n\r\ntype CameraSessionState = {\r\n  // Stream state - persists across navigation (ONLY serializable data)\r\n  isStreaming: boolean\r\n  mode: CameraStreamMode\r\n  pairingCode: string | null\r\n  expiresAt: number | null\r\n  isPaired: boolean\r\n  mobileUrl: string | null\r\n  // UI: whether the floating phone overlay is visible\r\n  showOverlay: boolean\r\n  \r\n  // Actions\r\n  setStreaming: (streaming: boolean) => void\r\n  setMode: (mode: CameraStreamMode) => void\r\n  setPairingCode: (code: string | null) => void\r\n  setExpiresAt: (time: number | null) => void\r\n  setPaired: (paired: boolean) => void\r\n  setMobileUrl: (url: string | null) => void\r\n  setShowOverlay: (v: boolean) => void\r\n  \r\n  // Methods for managing non-serializable refs (not in state)\r\n  setMediaStream: (stream: MediaStream | null) => void\r\n  getMediaStream: () => MediaStream | null\r\n  setPcRef: (pc: RTCPeerConnection | null) => void\r\n  getPcRef: () => RTCPeerConnection | null\r\n  setWsRef: (ws: WebSocket | null) => void\r\n  getWsRef: () => WebSocket | null\r\n  \r\n  // Get video element ref (not stored in state to avoid serialization)\r\n  getVideoElementRef: () => HTMLVideoElement | null\r\n  setVideoElementRef: (ref: HTMLVideoElement | null) => void\r\n  \r\n  // Clear session when user stops camera\r\n  clearSession: () => void\r\n}\r\n\r\nexport const useCameraSession = create<CameraSessionState>()(persist((set, get) => ({\r\n  isStreaming: false,\r\n  mode: 'local',\r\n  pairingCode: null,\r\n  expiresAt: null,\r\n  isPaired: false,\r\n  mobileUrl: null,\r\n  showOverlay: true,\r\n  \r\n  setStreaming: (streaming) => {\r\n    console.log('[CAMERA_SESSION] setStreaming:', streaming)\r\n    set({ isStreaming: streaming })\r\n  },\r\n  setMode: (mode) => {\r\n    console.log('[CAMERA_SESSION] setMode:', mode)\r\n    set({ mode })\r\n  },\r\n  setPairingCode: (code) => set({ pairingCode: code }),\r\n  setExpiresAt: (time) => set({ expiresAt: time }),\r\n  setPaired: (paired) => set({ isPaired: paired }),\r\n  setMobileUrl: (url) => set({ mobileUrl: url }),\r\n  setShowOverlay: (v) => set({ showOverlay: !!v }),\r\n  \r\n  // Non-serializable refs stored outside state\r\n  setMediaStream: (stream) => {\r\n    mediaStreamRefHolder = stream\r\n  },\r\n  getMediaStream: () => mediaStreamRefHolder,\r\n  \r\n  setPcRef: (pc) => {\r\n    pcRefHolder = pc\r\n  },\r\n  getPcRef: () => pcRefHolder,\r\n  \r\n  setWsRef: (ws) => {\r\n    wsRefHolder = ws\r\n  },\r\n  getWsRef: () => wsRefHolder,\r\n  \r\n  // Keep video element ref outside of state to avoid serialization issues\r\n  getVideoElementRef: () => {\r\n    const ref = videoElementRefHolder\r\n    if (!ref) {\r\n      console.warn('[cameraSession] ⚠️ getVideoElementRef called but ref is NULL')\r\n    }\r\n    return ref\r\n  },\r\n  setVideoElementRef: (ref) => {\r\n    if (ref) {\r\n      console.log('[cameraSession] ✅ setVideoElementRef called - storing HTMLVideoElement', {\r\n        tagName: ref.tagName,\r\n        hasStream: !!ref.srcObject,\r\n      })\r\n    } else {\r\n      console.log('[cameraSession] 🛑 setVideoElementRef called - clearing ref')\r\n    }\r\n    videoElementRefHolder = ref\r\n  },\r\n  \r\n  clearSession: () => {\r\n    videoElementRefHolder = null\r\n    mediaStreamRefHolder = null\r\n    pcRefHolder = null\r\n    wsRefHolder = null\r\n    set({\r\n      isStreaming: false,\r\n      pairingCode: null,\r\n      expiresAt: null,\r\n      isPaired: false,\r\n      mobileUrl: null,\r\n      // Keep overlay state; do not forcibly hide on clear so user choice persists\r\n    })\r\n  },\r\n}), {\r\n  name: 'ndn-camera-session',\r\n  storage: createJSONStorage(() => localStorage),\r\n  // ONLY persist serializable primitives\r\n  partialize: (state) => ({\r\n    isStreaming: state.isStreaming,\r\n    mode: state.mode,\r\n    pairingCode: state.pairingCode,\r\n    expiresAt: state.expiresAt,\r\n    isPaired: state.isPaired,\r\n    mobileUrl: state.mobileUrl,\r\n    showOverlay: state.showOverlay,\r\n  }),\r\n}))\r\n","// Vision and calibration utilities for dartboard mapping\r\n// Standard dartboard: 18 inches (457.2 mm) outer diameter\r\n// Board dimensions follow standard measurements (millimeters)\r\n// - Inner bull radius: 6.35 mm (12.7 mm diameter)\r\n// - Outer bull radius: 15.9 mm (31.8 mm diameter)\r\n// - Treble inner radius: 99 mm\r\n// - Treble outer radius: 107 mm\r\n// - Double inner radius: 162 mm\r\n// - Double outer radius: 170 mm (playing field outer edge = 340 mm diameter)\r\n\r\nexport type Point = { x: number; y: number }\r\nexport type Homography = [number, number, number, number, number, number, number, number, number] // row-major 3x3\r\n\r\nexport const BoardRadii = {\r\n\tbullInner: 6.35,\r\n\tbullOuter: 15.9,\r\n\ttrebleInner: 99,\r\n\ttrebleOuter: 107,\r\n\tdoubleInner: 162,\r\n\tdoubleOuter: 170,\r\n}\r\n\r\nexport const SectorOrder = [20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5]\r\n\r\n// Basic 3x3 matrix operations\r\nfunction matMul3(a: Homography, b: Homography): Homography {\r\n\tconst r = new Array(9).fill(0)\r\n\tfor (let i = 0; i < 3; i++) {\r\n\t\tfor (let j = 0; j < 3; j++) {\r\n\t\t\tfor (let k = 0; k < 3; k++) {\r\n\t\t\t\tr[i * 3 + j] += a[i * 3 + k] * b[k * 3 + j]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn r as Homography\r\n}\r\n\r\nexport function applyHomography(H: Homography, p: Point): Point {\r\n\tconst x = p.x, y = p.y\r\n\tconst w = H[6] * x + H[7] * y + H[8]\r\n\tconst nx = (H[0] * x + H[1] * y + H[2]) / w\r\n\tconst ny = (H[3] * x + H[4] * y + H[5]) / w\r\n\treturn { x: nx, y: ny }\r\n}\r\n\r\n// Scale a homography by sx, sy on the destination/image side: H' = S * H\r\n// Where S = diag([sx, sy, 1])\r\nexport function scaleHomography(H: Homography, sx: number, sy: number): Homography {\r\n\treturn [\r\n\t\tsx * H[0], sx * H[1], sx * H[2],\r\n\t\tsy * H[3], sy * H[4], sy * H[5],\r\n\t\tH[6],     H[7],     H[8],\r\n\t] as Homography\r\n}\r\n\r\nexport function invertHomography(H: Homography): Homography {\r\n\t// Inverse of 3x3 matrix\r\n\tconst m = H\r\n\tconst a = m[0], b = m[1], c = m[2], d = m[3], e = m[4], f = m[5], g = m[6], h = m[7], i = m[8]\r\n\tconst A = e * i - f * h\r\n\tconst B = c * h - b * i\r\n\tconst C = b * f - c * e\r\n\tconst D = f * g - d * i\r\n\tconst E = a * i - c * g\r\n\tconst F = c * d - a * f\r\n\tconst G = d * h - e * g\r\n\tconst Hh = b * g - a * h\r\n\tconst I = a * e - b * d\r\n\tconst det = a * A + b * D + c * G\r\n\tif (Math.abs(det) < 1e-12) throw new Error('Singular homography')\r\n\tconst inv = [\r\n\t\tA / det, B / det, C / det,\r\n\t\tD / det, E / det, F / det,\r\n\t\tG / det, Hh / det, I / det,\r\n\t] as Homography\r\n\treturn inv\r\n}\r\n\r\n// Compute homography H that maps src (board space) -> dst (image space)\r\n// Using N correspondences via DLT (solved by Gaussian elimination) with least-squares fit\r\n// Supports overdetermined systems (N > 4) for improved accuracy\r\nexport function computeHomographyDLT(src: Point[], dst: Point[]): Homography {\r\n\tif (src.length < 4 || dst.length < 4) throw new Error('Need at least 4 correspondences')\r\n\tif (src.length !== dst.length) throw new Error('Correspondences must have equal length')\r\n\t// Build A * h = b where h = [h11 h12 h13 h21 h22 h23 h31 h32]^T and h33 = 1\r\n\tconst A: number[][] = []\r\n\tconst B: number[] = []\r\n\tfor (let k = 0; k < src.length; k++) {\r\n\t\tconst { x: X, y: Y } = src[k]\r\n\t\tconst { x: x, y: y } = dst[k]\r\n\t\t// x = (h11 X + h12 Y + h13) / (h31 X + h32 Y + 1)\r\n\t\t// y = (h21 X + h22 Y + h23) / (h31 X + h32 Y + 1)\r\n\t\t// => x*(h31 X + h32 Y + 1) = h11 X + h12 Y + h13\r\n\t\t// => y*(h31 X + h32 Y + 1) = h21 X + h22 Y + h23\r\n\t\tA.push([X, Y, 1, 0, 0, 0, -x * X, -x * Y])\r\n\t\tB.push(x)\r\n\t\tA.push([0, 0, 0, X, Y, 1, -y * X, -y * Y])\r\n\t\tB.push(y)\r\n\t}\r\n\tconst h = solveLeastSquares(A, B) // length 8\r\n\tconst H: Homography = [h[0], h[1], h[2], h[3], h[4], h[5], h[6], h[7], 1]\r\n\treturn H\r\n}\r\n\r\n// Solve A x = b in least squares sense using Gaussian elimination with partial pivoting\r\nfunction solveLeastSquares(A: number[][], b: number[]): number[] {\r\n\t// Normal equations: (A^T A) x = A^T b\r\n\tconst m = A.length, n = A[0].length\r\n\tconst AtA: number[][] = Array.from({ length: n }, () => new Array(n).fill(0))\r\n\tconst Atb: number[] = new Array(n).fill(0)\r\n\tfor (let r = 0; r < m; r++) {\r\n\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\tAtb[i] += A[r][i] * b[r]\r\n\t\t\tfor (let j = 0; j < n; j++) {\r\n\t\t\t\tAtA[i][j] += A[r][i] * A[r][j]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn gaussianSolve(AtA, Atb)\r\n}\r\n\r\nfunction gaussianSolve(M: number[][], v: number[]): number[] {\r\n\tconst n = v.length\r\n\t// Augment matrix\r\n\tconst A = M.map((row, i) => row.concat([v[i]]))\r\n\tfor (let i = 0; i < n; i++) {\r\n\t\t// Pivot\r\n\t\tlet maxRow = i\r\n\t\tfor (let r = i + 1; r < n; r++) {\r\n\t\t\tif (Math.abs(A[r][i]) > Math.abs(A[maxRow][i])) maxRow = r\r\n\t\t}\r\n\t\tif (Math.abs(A[maxRow][i]) < 1e-12) throw new Error('Singular matrix')\r\n\t\tif (maxRow !== i) {\r\n\t\t\tconst tmp = A[i]; A[i] = A[maxRow]; A[maxRow] = tmp\r\n\t\t}\r\n\t\t// Eliminate\r\n\t\tfor (let r = i + 1; r < n; r++) {\r\n\t\t\tconst f = A[r][i] / A[i][i]\r\n\t\t\tfor (let c = i; c <= n; c++) A[r][c] -= f * A[i][c]\r\n\t\t}\r\n\t}\r\n\t// Back substitution\r\n\tconst x = new Array(n).fill(0)\r\n\tfor (let i = n - 1; i >= 0; i--) {\r\n\t\tlet s = A[i][n]\r\n\t\tfor (let c = i + 1; c < n; c++) s -= A[i][c] * x[c]\r\n\t\tx[i] = s / A[i][i]\r\n\t}\r\n\treturn x\r\n}\r\n\r\n// Canonical calibration targets in board space (mm)\r\n// We ask the user to click the image positions for: \r\n// 1. TOP, RIGHT, BOTTOM, LEFT of double outer rim (4 points for rim constraint)\r\n// Canonical calibration points in board space (mm)\r\n// 5-point system: TOP, RIGHT, BOTTOM, LEFT of double ring outer edge + CENTER bull\r\n// This matches the actual image points clicked/detected as cardinal directions\r\nexport function canonicalRimTargets(): Point[] {\r\n\tconst doubleR = BoardRadii.doubleOuter\r\n\treturn [\r\n\t\t{ x: 0, y: -doubleR },        // TOP of double ring\r\n\t\t{ x: doubleR, y: 0 },         // RIGHT of double ring\r\n\t\t{ x: 0, y: doubleR },         // BOTTOM of double ring\r\n\t\t{ x: -doubleR, y: 0 },        // LEFT of double ring\r\n\t\t{ x: 0, y: 0 },               // CENTER (bullseye)\r\n\t]\r\n}\r\n\r\n// Given a homography mapping board->image, produce polylines for overlay rings (in image px)\r\nexport function sampleRing(H: Homography, radius: number, steps = 256): Point[] {\r\n\tconst pts: Point[] = []\r\n\tfor (let k = 0; k < steps; k++) {\r\n\t\tconst theta = (k / steps) * Math.PI * 2\r\n\t\tconst p = applyHomography(H, { x: radius * Math.cos(theta), y: radius * Math.sin(theta) })\r\n\t\tpts.push(p)\r\n\t}\r\n\treturn pts\r\n}\r\n\r\nexport function rmsError(H: Homography, src: Point[], dst: Point[]): number {\r\n\tlet e2 = 0\r\n\tfor (let i = 0; i < src.length; i++) {\r\n\t\tconst p = applyHomography(H, src[i])\r\n\t\tconst dx = p.x - dst[i].x\r\n\t\tconst dy = p.y - dst[i].y\r\n\t\te2 += dx * dx + dy * dy\r\n\t}\r\n\treturn Math.sqrt(e2 / src.length)\r\n}\r\n\r\n// Map an image point to board coordinates using inverse homography (image->board)\r\nexport function imageToBoard(H_boardToImage: Homography, pImg: Point): Point {\r\n\tconst inv = invertHomography(H_boardToImage)\r\n\treturn applyHomography(inv as Homography, pImg)\r\n}\r\n\r\n// Compute score for a board coordinate (mm)\r\nexport function scoreAtBoardPoint(p: Point): { base: number; ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'; sector: number | null; mult: 0|1|2|3 } {\r\n\tconst r = Math.hypot(p.x, p.y)\r\n\tconst ang = Math.atan2(p.y, p.x) // 0 rad at +X, increasing CCW\r\n\t// Rotate so that sector 20 is at the top (negative Y). Top corresponds to -90 degrees (or 270)\r\n\tlet deg = ang * 180 / Math.PI\r\n\tdeg = (deg + 360 + 90) % 360 // shift so 0 deg is at top\r\n\tconst sector = SectorOrder[Math.floor(((360 - deg) % 360) / 18)] // clockwise ordering\r\n\r\n\tif (r <= BoardRadii.bullInner) return { base: 50, ring: 'INNER_BULL', sector: 25, mult: 2 }\r\n\tif (r <= BoardRadii.bullOuter) return { base: 25, ring: 'BULL', sector: 25, mult: 1 }\r\n\tif (r >= BoardRadii.doubleOuter) return { base: 0, ring: 'MISS', sector: null, mult: 0 }\r\n\tif (r >= BoardRadii.doubleInner) return { base: sector * 2, ring: 'DOUBLE', sector, mult: 2 }\r\n\tif (r >= BoardRadii.trebleOuter) return { base: sector, ring: 'SINGLE', sector, mult: 1 }\r\n\tif (r >= BoardRadii.trebleInner) return { base: sector * 3, ring: 'TRIPLE', sector, mult: 3 }\r\n\treturn { base: sector, ring: 'SINGLE', sector, mult: 1 }\r\n}\r\n\r\nexport function drawPolyline(ctx: CanvasRenderingContext2D, pts: Point[], color = '#10b981', width = 2) {\r\n\tif (!pts.length) return\r\n\tctx.save()\r\n\tctx.strokeStyle = color\r\n\tctx.lineWidth = width\r\n\tctx.beginPath()\r\n\tctx.moveTo(pts[0].x, pts[0].y)\r\n\tfor (let i = 1; i < pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y)\r\n\tctx.closePath()\r\n\tctx.stroke()\r\n\tctx.restore()\r\n}\r\n\r\nexport function drawCross(ctx: CanvasRenderingContext2D, p: Point, color = '#f59e0b') {\r\n\tctx.save()\r\n\tctx.strokeStyle = color\r\n\tctx.lineWidth = 2\r\n\tctx.beginPath()\r\n\tctx.moveTo(p.x - 8, p.y)\r\n\tctx.lineTo(p.x + 8, p.y)\r\n\tctx.moveTo(p.x, p.y - 8)\r\n\tctx.lineTo(p.x, p.y + 8)\r\n\tctx.stroke()\r\n\tctx.restore()\r\n}\r\n\r\n// --- Point refinement using Sobel gradient ---\r\nfunction clamp(v: number, lo: number, hi: number) { return Math.max(lo, Math.min(hi, v)) }\r\n\r\nfunction sobelAtGray(img: ImageData, x: number, y: number): number {\r\n\tconst { width, data } = img\r\n\t// Sobel kernels\r\n\tconst gx = [[-1,0,1],[-2,0,2],[-1,0,1]]\r\n\tconst gy = [[-1,-2,-1],[0,0,0],[1,2,1]]\r\n\tlet sx = 0, sy = 0\r\n\tfor (let j = -1; j <= 1; j++) {\r\n\t\tfor (let i = -1; i <= 1; i++) {\r\n\t\t\tconst xi = clamp(x + i, 0, width - 1)\r\n\t\t\tconst yi = clamp(y + j, 0, img.height - 1)\r\n\t\t\tconst idx = (yi * width + xi) * 4\r\n\t\t\tconst r = data[idx], g = data[idx+1], b = data[idx+2]\r\n\t\t\tconst gray = 0.299*r + 0.587*g + 0.114*b\r\n\t\t\tsx += gray * gx[j+1][i+1]\r\n\t\t\tsy += gray * gy[j+1][i+1]\r\n\t\t}\r\n\t}\r\n\treturn Math.hypot(sx, sy)\r\n}\r\n\r\nexport function refinePointSobel(canvas: HTMLCanvasElement, p: Point, radius = 6): Point {\r\n\tconst ctx = canvas.getContext('2d')!\r\n\tconst img = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n\tconst cx = clamp(Math.round(p.x), 1, canvas.width - 2)\r\n\tconst cy = clamp(Math.round(p.y), 1, canvas.height - 2)\r\n\tlet best = { x: cx, y: cy, mag: -1 }\r\n\tfor (let y = cy - radius; y <= cy + radius; y++) {\r\n\t\tfor (let x = cx - radius; x <= cx + radius; x++) {\r\n\t\t\tif (x <= 0 || y <= 0 || x >= canvas.width-1 || y >= canvas.height-1) continue\r\n\t\t\tconst mag = sobelAtGray(img, x, y)\r\n\t\t\tif (mag > best.mag) best = { x, y, mag }\r\n\t\t}\r\n\t}\r\n\treturn { x: best.x, y: best.y }\r\n}\r\n\r\nexport function refinePointsSobel(canvas: HTMLCanvasElement, pts: Point[], radius = 6): Point[] {\r\n\treturn pts.map(p => refinePointSobel(canvas, p, radius))\r\n}\r\n\r\n","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"OpenCV: Open Computer Vision Library\"\n  http://sourceforge.net/projects/opencvlibrary/\n- \"Stack Blur: Fast But Goodlooking\"\n  http://incubator.quasimondo.com/processing/fast_blur_deluxe.php\n*/\n\nvar CV = CV || {};\n\nCV.Image = function(width, height, data){\n  this.width = width || 0;\n  this.height = height || 0;\n  this.data = data || [];\n};\n\nCV.grayscale = function(imageSrc, imageDst){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length,\n      i = 0, j = 0;\n\n  for (; i < len; i += 4){\n    dst[j ++] =\n      (src[i] * 0.299 + src[i + 1] * 0.587 + src[i + 2] * 0.114 + 0.5) & 0xff;\n  }\n  \n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.threshold = function(imageSrc, imageDst, threshold){\n  var src = imageSrc.data, dst = imageDst.data,\n      len = src.length, tab = [], i;\n\n  for (i = 0; i < 256; ++ i){\n    tab[i] = i <= threshold? 0: 255;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n\n  return imageDst;\n};\n\nCV.adaptiveThreshold = function(imageSrc, imageDst, kernelSize, threshold){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length, tab = [], i;\n\n  CV.stackBoxBlur(imageSrc, imageDst, kernelSize);\n\n  for (i = 0; i < 768; ++ i){\n    tab[i] = (i - 255 <= -threshold)? 255: 0;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] - dst[i] + 255 ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.otsu = function(imageSrc){\n  var src = imageSrc.data, len = src.length, hist = [],\n      threshold = 0, sum = 0, sumB = 0, wB = 0, wF = 0, max = 0,\n      mu, between, i;\n\n  for (i = 0; i < 256; ++ i){\n    hist[i] = 0;\n  }\n  \n  for (i = 0; i < len; ++ i){\n    hist[ src[i] ] ++;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    sum += hist[i] * i;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    wB += hist[i];\n    if (0 !== wB){\n    \n      wF = len - wB;\n      if (0 === wF){\n        break;\n      }\n\n      sumB += hist[i] * i;\n      \n      mu = (sumB / wB) - ( (sum - sumB) / wF );\n\n      between = wB * wF * mu * mu;\n      \n      if (between > max){\n        max = between;\n        threshold = i;\n      }\n    }\n  }\n\n  return threshold;\n};\n\nCV.stackBoxBlurMult =\n  [1, 171, 205, 293, 57, 373, 79, 137, 241, 27, 391, 357, 41, 19, 283, 265];\n\nCV.stackBoxBlurShift =\n  [0, 9, 10, 11, 9, 12, 10, 11, 12, 9, 13, 13, 10, 9, 13, 13];\n\nCV.BlurStack = function(){\n  this.color = 0;\n  this.next = null;\n};\n\nCV.stackBoxBlur = function(imageSrc, imageDst, kernelSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      heightMinus1 = height - 1, widthMinus1 = width - 1,\n      size = kernelSize + kernelSize + 1, radius = kernelSize + 1,\n      mult = CV.stackBoxBlurMult[kernelSize],\n      shift = CV.stackBoxBlurShift[kernelSize],\n      stack, stackStart, color, sum, pos, start, p, x, y, i;\n\n  stack = stackStart = new CV.BlurStack();\n  for (i = 1; i < size; ++ i){\n    stack = stack.next = new CV.BlurStack();\n  }\n  stack.next = stackStart;\n\n  pos = 0;\n\n  for (y = 0; y < height; ++ y){\n    start = pos;\n    \n    color = src[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = src[pos + i];\n      sum += stack.color;\n      stack = stack.next;\n    }\n  \n    stack = stackStart;\n    for (x = 0; x < width; ++ x){\n      dst[pos ++] = (sum * mult) >>> shift;\n      \n      p = x + radius;\n      p = start + (p < widthMinus1? p: widthMinus1);\n      sum -= stack.color - src[p];\n      \n      stack.color = src[p];\n      stack = stack.next;\n    }\n  }\n\n  for (x = 0; x < width; ++ x){\n    pos = x;\n    start = pos + width;\n    \n    color = dst[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = dst[start];\n      sum += stack.color;\n      stack = stack.next;\n      \n      start += width;\n    }\n    \n    stack = stackStart;\n    for (y = 0; y < height; ++ y){\n      dst[pos] = (sum * mult) >>> shift;\n      \n      p = y + radius;\n      p = x + ( (p < heightMinus1? p: heightMinus1) * width );\n      sum -= stack.color - dst[p];\n      \n      stack.color = dst[p];\n      stack = stack.next;\n      \n      pos += width;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianBlur = function(imageSrc, imageDst, imageMean, kernelSize){\n  var kernel = CV.gaussianKernel(kernelSize);\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  imageMean.width = imageSrc.width;\n  imageMean.height = imageSrc.height;\n\n  CV.gaussianBlurFilter(imageSrc, imageMean, kernel, true);\n  CV.gaussianBlurFilter(imageMean, imageDst, kernel, false);\n\n  return imageDst;\n};\n\nCV.gaussianBlurFilter = function(imageSrc, imageDst, kernel, horizontal){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      pos = 0, limit = kernel.length >> 1,\n      cur, value, i, j, k;\n      \n  for (i = 0; i < height; ++ i){\n    \n    for (j = 0; j < width; ++ j){\n      value = 0.0;\n    \n      for (k = -limit; k <= limit; ++ k){\n\n        if (horizontal){\n          cur = pos + k;\n          if (j + k < 0){\n            cur = pos;\n          }\n          else if (j + k >= width){\n            cur = pos;\n          }\n        }else{\n          cur = pos + (k * width);\n          if (i + k < 0){\n            cur = pos;\n          }\n          else if (i + k >= height){\n            cur = pos;\n          }\n        }\n\n        value += kernel[limit + k] * src[cur];\n      }\n    \n      dst[pos ++] = horizontal? value: (value + 0.5) & 0xff;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianKernel = function(kernelSize){\n  var tab =\n    [ [1],\n      [0.25, 0.5, 0.25],\n      [0.0625, 0.25, 0.375, 0.25, 0.0625],\n      [0.03125, 0.109375, 0.21875, 0.28125, 0.21875, 0.109375, 0.03125] ],\n    kernel = [], center, sigma, scale2X, sum, x, i;\n\n  if ( (kernelSize <= 7) && (kernelSize % 2 === 1) ){\n    kernel = tab[kernelSize >> 1];\n  }else{\n    center = (kernelSize - 1.0) * 0.5;\n    sigma = 0.8 + (0.3 * (center - 1.0) );\n    scale2X = -0.5 / (sigma * sigma);\n    sum = 0.0;\n    for (i = 0; i < kernelSize; ++ i){\n      x = i - center;\n      sum += kernel[i] = Math.exp(scale2X * x * x);\n    }\n    sum = 1 / sum;\n    for (i = 0; i < kernelSize; ++ i){\n      kernel[i] *= sum;\n    }  \n  }\n\n  return kernel;\n};\n\nCV.findContours = function(imageSrc, binary){\n  var width = imageSrc.width, height = imageSrc.height, contours = [],\n      src, deltas, pos, pix, nbd, outer, hole, i, j;\n  \n  src = CV.binaryBorder(imageSrc, binary);\n\n  deltas = CV.neighborhoodDeltas(width + 2);\n\n  pos = width + 3;\n  nbd = 1;\n\n  for (i = 0; i < height; ++ i, pos += 2){\n  \n    for (j = 0; j < width; ++ j, ++ pos){\n      pix = src[pos];\n\n      if (0 !== pix){\n        outer = hole = false;\n\n        if (1 === pix && 0 === src[pos - 1]){\n          outer = true;\n        }\n        else if (pix >= 1 && 0 === src[pos + 1]){\n          hole = true;\n        }\n\n        if (outer || hole){\n          ++ nbd;\n          \n          contours.push( CV.borderFollowing(src, pos, nbd, {x: j, y: i}, hole, deltas) );\n        }\n      }\n    }\n  }  \n\n  return contours;\n};\n\nCV.borderFollowing = function(src, pos, nbd, point, hole, deltas){\n  var contour = [], pos1, pos3, pos4, s, s_end, s_prev;\n\n  contour.hole = hole;\n      \n  s = s_end = hole? 0: 4;\n  do{\n    s = (s - 1) & 7;\n    pos1 = pos + deltas[s];\n    if (src[pos1] !== 0){\n      break;\n    }\n  }while(s !== s_end);\n  \n  if (s === s_end){\n    src[pos] = -nbd;\n    contour.push( {x: point.x, y: point.y} );\n\n  }else{\n    pos3 = pos;\n    s_prev = s ^ 4;\n\n    while(true){\n      s_end = s;\n    \n      do{\n        pos4 = pos3 + deltas[++ s];\n      }while(src[pos4] === 0);\n      \n      s &= 7;\n      \n      if ( ( (s - 1) >>> 0) < (s_end >>> 0) ){\n        src[pos3] = -nbd;\n      }\n      else if (src[pos3] === 1){\n        src[pos3] = nbd;\n      }\n\n      contour.push( {x: point.x, y: point.y} );\n      \n      s_prev = s;\n\n      point.x += CV.neighborhood[s][0];\n      point.y += CV.neighborhood[s][1];\n\n      if ( (pos4 === pos) && (pos3 === pos1) ){\n        break;\n      }\n      \n      pos3 = pos4;\n      s = (s + 4) & 7;\n    }\n  }\n\n  return contour;\n};\n\nCV.neighborhood = \n  [ [1, 0], [1, -1], [0, -1], [-1, -1], [-1, 0], [-1, 1], [0, 1], [1, 1] ];\n\nCV.neighborhoodDeltas = function(width){\n  var deltas = [], len = CV.neighborhood.length, i = 0;\n  \n  for (; i < len; ++ i){\n    deltas[i] = CV.neighborhood[i][0] + (CV.neighborhood[i][1] * width);\n  }\n  \n  return deltas.concat(deltas);\n};\n\nCV.approxPolyDP = function(contour, epsilon){\n  var slice = {start_index: 0, end_index: 0},\n      right_slice = {start_index: 0, end_index: 0},\n      poly = [], stack = [], len = contour.length,\n      pt, start_pt, end_pt, dist, max_dist, le_eps,\n      dx, dy, i, j, k;\n  \n  epsilon *= epsilon;\n  \n  k = 0;\n  \n  for (i = 0; i < 3; ++ i){\n    max_dist = 0;\n    \n    k = (k + right_slice.start_index) % len;\n    start_pt = contour[k];\n    if (++ k === len) {k = 0;}\n  \n    for (j = 1; j < len; ++ j){\n      pt = contour[k];\n      if (++ k === len) {k = 0;}\n    \n      dx = pt.x - start_pt.x;\n      dy = pt.y - start_pt.y;\n      dist = dx * dx + dy * dy;\n\n      if (dist > max_dist){\n        max_dist = dist;\n        right_slice.start_index = j;\n      }\n    }\n  }\n\n  if (max_dist <= epsilon){\n    poly.push( {x: start_pt.x, y: start_pt.y} );\n\n  }else{\n    slice.start_index = k;\n    slice.end_index = (right_slice.start_index += slice.start_index);\n  \n    right_slice.start_index -= right_slice.start_index >= len? len: 0;\n    right_slice.end_index = slice.start_index;\n    if (right_slice.end_index < right_slice.start_index){\n      right_slice.end_index += len;\n    }\n    \n    stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n    stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n  }\n\n  while(stack.length !== 0){\n    slice = stack.pop();\n    \n    end_pt = contour[slice.end_index % len];\n    start_pt = contour[k = slice.start_index % len];\n    if (++ k === len) {k = 0;}\n    \n    if (slice.end_index <= slice.start_index + 1){\n      le_eps = true;\n    \n    }else{\n      max_dist = 0;\n\n      dx = end_pt.x - start_pt.x;\n      dy = end_pt.y - start_pt.y;\n      \n      for (i = slice.start_index + 1; i < slice.end_index; ++ i){\n        pt = contour[k];\n        if (++ k === len) {k = 0;}\n        \n        dist = Math.abs( (pt.y - start_pt.y) * dx - (pt.x - start_pt.x) * dy);\n\n        if (dist > max_dist){\n          max_dist = dist;\n          right_slice.start_index = i;\n        }\n      }\n      \n      le_eps = max_dist * max_dist <= epsilon * (dx * dx + dy * dy);\n    }\n    \n    if (le_eps){\n      poly.push( {x: start_pt.x, y: start_pt.y} );\n\n    }else{\n      right_slice.end_index = slice.end_index;\n      slice.end_index = right_slice.start_index;\n\n      stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n      stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n    }\n  }\n  \n  return poly;\n};\n\nCV.warp = function(imageSrc, imageDst, contour, warpSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      width = imageSrc.width, height = imageSrc.height,\n      pos = 0,\n      sx1, sx2, dx1, dx2, sy1, sy2, dy1, dy2, p1, p2, p3, p4,\n      m, r, s, t, u, v, w, x, y, i, j;\n  \n  m = CV.getPerspectiveTransform(contour, warpSize - 1);\n\n  r = m[8];\n  s = m[2];\n  t = m[5];\n  \n  for (i = 0; i < warpSize; ++ i){\n    r += m[7];\n    s += m[1];\n    t += m[4];\n\n    u = r;\n    v = s;\n    w = t;\n    \n    for (j = 0; j < warpSize; ++ j){\n      u += m[6];\n      v += m[0];\n      w += m[3];\n\n      x = v / u;\n      y = w / u;\n\n      sx1 = x >>> 0;\n      sx2 = (sx1 === width - 1)? sx1: sx1 + 1;\n      dx1 = x - sx1;\n      dx2 = 1.0 - dx1;\n\n      sy1 = y >>> 0;\n      sy2 = (sy1 === height - 1)? sy1: sy1 + 1;\n      dy1 = y - sy1;\n      dy2 = 1.0 - dy1;\n\n      p1 = p2 = sy1 * width;\n      p3 = p4 = sy2 * width;\n\n      dst[pos ++] = \n        (dy2 * (dx2 * src[p1 + sx1] + dx1 * src[p2 + sx2]) +\n         dy1 * (dx2 * src[p3 + sx1] + dx1 * src[p4 + sx2]) ) & 0xff;\n\n    }\n  }\n\n  imageDst.width = warpSize;\n  imageDst.height = warpSize;\n\n  return imageDst;\n};\n\nCV.getPerspectiveTransform = function(src, size){\n  var rq = CV.square2quad(src);\n  \n  rq[0] /= size;\n  rq[1] /= size;\n  rq[3] /= size;\n  rq[4] /= size;\n  rq[6] /= size;\n  rq[7] /= size;\n  \n  return rq;\n};\n\nCV.square2quad = function(src){\n  var sq = [], px, py, dx1, dx2, dy1, dy2, den;\n  \n  px = src[0].x - src[1].x + src[2].x - src[3].x;\n  py = src[0].y - src[1].y + src[2].y - src[3].y;\n  \n  if (0 === px && 0 === py){\n    sq[0] = src[1].x - src[0].x;\n    sq[1] = src[2].x - src[1].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y;\n    sq[4] = src[2].y - src[1].y;\n    sq[5] = src[0].y;\n    sq[6] = 0;\n    sq[7] = 0;\n    sq[8] = 1;\n\n  }else{\n    dx1 = src[1].x - src[2].x;\n    dx2 = src[3].x - src[2].x;\n    dy1 = src[1].y - src[2].y;\n    dy2 = src[3].y - src[2].y;\n    den = dx1 * dy2 - dx2 * dy1;\n  \n    sq[6] = (px * dy2 - dx2 * py) / den;\n    sq[7] = (dx1 * py - px * dy1) / den;\n    sq[8] = 1;\n    sq[0] = src[1].x - src[0].x + sq[6] * src[1].x;\n    sq[1] = src[3].x - src[0].x + sq[7] * src[3].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y + sq[6] * src[1].y;\n    sq[4] = src[3].y - src[0].y + sq[7] * src[3].y;\n    sq[5] = src[0].y;\n  }\n\n  return sq;\n};\n\nCV.isContourConvex = function(contour){\n  var orientation = 0, convex = true,\n      len = contour.length, i = 0, j = 0,\n      cur_pt, prev_pt, dxdy0, dydx0, dx0, dy0, dx, dy;\n\n  prev_pt = contour[len - 1];\n  cur_pt = contour[0];\n\n  dx0 = cur_pt.x - prev_pt.x;\n  dy0 = cur_pt.y - prev_pt.y;\n\n  for (; i < len; ++ i){\n    if (++ j === len) {j = 0;}\n\n    prev_pt = cur_pt;\n    cur_pt = contour[j];\n\n    dx = cur_pt.x - prev_pt.x;\n    dy = cur_pt.y - prev_pt.y;\n    dxdy0 = dx * dy0;\n    dydx0 = dy * dx0;\n\n    orientation |= dydx0 > dxdy0? 1: (dydx0 < dxdy0? 2: 3);\n\n    if (3 === orientation){\n        convex = false;\n        break;\n    }\n\n    dx0 = dx;\n    dy0 = dy;\n  }\n\n  return convex;\n};\n\nCV.perimeter = function(poly){\n  var len = poly.length, i = 0, j = len - 1,\n      p = 0.0, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n    \n    p += Math.sqrt(dx * dx + dy * dy) ;\n  }\n\n  return p;\n};\n\nCV.minEdgeLength = function(poly){\n  var len = poly.length, i = 0, j = len - 1, \n      min = Infinity, d, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n\n    d = dx * dx + dy * dy;\n\n    if (d < min){\n      min = d;\n    }\n  }\n  \n  return Math.sqrt(min);\n};\n\nCV.countNonZero = function(imageSrc, square){\n  var src = imageSrc.data, height = square.height, width = square.width,\n      pos = square.x + (square.y * imageSrc.width),\n      span = imageSrc.width - width,\n      nz = 0, i, j;\n  \n  for (i = 0; i < height; ++ i){\n\n    for (j = 0; j < width; ++ j){\n    \n      if ( 0 !== src[pos ++] ){\n        ++ nz;\n      }\n    }\n    \n    pos += span;\n  }\n\n  return nz;\n};\n\nCV.binaryBorder = function(imageSrc, dst){\n  var src = imageSrc.data, height = imageSrc.height, width = imageSrc.width,\n      posSrc = 0, posDst = 0, i, j;\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n\n  for (i = 0; i < height; ++ i){\n    dst[posDst ++] = 0;\n    \n    for (j = 0; j < width; ++ j){\n      dst[posDst ++] = (0 === src[posSrc ++]? 0: 1);\n    }\n    \n    dst[posDst ++] = 0;\n  }\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n  \n  return dst;\n};\n\nmodule.exports = CV;","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"ArUco: a minimal library for Augmented Reality applications based on OpenCv\"\n  http://www.uco.es/investiga/grupos/ava/node/26\n*/\n\nvar CV = require('./cv');\n\nvar AR = AR || {};\n\nAR.Marker = function(id, corners){\n  this.id = id;\n  this.corners = corners;\n};\n\nAR.Detector = function(){\n  this.grey = new CV.Image();\n  this.thres = new CV.Image();\n  this.homography = new CV.Image();\n  this.binary = [];\n  this.contours = [];\n  this.polys = [];\n  this.candidates = [];\n};\n\nAR.Detector.prototype.detect = function(image){\n  CV.grayscale(image, this.grey);\n  CV.adaptiveThreshold(this.grey, this.thres, 2, 7);\n  \n  this.contours = CV.findContours(this.thres, this.binary);\n\n  this.candidates = this.findCandidates(this.contours, image.width * 0.20, 0.05, 10);\n  this.candidates = this.clockwiseCorners(this.candidates);\n  this.candidates = this.notTooNear(this.candidates, 10);\n\n  return this.findMarkers(this.grey, this.candidates, 49);\n};\n\nAR.Detector.prototype.findCandidates = function(contours, minSize, epsilon, minLength){\n  var candidates = [], len = contours.length, contour, poly, i;\n\n  this.polys = [];\n  \n  for (i = 0; i < len; ++ i){\n    contour = contours[i];\n\n    if (contour.length >= minSize){\n      poly = CV.approxPolyDP(contour, contour.length * epsilon);\n\n      this.polys.push(poly);\n\n      if ( (4 === poly.length) && ( CV.isContourConvex(poly) ) ){\n\n        if ( CV.minEdgeLength(poly) >= minLength){\n          candidates.push(poly);\n        }\n      }\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.clockwiseCorners = function(candidates){\n  var len = candidates.length, dx1, dx2, dy1, dy2, swap, i;\n\n  for (i = 0; i < len; ++ i){\n    dx1 = candidates[i][1].x - candidates[i][0].x;\n    dy1 = candidates[i][1].y - candidates[i][0].y;\n    dx2 = candidates[i][2].x - candidates[i][0].x;\n    dy2 = candidates[i][2].y - candidates[i][0].y;\n\n    if ( (dx1 * dy2 - dy1 * dx2) < 0){\n      swap = candidates[i][1];\n      candidates[i][1] = candidates[i][3];\n      candidates[i][3] = swap;\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.notTooNear = function(candidates, minDist){\n  var notTooNear = [], len = candidates.length, dist, dx, dy, i, j, k;\n\n  for (i = 0; i < len; ++ i){\n  \n    for (j = i + 1; j < len; ++ j){\n      dist = 0;\n      \n      for (k = 0; k < 4; ++ k){\n        dx = candidates[i][k].x - candidates[j][k].x;\n        dy = candidates[i][k].y - candidates[j][k].y;\n      \n        dist += dx * dx + dy * dy;\n      }\n      \n      if ( (dist / 4) < (minDist * minDist) ){\n      \n        if ( CV.perimeter( candidates[i] ) < CV.perimeter( candidates[j] ) ){\n          candidates[i].tooNear = true;\n        }else{\n          candidates[j].tooNear = true;\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < len; ++ i){\n    if ( !candidates[i].tooNear ){\n      notTooNear.push( candidates[i] );\n    }\n  }\n\n  return notTooNear;\n};\n\nAR.Detector.prototype.findMarkers = function(imageSrc, candidates, warpSize){\n  var markers = [], len = candidates.length, candidate, marker, i;\n\n  for (i = 0; i < len; ++ i){\n    candidate = candidates[i];\n\n    CV.warp(imageSrc, this.homography, candidate, warpSize);\n  \n    CV.threshold(this.homography, this.homography, CV.otsu(this.homography) );\n\n    marker = this.getMarker(this.homography, candidate);\n    if (marker){\n      markers.push(marker);\n    }\n  }\n  \n  return markers;\n};\n\nAR.Detector.prototype.getMarker = function(imageSrc, candidate){\n  var width = (imageSrc.width / 7) >>> 0,\n      minZero = (width * width) >> 1,\n      bits = [], rotations = [], distances = [],\n      square, pair, inc, i, j;\n\n  for (i = 0; i < 7; ++ i){\n    inc = (0 === i || 6 === i)? 1: 6;\n    \n    for (j = 0; j < 7; j += inc){\n      square = {x: j * width, y: i * width, width: width, height: width};\n      if ( CV.countNonZero(imageSrc, square) > minZero){\n        return null;\n      }\n    }\n  }\n\n  for (i = 0; i < 5; ++ i){\n    bits[i] = [];\n\n    for (j = 0; j < 5; ++ j){\n      square = {x: (j + 1) * width, y: (i + 1) * width, width: width, height: width};\n      \n      bits[i][j] = CV.countNonZero(imageSrc, square) > minZero? 1: 0;\n    }\n  }\n\n  rotations[0] = bits;\n  distances[0] = this.hammingDistance( rotations[0] );\n  \n  pair = {first: distances[0], second: 0};\n  \n  for (i = 1; i < 4; ++ i){\n    rotations[i] = this.rotate( rotations[i - 1] );\n    distances[i] = this.hammingDistance( rotations[i] );\n    \n    if (distances[i] < pair.first){\n      pair.first = distances[i];\n      pair.second = i;\n    }\n  }\n\n  if (0 !== pair.first){\n    return null;\n  }\n\n  return new AR.Marker(\n    this.mat2id( rotations[pair.second] ), \n    this.rotate2(candidate, 4 - pair.second) );\n};\n\nAR.Detector.prototype.hammingDistance = function(bits){\n  var ids = [ [1,0,0,0,0], [1,0,1,1,1], [0,1,0,0,1], [0,1,1,1,0] ],\n      dist = 0, sum, minSum, i, j, k;\n\n  for (i = 0; i < 5; ++ i){\n    minSum = Infinity;\n    \n    for (j = 0; j < 4; ++ j){\n      sum = 0;\n\n      for (k = 0; k < 5; ++ k){\n          sum += bits[i][k] === ids[j][k]? 0: 1;\n      }\n\n      if (sum < minSum){\n        minSum = sum;\n      }\n    }\n\n    dist += minSum;\n  }\n\n  return dist;\n};\n\nAR.Detector.prototype.mat2id = function(bits){\n  var id = 0, i;\n  \n  for (i = 0; i < 5; ++ i){\n    id <<= 1;\n    id |= bits[i][1];\n    id <<= 1;\n    id |= bits[i][3];\n  }\n\n  return id;\n};\n\nAR.Detector.prototype.rotate = function(src){\n  var dst = [], len = src.length, i, j;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = [];\n    for (j = 0; j < src[i].length; ++ j){\n      dst[i][j] = src[src[i].length - j - 1][i];\n    }\n  }\n\n  return dst;\n};\n\nAR.Detector.prototype.rotate2 = function(src, rotation){\n  var dst = [], len = src.length, i;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = src[ (rotation + i) % len ];\n  }\n\n  return dst;\n};\n\nmodule.exports = AR;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"Numerical Recipes in C - Second Edition\"\r\n  http://www.nr.com/\r\n*/\r\n\r\nvar SVD = SVD || {};\r\n\r\nSVD.svdcmp = function(a, m, n, w, v){\r\n  var flag, i, its, j, jj, k, l, nm,\r\n      anorm = 0.0, c, f, g = 0.0, h, s, scale = 0.0, x, y, z, rv1 = [];\r\n      \r\n  //Householder reduction to bidiagonal form\r\n  for (i = 0; i < n; ++ i){\r\n    l = i + 1;\r\n    rv1[i] = scale * g;\r\n    g = s = scale = 0.0;\r\n    if (i < m){\r\n      for (k = i; k < m; ++ k){\r\n        scale += Math.abs( a[k][i] );\r\n      }\r\n      if (0.0 !== scale){\r\n        for (k = i; k < m; ++ k){\r\n          a[k][i] /= scale;\r\n          s += a[k][i] * a[k][i];\r\n        }\r\n        f = a[i][i];\r\n        g = -SVD.sign( Math.sqrt(s), f );\r\n        h = f * g - s;\r\n        a[i][i] = f - g;\r\n        for (j = l; j < n; ++ j){\r\n          for (s = 0.0, k = i; k < m; ++ k){\r\n            s += a[k][i] * a[k][j];\r\n          }\r\n          f = s / h;\r\n          for (k = i; k < m; ++ k){\r\n            a[k][j] += f * a[k][i];\r\n          }\r\n        }\r\n        for (k = i; k < m; ++ k){\r\n          a[k][i] *= scale;\r\n        }\r\n      }\r\n    }\r\n    w[i] = scale * g;\r\n    g = s = scale = 0.0;\r\n    if ( (i < m) && (i !== n - 1) ){\r\n      for (k = l; k < n; ++ k){\r\n        scale += Math.abs( a[i][k] );\r\n      }\r\n      if (0.0 !== scale){\r\n        for (k = l; k < n; ++ k){\r\n          a[i][k] /= scale;\r\n          s += a[i][k] * a[i][k];\r\n        }\r\n        f = a[i][l];\r\n        g = -SVD.sign( Math.sqrt(s), f );\r\n        h = f * g - s;\r\n        a[i][l] = f - g;\r\n        for (k = l; k < n; ++ k){\r\n          rv1[k] = a[i][k] / h;\r\n        }\r\n        for (j = l; j < m; ++ j){\r\n          for (s = 0.0, k = l; k < n; ++ k){\r\n            s += a[j][k] * a[i][k];\r\n          }\r\n          for (k = l; k < n; ++ k){\r\n            a[j][k] += s * rv1[k];\r\n          }\r\n        }\r\n        for (k = l; k < n; ++ k){\r\n          a[i][k] *= scale;\r\n        }\r\n      }\r\n    }\r\n    anorm = Math.max(anorm, ( Math.abs( w[i] ) + Math.abs( rv1[i] ) ) );\r\n  }\r\n\r\n  //Acumulation of right-hand transformation\r\n  for (i = n - 1; i >= 0; -- i){\r\n    if (i < n - 1){\r\n      if (0.0 !== g){\r\n        for (j = l; j < n; ++ j){\r\n          v[j][i] = ( a[i][j] / a[i][l] ) / g;\r\n        }\r\n        for (j = l; j < n; ++ j){\r\n          for (s = 0.0, k = l; k < n; ++ k){\r\n            s += a[i][k] * v[k][j];\r\n          }\r\n          for (k = l; k < n; ++ k){\r\n            v[k][j] += s * v[k][i];\r\n          }\r\n        }\r\n      }\r\n      for (j = l; j < n; ++ j){\r\n        v[i][j] = v[j][i] = 0.0;\r\n      }\r\n    }\r\n    v[i][i] = 1.0;\r\n    g = rv1[i];\r\n    l = i;\r\n  }\r\n\r\n  //Acumulation of left-hand transformation\r\n  for (i = Math.min(n, m) - 1; i >= 0; -- i){\r\n    l = i + 1;\r\n    g = w[i];\r\n    for (j = l; j < n; ++ j){\r\n      a[i][j] = 0.0;\r\n    }\r\n    if (0.0 !== g){\r\n      g = 1.0 / g;\r\n      for (j = l; j < n; ++ j){\r\n        for (s = 0.0, k = l; k < m; ++ k){\r\n          s += a[k][i] * a[k][j];\r\n        }\r\n        f = (s / a[i][i]) * g;\r\n        for (k = i; k < m; ++ k){\r\n          a[k][j] += f * a[k][i];\r\n        }\r\n      }\r\n      for (j = i; j < m; ++ j){\r\n        a[j][i] *= g;\r\n      }\r\n    }else{\r\n        for (j = i; j < m; ++ j){\r\n          a[j][i] = 0.0;\r\n        }\r\n    }\r\n    ++ a[i][i];\r\n  }\r\n\r\n  //Diagonalization of the bidiagonal form\r\n  for (k = n - 1; k >= 0; -- k){\r\n    for (its = 1; its <= 30; ++ its){\r\n      flag = true;\r\n      for (l = k; l >= 0; -- l){\r\n        nm = l - 1;\r\n        if ( Math.abs( rv1[l] ) + anorm === anorm ){\r\n          flag = false;\r\n          break;\r\n        }\r\n        if ( Math.abs( w[nm] ) + anorm === anorm ){\r\n          break;\r\n        }\r\n      }\r\n      if (flag){\r\n        c = 0.0;\r\n        s = 1.0;\r\n        for (i = l; i <= k; ++ i){\r\n          f = s * rv1[i];\r\n          if ( Math.abs(f) + anorm === anorm ){\r\n            break;\r\n          }\r\n          g = w[i];\r\n          h = SVD.pythag(f, g);\r\n          w[i] = h;\r\n          h = 1.0 / h;\r\n          c = g * h;\r\n          s = -f * h;\r\n          for (j = 1; j <= m; ++ j){\r\n            y = a[j][nm];\r\n            z = a[j][i];\r\n            a[j][nm] = y * c + z * s;\r\n            a[j][i] = z * c - y * s;\r\n          }\r\n        }\r\n      }\r\n\r\n      //Convergence\r\n      z = w[k];\r\n      if (l === k){\r\n        if (z < 0.0){\r\n          w[k] = -z;\r\n          for (j = 0; j < n; ++ j){\r\n            v[j][k] = -v[j][k];\r\n          }\r\n        }\r\n        break;\r\n      }\r\n\r\n      if (30 === its){\r\n        return false;\r\n      }\r\n\r\n      //Shift from bottom 2-by-2 minor\r\n      x = w[l];\r\n      nm = k - 1;\r\n      y = w[nm];\r\n      g = rv1[nm];\r\n      h = rv1[k];\r\n      f = ( (y - z) * (y + z) + (g - h) * (g + h) ) / (2.0 * h * y);\r\n      g = SVD.pythag( f, 1.0 );\r\n      f = ( (x - z) * (x + z) + h * ( (y / (f + SVD.sign(g, f) ) ) - h) ) / x;\r\n\r\n      //Next QR transformation\r\n      c = s = 1.0;\r\n      for (j = l; j <= nm; ++ j){\r\n        i = j + 1;\r\n        g = rv1[i];\r\n        y = w[i];\r\n        h = s * g;\r\n        g = c * g;\r\n        z = SVD.pythag(f, h);\r\n        rv1[j] = z;\r\n        c = f / z;\r\n        s = h / z;\r\n        f = x * c + g * s;\r\n        g = g * c - x * s;\r\n        h = y * s;\r\n        y *= c;\r\n        for (jj = 0; jj < n; ++ jj){\r\n          x = v[jj][j];\r\n          z = v[jj][i];\r\n          v[jj][j] = x * c + z * s;\r\n          v[jj][i] = z * c - x * s;\r\n        }\r\n        z = SVD.pythag(f, h);\r\n        w[j] = z;\r\n        if (0.0 !== z){\r\n          z = 1.0 / z;\r\n          c = f * z;\r\n          s = h * z;\r\n        }\r\n        f = c * g + s * y;\r\n        x = c * y - s * g;\r\n        for (jj = 0; jj < m; ++ jj){\r\n          y = a[jj][j];\r\n          z = a[jj][i];\r\n          a[jj][j] = y * c + z * s;\r\n          a[jj][i] = z * c - y * s;\r\n        }\r\n      }\r\n      rv1[l] = 0.0;\r\n      rv1[k] = f;\r\n      w[k] = x;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nSVD.pythag = function(a, b){\r\n  var at = Math.abs(a), bt = Math.abs(b), ct;\r\n\r\n  if (at > bt){\r\n    ct = bt / at;\r\n    return at * Math.sqrt(1.0 + ct * ct);\r\n  }\r\n    \r\n  if (0.0 === bt){\r\n    return 0.0;\r\n  }\r\n\r\n  ct = at / bt;\r\n  return bt * Math.sqrt(1.0 + ct * ct);\r\n};\r\n\r\nSVD.sign = function(a, b){\r\n  return b >= 0.0? Math.abs(a): -Math.abs(a);\r\n};\r\n\r\nmodule.exports = SVD;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"Iterative Pose Estimation using Coplanar Feature Points\"\r\n  Denis Oberkampf, Daniel F. DeMenthon, Larry S. Davis\r\n  http://www.cfar.umd.edu/~daniel/daniel_papersfordownload/CoplanarPts.pdf\r\n*/\r\n\r\nvar SVD = require('./svd');\r\n\r\nvar POS = POS || {};\r\n\r\nPOS.Posit = function(modelSize, focalLength){\r\n  this.objectPoints = this.buildModel(modelSize);\r\n  this.focalLength = focalLength;\r\n\r\n  this.objectVectors = [];\r\n  this.objectNormal = [];\r\n  this.objectMatrix = [[],[],[]];\r\n  \r\n  this.init();\r\n};\r\n\r\nPOS.Posit.prototype.buildModel = function(modelSize){\r\n  var half = modelSize / 2.0;\r\n  \r\n  return [\r\n    [-half,  half, 0.0],\r\n    [ half,  half, 0.0],\r\n    [ half, -half, 0.0],\r\n    [-half, -half, 0.0] ];\r\n};\r\n\r\nPOS.Posit.prototype.init = function(){\r\n  var np = this.objectPoints.length,\r\n      vectors = [], n = [], len = 0.0, row = 2, i;\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    this.objectVectors[i] = [this.objectPoints[i][0] - this.objectPoints[0][0],\r\n                             this.objectPoints[i][1] - this.objectPoints[0][1],\r\n                             this.objectPoints[i][2] - this.objectPoints[0][2]];\r\n                             \r\n    vectors[i] = [this.objectVectors[i][0],\r\n                  this.objectVectors[i][1],\r\n                  this.objectVectors[i][2]];\r\n  }\r\n\r\n  while(0.0 === len){\r\n    n[0] = this.objectVectors[1][1] * this.objectVectors[row][2] -\r\n           this.objectVectors[1][2] * this.objectVectors[row][1];\r\n    n[1] = this.objectVectors[1][2] * this.objectVectors[row][0] -\r\n           this.objectVectors[1][0] * this.objectVectors[row][2];\r\n    n[2] = this.objectVectors[1][0] * this.objectVectors[row][1] -\r\n           this.objectVectors[1][1] * this.objectVectors[row][0];\r\n    \r\n    len = Math.sqrt(n[0] * n[0] + n[1] * n[1] + n[2] * n[2]);\r\n    \r\n    ++ row;\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    this.objectNormal[i] = n[i] / len;\r\n  }\r\n\r\n  POS.pseudoInverse(vectors, np, this.objectMatrix);\r\n};\r\n\r\nPOS.Posit.prototype.pose = function(imagePoints){\r\n  var posRotation1 = [[],[],[]], posRotation2 = [[],[],[]], posTranslation = [],\r\n      rotation1 = [[],[],[]], rotation2 = [[],[],[]], translation1 = [], translation2 = [],\r\n      error1, error2, valid1, valid2, i, j;\r\n\r\n  this.pos(imagePoints, posRotation1, posRotation2, posTranslation);\r\n\r\n  valid1 = this.isValid(posRotation1, posTranslation);\r\n  if (valid1){\r\n    error1 = this.iterate(imagePoints, posRotation1, posTranslation, rotation1, translation1);\r\n  }else{\r\n    error1 = {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n  \r\n  valid2 = this.isValid(posRotation2, posTranslation);\r\n  if (valid2){\r\n    error2 = this.iterate(imagePoints, posRotation2, posTranslation, rotation2, translation2);\r\n  }else{\r\n    error2 = {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      if (valid1){\r\n        translation1[i] -= rotation1[i][j] * this.objectPoints[0][j];\r\n      }\r\n      if (valid2){\r\n        translation2[i] -= rotation2[i][j] * this.objectPoints[0][j];\r\n      }\r\n    }\r\n  }\r\n\r\n  return error1.euclidean < error2.euclidean?\r\n    new POS.Pose(error1.pixels, rotation1, translation1, error2.pixels, rotation2, translation2):\r\n    new POS.Pose(error2.pixels, rotation2, translation2, error1.pixels, rotation1, translation1);\r\n};\r\n\r\nPOS.Posit.prototype.pos = function(imagePoints, rotation1, rotation2, translation){\r\n  var np = this.objectPoints.length, imageVectors = [],\r\n      i0 = [], j0 = [], ivec = [], jvec = [], row1 = [], row2 = [], row3 = [],\r\n      i0i0, j0j0, i0j0, delta, q, lambda, mu, scale, i, j;\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    imageVectors[i] = [imagePoints[i].x - imagePoints[0].x,\r\n                       imagePoints[i].y - imagePoints[0].y];\r\n  }\r\n\r\n  //i0 and j0\r\n  for (i = 0; i < 3; ++ i){\r\n    i0[i] = 0.0;\r\n    j0[i] = 0.0;\r\n    for (j = 0; j < np; ++ j){\r\n      i0[i] += this.objectMatrix[i][j] * imageVectors[j][0];\r\n      j0[i] += this.objectMatrix[i][j] * imageVectors[j][1];\r\n    }\r\n  }\r\n\r\n  i0i0 = i0[0] * i0[0] + i0[1] * i0[1] + i0[2] * i0[2];\r\n  j0j0 = j0[0] * j0[0] + j0[1] * j0[1] + j0[2] * j0[2];\r\n  i0j0 = i0[0] * j0[0] + i0[1] * j0[1] + i0[2] * j0[2];\r\n\r\n  //Lambda and mu\r\n  delta = (j0j0 - i0i0) * (j0j0 - i0i0) + 4.0 * (i0j0 * i0j0);\r\n  \r\n  if (j0j0 - i0i0 >= 0.0){\r\n    q = (j0j0 - i0i0 + Math.sqrt(delta) ) / 2.0;\r\n  }else{\r\n    q = (j0j0 - i0i0 - Math.sqrt(delta) ) / 2.0;\r\n  }\r\n  \r\n  if (q >= 0.0){\r\n    lambda = Math.sqrt(q);\r\n    if (0.0 === lambda){\r\n      mu = 0.0;\r\n    }else{\r\n      mu = -i0j0 / lambda;\r\n    }\r\n  }else{\r\n    lambda = Math.sqrt( -(i0j0 * i0j0) / q);\r\n    if (0.0 === lambda){\r\n      mu = Math.sqrt(i0i0 - j0j0);\r\n    }else{\r\n      mu = -i0j0 / lambda;\r\n    }\r\n  }\r\n\r\n  //First rotation\r\n  for (i = 0; i < 3; ++ i){\r\n    ivec[i] = i0[i] + lambda * this.objectNormal[i];\r\n    jvec[i] = j0[i] + mu * this.objectNormal[i];\r\n  }\r\n  \r\n  scale = Math.sqrt(ivec[0] * ivec[0] + ivec[1] * ivec[1] + ivec[2] * ivec[2]);\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    row1[i] = ivec[i] / scale;\r\n    row2[i] = jvec[i] / scale;\r\n  }\r\n  \r\n  row3[0] = row1[1] * row2[2] - row1[2] * row2[1];\r\n  row3[1] = row1[2] * row2[0] - row1[0] * row2[2];\r\n  row3[2] = row1[0] * row2[1] - row1[1] * row2[0];\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    rotation1[0][i] = row1[i];\r\n    rotation1[1][i] = row2[i];\r\n    rotation1[2][i] = row3[i];\r\n  }\r\n\r\n  //Second rotation\r\n  for (i = 0; i < 3; ++ i){\r\n    ivec[i] = i0[i] - lambda * this.objectNormal[i];\r\n    jvec[i] = j0[i] - mu * this.objectNormal[i];\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    row1[i] = ivec[i] / scale;\r\n    row2[i] = jvec[i] / scale;\r\n  }\r\n  \r\n  row3[0] = row1[1] * row2[2] - row1[2] * row2[1];\r\n  row3[1] = row1[2] * row2[0] - row1[0] * row2[2];\r\n  row3[2] = row1[0] * row2[1] - row1[1] * row2[0];\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    rotation2[0][i] = row1[i];\r\n    rotation2[1][i] = row2[i];\r\n    rotation2[2][i] = row3[i];\r\n  }\r\n\r\n  //Translation\r\n  translation[0] = imagePoints[0].x / scale;\r\n  translation[1] = imagePoints[0].y / scale;\r\n  translation[2] = this.focalLength / scale;\r\n};\r\n\r\nPOS.Posit.prototype.isValid = function(rotation, translation){\r\n  var np = this.objectPoints.length, zmin = Infinity, i = 0, zi;\r\n\r\n  for (; i < np; ++ i){\r\n    zi = translation[2] +\r\n      (rotation[2][0] * this.objectVectors[i][0] +\r\n       rotation[2][1] * this.objectVectors[i][1] +\r\n       rotation[2][2] * this.objectVectors[i][2]);\r\n    if (zi < zmin){\r\n      zmin = zi;\r\n    }\r\n  }\r\n\r\n  return zmin >= 0.0;\r\n};\r\n\r\nPOS.Posit.prototype.iterate = function(imagePoints, posRotation, posTranslation, rotation, translation){\r\n  var np = this.objectPoints.length,\r\n      oldSopImagePoints = [], sopImagePoints = [],\r\n      rotation1 = [[],[],[]], rotation2 = [[],[],[]],\r\n      translation1 = [], translation2 = [],\r\n      converged = false, iteration = 0,\r\n      oldImageDifference, imageDifference, factor,\r\n      error, error1, error2, delta, i, j;\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    oldSopImagePoints[i] = {x: imagePoints[i].x,\r\n                            y: imagePoints[i].y};\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      rotation[i][j] = posRotation[i][j];\r\n    }\r\n    translation[i] = posTranslation[i];\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    factor = 0.0;\r\n    for (j = 0; j < 3; ++ j){\r\n      factor += this.objectVectors[i][j] * rotation[2][j] / translation[2];\r\n    }\r\n    sopImagePoints[i] = {x: (1.0 + factor) * imagePoints[i].x,\r\n                         y: (1.0 + factor) * imagePoints[i].y};\r\n  }\r\n\r\n  imageDifference = 0.0;\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    imageDifference += Math.abs(sopImagePoints[i].x - oldSopImagePoints[i].x);\r\n    imageDifference += Math.abs(sopImagePoints[i].y - oldSopImagePoints[i].y);\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    translation1[i] = translation[i] -\r\n      (rotation[i][0] * this.objectPoints[0][0] +\r\n       rotation[i][1] * this.objectPoints[0][1] +\r\n       rotation[i][2] * this.objectPoints[0][2]);\r\n  }\r\n  \r\n  error = error1 = this.error(imagePoints, rotation, translation1);\r\n\r\n  //Convergence\r\n  converged = (0.0 === error1.pixels) || (imageDifference < 0.01);\r\n  \r\n  while( iteration ++ < 100 && !converged ){\r\n  \r\n    for (i = 0; i < np; ++ i){\r\n      oldSopImagePoints[i].x = sopImagePoints[i].x;\r\n      oldSopImagePoints[i].y = sopImagePoints[i].y;\r\n    }\r\n\r\n    this.pos(sopImagePoints, rotation1, rotation2, translation);\r\n\r\n    for (i = 0; i < 3; ++ i){\r\n      translation1[i] = translation[i] -\r\n        (rotation1[i][0] * this.objectPoints[0][0] +\r\n         rotation1[i][1] * this.objectPoints[0][1] +\r\n         rotation1[i][2] * this.objectPoints[0][2]);\r\n        \r\n      translation2[i] = translation[i] -\r\n        (rotation2[i][0] * this.objectPoints[0][0] +\r\n         rotation2[i][1] * this.objectPoints[0][1] +\r\n         rotation2[i][2] * this.objectPoints[0][2]);\r\n    }\r\n\r\n    error1 = this.error(imagePoints, rotation1, translation1);\r\n    error2 = this.error(imagePoints, rotation2, translation2);\r\n\r\n    if ( (error1.euclidean >= 0.0) && (error2.euclidean >= 0.0) ){\r\n      if (error2.euclidean < error1.euclidean){\r\n        error = error2;\r\n        for (i = 0; i < 3; ++ i){\r\n          for (j = 0; j < 3; ++ j){\r\n            rotation[i][j] = rotation2[i][j];\r\n          }\r\n        }\r\n      }else{\r\n        error = error1;\r\n        for (i = 0; i < 3; ++ i){\r\n          for (j = 0; j < 3; ++ j){\r\n            rotation[i][j] = rotation1[i][j];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if ( (error1.euclidean < 0.0) && (error2.euclidean >= 0.0) ){\r\n      error = error2;\r\n      for (i = 0; i < 3; ++ i){\r\n        for (j = 0; j < 3; ++ j){\r\n          rotation[i][j] = rotation2[i][j];\r\n        }\r\n      }\r\n    }\r\n    \r\n    if ( (error2.euclidean < 0.0) && (error1.euclidean >= 0.0) ){\r\n      error = error1;\r\n      for (i = 0; i < 3; ++ i){\r\n        for (j = 0; j < 3; ++ j){\r\n          rotation[i][j] = rotation1[i][j];\r\n        }\r\n      }\r\n    }\r\n\r\n    for (i = 0; i < np; ++ i){\r\n      factor = 0.0;\r\n      for (j = 0; j < 3; ++ j){\r\n        factor += this.objectVectors[i][j] * rotation[2][j] / translation[2];\r\n      }\r\n      sopImagePoints[i].x = (1.0 + factor) * imagePoints[i].x;\r\n      sopImagePoints[i].y = (1.0 + factor) * imagePoints[i].y;\r\n    }\r\n\r\n    oldImageDifference = imageDifference;\r\n    imageDifference = 0.0;\r\n    \r\n    for (i = 0; i < np; ++ i){\r\n      imageDifference += Math.abs(sopImagePoints[i].x - oldSopImagePoints[i].x);\r\n      imageDifference += Math.abs(sopImagePoints[i].y - oldSopImagePoints[i].y);\r\n    }\r\n\r\n    delta = Math.abs(imageDifference - oldImageDifference);\r\n\r\n    converged = (0.0 === error.pixels) || (delta < 0.01);\r\n  }\r\n  \r\n  return error;\r\n};\r\n\r\nPOS.Posit.prototype.error = function(imagePoints, rotation, translation){\r\n  var np = this.objectPoints.length,\r\n      move = [], projection = [], errorvec = [],\r\n      euclidean = 0.0, pixels = 0.0, maximum = 0.0,\r\n      i, j, k;\r\n\r\n  if ( !this.isValid(rotation, translation) ){\r\n    return {euclidean: -1.0, pixels: -1, maximum: -1.0};\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    move[i] = [];\r\n    for (j = 0; j < 3; ++ j){\r\n      move[i][j] = translation[j];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    for (j = 0; j < 3; ++ j){\r\n      for (k = 0; k < 3; ++ k){\r\n        move[i][j] += rotation[j][k] * this.objectPoints[i][k];\r\n      }\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    projection[i] = [];\r\n    for (j = 0; j < 2; ++ j){\r\n      projection[i][j] = this.focalLength * move[i][j] / move[i][2];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < np; ++ i){\r\n    errorvec[i] = [projection[i][0] - imagePoints[i].x,\r\n                   projection[i][1] - imagePoints[i].y];\r\n  }\r\n\r\n  for (i = 0; i < np; ++ i){\r\n    euclidean += Math.sqrt(errorvec[i][0] * errorvec[i][0] +\r\n                           errorvec[i][1] * errorvec[i][1]);\r\n                       \r\n    pixels += Math.abs( Math.round(projection[i][0]) - Math.round(imagePoints[i].x) ) +\r\n              Math.abs( Math.round(projection[i][1]) - Math.round(imagePoints[i].y) );\r\n              \r\n    if (Math.abs(errorvec[i][0]) > maximum){\r\n      maximum = Math.abs(errorvec[i][0]);\r\n    }\r\n    if (Math.abs(errorvec[i][1]) > maximum){\r\n      maximum = Math.abs(errorvec[i][1]);\r\n    }\r\n  }\r\n\r\n  return {euclidean: euclidean / np, pixels: pixels, maximum: maximum};\r\n};\r\n\r\nPOS.pseudoInverse = function(a, n, b){\r\n  var w = [], v = [[],[],[]], s = [[],[],[]],\r\n      wmax = 0.0, cn = 0,\r\n      i, j, k;\r\n\r\n  SVD.svdcmp(a, n, 3, w, v);\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    if (w[i] > wmax){\r\n      wmax = w[i];\r\n    }\r\n  }\r\n\r\n  wmax *= 0.01;\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    if (w[i] < wmax){\r\n      w[i] = 0.0;\r\n    }\r\n  }\r\n\r\n  for (j = 0; j < 3; ++ j){\r\n    if (0.0 === w[j]){\r\n      ++ cn;\r\n      for (k = j; k < 2; ++ k){\r\n        for (i = 0; i < n; ++ i){\r\n          a[i][k] = a[i][k + 1];\r\n        }\r\n        for (i = 0; i < 3; ++ i){\r\n          v[i][k] = v[i][k + 1];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  for (j = 0; j < 2; ++ j){\r\n    if (0.0 === w[j]){\r\n      w[j] = w[j + 1];\r\n    }\r\n  }\r\n\r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < 3 - cn; ++ j){\r\n      s[i][j] = v[i][j] / w[j];\r\n    }\r\n  }\r\n  \r\n  for (i = 0; i < 3; ++ i){\r\n    for (j = 0; j < n; ++ j){\r\n      b[i][j] = 0.0;\r\n      for (k = 0; k < 3 - cn; ++ k){\r\n        b[i][j] += s[i][k] * a[j][k];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nPOS.Pose = function(error1, rotation1, translation1, error2, rotation2, translation2){\r\n  this.bestError = error1;\r\n  this.bestRotation = rotation1;\r\n  this.bestTranslation = translation1;\r\n  this.alternativeError = error2;\r\n  this.alternativeRotation = rotation2;\r\n  this.alternativeTranslation = translation2;\r\n};\r\n\r\nmodule.exports = POS;","/*\r\nCopyright (c) 2012 Juan Mellado\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n*/\r\n\r\n/*\r\nReferences:\r\n- \"3D Pose Estimation\"\r\n  Andrew Kirillow\r\n  http://www.aforgenet.com/articles/posit/\r\n*/\r\n\r\nvar SVD = require('./svd');\r\n\r\nvar POS = POS || {};\r\n\r\nPOS.Posit = function(modelSize, focalLength){\r\n  this.model = this.buildModel(modelSize);\r\n  this.focalLength = focalLength;\r\n\r\n  this.init();\r\n};\r\n\r\nPOS.Posit.prototype.buildModel = function(modelSize){\r\n  var half = modelSize / 2.0;\r\n  \r\n  return [\r\n    new Vec3(-half,  half, 0.0),\r\n    new Vec3( half,  half, 0.0),\r\n    new Vec3( half, -half, 0.0),\r\n    new Vec3(-half, -half, 0.0) ];\r\n};\r\n\r\nPOS.Posit.prototype.init = function(){\r\n  var d = new Vec3(), v = new Mat3(), u;\r\n  \r\n  this.modelVectors = Mat3.fromRows(\r\n      Vec3.sub(this.model[1], this.model[0]),\r\n      Vec3.sub(this.model[2], this.model[0]),\r\n      Vec3.sub(this.model[3], this.model[0]) );\r\n\r\n  u = Mat3.clone(this.modelVectors);\r\n\r\n  SVD.svdcmp(u.m, 3, 3, d.v, v.m);\r\n\r\n  this.modelPseudoInverse = Mat3.mult(\r\n    Mat3.mult(v, Mat3.fromDiagonal( Vec3.inverse(d) ) ), Mat3.transpose(u) );\r\n  \r\n  this.modelNormal = v.column( d.minIndex() );\r\n};\r\n\r\nPOS.Posit.prototype.pose = function(points){\r\n  var eps = new Vec3(1.0, 1.0, 1.0),\r\n      rotation1 = new Mat3(), rotation2 = new Mat3(),\r\n      translation1 = new Vec3(), translation2 = new Vec3(),\r\n      error1, error2;\r\n\r\n  this.pos(points, eps, rotation1, rotation2, translation1, translation2);\r\n\r\n  error1 = this.iterate(points, rotation1, translation1);\r\n  error2 = this.iterate(points, rotation2, translation2);\r\n\r\n  return error1 < error2?\r\n    new POS.Pose(error1, rotation1.m, translation1.v, error2, rotation2.m, translation2.v):\r\n    new POS.Pose(error2, rotation2.m, translation2.v, error1, rotation1.m, translation1.v);\r\n};\r\n\r\nPOS.Posit.prototype.pos = function(points, eps, rotation1, rotation2, translation1, translation2){\r\n  var xi = new Vec3(points[1].x, points[2].x, points[3].x),\r\n      yi = new Vec3(points[1].y, points[2].y, points[3].y),\r\n      xs = Vec3.addScalar( Vec3.mult(xi, eps), -points[0].x),\r\n      ys = Vec3.addScalar( Vec3.mult(yi, eps), -points[0].y),\r\n      i0 = Mat3.multVector(this.modelPseudoInverse, xs),\r\n      j0 = Mat3.multVector(this.modelPseudoInverse, ys),\r\n      s = j0.square() - i0.square(),\r\n      ij = Vec3.dot(i0, j0),\r\n      r = 0.0, theta = 0.0,\r\n      i, j, k, inorm, jnorm, scale, temp, lambda, mu;\r\n\r\n  if (0.0 === s){\r\n    r = Math.sqrt( Math.abs(2.0 * ij) );\r\n    theta = (-Math.PI / 2.0) * (ij < 0.0? -1: (ij > 0.0? 1.0: 0.0) );\r\n  }else{\r\n    r = Math.sqrt( Math.sqrt(s * s + 4.0 * ij * ij) );\r\n    theta = Math.atan(-2.0 * ij / s);\r\n    if (s < 0.0){\r\n      theta += Math.PI;\r\n    }\r\n    theta /= 2.0;\r\n  }\r\n\r\n  lambda = r * Math.cos(theta);\r\n  mu = r * Math.sin(theta);\r\n\r\n  //First possible rotation/translation\r\n  i = Vec3.add(i0, Vec3.multScalar(this.modelNormal, lambda) );\r\n  j = Vec3.add(j0, Vec3.multScalar(this.modelNormal, mu) );\r\n  inorm = i.normalize();\r\n  jnorm = j.normalize();\r\n  k = Vec3.cross(i, j);\r\n  rotation1.copy( Mat3.fromRows(i, j, k) );\r\n  \r\n  scale = (inorm + jnorm) / 2.0;\r\n  temp = Mat3.multVector(rotation1, this.model[0]);\r\n  translation1.v = [\r\n    points[0].x / scale - temp.v[0],\r\n    points[0].y / scale - temp.v[1],\r\n    this.focalLength / scale];\r\n\r\n  //Second possible rotation/translation\r\n  i = Vec3.sub(i0, Vec3.multScalar(this.modelNormal, lambda) );\r\n  j = Vec3.sub(j0, Vec3.multScalar(this.modelNormal, mu) );\r\n  inorm = i.normalize();\r\n  jnorm = j.normalize();\r\n  k = Vec3.cross(i, j);\r\n  rotation2.copy( Mat3.fromRows(i, j, k) );\r\n  \r\n  scale = (inorm + jnorm) / 2.0;\r\n  temp = Mat3.multVector(rotation2, this.model[0]);\r\n  translation2.v = [\r\n    points[0].x / scale - temp.v[0],\r\n    points[0].y / scale - temp.v[1],\r\n    this.focalLength / scale];\r\n};\r\n\r\nPOS.Posit.prototype.iterate = function(points, rotation, translation){\r\n  var prevError = Infinity,\r\n      rotation1 = new Mat3(), rotation2 = new Mat3(),\r\n      translation1 = new Vec3(), translation2 = new Vec3(),\r\n      i = 0, eps, error, error1, error2;\r\n\r\n  for (; i < 100; ++ i){\r\n    eps = Vec3.addScalar( Vec3.multScalar( \r\n      Mat3.multVector( this.modelVectors, rotation.row(2) ), 1.0 / translation.v[2]), 1.0);\r\n\r\n    this.pos(points, eps, rotation1, rotation2, translation1, translation2);\r\n\r\n    error1 = this.getError(points, rotation1, translation1);\r\n    error2 = this.getError(points, rotation2, translation2);\r\n\r\n    if (error1 < error2){\r\n      rotation.copy(rotation1);\r\n      translation.copy(translation1);\r\n      error = error1;\r\n    }else{\r\n      rotation.copy(rotation2);\r\n      translation.copy(translation2);\r\n      error = error2;\r\n    }\r\n\r\n    if ( (error <= 2.0) || (error > prevError) ){\r\n      break;\r\n    }\r\n\r\n    prevError = error;\r\n  }\r\n\r\n  return error;\r\n};\r\n\r\nPOS.Posit.prototype.getError = function(points, rotation, translation){\r\n  var v1 = Vec3.add( Mat3.multVector(rotation, this.model[0]), translation),\r\n      v2 = Vec3.add( Mat3.multVector(rotation, this.model[1]), translation),\r\n      v3 = Vec3.add( Mat3.multVector(rotation, this.model[2]), translation),\r\n      v4 = Vec3.add( Mat3.multVector(rotation, this.model[3]), translation),\r\n      modeled, ia1, ia2, ia3, ia4, ma1, ma2, ma3, ma4;\r\n  \r\n  v1 = v1.v; v2 = v2.v; v3 = v3.v; v4 = v4.v;\r\n  \r\n  v1[0] *= this.focalLength / v1[2];\r\n  v1[1] *= this.focalLength / v1[2];\r\n  v2[0] *= this.focalLength / v2[2];\r\n  v2[1] *= this.focalLength / v2[2];\r\n  v3[0] *= this.focalLength / v3[2];\r\n  v3[1] *= this.focalLength / v3[2];\r\n  v4[0] *= this.focalLength / v4[2];\r\n  v4[1] *= this.focalLength / v4[2];\r\n  \r\n  modeled = [\r\n    {x: v1[0], y: v1[1]},\r\n    {x: v2[0], y: v2[1]},\r\n    {x: v3[0], y: v3[1]},\r\n    {x: v4[0], y: v4[1]}\r\n  ];\r\n\r\n  ia1 = this.angle( points[0], points[1], points[3] );\r\n  ia2 = this.angle( points[1], points[2], points[0] );\r\n  ia3 = this.angle( points[2], points[3], points[1] );\r\n  ia4 = this.angle( points[3], points[0], points[2] );\r\n\r\n  ma1 = this.angle( modeled[0], modeled[1], modeled[3] );\r\n  ma2 = this.angle( modeled[1], modeled[2], modeled[0] );\r\n  ma3 = this.angle( modeled[2], modeled[3], modeled[1] );\r\n  ma4 = this.angle( modeled[3], modeled[0], modeled[2] );\r\n\r\n  return ( Math.abs(ia1 - ma1) +\r\n           Math.abs(ia2 - ma2) +\r\n           Math.abs(ia3 - ma3) +\r\n           Math.abs(ia4 - ma4) ) / 4.0;\r\n};\r\n\r\nPOS.Posit.prototype.angle = function(a, b, c){\r\n  var x1 = b.x - a.x, y1 = b.y - a.y,\r\n      x2 = c.x - a.x, y2 = c.y - a.y;\r\n  \r\n  return Math.acos( (x1 * x2 + y1 * y2) / \r\n    (Math.sqrt(x1 * x1 + y1 * y1) * Math.sqrt(x2 * x2 + y2 * y2) ) ) * 180.0 / Math.PI;\r\n};\r\n\r\nPOS.Pose = function(error1, rotation1, translation1, error2, rotation2, translation2){\r\n  this.bestError = error1;\r\n  this.bestRotation = rotation1;\r\n  this.bestTranslation = translation1;\r\n  this.alternativeError = error2;\r\n  this.alternativeRotation = rotation2;\r\n  this.alternativeTranslation = translation2;\r\n};\r\n\r\nvar Vec3 = function(x, y, z){\r\n  this.v = [x || 0.0, y || 0.0, z || 0.0];\r\n};\r\n\r\nVec3.prototype.copy = function(a){\r\n  var v = this.v;\r\n\r\n  a = a.v;\r\n\r\n  v[0] = a[0];\r\n  v[1] = a[1];\r\n  v[2] = a[2];\r\n\r\n  return this;\r\n};\r\n\r\nVec3.add = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] + b[0];\r\n  v[1] = a[1] + b[1];\r\n  v[2] = a[2] + b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.sub = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] - b[0];\r\n  v[1] = a[1] - b[1];\r\n  v[2] = a[2] - b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.mult = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v; b = b.v;\r\n\r\n  v[0] = a[0] * b[0];\r\n  v[1] = a[1] * b[1];\r\n  v[2] = a[2] * b[2];\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.addScalar = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n\r\n  v[0] = a[0] + b;\r\n  v[1] = a[1] + b;\r\n  v[2] = a[2] + b;\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.multScalar = function(a, b){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n\r\n  v[0] = a[0] * b;\r\n  v[1] = a[1] * b;\r\n  v[2] = a[2] * b;\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.dot = function(a, b){\r\n  a = a.v; b = b.v;\r\n\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n};\r\n\r\nVec3.cross = function(a, b){\r\n  a = a.v; b = b.v;\r\n\r\n return new Vec3(\r\n    a[1] * b[2] - a[2] * b[1],\r\n    a[2] * b[0] - a[0] * b[2],\r\n    a[0] * b[1] - a[1] * b[0]);\r\n};\r\n\r\nVec3.prototype.normalize = function(){\r\n  var v = this.v,\r\n      len = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n      \r\n  if (len > 0.0){\r\n    v[0] /= len;\r\n    v[1] /= len;\r\n    v[2] /= len;\r\n  }\r\n\r\n  return len;\r\n};\r\n\r\nVec3.inverse = function(a){\r\n  var vector = new Vec3(), v = vector.v;\r\n  \r\n  a = a.v;\r\n  \r\n  if (a[0] !== 0.0){\r\n    v[0] = 1.0 / a[0];\r\n  }\r\n  if (a[1] !== 0.0){\r\n    v[1] = 1.0 / a[1];\r\n  }\r\n  if (a[2] !== 0.0){\r\n    v[2] = 1.0 / a[2];\r\n  }\r\n  \r\n  return vector;\r\n};\r\n\r\nVec3.prototype.square = function(){\r\n  var v = this.v;\r\n\r\n  return v[0] * v[0] + v[1] * v[1] + v[2] * v[2];\r\n};\r\n\r\nVec3.prototype.minIndex = function(){\r\n  var v = this.v;\r\n\r\n  return v[0] < v[1]? (v[0] < v[2]? 0: 2): (v[1] < v[2]? 1: 2);\r\n};\r\n\r\nvar Mat3 = function(){\r\n  this.m = [ [0.0, 0.0, 0.0],\r\n             [0.0, 0.0, 0.0],\r\n             [0.0, 0.0, 0.0] ];\r\n};\r\n\r\nMat3.clone = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m;\r\n\r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[0][1];\r\n  m[0][2] = a[0][2];\r\n  m[1][0] = a[1][0];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[1][2];\r\n  m[2][0] = a[2][0];\r\n  m[2][1] = a[2][1];\r\n  m[2][2] = a[2][2];\r\n  \r\n  return matrix;\r\n};\r\n\r\nMat3.prototype.copy = function(a){\r\n  var m = this.m;\r\n\r\n  a = a.m;\r\n\r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[0][1];\r\n  m[0][2] = a[0][2];\r\n  m[1][0] = a[1][0];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[1][2];\r\n  m[2][0] = a[2][0];\r\n  m[2][1] = a[2][1];\r\n  m[2][2] = a[2][2];\r\n\r\n  return this;\r\n};\r\n\r\nMat3.fromRows = function(a, b, c){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.v; b = b.v; c = c.v;\r\n  \r\n  m[0][0] = a[0];\r\n  m[0][1] = a[1];\r\n  m[0][2] = a[2];\r\n  m[1][0] = b[0];\r\n  m[1][1] = b[1];\r\n  m[1][2] = b[2];\r\n  m[2][0] = c[0];\r\n  m[2][1] = c[1];\r\n  m[2][2] = c[2];\r\n\r\n  return matrix;\r\n};\r\n\r\nMat3.fromDiagonal = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.v;\r\n  \r\n  m[0][0] = a[0];\r\n  m[1][1] = a[1];\r\n  m[2][2] = a[2];\r\n  \r\n  return matrix;\r\n};\r\n\r\nMat3.transpose = function(a){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m;\r\n  \r\n  m[0][0] = a[0][0];\r\n  m[0][1] = a[1][0];\r\n  m[0][2] = a[2][0];\r\n  m[1][0] = a[0][1];\r\n  m[1][1] = a[1][1];\r\n  m[1][2] = a[2][1];\r\n  m[2][0] = a[0][2];\r\n  m[2][1] = a[1][2];\r\n  m[2][2] = a[2][2];\r\n            \r\n  return matrix;\r\n};\r\n\r\nMat3.mult = function(a, b){\r\n  var matrix = new Mat3(), m = matrix.m;\r\n  \r\n  a = a.m; b = b.m;\r\n\r\n  m[0][0] = a[0][0] * b[0][0] + a[0][1] * b[1][0] + a[0][2] * b[2][0];\r\n  m[0][1] = a[0][0] * b[0][1] + a[0][1] * b[1][1] + a[0][2] * b[2][1];\r\n  m[0][2] = a[0][0] * b[0][2] + a[0][1] * b[1][2] + a[0][2] * b[2][2];\r\n  m[1][0] = a[1][0] * b[0][0] + a[1][1] * b[1][0] + a[1][2] * b[2][0];\r\n  m[1][1] = a[1][0] * b[0][1] + a[1][1] * b[1][1] + a[1][2] * b[2][1];\r\n  m[1][2] = a[1][0] * b[0][2] + a[1][1] * b[1][2] + a[1][2] * b[2][2];\r\n  m[2][0] = a[2][0] * b[0][0] + a[2][1] * b[1][0] + a[2][2] * b[2][0];\r\n  m[2][1] = a[2][0] * b[0][1] + a[2][1] * b[1][1] + a[2][2] * b[2][1];\r\n  m[2][2] = a[2][0] * b[0][2] + a[2][1] * b[1][2] + a[2][2] * b[2][2];\r\n\r\n  return matrix;\r\n};\r\n\r\nMat3.multVector = function(m, a){\r\n  m = m.m; a = a.v;\r\n  \r\n  return new Vec3(\r\n    m[0][0] * a[0] + m[0][1] * a[1] + m[0][2] * a[2],\r\n    m[1][0] * a[0] + m[1][1] * a[1] + m[1][2] * a[2],\r\n    m[2][0] * a[0] + m[2][1] * a[1] + m[2][2] * a[2]);\r\n};\r\n\r\nMat3.prototype.column = function(index){\r\n  var m = this.m;\r\n  \r\n  return new Vec3( m[0][index], m[1][index], m[2][index] );\r\n};\r\n\r\nMat3.prototype.row = function(index){\r\n  var m = this.m;\r\n  \r\n  return new Vec3( m[index][0], m[index][1], m[index][2] );\r\n};\r\n\r\nmodule.exports = POS;","module.exports = {\n  CV: require('./src/cv'),\n  AR: require('./src/aruco'),\n  SVD: require('./src/svd'),\n  POS1: require('./src/posit1'),\n  POS2: require('./src/posit2')\n}","import { AR } from 'js-aruco'\r\nimport { canonicalRimTargets, computeHomographyDLT, rmsError, type Homography, type Point } from './vision'\r\n\r\nexport type MarkerKey = 'top' | 'right' | 'bottom' | 'left'\r\n\r\nexport const MARKER_ORDER: MarkerKey[] = ['top', 'right', 'bottom', 'left']\r\n\r\nexport const MARKER_TARGETS: Record<MarkerKey, number> = {\r\n  top: 0,\r\n  right: 1,\r\n  bottom: 2,\r\n  left: 3,\r\n}\r\n\r\nexport type MarkerDetection = {\r\n  success: boolean\r\n  points: Point[]\r\n  missing: MarkerKey[]\r\n  markersFound: Array<{ id: number; center: Point }>\r\n  assignments: Partial<Record<MarkerKey, { id: number; center: Point }>>\r\n  homography: Homography | null\r\n  errorPx: number | null\r\n  message?: string\r\n}\r\n\r\nlet detector: AR.Detector | null = null\r\n\r\nfunction ensureDetector() {\r\n  if (!detector) detector = new AR.Detector()\r\n  return detector\r\n}\r\n\r\nfunction centerFromCorners(corners: { x: number; y: number }[]): Point {\r\n  const acc = corners.reduce((sum, corner) => ({ x: sum.x + corner.x, y: sum.y + corner.y }), { x: 0, y: 0 })\r\n  const count = corners.length || 1\r\n  return { x: acc.x / count, y: acc.y / count }\r\n}\r\n\r\nexport function detectMarkersFromImage(image: ImageData): MarkerDetection {\r\n  try {\r\n    const det = ensureDetector()\r\n    const markers = det.detect(image) || []\r\n    const assignments: Partial<Record<MarkerKey, { id: number; center: Point }>> = {}\r\n    const found: Array<{ id: number; center: Point }> = []\r\n    \r\n    // Map detected markers to their positions\r\n    for (const marker of markers) {\r\n      const center = centerFromCorners(marker.corners)\r\n      found.push({ id: marker.id, center })\r\n      const key = (Object.keys(MARKER_TARGETS) as MarkerKey[]).find(k => MARKER_TARGETS[k] === marker.id)\r\n      if (key) assignments[key] = { id: marker.id, center }\r\n    }\r\n    \r\n    const missing = (Object.keys(MARKER_TARGETS) as MarkerKey[]).filter(k => !assignments[k])\r\n    \r\n    // If we found some markers but not all, provide helpful info in the error\r\n    if (missing.length > 0) {\r\n      return {\r\n        success: false,\r\n        points: [],\r\n        missing,\r\n        markersFound: found,\r\n        assignments,\r\n        homography: null,\r\n        errorPx: null,\r\n        message: found.length > 0 \r\n          ? `Detected ${found.length} of 4 markers. Some markers may have incorrect IDs or be unclear.`\r\n          : 'Not all calibration markers were detected.',\r\n      }\r\n    }\r\n    \r\n    // All 4 markers found - compute homography\r\n    const dst = [assignments.top!.center, assignments.right!.center, assignments.bottom!.center, assignments.left!.center]\r\n    // Use only the first 4 canonical rim targets (TOP, RIGHT, BOTTOM, LEFT) to match the 4 marker points\r\n    const allTargets = canonicalRimTargets()\r\n    const src = allTargets.slice(0, 4)\r\n    const H = computeHomographyDLT(src, dst)\r\n    const error = rmsError(H, src, dst)\r\n    return {\r\n      success: true,\r\n      points: dst,\r\n      missing: [],\r\n      markersFound: found,\r\n      assignments,\r\n      homography: H,\r\n      errorPx: error,\r\n    }\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      points: [],\r\n      missing: (Object.keys(MARKER_TARGETS) as MarkerKey[]),\r\n      markersFound: [],\r\n      assignments: {},\r\n      homography: null,\r\n      errorPx: null,\r\n      message: err instanceof Error ? err.message : 'Marker detection failed',\r\n    }\r\n  }\r\n}\r\n\r\nexport function detectMarkersFromCanvas(canvas: HTMLCanvasElement): MarkerDetection {\r\n  const ctx = canvas.getContext('2d')\r\n  if (!ctx) {\r\n    return {\r\n      success: false,\r\n      points: [],\r\n      missing: (Object.keys(MARKER_TARGETS) as MarkerKey[]),\r\n      markersFound: [],\r\n      assignments: {},\r\n      homography: null,\r\n      errorPx: null,\r\n      message: 'Canvas context unavailable for marker detection.',\r\n    }\r\n  }\r\n  const tryDetect = (img: ImageData): MarkerDetection => detectMarkersFromImage(img)\r\n\r\n  // Pass 1: raw image\r\n  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n  let result = tryDetect(imageData)\r\n  if (result.success || (result.markersFound?.length||0) > 0) return result\r\n\r\n  // Pass 2: scale up 1.75x (helps low-resolution streams)\r\n  try {\r\n    const scale = 1.75\r\n    const off = document.createElement('canvas')\r\n    off.width = Math.round(canvas.width * scale)\r\n    off.height = Math.round(canvas.height * scale)\r\n    const octx = off.getContext('2d')!\r\n    octx.imageSmoothingEnabled = false\r\n    octx.drawImage(canvas, 0, 0, off.width, off.height)\r\n    imageData = octx.getImageData(0, 0, off.width, off.height)\r\n    result = tryDetect(imageData)\r\n    if (result.success || (result.markersFound?.length||0) > 0) return result\r\n  } catch {}\r\n\r\n  // Pass 3: contrast boost (simple linear stretch)\r\n  try {\r\n    const w = canvas.width, h = canvas.height\r\n    const id = ctx.getImageData(0, 0, w, h)\r\n    const data = id.data\r\n    let min = 255, max = 0\r\n    // Compute luminance min/max\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const y = (0.2126 * data[i] + 0.7152 * data[i+1] + 0.0722 * data[i+2])\r\n      if (y < min) min = y\r\n      if (y > max) max = y\r\n    }\r\n    const range = Math.max(1, max - min)\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const y = (0.2126 * data[i] + 0.7152 * data[i+1] + 0.0722 * data[i+2])\r\n      const yn = Math.max(0, Math.min(255, ((y - min) * 255) / range))\r\n      data[i] = data[i+1] = data[i+2] = yn\r\n    }\r\n    result = tryDetect(id)\r\n    if (result.success || (result.markersFound?.length||0) > 0) return result\r\n  } catch {}\r\n\r\n  // Pass 4: aggressive threshold (convert to pure black & white)\r\n  try {\r\n    const w = canvas.width, h = canvas.height\r\n    const id = ctx.getImageData(0, 0, w, h)\r\n    const data = id.data\r\n    // Find middle gray\r\n    let sum = 0, count = 0\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const y = (0.2126 * data[i] + 0.7152 * data[i+1] + 0.0722 * data[i+2])\r\n      sum += y; count++\r\n    }\r\n    const threshold = sum / count\r\n    // Convert to pure B&W\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const y = (0.2126 * data[i] + 0.7152 * data[i+1] + 0.0722 * data[i+2])\r\n      const v = y > threshold ? 255 : 0\r\n      data[i] = data[i+1] = data[i+2] = v\r\n    }\r\n    result = tryDetect(id)\r\n    if (result.success || (result.markersFound?.length||0) > 0) return result\r\n  } catch {}\r\n\r\n  // If still nothing, return the last result (with helpful message)\r\n  return {\r\n    success: false,\r\n    points: [],\r\n    missing: (Object.keys(MARKER_TARGETS) as MarkerKey[]),\r\n    markersFound: result.markersFound || [],\r\n    assignments: result.assignments || {},\r\n\r\n    homography: null,\r\n    errorPx: null,\r\n    message: result.message || 'No calibration markers detected. Ensure you are using the provided TOP/RIGHT/BOTTOM/LEFT ArUco markers printed at 100% on white paper.',\r\n  }\r\n}\r\n\r\nconst ROW_PATTERNS: Record<string, number[]> = {\r\n  '0,0': [1, 0, 0, 0, 0],\r\n  '0,1': [1, 0, 1, 1, 1],\r\n  '1,0': [0, 1, 0, 0, 1],\r\n  '1,1': [0, 1, 1, 1, 0],\r\n}\r\n\r\nexport function markerIdToMatrix(id: number): number[][] {\r\n  const rows: number[][] = new Array(5)\r\n  let bits = id >>> 0\r\n  for (let row = 4; row >= 0; row--) {\r\n    const bit3 = bits & 1; bits >>= 1\r\n    const bit1 = bits & 1; bits >>= 1\r\n    const pattern = ROW_PATTERNS[`${bit1},${bit3}`]\r\n    if (!pattern) throw new Error(`Unsupported marker id pattern for row ${row}`)\r\n    rows[row] = pattern.slice()\r\n  }\r\n  const matrix = Array.from({ length: 7 }, () => new Array(7).fill(0))\r\n  for (let y = 0; y < 5; y++) {\r\n    for (let x = 0; x < 5; x++) {\r\n      matrix[y + 1][x + 1] = rows[y][x]\r\n    }\r\n  }\r\n  return matrix\r\n}\r\n","/**\r\n * Advanced Dartboard Auto-Calibration\r\n * \r\n * Detects dartboard features automatically without markers or manual clicking:\r\n * 1. Detects bull (inner & outer rings) using circle detection\r\n * 2. Detects treble and double rings using edge/circle detection\r\n * 3. Computes board center and orientation\r\n * 4. Generates calibration points from detected rings\r\n * 5. Computes homography without user interaction\r\n */\r\n\r\nimport { BoardRadii, computeHomographyDLT, rmsError, type Homography, type Point } from './vision'\r\n\r\nexport interface BoardDetectionResult {\r\n  success: boolean\r\n  cx: number              // Board center X in image\r\n  cy: number              // Board center Y in image\r\n  bullInner: number       // Detected inner bull radius (pixels)\r\n  bullOuter: number       // Detected outer bull radius (pixels)\r\n  trebleInner: number     // Detected treble inner radius (pixels)\r\n  trebleOuter: number     // Detected treble outer radius (pixels)\r\n  doubleInner: number     // Detected double inner radius (pixels)\r\n  doubleOuter: number     // Detected double outer radius (pixels)\r\n  confidence: number      // 0-100, quality of detection\r\n  homography: Homography | null\r\n  errorPx: number | null\r\n  calibrationPoints: Point[]\r\n  message?: string\r\n}\r\n\r\n/**\r\n * Detect dartboard by finding concentric rings\r\n * Simpler, more direct approach: look for strong circular edges at the right distances\r\n */\r\nfunction findDartboardRings(canvas: HTMLCanvasElement): { cx: number; cy: number; r: number; confidence: number } | null {\r\n  const ctx = canvas.getContext('2d')\r\n  if (!ctx) return null\r\n\r\n  const w = canvas.width\r\n  const h = canvas.height\r\n  const imageData = ctx.getImageData(0, 0, w, h)\r\n  const data = imageData.data\r\n\r\n  // Step 1: Find all strong edges using Canny-like detection\r\n  const edges: Array<{ x: number; y: number; mag: number }> = []\r\n\r\n  for (let y = 2; y < h - 2; y++) {\r\n    for (let x = 2; x < w - 2; x++) {\r\n      const idx = (y * w + x) * 4\r\n      \r\n      // Compute gradients\r\n      let gx = 0, gy = 0\r\n      for (let dy = -1; dy <= 1; dy++) {\r\n        for (let dx = -1; dx <= 1; dx++) {\r\n          const pidx = ((y + dy) * w + (x + dx)) * 4\r\n          const gray = data[pidx] * 0.299 + data[pidx + 1] * 0.587 + data[pidx + 2] * 0.114\r\n          if (dx !== 0) gx += (dx > 0 ? 1 : -1) * gray\r\n          if (dy !== 0) gy += (dy > 0 ? 1 : -1) * gray\r\n        }\r\n      }\r\n      \r\n      const mag = Math.hypot(gx, gy)\r\n      if (mag > 20) {\r\n        edges.push({ x, y, mag })\r\n      }\r\n    }\r\n  }\r\n\r\n  if (edges.length === 0) return null\r\n\r\n  // Step 2: For each potential center, score how many rings we can explain\r\n  let bestCenter = null\r\n  let bestScore = 0\r\n\r\n  // Sample potential centers\r\n  for (let cy = h * 0.3; cy < h * 0.7; cy += 10) {\r\n    for (let cx = w * 0.3; cx < w * 0.7; cx += 10) {\r\n      // For this center, find rings at expected radii\r\n      let ringCount = 0\r\n      let ringStrength = 0\r\n\r\n      // Test for rings at known pixel radii (assuming double radius ~150px)\r\n      const testRadii = [15, 30, 150, 162, 180, 205]\r\n      \r\n      for (const testR of testRadii) {\r\n        let strength = 0\r\n        let pixelCount = 0\r\n\r\n        // Count edge pixels near this radius\r\n        for (const edge of edges) {\r\n          const dist = Math.hypot(edge.x - cx, edge.y - cy)\r\n          if (Math.abs(dist - testR) < 3) {\r\n            strength += edge.mag\r\n            pixelCount++\r\n          }\r\n        }\r\n\r\n        if (pixelCount > 10 && strength > 500) {\r\n          ringCount++\r\n          ringStrength += strength\r\n        }\r\n      }\r\n\r\n      // Want at least 4 strong rings\r\n      if (ringCount >= 4 && ringStrength > bestScore) {\r\n        bestScore = ringStrength\r\n        bestCenter = { cx, cy }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!bestCenter) return null\r\n\r\n  // Step 3: Refine the center position and find double radius\r\n  const refinedCx = bestCenter.cx\r\n  const refinedCy = bestCenter.cy\r\n\r\n  // Find the strongest ring near where we expect the double outer (165-190 pixels for typical image)\r\n  let doubleR = 170\r\n  let maxStrength = 0\r\n\r\n  for (let testR = 120; testR <= 250; testR += 5) {\r\n    let strength = 0\r\n    let pixelCount = 0\r\n\r\n    for (const edge of edges) {\r\n      const dist = Math.hypot(edge.x - refinedCx, edge.y - refinedCy)\r\n      if (Math.abs(dist - testR) < 2) {\r\n        strength += edge.mag\r\n        pixelCount++\r\n      }\r\n    }\r\n\r\n    if (pixelCount > 20 && strength > maxStrength) {\r\n      maxStrength = strength\r\n      doubleR = testR\r\n    }\r\n  }\r\n\r\n  // Calculate confidence based on how many proper rings we found\r\n  let confidence = 0\r\n  const scale = doubleR / BoardRadii.doubleOuter\r\n  \r\n  for (const knownR of [BoardRadii.bullInner, BoardRadii.bullOuter, BoardRadii.trebleInner, BoardRadii.trebleOuter, BoardRadii.doubleInner, BoardRadii.doubleOuter]) {\r\n    const expectedPixelR = knownR * scale\r\n    let found = false\r\n\r\n    for (const edge of edges) {\r\n      const dist = Math.hypot(edge.x - refinedCx, edge.y - refinedCy)\r\n      if (Math.abs(dist - expectedPixelR) < 3) {\r\n        found = true\r\n        confidence += 15\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  confidence = Math.min(100, confidence)\r\n\r\n  return {\r\n    cx: refinedCx,\r\n    cy: refinedCy,\r\n    r: doubleR,\r\n    confidence,\r\n  }\r\n}\r\n\r\n/**\r\n * Main board detection function\r\n * Uses direct ring detection approach\r\n */\r\nexport function detectBoard(canvas: HTMLCanvasElement): BoardDetectionResult {\r\n  try {\r\n    const w = canvas.width\r\n    const h = canvas.height\r\n    const centerX = w / 2\r\n    const centerY = h / 2\r\n\r\n    // Find dartboard rings\r\n    const detection = findDartboardRings(canvas)\r\n\r\n    if (!detection) {\r\n      return {\r\n        success: false,\r\n        cx: centerX,\r\n        cy: centerY,\r\n        bullInner: 0,\r\n        bullOuter: 0,\r\n        trebleInner: 0,\r\n        trebleOuter: 0,\r\n        doubleInner: 0,\r\n        doubleOuter: 0,\r\n        confidence: 0,\r\n        homography: null,\r\n        errorPx: null,\r\n        calibrationPoints: [],\r\n        message: 'No dartboard detected. Ensure board is clearly visible with good contrast between rings and background.',\r\n      }\r\n    }\r\n\r\n    // Scale all ring radii based on detected double radius\r\n    const scale = detection.r / BoardRadii.doubleOuter\r\n\r\n    const detected = {\r\n      cx: detection.cx,\r\n      cy: detection.cy,\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: detection.r,\r\n    }\r\n\r\n    // Generate 4 calibration points from detected rings (TOP, RIGHT, BOTTOM, LEFT of double)\r\n    const calibrationPoints: Point[] = [\r\n      { x: detected.cx, y: detected.cy - detected.doubleOuter },           // TOP\r\n      { x: detected.cx + detected.doubleOuter, y: detected.cy },           // RIGHT\r\n      { x: detected.cx, y: detected.cy + detected.doubleOuter },           // BOTTOM\r\n      { x: detected.cx - detected.doubleOuter, y: detected.cy },           // LEFT\r\n    ]\r\n\r\n    // Compute homography from these 4 points\r\n    const canonicalSrc = [\r\n      { x: 0, y: -BoardRadii.doubleOuter },\r\n      { x: BoardRadii.doubleOuter, y: 0 },\r\n      { x: 0, y: BoardRadii.doubleOuter },\r\n      { x: -BoardRadii.doubleOuter, y: 0 },\r\n    ]\r\n\r\n    let homography: Homography | null = null\r\n    let errorPx: number | null = null\r\n    let confidence = detection.confidence\r\n\r\n    try {\r\n      homography = computeHomographyDLT(canonicalSrc, calibrationPoints)\r\n      errorPx = rmsError(homography, canonicalSrc, calibrationPoints)\r\n      // Adjust confidence based on homography error\r\n      const errorConfidence = Math.max(10, Math.min(95, 100 - Math.max(0, errorPx - 1) * 10))\r\n      confidence = (confidence + errorConfidence) / 2\r\n    } catch (err) {\r\n      confidence = Math.max(40, confidence)\r\n    }\r\n\r\n    return {\r\n      success: !!homography && confidence > 50,\r\n      cx: detected.cx,\r\n      cy: detected.cy,\r\n      bullInner: detected.bullInner,\r\n      bullOuter: detected.bullOuter,\r\n      trebleInner: detected.trebleInner,\r\n      trebleOuter: detected.trebleOuter,\r\n      doubleInner: detected.doubleInner,\r\n      doubleOuter: detected.doubleOuter,\r\n      confidence,\r\n      homography,\r\n      errorPx,\r\n      calibrationPoints,\r\n      message: confidence > 80 ? '✅ High confidence detection' : confidence > 50 ? '⚠️ Detection found but could be better' : '❌ Low confidence - try better lighting',\r\n    }\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      cx: canvas.width / 2,\r\n      cy: canvas.height / 2,\r\n      bullInner: 0,\r\n      bullOuter: 0,\r\n      trebleInner: 0,\r\n      trebleOuter: 0,\r\n      doubleInner: 0,\r\n      doubleOuter: 0,\r\n      confidence: 0,\r\n      homography: null,\r\n      errorPx: null,\r\n      calibrationPoints: [],\r\n      message: err instanceof Error ? err.message : 'Board detection failed',\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Refine detection by looking for concentric rings\r\n * This helps match detected circles to specific board rings\r\n */\r\nexport function refineRingDetection(detected: BoardDetectionResult): BoardDetectionResult {\r\n  // If detection already has good confidence, return as-is\r\n  if (detected.confidence > 70) return detected\r\n\r\n  // Otherwise try to improve by checking ring ratios\r\n  // If rings don't match expected ratios, we can flag for manual refinement\r\n  const expectedRatios = {\r\n    bullInner_to_bullOuter: BoardRadii.bullInner / BoardRadii.bullOuter,\r\n    bullOuter_to_trebleInner: BoardRadii.bullOuter / BoardRadii.trebleInner,\r\n    trebleOuter_to_doubleInner: BoardRadii.trebleOuter / BoardRadii.doubleInner,\r\n    doubleInner_to_doubleOuter: BoardRadii.doubleInner / BoardRadii.doubleOuter,\r\n  }\r\n\r\n  const actualRatios = {\r\n    bullInner_to_bullOuter: detected.bullInner / detected.bullOuter,\r\n    bullOuter_to_trebleInner: detected.bullOuter / detected.trebleInner,\r\n    trebleOuter_to_doubleInner: detected.trebleOuter / detected.doubleInner,\r\n    doubleInner_to_doubleOuter: detected.doubleInner / detected.doubleOuter,\r\n  }\r\n\r\n  // Check ratio errors\r\n  let ratioError = 0\r\n  let ratioCount = 0\r\n  for (const [key, expected] of Object.entries(expectedRatios)) {\r\n    const actual = actualRatios[key as keyof typeof actualRatios]\r\n    const error = Math.abs(actual - expected) / expected\r\n    ratioError += error\r\n    ratioCount++\r\n  }\r\n  const avgRatioError = ratioError / ratioCount\r\n\r\n  // Adjust confidence based on ratio error\r\n  const adjustedConfidence = Math.max(10, detected.confidence - avgRatioError * 100)\r\n\r\n  return {\r\n    ...detected,\r\n    confidence: adjustedConfidence,\r\n    message: adjustedConfidence > 70 ? '✅ High confidence detection' : adjustedConfidence > 50 ? '⚠️ Rings detected but ratios off - may need refinement' : '❌ Low confidence - try repositioning camera',\r\n  }\r\n}\r\n","/**\r\n * Network device discovery utilities for wifi scoring devices\r\n */\r\n\r\n// Web Serial API types\r\ndeclare global {\r\n  interface Navigator {\r\n    serial: Serial;\r\n  }\r\n  interface Serial extends EventTarget {\r\n    getPorts(): Promise<SerialPort[]>;\r\n    requestPort(options?: SerialOptions): Promise<SerialPort>;\r\n  }\r\n  interface SerialPort {\r\n    open(options: SerialOptions): Promise<void>;\r\n    close(): Promise<void>;\r\n    readable: ReadableStream<Uint8Array> | null;\r\n    writable: WritableStream<Uint8Array> | null;\r\n  }\r\n  interface SerialOptions {\r\n    baudRate?: number;\r\n    dataBits?: number;\r\n    stopBits?: number;\r\n    parity?: 'none' | 'even' | 'odd';\r\n    bufferSize?: number;\r\n    flowControl?: 'none' | 'hardware';\r\n  }\r\n}\r\n\r\nexport interface NetworkDevice {\r\n  id: string;\r\n  name: string;\r\n  ip: string;\r\n  port: number;\r\n  type: 'omni' | 'vert' | 'generic';\r\n  capabilities: string[];\r\n  status: 'online' | 'offline' | 'connecting';\r\n  connectionType: 'wifi' | 'usb';\r\n}\r\n\r\n/**\r\n * USB device interface for serial-connected scoring devices\r\n */\r\nexport interface USBDevice {\r\n  id: string;\r\n  name: string;\r\n  type: 'omni' | 'vert' | 'generic';\r\n  capabilities: string[];\r\n  status: 'online' | 'offline' | 'connecting';\r\n  port: SerialPort | null;\r\n}\r\n\r\n/**\r\n * Discover wifi scoring devices on the local network\r\n */\r\nexport async function discoverNetworkDevices(): Promise<NetworkDevice[]> {\r\n  const devices: NetworkDevice[] = [];\r\n\r\n  try {\r\n    // Get local network info\r\n    const localIPs = await getLocalIPs();\r\n\r\n    for (const localIP of localIPs) {\r\n      // Scan common ports for dart scoring devices\r\n      const scanResults = await scanNetwork(localIP, [80, 8080, 8787, 8788, 3000, 5000]);\r\n\r\n      for (const result of scanResults) {\r\n        const device = await probeDevice(result.ip, result.port);\r\n        if (device) {\r\n          devices.push(device);\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Network discovery failed:', error);\r\n  }\r\n\r\n  return devices;\r\n}\r\n\r\n/**\r\n * Get local IP addresses\r\n */\r\nasync function getLocalIPs(): Promise<string[]> {\r\n  const ips: string[] = [];\r\n\r\n  try {\r\n    // Try to get local IPs via WebRTC\r\n    const pc = new RTCPeerConnection({ iceServers: [] });\r\n    pc.createDataChannel('');\r\n\r\n    const offer = await pc.createOffer();\r\n    await pc.setLocalDescription(offer);\r\n\r\n    return new Promise((resolve) => {\r\n      const timeout = setTimeout(() => {\r\n        pc.close();\r\n        resolve(ips);\r\n      }, 5000);\r\n\r\n      pc.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          const candidate = event.candidate.candidate;\r\n          const ipMatch = candidate.match(/(\\d+\\.\\d+\\.\\d+\\.\\d+)/);\r\n          if (ipMatch && ipMatch[1] && !ips.includes(ipMatch[1])) {\r\n            const ip = ipMatch[1];\r\n            // Only include private IPs\r\n            if (isPrivateIP(ip)) {\r\n              ips.push(ip);\r\n            }\r\n          }\r\n        } else {\r\n          clearTimeout(timeout);\r\n          pc.close();\r\n          resolve(ips);\r\n        }\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to get local IPs:', error);\r\n    return ['192.168.1.0']; // fallback\r\n  }\r\n}\r\n\r\n/**\r\n * Check if IP is in private range\r\n */\r\nfunction isPrivateIP(ip: string): boolean {\r\n  const parts = ip.split('.').map(Number);\r\n  return (\r\n    (parts[0] === 10) ||\r\n    (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) ||\r\n    (parts[0] === 192 && parts[1] === 168)\r\n  );\r\n}\r\n\r\n/**\r\n * Scan network for open ports\r\n */\r\nasync function scanNetwork(localIP: string, ports: number[]): Promise<{ip: string, port: number}[]> {\r\n  const results: {ip: string, port: number}[] = [];\r\n  const baseIP = localIP.split('.').slice(0, 3).join('.');\r\n\r\n  // Scan a reasonable range (e.g., .1 to .254)\r\n  const promises = [];\r\n  for (let i = 1; i <= 254; i++) {\r\n    const ip = `${baseIP}.${i}`;\r\n    for (const port of ports) {\r\n      promises.push(checkPort(ip, port));\r\n    }\r\n  }\r\n\r\n  const portResults = await Promise.allSettled(promises);\r\n\r\n  portResults.forEach((result, index) => {\r\n    if (result.status === 'fulfilled' && result.value) {\r\n      const portIndex = index % ports.length;\r\n      const ipIndex = Math.floor(index / ports.length);\r\n      const ip = `${baseIP}.${ipIndex + 1}`;\r\n      results.push({ ip, port: ports[portIndex] });\r\n    }\r\n  });\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Check if a specific port is open on an IP\r\n */\r\nasync function checkPort(ip: string, port: number): Promise<boolean> {\r\n  try {\r\n    const response = await fetch(`http://${ip}:${port}/`, {\r\n      method: 'HEAD',\r\n      mode: 'no-cors',\r\n      signal: AbortSignal.timeout(2000)\r\n    });\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Probe a device to identify its type and capabilities\r\n */\r\nasync function probeDevice(ip: string, port: number): Promise<NetworkDevice | null> {\r\n  try {\r\n    // Try common endpoints for dart scoring devices\r\n    const endpoints = [\r\n      '/',\r\n      '/api/info',\r\n      '/api/status',\r\n      '/camera',\r\n      '/stream'\r\n    ];\r\n\r\n    for (const endpoint of endpoints) {\r\n      try {\r\n        const response = await fetch(`http://${ip}:${port}${endpoint}`, {\r\n          method: 'GET',\r\n          signal: AbortSignal.timeout(3000)\r\n        });\r\n\r\n        if (response.ok) {\r\n          const contentType = response.headers.get('content-type') || '';\r\n          const text = await response.text();\r\n\r\n          // Check for OMNI device\r\n          if (text.includes('OMNI') || text.includes('omni') || endpoint.includes('omni')) {\r\n            return {\r\n              id: `omni-${ip}-${port}`,\r\n              name: `OMNI Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'omni',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n\r\n          // Check for VERT device\r\n          if (text.includes('VERT') || text.includes('vert') || endpoint.includes('vert')) {\r\n            return {\r\n              id: `vert-${ip}-${port}`,\r\n              name: `VERT Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'vert',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n\r\n          // Check for generic video streaming device\r\n          if (contentType.includes('video') || text.includes('stream') || endpoint === '/stream') {\r\n            return {\r\n              id: `generic-${ip}-${port}`,\r\n              name: `Network Camera (${ip})`,\r\n              ip,\r\n              port,\r\n              type: 'generic',\r\n              capabilities: ['video'],\r\n              status: 'online',\r\n              connectionType: 'wifi'\r\n            };\r\n          }\r\n        }\r\n      } catch {\r\n        // Continue to next endpoint\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(`Failed to probe device ${ip}:${port}:`, error);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Discover USB scoring devices connected via serial\r\n */\r\nexport async function discoverUSBDevices(): Promise<USBDevice[]> {\r\n  const devices: USBDevice[] = [];\r\n\r\n  try {\r\n    // Check if Web Serial API is supported\r\n    if (!('serial' in navigator)) {\r\n      console.warn('Web Serial API not supported in this browser');\r\n      return devices;\r\n    }\r\n\r\n    // Get already paired ports\r\n    const ports = await navigator.serial.getPorts();\r\n\r\n    for (const port of ports) {\r\n      const device = await probeUSBDevice(port);\r\n      if (device) {\r\n        devices.push(device);\r\n      }\r\n    }\r\n\r\n    // Also try to request a new port (this will show user selection dialog)\r\n    // Note: This is optional and will be handled separately in the UI\r\n  } catch (error) {\r\n    console.error('USB device discovery failed:', error);\r\n  }\r\n\r\n  return devices;\r\n}\r\n\r\n/**\r\n * Request user to select a USB device\r\n */\r\nexport async function requestUSBDevice(): Promise<USBDevice | null> {\r\n  try {\r\n    if (!('serial' in navigator)) {\r\n      alert('Web Serial API not supported in this browser. Please use a compatible browser like Chrome or Edge.');\r\n      return null;\r\n    }\r\n\r\n    const port = await navigator.serial.requestPort();\r\n    return await probeUSBDevice(port);\r\n  } catch (error) {\r\n    if ((error as any).name !== 'NotFoundError') {\r\n      console.error('USB device request failed:', error);\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Probe a USB serial port to identify the device type\r\n */\r\nasync function probeUSBDevice(port: SerialPort): Promise<USBDevice | null> {\r\n  try {\r\n    // Open the port with common settings for dart scoring devices\r\n    await port.open({ baudRate: 9600, dataBits: 8, stopBits: 1, parity: 'none' });\r\n\r\n    // Try to read some data to identify the device\r\n    const reader = port.readable?.getReader();\r\n    if (reader) {\r\n      try {\r\n        // Set a timeout for reading\r\n        const timeout = setTimeout(() => reader.cancel(), 2000);\r\n\r\n        const { value, done } = await reader.read();\r\n        clearTimeout(timeout);\r\n\r\n        if (!done && value) {\r\n          const text = new TextDecoder().decode(value);\r\n\r\n          // Check for OMNI device\r\n          if (text.includes('OMNI') || text.includes('omni')) {\r\n            reader.releaseLock();\r\n            return {\r\n              id: `usb-omni-${Date.now()}`,\r\n              name: 'OMNI Camera (USB)',\r\n              type: 'omni',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              port\r\n            };\r\n          }\r\n\r\n          // Check for VERT device\r\n          if (text.includes('VERT') || text.includes('vert')) {\r\n            reader.releaseLock();\r\n            return {\r\n              id: `usb-vert-${Date.now()}`,\r\n              name: 'VERT Camera (USB)',\r\n              type: 'vert',\r\n              capabilities: ['video', 'calibration'],\r\n              status: 'online',\r\n              port\r\n            };\r\n          }\r\n        }\r\n      } catch {\r\n        // Continue\r\n      } finally {\r\n        try { reader.releaseLock(); } catch {}\r\n      }\r\n    }\r\n\r\n    // If we can't identify, assume it's a generic device\r\n    return {\r\n      id: `usb-generic-${Date.now()}`,\r\n      name: 'USB Scoring Device',\r\n      type: 'generic',\r\n      capabilities: ['video'],\r\n      status: 'online',\r\n      port\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Failed to probe USB device:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Connect to a network device and get video stream\r\n */\r\nexport async function connectToNetworkDevice(device: NetworkDevice): Promise<MediaStream | null> {\r\n  try {\r\n    // For now, assume devices provide an MJPEG or HLS stream\r\n    // This would need to be adapted based on the actual device API\r\n    const streamUrl = `http://${device.ip}:${device.port}/stream`;\r\n\r\n    // Create a video element to capture the stream\r\n    const video = document.createElement('video');\r\n    video.src = streamUrl;\r\n    video.crossOrigin = 'anonymous';\r\n\r\n    return new Promise((resolve, reject) => {\r\n      video.onloadeddata = () => {\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d')!;\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n\r\n        // Create a MediaStream from the video\r\n        const stream = canvas.captureStream(30); // 30 FPS\r\n\r\n        const drawFrame = () => {\r\n          if (video.readyState >= 2) {\r\n            ctx.drawImage(video, 0, 0);\r\n          }\r\n          requestAnimationFrame(drawFrame);\r\n        };\r\n        drawFrame();\r\n\r\n        resolve(stream);\r\n      };\r\n\r\n      video.onerror = () => reject(new Error('Failed to load video stream'));\r\n      video.load();\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to connect to network device:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Connect to a USB device and get video stream\r\n */\r\nexport async function connectToUSBDevice(device: USBDevice): Promise<MediaStream | null> {\r\n  try {\r\n    if (!device.port) {\r\n      throw new Error('No serial port available');\r\n    }\r\n\r\n    // For USB devices, we assume they provide video through a companion app or driver\r\n    // This is a placeholder - actual implementation would depend on the device protocol\r\n    console.log('USB device connection not fully implemented yet');\r\n    return null;\r\n\r\n  } catch (error) {\r\n    console.error('Failed to connect to USB device:', error);\r\n    return null;\r\n  }\r\n}","import React, { useCallback, useEffect, useMemo, useRef, useState, type ReactNode } from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport DartLoader from './DartLoader'\r\n\r\nimport { makeQrDataUrlWithLogo } from '../utils/qr'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { useCameraSession } from '../store/cameraSession'\r\nimport { BoardRadii, canonicalRimTargets, computeHomographyDLT, drawCross, drawPolyline, rmsError, sampleRing, refinePointsSobel, applyHomography, imageToBoard, scoreAtBoardPoint, type Homography, type Point } from '../utils/vision'\r\nimport { detectMarkersFromCanvas, MARKER_ORDER, MARKER_TARGETS, markerIdToMatrix, type MarkerDetection } from '../utils/markerCalibration'\r\nimport { detectBoard, refineRingDetection, type BoardDetectionResult } from '../utils/boardDetection'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Phase = 'idle' | 'camera' | 'capture' | 'select' | 'computed'\r\ntype CamMode = 'local' | 'phone' | 'wifi'\r\n\r\n// Center-logo QR helpers moved to ../utils/qr\r\n\r\nexport default function Calibrator() {\r\n\tconst videoRef = useRef<HTMLVideoElement>(null)\r\n\tconst canvasRef = useRef<HTMLCanvasElement>(null)\r\n\tconst overlayRef = useRef<HTMLCanvasElement>(null)\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\t// Camera diagnostics state\r\n\tconst [cameraPerm, setCameraPerm] = useState<'unknown' | 'granted' | 'denied' | 'prompt' | 'unsupported'>('unknown')\r\n\tconst [videoDevices, setVideoDevices] = useState<Array<{ deviceId: string; label: string }>>([])\r\n\tconst [selectedDeviceId, setSelectedDeviceId] = useState<string | null>(null)\r\n\tconst [streaming, setStreaming] = useState(false)\r\n\tconst [videoPlayBlocked, setVideoPlayBlocked] = useState(false)\r\n\tconst [phase, setPhase] = useState<Phase>('camera')\r\n\t// Default to local or last-used mode, but allow user to freely change\r\n\tconst [mode, setMode] = useState<CamMode>(() => (localStorage.getItem('ndn:cal:mode') as CamMode) || 'local')\r\n\tconst [dstPoints, setDstPoints] = useState<Point[]>([]) // image points clicked in order TOP, RIGHT, BOTTOM, LEFT, CENTER (bullseye), OUTER_BULL_TOP\r\n\tconst [snapshotSet, setSnapshotSet] = useState(false)\r\n\t// Track current frame (video/snapshot) size to preserve aspect ratio in the preview container\r\n\tconst [frameSize, setFrameSize] = useState<{ w: number, h: number } | null>(null)\r\n\t// Zoom for pixel-perfect point picking (0.5x – 2.0x)\r\n\tconst [zoom, setZoom] = useState<number>(1)\r\n\tconst [mobileLandingOverride, setMobileLandingOverride] = useState<boolean>(() => {\r\n\t\tif (typeof window === 'undefined') return false\r\n\t\ttry {\r\n\t\t\treturn window.localStorage.getItem('ndn:cal:forceDesktop') === '1'\r\n\t\t} catch {\r\n\t\t\treturn false\r\n\t\t}\r\n\t})\r\n\tconst [isMobileDevice, setIsMobileDevice] = useState<boolean>(() => {\r\n\t\tif (typeof navigator === 'undefined') return false\r\n\t\treturn /Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)\r\n\t})\r\n\tconst { H, setCalibration, reset, errorPx, locked } = useCalibration()\r\n\tconst cameraSession = useCameraSession()\r\n\tconst { calibrationGuide, setCalibrationGuide, preferredCameraId, cameraEnabled, setCameraEnabled, preferredCameraLocked, setPreferredCameraLocked, setPreferredCamera } = useUserSettings()\r\n\t\t// Detected ring data (from auto-detect) in image pixels\r\n\tconst [detected, setDetected] = useState<null | {\r\n\t\tcx: number; cy: number;\r\n\t\tbullInner: number; bullOuter: number;\r\n\t\ttrebleInner: number; trebleOuter: number;\r\n\t\tdoubleInner: number; doubleOuter: number;\r\n\t}>(null)\r\n\t\t// Live detection and confidence state\r\n\t\tconst [liveDetect, setLiveDetect] = useState<boolean>(false)\r\n\t\tconst [confidence, setConfidence] = useState<number>(0)\r\n\tconst [markerResult, setMarkerResult] = useState<MarkerDetection | null>(null)\r\n\t// Verification results for UI: {label, expected, detected, match}\r\n\tconst [verificationResults, setVerificationResults] = useState<Array<{ label: string; expected: any; detected: any; match: boolean }>>([])\r\n\r\n\tconst createMarkerDataUrl = useCallback((id: number, size = 480) => {\r\n\t\tif (typeof document === 'undefined') throw new Error('Marker rendering only available in browser context')\r\n\t\tconst matrix = markerIdToMatrix(id)\r\n\t\tconst canvas = document.createElement('canvas')\r\n\t\tcanvas.width = size\r\n\t\tcanvas.height = size\r\n\t\tconst ctx = canvas.getContext('2d')\r\n\t\tif (!ctx) return ''\r\n\t\t// white background\r\n\t\tctx.fillStyle = '#ffffff'\r\n\t\tctx.fillRect(0, 0, size, size)\r\n\r\n\t\tconst rows = matrix.length\r\n\t\tconst cols = matrix[0]?.length || rows\r\n\t\tconst cellW = size / cols\r\n\t\tconst cellH = size / rows\r\n\r\n\t\tfor (let y = 0; y < rows; y++) {\r\n\t\t\tfor (let x = 0; x < cols; x++) {\r\n\t\t\t\tconst v = matrix[y][x]\r\n\t\t\t\tif (v) {\r\n\t\t\t\t\tctx.fillStyle = '#000000'\r\n\t\t\t\t\tctx.fillRect(Math.round(x * cellW), Math.round(y * cellH), Math.ceil(cellW), Math.ceil(cellH))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn canvas.toDataURL('image/png')\r\n\t}, [])\r\n\t\t// Pairing / phone-camera state (some of these were accidentally removed during edits)\r\n\t\tconst [pairCode, setPairCode] = useState<string | null>(null)\r\n\t\tconst pairCodeRef = useRef<string | null>(null)\r\n\t\tconst [ws, setWs] = useState<WebSocket | null>(null)\r\n\t\tconst pcRef = useRef<RTCPeerConnection | null>(null)\r\n\t\tconst pendingIceCandidatesRef = useRef<RTCIceCandidate[]>([])\r\n\t\tconst [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n\t\tconst [now, setNow] = useState<number>(Date.now())\r\n\t\tconst [paired, setPaired] = useState<boolean>(false)\r\n\r\n\t\tfunction updatePairCode(code: string | null) {\r\n\t\t\ttry {\r\n\t\t\t\tsetPairCode(code)\r\n\t\t\t\tpairCodeRef.current = code\r\n\t\t\t} catch {}\r\n\t\t}\r\n\tconst [qrDataUrl, setQrDataUrl] = useState<string>('')\r\n\tconst [lanHost, setLanHost] = useState<string | null>(null)\r\n\tconst [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n\tconst [showTips, setShowTips] = useState<boolean>(true)\r\n\tconst [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n\tconst [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n\tconst [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n\tconst copyTimeoutRef = useRef<number | null>(null)\r\n\t\r\n\t// Log streaming state changes for debugging\r\n\tuseEffect(() => {\r\n\t\tconsole.log('[Calibrator] 🔄 STREAMING STATE CHANGED:', { streaming, phase, videoRefExists: !!videoRef.current })\r\n\t}, [streaming, phase])\r\n\t\r\n\tuseEffect(() => {\r\n\t\tconst h = window.location.hostname\r\n\t\tif (h === 'localhost' || h === '127.0.0.1') {\r\n\t\t\tapiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n\t\t\t\tconst ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n\t\t\t\tif (ip) setLanHost(ip)\r\n\t\t\t}).catch(()=>{})\r\n\t\t}\r\n\t\t// Try to detect if server exposes HTTPS info\r\n\t\tapiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n\t\t\tif (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n\t\t}).catch(()=>{})\r\n\t}, [])\r\n\r\n\t// Remove automatic phone pairing on mode change; only pair on explicit user action\r\n\tconst mobileUrl = useMemo(() => {\r\n\t\tconst code = pairCode || '____'\r\n\t\t// Prefer configured WS host (Render) when available to build the correct server origin\r\n\t\tconst envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n\t\tif (envUrl && envUrl.length > 0) {\r\n\t\t\ttry {\r\n\t\t\t\tconst u = new URL(envUrl)\r\n\t\t\t\tconst isSecure = u.protocol === 'wss:'\r\n\t\t\t\tconst origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n\t\t\t\tconst base = origin.replace(/\\/?ws$/i, '')\r\n\t\t\t\treturn `${base}/mobile-cam.html?code=${code}`\r\n\t\t\t} catch {}\r\n\t\t}\r\n\t\t// Local dev fallback using detected LAN or current host\r\n\t\tconst host = (lanHost || window.location.hostname)\r\n\t\tconst useHttps = !!httpsInfo?.https\r\n\t\tconst port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n\t\tconst proto = useHttps ? 'https' : 'http'\r\n\t\treturn `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n\t}, [pairCode, lanHost, httpsInfo])\r\n\r\n\tconst mobileLandingLink = useMemo(() => {\r\n\t\tif (!mobileUrl) return null\r\n\t\ttry {\r\n\t\t\tconst url = new URL(mobileUrl)\r\n\t\t\turl.searchParams.delete('code')\r\n\t\t\treturn url.toString().replace(/\\?$/, '')\r\n\t\t} catch {\r\n\t\t\tif (typeof window !== 'undefined') {\r\n\t\t\t\tconst origin = window.location.origin.replace(/\\/$/, '')\r\n\t\t\t\treturn `${origin}/mobile-cam.html`\r\n\t\t\t}\r\n\t\t\treturn '/mobile-cam.html'\r\n\t\t}\r\n\t}, [mobileUrl])\r\n\r\n\tuseEffect(() => { localStorage.setItem('ndn:cal:mode', mode) }, [mode])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (typeof window === 'undefined') return\r\n\t\ttry {\r\n\t\t\tif (mobileLandingOverride) {\r\n\t\t\t\twindow.localStorage.setItem('ndn:cal:forceDesktop', '1')\r\n\t\t\t} else {\r\n\t\t\t\twindow.localStorage.removeItem('ndn:cal:forceDesktop')\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}, [mobileLandingOverride])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (typeof window === 'undefined') return\r\n\t\tconst coarseQuery = window.matchMedia('(pointer: coarse)')\r\n\t\tconst detect = () => {\r\n\t\t\tconst uaMobile = typeof navigator !== 'undefined' && /Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent)\r\n\t\t\tconst coarse = typeof coarseQuery.matches === 'boolean' ? coarseQuery.matches : false\r\n\t\t\tconst narrow = window.innerWidth <= 820\r\n\t\t\tsetIsMobileDevice(uaMobile || coarse || narrow)\r\n\t\t}\r\n\t\tdetect()\r\n\t\ttry {\r\n\t\t\tif (typeof coarseQuery.addEventListener === 'function') coarseQuery.addEventListener('change', detect)\r\n\t\t\telse if (typeof coarseQuery.addListener === 'function') coarseQuery.addListener(detect)\r\n\t\t} catch {}\r\n\t\twindow.addEventListener('resize', detect)\r\n\t\treturn () => {\r\n\t\t\ttry {\r\n\t\t\t\tif (typeof coarseQuery.removeEventListener === 'function') coarseQuery.removeEventListener('change', detect)\r\n\t\t\t\telse if (typeof coarseQuery.removeListener === 'function') coarseQuery.removeListener(detect)\r\n\t\t\t} catch {}\r\n\t\t\twindow.removeEventListener('resize', detect)\r\n\t\t}\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!pairCode) { setQrDataUrl(''); return }\r\n\t\t// Generate a crisp QR (H-level error correction) with centered logo and white mask\r\n\t\tconst logoPath = (import.meta as any).env?.VITE_QR_LOGO_URL || '/dart-thrower.svg'\r\n\t\tmakeQrDataUrlWithLogo(mobileUrl, {\r\n\t\t\twidth: 256,\r\n\t\t\tmargin: 2,\r\n\t\t\terrorCorrectionLevel: 'H',\r\n\t\t\tcolor: { dark: '#000000', light: '#ffffff' },\r\n\t\t\tlogo: { logoUrl: logoPath, logoScale: 0.2, mask: true, shape: 'circle' }\r\n\t\t}).then(setQrDataUrl).catch(() => setQrDataUrl(''))\r\n\t}, [mobileUrl, pairCode])\r\n\r\n\t// Detect camera permission status where supported\r\n\tuseEffect(() => {\r\n\t\tif (typeof navigator === 'undefined' || !(navigator as any).permissions) {\r\n\t\t\tsetCameraPerm('unsupported')\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet mounted = true\r\n\t\t;(async () => {\r\n\t\t\ttry {\r\n\t\t\t\tconst p = await (navigator as any).permissions.query({ name: 'camera' })\r\n\t\t\t\tif (!mounted) return\r\n\t\t\t\tsetCameraPerm(p.state || 'unknown')\r\n\t\t\t\tp.onchange = () => { if (mounted) setCameraPerm(p.state) }\r\n\t\t\t} catch (err) {\r\n\t\t\t\t// Some browsers don't support 'camera' permission query\r\n\t\t\t\tif (mounted) setCameraPerm('unknown')\r\n\t\t\t}\r\n\t\t})()\r\n\t\treturn () => { mounted = false }\r\n\t}, [])\r\n\r\n\tasync function refreshVideoDevices() {\r\n\t\tif (typeof navigator === 'undefined' || !navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) return\r\n\t\ttry {\r\n\t\t\tconst list = await navigator.mediaDevices.enumerateDevices()\r\n\t\t\tconst vids = list.filter(d => d.kind === 'videoinput').map(d => ({ deviceId: (d as any).deviceId, label: d.label || 'Camera' }))\r\n\t\t\tsetVideoDevices(vids)\r\n\t\t\tif (vids.length && !selectedDeviceId) setSelectedDeviceId(vids[0].deviceId)\r\n\t\t} catch (err) {\r\n\t\t\t// ignore\r\n\t\t}\r\n\t}\r\n\r\n\tasync function testCamera(deviceId?: string) {\r\n\t\tif (typeof navigator === 'undefined' || !navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n\t\t\talert('getUserMedia is not available in this browser')\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst constraints: any = { video: deviceId ? { deviceId: { exact: deviceId } } : { facingMode: 'environment' } }\r\n\t\tlet stream: MediaStream | null = null\r\n\t\ttry {\r\n\t\t\tstream = await navigator.mediaDevices.getUserMedia(constraints)\r\n\t\t\t// Immediately stop tracks to test access\r\n\t\t\tstream.getTracks().forEach(t => t.stop())\r\n\t\t\tsetCameraPerm('granted')\r\n\t\t\t// If a deviceId was provided, set it as the preferred camera so Start Camera will use it\r\n\t\t\ttry { if (deviceId && typeof setPreferredCamera === 'function') { setPreferredCamera(deviceId); } } catch {}\r\n\t\t\talert('Camera access granted — your webcam is available and set as preferred.')\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error('[Calibrator] testCamera failed', err)\r\n\t\t\tif (err && (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError')) {\r\n\t\t\t\tsetCameraPerm('denied')\r\n\t\t\t\talert('Camera permission denied. Please allow camera access in your browser settings and try again.')\r\n\t\t\t} else if (err && (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError')) {\r\n\t\t\t\talert('No camera devices found. Ensure your USB webcam is connected and not in use by another app.')\r\n\t\t\t} else {\r\n\t\t\t\talert('Unable to access the camera: ' + (err?.message || err))\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tif (stream) stream.getTracks().forEach(t => t.stop())\r\n\t\t}\r\n\t}\r\n\r\n\tfunction openBrowserSiteSettings() {\r\n\t\tif (typeof window === 'undefined') return\r\n\t\tconst ua = navigator.userAgent || ''\r\n\t\tlet url: string | null = null\r\n\t\tif (/Edg\\//.test(ua) || /Chrome\\//.test(ua) || /Chromium\\//.test(ua)) {\r\n\t\t\t// Chromium-based browsers: open camera content settings\r\n\t\t\turl = 'chrome://settings/content/camera'\r\n\t\t} else if (/Firefox\\//.test(ua)) {\r\n\t\t\turl = 'about:preferences#privacy'\r\n\t\t} else if (/Safari\\//.test(ua) && !/Chrome\\//.test(ua)) {\r\n\t\t\t// Safari has no direct site settings page we can open; show instructions instead\r\n\t\t\turl = null\r\n\t\t}\r\n\t\tif (url) {\r\n\t\t\tconst w = window.open(url, '_blank')\r\n\t\t\tif (!w) {\r\n\t\t\t\talert('Unable to open browser settings automatically. Please open your browser settings and search for \"Camera\" permissions for this site.')\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Fallback instructions\r\n\t\t\talert('Please open your browser settings and locate Site Settings → Camera (or Permissions) and allow camera access for this site. In Safari, use Preferences → Websites → Camera.')\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!expiresAt) return\r\n\t\tconst t = setInterval(() => setNow(Date.now()), 1000)\r\n\t\treturn () => clearInterval(t)\r\n\t}, [expiresAt])\r\n\tconst ttl = useMemo(() => expiresAt ? Math.max(0, Math.ceil((expiresAt - now)/1000)) : null, [expiresAt, now])\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tif (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n\t\t}\r\n\t}, [])\r\n\r\n\tconst copyValue = useCallback(async (value: string | null | undefined, type: 'link' | 'code') => {\r\n\t\tif (!value) return\r\n\t\ttry {\r\n\t\t\tif (navigator.clipboard && navigator.clipboard.writeText) {\r\n\t\t\t\tawait navigator.clipboard.writeText(value)\r\n\t\t\t} else {\r\n\t\t\t\tconst textarea = document.createElement('textarea')\r\n\t\t\t\ttextarea.value = value\r\n\t\t\t\ttextarea.style.position = 'fixed'\r\n\t\t\t\ttextarea.style.opacity = '0'\r\n\t\t\t\tdocument.body.appendChild(textarea)\r\n\t\t\t\ttextarea.focus()\r\n\t\t\t\ttextarea.select()\r\n\t\t\t\tdocument.execCommand('copy')\r\n\t\t\t\tdocument.body.removeChild(textarea)\r\n\t\t\t}\r\n\t\t\tsetCopyFeedback(type)\r\n\t\t\tif (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n\t\t\tcopyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n\t\t} catch (err) {\r\n\t\t\tconsole.warn('[Calibrator] Copy failed:', err)\r\n\t\t\tsetCopyFeedback(null)\r\n\t\t}\r\n\t}, [])\r\n\t// Removed automatic regeneration of code when ttl expires. Only regenerate on explicit user action.\r\n\r\n\t// NOTE: Removed automatic permission request on load - it was blocking camera access\r\n\t// Let startCamera() handle the permission request when user clicks \"Enable camera\"\r\n\t// This prevents the camera from being held by the permission test\r\n\r\n\t\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\t// DON'T call stopCamera() on unmount - we want phone camera to persist!\r\n\t\t\t// Just clean up local refs\r\n\t\t\t// The camera stream stays alive so user can see it in Online/Offline/Tournaments\r\n\t\t}\r\n\t}, [])\t// Remove automatic camera restart on preferredCameraId change to prevent flicker\r\n\r\n\t// Listen for reconnect requests from PhoneCameraOverlay\r\n\tuseEffect(() => {\r\n\t\tconst handleReconnectRequest = (event: any) => {\r\n\t\t\tconsole.log('[Calibrator] Received reconnect request from PhoneCameraOverlay')\r\n\t\t\t// If we're in phone mode and already paired, restart the pairing\r\n\t\t\tif (mode === 'phone' && paired) {\r\n\t\t\t\tstopCamera(false)\r\n\t\t\t\t// Give a moment for cleanup, then restart pairing\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tstartPhonePairing()\r\n\t\t\t\t}, 500)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('ndn:phone-camera-reconnect', handleReconnectRequest as EventListener)\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('ndn:phone-camera-reconnect', handleReconnectRequest as EventListener)\r\n\t\t}\r\n\t}, [mode, paired])\r\n\r\n\t// Sync video element to camera session so other components can access it\r\n\t// CRITICAL: Run whenever streaming state changes to keep videoRef synced\r\n\tuseEffect(() => {\r\n\t\tconsole.log('[Calibrator] 🔄 STREAMING CHANGED:', { streaming, videoRefAvailable: !!videoRef.current })\r\n\t\tif (videoRef.current) {\r\n\t\t\tconsole.log('[Calibrator] ✅ Syncing videoElementRef on streaming change')\r\n\t\t\tcameraSession.setVideoElementRef(videoRef.current)\r\n\t\t\t// Also capture media stream when available\r\n\t\t\tif (videoRef.current.srcObject instanceof MediaStream) {\r\n\t\t\t\tconsole.log('[Calibrator] ✅ Setting mediaStream from video element')\r\n\t\t\t\tcameraSession.setMediaStream(videoRef.current.srcObject)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.warn('[Calibrator] ⚠️ videoRef.current is null on streaming change!')\r\n\t\t}\r\n\t}, [streaming])\r\n\r\n\t// Also sync on mount to capture initial videoRef\r\n\tuseEffect(() => {\r\n\t\tconsole.log('[Calibrator] 🚀 MOUNT: Initial mount - syncing videoRef')\r\n\t\tconsole.log('[Calibrator] videoRef.current available:', !!videoRef.current)\r\n\t\tconsole.log('[Calibrator] videoRef.current type:', videoRef.current?.constructor?.name)\r\n\t\t\r\n\t\tif (videoRef.current) {\r\n\t\t\tconsole.log('[Calibrator] ✅ Setting videoElementRef on mount')\r\n\t\t\tconsole.log('[Calibrator] Video element:', {\r\n\t\t\t\ttagName: videoRef.current.tagName,\r\n\t\t\t\tsrcObject: !!videoRef.current.srcObject,\r\n\t\t\t\tvideoWidth: videoRef.current.videoWidth,\r\n\t\t\t\tvideoHeight: videoRef.current.videoHeight,\r\n\t\t\t})\r\n\t\t\tcameraSession.setVideoElementRef(videoRef.current)\r\n\t\t\tconsole.log('[Calibrator] ✅ videoElementRef set successfully')\r\n\t\t} else {\r\n\t\t\tconsole.error('[Calibrator] ❌ CRITICAL: videoRef.current is NULL at mount!')\r\n\t\t}\r\n\t\t// Do NOT clear the videoElementRef on unmount; we want the stream to persist globally\r\n\t\treturn () => { /* keep global video element ref for overlay */ }\r\n\t}, [])\r\n\r\n\tfunction ensureWS() {\r\n\t\t// Return existing WebSocket if it's open or connecting\r\n\t\tif (ws && (ws.readyState === WebSocket.OPEN || ws.readyState === WebSocket.CONNECTING)) {\r\n\t\t\tconsole.log('[Calibrator] ensureWS: Reusing existing WebSocket (state:', ws.readyState, ')')\r\n\t\t\treturn ws\r\n\t\t}\r\n\t\t// Prefer configured WS endpoint; normalize to include '/ws'. Fallback to same-origin '/ws'.\r\n\t\t\tconst envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n\t\t\tconst normalizedEnv = envUrl && envUrl.length > 0\r\n\t\t\t\t? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n\t\t\t\t: undefined\r\n\t\t\tconst proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n\t\t\tconst sameOrigin = `${proto}://${window.location.host}/ws`\r\n\t\t\tconst host = window.location.hostname\r\n\t\t\t// Production safeguard: if we are not on the Render backend host and no env URL is set,\r\n\t\t\t// prefer the known Render service as a fallback instead of Netlify same-origin.\r\n\t\t\tconst renderWS = `wss://ninedartnation.onrender.com/ws`\r\n\t\t\tconst url = normalizedEnv || (host.endsWith('onrender.com') ? sameOrigin : renderWS)\r\n\t\t\tconsole.log('[Calibrator] ensureWS: Creating new WebSocket to:', url)\r\n\t\t\tlet socket: WebSocket = new WebSocket(url)\r\n\t\t\r\n\t\t// Set up handlers BEFORE storing the socket to avoid race conditions\r\n\t\tsocket.onerror = (error) => {\r\n\t\t\tconsole.error('[Calibrator] WebSocket connection error:', error)\r\n\t\t\talert('Failed to connect to camera pairing service. Please check your internet connection and try again.')\r\n\t\t}\r\n\t\tsocket.onclose = (event) => {\r\n\t\t\tconsole.log('[Calibrator] WebSocket closed:', event.code, event.reason)\r\n\t\t\tif (pcRef.current) {\r\n\t\t\t\ttry { pcRef.current.close() } catch {}\r\n\t\t\t\tpcRef.current = null\r\n\t\t\t}\r\n\t\t\tupdatePairCode(null)\r\n\t\t\tsetExpiresAt(null)\r\n\t\t\tsetPaired(false)\r\n\t\t\t// Only show alert if it wasn't a clean close\r\n\t\t\tif (event.code !== 1000) {\r\n\t\t\t\talert('Camera pairing connection lost. Please try pairing again.')\r\n\t\t\t\t// Also revert to local mode on disconnect so user can restart camera\r\n\t\t\t\tif (mode === 'phone') setMode('local')\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Store socket BEFORE setting message handler to ensure it's available for message sending\r\n\t\tsetWs(socket)\r\n\t\treturn socket\r\n\t}\r\n\r\n\tasync function startPhonePairing() {\r\n\t\t// Do not reset paired/streaming/phase state here to keep UI static\r\n\t\t// Switch UI into phone pairing mode so the calibrator shows phone-specific hints\r\n\t\tsetMode('phone')\r\n\t\t// Stop any existing camera streams before switching to phone mode\r\n\t\t// This ensures clean transition and no resource conflicts\r\n\t\t// Use true for autoRevert since we're explicitly switching modes, but we already set mode above\r\n\t\tstopCamera(false)\r\n\t\t// Lock selection and ensure camera UI is enabled while pairing is active\r\n\t\tlockSelectionForPairing()\r\n\t\ttry { setCameraEnabled(true) } catch {}\r\n\t\tconst socket = ensureWS()\r\n\t\t// Send cam-create when socket is ready\r\n\t\tif (socket.readyState === WebSocket.OPEN) {\r\n\t\t\tconsole.log('[Calibrator] WebSocket open, sending cam-create')\r\n\t\t\tsocket.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t} else {\r\n\t\t\tconsole.log('[Calibrator] WebSocket connecting, will send cam-create on open')\r\n\t\t\tsocket.onopen = () => {\r\n\t\t\t\tconsole.log('[Calibrator] WebSocket now open, sending cam-create')\r\n\t\t\t\tsocket.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t\t}\r\n\t\t}\r\n\t\tsocket.onmessage = async (ev) => {\r\n\t\t\tconst data = JSON.parse(ev.data)\r\n\t\t\tif (data.type === 'cam-code') {\r\n\t\t\t\tupdatePairCode(data.code)\r\n\t\t\t\tif (data.expiresAt) setExpiresAt(data.expiresAt)\r\n\t\t\t} else if (data.type === 'cam-peer-joined') {\r\n\t\t\t\t// Ensure we have the latest pairing code even if messages arrive out of order\r\n\t\t\t\tif (!pairCodeRef.current && data.code) updatePairCode(data.code)\r\n\t\t\t\tsetPaired(true)\r\n\t\t\t\t// When a phone peer joins, proactively send current calibration (if locked)\r\n\t\t\t\tconst codeForSession = pairCodeRef.current || data.code || null\r\n\t\t\t\tif (codeForSession) pairCodeRef.current = codeForSession\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (locked && codeForSession) {\r\n\t\t\t\t\t\tconst imgSize = canvasRef.current ? { w: canvasRef.current.width, h: canvasRef.current.height } : null\r\n\t\t\t\t\t\tconst payload = { H, imageSize: imgSize, errorPx: (errorPx ?? null), createdAt: Date.now() }\r\n\t\t\t\t\t\tsocket.send(JSON.stringify({ type: 'cam-calibration', code: codeForSession, payload }))\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Sent calibration to joined phone for code', codeForSession)\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Failed to send calibration on peer join', e)\r\n\t\t\t\t}\r\n\t\t\t\tconst peer = new RTCPeerConnection({ \r\n\t\t\t\t\ticeServers: [{ urls: 'stun:stun.l.google.com:19302' }],\r\n\t\t\t\t\ticeCandidatePoolSize: 10\r\n\t\t\t\t})\r\n\t\t\t\tpcRef.current = peer\r\n\t\t\t\t\r\n\t\t\t\t// Add connection state monitoring\r\n\t\t\t\tpeer.onconnectionstatechange = () => {\r\n\t\t\t\t\tconsole.log('WebRTC connection state:', peer.connectionState)\r\n\t\t\t\t\tif (peer.connectionState === 'failed' || peer.connectionState === 'disconnected') {\r\n\t\t\t\t\t\tconsole.error('WebRTC connection failed')\r\n\t\t\t\t\t\talert('Camera connection lost. Please try pairing again.')\r\n\t\t\t\t\t\tstopCamera(false)\r\n\t\t\t\t\t} else if (peer.connectionState === 'connected') {\r\n\t\t\t\t\t\tconsole.log('WebRTC connection established')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tpeer.onicecandidate = (e) => {\r\n\t\t\t\t\tif (e.candidate && codeForSession) {\r\n\t\t\t\t\t\tsocket.send(JSON.stringify({ type: 'cam-ice', code: codeForSession, payload: e.candidate }))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\tpeer.ontrack = (ev) => {\r\n\t\t\t\tconsole.log('[Calibrator] WebRTC ontrack received:', ev.streams?.length, 'streams, track kind:', ev.track?.kind)\r\n\t\t\t\tif (videoRef.current) {\r\n\t\t\t\t\tconst inbound = ev.streams?.[0]\r\n\t\t\t\t\tif (inbound) {\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Assigning video stream (tracks:', inbound.getTracks().length, ') to video element')\r\n\t\t\t\t\t\t// Ensure video element is visible\r\n\t\t\t\t\t\tsetSnapshotSet(false)\r\n\t\t\t\t\t\t// Use setTimeout to ensure DOM updates before assigning stream\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tif (videoRef.current) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Setting srcObject and attempting play')\r\n\t\t\t\t\t\t\t\t\t\t// Clean up any existing stream before assigning new one\r\n\t\t\t\t\t\t\t\t\t\tif (videoRef.current.srcObject) {\r\n\t\t\t\t\t\t\t\t\t\t\tconst existingTracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n\t\t\t\t\t\t\t\t\t\t\texistingTracks.forEach(t => t.stop())\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.srcObject = inbound\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.muted = true // Ensure muted for autoplay policy\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.playsInline = true // Mobile/iOS support\r\n\t\t\t\t\t\t\t\t\t\tvideoRef.current.play().then(() => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Video playback started successfully')\r\n\t\t\t\t\t\t\t\t\t\t\t// Mark that we're streaming from the phone and transition to capture\r\n\t\t\t\t\t\t\t\t\t\t\tsetStreaming(true)\r\n\t\t\t\t\t\t\t\t\t\t\tsetPhase('capture')\r\n\t\t\t\t\t\t\t\t\t\t\t// Update camera session so other components can see the stream\r\n\t\t\t\t\t\t\t\t\t\t\tcameraSession.setStreaming(true)\r\n\t\t\t\t\t\t\t\t\t\t\tcameraSession.setMode('phone')\r\n\t\t\t\t\t\t\t\t\t\t\tcameraSession.setMediaStream(inbound)\r\n\t\t\t\t\t\t\t\t\t\t\t// Set user settings to reflect that the active camera is the phone\r\n\t\t\t\t\t\t\t\t\t\t\ttry { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (!preferredCameraLocked) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPreferredCameraLocked(true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\ttry { setCameraEnabled(true) } catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t// If an overlay prompt was shown earlier, hide it now\r\n\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(false)\r\n\t\t\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.error('[Calibrator] Video play failed:', err)\r\n\t\t\t\t\t\t\t\t\t\t\t// Show a friendly tap-to-play overlay so user can enable playback\r\n\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(true)\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn('[Calibrator] video play blocked — prompting user interaction')\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 100)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.error('[Calibrator] No inbound stream received in ontrack')\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('[Calibrator] Video element not available')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n\t\t\t\t\tawait peer.setLocalDescription(offer)\r\n\t\t\t\t\tconsole.log('[Calibrator] Sending cam-offer for code:', codeForSession)\r\n\t\t\t\t\tif (codeForSession) socket.send(JSON.stringify({ type: 'cam-offer', code: codeForSession, payload: offer }))\r\n\t\t\t\t\telse console.warn('[Calibrator] Missing pairing code when sending offer')\r\n\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error('Failed to create WebRTC offer:', err)\r\n\t\t\t\t\talert('Failed to establish camera connection. Please try again.')\r\n\t\t\t\t\tstopCamera(false)\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-answer') {\r\n\t\t\t\tconsole.log('[Calibrator] Received cam-answer')\r\n\t\t\t\tconst peer = pcRef.current\r\n\t\t\t\tif (peer) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait peer.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Remote description set (answer)')\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Process any pending ICE candidates that arrived before the answer\r\n\t\t\t\t\t\tconst pending = pendingIceCandidatesRef.current\r\n\t\t\t\t\t\tconsole.log(`[Calibrator] Processing ${pending.length} pending ICE candidates`)\r\n\t\t\t\t\t\tfor (const candidate of pending) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tawait peer.addIceCandidate(candidate)\r\n\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Queued ICE candidate added')\r\n\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\tconsole.error('Failed to add queued ICE candidate:', err)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpendingIceCandidatesRef.current = []\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.error('Failed to set remote description:', err)\r\n\t\t\t\t\t\talert('Camera pairing failed. Please try again.')\r\n\t\t\t\t\t\tstopCamera(false)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Received cam-answer but no peer connection exists')\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-ice') {\r\n\t\t\t\tconsole.log('[Calibrator] Received cam-ice')\r\n\t\t\t\tconst peer = pcRef.current\r\n\t\t\t\tif (peer) {\r\n\t\t\t\t\t// Only add ICE candidate if remote description is already set\r\n\t\t\t\t\t// Otherwise, queue it for later processing\r\n\t\t\t\t\tif (peer.remoteDescription) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tawait peer.addIceCandidate(data.payload)\r\n\t\t\t\t\t\t\tconsole.log('[Calibrator] ICE candidate added')\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tconsole.error('Failed to add ICE candidate:', err)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Remote description not set yet, queuing ICE candidate')\r\n\t\t\t\t\t\tpendingIceCandidatesRef.current.push(data.payload)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('[Calibrator] Received ICE candidate but no peer connection exists')\r\n\t\t\t\t}\r\n\t\t\t} else if (data.type === 'cam-error') {\r\n\t\t\t\tconsole.error('Camera pairing error:', data.code)\r\n\t\t\t\talert(data.code === 'EXPIRED' ? 'Code expired. Generate a new code.' : `Camera error: ${data.code || 'Unknown error'}`)\r\n\t\t\t\tstopCamera(false)\r\n\t\t\t} else if (data.type === 'cam-calibration') {\r\n\t\t\t\t// Desktop receives calibration from phone (via server) or phone receives from desktop\r\n\t\t\t\tconsole.log('[Calibrator] Received calibration from peer:', data.payload)\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (data.payload && data.payload.H && Array.isArray(data.payload.H)) {\r\n\t\t\t\t\t\t// Apply the received calibration\r\n\t\t\t\t\t\tsetCalibration({\r\n\t\t\t\t\t\t\tH: data.payload.H as Homography,\r\n\t\t\t\t\t\t\tcreatedAt: data.payload.createdAt || Date.now(),\r\n\t\t\t\t\t\t\terrorPx: data.payload.errorPx,\r\n\t\t\t\t\t\t\timageSize: data.payload.imageSize,\r\n\t\t\t\t\t\t\tlocked: true // Assume locked since peer sent it\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Applied received calibration')\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('[Calibrator] Failed to apply received calibration', e)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync function startWifiConnection() {\r\n\t\tsetDiscoveringWifi(true)\r\n\t\ttry {\r\n\t\t\tconst devices = await discoverNetworkDevices()\r\n\t\t\tsetWifiDevices(devices)\r\n\t\t\tif (devices.length === 0) {\r\n\t\t\t\talert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Wifi device discovery failed:', error)\r\n\t\t\talert('Failed to discover wifi devices. Please check your network connection.')\r\n\t\t} finally {\r\n\t\t\tsetDiscoveringWifi(false)\r\n\t\t}\r\n\t\tsetPhase('camera')\r\n\t}\r\n\r\n\tasync function connectToWifiDevice(device: NetworkDevice) {\r\n\t\ttry {\r\n\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\td.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n\t\t\t))\r\n\r\n\t\t\tconst stream = await connectToNetworkDevice(device)\r\n\t\t\tif (stream && videoRef.current) {\r\n\t\t\t\t// Clean up any existing stream before assigning new one\r\n\t\t\t\tif (videoRef.current.srcObject) {\r\n\t\t\t\t\tconst existingTracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n\t\t\t\t\texistingTracks.forEach(t => t.stop())\r\n\t\t\t\t}\r\n\t\t\t\tvideoRef.current.srcObject = stream\r\n\t\t\t\tawait videoRef.current.play()\r\n\t\t\t\tsetStreaming(true)\r\n\t\t\t\tsetPhase('capture')\r\n\t\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\t\td.id === device.id ? { ...d, status: 'online' as const } : d\r\n\t\t\t\t))\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Failed to get video stream')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to connect to wifi device:', error)\r\n\t\t\talert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n\t\t\tsetWifiDevices(devices => devices.map(d => \r\n\t\t\t\td.id === device.id ? { ...d, status: 'offline' as const } : d\r\n\t\t\t))\r\n\t\t}\r\n\t}\r\n\r\n\tasync function startCamera() {\r\n\t\tif (mode === 'phone') return startPhonePairing()\r\n\t\tif (mode === 'wifi') return startWifiConnection()\r\n\t\tconsole.log('[Calibrator] 🎬 START_CAMERA: mode=', mode, 'preferredCameraId=', preferredCameraId)\r\n\t\ttry {\r\n\t\t\tlet stream: MediaStream | null = null\r\n\t\t\t\r\n\t\t\t// Step 1: Try with preferred camera ID if available\r\n\t\t\tif (preferredCameraId) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconsole.log('[Calibrator] 📹 Attempt 1: Using preferred camera ID:', preferredCameraId)\r\n\t\t\t\t\tstream = await navigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\t\tvideo: { deviceId: { exact: preferredCameraId } },\r\n\t\t\t\t\t\taudio: false\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log('[Calibrator] ✅ SUCCESS with preferred camera:', stream.getTracks().length, 'tracks')\r\n\t\t\t\t} catch (err: any) {\r\n\t\t\t\t\tconsole.warn('[Calibrator] ⚠️ Preferred camera failed:', err?.name, err?.message)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Step 2: If preferred didn't work, try any camera\r\n\t\t\tif (!stream) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconsole.log('[Calibrator] 📹 Attempt 2: Using ANY available camera')\r\n\t\t\t\t\tstream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n\t\t\t\t\tconsole.log('[Calibrator] ✅ SUCCESS with fallback camera:', stream.getTracks().length, 'tracks')\r\n\t\t\t\t} catch (err: any) {\r\n\t\t\t\t\tconsole.error('[Calibrator] ❌ BOTH attempts failed:', err?.name, err?.message)\r\n\t\t\t\t\tthrow err\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Step 3: Assign to video element\r\n\t\t\tif (!stream) {\r\n\t\t\t\tthrow new Error('No stream obtained')\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!videoRef.current) {\r\n\t\t\t\tthrow new Error('Video element ref is null')\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.log('[Calibrator] 📺 Assigning stream to video element')\r\n\t\t\tvideoRef.current.srcObject = stream\r\n\t\t\t\r\n\t\t\tconsole.log('[Calibrator] ▶️ Calling play()')\r\n\t\t\ttry {\r\n\t\t\t\tawait videoRef.current.play()\r\n\t\t\t\tconsole.log('[Calibrator] ✅ Play succeeded')\r\n\t\t\t} catch (playErr: any) {\r\n\t\t\t\tconsole.warn('[Calibrator] ⚠️ Play failed, retrying in 100ms:', playErr?.message)\r\n\t\t\t\tawait new Promise(r => setTimeout(r, 100))\r\n\t\t\t\tawait videoRef.current.play()\r\n\t\t\t\tconsole.log('[Calibrator] ✅ Play succeeded on retry')\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.log('[Calibrator] 🟢 Setting streaming = true')\r\n\t\t\tsetStreaming(true)\r\n\t\t\tsetPhase('capture')\r\n\t\t\tconsole.log('[Calibrator] 🟢 State updated')\r\n\t\t} catch (e: any) {\r\n\t\t\tconsole.error('[Calibrator] 🔴 FATAL:', e?.message || e)\r\n\t\t\talert(`Camera failed: ${e?.message || 'Unknown error'}`)\r\n\t\t\t// Clean up any partial stream\r\n\t\t\tif (videoRef.current?.srcObject) {\r\n\t\t\t\t(videoRef.current.srcObject as MediaStream).getTracks().forEach(t => t.stop())\r\n\t\t\t\tvideoRef.current.srcObject = null\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stopCamera(autoRevert: boolean = false) {\r\n\t\tif (videoRef.current && videoRef.current.srcObject) {\r\n\t\t\tconst tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n\t\t\ttracks.forEach(t => t.stop())\r\n\t\t\tvideoRef.current.srcObject = null\r\n\t\t\tsetStreaming(false)\r\n\t\t}\r\n\t\tif (pcRef.current) { try { pcRef.current.close() } catch {}; pcRef.current = null }\r\n\t\tpendingIceCandidatesRef.current = []\r\n\t\tupdatePairCode(null)\r\n\t\tsetExpiresAt(null)\r\n\t\tsetPaired(false)\r\n\t\tsetMarkerResult(null)\r\n\t\t// Clear camera session when stopping camera\r\n\t\tcameraSession.setStreaming(false)\r\n\t\tcameraSession.setMediaStream(null)\r\n\t    // Only revert to local mode if EXPLICITLY requested (user clicked Stop button)\r\n\t    // Otherwise preserve the selected mode so user can go to OfflinePlay and come back\r\n\t    if (autoRevert && (mode === 'phone' || mode === 'wifi')) {\r\n\t    \tsetMode('local')\r\n\t    }\r\n\t}\r\n\r\n\tfunction regenerateCode() {\r\n\t\t// Only regenerate code, do not reset UI or camera state\r\n\t\tif (ws && ws.readyState === WebSocket.OPEN) {\r\n\t\t\tws.send(JSON.stringify({ type: 'cam-create' }))\r\n\t\t} else {\r\n\t\t\tstartPhonePairing()\r\n\t\t}\r\n\t\t// Lock the preferred camera selection while pairing is active so it doesn't\r\n\t\t// flip automatically during the pairing flow.\r\n\t\tlockSelectionForPairing()\r\n\t}\r\n\r\n\t// When user regenerates a pairing code we lock the preferred camera selection so\r\n\t// it won't be changed accidentally by other parts of the UI while pairing is active.\r\n\t// This implements the user's request that the camera selection 'stay static' after\r\n\t// generating a code. The lock can be toggled by the user in the DevicePicker UI.\r\n\tfunction lockSelectionForPairing() {\r\n\t\ttry {\r\n\t\t\tif (!preferredCameraLocked) {\r\n\t\t\t\tsetPreferredCameraLocked(true)\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}\r\n\r\n\t// Allow uploading a photo instead of using a live camera\r\n\tfunction triggerUpload() {\r\n\t\ttry { fileInputRef.current?.click() } catch {}\r\n\t}\r\n\r\n\tfunction openMarkerSheet() {\r\n\t\t// Open the marker sheet page in a new tab for printing\r\n\t\tconst markerSheetUrl = `${window.location.origin}/marker-sheet.html`\r\n\t\twindow.open(markerSheetUrl, '_blank')\r\n\t}\r\n\r\n\tfunction onUploadPhotoChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n\t\tconst f = e.target.files?.[0]\r\n\t\tif (!f) return\r\n\t\tconst img = new Image()\r\n\t\timg.onload = () => {\r\n\t\t\ttry {\r\n\t\t\t\tif (!canvasRef.current) return\r\n\t\t\t\tconst c = canvasRef.current\r\n\t\t\t\tc.width = img.naturalWidth\r\n\t\t\t\tc.height = img.naturalHeight\r\n\t\t\t\tconst ctx = c.getContext('2d')!\r\n\t\t\t\tctx.drawImage(img, 0, 0, c.width, c.height)\r\n\t\t\t\tsetSnapshotSet(true)\r\n\t\t\t\tsetFrameSize({ w: c.width, h: c.height })\r\n\t\t\t\tsetPhase('select')\r\n\t\t\t\tsetDstPoints([])\r\n\t\t\t\tsetMarkerResult(null)\r\n\t\t\t\t// Clear any previous video stream\r\n\t\t\t\tstopCamera(false)\r\n\t\t\t} catch {}\r\n\t\t}\r\n\t\timg.onerror = () => { alert('Could not load image. Please try a different photo.') }\r\n\t\timg.src = URL.createObjectURL(f)\r\n\t\t// reset input value so the same file can be reselected\r\n\t\ttry { e.target.value = '' } catch {}\r\n\t}\r\n\r\n\t\tfunction captureFrame() {\r\n\t\tif (!videoRef.current || !canvasRef.current) return\r\n\t\tconst v = videoRef.current\r\n\t\tconst c = canvasRef.current\r\n\t\tc.width = v.videoWidth\r\n\t\tc.height = v.videoHeight\r\n\t\tconst ctx = c.getContext('2d')!\r\n\t\tctx.drawImage(v, 0, 0, c.width, c.height)\r\n\t\tsetSnapshotSet(true)\r\n\t\tsetFrameSize({ w: c.width, h: c.height })\r\n\t\tsetPhase('select')\r\n\t\tsetDstPoints([])\r\n\t\tsetMarkerResult(null)\r\n\t\t\t// If liveDetect is on, kick a detect on this captured frame\r\n\t\t\tif (liveDetect) setTimeout(() => { autoDetectRings() }, 0)\r\n\t}\r\n\r\n\tfunction drawOverlay(currentPoints = dstPoints, HH: Homography | null = null) {\r\n\t\tif (!canvasRef.current || !overlayRef.current) return\r\n\t\tconst img = canvasRef.current\r\n\t\tconst o = overlayRef.current\r\n\t\to.width = img.width; o.height = img.height\r\n\t\tconst ctx = o.getContext('2d')!\r\n\t\tctx.clearRect(0, 0, o.width, o.height)\r\n\r\n\t\t// If we have a homography, draw rings (precise, perspective-correct)\r\n\t\tconst Huse = HH || H\r\n\t\tif (Huse) {\r\n\t\t\tconst rings = [BoardRadii.bullInner, BoardRadii.bullOuter, BoardRadii.trebleInner, BoardRadii.trebleOuter, BoardRadii.doubleInner, BoardRadii.doubleOuter]\r\n\t\t\tfor (const r of rings) {\r\n\t\t\t\t// Use green for all rings when calibration is locked/perfect\r\n\t\t\t\tconst ringColor = locked ? '#10b981' : (r === BoardRadii.doubleOuter ? '#22d3ee' : '#a78bfa')\r\n\t\t\t\tconst ringWidth = locked ? 3 : (r === BoardRadii.doubleOuter ? 3 : 2)\r\n\t\t\t\tconst poly = sampleRing(Huse, r, 360)\r\n\t\t\t\tdrawPolyline(ctx, poly, ringColor, ringWidth)\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Otherwise, if we have detected circles, draw them as previews (circles in image space)\r\n\t\tif (!Huse && detected) {\r\n\t\t\tconst drawCircle = (r: number, color: string, w = 2) => {\r\n\t\t\t\tctx.save(); ctx.strokeStyle = color; ctx.lineWidth = w\r\n\t\t\t\tctx.beginPath(); ctx.arc(detected.cx, detected.cy, r, 0, Math.PI * 2); ctx.stroke(); ctx.restore()\r\n\t\t\t}\r\n\t\t\tdrawCircle(detected.doubleOuter, '#22d3ee', 3)\r\n\t\t\tdrawCircle(detected.doubleInner, '#22d3ee', 2)\r\n\t\t\tdrawCircle(detected.trebleOuter, '#fde047', 2)\r\n\t\t\tdrawCircle(detected.trebleInner, '#fde047', 2)\r\n\t\t\tdrawCircle(detected.bullOuter, '#34d399', 2)\r\n\t\t\tdrawCircle(detected.bullInner, '#10b981', 3)\r\n\t\t}\r\n\r\n\t\t// Show calibration guide circles when < 6 points and homography exists\r\n\t\tif (currentPoints.length < 6 && Huse) {\r\n\t\t\tctx.save()\r\n\t\t\tctx.strokeStyle = 'rgba(255,193,7,0.4)'\r\n\t\t\tctx.lineWidth = 2\r\n\t\t\tctx.setLineDash([4,4])\r\n\t\t\t// Show the 6 expected click positions\r\n\t\t\tconst targets = canonicalRimTargets()\r\n\t\t\tfor (let i = currentPoints.length; i < 6 && i < targets.length; i++) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst p = applyHomography(Huse, targets[i])\r\n\t\t\t\t\tctx.beginPath()\r\n\t\t\t\t\tctx.arc(p.x, p.y, 12, 0, Math.PI * 2)\r\n\t\t\t\t\tctx.stroke()\r\n\t\t\t\t} catch {}\r\n\t\t\t}\r\n\t\t\tctx.restore()\r\n\t\t}\r\n\r\n\t\t// Draw clicked points (with order labels to guide TOP, RIGHT, BOTTOM, LEFT, CENTER, BULL_TOP)\r\n\t\tcurrentPoints.forEach((p, i) => {\r\n\t\t\tdrawCross(ctx, p, '#f472b6')\r\n\t\t\tctx.save()\r\n\t\t\tctx.fillStyle = '#f472b6'\r\n\t\t\tctx.font = '14px sans-serif'\r\n\t\t\tctx.fillText(String(i + 1), p.x + 6, p.y - 6)\r\n\t\t\tctx.restore()\r\n\t\t})\r\n\r\n\t\t// Preferred-view framing guide (if enabled and not yet calibrated)\r\n\t\tif (calibrationGuide && !locked) {\r\n\t\t\tctx.save()\r\n\t\t\t// Semi-transparent vignette to encourage centered, face-on framing\r\n\t\t\tctx.fillStyle = 'rgba(59,130,246,0.10)'\r\n\t\t\tconst pad = Math.round(Math.min(o.width, o.height) * 0.08)\r\n\t\t\tconst w = o.width - pad*2\r\n\t\t\tconst h = o.height - pad*2\r\n\t\t\tctx.fillRect(pad, pad, w, h)\r\n\t\t\t// Horizon/tilt line and vertical center line\r\n\t\t\tctx.strokeStyle = 'rgba(34,197,94,0.9)'\r\n\t\t\tctx.lineWidth = 2\r\n\t\t\t// Horizontal line roughly through bull height\r\n\t\t\tctx.beginPath(); ctx.moveTo(pad, o.height/2); ctx.lineTo(o.width-pad, o.height/2); ctx.stroke()\r\n\t\t\t// Vertical center\r\n\t\t\tctx.beginPath(); ctx.moveTo(o.width/2, pad); ctx.lineTo(o.width/2, o.height-pad); ctx.stroke()\r\n\t\t\t// Angle brackets to suggest slight top-down 10–15°\r\n\t\t\tctx.strokeStyle = 'rgba(234,179,8,0.9)'\r\n\t\t\tctx.setLineDash([6,4])\r\n\t\t\tconst ax = pad + 30, ay = pad + 30\r\n\t\t\tctx.beginPath(); ctx.moveTo(ax, ay+30); ctx.lineTo(ax+60, ay); ctx.stroke()\r\n\t\t\tctx.beginPath(); ctx.moveTo(o.width-ax, ay+30); ctx.lineTo(o.width-ax-60, ay); ctx.stroke()\r\n\t\t\tctx.restore()\r\n\t\t\t// Legend - draw at fixed size regardless of zoom\r\n\t\t\tctx.save()\r\n\t\t\tctx.scale(1/zoom, 1/zoom) // Inverse scale to keep text static\r\n\t\t\tctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n\t\t\tctx.font = '12px sans-serif'\r\n\t\t\tctx.fillText('Tip: Frame board centered, edges parallel; slight top-down is okay. Keep bull near center.', pad * zoom, (pad + 18) * zoom)\r\n\t\t\tctx.restore()\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClickOverlay(e: React.MouseEvent<HTMLCanvasElement>) {\r\n\t\tif (phase !== 'select') return\r\n\t\tconst el = (e.target as HTMLCanvasElement)\r\n\t\tconst rect = el.getBoundingClientRect()\r\n\t\tconst cssX = e.clientX - rect.left\r\n\t\tconst cssY = e.clientY - rect.top\r\n\t\t// Map CSS coordinates back to the overlay canvas pixel coordinates, accounting for CSS scaling and zoom\r\n\t\tconst scaleX = el.width > 0 ? (el.width / rect.width) : 1\r\n\t\tconst scaleY = el.height > 0 ? (el.height / rect.height) : 1\r\n\t\tconst x = cssX * scaleX\r\n\t\tconst y = cssY * scaleY\r\n\t\tconst pts = [...dstPoints, { x, y }]\r\n\t\tif (pts.length <= 6) {\r\n\t\t\tsetDstPoints(pts)\r\n\t\t\tdrawOverlay(pts)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction undoPoint() {\r\n\t\tconst pts = dstPoints.slice(0, -1)\r\n\t\tsetDstPoints(pts)\r\n\t\tdrawOverlay(pts)\r\n\t}\r\n\r\n\t\tfunction refinePoints() {\r\n\t\t\tif (!canvasRef.current || dstPoints.length === 0) return\r\n\t\t\tconst refined = refinePointsSobel(canvasRef.current, dstPoints, 8)\r\n\t\t\tsetDstPoints(refined)\r\n\t\t\tdrawOverlay(refined)\r\n\t\t}\r\n\r\n\tfunction compute() {\r\n\t\tif (!canvasRef.current) return\r\n\t\tif (dstPoints.length < 5) return alert('Please click all 5 calibration points: the 4 corners of the double ring plus the CENTER of the bull.')\r\n\t\tconst src = canonicalRimTargets() // board space mm\r\n\t\tconst Hcalc = computeHomographyDLT(src, dstPoints)\r\n\t\tdrawOverlay(dstPoints, Hcalc)\r\n\t\tconst err = rmsError(Hcalc, src, dstPoints)\r\n\t\tsetCalibration({ H: Hcalc as Homography, createdAt: Date.now(), errorPx: err, imageSize: { w: canvasRef.current.width, h: canvasRef.current.height }, anchors: { src, dst: dstPoints } })\r\n\t\tsetPhase('computed')\r\n\t}\r\n\r\n\t\tfunction runVerification() {\r\n\t\t\tif (!H || !overlayRef.current) return alert('Please compute calibration first (lock) before running verification.')\r\n\t\t\ttry {\r\n\t\t\t\t// Prepare a set of canonical board test points (in mm)\r\n\t\t\t\tconst tests: Array<{ label: string; p: { x: number; y: number } }> = [\r\n\t\t\t\t\t{ label: 'Bull (50)', p: { x: 0, y: 0 } },\r\n\t\t\t\t\t{ label: 'Outer Bull (25)', p: { x: 0, y: -BoardRadii.bullOuter } },\r\n\t\t\t\t\t{ label: 'Triple 20', p: { x: 0, y: -((BoardRadii.trebleInner + BoardRadii.trebleOuter) / 2) } },\r\n\t\t\t\t\t{ label: 'Single 5 (near 5 sector)', p: { x: (BoardRadii.trebleInner + BoardRadii.trebleOuter) / 2 * Math.cos(Math.PI * 0.1), y: (BoardRadii.trebleInner + BoardRadii.trebleOuter) / 2 * Math.sin(Math.PI * 0.1) } },\r\n\t\t\t\t]\r\n\t\t\t\tconst ctx = overlayRef.current.getContext('2d')!\r\n\t\t\t\t// Redraw base overlay so markers are visible\r\n\t\t\t\tdrawOverlay(dstPoints, H)\r\n\t\t\t\tconst results: Array<any> = []\r\n\t\t\t\tfor (const t of tests) {\r\n\t\t\t\t\tconst imgP = applyHomography(H as any, { x: t.p.x, y: t.p.y })\r\n\t\t\t\t\tconst detectedBoard = imageToBoard(H as any, imgP)\r\n\t\t\t\t\tconst detected = scoreAtBoardPoint(detectedBoard)\r\n\t\t\t\t\tconst expected = scoreAtBoardPoint(t.p)\r\n\t\t\t\t\tconst match = (expected.base === detected.base && expected.mult === detected.mult) || (expected.base === detected.base)\r\n\t\t\t\t\tresults.push({ label: t.label, expected, detected, match })\r\n\t\t\t\t\t// draw marker\r\n\t\t\t\t\tdrawCross(ctx, imgP, match ? '#10b981' : '#ef4444')\r\n\t\t\t\t\tctx.fillStyle = match ? '#10b981' : '#ef4444'\r\n\t\t\t\t\tctx.font = '12px sans-serif'\r\n\t\t\t\t\tctx.fillText(t.label, imgP.x + 6, imgP.y - 6)\r\n\t\t\t\t}\r\n\t\t\t\tsetVerificationResults(results)\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('Verification failed', err)\r\n\t\t\t\talert('Verification failed: ' + (err as any)?.message)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\tfunction resetAll() {\r\n\t\tsetDstPoints([])\r\n\t\tsetSnapshotSet(false)\r\n\t\tsetPhase('camera')\r\n\t\tdrawOverlay([])\r\n\t\tsetMarkerResult(null)\r\n\t\treset()\r\n\t}\r\n\r\n\t// --- Auto-detect the double rim from the current snapshot and compute homography ---\r\n\t\tasync function autoDetectRings() {\r\n\t\tif (!canvasRef.current) return alert('Load a photo or capture a frame first.')\r\n\t\tsetMarkerResult(null)\r\n\t\tconst src = canvasRef.current\r\n\t\t// Downscale for speed\r\n\t\tconst maxW = 800\r\n\t\tconst scale = Math.min(1, maxW / src.width)\r\n\t\tconst dw = Math.max(1, Math.round(src.width * scale))\r\n\t\tconst dh = Math.max(1, Math.round(src.height * scale))\r\n\t\tconst tmp = document.createElement('canvas')\r\n\t\ttmp.width = dw; tmp.height = dh\r\n\t\tconst tctx = tmp.getContext('2d')!\r\n\t\ttctx.drawImage(src, 0, 0, dw, dh)\r\n\t\tconst img = tctx.getImageData(0, 0, dw, dh)\r\n\t\t// Grayscale + Sobel edge magnitude\r\n\t\tconst gray = new Float32Array(dw * dh)\r\n\t\tfor (let i = 0, p = 0; i < img.data.length; i += 4, p++) {\r\n\t\t\tconst r = img.data[i], g = img.data[i+1], b = img.data[i+2]\r\n\t\t\tgray[p] = 0.299*r + 0.587*g + 0.114*b\r\n\t\t}\r\n\t\tconst gx = new Float32Array(dw * dh)\r\n\t\tconst gy = new Float32Array(dw * dh)\r\n\t\tfor (let y = 1; y < dh-1; y++) {\r\n\t\t\tfor (let x = 1; x < dw-1; x++) {\r\n\t\t\t\tconst i = y*dw + x\r\n\t\t\t\tconst a = gray[i - dw - 1], b = gray[i - dw], c = gray[i - dw + 1]\r\n\t\t\t\tconst d0 = gray[i - 1],        /*e*/       f0 = gray[i + 1]\r\n\t\t\t\tconst g0 = gray[i + dw - 1], h0 = gray[i + dw], j0 = gray[i + dw + 1]\r\n\t\t\t\tgx[i] = (-a - 2*d0 - g0) + (c + 2*f0 + j0)\r\n\t\t\t\tgy[i] = (-a - 2*b - c) + (g0 + 2*h0 + j0)\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst mag = new Float32Array(dw * dh)\r\n\t\tlet maxMag = 1\r\n\t\tfor (let i = 0; i < mag.length; i++) { const m = Math.hypot(gx[i], gy[i]); mag[i] = m; if (m > maxMag) maxMag = m }\r\n\t\t// Coarse circle search around center for double outer\r\n\t\tconst cx0 = Math.floor(dw/2), cy0 = Math.floor(dh/2)\r\n\t\tconst rMin = Math.floor(Math.min(dw, dh) * 0.35)\r\n\t\tconst rMax = Math.floor(Math.min(dw, dh) * 0.52)\r\n\t\tlet best = { score: -1, cx: cx0, cy: cy0, r: Math.floor((rMin + rMax)/2) }\r\n\t\tconst stepC = Math.max(2, Math.floor(Math.min(dw, dh) * 0.01)) // center step\r\n\t\tconst stepR = Math.max(2, Math.floor(Math.min(dw, dh) * 0.01)) // radius step\r\n\t\tfor (let cy = cy0 - Math.floor(dh*0.08); cy <= cy0 + Math.floor(dh*0.08); cy += stepC) {\r\n\t\t\tfor (let cx = cx0 - Math.floor(dw*0.08); cx <= cx0 + Math.floor(dw*0.08); cx += stepC) {\r\n\t\t\t\tfor (let r = rMin; r <= rMax; r += stepR) {\r\n\t\t\t\t\tlet s = 0\r\n\t\t\t\t\tconst samples = 360\r\n\t\t\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\t\t\tconst ang = (a * Math.PI) / 180\r\n\t\t\t\t\t\tconst x = Math.round(cx + r * Math.cos(ang))\r\n\t\t\t\t\t\tconst y = Math.round(cy + r * Math.sin(ang))\r\n\t\t\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (s > best.score) best = { score: s, cx, cy, r }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Map back to original canvas coords\r\n\t\tconst inv = 1/scale\r\n\t\tconst OCX = best.cx * inv\r\n\t\tconst OCY = best.cy * inv\r\n\t\tconst OR  = best.r  * inv\r\n\t\t// With center/doubleOuter radius fixed, locate other rings via 1D radial search\r\n\t\tfunction radialScore(rPx: number) {\r\n\t\t\tlet s = 0\r\n\t\t\tconst rScaled = rPx * scale\r\n\t\t\tconst samples = 360\r\n\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\tconst ang = (a * Math.PI) / 180\r\n\t\t\t\tconst x = Math.round(best.cx + rScaled * Math.cos(ang))\r\n\t\t\t\tconst y = Math.round(best.cy + rScaled * Math.sin(ang))\r\n\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t}\r\n\t\t\treturn s\r\n\t\t}\r\n\t\tconst ratios = {\r\n\t\t\tbullInner: BoardRadii.bullInner / BoardRadii.doubleOuter,\r\n\t\t\tbullOuter: BoardRadii.bullOuter / BoardRadii.doubleOuter,\r\n\t\t\ttrebleInner: BoardRadii.trebleInner / BoardRadii.doubleOuter,\r\n\t\t\ttrebleOuter: BoardRadii.trebleOuter / BoardRadii.doubleOuter,\r\n\t\t\tdoubleInner: BoardRadii.doubleInner / BoardRadii.doubleOuter,\r\n\t\t\tdoubleOuter: 1,\r\n\t\t} as const\r\n\t\tfunction refineAround(expectedR: number, pctWindow = 0.08) { // Reduced window for more precision\r\n\t\t\tconst lo = Math.max(1, Math.floor(expectedR * (1 - pctWindow)))\r\n\t\t\tconst hi = Math.max(lo+1, Math.floor(expectedR * (1 + pctWindow)))\r\n\t\t\tlet bestR = lo, bestS = -1\r\n\t\t\tfor (let r = lo; r <= hi; r++) {\r\n\t\t\t\tconst s = radialScore(r)\r\n\t\t\t\tif (s > bestS) { bestS = s; bestR = r }\r\n\t\t\t}\r\n\t\t\treturn bestR\r\n\t\t}\r\n\t\tconst dOuter = OR\r\n\t\tconst dInner = refineAround(dOuter * ratios.doubleInner)\r\n\t\tconst tOuter = refineAround(dOuter * ratios.trebleOuter)\r\n\t\tconst tInner = refineAround(dOuter * ratios.trebleInner)\r\n\t\tconst bOuter = refineAround(dOuter * ratios.bullOuter)\r\n\t\tconst bInner = refineAround(dOuter * ratios.bullInner)\r\n\t\t\tsetDetected({ cx: OCX, cy: OCY, bullInner: bInner, bullOuter: bOuter, trebleInner: tInner, trebleOuter: tOuter, doubleInner: dInner, doubleOuter: dOuter })\r\n\t\t\t// Estimate confidence: ratio of ring scores around expected vs local baseline\r\n\t\t\t// Use normalized edge magnitude at found radii to compute a 0-1 score, then scale to percent\r\n\t\t\tconst totalEdge = (r: number) => {\r\n\t\t\t\tconst samples = 180\r\n\t\t\t\tlet s = 0\r\n\t\t\t\tfor (let a = 0; a < samples; a++) {\r\n\t\t\t\t\tconst ang = (a * Math.PI) / 90\r\n\t\t\t\t\tconst x = Math.round(best.cx + (r*scale) * Math.cos(ang))\r\n\t\t\t\t\tconst y = Math.round(best.cy + (r*scale) * Math.sin(ang))\r\n\t\t\t\t\tif (x <= 0 || x >= dw-1 || y <= 0 || y >= dh-1) continue\r\n\t\t\t\t\ts += mag[y*dw + x]\r\n\t\t\t\t}\r\n\t\t\t\treturn s / samples\r\n\t\t\t}\r\n\t\t\tconst score = totalEdge(best.r) + totalEdge(tOuter) + totalEdge(tInner) + totalEdge(dInner) + totalEdge(bOuter) + totalEdge(bInner)\r\n\t\t\tconst norm = score / (maxMag * 6)\r\n\t\t\tconst conf = Math.max(0, Math.min(1, norm))\r\n\t\t\t// Apply stricter confidence calculation for perfect calibration\r\n\t\t\tconst adjustedConf = Math.min(conf, Math.min(\r\n\t\t\t\ttotalEdge(best.r) / maxMag,    // Double outer\r\n\t\t\t\ttotalEdge(tOuter) / maxMag,    // Treble outer  \r\n\t\t\t\ttotalEdge(tInner) / maxMag,    // Treble inner\r\n\t\t\t\ttotalEdge(dInner) / maxMag,    // Double inner\r\n\t\t\t\ttotalEdge(bOuter) / maxMag,    // Bull outer\r\n\t\t\t\ttotalEdge(bInner) / maxMag     // Bull inner\r\n\t\t\t))\r\n\t\t\tsetConfidence(Math.round(adjustedConf * 100))\r\n\t\t// Seed the six calibration points for accurate alignment\r\n\t\t// Points: TOP, RIGHT, BOTTOM, LEFT of double rim, plus bullseye center and outer bull top\r\n\t\tconst pts: Point[] = [\r\n\t\t\t{ x: OCX,       y: OCY - dOuter }, // TOP of double rim\r\n\t\t\t{ x: OCX + dOuter,  y: OCY      }, // RIGHT of double rim\r\n\t\t\t{ x: OCX,       y: OCY + dOuter }, // BOTTOM of double rim\r\n\t\t\t{ x: OCX - dOuter,  y: OCY      }, // LEFT of double rim\r\n\t\t\t{ x: OCX,       y: OCY          }, // CENTER (bullseye inner bull center)\r\n\t\t\t{ x: OCX,       y: OCY - bOuter }, // TOP of outer bull (for vertical center constraint)\r\n\t\t]\r\n\t\tsetDstPoints(pts)\r\n\t\tdrawOverlay(pts)\r\n\t\t// Compute homography with the 6 points\r\n\t\ttry {\r\n\t\t\tconst src = canonicalRimTargets() // board space mm\r\n\t\t\tconst Hcalc = computeHomographyDLT(src, pts)\r\n\t\t\tdrawOverlay(pts, Hcalc)\r\n\t\t\tconst err = rmsError(Hcalc, src, pts)\r\n\t\t\tsetCalibration({ H: Hcalc as Homography, createdAt: Date.now(), errorPx: err, imageSize: { w: canvasRef.current.width, h: canvasRef.current.height }, anchors: { src, dst: pts } })\r\n\t\t\tsetPhase('computed')\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('[Calibrator] Auto-detect compute failed:', e)\r\n\t\t}\r\n\t\t// Auto-lock if confidence high and error small\r\n\t\tconst autoLock = adjustedConf >= 0.95 // Use adjusted confidence for near-perfect calibration\r\n\t\tsetCalibration({ locked: autoLock })\r\n\t}\r\n\r\n\t// Advanced auto-calibration: detect board features without markers or manual clicking\r\n\tfunction autoCalibrate() {\r\n\t\tif (!canvasRef.current) return alert('Capture a frame or upload a photo first.')\r\n\t\t\r\n\t\t// Use the new board detection system\r\n\t\tlet boardDetection = detectBoard(canvasRef.current)\r\n\t\tboardDetection = refineRingDetection(boardDetection)\r\n\r\n\t\tif (!boardDetection.success || !boardDetection.homography || boardDetection.confidence < 50) {\r\n\t\t\talert(`❌ Board Detection Failed\\n\\nConfidence: ${Math.round(boardDetection.confidence)}%\\n\\n${boardDetection.message}\\n\\nTry:\\n• Better lighting\\n• Closer camera angle\\n• Make sure entire board is visible\\n• Use manual calibration instead (click 5 points)`)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Success! Apply the calibration\r\n\t\tsetDetected({\r\n\t\t\tcx: boardDetection.cx,\r\n\t\t\tcy: boardDetection.cy,\r\n\t\t\tbullInner: boardDetection.bullInner,\r\n\t\t\tbullOuter: boardDetection.bullOuter,\r\n\t\t\ttrebleInner: boardDetection.trebleInner,\r\n\t\t\ttrebleOuter: boardDetection.trebleOuter,\r\n\t\t\tdoubleInner: boardDetection.doubleInner,\r\n\t\t\tdoubleOuter: boardDetection.doubleOuter,\r\n\t\t})\r\n\r\n\t\tsetDstPoints(boardDetection.calibrationPoints)\r\n\t\tdrawOverlay(boardDetection.calibrationPoints, boardDetection.homography)\r\n\r\n\t\tconst shouldLock = (boardDetection.errorPx ?? Number.POSITIVE_INFINITY) <= 2.0\r\n\t\tsetCalibration({\r\n\t\t\tH: boardDetection.homography as Homography,\r\n\t\t\tcreatedAt: Date.now(),\r\n\t\t\terrorPx: boardDetection.errorPx ?? null,\r\n\t\t\timageSize: { w: canvasRef.current.width, h: canvasRef.current.height },\r\n\t\t\tanchors: { src: canonicalRimTargets().slice(0, 4), dst: boardDetection.calibrationPoints },\r\n\t\t\tlocked: shouldLock ? true : locked,\r\n\t\t})\r\n\r\n\t\tsetPhase('computed')\r\n\r\n\t\t// Show success message\r\n\t\tconst confidenceLevel = boardDetection.confidence > 90 ? '🟢 Excellent' : boardDetection.confidence > 80 ? '🟢 Good' : boardDetection.confidence > 70 ? '🟡 Fair' : '🟡 Acceptable'\r\n\t\talert(`✅ Auto-Calibration Successful!\\n\\nConfidence: ${confidenceLevel} (${Math.round(boardDetection.confidence)}%)\\nError: ${boardDetection.errorPx?.toFixed(2) ?? '?'} pixels\\n\\nCalibration has been ${shouldLock ? 'locked' : 'computed (not locked yet)'}.`)\r\n\t}\r\n\r\n\t\t\tfunction detectMarkers() {\r\n\t\t\t\tif (!canvasRef.current) return alert('Capture a frame or upload a photo first.')\r\n\t\t\t\tconst result = detectMarkersFromCanvas(canvasRef.current)\r\n\t\t\t\tsetMarkerResult(result)\r\n\t\t\t\tif (!result.success || !result.homography) {\r\n\t\t\t\t\tconst missingMsg = result.missing.length\r\n\t\t\t\t\t\t? ` Missing markers: ${result.missing.map(k => `${k.toUpperCase()} (ID ${MARKER_TARGETS[k]})`).join(', ')}`\r\n\t\t\t\t\t\t: ''\r\n\t\t\t\t\tconst foundMsg = result.markersFound.length > 0\r\n\t\t\t\t\t\t? `\\n\\nDetected ${result.markersFound.length} markers with IDs: ${result.markersFound.map(m => m.id).join(', ')}`\r\n\t\t\t\t\t\t: '\\n\\nNo markers detected. Make sure markers are on white paper, fully visible, and well-lit.'\r\n\t\t\t\t\tconst fullMsg = `${result.message}${missingMsg}${foundMsg}\\n\\nYou can still use manual calibration: click 5 points on the board instead.`\r\n\t\t\t\t\talert(fullMsg)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tsetDetected(null)\r\n\t\t\t\tsetDstPoints(result.points)\r\n\t\t\t\tdrawOverlay(result.points, result.homography)\r\n\t\t\t\tconst src = canonicalRimTargets()\r\n\t\t\t\tconst imageSize = { w: canvasRef.current.width, h: canvasRef.current.height }\r\n\t\t\t\tconst shouldLock = (result.errorPx ?? Number.POSITIVE_INFINITY) <= 1.2\r\n\t\t\t\tsetCalibration({\r\n\t\t\t\t\tH: result.homography as Homography,\r\n\t\t\t\t\tcreatedAt: Date.now(),\r\n\t\t\t\t\terrorPx: result.errorPx ?? null,\r\n\t\t\t\t\timageSize,\r\n\t\t\t\t\tanchors: { src, dst: result.points },\r\n\t\t\t\t\tlocked: shouldLock ? true : locked,\r\n\t\t\t\t})\r\n\t\t\t\tsetPhase('computed')\r\n\t\t\t}\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tdrawOverlay()\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t}, [snapshotSet, H])\r\n\r\n\t\t// Live detection loop (runs only when streaming and liveDetect is on)\r\n\t\tuseEffect(() => {\r\n\t\t\tif (!liveDetect || !streaming) return\r\n\t\t\tlet raf = 0\r\n\t\t\tconst tick = () => {\r\n\t\t\t\ttry { captureFrame() } catch {}\r\n\t\t\t\traf = requestAnimationFrame(tick)\r\n\t\t\t}\r\n\t\t\traf = requestAnimationFrame(tick)\r\n\t\t\treturn () => cancelAnimationFrame(raf)\r\n\t\t}, [liveDetect, streaming])\r\n\r\n\t\t// When calibration is locked and we have a pairing code, publish calibration to server\r\n\t\tuseEffect(() => {\r\n\t\t\t(async () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (!locked || !pairCode) return\r\n\t\t\t\t\t// Build a compact calibration payload including current canvas size if available\r\n\t\t\t\t\tconst imgSize = canvasRef.current ? { w: canvasRef.current.width, h: canvasRef.current.height } : null\r\n\t\t\t\t\tconst bodyStr = JSON.stringify({ H, anchors: null, imageSize: imgSize, errorPx: errorPx ?? null })\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait apiFetch(`/cam/calibration/${pairCode}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: bodyStr })\r\n\t\t\t\t\t\tconsole.log('[Calibrator] Posted calibration for code', pairCode)\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.warn('[Calibrator] Upload calibration failed', err)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t// If user is authenticated, persist calibration to their account (Supabase-backed)\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst token = localStorage.getItem('authToken')\r\n\t\t\t\t\t\t\tif (token) {\r\n\t\t\t\t\t\t\t\tawait apiFetch('/api/user/calibration', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: bodyStr })\r\n\t\t\t\t\t\t\t\tconsole.log('[Calibrator] Synced calibration to user account')\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tconsole.warn('[Calibrator] User calibration sync failed', err)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t} catch (e) { /* ignore */ }\r\n\t\t\t})()\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t\t}, [locked, pairCode])\r\n\r\n\t\t// DevicePicker moved from SettingsPanel\r\n\t\t\tfunction DevicePicker() {\r\n\t\t\t\t// Toggle to enable debug logs for dropdown behavior (set false to disable)\r\n\t\t\t\tconst DROPDOWN_DEBUG = true\r\n\t\t\tconst { preferredCameraId, preferredCameraLabel, setPreferredCamera, cameraEnabled, setCameraEnabled, preferredCameraLocked, setPreferredCameraLocked } = useUserSettings()\r\n\t\t\tconst [devices, setDevices] = useState<MediaDeviceInfo[]>([])\r\n\t\t\t\t\t\tconst [localDevicesSnapshot, setLocalDevicesSnapshot] = useState<MediaDeviceInfo[] | null>(null)\r\n\t\t\tconst [err, setErr] = useState('')\r\n\t\t\tconst [dropdownOpen, setDropdownOpen] = useState(false)\r\n\t\t\tconst dropdownRef = useRef<HTMLDivElement>(null)\r\n\t\t\t\t\t\tconst ignoreCloseUntilRef = useRef<number>(0)\r\n\t\t\t\t\t\t// When true, the document outside-click handler is temporarily suspended\r\n\t\t\t\t\t\tconst suspendDocHandlerRef = useRef<boolean>(false)\r\n\t\t\tconst dropdownPortal = document.getElementById('dropdown-portal-root') || (() => {\r\n\t\t\t\tconst el = document.createElement('div');\r\n\t\t\t\tel.id = 'dropdown-portal-root';\r\n\t\t\t\tdocument.body.appendChild(el);\r\n\t\t\t\treturn el;\r\n\t\t\t})();\r\n\r\n\t\t\tasync function enumerate() {\r\n\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] enumerate start', Date.now())\r\n\t\t\t\tsetErr('')\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Ensure we have permission; otherwise labels may be empty.\r\n\t\t\t\t\t// IMPORTANT: Only request permission without blocking the camera\r\n\t\t\t\t\ttry { \r\n\t\t\t\t\t\tconst permStream = await navigator.mediaDevices.getUserMedia({ video: true })\r\n\t\t\t\t\t\t// Stop the test stream immediately - don't hold the camera!\r\n\t\t\t\t\t\tpermStream.getTracks().forEach(t => t.stop())\r\n\t\t\t\t\t} catch {}\r\n\t\t\t\t\tconst list = await navigator.mediaDevices.enumerateDevices()\r\n\t\t\t\t\tconst cams = list.filter(d => d.kind === 'videoinput')\r\n\t\t\t\t\t\t\t\tsetDevices(cams)\r\n\t\t\t\t\t\t\t\t// If the picker is open, keep a stable snapshot so the list doesn't jump while interacting\r\n\t\t\t\t\t\t\t\tif (dropdownRef.current && (dropdownRef.current as any).dataset?.open === 'true') {\r\n\t\t\t\t\t\t\t\t\tsetLocalDevicesSnapshot(cams)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] enumerate -> devices', cams.map(c=>c.deviceId), 'snapshot?', !!(dropdownRef.current && (dropdownRef.current as any).dataset?.open === 'true'))\r\n\t\t\t\t} catch (e: any) {\r\n\t\t\t\t\tsetErr('Unable to list cameras. Grant camera permission in your browser.')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuseEffect(() => { enumerate() }, [])\r\n\r\n\t\t\t\t\t\t// Close dropdown when clicking outside. Guard against immediate close\r\n\t\t\t\t\t\t// caused by focus/stream state churn by briefly ignoring outside clicks\r\n\t\t\t\t\t\tuseEffect(() => {\r\n\t\t\t\t\t\t\t\tfunction handleClickOutside(event: MouseEvent) {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] document.mousedown', { target: (event && (event.target as any))?.tagName || String(event.target), time: Date.now(), ignoreUntil: ignoreCloseUntilRef.current })\r\n\t\t\t\t\t\t\t\t\t\t// If suspended (recently opened) don't close yet\r\n\t\t\t\t\t\t\t\t\t\tif (suspendDocHandlerRef.current) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] document.mousedown ignored because suspendDocHandlerRef is true', Date.now())\r\n\t\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t// If we're within the ignore window, don't close yet\r\n\t\t\t\t\t\t\t\t\t\tif (Date.now() < (ignoreCloseUntilRef.current || 0)) return\r\n\t\t\t\t\t\t\t\t\t\t// Treat clicks inside the portal as inside the dropdown (portal elements live outside dropdownRef)\r\n\t\t\t\t\t\t\t\t\t\tconst tgt = event.target as Node\r\n\t\t\t\t\t\t\t\t\t\tconst clickedInsideMain = dropdownRef.current && dropdownRef.current.contains(tgt)\r\n\t\t\t\t\t\t\t\t\t\tconst clickedInsidePortal = dropdownPortal && dropdownPortal.contains && dropdownPortal.contains(tgt)\r\n\t\t\t\t\t\t\t\t\t\tif (!clickedInsideMain && !clickedInsidePortal) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] document.mousedown -> closing dropdown (outside both main+portal)', Date.now())\r\n\t\t\t\t\t\t\t\t\t\t\tsetDropdownOpen(false)\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} catch {}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdocument.addEventListener('mousedown', handleClickOutside)\r\n\t\t\t\t\t\t\treturn () => document.removeEventListener('mousedown', handleClickOutside)\r\n\t\t\t\t\t\t}, [])\r\n\r\n\t\t\t\t\t\tconst selectedDevice = devices.find(d => d.deviceId === preferredCameraId)\r\n\t\t\t\t\t\tconst selectedLabel = selectedDevice ? \r\n\t\t\t\t\t\t\t`${selectedDevice.label || 'Camera'}` : \r\n\t\t\t\t\t\t\t(preferredCameraId ? 'Camera (unavailable)' : 'Auto (browser default)')\r\n\t\t\t\t\t\t// Local immediate label so UI reflects selection instantly even if global store\r\n\t\t\t\t\t\tconst [localSelectedLabel, setLocalSelectedLabel] = useState<string>(selectedLabel)\r\n\r\n\t\t\t// If preferred camera is set but not found, show a warning\r\n\t\t\tconst preferredCameraUnavailable = preferredCameraId && !selectedDevice\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"mt-3 p-3 rounded-lg border border-indigo-500/30 bg-indigo-500/5\">\r\n\t\t\t\t\t<div className=\"font-semibold mb-2\">Select camera device</div>\r\n\t\t\t\t\t{err && <div className=\"text-rose-400 text-sm mb-2\">{err}</div>}\r\n\t\t\t\t\t{preferredCameraUnavailable && (\r\n\t\t\t\t\t\t<div className=\"text-amber-400 text-sm mb-2\">\r\n\t\t\t\t\t\t\tSelected camera is no longer available. \r\n\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\tclassName=\"underline ml-1\" \r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setPreferredCamera(undefined, '', true)}\r\n\t\t\t\t\t\t\t\tdisabled={streaming}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tUse auto-selection\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{/* Lock indicator and toggle for camera selection */}\r\n\t\t\t\t\t<div className=\"flex items-center gap-2 mb-2\">\r\n\t\t\t\t\t\t{preferredCameraLocked ? (\r\n\t\t\t\t\t\t\t<div className=\"text-xs text-emerald-400\">🔒 Camera selection locked</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-xs text-slate-400\">Camera selection unlocked</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"btn btn--ghost px-2 py-0.5 text-xs ml-2\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tsetPreferredCameraLocked(!preferredCameraLocked)\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{preferredCameraLocked ? 'Unlock' : 'Lock'}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"flex items-center gap-3 mb-3\">\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\tid=\"cameraEnabled-calibrator\"\r\n\t\t\t\t\t\t\tchecked={cameraEnabled}\r\n\t\t\t\t\t\t\tonChange={e => setCameraEnabled(e.target.checked)}\r\n\t\t\t\t\t\t\tclassName=\"w-4 h-4\"\r\n\t\t\t\t\t\t\tdisabled={streaming}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<label htmlFor=\"cameraEnabled-calibrator\" className=\"text-sm\">Enable camera for scoring</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2 items-center text-sm\">\r\n\t\t\t\t\t\t<select \r\n\t\t\t\t\t\t\tclassName=\"input col-span-2\"\r\n\t\t\t\t\t\t\tvalue={preferredCameraId || 'auto'}\r\n\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\tconst val = e.target.value\r\n\t\t\t\t\t\t\t\tif (DROPDOWN_DEBUG) console.debug('[DevicePicker] select onChange', val, Date.now())\r\n\t\t\t\t\t\t\t\tif (val === 'auto') {\r\n\t\t\t\t\t\t\t\t\ttry { setPreferredCamera(undefined, '', true) } catch {}\r\n\t\t\t\t\t\t\t\t} else if (val === 'phone') {\r\n\t\t\t\t\t\t\t\t\ttry { setPreferredCamera(undefined, 'Phone Camera', true) } catch {}\r\n\t\t\t\t\t\t\t\t\ttry { setMode('phone'); setPhase('camera'); setStreaming(false); setSnapshotSet(false); } catch {}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconst device = devices.find(d => d.deviceId === val)\r\n\t\t\t\t\t\t\t\t\tif (device) {\r\n\t\t\t\t\t\t\t\t\t\ttry { setPreferredCamera(device.deviceId, device.label || '', true) } catch {}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value=\"auto\">Auto (browser default)</option>\r\n\t\t\t\t\t\t\t{devices.map(d => (\r\n\t\t\t\t\t\t\t\t<option key={d.deviceId} value={d.deviceId}>\r\n\t\t\t\t\t\t\t\t\t{d.label || 'Camera'}\r\n\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t<option value=\"phone\">📱 Phone Camera</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t<div className=\"text-right\">\r\n\t\t\t\t\t\t\t<button className=\"btn px-2 py-1\" onClick={() => { testCamera(preferredCameraId || undefined); }} disabled={streaming}>Test</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{preferredCameraLabel && (\r\n\t\t\t\t\t\t<div className=\"text-xs opacity-70 mt-1\">Selected: {preferredCameraLabel}</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<div className=\"text-xs opacity-70 mt-1\">Tip: All camera technology is supported for autoscoring needs—select your camera here and then open Calibrator to align.</div>\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\t\tconst showMobileLanding = isMobileDevice && !mobileLandingOverride\r\n\r\n\t\tif (showMobileLanding) {\r\n\t\t\tconst linkForMobile = mobileLandingLink ?? (typeof window !== 'undefined' ? `${window.location.origin.replace(/\\/$/, '')}/mobile-cam.html` : '/mobile-cam.html')\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"mx-auto flex min-h-[calc(100vh-140px)] w-full max-w-xl flex-col justify-center gap-6 p-6\">\r\n\t\t\t\t\t<div className=\"space-y-5 rounded-3xl border border-indigo-400/30 bg-slate-900/70 p-6 text-slate-100 shadow-xl\">\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<p className=\"text-xs font-semibold uppercase tracking-wide text-indigo-300\">Mobile camera</p>\r\n\t\t\t\t\t\t\t<h2 className=\"text-2xl font-semibold leading-tight text-white\">This device is ready to stream as your dartboard camera</h2>\r\n\t\t\t\t\t\t\t<p className=\"text-sm text-slate-200/80\">\r\n\t\t\t\t\t\t\t\tOpen the lightweight mobile camera page to stream video to your desktop calibrator. You can still come back here if you need the full desktop tools.\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\t\thref={linkForMobile}\r\n\t\t\t\t\t\t\t\tclassName=\"btn w-full justify-center px-4 py-2 text-base\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tOpen mobile camera\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn--ghost w-full justify-center px-4 py-2 text-sm\"\r\n\t\t\t\t\t\t\t\tonClick={() => copyValue(linkForMobile, 'link')}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{copyFeedback === 'link' ? 'Link copied!' : 'Copy link'}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<p className=\"text-xs text-slate-300/70\">\r\n\t\t\t\t\t\t\tOn a desktop, open Calibrator and generate a pairing code. Then tap <span className=\"font-semibold\">Pair with Desktop</span> from the mobile camera page to connect this device.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\tclassName=\"self-center text-xs font-medium text-indigo-200 underline decoration-dotted decoration-indigo-300/70 transition hover:text-indigo-100\"\r\n\t\t\t\t\t\tonClick={() => setMobileLandingOverride(true)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tContinue to desktop calibrator\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"space-y-6\">\r\n\t\t\t\t{isMobileDevice && mobileLandingOverride && (\r\n\t\t\t\t\t<div className=\"rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-4 text-sm text-indigo-100\">\r\n\t\t\t\t\t\t<div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\r\n\t\t\t\t\t\t\t<p className=\"leading-relaxed\">Using a phone? Switch back to the streamlined mobile camera interface for an easier pairing flow.</p>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tclassName=\"btn btn--ghost px-3 py-1 text-xs\"\r\n\t\t\t\t\t\t\t\tonClick={() => setMobileLandingOverride(false)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tOpen mobile camera mode\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className=\"card space-y-6 p-6\">\r\n\t\t\t\t\t<header className=\"flex flex-wrap items-start justify-between gap-4\">\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<p className=\"text-xs font-semibold uppercase tracking-wide text-indigo-300\">Marker calibration</p>\r\n\t\t\t\t\t\t\t<h2 className=\"text-2xl font-semibold leading-tight text-white\">Align your board with the autoscoring overlay</h2>\r\n\t\t\t\t\t\t\t<p className=\"max-w-2xl text-sm opacity-80\">\r\n\t\t\t\t\t\t\t\tPlace the printable fiducial markers around the double ring, capture a clear frame, and let the calibrator compute a precise homography.\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"flex flex-col items-end gap-2 text-xs font-medium\">\r\n\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-2 rounded-full border border-indigo-400/50 bg-indigo-500/10 px-3 py-1\">\r\n\t\t\t\t\t\t\t\t<span className=\"opacity-60\">Mode</span>\r\n\t\t\t\t\t\t\t\t<span>{mode === 'local' ? 'Desktop camera' : mode === 'phone' ? 'Phone camera' : 'Wifi device'}</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1 ${streaming ? 'border-emerald-400/60 bg-emerald-500/10 text-emerald-100' : 'border-white/20 bg-white/5 text-slate-200'}`}>\r\n\t\t\t\t\t\t\t\t<span className={`h-2 w-2 rounded-full ${streaming ? 'bg-emerald-400' : 'bg-slate-400'}`} />\r\n\t\t\t\t\t\t\t\t{streaming ? 'Live stream active' : 'Stream idle'}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t{locked ? (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 p-4 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-500/20\"><span className=\"text-lg\">✓</span></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-semibold text-emerald-100\">Calibration active</h4>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-80\">Your calibration is saved and active across all game modes. It will be used in Online, Offline, and Tournaments.</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost px-2 py-1 text-xs whitespace-nowrap\" onClick={() => setCalibration({ locked: false })} title=\"Unlock to recalibrate\">Unlock</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{errorPx != null && <div className=\"text-xs opacity-75\">Precision: {errorPx.toFixed(2)} px RMS error</div>}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</header>\r\n\r\n\t\t\t\t\t<div className=\"grid gap-6 xl:grid-cols-[minmax(0,2fr)_minmax(320px,1fr)]\">\r\n\t\t\t\t\t\t<section className=\"space-y-4\">\r\n\t\t\t\t\t\t\t<div className=\"space-y-4 rounded-2xl border border-white/10 bg-black/40 p-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center justify-between gap-4 text-xs\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"uppercase tracking-wide opacity-60\">Video source</span>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'local' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => { setMode('local'); stopCamera(false) }}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Use local camera\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tLocal\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'phone' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => { setMode('phone'); stopCamera(false) }}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Pair phone camera\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tPhone\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-3 py-1 ${mode === 'wifi' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-slate-700 hover:bg-slate-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetMode('wifi')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstopCamera(false)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstartWifiConnection()\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Discover wifi/USB autoscoring devices\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\tWifi\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-70\">Zoom</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tmin={50}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmax={200}\r\n\t\t\t\t\t\t\t\t\t\t\t\tstep={5}\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={Math.round((zoom || 1) * 100)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={e => setZoom(Math.max(0.5, Math.min(2, Number(e.target.value) / 100)))}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"w-12 text-right\">{Math.round((zoom || 1) * 100)}%</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn px-3 py-1\" onClick={() => setZoom(1)}>Actual</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tclassName=\"relative w-full overflow-hidden rounded-2xl border border-indigo-400/30 bg-black\"\r\n\t\t\t\t\t\t\t\t\tstyle={{ aspectRatio: frameSize ? `${frameSize.w} / ${frameSize.h}` : '16 / 9' }}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{(mode === 'phone' ? (!streaming || !paired) : !streaming) && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0 z-20 flex items-center justify-center bg-gradient-to-br from-black/40 to-black/10\">\r\n\t\t\t\t\t\t\t\t\t\t\t<DartLoader calibrationComplete={phase === 'computed'} />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0\" style={{ transform: `scale(${zoom || 1})`, transformOrigin: 'center center' }}>\r\n\t\t\t\t\t\t\t\t\t\t<video\r\n\t\t\t\t\t\t\t\t\t\t\tref={videoRef}\r\n\t\t\t\t\t\t\t\t\t\t\tonLoadedMetadata={(ev) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst v = ev.currentTarget as HTMLVideoElement\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.videoWidth && v.videoHeight) setFrameSize({ w: v.videoWidth, h: v.videoHeight })\r\n\t\t\t\t\t\t\t\t\t\t\t\t} catch {}\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={`absolute inset-0 h-full w-full object-cover transition-opacity duration-300 ${snapshotSet ? 'opacity-0 -z-10' : 'opacity-100 z-10'}`}\r\n\t\t\t\t\t\t\t\t\t\t\tautoPlay\r\n\t\t\t\t\t\t\t\t\t\t\tplaysInline\r\n\t\t\t\t\t\t\t\t\t\t\tmuted\r\n\t\t\t\t\t\t\t\t\t\t\tcontrols={false}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t{videoPlayBlocked && (\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"rounded-lg bg-white px-4 py-2 font-semibold text-slate-900 shadow-lg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={async () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait videoRef.current?.play()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetVideoPlayBlocked(false)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetStreaming(true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPhase('capture')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn('Tap-to-play retry failed', e)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talert('Tap to enable video failed. Please check browser settings or reload the page.')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tTap to allow video\r\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t<canvas ref={canvasRef} className={`absolute inset-0 h-full w-full transition-opacity duration-300 ${snapshotSet ? 'opacity-100 z-10' : 'opacity-0 -z-10'}`} />\r\n\t\t\t\t\t\t\t\t\t\t<canvas ref={overlayRef} onClick={onClickOverlay} className=\"absolute inset-0 z-30 h-full w-full cursor-crosshair\" />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<label className=\"flex items-center gap-2 text-xs\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" className=\"accent-indigo-600\" checked={calibrationGuide} onChange={e => setCalibrationGuide(e.target.checked)} />\r\n\t\t\t\t\t\t\t\t\tShow preferred-view guide overlay\r\n\t\t\t\t\t\t\t\t</label>\r\n\r\n\t\t\t\t\t\t\t\t{/* Stage cards in the main free space — quick access to the three calibration stages */}\r\n\t\t\t\t\t\t\t\t<div className=\"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-3 overflow-visible\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"rounded-2xl border border-white/10 bg-white/5 p-4 overflow-visible\">\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Stage 1 · Capture</h3>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Start your camera or upload a photo to capture the board.</p>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-3 flex flex-col gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'local' && <button className=\"btn\" onClick={startCamera}>Enable camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'phone' && <button className=\"btn\" onClick={startPhonePairing}>Pair phone camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t\t{mode === 'wifi' && <button className=\"btn\" onClick={startWifiConnection}>Connect wifi camera</button>}\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={captureFrame} disabled={!streaming}>Capture frame</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={triggerUpload}>Upload photo</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"rounded-2xl border border-white/10 bg-white/5 p-4\">\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Stage 2 · Auto-Calibrate</h3>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Automatically detect dartboard rings and compute calibration without any markers or clicking.</p>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-3 flex flex-col gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700 font-semibold\" disabled={!snapshotSet} onClick={autoCalibrate}>🎯 Auto-Calibrate (Advanced)</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={!snapshotSet} onClick={autoDetectRings}>Legacy: Auto detect rings</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={!snapshotSet} onClick={detectMarkers}>Legacy: Detect markers (print required)</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost\" onClick={openMarkerSheet}>Print markers</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2 text-xs opacity-70\">Confidence: {confidence}%</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"rounded-2xl border border-white/10 bg-white/5 p-4\">\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-semibold\">Stage 3 · Align & lock</h3>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs opacity-70\">Click the board points, refine edges and lock calibration when satisfied.</p>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-3 flex flex-col gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" disabled={dstPoints.length < 4} onClick={compute}>Compute</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className={`btn ${locked ? 'bg-emerald-600 hover:bg-emerald-700' : ''}`} onClick={() => setCalibration({ locked: !locked })}>{locked ? 'Unlock' : 'Lock in'}</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={() => runVerification()}>Verify</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Pro tip section */}\r\n\t\t\t\t\t\t\t<div className=\"mt-4 rounded-lg border border-blue-500/30 bg-blue-500/10 p-3\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-xs font-semibold text-blue-300 mb-1\">💡 Pro Tip for Perfect Calibration</div>\r\n\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-80\">Click the 4 corners of the double ring at <span className=\"font-semibold\">D20, D6, D3, and D11</span>, then click the <span className=\"font-semibold\">center bull</span>. This evenly-spaced layout provides the most accurate calibration.</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 gap-3 text-xs sm:grid-cols-3\">\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Phase</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold capitalize\">{phase}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Points selected</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">{dstPoints.length} / 5</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"rounded-xl border border-white/10 bg-white/5 px-3 py-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"uppercase tracking-wide opacity-60\">Fit error</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-semibold\">{errorPx != null ? `${errorPx.toFixed(2)} px` : '—'}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</section>\r\n\r\n\t\t\t\t\t\t<aside className=\"space-y-4\">\r\n\t\t\t\t\t\t\t<DevicePicker />\r\n\r\n\t\t\t\t\t\t\t{mode === 'phone' && (\r\n\t\t\t\t\t\t\t\t<section className=\"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">Phone pairing</div>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center gap-2\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => copyValue(mobileUrl, 'link')}\r\n\t\t\t\t\t\t\t\t\t\ttitle=\"Copy mobile camera link\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"flex-1 min-w-0 font-mono break-all text-[11px]\">{mobileUrl}</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy link'}</span>\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-[11px]\">\r\n\t\t\t\t\t\t\t\t\t\t<a href={mobileUrl} target=\"_blank\" rel=\"noreferrer\" className=\"underline decoration-dotted text-indigo-200 hover:text-indigo-100 transition\">\r\n\t\t\t\t\t\t\t\t\t\t\tOpen link in new tab\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">\r\n\t\t\t\t\t\t\t\t\t\tWS: {ws ? (ws.readyState === 1 ? 'open' : ws.readyState === 0 ? 'connecting' : ws.readyState === 2 ? 'closing' : 'closed') : 'not started'} · {httpsInfo?.https ? 'HTTPS on' : 'HTTP only'}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{pairCode && (\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full text-left px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => copyValue(pairCode, 'code')}\r\n\t\t\t\t\t\t\t\t\t\t\ttitle=\"Copy pairing code\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-[10px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy code'}</span>\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t{qrDataUrl && <img className=\"mt-1 h-40 w-40 bg-white\" alt=\"Scan to open\" src={qrDataUrl} />}\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t{ttl !== null && <span>Expires in {ttl}s</span>}\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={regenerateCode}>Regenerate</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{showTips && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-2 rounded-lg border border-slate-700/50 bg-slate-900/60 p-3 text-slate-200\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">Troubleshooting</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<ul className=\"list-disc space-y-1 pl-4\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li>Phone and desktop must be on the same Wi‑Fi network.</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<li>On iPhone, use HTTPS links (QR will prefer HTTPS when enabled).</li>\r\n\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={() => setShowTips(false)}>Hide tips</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t{/* Sidebar Step cards intentionally removed — these controls remain available in the main stage cards above to avoid showing duplicate controls in the right-hand sidebar. */}\r\n\t\t\t\t\t\t</aside>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{mode === 'wifi' && !streaming && (\r\n\t\t\t\t\t\t<div className=\"space-y-3 rounded-2xl border border-indigo-400/30 bg-black/40 p-4 text-xs text-white\">\r\n\t\t\t\t\t\t\t<div className=\"font-semibold\">Wifi scoring devices</div>\r\n\t\t\t\t\t\t\t{discoveringWifi ? (\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"h-4 w-4 animate-spin rounded-full border-b-2 border-white\" />\r\n\t\t\t\t\t\t\t\t\t<span>Scanning network for devices…</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : wifiDevices.length > 0 ? (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t{wifiDevices.map(device => (\r\n\t\t\t\t\t\t\t\t\t\t<div key={device.id} className=\"flex items-center justify-between rounded border border-slate-700/50 bg-slate-900/60 p-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{device.name}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{device.ip}:{device.port} · {device.type.toUpperCase()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70 text-xs\">Capabilities: {device.capabilities.join(', ')}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn px-2 py-1 text-xs ${device.status === 'connecting' ? 'bg-yellow-600' : device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => connectToWifiDevice(device)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={device.status === 'connecting'}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{device.status === 'connecting' ? 'Connecting…' : 'Connect'}\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={startWifiConnection}>Rescan network</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<div>No wifi scoring devices found.</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">Ensure your wifi cameras are powered on and on the same network.</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn px-2 py-1 text-xs\" onClick={startWifiConnection}>Scan again</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n}\r\n","// Very lightweight checkout suggestions. For proper coverage consider a full table.\r\n// Returns up to a few route strings like \"T20 T20 D20\" for a given remaining.\r\n\r\nconst doubles = [\r\n  'D1','D2','D3','D4','D5','D6','D7','D8','D9','D10','D11','D12','D13','D14','D15','D16','D17','D18','D19','D20','DB'\r\n]\r\n\r\nfunction dVal(tag: string): number { if (tag === 'DB') return 50; const n = Number(tag.slice(1)); return n*2 }\r\n\r\nfunction prefsDoubleScore(fav: string): number {\r\n  if (!doubles.includes(fav)) return 32 // default D16\r\n  return dVal(fav)\r\n}\r\n\r\nexport function suggestCheckouts(remaining: number, favoriteDouble: string = 'D16'): string[] {\r\n  if (remaining > 170 || remaining <= 1) return []\r\n  // Simple known highest routes for popular numbers, then fall back to greedy towards favourite double\r\n  const hardcoded: Record<number, string[]> = {\r\n    170: ['T20 T20 DB'], 167: ['T20 T19 DB'], 164: ['T20 T18 DB'], 161: ['T20 T17 DB'], 160: ['T20 T20 D20'],\r\n    158: ['T20 T20 D19'], 157: ['T20 T19 D20'], 156: ['T20 T20 D18'], 155: ['T20 T19 D19'], 154: ['T20 T18 D20'],\r\n    153: ['T20 T19 D18'], 152: ['T20 T20 D16'], 151: ['T20 T17 D20'], 150: ['T20 T18 D18'], 149: ['T20 T19 D16'],\r\n    148: ['T20 T16 D20'], 147: ['T20 T17 D18'], 146: ['T20 T18 D16'], 145: ['T20 T15 D20'], 144: ['T20 T20 D12'],\r\n    141: ['T20 T19 D12'], 140: ['T20 T20 D10'], 137: ['T20 T19 D10'], 136: ['T20 T20 D8'], 132: ['BULL T14 D20','T20 T12 D8'],\r\n    130: ['T20 T20 D5','T20 T18 D8'], 129: ['T19 T16 D12'], 128: ['T18 T14 D16'], 127: ['T20 T17 D8'], 126: ['T19 T19 D6'],\r\n    121: ['T20 11 D20','T20 T15 D8'], 120: ['T20 20 D20','T20 S20 D20'], 110: ['T20 10 D20'], 100: ['T20 D20'], 99: ['T19 10 D16','T19 S10 D16'], 97: ['T19 D20'],\r\n    96: ['T20 D18'], 95: ['T19 D19'], 94: ['T18 D20'], 92: ['T20 D16'], 90: ['T18 D18','T20 D15'], 86: ['T18 D16'], 84: ['T20 D12','T16 D18'],\r\n    82: ['BULL D16','T14 D20'], 81: ['T19 D12'], 80: ['T20 D10','D20 D20'], 78: ['T18 D12'], 76: ['T20 D8','T16 D14'], 74: ['T14 D16','T18 D10'],\r\n    72: ['T16 D12','T20 D6'], 70: ['T18 D8','S20 BULL'], 68: ['T20 D4','T16 D10'], 66: ['T10 D18','T14 D12'], 64: ['T16 D8','D16 D16'],\r\n    62: ['T10 D16','T12 D13'], 60: ['20 D20','S20 D20'], 58: ['18 D20','S18 D20'], 56: ['16 D20','S16 D20'], 54: ['14 D20','S14 D20'],\r\n    52: ['20 D16','S20 D16'], 50: ['BULL','10 D20'], 48: ['16 D16','S16 D16'], 46: ['14 D16'], 44: ['12 D16'], 42: ['10 D16'],\r\n    40: ['D20'], 38: ['D19'], 36: ['D18'], 34: ['D17'], 32: ['D16'], 30: ['D15'], 28: ['D14'], 26: ['D13'], 24: ['D12'], 22: ['D11'], 20: ['D10'], 18: ['D9'], 16: ['D8'], 14: ['D7'], 12: ['D6'], 10: ['D5'], 8: ['D4'], 6: ['D3'], 4: ['D2'], 2: ['D1']\r\n  }\r\n  if (hardcoded[remaining]) return hardcoded[remaining]\r\n  // Greedy fallback: aim to leave favourite double if possible in two darts\r\n  const target = prefsDoubleScore(favoriteDouble)\r\n  const routes: string[] = []\r\n  // Try to hit a treble/big single that leaves the fav double\r\n  for (const t of [60, 57, 54, 51, 48]) { // T20..T16\r\n    const left = remaining - t\r\n    if (left === target) { routes.push(`T${t/3} ${favoriteDouble}`); break }\r\n  }\r\n  if (!routes.length) {\r\n    for (const s of [20, 19, 18, 17, 16, 15]) {\r\n      const left = remaining - s\r\n      if (left === target) { routes.push(`${s} ${favoriteDouble}`); break }\r\n    }\r\n  }\r\n  return routes\r\n}\r\n\r\nexport function sayScore(name: string, scored: number, remaining: number, voiceName?: string, opts?: { volume?: number; checkoutOnly?: boolean }) {\r\n  try {\r\n    const synth = window.speechSynthesis\r\n    if (!synth) return\r\n    const msg = new SpeechSynthesisUtterance()\r\n    const isCheckout = remaining <= 170 && remaining > 0\r\n    if (opts?.checkoutOnly && !isCheckout) return\r\n    msg.text = isCheckout ? `${name}, you have ${remaining} remaining.` : `${scored}`\r\n    if (voiceName) {\r\n      const v = synth.getVoices().find(v => v.name === voiceName)\r\n      if (v) msg.voice = v\r\n    }\r\n    if (typeof opts?.volume === 'number') msg.volume = Math.max(0, Math.min(1, opts.volume))\r\n    msg.rate = 1.0\r\n    msg.pitch = 1.0\r\n    synth.speak(msg)\r\n  } catch {}\r\n}\r\n","/**\r\n * Game-Mode-Specific Calibration Requirements\r\n * \r\n * Each game mode has different accuracy requirements:\r\n * - X01: Needs all zones (singles, doubles, trebles, bulls)\r\n * - Cricket: Only needs 6 numbers + bullseye\r\n * - Treble Practice: Only needs treble ring (strictest)\r\n * - Checkout modes: Need double precision\r\n */\r\n\r\nexport type CalibrationRequirement = {\r\n  tolerancePx: number // Maximum acceptable error in pixels\r\n  requiredTargets: string[] // Key areas needed for this game\r\n  criticalZones: string[] // Most important areas to focus on during calibration\r\n  minConfidence: number // Minimum acceptable calibration confidence (0-100)\r\n}\r\n\r\nexport const GAME_CALIBRATION_REQUIREMENTS: Record<string, CalibrationRequirement> = {\r\n  // Free Games\r\n  'X01': {\r\n    tolerancePx: 10,\r\n    requiredTargets: ['SINGLE', 'DOUBLE', 'TREBLE', 'BULL', 'OUTER_BULL'],\r\n    criticalZones: ['D20', 'D1', 'BULLSEYE', 'T20', 'SINGLE_20'],\r\n    minConfidence: 80\r\n  },\r\n  'Double Practice': {\r\n    tolerancePx: 12,\r\n    requiredTargets: ['DOUBLE', 'BULL'],\r\n    criticalZones: ['D20', 'D1', 'D6', 'D17'],\r\n    minConfidence: 75\r\n  },\r\n\r\n  // Premium - Accuracy Critical\r\n  'Treble Practice': {\r\n    tolerancePx: 8, // Strictest requirement\r\n    requiredTargets: ['TREBLE'],\r\n    criticalZones: ['T20', 'T1', 'T5'],\r\n    minConfidence: 85\r\n  },\r\n  'Checkout 170': {\r\n    tolerancePx: 9,\r\n    requiredTargets: ['DOUBLE'],\r\n    criticalZones: ['D25', 'D20', 'D8'],\r\n    minConfidence: 82\r\n  },\r\n  'Checkout 121': {\r\n    tolerancePx: 9,\r\n    requiredTargets: ['DOUBLE'],\r\n    criticalZones: ['D20', 'D5', 'D1'],\r\n    minConfidence: 82\r\n  },\r\n\r\n  // Premium - Target Subset\r\n  'Cricket': {\r\n    tolerancePx: 15,\r\n    requiredTargets: ['20', '19', '18', '17', '16', '15', 'BULL'],\r\n    criticalZones: ['20', '15', 'BULL'],\r\n    minConfidence: 70\r\n  },\r\n  'American Cricket': {\r\n    tolerancePx: 15,\r\n    requiredTargets: ['20', '19', '18', '17', '16', '15', 'BULL'],\r\n    criticalZones: ['20', '15', 'BULL'],\r\n    minConfidence: 70\r\n  },\r\n\r\n  // Premium - All Numbers\r\n  'Around the Clock': {\r\n    tolerancePx: 12,\r\n    requiredTargets: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', \r\n                      '11', '12', '13', '14', '15', '16', '17', '18', '19', '20'],\r\n    criticalZones: ['1', '20', '6', '15'],\r\n    minConfidence: 78\r\n  },\r\n  'Shanghai': {\r\n    tolerancePx: 13,\r\n    requiredTargets: ['1', '2', '3', '4', '5', '6', '7', 'SINGLE', 'DOUBLE', 'TREBLE'],\r\n    criticalZones: ['1', '7', 'S1', 'D1', 'T1'],\r\n    minConfidence: 75\r\n  },\r\n\r\n  // Premium - Practice/Training\r\n  'High Score': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['TREBLE', 'DOUBLE', 'BULL'],\r\n    criticalZones: ['T20', 'BULL', 'D20'],\r\n    minConfidence: 72\r\n  },\r\n  'Low Score': {\r\n    tolerancePx: 11,\r\n    requiredTargets: ['SINGLE'],\r\n    criticalZones: ['1', '2', '3'],\r\n    minConfidence: 76\r\n  },\r\n  'Count-Up': {\r\n    tolerancePx: 13,\r\n    requiredTargets: ['SINGLE', 'DOUBLE', 'TREBLE'],\r\n    criticalZones: ['20', 'DOUBLE', 'TREBLE'],\r\n    minConfidence: 74\r\n  },\r\n\r\n  // Premium - Head-to-Head\r\n  'Halve It': {\r\n    tolerancePx: 12,\r\n    requiredTargets: ['TREBLE', 'SINGLE'],\r\n    criticalZones: ['T20', 'T5', 'SINGLE'],\r\n    minConfidence: 73\r\n  },\r\n  'High-Low': {\r\n    tolerancePx: 13,\r\n    requiredTargets: ['SINGLE', 'DOUBLE', 'BULL'],\r\n    criticalZones: ['HIGH (>10)', 'LOW (<5)', 'BULL'],\r\n    minConfidence: 72\r\n  },\r\n  'Killer': {\r\n    tolerancePx: 12,\r\n    requiredTargets: ['ALL_NUMBERS'],\r\n    criticalZones: ['RANDOM_TARGETS'],\r\n    minConfidence: 74\r\n  },\r\n\r\n  // Premium - Skill Games\r\n  'Baseball': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['1-9', 'SINGLE', 'DOUBLE', 'TREBLE'],\r\n    criticalZones: ['1', '9', 'TRIPLE'],\r\n    minConfidence: 71\r\n  },\r\n  'Golf': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['1-18', 'TREBLE'],\r\n    criticalZones: ['T1', 'T18'],\r\n    minConfidence: 71\r\n  },\r\n  'Tic Tac Toe': {\r\n    tolerancePx: 16,\r\n    requiredTargets: ['1-9', 'SINGLE'],\r\n    criticalZones: ['CENTER', 'CORNERS'],\r\n    minConfidence: 68\r\n  },\r\n\r\n  // Premium - Variation Games\r\n  \"Bob's 27\": {\r\n    tolerancePx: 13,\r\n    requiredTargets: ['SINGLE', 'DOUBLE'],\r\n    criticalZones: ['1-20', 'BULL'],\r\n    minConfidence: 73\r\n  },\r\n  'Scam': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['ALL_NUMBERS', 'OUTER_BULL'],\r\n    criticalZones: ['TARGET_NUMBER', 'OUTER_BULL'],\r\n    minConfidence: 70\r\n  },\r\n  'Fives': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['ALL_NUMBERS', 'OUTER_BULL'],\r\n    criticalZones: ['5', '10', '15', '20'],\r\n    minConfidence: 70\r\n  },\r\n  'Sevens': {\r\n    tolerancePx: 14,\r\n    requiredTargets: ['ALL_NUMBERS', 'OUTER_BULL'],\r\n    criticalZones: ['7', '14'],\r\n    minConfidence: 70\r\n  },\r\n}\r\n\r\n/**\r\n * Evaluate calibration quality for a specific game mode\r\n * Returns confidence level 0-100\r\n */\r\nexport function getCalibrationConfidenceForGame(\r\n  gameMode: string,\r\n  errorPx: number | null\r\n): number {\r\n  if (!errorPx || errorPx < 0) return 0\r\n\r\n  const req = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n  if (!req) return 50 // Unknown game, neutral confidence\r\n\r\n  // Confidence drops as error increases beyond tolerance\r\n  if (errorPx <= req.tolerancePx) {\r\n    // Excellent calibration\r\n    return Math.min(100, 100 - (errorPx / req.tolerancePx) * 20)\r\n  } else {\r\n    // Poor calibration - drops steeply\r\n    const excess = errorPx - req.tolerancePx\r\n    return Math.max(0, 50 - excess * 2)\r\n  }\r\n}\r\n\r\n/**\r\n * Check if calibration is suitable for a game\r\n */\r\nexport function isCalibrationSuitableForGame(\r\n  gameMode: string,\r\n  errorPx: number | null\r\n): boolean {\r\n  if (!errorPx) return false\r\n\r\n  const req = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n  if (!req) return true // Unknown game, assume suitable\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n  return confidence >= req.minConfidence\r\n}\r\n\r\n/**\r\n * Get a human-readable assessment of calibration quality\r\n */\r\nexport function getCalibrationQualityText(\r\n  gameMode: string,\r\n  errorPx: number | null\r\n): { quality: 'excellent' | 'good' | 'fair' | 'poor' | 'none'; text: string } {\r\n  if (!errorPx) {\r\n    return { quality: 'none', text: 'Not calibrated' }\r\n  }\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n\r\n  if (confidence >= 90) {\r\n    return { quality: 'excellent', text: `Excellent (${Math.round(confidence)}%)` }\r\n  } else if (confidence >= 75) {\r\n    return { quality: 'good', text: `Good (${Math.round(confidence)}%)` }\r\n  } else if (confidence >= 50) {\r\n    return { quality: 'fair', text: `Fair (${Math.round(confidence)}%)` }\r\n  } else {\r\n    return { quality: 'poor', text: `Poor (${Math.round(confidence)}%)` }\r\n  }\r\n}\r\n\r\n/**\r\n * Get personalized recalibration recommendation for a game\r\n */\r\nexport function getRecalibrationRecommendation(gameMode: string): string | null {\r\n  const req = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n  if (!req || req.criticalZones.length === 0) return null\r\n\r\n  const zones = req.criticalZones.join(', ')\r\n  return `Recalibrate focusing on: ${zones}`\r\n}\r\n\r\n/**\r\n * Get all games sorted by calibration difficulty (strictest first)\r\n */\r\nexport function getGamesByCalibrationDifficulty(): string[] {\r\n  return Object.entries(GAME_CALIBRATION_REQUIREMENTS)\r\n    .sort((a, b) => a[1].tolerancePx - b[1].tolerancePx)\r\n    .map(([name]) => name)\r\n}\r\n","import React from 'react'\r\nimport { AlertTriangle, CheckCircle, AlertCircle, Zap } from 'lucide-react'\r\nimport { useCalibration } from '../store/calibration'\r\nimport {\r\n  getCalibrationConfidenceForGame,\r\n  isCalibrationSuitableForGame,\r\n  getCalibrationQualityText,\r\n  getRecalibrationRecommendation,\r\n  GAME_CALIBRATION_REQUIREMENTS\r\n} from '../utils/gameCalibrationRequirements'\r\n\r\ninterface GameCalibrationStatusProps {\r\n  gameMode: string\r\n  compact?: boolean // Show minimal version\r\n  onRecalibrate?: () => void // Optional callback for recalibrate button\r\n}\r\n\r\nexport default function GameCalibrationStatus({\r\n  gameMode,\r\n  compact = false,\r\n  onRecalibrate\r\n}: GameCalibrationStatusProps) {\r\n  const { H, errorPx } = useCalibration()\r\n\r\n  const confidence = getCalibrationConfidenceForGame(gameMode, errorPx)\r\n  const suitable = isCalibrationSuitableForGame(gameMode, errorPx)\r\n  const { quality, text } = getCalibrationQualityText(gameMode, errorPx)\r\n  const recommendation = getRecalibrationRecommendation(gameMode)\r\n  const requirement = GAME_CALIBRATION_REQUIREMENTS[gameMode]\r\n\r\n  // Not calibrated\r\n  if (!H || !errorPx) {\r\n    if (compact) {\r\n      return (\r\n        <div className=\"text-xs px-2 py-1 rounded bg-slate-600/40 text-slate-300 inline-flex items-center gap-1 border border-slate-500/30\">\r\n          <AlertTriangle className=\"w-3 h-3\" />\r\n          Not calibrated\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div className=\"px-3 py-2 rounded bg-red-500/20 border border-red-600/30 flex items-center gap-2\">\r\n        <AlertTriangle className=\"w-4 h-4 text-red-400 flex-shrink-0\" />\r\n        <div className=\"flex-1\">\r\n          <div className=\"font-medium text-red-300\">Calibration Required</div>\r\n          <div className=\"text-xs opacity-80\">Please calibrate before playing {gameMode}</div>\r\n        </div>\r\n        {onRecalibrate && (\r\n          <button\r\n            className=\"btn px-2 py-1 text-xs bg-red-600 hover:bg-red-700\"\r\n            onClick={onRecalibrate}\r\n          >\r\n            Calibrate\r\n          </button>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Determine colors based on suitability\r\n  const bgColor = suitable\r\n    ? 'bg-emerald-500/20 border-emerald-600/30'\r\n    : 'bg-amber-500/20 border-amber-600/30'\r\n\r\n  const textColor = suitable ? 'text-emerald-300' : 'text-amber-300'\r\n  const icon = suitable ? CheckCircle : AlertTriangle\r\n\r\n  if (compact) {\r\n    return (\r\n      <div className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 border ${bgColor} ${textColor}`}>\r\n        {React.createElement(icon, { className: 'w-3 h-3' })}\r\n        <span>{text}</span>\r\n        {!suitable && recommendation && (\r\n          <span className=\"w-3 h-3 cursor-help\" title={recommendation}>\r\n            <AlertCircle className=\"w-3 h-3 inline\" />\r\n          </span>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Full version\r\n  return (\r\n    <div className={`px-3 py-2 rounded border ${bgColor} space-y-1`}>\r\n      <div className=\"flex items-center gap-2\">\r\n        {React.createElement(icon, {\r\n          className: `w-4 h-4 ${suitable ? 'text-emerald-400' : 'text-amber-400'} flex-shrink-0`\r\n        })}\r\n        <div className=\"flex-1\">\r\n          <div className={`font-medium ${suitable ? 'text-emerald-300' : 'text-amber-300'}`}>\r\n            Calibration for {gameMode}\r\n          </div>\r\n          <div className=\"text-xs opacity-80\">Error: {Math.round(errorPx)}px | {text}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Confidence bar */}\r\n      <div className=\"flex items-center gap-2\">\r\n        <div className=\"flex-1 h-1.5 rounded bg-black/30 overflow-hidden\">\r\n          <div\r\n            className={`h-full transition-all ${\r\n              suitable ? 'bg-emerald-500' : 'bg-amber-500'\r\n            }`}\r\n            style={{ width: `${Math.min(100, confidence)}%` }}\r\n          />\r\n        </div>\r\n        <span className=\"text-xs font-mono\">{Math.round(confidence)}%</span>\r\n      </div>\r\n\r\n      {/* Requirements */}\r\n      {requirement && (\r\n        <div className=\"text-xs opacity-75\">\r\n          <div>Tolerance: ±{requirement.tolerancePx}px | Min: {requirement.minConfidence}%</div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Warning and recommendation */}\r\n      <div className=\"space-y-1\">\r\n        {!suitable && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-amber-900/30 text-amber-200 border border-amber-600/20 flex items-center gap-1\">\r\n            <AlertTriangle className=\"w-3 h-3 flex-shrink-0\" />\r\n            Calibration quality is below minimum for {gameMode}\r\n          </div>\r\n        )}\r\n\r\n        {recommendation && (\r\n          <div className=\"text-xs px-2 py-1 rounded bg-blue-900/30 text-blue-200 border border-blue-600/20 flex items-center gap-1\">\r\n            <Zap className=\"w-3 h-3 flex-shrink-0\" />\r\n            {recommendation}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {!suitable && onRecalibrate && (\r\n        <button\r\n          className=\"w-full btn px-2 py-1 text-sm mt-2 bg-amber-600 hover:bg-amber-700\"\r\n          onClick={onRecalibrate}\r\n        >\r\n          Recalibrate for {gameMode}\r\n        </button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useRef, useState, type CSSProperties } from 'react'\r\nimport { makeQrDataUrlWithLogo } from '../utils/qr'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCameraSession } from '../store/cameraSession'\r\nimport { discoverNetworkDevices, connectToNetworkDevice, type NetworkDevice, discoverUSBDevices, requestUSBDevice, connectToUSBDevice, type USBDevice } from '../utils/networkDevices'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype CameraTileProps = {\r\n  label?: string\r\n  autoStart?: boolean\r\n  scale?: number\r\n  className?: string\r\n  aspect?: 'inherit' | 'wide' | 'square' | 'portrait' | 'classic' | 'free'\r\n  style?: CSSProperties\r\n  fill?: boolean\r\n}\r\n\r\nexport default function CameraTile({\r\n  label,\r\n  autoStart = false,\r\n  scale: scaleOverride,\r\n  className,\r\n  aspect = 'inherit',\r\n  style,\r\n  fill = false,\r\n}: CameraTileProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const cameraSession = useCameraSession()\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [ws, setWs] = useState<WebSocket | null>(null)\r\n  const [pairCode, setPairCode] = useState<string | null>(null)\r\n  const [pc, setPc] = useState<RTCPeerConnection | null>(null)\r\n  \r\n  // Initialize mode: prioritize phone camera if preferred, otherwise use localStorage\r\n  const preferredCameraLabel = useUserSettings(s => s.preferredCameraLabel)\r\n  const [mode, setMode] = useState<'local'|'phone'|'wifi'>(() => {\r\n    // If phone camera is selected, start in phone mode\r\n    if (preferredCameraLabel === 'Phone Camera') {\r\n      console.log('[CAMERATILE] Initializing mode to phone (from preferred camera selection)')\r\n      return 'phone'\r\n    }\r\n    // Otherwise use saved mode or default to local\r\n    const saved = localStorage.getItem('ndn:camera:mode') as any\r\n    console.log('[CAMERATILE] Initializing mode to', saved || 'local', '(from localStorage)')\r\n    return saved || 'local'\r\n  })\r\n  \r\n  const [expiresAt, setExpiresAt] = useState<number | null>(null)\r\n  const [now, setNow] = useState<number>(Date.now())\r\n  const [paired, setPaired] = useState<boolean>(false)\r\n  const [lanHost, setLanHost] = useState<string | null>(null)\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null)\r\n  const [showTips, setShowTips] = useState<boolean>(true)\r\n  const [wifiDevices, setWifiDevices] = useState<NetworkDevice[]>([])\r\n  const [discoveringWifi, setDiscoveringWifi] = useState<boolean>(false)\r\n  const [usbDevices, setUsbDevices] = useState<USBDevice[]>([])\r\n  const [discoveringUsb, setDiscoveringUsb] = useState<boolean>(false)\r\n  const autoscoreProvider = useUserSettings(s => s.autoscoreProvider)\r\n  const setPreferredCameraLocked = useUserSettings(s => s.setPreferredCameraLocked)\r\n\r\n  if (autoscoreProvider === 'manual') {\r\n    const fallbackBase = fill ? 'rounded-2xl overflow-hidden bg-black w-full flex flex-col' : 'rounded-2xl overflow-hidden bg-black w-full mx-auto'\r\n    const fallbackClass = [fallbackBase, className].filter(Boolean).join(' ').trim()\r\n    const fallbackStyle: CSSProperties = { ...(style || {}) }\r\n    if (!fill && fallbackStyle.aspectRatio === undefined && fallbackStyle.height === undefined && fallbackStyle.minHeight === undefined) {\r\n      fallbackStyle.aspectRatio = '4 / 3'\r\n    }\r\n    return (\r\n      <div className={fallbackClass} style={fallbackStyle}>\r\n        <div className=\"flex-1 w-full h-full flex items-center justify-center bg-slate-900 text-slate-200 text-xs p-4 text-center\">\r\n          Manual scoring mode active — camera feeds are disabled.\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  useEffect(() => {\r\n    const h = window.location.hostname\r\n    if (h === 'localhost' || h === '127.0.0.1') {\r\n      apiFetch(`/api/hosts`).then(r => r.json()).then(j => {\r\n        const ip = Array.isArray(j?.hosts) && j.hosts.find((x: string) => x)\r\n        if (ip) setLanHost(ip)\r\n      }).catch(()=>{})\r\n    }\r\n    // Detect HTTPS support for the phone link\r\n    apiFetch(`/api/https-info`).then(r=>r.json()).then(j=>{\r\n      if (j && typeof j.https === 'boolean') setHttpsInfo({ https: !!j.https, port: Number(j.port)||8788 })\r\n    }).catch(()=>{})\r\n  }, [])\r\n  const mobileUrl = useMemo(() => {\r\n    const code = pairCode || '____'\r\n    // If a hosted WS URL is configured (e.g., Render), derive the server origin from it\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      try {\r\n        // Convert ws(s)://host[/ws] -> http(s)://host (strip trailing /ws)\r\n        const u = new URL(envUrl)\r\n        const isSecure = u.protocol === 'wss:'\r\n        const origin = `${isSecure ? 'https' : 'http'}://${u.host}${u.pathname.endsWith('/ws') ? '' : u.pathname}`\r\n        const base = origin.replace(/\\/?ws$/i, '')\r\n        return `${base}/mobile-cam.html?code=${code}`\r\n      } catch {}\r\n    }\r\n    // Fallback to local development: prefer LAN host if detected\r\n    const host = (lanHost || window.location.hostname)\r\n    const useHttps = !!httpsInfo?.https\r\n    const port = useHttps ? (httpsInfo?.port || 8788) : 8787\r\n    const proto = useHttps ? 'https' : 'http'\r\n    return `${proto}://${host}:${port}/mobile-cam.html?code=${code}`\r\n  }, [pairCode, lanHost, httpsInfo])\r\n  useEffect(() => { \r\n    console.log('[CAMERATILE] Mode changed to:', mode, '- persisting to localStorage')\r\n    localStorage.setItem('ndn:camera:mode', mode) \r\n  }, [mode])\r\n  \r\n  // Sync phone camera selection from Calibrator into CameraTile mode state\r\n  // When user locks in phone camera in Calibrator, it updates preferredCameraLabel\r\n  // This effect ensures CameraTile's UI reflects that selection\r\n  useEffect(() => {\r\n    const ignore = useUserSettings.getState().ignorePreferredCameraSync\r\n    console.log('[CAMERATILE] Checking camera selection sync: preferredCameraLabel=', preferredCameraLabel, 'mode=', mode, 'ignoreSync=', ignore)\r\n    if (ignore) return\r\n    if (preferredCameraLabel === 'Phone Camera' && mode !== 'phone') {\r\n      console.log('[CAMERATILE] Syncing mode to phone from Calibrator selection')\r\n      setMode('phone')\r\n    }\r\n  }, [preferredCameraLabel, mode])\r\n  \r\n  const [qrDataUrl, setQrDataUrl] = useState<string>('')\r\n  useEffect(() => {\r\n    if (!pairCode) { setQrDataUrl(''); return }\r\n    const logoPath = (import.meta as any).env?.VITE_QR_LOGO_URL || '/dart-thrower.svg'\r\n    makeQrDataUrlWithLogo(mobileUrl, {\r\n      width: 160,\r\n      margin: 1,\r\n      errorCorrectionLevel: 'H',\r\n      color: { dark: '#000000', light: '#ffffff' },\r\n      logo: { logoUrl: logoPath, logoScale: 0.2, mask: true, shape: 'circle' }\r\n    }).then(setQrDataUrl).catch(() => setQrDataUrl(''))\r\n  }, [mobileUrl, pairCode])\r\n  useEffect(() => {\r\n    if (!expiresAt) return\r\n    const t = setInterval(() => setNow(Date.now()), 1000)\r\n    return () => clearInterval(t)\r\n  }, [expiresAt])\r\n  const ttl = useMemo(() => expiresAt ? Math.max(0, Math.ceil((expiresAt - now)/1000)) : null, [expiresAt, now])\r\n  // Intentionally disabled automatic regeneration of phone pairing codes.\r\n  // Codes will only be created when the user explicitly requests it (button click).\r\n  // This prevents a code expiring and the UI silently generating a new one while pairing.\r\n\r\n  useEffect(() => {\r\n    if (autoStart) {\r\n      start().catch(()=>{})\r\n    } else {\r\n      stop()\r\n    }\r\n  }, [autoStart, preferredCameraLabel])\r\n\r\n  // If the user selected Phone Camera, bind the global stream into this tile\r\n  useEffect(() => {\r\n    const apply = async () => {\r\n      try {\r\n        if (preferredCameraLabel !== 'Phone Camera' && mode !== 'phone') return\r\n        const s = cameraSession.getMediaStream()\r\n        const v = videoRef.current\r\n        if (!v || !s) return\r\n        if (v.srcObject !== s) {\r\n          v.srcObject = s\r\n        }\r\n        v.muted = true\r\n        ;(v as any).playsInline = true\r\n        try { await v.play() } catch {}\r\n        setStreaming(true)\r\n      } catch {}\r\n    }\r\n    // Try immediately and poll briefly to catch late-arriving stream\r\n    apply()\r\n    const t = setInterval(apply, 800)\r\n    return () => clearInterval(t)\r\n  }, [preferredCameraLabel, mode, cameraSession, cameraSession.isStreaming])\r\n\r\n  async function start() {\r\n    if (mode === 'wifi') {\r\n      return startWifiConnection()\r\n    }\r\n\r\n    // If phone camera is selected and paired, don't try to start local camera\r\n    if (preferredCameraLabel === 'Phone Camera' || mode === 'phone') {\r\n      const s = cameraSession.getMediaStream()\r\n      if (s && videoRef.current) {\r\n        try {\r\n          videoRef.current.srcObject = s\r\n          await videoRef.current.play()\r\n          setStreaming(true)\r\n          return\r\n        } catch {}\r\n      }\r\n      // If no global stream yet, fall through to default behavior\r\n    }\r\n\r\n    try {\r\n      // Prefer saved camera if available\r\n      const { preferredCameraId, setPreferredCamera } = useUserSettings.getState()\r\n      const constraints: MediaStreamConstraints = preferredCameraId ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } : { video: true, audio: false }\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n      } catch (err: any) {\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n      }\r\n      // Camera started successfully - no automatic preference updates\r\n    } catch {}\r\n  }\r\n  function stop() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n    }\r\n  }\r\n\r\n  async function startWifiConnection() {\r\n    setDiscoveringWifi(true)\r\n    try {\r\n      const devices = await discoverNetworkDevices()\r\n      setWifiDevices(devices)\r\n      if (devices.length === 0) {\r\n        alert('No wifi scoring devices found on your network. Make sure devices are powered on and connected to the same network.')\r\n      }\r\n    } catch (error) {\r\n      console.error('Wifi device discovery failed:', error)\r\n      alert('Failed to discover wifi devices. Please check your network connection.')\r\n    } finally {\r\n      setDiscoveringWifi(false)\r\n    }\r\n  }\r\n\r\n  async function connectToWifiDevice(device: NetworkDevice) {\r\n    try {\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n\r\n      const stream = await connectToNetworkDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setWifiDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to wifi device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setWifiDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  async function startUsbConnection() {\r\n    setDiscoveringUsb(true)\r\n    try {\r\n      // First try to get already paired devices\r\n      const devices = await discoverUSBDevices()\r\n      setUsbDevices(devices)\r\n\r\n      // Then request user to select a new device\r\n      const newDevice = await requestUSBDevice()\r\n      if (newDevice) {\r\n        setUsbDevices(prev => [...prev, newDevice])\r\n      }\r\n\r\n      if (devices.length === 0 && !newDevice) {\r\n        alert('No USB scoring devices found. Please connect a device and try again.')\r\n      }\r\n    } catch (error) {\r\n      console.error('USB device discovery failed:', error)\r\n      alert('Failed to discover USB devices. Please check device connections.')\r\n    } finally {\r\n      setDiscoveringUsb(false)\r\n    }\r\n  }\r\n\r\n  async function connectToUsbDevice(device: USBDevice) {\r\n    try {\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'connecting' as const } : d\r\n      ))\r\n      const stream = await connectToUSBDevice(device)\r\n      if (stream && videoRef.current) {\r\n        videoRef.current.srcObject = stream\r\n        await videoRef.current.play()\r\n        setStreaming(true)\r\n        setMode('wifi') // Using wifi mode for USB devices too\r\n        setUsbDevices(devices => devices.map(d => \r\n          d.id === device.id ? { ...d, status: 'online' as const } : d\r\n        ))\r\n      } else {\r\n        throw new Error('Failed to get video stream')\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect to USB device:', error)\r\n      alert(`Failed to connect to ${device.name}. Please check the device and try again.`)\r\n      setUsbDevices(devices => devices.map(d => \r\n        d.id === device.id ? { ...d, status: 'offline' as const } : d\r\n      ))\r\n    }\r\n  }\r\n\r\n  // Phone pairing via WebRTC\r\n  function ensureWS() {\r\n    if (ws && ws.readyState === WebSocket.OPEN) return ws\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    const normalizedEnv = envUrl && envUrl.length > 0\r\n      ? (envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws')\r\n      : undefined\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const sameOrigin = `${proto}://${window.location.host}/ws`\r\n    const host = window.location.hostname\r\n    const isLocalhost = host === 'localhost' || host === '127.0.0.1'\r\n    const isRenderHost = host.endsWith('onrender.com')\r\n    // Preferred production fallback (avoids Netlify origin which lacks WS server)\r\n    const renderWS = `wss://ninedartnation.onrender.com/ws`\r\n    let url = normalizedEnv\r\n    if (!url) {\r\n      if (isLocalhost) {\r\n        url = `${proto}://${host}:8787/ws`\r\n      } else if (isRenderHost) {\r\n        url = sameOrigin\r\n      } else {\r\n        url = renderWS\r\n      }\r\n    }\r\n    // As a safety net for unusual ports, fall back to same-origin if all else fails\r\n    if (!url) url = sameOrigin\r\n    const socket = new WebSocket(url)\r\n    setWs(socket)\r\n    return socket\r\n  }\r\n  async function startPhonePairing() {\r\n    setMode('phone')\r\n    setPaired(false)\r\n    const socket = ensureWS()\r\n    if (socket.readyState === WebSocket.OPEN) {\r\n      socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      socket.onopen = () => socket.send(JSON.stringify({ type: 'cam-create' }))\r\n    }\r\n    socket.onmessage = async (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'cam-code') {\r\n        setPairCode(data.code)\r\n        if (data.expiresAt) setExpiresAt(data.expiresAt)\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        setPaired(true)\r\n        // Create offer to the phone\r\n        const peer = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n        setPc(peer)\r\n        peer.onicecandidate = (e) => {\r\n          if (e.candidate && pairCode) socket.send(JSON.stringify({ type: 'cam-ice', code: pairCode, payload: e.candidate }))\r\n        }\r\n        peer.ontrack = (ev) => {\r\n          if (videoRef.current) {\r\n            const inbound = ev.streams?.[0]\r\n            if (inbound) {\r\n              videoRef.current.srcObject = inbound\r\n              videoRef.current.play().catch(()=>{})\r\n              setStreaming(true)\r\n            }\r\n          }\r\n        }\r\n        const offer = await peer.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: true })\r\n        await peer.setLocalDescription(offer)\r\n        if (pairCode) socket.send(JSON.stringify({ type: 'cam-offer', code: pairCode, payload: offer }))\r\n      } else if (data.type === 'cam-answer') {\r\n        if (pc) await pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        if (pc) try { await pc.addIceCandidate(data.payload) } catch {}\r\n      }\r\n    }\r\n  }\r\n  function regenerateCode() {\r\n    setPairCode(null)\r\n    setExpiresAt(null)\r\n    setPaired(false)\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'cam-create' }))\r\n    } else {\r\n      startPhonePairing()\r\n    }\r\n    try { setPreferredCameraLocked(true) } catch {}\r\n  }\r\n\r\n  function stopAll() {\r\n    stop()\r\n    setPairCode(null)\r\n    setPaired(false)\r\n    setExpiresAt(null)\r\n    if (pc) { try { pc.close() } catch {}; setPc(null) }\r\n  }\r\n  return (\r\n    <CameraFrame \r\n      label={label} \r\n      autoStart={autoStart} \r\n      start={start} \r\n      stopAll={stopAll} \r\n      startPhonePairing={startPhonePairing} \r\n      startWifiConnection={startWifiConnection}\r\n      startUsbConnection={startUsbConnection}\r\n      connectToWifiDevice={connectToWifiDevice}\r\n      connectToUsbDevice={connectToUsbDevice}\r\n      videoRef={videoRef} \r\n      streaming={streaming} \r\n      mode={mode} \r\n      setMode={setMode} \r\n      pairCode={pairCode} \r\n      mobileUrl={mobileUrl} \r\n      ttl={ttl} \r\n      qrDataUrl={qrDataUrl} \r\n      regenerateCode={regenerateCode} \r\n      httpsInfo={httpsInfo} \r\n      showTips={showTips} \r\n      setShowTips={setShowTips} \r\n      wifiDevices={wifiDevices}\r\n      usbDevices={usbDevices}\r\n      discoveringWifi={discoveringWifi}\r\n      discoveringUsb={discoveringUsb}\r\n      scaleOverride={scaleOverride} \r\n      className={className}\r\n      aspect={aspect}\r\n      style={style}\r\n      fill={fill}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CameraFrame(props: any) {\r\n  const cameraSession = useCameraSession()\r\n  const { cameraScale, cameraAspect: storedAspect } = useUserSettings()\r\n  const {\r\n    label,\r\n    start,\r\n    stopAll,\r\n    startPhonePairing,\r\n    startWifiConnection,\r\n    startUsbConnection,\r\n    connectToWifiDevice,\r\n    connectToUsbDevice,\r\n    videoRef,\r\n    streaming,\r\n    mode,\r\n    setMode,\r\n    pairCode,\r\n    mobileUrl,\r\n    ttl,\r\n    qrDataUrl,\r\n    regenerateCode,\r\n    httpsInfo,\r\n    showTips,\r\n    setShowTips,\r\n    wifiDevices,\r\n    usbDevices,\r\n    discoveringWifi,\r\n    discoveringUsb,\r\n    className,\r\n    aspect,\r\n    style,\r\n    fill,\r\n  } = props\r\n\r\n  const [copyFeedback, setCopyFeedback] = useState<'link' | 'code' | null>(null)\r\n  const copyTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n    }\r\n  }, [])\r\n\r\n  // Respect stored aspect unless we're explicitly in full-bleed fill mode,\r\n  // in which case drop the aspect box so the video can truly cover the area.\r\n  const { cameraFitMode: globalFitMode } = useUserSettings()\r\n  const effectiveFitMode: 'fit' | 'fill' = fill ? 'fill' : (globalFitMode || 'fill')\r\n  // In fill mode we guarantee no black bars: never allow downscaling below 1.0\r\n  const scale = (() => {\r\n    const raw = Number(props.scaleOverride ?? cameraScale ?? 1)\r\n    const clamped = Math.max(0.5, Math.min(1.25, raw))\r\n    return effectiveFitMode === 'fill' ? Math.max(1, clamped) : clamped\r\n  })()\r\n  const aspectChoice: 'wide' | 'square' | 'portrait' | 'classic' | 'free' = (fill && effectiveFitMode === 'fill')\r\n    ? 'free'\r\n    : (aspect && aspect !== 'inherit')\r\n      ? aspect\r\n      : ((storedAspect as any) || 'wide')\r\n\r\n  const shouldMaintainAspect = aspectChoice !== 'free'\r\n  const aspectClass = shouldMaintainAspect\r\n    ? aspectChoice === 'square'\r\n      ? 'aspect-square'\r\n      : aspectChoice === 'portrait'\r\n        ? 'aspect-[3/4]'\r\n        : aspectChoice === 'classic'\r\n          ? 'aspect-[4/3]'\r\n          : 'aspect-video'\r\n    : ''\r\n\r\n  const containerBase = fill\r\n    ? 'rounded-2xl overflow-hidden bg-transparent w-full flex flex-col'\r\n    : 'rounded-2xl overflow-hidden bg-transparent w-full mx-auto flex flex-col'\r\n  const containerClass = [containerBase, className].filter(Boolean).join(' ').trim()\r\n  const containerStyle: CSSProperties = { ...(style || {}) }\r\n\r\n  const viewportClass = fill ? 'relative flex-1 min-h-[220px] bg-black' : 'relative w-full bg-black'\r\n\r\n  const commonVideoProps = {\r\n    style: { transform: `scale(${scale})`, transformOrigin: 'center' as const },\r\n  }\r\n\r\n  const videoElement = (() => {\r\n    // Apply Fit/Fill preference (fill prop hard-overrides to full-bleed)\r\n    const isFit = effectiveFitMode === 'fit'\r\n    const baseVideoClass = isFit\r\n      // Fit: preserve entire frame (may letterbox)\r\n      ? 'absolute inset-0 w-full h-full object-contain object-center bg-transparent'\r\n      // Fill: guarantee full coverage with object-cover so there are no black bars\r\n      : 'absolute inset-0 w-full h-full object-cover object-center bg-transparent'\r\n    if (fill) {\r\n      if (shouldMaintainAspect) {\r\n        return (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className={`relative w-full max-w-full max-h-full ${aspectClass}`}>\r\n              <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n      return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n    }\r\n    if (shouldMaintainAspect) {\r\n      return (\r\n        <div className={`relative w-full ${aspectClass}`}>\r\n          <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n        </div>\r\n      )\r\n    }\r\n    return <video ref={videoRef} className={baseVideoClass} {...commonVideoProps} />\r\n  })()\r\n\r\n  async function copyValue(value: string | null | undefined, type: 'link' | 'code') {\r\n    if (!value) return\r\n    try {\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const textarea = document.createElement('textarea')\r\n        textarea.value = value\r\n        textarea.style.position = 'fixed'\r\n        textarea.style.opacity = '0'\r\n        document.body.appendChild(textarea)\r\n        textarea.focus()\r\n        textarea.select()\r\n        document.execCommand('copy')\r\n        document.body.removeChild(textarea)\r\n      }\r\n      setCopyFeedback(type)\r\n      if (copyTimeoutRef.current) window.clearTimeout(copyTimeoutRef.current)\r\n      copyTimeoutRef.current = window.setTimeout(() => setCopyFeedback(null), 1500)\r\n    } catch (err) {\r\n      console.warn('Copy to clipboard failed:', err)\r\n      setCopyFeedback(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={containerClass} style={containerStyle}>\r\n      <div className={viewportClass}>\r\n        {videoElement}\r\n        {(cameraSession.isStreaming && (mode==='phone')) && (\r\n          <div className=\"absolute top-2 left-2 z-10 flex items-center gap-1 px-2 py-0.5 rounded-full bg-black/60 border border-rose-500/50 text-[10px] text-rose-200\">\r\n            <span className=\"inline-block w-2 h-2 rounded-full bg-rose-500 animate-pulse\" />\r\n            <span className=\"font-semibold\">REC</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n  <div className=\"p-1 flex items-center justify-between bg-black/60 text-white text-[10px] gap-1\">\r\n        <span className=\"truncate\">{label || (streaming ? (mode==='phone' ? 'PHONE LIVE' : mode==='wifi' ? 'WIFI LIVE' : 'LIVE') : 'Camera')}</span>\r\n        <div className=\"flex items-center gap-1\">\r\n          {!streaming && (\r\n            <>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='local'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('local'); start() }}>Local</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='phone'?'bg-emerald-600':'bg-slate-700'}`} onClick={startPhonePairing}>Phone</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='wifi'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('wifi'); startWifiConnection() }}>Wifi</button>\r\n              <button className={`px-1 py-0.5 rounded ${mode==='wifi'?'bg-emerald-600':'bg-slate-700'}`} onClick={() => { setMode('wifi'); startUsbConnection() }}>USB</button>\r\n            </>\r\n          )}\r\n          {streaming ? (\r\n            <button className=\"px-1 py-0.5 rounded bg-rose-600\" onClick={stopAll}>Stop</button>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n      {mode==='phone' && pairCode && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"text-xs opacity-80\">Launch on your mobile:</div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"mt-1 w-full text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2\"\r\n            onClick={() => copyValue(mobileUrl, 'link')}\r\n            title=\"Copy mobile camera link\"\r\n          >\r\n            <span className=\"flex-1 min-w-0 font-mono break-all\">{mobileUrl}</span>\r\n            <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'link' ? 'Copied!' : 'Copy'}</span>\r\n          </button>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            <a\r\n              href={mobileUrl}\r\n              target=\"_blank\"\r\n              rel=\"noreferrer\"\r\n              className=\"px-2 py-1 rounded border border-indigo-500/30 text-indigo-100 hover:bg-indigo-500/20 transition\"\r\n            >\r\n              Open link\r\n            </a>\r\n            <button\r\n              type=\"button\"\r\n              className=\"flex-1 text-left px-2 py-1 rounded bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-between gap-2\"\r\n              onClick={() => copyValue(pairCode, 'code')}\r\n              title=\"Copy pairing code\"\r\n            >\r\n              <span className=\"font-mono tracking-[0.3em] text-sm\">{pairCode}</span>\r\n              <span className=\"text-[9px] uppercase tracking-wide whitespace-nowrap text-emerald-200\">{copyFeedback === 'code' ? 'Copied!' : 'Copy'}</span>\r\n            </button>\r\n          </div>\r\n          {qrDataUrl && <img className=\"mt-1 w-[160px] h-[160px] bg-white rounded\" alt=\"Scan to open\" src={qrDataUrl} />}\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            {ttl !== null && <span>Expires in {ttl}s</span>}\r\n            <button className=\"px-1 py-0.5 rounded bg-slate-700\" onClick={regenerateCode}>Regenerate</button>\r\n          </div>\r\n          {showTips && (\r\n            <div className=\"mt-2 p-2 rounded bg-slate-900/60 border border-slate-700/50 text-slate-200\">\r\n              <div className=\"font-semibold mb-1\">Troubleshooting</div>\r\n              <ul className=\"list-disc pl-4 space-y-1\">\r\n                <li>Phone and desktop must be on the same Wi‑Fi network.</li>\r\n                <li>Allow the server through your firewall (ports 8787 and {httpsInfo?.https ? httpsInfo.port : 8788}).</li>\r\n                <li>On iPhone, use HTTPS links (QR will prefer https when enabled).</li>\r\n              </ul>\r\n              <div className=\"mt-2 text-right\"><button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>setShowTips(false)}>Hide tips</button></div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {mode==='wifi' && !streaming && (\r\n        <div className=\"p-2 text-white text-[10px] bg-black/50\">\r\n          <div className=\"font-semibold mb-2\">Scoring Devices</div>\r\n          \r\n          {/* WiFi Devices */}\r\n          <div className=\"mb-3\">\r\n            <div className=\"font-medium mb-1\">WiFi Devices</div>\r\n            {discoveringWifi ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning network...</span>\r\n              </div>\r\n            ) : wifiDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {wifiDevices.map((device: NetworkDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.ip}:{device.port}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToWifiDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Rescan WiFi</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No WiFi devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startWifiConnection}>Scan WiFi</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* USB Devices */}\r\n          <div>\r\n            <div className=\"font-medium mb-1\">USB Devices</div>\r\n            {discoveringUsb ? (\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white\"></div>\r\n                <span>Scanning USB...</span>\r\n              </div>\r\n            ) : usbDevices.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {usbDevices.map((device: USBDevice) => (\r\n                  <div key={device.id} className=\"flex items-center justify-between p-1 rounded bg-slate-900/60\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"font-medium truncate\">{device.name}</div>\r\n                      <div className=\"opacity-70 text-[9px]\">{device.type.toUpperCase()}</div>\r\n                    </div>\r\n                    <button \r\n                      className={`px-1 py-0.5 rounded text-[9px] ${\r\n                        device.status === 'connecting' ? 'bg-yellow-600' :\r\n                        device.status === 'online' ? 'bg-green-600' : 'bg-blue-600'\r\n                      }`}\r\n                      onClick={() => connectToUsbDevice(device)}\r\n                      disabled={device.status === 'connecting'}\r\n                    >\r\n                      {device.status === 'connecting' ? '...' : 'Connect'}\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n                <div className=\"text-center mt-2\">\r\n                  <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Rescan USB</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center\">\r\n                <div className=\"mb-1 opacity-70\">No USB devices found</div>\r\n                <button className=\"px-1 py-0.5 rounded bg-slate-700 text-[9px]\" onClick={startUsbConnection}>Scan USB</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\nexport type VisitAudit = {\r\n  ts: number\r\n  mode: string\r\n  darts: number\r\n  visitTotal: number\r\n  preOpenDarts?: number\r\n  preRemaining?: number\r\n  postRemaining?: number\r\n  bust?: boolean\r\n  finish?: boolean\r\n}\r\n\r\ntype CalibrationAudit = {\r\n  hasHomography: boolean\r\n  imageSize?: { w: number; h: number } | null\r\n  lastUpdated?: number\r\n}\r\n\r\ntype AuditState = {\r\n  // Rolling buffer of recent visits\r\n  recent: VisitAudit[]\r\n  // Aggregates\r\n  totals: {\r\n    visits: number\r\n    darts: number\r\n    points: number\r\n    finishes: number\r\n    busts: number\r\n    byMode: Record<string, { visits: number; darts: number; points: number }>\r\n  }\r\n  calibration: CalibrationAudit\r\n  recordVisit: (mode: string, darts: number, visitTotal: number, meta?: Partial<VisitAudit>) => void\r\n  setCalibrationStatus: (c: Partial<CalibrationAudit>) => void\r\n  reset: () => void\r\n}\r\n\r\nexport const useAudit = create<AuditState>((set, get) => ({\r\n  recent: [],\r\n  totals: { visits: 0, darts: 0, points: 0, finishes: 0, busts: 0, byMode: {} },\r\n  calibration: { hasHomography: false, imageSize: null, lastUpdated: undefined },\r\n  recordVisit: (mode, darts, visitTotal, meta) => set((state) => {\r\n    const ts = Date.now()\r\n    const item: VisitAudit = {\r\n      ts,\r\n      mode,\r\n      darts,\r\n      visitTotal,\r\n      preOpenDarts: meta?.preOpenDarts,\r\n      preRemaining: meta?.preRemaining,\r\n      postRemaining: meta?.postRemaining,\r\n      bust: meta?.bust,\r\n      finish: meta?.finish,\r\n    }\r\n    const recent = [...state.recent, item].slice(-50)\r\n    const totals = { ...state.totals }\r\n    totals.visits += 1\r\n    totals.darts += darts\r\n    totals.points += visitTotal\r\n    if (item.finish) totals.finishes += 1\r\n    if (item.bust) totals.busts += 1\r\n    const bm = totals.byMode[mode] || { visits: 0, darts: 0, points: 0 }\r\n    bm.visits += 1\r\n    bm.darts += darts\r\n    bm.points += visitTotal\r\n    totals.byMode[mode] = bm\r\n    // Console surface for quick verification without UI changes\r\n    try {\r\n      const tag = item.finish ? 'FINISH' : (item.bust ? 'BUST' : 'VISIT')\r\n      console.info(`[Audit:${tag}]`, {\r\n        mode,\r\n        darts,\r\n        visitTotal,\r\n        preOpenDarts: item.preOpenDarts ?? 0,\r\n        preRemaining: item.preRemaining,\r\n        postRemaining: item.postRemaining,\r\n      })\r\n    } catch {}\r\n    // Persist recent visits to localStorage so Home can show recent across reloads\r\n    try {\r\n      localStorage.setItem('ndn_audit_recent', JSON.stringify(recent))\r\n    } catch {}\r\n    return { ...state, recent, totals }\r\n  }),\r\n  setCalibrationStatus: (c) => set((state) => {\r\n    const updated: CalibrationAudit = {\r\n      hasHomography: c.hasHomography ?? state.calibration.hasHomography,\r\n      imageSize: c.imageSize === undefined ? state.calibration.imageSize : c.imageSize,\r\n      lastUpdated: Date.now(),\r\n    }\r\n    try {\r\n      console.info('[Audit:Calibration]', updated)\r\n    } catch {}\r\n    return { ...state, calibration: updated }\r\n  }),\r\n  reset: () => set({\r\n    recent: [],\r\n    totals: { visits: 0, darts: 0, points: 0, finishes: 0, busts: 0, byMode: {} },\r\n    calibration: { hasHomography: false, imageSize: null, lastUpdated: undefined },\r\n  })\r\n}))\r\n\r\n// Expose a tiny debug hook on window for manual checks when needed\r\ntry {\r\n  // @ts-ignore\r\n  if (typeof window !== 'undefined') (window as any).__NDN_AUDIT__ = {\r\n    get: () => useAudit.getState(),\r\n    subscribe: useAudit.subscribe,\r\n    reset: () => useAudit.getState().reset(),\r\n  }\r\n} catch {}\r\n\r\n// Initialize persisted recent visits if present\r\ntry {\r\n  if (typeof window !== 'undefined') {\r\n    const raw = localStorage.getItem('ndn_audit_recent')\r\n    if (raw) {\r\n      const arr = JSON.parse(raw)\r\n      if (Array.isArray(arr) && arr.length) {\r\n        useAudit.setState((s) => ({ ...s, recent: arr.slice(-50) }))\r\n      }\r\n    }\r\n  }\r\n} catch {}\r\n","import { create } from 'zustand'\r\nimport { useAudit } from './audit'\r\n\r\nexport type ThrowVisit = {\r\n  darts: number\r\n  score: number\r\n  preOpenDarts?: number // exclude from avg in Double-In\r\n  doubleWindowDarts?: number // darts thrown while remaining <= 50 (double-out window) in this visit\r\n  finishedByDouble?: boolean // visit ended the leg with a double or inner bull\r\n  visitTotal?: number // convenience to detect 180s and summaries\r\n}\r\nexport type Leg = {\r\n  visits: ThrowVisit[]\r\n  totalScoreStart: number // e.g., 501\r\n  totalScoreRemaining: number\r\n  dartsThrown: number\r\n  finished: boolean\r\n  checkoutScore: number | null // score taken on final visit to finish leg\r\n  startTime: number\r\n  endTime?: number\r\n}\r\n\r\nexport type Player = {\r\n  id: string\r\n  name: string\r\n  legsWon: number\r\n  legs: Leg[]\r\n  bestThreeDartAvg?: number\r\n  worstThreeDartAvg?: number\r\n  bestNineDart?: { darts: number; timestamp: number }\r\n  bestCheckout?: number\r\n}\r\n\r\nexport type MatchState = {\r\n  roomId: string\r\n  players: Player[]\r\n  currentPlayerIdx: number\r\n  startingScore: number\r\n  inProgress: boolean\r\n  bestLegThisMatch?: { playerId: string; darts: number; timestamp: number }\r\n}\r\n\r\nfunction calcThreeDartAvg(leg: Leg): number {\r\n  if (leg.dartsThrown === 0) return 0\r\n  const scored = leg.totalScoreStart - leg.totalScoreRemaining\r\n  return (scored / leg.dartsThrown) * 3\r\n}\r\n\r\nfunction finishedLegStats(leg: Leg) {\r\n  // compute 3-dart avg, was it a 9-dart (or lowest darts)?\r\n  const avg = calcThreeDartAvg(leg)\r\n  const isCompleted = leg.finished\r\n  return { avg, isCompleted, darts: leg.dartsThrown, checkout: leg.checkoutScore ?? 0 }\r\n}\r\n\r\nfunction updatePlayerEndOfGameStats(player: Player) {\r\n  if (player.legs.length === 0) return\r\n  const avgs: number[] = []\r\n  let bestNine: { darts: number; timestamp: number } | undefined\r\n  let bestCheckout = player.bestCheckout ?? 0\r\n\r\n  for (const leg of player.legs) {\r\n    if (!leg.finished) continue\r\n    const st = finishedLegStats(leg)\r\n    avgs.push(st.avg)\r\n    // best \"9-dart leg\" meaning fewest darts; if tie pick earliest\r\n    if (!bestNine || st.darts < bestNine.darts || (st.darts === bestNine.darts && (leg.endTime ?? 0) < bestNine.timestamp)) {\r\n      bestNine = { darts: st.darts, timestamp: leg.endTime ?? Date.now() }\r\n    }\r\n    if (st.checkout > bestCheckout) bestCheckout = st.checkout\r\n  }\r\n\r\n  if (avgs.length) {\r\n    player.bestThreeDartAvg = Math.max(...avgs)\r\n    player.worstThreeDartAvg = Math.min(...avgs)\r\n  }\r\n  if (bestNine) player.bestNineDart = bestNine\r\n  player.bestCheckout = bestCheckout\r\n}\r\n\r\nexport type Actions = {\r\n  newMatch: (players: string[], startingScore: number, roomId?: string) => void\r\n  addVisit: (score: number, darts: number, meta?: { preOpenDarts?: number; doubleWindowDarts?: number; finishedByDouble?: boolean; visitTotal?: number }) => void\r\n  undoVisit: () => void\r\n  endLeg: (checkoutScore: number) => void\r\n  nextPlayer: () => void\r\n  endGame: () => void\r\n  importState: (state: MatchState) => void\r\n}\r\n\r\nexport const useMatch = create<MatchState & Actions>((set, get) => ({\r\n  roomId: '',\r\n  players: [],\r\n  currentPlayerIdx: 0,\r\n  startingScore: 501,\r\n  inProgress: false,\r\n\r\n  newMatch: (playerNames, startingScore, roomId='') => set(() => {\r\n    const players = playerNames.map((name, i) => ({\r\n      id: `${i}`,\r\n      name,\r\n      legsWon: 0,\r\n      legs: [],\r\n    } as Player))\r\n    return { players, currentPlayerIdx: 0, startingScore, inProgress: true, roomId, bestLegThisMatch: undefined }\r\n  }),\r\n\r\n  addVisit: (score, darts, meta) => set((state) => {\r\n    if (!state.inProgress) return state\r\n    const p = state.players[state.currentPlayerIdx]\r\n    // ensure a current leg exists\r\n    let leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished) {\r\n      leg = {\r\n        visits: [], totalScoreStart: state.startingScore, totalScoreRemaining: state.startingScore,\r\n        dartsThrown: 0, finished: false, checkoutScore: null, startTime: Date.now()\r\n      }\r\n      p.legs.push(leg)\r\n    }\r\n    const preRem = leg.totalScoreRemaining\r\n    const postRem = Math.max(0, preRem - score)\r\n  leg.visits.push({ darts, score, preOpenDarts: meta?.preOpenDarts, doubleWindowDarts: meta?.doubleWindowDarts, finishedByDouble: meta?.finishedByDouble, visitTotal: meta?.visitTotal ?? score })\r\n    leg.dartsThrown += darts\r\n    leg.totalScoreRemaining = postRem\r\n    // Audit record (best-effort; ignore failures)\r\n    try {\r\n      const bust = score === 0 && darts > 0 && postRem === preRem\r\n      const finish = postRem === 0\r\n      useAudit.getState().recordVisit('x01-match', darts, score, {\r\n        preOpenDarts: meta?.preOpenDarts ?? 0,\r\n        preRemaining: preRem,\r\n        postRemaining: postRem,\r\n        bust,\r\n        finish,\r\n      })\r\n    } catch {}\r\n    return { ...state }\r\n  }),\r\n\r\n  undoVisit: () => set((state) => {\r\n    const p = state.players[state.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished || leg.visits.length === 0) return state\r\n    const last = leg.visits.pop()!\r\n    leg.dartsThrown -= last.darts\r\n    leg.totalScoreRemaining += last.score\r\n    return { ...state }\r\n  }),\r\n\r\n  endLeg: (checkoutScore) => set((state) => {\r\n    const p = state.players[state.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg || leg.finished) return state\r\n    leg.finished = true\r\n    leg.checkoutScore = checkoutScore\r\n    leg.endTime = Date.now()\r\n    if (leg.totalScoreRemaining === 0) {\r\n      p.legsWon += 1\r\n      // Check if this leg is the new best for this match (fewest darts)\r\n      const best = state.bestLegThisMatch\r\n      if (!best || (leg.dartsThrown < best.darts)) {\r\n        state.bestLegThisMatch = { playerId: p.id, darts: leg.dartsThrown, timestamp: leg.endTime }\r\n      }\r\n    }\r\n    return { ...state }\r\n  }),\r\n\r\n  nextPlayer: () => set((state) => ({\r\n    ...state,\r\n    currentPlayerIdx: (state.currentPlayerIdx + 1) % state.players.length\r\n  })),\r\n\r\n  endGame: () => set((state) => {\r\n    // Only now compute best/worst 3-dart, best 9-dart, best checkout\r\n    for (const p of state.players) updatePlayerEndOfGameStats(p)\r\n    return { ...state, inProgress: false }\r\n  }),\r\n\r\n  importState: (newState) => set(() => ({ ...newState })),\r\n}))\r\n","import type { Homography, Point } from './vision'\r\nimport { imageToBoard, scoreAtBoardPoint } from './vision'\r\n\r\nexport function scoreFromImagePoint(H_boardToImage: Homography, pImg: Point) {\r\n\tconst pBoard = imageToBoard(H_boardToImage, pImg)\r\n\treturn scoreAtBoardPoint(pBoard)\r\n}\r\n","// High-accuracy dart detector for built-in autoscore\r\n// Strategy:\r\n// - Maintain a grayscale background model (running average) when no darts are present\r\n// - For each frame, compute abs-diff mask vs background and apply a 3x3 morphological closing to reduce noise\r\n// - Restrict detection to a circular ROI around board center (from calibration) to ignore background\r\n// - Find the largest foreground blob; compute PCA on blob pixels to estimate shaft orientation\r\n// - Estimate the tip as the extreme along the principal axis in the outward radial direction from board center\r\n// - Stabilize across consecutive frames (2+) before emitting a detection; debounce between darts\r\n\r\nexport type Point = { x: number; y: number }\r\n\r\nexport type DartDetection = {\r\n  tip: Point\r\n  axis?: { x1: number; y1: number; x2: number; y2: number }\r\n  area: number\r\n  bbox: { x: number; y: number; w: number; h: number }\r\n  confidence: number // 0..1 heuristic\r\n}\r\n\r\nexport class DartDetector {\r\n  private width = 0\r\n  private height = 0\r\n  private bg: Float32Array | null = null // grayscale background\r\n  private lastAcceptTs = 0\r\n  private cooldownMs = 600\r\n  private roiRadius = 0 // pixels; 0 means disabled\r\n  private roiCx = 0\r\n  private roiCy = 0\r\n  private initialized = false\r\n\r\n  // Tuning\r\n  private thresh = 28 // intensity threshold for foreground\r\n  private minArea = 90 // min connected pixels to consider a dart\r\n  private maxArea = 6000 // guard against massive motion\r\n  // temporal stabilization\r\n  private prevTip: Point | null = null\r\n  private prevArea: number = 0\r\n  private stableCount = 0\r\n  private requireStableN = 2\r\n\r\n  constructor() {}\r\n\r\n  setROI(cx: number, cy: number, radius: number) {\r\n    this.roiCx = cx; this.roiCy = cy; this.roiRadius = Math.max(0, radius|0)\r\n  }\r\n\r\n  reset(width: number, height: number) {\r\n    this.width = width\r\n    this.height = height\r\n    this.bg = new Float32Array(width * height)\r\n    this.initialized = false\r\n  }\r\n\r\n  // Seed or update background model with the provided frame\r\n  // If not initialized, copy; else running average with small alpha\r\n  updateBackground(frame: ImageData, alpha = 0.05) {\r\n    const { width: w, height: h, data } = frame\r\n    if (!this.bg || w !== this.width || h !== this.height) {\r\n      this.reset(w, h)\r\n    }\r\n    const bg = this.bg!\r\n    const n = w * h\r\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\r\n      const r = data[p], g = data[p+1], b = data[p+2]\r\n      const gray = 0.299*r + 0.587*g + 0.114*b\r\n      if (!this.initialized) bg[i] = gray\r\n      else bg[i] = (1 - alpha) * bg[i] + alpha * gray\r\n    }\r\n    this.initialized = true\r\n  }\r\n\r\n  private inRoi(x: number, y: number): boolean {\r\n    if (this.roiRadius <= 0) return true\r\n    const dx = x - this.roiCx\r\n    const dy = y - this.roiCy\r\n    return (dx*dx + dy*dy) <= this.roiRadius * this.roiRadius\r\n  }\r\n\r\n  // Returns a detection if a new dart-like blob is found; null otherwise\r\n  detect(frame: ImageData): DartDetection | null {\r\n    const now = Date.now()\r\n    const recent = (now - this.lastAcceptTs) < this.cooldownMs\r\n    const { width: w, height: h, data } = frame\r\n    if (!this.bg || w !== this.width || h !== this.height) this.reset(w, h)\r\n    const bg = this.bg!\r\n    if (!this.initialized) {\r\n      this.updateBackground(frame, 1.0)\r\n      return null\r\n    }\r\n\r\n    // Build diff buffer and compute dynamic threshold excluding specular highlights\r\n    const n = w * h\r\n    const mask = new Uint8Array(n)\r\n    const diff = new Float32Array(n)\r\n    let sum = 0, sum2 = 0, cnt = 0\r\n    const isHighlight = new Uint8Array(n)\r\n    for (let i = 0, p = 0; i < n; i++, p += 4) {\r\n      const r = data[p], g = data[p+1], b = data[p+2]\r\n      const maxc = Math.max(r, g, b)\r\n      const minc = Math.min(r, g, b)\r\n      const gray = 0.299*r + 0.587*g + 0.114*b\r\n      const d = Math.abs(gray - bg[i])\r\n      diff[i] = d\r\n      const y = Math.floor(i / w)\r\n      const x = i - y * w\r\n      // specular highlight heuristic: very bright with low chroma\r\n      const satApprox = maxc === 0 ? 0 : (maxc - minc) / maxc\r\n      const isHi = (maxc >= 250) && (satApprox <= 0.12)\r\n      if (isHi) isHighlight[i] = 1\r\n      if (this.inRoi(x, y) && !isHi) { sum += d; sum2 += d*d; cnt++ }\r\n    }\r\n    const mu = cnt ? (sum / cnt) : 0\r\n    const var_ = cnt ? Math.max(0, (sum2 / cnt) - mu*mu) : 0\r\n    const sigma = Math.sqrt(var_)\r\n    const dynamicThresh = Math.max(this.thresh, mu + 1.2 * sigma)\r\n    // Rebuild mask using dynamic threshold and ignoring highlights\r\n    for (let i = 0; i < n; i++) {\r\n      if (isHighlight[i]) { mask[i] = 0; continue }\r\n      if (diff[i] > dynamicThresh) {\r\n        const y = Math.floor(i / w)\r\n        const x = i - y * w\r\n        mask[i] = this.inRoi(x, y) ? 1 : 0\r\n      }\r\n    }\r\n\r\n    // Morphological closing (dilate then erode) to consolidate thin shapes\r\n    this._dilate(mask, w, h)\r\n    this._erode(mask, w, h)\r\n\r\n    // Connected components (single pass using queue BFS); track largest blob\r\n    const visited = new Uint8Array(n)\r\n    let bestArea = 0\r\n    let bestIdxs: number[] | null = null\r\n    for (let i = 0; i < n; i++) {\r\n      if (mask[i] === 0 || visited[i]) continue\r\n      const idxs: number[] = []\r\n      let area = 0\r\n      let qh = 0\r\n      const q: number[] = [i]\r\n      visited[i] = 1\r\n      while (qh < q.length) {\r\n        const cur = q[qh++]\r\n        idxs.push(cur)\r\n        area++\r\n        const y = (cur / w) | 0\r\n        const x = cur - y * w\r\n        // 4-neighborhood\r\n        const nbs = [cur - 1, cur + 1, cur - w, cur + w]\r\n        for (const nb of nbs) {\r\n          if (nb < 0 || nb >= n) continue\r\n          if (visited[nb]) continue\r\n          // bounds checks for left/right\r\n          if ((nb === cur - 1 || nb === cur + 1) && ((nb / w | 0) !== y)) continue\r\n          if (mask[nb]) { visited[nb] = 1; q.push(nb) }\r\n        }\r\n      }\r\n      if (area > bestArea) { bestArea = area; bestIdxs = idxs }\r\n    }\r\n\r\n    if (!bestIdxs || bestArea < this.minArea || bestArea > this.maxArea) {\r\n      // Slowly update background when no valid detection to adapt lighting\r\n      if (!recent) this.updateBackground(frame, 0.02)\r\n      return null\r\n    }\r\n\r\n    // Compute PCA (covariance) on blob pixels to estimate shaft orientation\r\n    let minX = w, minY = h, maxX = 0, maxY = 0\r\n    let meanX = 0, meanY = 0\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0\r\n      const x = idx - y * w\r\n      meanX += x; meanY += y\r\n      if (x < minX) minX = x\r\n      if (x > maxX) maxX = x\r\n      if (y < minY) minY = y\r\n      if (y > maxY) maxY = y\r\n    }\r\n    meanX /= bestArea; meanY /= bestArea\r\n    let cxx = 0, cyy = 0, cxy = 0\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0\r\n      const x = idx - y * w\r\n      const dx = x - meanX\r\n      const dy = y - meanY\r\n      cxx += dx * dx; cyy += dy * dy; cxy += dx * dy\r\n    }\r\n    cxx /= bestArea; cyy /= bestArea; cxy /= bestArea\r\n    // Principal axis (eigenvector of covariance with largest eigenvalue)\r\n    // For 2x2 symmetric matrix [[cxx,cxy],[cxy,cyy]], eigenvector for largest eigenvalue lambda satisfies (cxx-l)x + cxy y = 0\r\n    const trace = cxx + cyy\r\n    const det = cxx * cyy - cxy * cxy\r\n    const tmp = Math.sqrt(Math.max(0, trace*trace/4 - det))\r\n    const l1 = trace/2 + tmp // largest eigenvalue\r\n    // eigenvector v = (cxy, l1 - cxx) or (l1 - cyy, cxy); choose longer\r\n    let vx = cxy, vy = l1 - cxx\r\n    if (Math.hypot(vx, vy) < 1e-6) { vx = l1 - cyy; vy = cxy }\r\n    const vlen = Math.hypot(vx, vy) || 1\r\n    vx /= vlen; vy /= vlen\r\n\r\n    // Determine which direction along the axis points outward from board center\r\n    const dxc = meanX - this.roiCx\r\n    const dyc = meanY - this.roiCy\r\n    const outward = (dxc * vx + dyc * vy) > 0 ? 1 : -1\r\n    vx *= outward; vy *= outward\r\n\r\n    // Enforce radial alignment: reject if principal axis deviates too much from radial direction\r\n    const rlen = Math.hypot(dxc, dyc) || 1\r\n    const rx = dxc / rlen, ry = dyc / rlen\r\n    const cosAng = Math.max(-1, Math.min(1, vx * rx + vy * ry))\r\n    const angDeg = Math.acos(cosAng) * 180 / Math.PI\r\n    if (angDeg > 55) {\r\n      // likely glare or non-radial artifact\r\n      if (!recent) this.updateBackground(frame, 0.02)\r\n      return null\r\n    }\r\n\r\n    // Project all blob points onto axis and pick extreme (max t) as tip candidate\r\n    let maxT = -Infinity\r\n    let tipX = meanX, tipY = meanY\r\n    for (const idx of bestIdxs) {\r\n      const y = (idx / w) | 0\r\n      const x = idx - y * w\r\n      const t = (x - meanX) * vx + (y - meanY) * vy\r\n      if (t > maxT) { maxT = t; tipX = x; tipY = y }\r\n    }\r\n\r\n    // Distance to center for confidence heuristic\r\n    const dxr = tipX - this.roiCx\r\n    const dyr = tipY - this.roiCy\r\n    const minR2 = dxr*dxr + dyr*dyr\r\n\r\n    // Confidence heuristic based on compactness and radial extent\r\n    const bboxW = Math.max(1, maxX - minX + 1)\r\n    const bboxH = Math.max(1, maxY - minY + 1)\r\n    const bboxArea = bboxW * bboxH\r\n    const fill = bestArea / bboxArea // 0..1 (thin dart should be small fill)\r\n    const radial = Math.sqrt(minR2) / Math.max(1, this.roiRadius)\r\n    let confidence = 0.5\r\n    // Prefer thin elongated shapes with small fill and inside ROI\r\n    if (fill < 0.45) confidence += 0.2\r\n    if (fill < 0.25) confidence += 0.15\r\n    if (radial < 1.1) confidence += 0.1\r\n    // Orientation confidence: larger principal eigenvalue vs minor\r\n    const l2 = trace - l1\r\n    const elong = (l1 > 0) ? (1 - (l2 / l1)) : 0\r\n    if (elong > 0.3) confidence += 0.1\r\n    confidence = Math.max(0, Math.min(1, confidence))\r\n\r\n    // Update background outside the blob to keep stability\r\n    // Optionally, we can inpaint the blob into background upon acceptance by caller\r\n\r\n    // Temporal stabilization: require 2+ consistent frames for the same dart\r\n    const stable = this._isStable({ x: tipX + 0.5, y: tipY + 0.5 }, bestArea)\r\n    if (!stable) return null\r\n    // Debounce\r\n    if (recent) return null\r\n\r\n    return {\r\n      tip: { x: tipX + 0.5, y: tipY + 0.5 },\r\n      axis: { x1: meanX - vx*20, y1: meanY - vy*20, x2: meanX + vx*20, y2: meanY + vy*20 },\r\n      area: bestArea,\r\n      bbox: { x: minX, y: minY, w: bboxW, h: bboxH },\r\n      confidence,\r\n    }\r\n  }\r\n\r\n  // Incorporate the accepted detection into background so it won't trigger again\r\n  accept(frame: ImageData, det: DartDetection) {\r\n    this.lastAcceptTs = Date.now()\r\n    // reset temporal stabilization for next dart\r\n    this.prevTip = null\r\n    this.prevArea = 0\r\n    this.stableCount = 0\r\n    if (!this.bg) return\r\n    const { width: w } = frame\r\n    const bg = this.bg\r\n    const { x, y, w: bw, h: bh } = det.bbox\r\n    const alpha = 0.5\r\n    for (let yy = y; yy < y + bh; yy++) {\r\n      for (let xx = x; xx < x + bw; xx++) {\r\n        const i = yy * w + xx\r\n        const p = i * 4\r\n        const r = frame.data[p], g = frame.data[p+1], b = frame.data[p+2]\r\n        const gray = 0.299*r + 0.587*g + 0.114*b\r\n        bg[i] = (1 - alpha) * bg[i] + alpha * gray\r\n      }\r\n    }\r\n  }\r\n\r\n  // --- helpers ---\r\n  private _isStable(tip: Point, area: number): boolean {\r\n    const close = (a: Point, b: Point) => Math.hypot(a.x - b.x, a.y - b.y) <= 6\r\n    if (!this.prevTip) {\r\n      this.prevTip = { ...tip }\r\n      this.prevArea = area\r\n      this.stableCount = 1\r\n      return false\r\n    }\r\n    if (close(this.prevTip, tip) && Math.abs(area - this.prevArea) / Math.max(1, area) < 0.3) {\r\n      this.prevTip = { ...tip }\r\n      this.prevArea = area\r\n      this.stableCount++\r\n    } else {\r\n      this.prevTip = { ...tip }\r\n      this.prevArea = area\r\n      this.stableCount = 1\r\n      return false\r\n    }\r\n    return this.stableCount >= this.requireStableN\r\n  }\r\n\r\n  private _dilate(mask: Uint8Array, w: number, h: number) {\r\n    const out = new Uint8Array(mask.length)\r\n    for (let y = 0; y < h; y++) {\r\n      for (let x = 0; x < w; x++) {\r\n        let on = 0\r\n        for (let j = -1; j <= 1; j++) {\r\n          for (let i = -1; i <= 1; i++) {\r\n            const yy = y + j, xx = x + i\r\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue\r\n            if (mask[yy*w + xx]) { on = 1; break }\r\n          }\r\n          if (on) break\r\n        }\r\n        out[y*w + x] = on\r\n      }\r\n    }\r\n    mask.set(out)\r\n  }\r\n\r\n  private _erode(mask: Uint8Array, w: number, h: number) {\r\n    const out = new Uint8Array(mask.length)\r\n    for (let y = 0; y < h; y++) {\r\n      for (let x = 0; x < w; x++) {\r\n        let on = 1\r\n        for (let j = -1; j <= 1; j++) {\r\n          for (let i = -1; i <= 1; i++) {\r\n            const yy = y + j, xx = x + i\r\n            if (yy < 0 || yy >= h || xx < 0 || xx >= w) continue\r\n            if (!mask[yy*w + xx]) { on = 0; break }\r\n          }\r\n          if (!on) break\r\n        }\r\n        out[y*w + x] = on\r\n      }\r\n    }\r\n    mask.set(out)\r\n  }\r\n}\r\n","// Generic autoscore provider helpers: parse vendor-agnostic payloads and subscribe via WebSocket\r\n\r\nexport type Ring = 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\nexport type ParsedDart = { value: number; ring: Ring; sector?: number|null; mult?: 0|1|2|3 }\r\n\r\n// Try to parse a variety of vendor payload shapes\r\nexport function parseExternalDart(data: any): ParsedDart | null {\r\n  try {\r\n    if (!data || typeof data !== 'object') return null\r\n    // 1) { type:'dart', value: <0-60>, ring: 'SINGLE'|'DOUBLE'|... }\r\n    if ((data.type === 'dart' || data.kind === 'dart' || data.event === 'dart') && typeof data.value === 'number') {\r\n      const ring = normalizeRing(data.ring)\r\n      return finalizeFromValue(data.value, ring)\r\n    }\r\n    // 2) { value, ring }\r\n    if (typeof data.value === 'number' && data.ring) {\r\n      const ring = normalizeRing(data.ring)\r\n      return finalizeFromValue(data.value, ring)\r\n    }\r\n    // 3) { score: 'T20'|'D16'|'S5'|'25'|'50' }\r\n    if (typeof data.score === 'string') {\r\n      const s = data.score.trim().toUpperCase()\r\n      if (s === '50' || s === 'DBULL' || s === 'INNER_BULL') return { value: 50, ring: 'INNER_BULL', sector: null, mult: 0 }\r\n      if (s === '25' || s === 'BULL' || s === 'OBULL') return { value: 25, ring: 'BULL', sector: null, mult: 0 }\r\n      const m = s.match(/^(S|D|T)(\\d{1,2})$/)\r\n      if (m) {\r\n        const mult = m[1] === 'S' ? 1 : m[1] === 'D' ? 2 : 3\r\n        const sec = parseInt(m[2],10)\r\n        if (sec >=1 && sec <= 20) return { value: sec*mult, ring: mult===1?'SINGLE':mult===2?'DOUBLE':'TRIPLE', sector: sec, mult: mult as 1|2|3 }\r\n      }\r\n    }\r\n    // 4) { sector: 1..20, mult: 1|2|3 }\r\n    if (typeof data.sector === 'number' && typeof data.mult === 'number') {\r\n      const sec = Math.max(1, Math.min(20, Math.floor(data.sector)))\r\n      const mul = data.mult===1?1:data.mult===2?2:3\r\n      return { value: sec*mul, ring: mul===1?'SINGLE':mul===2?'DOUBLE':'TRIPLE', sector: sec, mult: mul as 1|2|3 }\r\n    }\r\n    // 5) { bull: 'outer'|'inner'|true }\r\n    if (data.bull) {\r\n      const inner = String(data.bull).toLowerCase() === 'inner' || data.bull === true\r\n      return { value: inner?50:25, ring: inner?'INNER_BULL':'BULL', sector: null, mult: 0 }\r\n    }\r\n  } catch {}\r\n  return null\r\n}\r\n\r\nfunction normalizeRing(r: any): Ring {\r\n  const s = String(r||'').toUpperCase()\r\n  if (s.startsWith('TR')) return 'TRIPLE'\r\n  if (s.startsWith('DO')) return 'DOUBLE'\r\n  if (s.startsWith('SI')) return 'SINGLE'\r\n  if (s === 'INNER_BULL' || s === 'DBULL' || s === '50' || s === 'IBULL') return 'INNER_BULL'\r\n  if (s === 'BULL' || s === '25' || s === 'OBULL' || s === 'OUTER_BULL') return 'BULL'\r\n  if (s === 'MISS' || s === '0') return 'MISS'\r\n  return 'SINGLE'\r\n}\r\n\r\nfunction finalizeFromValue(value: number, ring: Ring): ParsedDart | null {\r\n  const v = Math.max(0, Math.min(60, Math.round(Number(value)||0)))\r\n  if (ring === 'INNER_BULL') return { value: 50, ring }\r\n  if (ring === 'BULL') return { value: 25, ring }\r\n  // Best-effort: preserve base if consistent with ring\r\n  return { value: v, ring }\r\n}\r\n\r\nexport type ExternalSub = { close: () => void }\r\n\r\nexport function subscribeExternalWS(url: string, onDart: (d: ParsedDart) => void): ExternalSub {\r\n  let socket: WebSocket | null = null\r\n  let alive = true\r\n  // Lightweight duplicate suppression: ignore exact repeat within a short window\r\n  let lastSig: string | null = null\r\n  let lastSigAt = 0\r\n  const DEDUP_WINDOW_MS = 400\r\n  // Optional ID-based dedup if provider sends unique ids\r\n  const seenIds: string[] = []\r\n  const seenSet = new Set<string>()\r\n\r\n  function considerForward(payload: any, parsed: ParsedDart) {\r\n    // If payload has a stable id, drop if seen\r\n    const pid = typeof payload?.id === 'string' || typeof payload?.id === 'number' ? String(payload.id) : null\r\n    if (pid) {\r\n      if (seenSet.has(pid)) return\r\n      seenSet.add(pid)\r\n      seenIds.push(pid)\r\n      if (seenIds.length > 200) {\r\n        const old = seenIds.shift()\r\n        if (old) seenSet.delete(old)\r\n      }\r\n    }\r\n    // Time-based dedup by signature (safe; darts cannot occur within <400ms)\r\n    const sig = `${parsed.value}|${parsed.ring}|${parsed.sector ?? ''}|${parsed.mult ?? ''}`\r\n    const now = Date.now()\r\n    if (sig === lastSig && now - lastSigAt < DEDUP_WINDOW_MS) return\r\n    lastSig = sig\r\n    lastSigAt = now\r\n    onDart(parsed)\r\n  }\r\n\r\n  function connect() {\r\n    if (!alive) return\r\n    try {\r\n      socket = new WebSocket(url)\r\n      socket.onmessage = (ev) => {\r\n        try {\r\n          const payload = JSON.parse(ev.data)\r\n          const parsed = parseExternalDart(payload)\r\n          if (parsed) considerForward(payload, parsed)\r\n        } catch {}\r\n      }\r\n      socket.onclose = () => { socket = null; setTimeout(connect, 1500) }\r\n      socket.onerror = () => { /* ignore; will reconnect on close */ }\r\n    } catch {\r\n      setTimeout(connect, 2000)\r\n    }\r\n  }\r\n  connect()\r\n  return { close: () => { alive = false; try { socket?.close() } catch {} } }\r\n}\r\n","import React, { useEffect, useRef, useState, type ReactNode, type CSSProperties } from 'react'\r\n\r\ntype Props = {\r\n  storageKey: string\r\n  children: ReactNode\r\n  className?: string\r\n  defaultWidth?: number\r\n  defaultHeight?: number\r\n  minWidth?: number\r\n  minHeight?: number\r\n  maxWidth?: number\r\n  maxHeight?: number\r\n  autoFill?: boolean\r\n}\r\n\r\ntype Size = { width?: number; height?: number }\r\n\r\nexport default function ResizablePanel({\r\n  storageKey,\r\n  children,\r\n  className,\r\n  defaultWidth = 640,\r\n  defaultHeight = 360,\r\n  minWidth = 320,\r\n  minHeight = 200,\r\n  maxWidth = 1600,\r\n  maxHeight = 1200,\r\n  autoFill = false,\r\n}: Props) {\r\n  const [size, setSize] = useState<Size>(() => {\r\n    try { const raw = localStorage.getItem(storageKey); if (raw) return JSON.parse(raw) } catch {}\r\n    // If autoFill is requested, don't persist a fixed height — let CSS stretch the panel\r\n    return autoFill ? { width: defaultWidth } : { width: defaultWidth, height: defaultHeight }\r\n  })\r\n  const startRef = useRef<{ x: number; y: number; w: number; h: number; dir: string } | null>(null)\r\n  const containerRef = useRef<HTMLDivElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    function onReset() {\r\n      try { localStorage.removeItem(storageKey) } catch {}\r\n      setSize({ width: defaultWidth, height: defaultHeight })\r\n    }\r\n    window.addEventListener('ndn:layout-reset' as any, onReset)\r\n    window.addEventListener('ndn:camera-reset' as any, onReset)\r\n    return () => {\r\n      window.removeEventListener('ndn:layout-reset' as any, onReset)\r\n      window.removeEventListener('ndn:camera-reset' as any, onReset)\r\n    }\r\n  }, [storageKey, defaultWidth, defaultHeight])\r\n\r\n  useEffect(() => { try { localStorage.setItem(storageKey, JSON.stringify(size)) } catch {} }, [size, storageKey])\r\n\r\n  function clamp(n: number, min: number, max: number) { return Math.max(min, Math.min(max, n)) }\r\n  function beginResize(e: React.MouseEvent, dir: string) {\r\n    e.preventDefault(); const el = containerRef.current; if (!el) return\r\n    const rect = el.getBoundingClientRect()\r\n    startRef.current = { x: e.clientX, y: e.clientY, w: rect.width, h: rect.height, dir }\r\n    window.addEventListener('mousemove', onMove)\r\n    window.addEventListener('mouseup', endResize)\r\n  }\r\n  function onMove(e: globalThis.MouseEvent) {\r\n    const s = startRef.current; if (!s) return\r\n    const dx = e.clientX - s.x; const dy = e.clientY - s.y\r\n    let w = s.w; let h = s.h\r\n    if (s.dir.includes('e')) w = clamp(s.w + dx, minWidth, maxWidth)\r\n    // If autoFill is enabled, ignore vertical resizing (panel should fill parent)\r\n    if (!autoFill && s.dir.includes('s')) h = clamp(s.h + dy, minHeight, maxHeight)\r\n    if (s.dir.includes('w')) w = clamp(s.w - dx, minWidth, maxWidth)\r\n    if (!autoFill && s.dir.includes('n')) h = clamp(s.h - dy, minHeight, maxHeight)\r\n    setSize({ width: Math.round(w), height: Math.round(h) })\r\n  }\r\n  function endResize() { window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', endResize); startRef.current = null }\r\n\r\n  const style: CSSProperties = {\r\n    width: size.width ? `${size.width}px` : undefined,\r\n    height: autoFill ? '100%' : (size.height ? `${size.height}px` : undefined),\r\n    maxWidth: '100%',\r\n    // Allow the panel to fill the parent when autoFill is enabled. Otherwise keep a sensible cap.\r\n    maxHeight: autoFill ? '100%' : '80vh',\r\n    position: 'relative',\r\n    // Make it participate in flex layouts when filling\r\n    ...(autoFill ? { display: 'flex', flexDirection: 'column', flex: '1 1 auto' } : {}),\r\n  }\r\n\r\n  return (\r\n    <div ref={containerRef} className={`${className || ''}`} style={style}>\r\n      {children}\r\n      <div className=\"resizer resizer-nw\" onMouseDown={(e)=>beginResize(e,'nw')} />\r\n      <div className=\"resizer resizer-ne\" onMouseDown={(e)=>beginResize(e,'ne')} />\r\n      <div className=\"resizer resizer-sw\" onMouseDown={(e)=>beginResize(e,'sw')} />\r\n      <div className=\"resizer resizer-se\" onMouseDown={(e)=>beginResize(e,'se')} />\r\n    </div>\r\n  )\r\n}\r\n","import React, { useEffect, useRef, useState, type ReactNode, type CSSProperties } from 'react'\r\n\r\ntype Props = {\r\n  storageKey: string\r\n  children: ReactNode\r\n  className?: string\r\n  defaultWidth?: number\r\n  defaultHeight?: number\r\n  minWidth?: number\r\n  minHeight?: number\r\n  maxWidth?: number\r\n  maxHeight?: number\r\n  fullScreen?: boolean\r\n  initialFitHeight?: boolean\r\n}\r\n\r\ntype Size = { width?: number; height?: number }\r\n\r\nexport default function ResizableModal({\r\n  storageKey,\r\n  children,\r\n  className,\r\n  defaultWidth = 520,\r\n  defaultHeight,\r\n  minWidth = 360,\r\n  minHeight = 200,\r\n  maxWidth = 1100,\r\n  maxHeight = 900,\r\n  fullScreen = false,\r\n  initialFitHeight = false,\r\n}: Props) {\r\n  const [size, setSize] = useState<Size>(() => {\r\n    if (!fullScreen) {\r\n      try {\r\n        const raw = localStorage.getItem(storageKey)\r\n        if (raw) return JSON.parse(raw)\r\n      } catch {}\r\n      return { width: defaultWidth, height: defaultHeight }\r\n    }\r\n    return {}\r\n  })\r\n  const startRef = useRef<{ x: number; y: number; w: number; h: number; dir: string } | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (fullScreen) return\r\n    function onReset() {\r\n      try { localStorage.removeItem(storageKey) } catch {}\r\n      // If initialFitHeight is enabled, prefer fitting to parent height on reset\r\n      if (initialFitHeight && containerRef.current?.parentElement) {\r\n        const parent = containerRef.current.parentElement as HTMLElement\r\n        const cs = window.getComputedStyle(parent)\r\n        const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n        const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n        const inner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n        const target = Math.max(minHeight, Math.min(maxHeight, Math.round(inner)))\r\n        setSize({ width: defaultWidth, height: target })\r\n        return\r\n      }\r\n      setSize({ width: defaultWidth, height: defaultHeight })\r\n    }\r\n    window.addEventListener('ndn:layout-reset' as any, onReset)\r\n    return () => window.removeEventListener('ndn:layout-reset' as any, onReset)\r\n  }, [storageKey, defaultWidth, defaultHeight, fullScreen])\r\n\r\n  useEffect(() => {\r\n    if (fullScreen) return\r\n    try { localStorage.setItem(storageKey, JSON.stringify(size)) } catch {}\r\n  }, [size, storageKey, fullScreen])\r\n\r\n  // Optionally fit initial height to the available parent container when no saved size exists\r\n  useEffect(() => {\r\n    if (fullScreen || !initialFitHeight) return\r\n    const parent = containerRef.current?.parentElement as HTMLElement | null\r\n    if (!parent) return\r\n    const cs = window.getComputedStyle(parent)\r\n    const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n    const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n    const inner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n    const target = Math.max(minHeight, Math.min(maxHeight, Math.round(inner)))\r\n    try {\r\n      const saved = localStorage.getItem(storageKey)\r\n      if (saved) {\r\n        const savedSize = JSON.parse(saved) as Size\r\n        const h = savedSize?.height || 0\r\n        // If saved height is smaller than available, bump it to fill the frame bottom\r\n        if (!h || h < target) {\r\n          setSize(s => ({ ...s, height: target }))\r\n        }\r\n        return\r\n      }\r\n    } catch {}\r\n    setSize(s => ({ ...s, height: target }))\r\n  }, [initialFitHeight, fullScreen, storageKey, minHeight, maxHeight])\r\n\r\n  function clamp(n: number, min: number, max: number) {\r\n    return Math.max(min, Math.min(max, n))\r\n  }\r\n\r\n  function beginResize(e: React.MouseEvent, dir: string) {\r\n    e.preventDefault()\r\n    const el = containerRef.current\r\n    if (!el) return\r\n    const rect = el.getBoundingClientRect()\r\n    startRef.current = { x: e.clientX, y: e.clientY, w: rect.width, h: rect.height, dir }\r\n    window.addEventListener('mousemove', onMove)\r\n    window.addEventListener('mouseup', endResize)\r\n  }\r\n\r\n  function onMove(e: MouseEvent) {\r\n    const s = startRef.current\r\n    if (!s) return\r\n    const dx = e.clientX - s.x\r\n    const dy = e.clientY - s.y\r\n    const dir = s.dir\r\n    let w = s.w\r\n    let h = s.h\r\n    // Respect parent's inner height so the modal bottom can align with the frame bottom\r\n    let parentInner = Infinity\r\n    const parent = containerRef.current?.parentElement as HTMLElement | null\r\n    if (parent) {\r\n      const cs = window.getComputedStyle(parent)\r\n      const padTop = parseFloat(cs.paddingTop || '0') || 0\r\n      const padBottom = parseFloat(cs.paddingBottom || '0') || 0\r\n      parentInner = Math.max(0, parent.clientHeight - padTop - padBottom)\r\n    }\r\n    const effMaxH = Math.min(maxHeight, isFinite(parentInner) ? parentInner : maxHeight)\r\n    // We only adjust width/height; the modal stays centered via parent flex\r\n    if (dir.includes('e')) w = clamp(s.w + dx, minWidth, maxWidth)\r\n    if (dir.includes('s')) h = clamp(s.h + dy, minHeight, effMaxH)\r\n    if (dir.includes('w')) w = clamp(s.w - dx, minWidth, maxWidth)\r\n    if (dir.includes('n')) h = clamp(s.h - dy, minHeight, effMaxH)\r\n    setSize({ width: Math.round(w), height: Math.round(h) })\r\n  }\r\n\r\n  function endResize() {\r\n    window.removeEventListener('mousemove', onMove)\r\n    window.removeEventListener('mouseup', endResize)\r\n    startRef.current = null\r\n  }\r\n\r\n  const containerRef = useRef<HTMLDivElement | null>(null)\r\n  const style: CSSProperties = fullScreen\r\n    ? { width: '100%', height: '100%', maxWidth: '100%', maxHeight: '100%' }\r\n    : {\r\n        width: size.width ? `${size.width}px` : undefined,\r\n        height: size.height ? `${size.height}px` : undefined,\r\n        maxWidth: `${maxWidth}px`,\r\n        // Allow filling up to the parent's inner height\r\n        maxHeight: '100%',\r\n      }\r\n\r\n  const baseClass = fullScreen ? 'card relative ndn-modal-full' : 'card relative'\r\n  return (\r\n    <div ref={containerRef} className={`${baseClass} ${className || ''}`} style={style}>\r\n      {/* Content */}\r\n      {children}\r\n      {/* Corner handles */}\r\n      {!fullScreen && <div className=\"resizer resizer-nw\" onMouseDown={(e)=>beginResize(e,'nw')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-ne\" onMouseDown={(e)=>beginResize(e,'ne')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-sw\" onMouseDown={(e)=>beginResize(e,'sw')} />}\r\n      {!fullScreen && <div className=\"resizer resizer-se\" onMouseDown={(e)=>beginResize(e,'se')} />}\r\n      {/* Bottom edge handle for easy vertical stretching */}\r\n      {!fullScreen && <div className=\"resizer-edge resizer-s\" onMouseDown={(e)=>beginResize(e,'s')} />}\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\nexport type HeatSample = {\r\n  playerId: string | null\r\n  sector: number | null\r\n  mult: 0 | 1 | 2 | 3\r\n  ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n  ts: number\r\n}\r\n\r\ntype HeatState = {\r\n  samples: HeatSample[]\r\n  addSample: (s: HeatSample) => void\r\n  clear: () => void\r\n  export: () => HeatSample[]\r\n}\r\n\r\nexport const useHeatmapStore = create<HeatState>((set, get) => ({\r\n  samples: [],\r\n  addSample: (s) => set(state => ({ samples: [...state.samples, s] })),\r\n  clear: () => set({ samples: [] }),\r\n  export: () => get().samples.slice(),\r\n}))\r\n\r\nexport default useHeatmapStore\r\n","import { create } from 'zustand'\r\nimport type { Ring } from '../utils/scoring'\r\n\r\nexport type PendingEntry = { label: string; value: number; ring: Ring }\r\n\r\ntype PendingVisitState = {\r\n  darts: number\r\n  total: number\r\n  entries: PendingEntry[]\r\n  setVisit: (entries: PendingEntry[], darts: number, total: number) => void\r\n  reset: () => void\r\n}\r\n\r\nexport const usePendingVisit = create<PendingVisitState>((set) => ({\r\n  darts: 0,\r\n  total: 0,\r\n  entries: [],\r\n  setVisit: (entries, darts, total) => set({ entries, darts, total }),\r\n  reset: () => set({ darts: 0, total: 0, entries: [] }),\r\n}))\r\n","import { create } from 'zustand'\r\n\r\ntype MatchControlState = {\r\n  paused: boolean\r\n  pauseEndsAt: number | null\r\n  setPaused: (v: boolean, endsAt?: number | null) => void\r\n}\r\n\r\nexport const useMatchControl = create<MatchControlState>((set) => ({\r\n  paused: false,\r\n  pauseEndsAt: null,\r\n  setPaused: (v, endsAt = null) => set({ paused: v, pauseEndsAt: endsAt ?? null }),\r\n}))\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { useMatch } from '../store/match'\r\nimport { BoardRadii, drawPolyline, sampleRing, scaleHomography, type Point, applyHomography, drawCross, refinePointSobel } from '../utils/vision'\r\nimport { scoreFromImagePoint } from '../utils/autoscore'\r\nimport { DartDetector } from '../utils/dartDetector'\r\nimport { addSample } from '../store/profileStats'\r\nimport { subscribeExternalWS } from '../utils/scoring'\r\nimport ResizablePanel from './ui/ResizablePanel'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport useHeatmapStore from '../store/heatmap'\r\nimport { usePendingVisit } from '../store/pendingVisit'\r\nimport { useCameraSession } from '../store/cameraSession'\r\nimport { useMatchControl } from '../store/matchControl'\r\nimport { useAudit } from '../store/audit'\r\n\r\n// Shared ring type across autoscore/manual flows\r\ntype Ring = 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n\r\nexport default function CameraView({\r\n  onVisitCommitted,\r\n  showToolbar = true,\r\n  onAutoDart,\r\n  immediateAutoCommit = false,\r\n  hideInlinePanels = false,\r\n  scoringMode = 'x01',\r\n  onGenericDart,\r\n  onGenericReplace,\r\n  x01DoubleInOverride,\r\n}: {\r\n  onVisitCommitted?: (score: number, darts: number, finished: boolean) => void\r\n  showToolbar?: boolean\r\n  onAutoDart?: (value: number, ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', info?: { sector: number | null; mult: 0|1|2|3 }) => void\r\n  immediateAutoCommit?: boolean\r\n  hideInlinePanels?: boolean\r\n  scoringMode?: 'x01' | 'custom'\r\n  onGenericDart?: (value: number, ring: Ring, meta: { label: string }) => void\r\n  onGenericReplace?: (value: number, ring: Ring, meta: { label: string }) => void\r\n  x01DoubleInOverride?: boolean\r\n}) {\r\n  const videoRef = useRef<HTMLVideoElement>(null)\r\n  const { preferredCameraId, preferredCameraLabel, setPreferredCamera, autoscoreProvider, autoscoreWsUrl, cameraAspect, cameraFitMode } = useUserSettings()\r\n  const manualOnly = autoscoreProvider === 'manual'\r\n  const [availableCameras, setAvailableCameras] = useState<MediaDeviceInfo[]>([])\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n  const overlayRef = useRef<HTMLCanvasElement>(null)\r\n  const [streaming, setStreaming] = useState(false)\r\n  const [cameraStarting, setCameraStarting] = useState(false)\r\n  const [snapshotUrl, setSnapshotUrl] = useState<string | null>(null)\r\n  const { H, imageSize, reset: resetCalibration, _hydrated } = useCalibration()\r\n  const [lastAutoScore, setLastAutoScore] = useState<string>('')\r\n  const [manualScore, setManualScore] = useState<string>('')\r\n  const [lastAutoValue, setLastAutoValue] = useState<number>(0)\r\n  const [lastAutoRing, setLastAutoRing] = useState<Ring>('MISS')\r\n  const [pendingDarts, setPendingDarts] = useState<number>(0)\r\n  const [pendingScore, setPendingScore] = useState<number>(0)\r\n  const [pendingEntries, setPendingEntries] = useState<{ label: string; value: number; ring: Ring }[]>([])\r\n  const [pendingPreOpenDarts, setPendingPreOpenDarts] = useState<number>(0)\r\n  const [pendingDartsAtDouble, setPendingDartsAtDouble] = useState<number>(0)\r\n  // X01 Double-In handling: per-player opened state in this session\r\n  const x01DoubleInSetting = useUserSettings(s => s.x01DoubleIn)\r\n  const x01DoubleIn = (typeof x01DoubleInOverride === 'boolean') ? !!x01DoubleInOverride : !!x01DoubleInSetting\r\n  const [openedById, setOpenedById] = useState<Record<string, boolean>>({})\r\n  const matchState = useMatch(s => s)\r\n  const currentPlayerId = matchState.players[matchState.currentPlayerIdx]?.id\r\n  const isOpened = !!(currentPlayerId && openedById[currentPlayerId])\r\n  const setOpened = (v: boolean) => { if (!currentPlayerId) return; setOpenedById(m => ({ ...m, [currentPlayerId]: v })) }\r\n  // Broadcast pending visit to global store so Scoreboard can visualize dots\r\n  const setVisit = usePendingVisit(s => s.setVisit)\r\n  const resetPendingVisit = usePendingVisit(s => s.reset)\r\n  useEffect(() => {\r\n    try { setVisit(pendingEntries as any, pendingDarts, pendingScore) } catch {}\r\n  }, [pendingEntries, pendingDarts, pendingScore, setVisit])\r\n  useEffect(() => () => { try { resetPendingVisit() } catch {} }, [resetPendingVisit])\r\n  const addVisit = useMatch(s => s.addVisit)\r\n  const endLeg = useMatch(s => s.endLeg)\r\n  const addHeatSample = useHeatmapStore(s => s.addSample)\r\n  // Quick entry dropdown selections\r\n  const [quickSelAuto, setQuickSelAuto] = useState('')\r\n  const [quickSelManual, setQuickSelManual] = useState('')\r\n  const [nonRegCount, setNonRegCount] = useState(0)\r\n  const [showRecalModal, setShowRecalModal] = useState(false)\r\n  const [hadRecentAuto, setHadRecentAuto] = useState(false)\r\n  const [pulseManualPill, setPulseManualPill] = useState(false)\r\n  const pulseTimeoutRef = useRef<number | null>(null)\r\n  const [activeTab, setActiveTab] = useState<'auto'|'manual'>('auto')\r\n  const [showManualModal, setShowManualModal] = useState(false)\r\n  const [showAutoModal, setShowAutoModal] = useState(false)\r\n  const [showScoringModal, setShowScoringModal] = useState(false)\r\n  const manualPreviewRef = useRef<HTMLCanvasElement | null>(null)\r\n  // Dart timer\r\n  const dartTimerEnabled = useUserSettings(s => s.dartTimerEnabled)\r\n  const dartTimerSeconds = useUserSettings(s => s.dartTimerSeconds) || 10\r\n  const [dartTimeLeft, setDartTimeLeft] = useState<number | null>(null)\r\n  const timerRef = useRef<number | null>(null)\r\n  const paused = useMatchControl(s => s.paused)\r\n  // Built-in CV detector\r\n  const detectorRef = useRef<DartDetector | null>(null)\r\n  const rafRef = useRef<number | null>(null)\r\n  const [detectorSeedVersion, setDetectorSeedVersion] = useState(0)\r\n  // Open Autoscore modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => { if (!manualOnly) setShowAutoModal(true) }\r\n    window.addEventListener('ndn:open-autoscore' as any, onOpen)\r\n    return () => window.removeEventListener('ndn:open-autoscore' as any, onOpen)\r\n  }, [manualOnly])\r\n\r\n  // cleanup pulse timer on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      try { if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current) } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Open Scoring (Camera + Pending Visit) modal from parent via global event\r\n  useEffect(() => {\r\n    const onOpen = () => setShowScoringModal(true)\r\n    window.addEventListener('ndn:open-scoring' as any, onOpen)\r\n    return () => window.removeEventListener('ndn:open-scoring' as any, onOpen)\r\n  }, [])\r\n\r\n  // Enumerate devices on mount and when devices change so USB webcams appear quickly\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function refresh() {\r\n      try {\r\n        if (!navigator?.mediaDevices?.enumerateDevices) return\r\n        const list = await navigator.mediaDevices.enumerateDevices()\r\n        if (!mounted) return\r\n        setAvailableCameras(list.filter(d => d.kind === 'videoinput'))\r\n      } catch (err) {\r\n        console.warn('[CAMERA] enumerateDevices failed:', err)\r\n      }\r\n    }\r\n    refresh()\r\n    try {\r\n      navigator.mediaDevices.addEventListener('devicechange', refresh)\r\n    } catch {\r\n      try { (navigator.mediaDevices as any).ondevicechange = refresh } catch {}\r\n    }\r\n    return () => {\r\n      mounted = false\r\n      try { navigator.mediaDevices.removeEventListener('devicechange', refresh) } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Allow parent to open/close the manual modal via global events\r\n  useEffect(() => {\r\n    const onOpen = () => { setActiveTab('manual'); setShowManualModal(true) }\r\n    const onClose = () => { setActiveTab('auto'); setShowManualModal(false) }\r\n    window.addEventListener('ndn:open-manual' as any, onOpen)\r\n    window.addEventListener('ndn:close-manual' as any, onClose)\r\n    return () => {\r\n      window.removeEventListener('ndn:open-manual' as any, onOpen)\r\n      window.removeEventListener('ndn:close-manual' as any, onClose)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (manualOnly) {\r\n      setActiveTab('manual')\r\n      setShowAutoModal(false)\r\n    }\r\n  }, [manualOnly])\r\n\r\n  // Reset open state at the start of a leg (no darts thrown yet), keep across visits within leg\r\n  useEffect(() => {\r\n    try {\r\n      const p = matchState.players[matchState.currentPlayerIdx]\r\n      const leg = p?.legs?.[p.legs.length - 1]\r\n      if (!p) return\r\n      if (!leg || leg.dartsThrown === 0) {\r\n        setOpenedById(m => ({ ...m, [p.id]: false }))\r\n      }\r\n    } catch {}\r\n  }, [matchState.currentPlayerIdx, matchState.players?.[matchState.currentPlayerIdx]?.legs?.length])\r\n\r\n  // Manage per-dart timer lifecycle\r\n  useEffect(() => {\r\n  const inProgress = (matchState as any)?.inProgress\r\n  const shouldRun = !!dartTimerEnabled && inProgress && !paused && pendingDarts < 3\r\n    // Clear any existing interval\r\n    if (timerRef.current) {\r\n      clearInterval(timerRef.current as any)\r\n      timerRef.current = null\r\n    }\r\n    if (!shouldRun) { setDartTimeLeft(null); return }\r\n    // Reset timer each time dependencies change (new dart, player change, setting change)\r\n    setDartTimeLeft(dartTimerSeconds)\r\n    timerRef.current = window.setInterval(() => {\r\n      setDartTimeLeft(prev => {\r\n        const next = (prev ?? dartTimerSeconds) - 1\r\n        if (next <= 0) {\r\n          // Time expired: record a MISS and reset will occur via pendingEntries change\r\n          try { addDart(0, 'MISS 0', 'MISS') } catch {}\r\n          // Stop interval until effect re-initializes on state change\r\n          if (timerRef.current) { clearInterval(timerRef.current as any); timerRef.current = null }\r\n          return 0\r\n        }\r\n        return next\r\n      })\r\n    }, 1000) as any\r\n    return () => { if (timerRef.current) { clearInterval(timerRef.current as any); timerRef.current = null } }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [dartTimerEnabled, dartTimerSeconds, pendingDarts, matchState.currentPlayerIdx, (matchState as any)?.inProgress, paused])\r\n\r\n  // Drive a lightweight live preview inside the manual modal from the main video element\r\n  useEffect(() => {\r\n    if (!showManualModal) return\r\n    const id = setInterval(() => {\r\n      try {\r\n        const v = videoRef.current\r\n        const c = manualPreviewRef.current\r\n        if (!v || !c) return\r\n        const vw = v.videoWidth || 0\r\n        const vh = v.videoHeight || 0\r\n        if (!vw || !vh) return\r\n        const cw = c.clientWidth || 640\r\n        const ch = c.clientHeight || 360\r\n        // Set backing size to match display for crisp rendering\r\n        if (c.width !== cw) c.width = cw\r\n        if (c.height !== ch) c.height = ch\r\n        const ctx = c.getContext('2d')\r\n        if (!ctx) return\r\n        ctx.imageSmoothingEnabled = true\r\n        // Letterbox fit\r\n        const scale = Math.min(cw / vw, ch / vh)\r\n        const dw = Math.round(vw * scale)\r\n        const dh = Math.round(vh * scale)\r\n        const dx = Math.floor((cw - dw) / 2)\r\n        const dy = Math.floor((ch - dh) / 2)\r\n        ctx.fillStyle = '#000'\r\n        ctx.fillRect(0, 0, cw, ch)\r\n        ctx.drawImage(v, dx, dy, dw, dh)\r\n      } catch (e) {\r\n        // Silently ignore preview update errors\r\n        console.warn('Manual preview update error:', e)\r\n      }\r\n    }, 120)\r\n    return () => clearInterval(id)\r\n  }, [showManualModal])\r\n\r\n  useEffect(() => {\r\n    return () => stopCamera()\r\n  }, [])\r\n\r\n  async function startCamera() {\r\n    if (cameraStarting || streaming) return\r\n    \r\n    // If phone camera is selected, don't try to start a local camera\r\n    // The phone camera is displayed via PhoneCameraOverlay in the game tabs\r\n    if (preferredCameraLabel === 'Phone Camera') {\r\n      console.log('[CAMERA] Phone camera is selected - skipping local camera startup')\r\n      console.log('[CAMERA] Phone camera feed shown via overlay in game tabs')\r\n      setCameraStarting(false)\r\n      return\r\n    }\r\n    \r\n    setCameraStarting(true)\r\n    console.log('[CAMERA] Starting camera...')\r\n    try {\r\n      // If a preferred camera is set, request it; otherwise default to back camera on mobile\r\n      const constraints: MediaStreamConstraints = preferredCameraId \r\n        ? { video: { deviceId: { exact: preferredCameraId } }, audio: false } \r\n        : { video: { facingMode: 'environment' }, audio: false } // Prefer back camera on mobile\r\n      console.log('[CAMERA] Using constraints:', constraints)\r\n      let stream: MediaStream\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n        console.log('[CAMERA] Got stream:', !!stream)\r\n      } catch (err: any) {\r\n        console.warn('[CAMERA] First attempt failed:', err)\r\n        // Fallback if specific device isn't available or facingMode not supported\r\n        const name = (err && (err.name || err.code)) || ''\r\n        if (preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError')) {\r\n          console.log('[CAMERA] Trying fallback without deviceId')\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else if (!preferredCameraId && (name === 'OverconstrainedError' || name === 'NotFoundError' || name === 'NotSupportedError')) {\r\n          console.log('[CAMERA] Trying fallback for facingMode not supported')\r\n          // Fallback for devices that don't support facingMode\r\n          stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        } else {\r\n          throw err\r\n        }\r\n      }\r\n      if (videoRef.current) {\r\n        console.log('[CAMERA] Setting stream to video element')\r\n        videoRef.current.srcObject = stream\r\n        console.log('[CAMERA] Stream tracks:', stream.getTracks().length, 'video tracks:', stream.getVideoTracks().length)\r\n        // Add event listeners for debugging\r\n        videoRef.current.addEventListener('loadeddata', () => console.log('[CAMERA] Video loadeddata'))\r\n        videoRef.current.addEventListener('canplay', () => console.log('[CAMERA] Video canplay'))\r\n        videoRef.current.addEventListener('play', () => console.log('[CAMERA] Video started playing'))\r\n        videoRef.current.addEventListener('error', (e) => console.error('[CAMERA] Video error:', e))\r\n        try {\r\n          videoRef.current.play()\r\n          console.log('[CAMERA] Play called successfully')\r\n        } catch (playErr) {\r\n          console.error('[CAMERA] Video play failed:', playErr)\r\n          // Try again after a short delay\r\n          setTimeout(() => {\r\n            try {\r\n              videoRef.current?.play()\r\n              console.log('[CAMERA] Retry play called')\r\n            } catch (retryErr) {\r\n              console.error('[CAMERA] Retry play failed:', retryErr)\r\n            }\r\n          }, 100)\r\n        }\r\n      } else {\r\n        console.error('[CAMERA] Video element not found')\r\n      }\r\n      setStreaming(true)\r\n      // Capture device list for inline picker - no automatic preference updates\r\n      try {\r\n        const list = await navigator.mediaDevices.enumerateDevices()\r\n        setAvailableCameras(list.filter(d=>d.kind==='videoinput'))\r\n        console.log('[CAMERA] Found cameras:', list.filter(d=>d.kind==='videoinput').length)\r\n      } catch (enumErr) {\r\n        console.warn('[CAMERA] Failed to enumerate devices:', enumErr)\r\n      }\r\n    } catch (e) {\r\n      console.error('[CAMERA] Camera start failed:', e)\r\n      alert('Camera permission denied or not available.')\r\n    } finally {\r\n      setCameraStarting(false)\r\n    }\r\n  }\r\n\r\n  function stopCamera() {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()\r\n      tracks.forEach(t => t.stop())\r\n      videoRef.current.srcObject = null\r\n      setStreaming(false)\r\n      setCameraStarting(false)\r\n    }\r\n  }\r\n\r\n  function capture() {\r\n    try {\r\n      if (!videoRef.current || !canvasRef.current) return\r\n      const video = videoRef.current\r\n      const canvas = canvasRef.current\r\n      canvas.width = video.videoWidth\r\n      canvas.height = video.videoHeight\r\n      const ctx = canvas.getContext('2d')\r\n      if (!ctx) return\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\r\n      const url = canvas.toDataURL('image/png')\r\n      setSnapshotUrl(url)\r\n    } catch (e) {\r\n      console.warn('Capture error:', e)\r\n    }\r\n  }\r\n\r\n  // Inline light-weight device switcher (optional)\r\n  function CameraSelector() {\r\n    if (!availableCameras.length) return null\r\n    return (\r\n      <div className=\"absolute top-2 right-2 z-20 flex items-center gap-2 bg-black/40 rounded px-2 py-1 text-xs\">\r\n        <span>Cam:</span>\r\n        <select\r\n          className=\"bg-black/20 rounded px-1 py-0.5\"\r\n          value={preferredCameraId || ''}\r\n          onChange={async (e)=>{\r\n            if (cameraStarting) return\r\n            const id = e.target.value || undefined\r\n            const label = availableCameras.find(d=>d.deviceId===id)?.label\r\n            // This is a user-initiated change so force the preference even when locked\r\n            setPreferredCamera(id, label||'', true)\r\n            // Stop current camera and wait for cleanup\r\n            stopCamera()\r\n            // Small delay to ensure camera device is fully released\r\n            await new Promise(resolve => setTimeout(resolve, 150))\r\n            try {\r\n              await startCamera()\r\n            } catch (err) {\r\n              console.warn('Failed to start camera after device switch:', err)\r\n              // Try one more time after a longer delay\r\n              setTimeout(async () => {\r\n                try {\r\n                  await startCamera()\r\n                } catch (retryErr) {\r\n                  console.error('Camera switch failed after retry:', retryErr)\r\n                  alert('Failed to switch camera. Please try again or refresh the page.')\r\n                }\r\n              }, 500)\r\n            }\r\n          }}\r\n        >\r\n          <option value=\"\">Auto</option>\r\n          {availableCameras.map(d => (\r\n            <option key={d.deviceId} value={d.deviceId}>{d.label || (d.deviceId ? `Camera (${d.deviceId.slice(0,6)})` : 'Camera')}</option>\r\n          ))}\r\n        </select>\r\n        <button\r\n          className=\"btn btn--ghost btn-sm ml-2\"\r\n          onClick={async () => {\r\n            try {\r\n              // quick user-triggered rescan\r\n              const list = await navigator.mediaDevices.enumerateDevices()\r\n              setAvailableCameras(list.filter(d=>d.kind==='videoinput'))\r\n            } catch (err) {\r\n              console.warn('Rescan failed:', err)\r\n              alert('Failed to rescan devices. Ensure camera permissions are granted.')\r\n            }\r\n          }}\r\n          title=\"Rescan connected cameras\"\r\n        >\r\n          Rescan\r\n        </button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  function drawOverlay() {\r\n    try {\r\n      if (!overlayRef.current || !videoRef.current || !H || !imageSize) return\r\n      const o = overlayRef.current\r\n      const v = videoRef.current\r\n      const w = v.clientWidth\r\n      const h = v.clientHeight\r\n      o.width = w; o.height = h\r\n      const ctx = o.getContext('2d')\r\n      if (!ctx) return\r\n      ctx.clearRect(0,0,w,h)\r\n\r\n      // scale homography from calibration image size to current rendered size\r\n      const sx = w / imageSize.w\r\n      const sy = h / imageSize.h\r\n      const Hs = scaleHomography(H, sx, sy)\r\n      const rings = [BoardRadii.bullInner, BoardRadii.bullOuter, BoardRadii.trebleInner, BoardRadii.trebleOuter, BoardRadii.doubleInner, BoardRadii.doubleOuter]\r\n      for (const r of rings) {\r\n        const poly = sampleRing(Hs, r, 360)\r\n        drawPolyline(ctx, poly, r === BoardRadii.doubleOuter ? '#22d3ee' : '#a78bfa', r === BoardRadii.doubleOuter ? 3 : 2)\r\n      }\r\n    } catch (e) {\r\n      // Silently ignore drawing errors to prevent re-render loops\r\n      console.warn('Overlay drawing error:', e)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (manualOnly) return\r\n    const id = setInterval(drawOverlay, 250)\r\n    return () => clearInterval(id)\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [H, imageSize, streaming, manualOnly])\r\n\r\n  // Built-in autoscore loop (offline/local CV)\r\n  useEffect(() => {\r\n    if (manualOnly) return\r\n    if (autoscoreProvider !== 'built-in') return\r\n    // Choose source: local video element, or paired phone camera element\r\n    const cameraSession = useCameraSession.getState()\r\n    const isPhone = (useUserSettings.getState().preferredCameraLabel === 'Phone Camera')\r\n    const sourceVideo: HTMLVideoElement | null = isPhone ? (cameraSession.getVideoElementRef?.() || null) : (videoRef.current)\r\n    if (!sourceVideo) return\r\n    if (!H || !imageSize) return\r\n\r\n    let canceled = false\r\n  const v = sourceVideo\r\n    const proc = canvasRef.current\r\n    if (!proc) return\r\n\r\n    // Initialize or reset detector\r\n    if (!detectorRef.current) detectorRef.current = new DartDetector()\r\n\r\n    const tick = () => {\r\n      if (canceled) return\r\n      try {\r\n  const vw = v.videoWidth || 0\r\n  const vh = v.videoHeight || 0\r\n        if (!vw || !vh) { rafRef.current = requestAnimationFrame(tick); return }\r\n        if (proc.width !== vw) proc.width = vw\r\n        if (proc.height !== vh) proc.height = vh\r\n        const ctx = proc.getContext('2d')\r\n        if (!ctx) { rafRef.current = requestAnimationFrame(tick); return }\r\n        ctx.drawImage(v, 0, 0, vw, vh)\r\n        const frame = ctx.getImageData(0, 0, vw, vh)\r\n\r\n        // Seed ROI from calibration homography (board center + double radius along X)\r\n        const cImg = applyHomography(H, { x: 0, y: 0 })\r\n        const rImg = applyHomography(H, { x: BoardRadii.doubleOuter, y: 0 })\r\n        // Scale calibration image coordinates to current video size\r\n        const sx = vw / imageSize.w\r\n        const sy = vh / imageSize.h\r\n        const cx = cImg.x * sx\r\n        const cy = cImg.y * sy\r\n        const rx = rImg.x * sx\r\n        const ry = rImg.y * sy\r\n        const roiR = Math.hypot(rx - cx, ry - cy) * 1.08\r\n\r\n        const detector = detectorRef.current!\r\n        if (detectorSeedVersion >= 0) {\r\n          detector.setROI(cx, cy, Math.max(24, Math.min(Math.max(vw, vh), roiR)))\r\n        }\r\n\r\n        // Try to detect a new dart when not paused and visit has room\r\n        if (!paused && pendingDarts < 3) {\r\n          const det = detector.detect(frame)\r\n          if (det && det.confidence >= 0.6) {\r\n            // Refine tip on gradients\r\n            const tipRefined = refinePointSobel(proc, det.tip, 6)\r\n            // Map to calibration image space before scoring\r\n            const pCal = { x: tipRefined.x / sx, y: tipRefined.y / sy }\r\n            const score = scoreFromImagePoint(H, pCal)\r\n            const s = `${score.ring} ${score.base > 0 ? score.base : ''}`.trim()\r\n            setLastAutoScore(s)\r\n            setLastAutoValue(score.base)\r\n            setLastAutoRing(score.ring as Ring)\r\n                setHadRecentAuto(true)\r\n                // If this looks like a valid confirmed auto (non-miss, positive base), pulse the Manual pill briefly\r\n                try {\r\n                  const ok = !!score && score.ring !== 'MISS' && (score.base || 0) > 0\r\n                  if (ok) {\r\n                    setPulseManualPill(true)\r\n                    try { if (pulseTimeoutRef.current) clearTimeout(pulseTimeoutRef.current) } catch {}\r\n                    pulseTimeoutRef.current = window.setTimeout(() => { setPulseManualPill(false); pulseTimeoutRef.current = null }, 1500)\r\n                  }\r\n                } catch {}\r\n\r\n            // Draw debug tip and shaft axis on overlay (scaled to overlay canvas)\r\n            try {\r\n              const o = overlayRef.current\r\n              if (o) {\r\n                const octx = o.getContext('2d')\r\n                if (octx) {\r\n                  // Maintain overlay size and clear a small area\r\n                  const ox = (tipRefined.x / vw) * o.width\r\n                  const oy = (tipRefined.y / vh) * o.height\r\n                  octx.save()\r\n                  octx.beginPath()\r\n                  octx.strokeStyle = '#f59e0b'\r\n                  octx.lineWidth = 2\r\n                  octx.arc(ox, oy, 6, 0, Math.PI * 2)\r\n                  octx.stroke()\r\n                  // axis line if available\r\n                  if ((det as any).axis) {\r\n                    const ax = (det as any).axis\r\n                    const ax1 = (ax.x1 / vw) * o.width\r\n                    const ay1 = (ax.y1 / vh) * o.height\r\n                    const ax2 = (ax.x2 / vw) * o.width\r\n                    const ay2 = (ax.y2 / vh) * o.height\r\n                    octx.beginPath()\r\n                    octx.moveTo(ax1, ay1)\r\n                    octx.lineTo(ax2, ay2)\r\n                    octx.stroke()\r\n                  }\r\n                  // bbox\r\n                  if ((det as any).bbox) {\r\n                    const bx = ((det as any).bbox.x / vw) * o.width\r\n                    const by = ((det as any).bbox.y / vh) * o.height\r\n                    const bw = ((det as any).bbox.w / vw) * o.width\r\n                    const bh = ((det as any).bbox.h / vh) * o.height\r\n                    octx.strokeStyle = '#22d3ee'\r\n                    octx.strokeRect(bx, by, bw, bh)\r\n                  }\r\n                  octx.restore()\r\n                }\r\n              }\r\n            } catch {}\r\n\r\n            // Notify parent about each autoscore detection (non-committal)\r\n            try {\r\n              if (onAutoDart) {\r\n                onAutoDart(score.base, score.ring as Ring, { sector: (score.sector ?? null), mult: (score.mult as any) ?? 0 })\r\n              }\r\n            } catch {}\r\n\r\n            // Accept to avoid double-triggering on the same physical dart\r\n            detector.accept(frame, det)\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Soft-fail; continue next frame\r\n        // console.warn('Autoscore tick error:', e)\r\n      }\r\n      rafRef.current = requestAnimationFrame(tick)\r\n    }\r\n\r\n    rafRef.current = requestAnimationFrame(tick)\r\n    return () => {\r\n      canceled = true\r\n      if (rafRef.current) cancelAnimationFrame(rafRef.current)\r\n      rafRef.current = null\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [manualOnly, autoscoreProvider, streaming, H, imageSize, paused, pendingDarts, detectorSeedVersion])\r\n\r\n  // Update calibration audit status whenever homography or image size changes\r\n  useEffect(() => {\r\n    try {\r\n      useAudit.getState().setCalibrationStatus({ hasHomography: !!H, imageSize })\r\n    } catch {}\r\n  }, [H, imageSize])\r\n\r\n  // External autoscore subscription\r\n  useEffect(() => {\r\n    if (autoscoreProvider !== 'external-ws' || !autoscoreWsUrl) return\r\n    const sub = subscribeExternalWS(autoscoreWsUrl, (d) => {\r\n      // Prefer parent hook if provided; otherwise add to visit directly\r\n      if (onAutoDart) {\r\n        try { onAutoDart(d.value, d.ring as any, { sector: d.sector ?? null, mult: (d.mult as any) ?? 0 }) } catch {}\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: d.sector ?? null, mult: (d.mult as any) ?? 0, ring: d.ring as any, ts: Date.now() }) } catch {}\r\n      } else {\r\n        const label = d.ring === 'INNER_BULL' ? 'INNER_BULL 50' : d.ring === 'BULL' ? 'BULL 25' : `${d.ring[0]}${(d.value/(d.mult||1))||d.value} ${d.value}`\r\n        addDart(d.value, label, d.ring as any)\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: d.sector ?? null, mult: (d.mult as any) ?? 0, ring: d.ring as any, ts: Date.now() }) } catch {}\r\n      }\r\n    })\r\n    return () => sub.close()\r\n  }, [autoscoreProvider, autoscoreWsUrl])\r\n\r\n  function onOverlayClick(e: React.MouseEvent<HTMLCanvasElement>) {\r\n    if (!overlayRef.current || !H || !imageSize) return\r\n    const rect = overlayRef.current.getBoundingClientRect()\r\n    const x = e.clientX - rect.left\r\n    const y = e.clientY - rect.top\r\n    // Map to calibration coordinate space by reversing the display scaling\r\n    const sx = overlayRef.current.width / imageSize.w\r\n    const sy = overlayRef.current.height / imageSize.h\r\n    const pCal: Point = { x: x / sx, y: y / sy }\r\n  const score = scoreFromImagePoint(H, pCal)\r\n  const s = `${score.ring} ${score.base > 0 ? score.base : ''}`.trim()\r\n    setLastAutoScore(s)\r\n  setLastAutoValue(score.base)\r\n  setLastAutoRing(score.ring as Ring)\r\n    setHadRecentAuto(true)\r\n    // Optional immediate commit hook (e.g., Double Practice)\r\n    try {\r\n      if (immediateAutoCommit && onAutoDart) {\r\n        onAutoDart(score.base, score.ring as Ring, { sector: score.sector, mult: score.mult })\r\n        try { addHeatSample({ playerId: matchState.players[matchState.currentPlayerIdx]?.id ?? null, sector: score.sector ?? null, mult: score.mult ?? 0, ring: score.ring as any, ts: Date.now() }) } catch {}\r\n        setHadRecentAuto(false)\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  function parseManual(input: string): { label: string; value: number; ring: Ring } | null {\r\n    const t = input.trim().toUpperCase()\r\n    if (!t) return null\r\n    const bull = t === 'BULL' || t === '50' || t === 'DBULL' || t === 'IBULL'\r\n    const outerBull = t === '25' || t === 'OBULL'\r\n    if (bull) return { label: 'INNER_BULL 50', value: 50, ring: 'INNER_BULL' }\r\n    if (outerBull) return { label: 'BULL 25', value: 25, ring: 'BULL' }\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2], 10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult === 'S' ? 1 : mult === 'D' ? 2 : 3\r\n    const ring: Ring = mult === 'S' ? 'SINGLE' : mult === 'D' ? 'DOUBLE' : 'TRIPLE'\r\n    return { label: `${mult}${num} ${num*multVal}`, value: num * multVal, ring }\r\n  }\r\n\r\n  function getCurrentRemaining(): number {\r\n    const s = matchState\r\n    if (!s.players.length) return s.startingScore\r\n    const p = s.players[s.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length-1]\r\n    if (!leg) return s.startingScore\r\n    return leg.totalScoreRemaining\r\n  }\r\n\r\n  function addDart(value: number, label: string, ring: Ring) {\r\n    // In generic mode, delegate to parent without X01 bust/finish rules\r\n    if (scoringMode === 'custom') {\r\n      if (onGenericDart) try { onGenericDart(value, ring, { label }) } catch {}\r\n      // Maintain a lightweight pending list for UI only\r\n      if (pendingDarts >= 3) {\r\n        // Rotate to next visit locally so we don't drop darts visually\r\n        setPendingDarts(1)\r\n        setPendingScore(value)\r\n        setPendingEntries([{ label, value, ring }])\r\n        return\r\n      }\r\n      const newDarts = pendingDarts + 1\r\n      setPendingDarts(newDarts)\r\n      setPendingScore(s => s + value)\r\n      setPendingEntries(e => [...e, { label, value, ring }])\r\n      return\r\n    }\r\n\r\n    // If a new dart arrives while 3 are pending, auto-commit previous visit and start a new one\r\n    if (pendingDarts >= 3) {\r\n      // Commit previous full visit\r\n      addVisit(pendingScore, pendingDarts, { preOpenDarts: pendingPreOpenDarts || 0, doubleWindowDarts: pendingDartsAtDouble || 0, finishedByDouble: false, visitTotal: pendingScore })\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, pendingDarts, pendingScore)\r\n      } catch {}\r\n      // Start next visit with this dart\r\n      const willCount = !x01DoubleIn || isOpened || ring === 'DOUBLE' || ring === 'INNER_BULL'\r\n      const applied = willCount ? value : 0\r\n      setPendingDarts(1)\r\n      setPendingScore(applied)\r\n      setPendingEntries([{ label, value: applied, ring }])\r\n      setPendingPreOpenDarts(willCount ? 0 : 1)\r\n      setPendingDartsAtDouble(0)\r\n      if (x01DoubleIn && !isOpened && (ring === 'DOUBLE' || ring === 'INNER_BULL')) {\r\n        setOpened(true)\r\n      }\r\n      if (onVisitCommitted) onVisitCommitted(pendingScore, pendingDarts, false)\r\n      return\r\n    }\r\n    const newDarts = pendingDarts + 1\r\n    // Apply X01 Double-In rule before scoring if enabled and not opened yet\r\n    const countsForScore = !x01DoubleIn || isOpened || ring === 'DOUBLE' || ring === 'INNER_BULL'\r\n    const appliedValue = countsForScore ? value : 0\r\n    if (x01DoubleIn && !isOpened && (ring === 'DOUBLE' || ring === 'INNER_BULL')) {\r\n      setOpened(true)\r\n    }\r\n    const newScore = pendingScore + appliedValue\r\n    const remaining = getCurrentRemaining()\r\n    const after = remaining - newScore\r\n\r\n    // Bust conditions (double-out): negative or 1, or 0 without double/inner bull\r\n    const isFinish = after === 0 && (ring === 'DOUBLE' || ring === 'INNER_BULL')\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish)\r\n\r\n    if (isBust) {\r\n      // Commit bust visit: 0 score, darts thrown so far including this one\r\n      const preOpenThis = (x01DoubleIn && !isOpened && !(ring === 'DOUBLE' || ring === 'INNER_BULL')) ? 1 : 0\r\n      const preOpenTotal = (pendingPreOpenDarts || 0) + preOpenThis\r\n      // Count attempts in double-out window\r\n  const postAfter = after\r\n  const postBefore = after + appliedValue\r\n  const attemptsThisDart = ((postBefore > 50 && postAfter <= 50) || (postBefore <= 50)) ? 1 : 0\r\n      const attemptsTotal = (pendingDartsAtDouble || 0) + attemptsThisDart\r\n      addVisit(0, newDarts, { preOpenDarts: preOpenTotal, doubleWindowDarts: attemptsTotal, finishedByDouble: false, visitTotal: 0 })\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([]); setPendingPreOpenDarts(0)\r\n      setPendingDartsAtDouble(0)\r\n      if (onVisitCommitted) onVisitCommitted(0, newDarts, false)\r\n      return\r\n    }\r\n\r\n  // Normal add (value may be zero if not opened yet)\r\n    setPendingDarts(newDarts)\r\n    setPendingScore(newScore)\r\n    setPendingEntries(e => [...e, { label, value: appliedValue, ring }])\r\n    if (x01DoubleIn && !isOpened && !(ring === 'DOUBLE' || ring === 'INNER_BULL')) {\r\n      setPendingPreOpenDarts(n => (n||0) + 1)\r\n    }\r\n    // Track double-out attempts within this visit\r\n    {\r\n      const postAfter = after\r\n      const postBefore = after + appliedValue\r\n      const countThisDart = (postBefore > 50 && postAfter <= 50) || (postBefore <= 50)\r\n      if (countThisDart) setPendingDartsAtDouble(c => (c||0) + 1)\r\n    }\r\n\r\n    if (isFinish) {\r\n      // Commit visit with current total and end leg\r\n      addVisit(newScore, newDarts, { preOpenDarts: pendingPreOpenDarts || 0, doubleWindowDarts: pendingDartsAtDouble || 0, finishedByDouble: true, visitTotal: newScore })\r\n      endLeg(newScore)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([]); setPendingPreOpenDarts(0); setPendingDartsAtDouble(0)\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, true)\r\n      return\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      addVisit(newScore, newDarts, { preOpenDarts: pendingPreOpenDarts || 0, doubleWindowDarts: pendingDartsAtDouble || 0, finishedByDouble: false, visitTotal: newScore })\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([]); setPendingPreOpenDarts(0); setPendingDartsAtDouble(0)\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, false)\r\n    }\r\n  }\r\n\r\n  function onAddAutoDart() {\r\n    if (lastAutoScore) {\r\n      if (onAutoDart) {\r\n        try { onAutoDart(lastAutoValue, lastAutoRing, undefined) } catch {}\r\n      } else {\r\n        addDart(lastAutoValue, lastAutoScore, lastAutoRing)\r\n      }\r\n      setNonRegCount(0)\r\n      setHadRecentAuto(false)\r\n    }\r\n  }\r\n\r\n  function onApplyManual() {\r\n    const parsed = parseManual(manualScore)\r\n    if (!parsed) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n  if (c >= 5) setShowRecalModal(true)\r\n    } else {\r\n      setNonRegCount(0)\r\n    }\r\n    addDart(parsed.value, parsed.label, parsed.ring)\r\n    setManualScore('')\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  // Replace the last pending dart with a manually typed correction\r\n  function onReplaceManual() {\r\n    const parsed = parseManual(manualScore)\r\n    if (!parsed) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (pendingDarts === 0 || pendingEntries.length === 0) {\r\n      onApplyManual()\r\n      return\r\n    }\r\n    if (scoringMode === 'custom') {\r\n      // Let parent handle replacement semantics\r\n      if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n        const c = nonRegCount + 1\r\n        setNonRegCount(c)\r\n  if (c >= 5) setShowRecalModal(true)\r\n      } else setNonRegCount(0)\r\n\r\n      // Update local pending UI\r\n      setPendingEntries((e)=>[...e.slice(0,-1), { label: parsed.label, value: parsed.value, ring: parsed.ring }])\r\n      if (onGenericReplace) try { onGenericReplace(parsed.value, parsed.ring, { label: parsed.label }) } catch {}\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n  if (c >= 5) setShowRecalModal(true)\r\n    } else setNonRegCount(0)\r\n\r\n    const last = pendingEntries[pendingEntries.length-1]\r\n    const prevDarts = pendingDarts - 1\r\n    const prevScore = pendingScore - (last?.value || 0)\r\n    const remaining = getCurrentRemaining()\r\n    const newScore = prevScore + parsed.value\r\n    const newDarts = prevDarts + 1\r\n    const after = remaining - newScore\r\n    const isFinish = after === 0 && (parsed.ring === 'DOUBLE' || parsed.ring === 'INNER_BULL')\r\n    const isBust = after < 0 || after === 1 || (after === 0 && !isFinish)\r\n\r\n    if (isBust) {\r\n      addVisit(0, newDarts)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, 0)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(0, newDarts, false)\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n\r\n    setPendingDarts(newDarts)\r\n    setPendingScore(newScore)\r\n    setPendingEntries((e)=>[...e.slice(0,-1), { label: parsed.label, value: parsed.value, ring: parsed.ring }])\r\n\r\n    if (isFinish) {\r\n      addVisit(newScore, newDarts)\r\n      endLeg(newScore)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, newScore)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, true)\r\n      setManualScore('')\r\n      setHadRecentAuto(false)\r\n      return\r\n    }\r\n\r\n    if (newDarts >= 3) {\r\n      addVisit(newScore, newDarts)\r\n      try {\r\n        const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n        if (name) addSample(name, newDarts, newScore)\r\n      } catch {}\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      if (onVisitCommitted) onVisitCommitted(newScore, newDarts, false)\r\n    }\r\n    setManualScore('')\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  function onRecalibrateNow() {\r\n    setShowRecalModal(false)\r\n    setNonRegCount(0)\r\n    // Ask App to switch to calibrate tab\r\n    try { window.dispatchEvent(new CustomEvent('ndn:request-calibrate')) } catch {}\r\n  }\r\n\r\n  function onResetCalibration() {\r\n    resetCalibration()\r\n    setShowRecalModal(false)\r\n    setNonRegCount(0)\r\n  }\r\n\r\n  // Keyboard shortcut: press 'm' to open Manual Correction (if not typing in an input)\r\n  React.useEffect(() => {\r\n    function onKey(e: KeyboardEvent) {\r\n      try {\r\n        const active = document.activeElement as HTMLElement | null\r\n        const tag = active?.tagName?.toLowerCase()\r\n        if (e.key === 'm' && tag !== 'input' && tag !== 'textarea') {\r\n          setActiveTab('manual')\r\n          setShowManualModal(true)\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('keydown', onKey)\r\n    return () => window.removeEventListener('keydown', onKey)\r\n  }, [])\r\n\r\n  // Centralized quick-entry handler for S/D/T 1-20 buttons\r\n  function onQuickEntry(num: number, mult: 'S'|'D'|'T') {\r\n    if (pendingDarts >= 3) return\r\n    const val = num * (mult==='S'?1:mult==='D'?2:3)\r\n    const ring: Ring = mult==='S' ? 'SINGLE' : mult==='D' ? 'DOUBLE' : 'TRIPLE'\r\n    // If autoscore didn't register recently, count toward recalibration\r\n    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n      const c = nonRegCount + 1\r\n      setNonRegCount(c)\r\n  if (c >= 5) setShowRecalModal(true)\r\n    } else {\r\n      setNonRegCount(0)\r\n    }\r\n    addDart(val, `${mult}${num} ${val}`, ring)\r\n    setHadRecentAuto(false)\r\n  }\r\n\r\n  function onUndoDart() {\r\n    if (pendingDarts === 0) return\r\n    const last = pendingEntries[pendingEntries.length-1]\r\n    setPendingDarts(d => d - 1)\r\n    setPendingScore(s => s - (last?.value || 0))\r\n    setPendingEntries(e => e.slice(0, -1))\r\n  }\r\n\r\n  function onCommitVisit() {\r\n    if (pendingDarts === 0) return\r\n    if (scoringMode === 'custom') {\r\n      // For custom mode, simply clear local pending (parent maintains its own scoring)\r\n      setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n      return\r\n    }\r\n    addVisit(pendingScore, pendingDarts)\r\n    try {\r\n      const name = matchState.players[matchState.currentPlayerIdx]?.name\r\n      if (name) addSample(name, pendingDarts, pendingScore)\r\n    } catch {}\r\n    setPendingDarts(0); setPendingScore(0); setPendingEntries([])\r\n    if (onVisitCommitted) onVisitCommitted(pendingScore, pendingDarts, false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n      {/* Pills (optional; can be hidden and controlled by parent) */}\r\n      {showToolbar && (\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            {!manualOnly && (\r\n              <button\r\n                className={`btn px-3 py-1 text-sm ${activeTab==='auto' ? 'tab--active' : ''}`}\r\n                onClick={()=>{ setActiveTab('auto'); setShowManualModal(false); setShowAutoModal(true) }}\r\n              >Autoscore</button>\r\n            )}\r\n            <button\r\n              className={`btn px-3 py-1 text-sm ${activeTab==='manual' ? 'tab--active' : ''}`}\r\n              onClick={()=>{ setActiveTab('manual'); setShowManualModal(true) }}\r\n              title=\"Open Manual Correction\"\r\n            >Manual Correction</button>\r\n            {manualOnly && (\r\n              <span className=\"text-xs opacity-70\">Manual scoring mode active</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {!hideInlinePanels && !manualOnly ? (\r\n        <div className=\"card relative\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Camera</h2>\r\n          <ResizablePanel storageKey=\"ndn:camera:size\" className=\"relative rounded-2xl overflow-hidden bg-black\" defaultWidth={480} defaultHeight={360} minWidth={320} minHeight={240} maxWidth={1600} maxHeight={900} autoFill>\r\n            <CameraSelector />\r\n            {preferredCameraLabel === 'Phone Camera' ? (\r\n              <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-4xl mb-4\">📱</div>\r\n                  <div className=\"text-lg font-semibold text-blue-100 mb-2\">Phone Camera Active</div>\r\n                  <div className=\"text-sm text-slate-300 mb-4\">Your phone camera feed is shown in the floating overlay</div>\r\n                  <div className=\"text-xs text-slate-400\">Camera controls available in Calibrator tab</div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              (() => {\r\n                const aspect = cameraAspect || (useUserSettings.getState().cameraAspect || 'wide')\r\n                const fit = (cameraFitMode || (useUserSettings.getState().cameraFitMode || 'fit')) === 'fit'\r\n                // For square aspect we left-align and cover so the video is clipped to the left portion\r\n                // This hides the right-side area (the red region in your screenshot) while keeping the board visible on the left.\r\n                const videoClass = (aspect === 'square')\r\n                  ? 'absolute left-0 top-1/2 -translate-y-1/2 min-w-full min-h-full object-cover object-left bg-black'\r\n                  : (fit\r\n                    ? 'absolute inset-0 w-full h-full object-contain object-center bg-black'\r\n                    : 'absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black')\r\n                // When square, limit the maximum width so the camera doesn't expand to fill the whole column\r\n                const containerClass = aspect === 'square'\r\n                  ? 'relative w-full max-w-[640px] mx-auto aspect-square bg-black'\r\n                  : 'relative w-full aspect-[4/3] bg-black'\r\n                return (\r\n                  <div className={containerClass}>\r\n                    <video ref={videoRef} className={videoClass} playsInline webkit-playsinline=\"true\" muted autoPlay />\r\n                    <canvas ref={overlayRef} className=\"absolute inset-0 w-full h-full\" onClick={onOverlayClick} />\r\n                    {/* Visit status dots: green=counts, red=not counted/miss, gray=not yet thrown */}\r\n                    <div className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3\"\r\n                      aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value>0?'hit':'miss') : 'pending'}, ${pendingEntries[1] ? (pendingEntries[1].value>0?'hit':'miss') : 'pending'}, ${pendingEntries[2] ? (pendingEntries[2].value>0?'hit':'miss') : 'pending'}`}\r\n                    >\r\n                      {[0,1,2].map(i => {\r\n                        const e = pendingEntries[i] as any\r\n                        const isPending = !e\r\n                        const isHit = !!e && (typeof e.value === 'number' ? e.value > 0 : true)\r\n                        const color = isPending ? 'bg-gray-500/70' : (isHit ? 'bg-emerald-400' : 'bg-rose-500')\r\n                        return <span key={i} className={`w-3 h-3 rounded-full shadow ${color}`} />\r\n                      })}\r\n                      {dartTimerEnabled && dartTimeLeft !== null && (\r\n                        <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\r\n                          {Math.max(0, dartTimeLeft)}s\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )\r\n              })()\r\n            )}\r\n          </ResizablePanel>\r\n\r\n          {/* Small Manual pill in top-right of camera card so users in any game mode can open Manual Correction */}\r\n          {inProgress ? (\r\n            <div className=\"absolute top-3 right-3 z-30\">\r\n              {/**\r\n               * Autoscore state styles:\r\n               * - success: recent auto detected a valid non-miss score -> green\r\n               * - ambiguous: recent auto detected but result is miss/zero/empty -> amber\r\n               * - idle: default white/neutral\r\n               */}\r\n              {\r\n                (() => {\r\n                  let stateClass = 'bg-white/90 text-slate-800'\r\n                  let title = 'Manual Correction (M)'\r\n                  if (hadRecentAuto) {\r\n                    const ok = !!lastAutoScore && lastAutoRing !== 'MISS' && lastAutoValue > 0\r\n                    if (ok) {\r\n                      stateClass = 'bg-emerald-600 text-white'\r\n                      title = `Manual Correction (M) — Autoscore: ${lastAutoScore} (confirmed)`\r\n                    } else {\r\n                      stateClass = 'bg-amber-400 text-black'\r\n                      title = `Manual Correction (M) — Autoscore ambiguous: ${lastAutoScore || '—'}`\r\n                    }\r\n                  }\r\n                  // Larger, clearer pill text and padding\r\n                  const baseClasses = 'px-4 py-2 rounded-full text-base font-semibold shadow-sm hover:opacity-90'\r\n                  const okNow = hadRecentAuto && !!lastAutoScore && lastAutoRing !== 'MISS' && lastAutoValue > 0\r\n                  const pulseClass = pulseManualPill && okNow ? 'ring-4 ring-emerald-400/60 animate-ping' : (hadRecentAuto && !okNow ? 'animate-pulse' : '')\r\n                  return (\r\n                    <button\r\n                      className={`${baseClasses} ${stateClass} ${pulseClass}`}\r\n                      onClick={() => { setActiveTab('manual'); setShowManualModal(true) }}\r\n                      title={title}\r\n                    >\r\n                      Manual\r\n                    </button>\r\n                  )\r\n                })()\r\n              }\r\n            </div>\r\n          ) : null}\r\n          <div className=\"flex gap-2 mt-3\">\r\n            {preferredCameraLabel === 'Phone Camera' ? (\r\n              <div className=\"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1\">\r\n                📱 Using phone camera from overlay\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {!streaming ? (\r\n                  <button className=\"btn\" onClick={startCamera} disabled={cameraStarting}>\r\n                    {cameraStarting ? 'Connecting Camera...' : 'Connect Camera'}\r\n                  </button>\r\n                ) : (\r\n                  <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={stopCamera}>Stop Camera</button>\r\n                )}\r\n                {/* Removed Snapshot panel; Capture remains for future features (e.g., quick preview) */}\r\n                <button className=\"btn\" onClick={capture} disabled={!streaming}>Capture Still</button>\r\n                <button className=\"btn bg-slate-700 hover:bg-slate-800\" disabled={!streaming} onClick={()=>{\r\n                  // Reset/seed detector background on demand\r\n                  detectorRef.current = null\r\n                  setDetectorSeedVersion(v=>v+1)\r\n                }}>Reset Autoscore Background</button>\r\n              </>\r\n            )}\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:camera-reset' as any)) }catch{} }}>Reset Camera Size</button>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {/* Floating Manual Correction button (always available for quick manual typing during games) */}\r\n      {inProgress ? (\r\n        <div className=\"fixed bottom-6 right-6 z-50\">\r\n          <button\r\n            className=\"btn btn--primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg\"\r\n            title=\"Open Manual Correction (M)\"\r\n            onClick={() => { setActiveTab('manual'); setShowManualModal(true) }}\r\n          >\r\n            ✏️\r\n          </button>\r\n        </div>\r\n      ) : null}\r\n      {!hideInlinePanels && manualOnly && (\r\n        <div className=\"card\">\r\n          <h2 className=\"text-xl font-semibold mb-3\">Manual Scoring</h2>\r\n          <p className=\"text-sm opacity-80 mb-3\">Camera-based autoscore is disabled. Use the manual visit input or open the Manual Correction panel to record darts.</p>\r\n          <div className=\"flex flex-wrap items-center gap-2\">\r\n            <button className=\"btn\" onClick={()=>{ setShowManualModal(true); setActiveTab('manual') }}>Open Manual Correction</button>\r\n            <button className=\"btn btn--ghost\" onClick={()=>{ try { window.dispatchEvent(new Event('ndn:open-scoring' as any)) } catch {} }}>Manage Pending Visit</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Snapshot panel removed to reduce unused space */}\r\n      <canvas ref={canvasRef} className=\"hidden\"></canvas>\r\n      {/* Autoscore moved into a pill-triggered modal to reduce on-screen clutter */}\r\n      {/* Modal: Autoscore */}\r\n  {showAutoModal && !manualOnly && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100]\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\r\n            <ResizableModal\r\n              storageKey=\"ndn:autoscore:size\"\r\n              className=\"w-full max-w-3xl\"\r\n              defaultWidth={720}\r\n              defaultHeight={520}\r\n              minWidth={420}\r\n              minHeight={320}\r\n              maxWidth={1400}\r\n              maxHeight={900}\r\n              initialFitHeight\r\n            >\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h2 className=\"text-xl font-semibold\">Autoscore</h2>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button className=\"btn btn--ghost\" onClick={()=>setShowAutoModal(false)}>Close</button>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm opacity-80 mb-3\">Click the camera overlay to autoscore. Use Manual Correction if the last auto is off.</div>\r\n              <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\r\n                <span className=\"font-semibold\">Last auto:</span>\r\n                <span>{lastAutoScore || '—'}</span>\r\n                <button className=\"btn\" onClick={onAddAutoDart} disabled={pendingDarts>=3}>Add Auto Dart</button>\r\n                {nonRegCount>0 && <span className=\"text-sm opacity-80\">No-registers: {nonRegCount}/3</span>}\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\r\n                {/* Bulls */}\r\n                <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                  <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                      const c = nonRegCount + 1\r\n                      setNonRegCount(c)\r\n                      if (c >= 5) setShowRecalModal(true)\r\n                    } else setNonRegCount(0)\r\n                    addDart(25, 'BULL 25', 'BULL'); setHadRecentAuto(false)\r\n                  }}>25</button>\r\n                  <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                    if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                      const c = nonRegCount + 1\r\n                      setNonRegCount(c)\r\n                      if (c >= 5) setShowRecalModal(true)\r\n                    } else setNonRegCount(0)\r\n                    addDart(50, 'INNER_BULL 50', 'INNER_BULL'); setHadRecentAuto(false)\r\n                  }}>50</button>\r\n                </div>\r\n                {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                <div className=\"flex items-center gap-2 mb-3\">\r\n                  <input\r\n                    className=\"input w-full max-w-sm\"\r\n                    list=\"autoscore-quick-list\"\r\n                    placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                    value={quickSelAuto}\r\n                    onChange={e=>setQuickSelAuto(e.target.value.toUpperCase())}\r\n                    onKeyDown={e=>{ if(e.key==='Enter'){ const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/); if(m){ onQuickEntry(parseInt(m[2],10), m[1] as any); } }} }\r\n                  />\r\n                  <datalist id=\"autoscore-quick-list\">\r\n                    {(['D','S','T'] as const).map(mult => (\r\n                      Array.from({length:20}, (_,i)=>i+1).map(num => (\r\n                        <option key={`${mult}${num}`} value={`${mult}${num}`} />\r\n                      ))\r\n                    ))}\r\n                  </datalist>\r\n                  <button\r\n                    className=\"btn\"\r\n                    disabled={!quickSelAuto || pendingDarts>=3}\r\n                    onClick={()=>{\r\n                      const m = quickSelAuto.match(/^(S|D|T)(\\d{1,2})$/)\r\n                      if (!m) return\r\n                      const mult = m[1] as 'S'|'D'|'T'\r\n                      const num = parseInt(m[2], 10)\r\n                      onQuickEntry(num, mult)\r\n                    }}\r\n                  >Add</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showManualModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100]\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <div className=\"p-3 md:p-4 flex items-center justify-between\">\r\n              <h3 className=\"text-xl md:text-2xl font-semibold\">Manual Correction</h3>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>{ setShowManualModal(false); }}>Close</button>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex-1 p-3 md:p-4\">\r\n              <div className=\"h-full grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n                {/* Live preview */}\r\n                <div className=\"card relative flex flex-col\">\r\n                  <div className=\"text-sm font-semibold mb-2\">Live Preview</div>\r\n                  <div className=\"relative flex-1 rounded-2xl overflow-hidden bg-black\">\r\n                    <canvas ref={manualPreviewRef} className=\"absolute inset-0 w-full h-full\" />\r\n                  </div>\r\n                </div>\r\n                {/* Manual controls */}\r\n                <div className=\"card flex flex-col\">\r\n                  <div className=\"text-sm opacity-80 mb-2\">Type a correction or replace the last dart. The preview updates live.</div>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <span className=\"font-semibold\">Last auto:</span>\r\n                    <span>{lastAutoScore || '—'}</span>\r\n                    <button className=\"btn\" onClick={onAddAutoDart} disabled={pendingDarts>=3}>Add Auto Dart</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <input\r\n                      className=\"input flex-1\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualScore}\r\n                      onChange={e => setManualScore(e.target.value)}\r\n                      onKeyDown={e => {\r\n                        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); onApplyManual() }\r\n                        if (e.key === 'Enter' && e.shiftKey) { e.preventDefault(); onReplaceManual() }\r\n                      }}\r\n                    />\r\n                    <button className=\"btn btn--ghost\" onClick={onReplaceManual} disabled={pendingDarts===0}>Replace Last</button>\r\n                    <button className=\"btn\" onClick={onApplyManual} disabled={pendingDarts>=3}>Add</button>\r\n                  </div>\r\n                  <div className=\"text-xs opacity-70 mb-4\">Press Enter to Add · Shift+Enter to Replace Last</div>\r\n                  {/* Numeric keypad for quick manual numeric entry */}\r\n                  <div className=\"mb-4\">\r\n                    <div className=\"text-sm font-semibold mb-2\">Number pad</div>\r\n                    <div className=\"grid grid-cols-3 gap-2 max-w-sm\">\r\n                      {['7','8','9','4','5','6','1','2','3','0'].map((d) => (\r\n                        <button key={d} className=\"btn text-lg\" onClick={()=>{\r\n                          // Append digit to manualScore (keep T/D/T prefixes if present)\r\n                          setManualScore(ms => {\r\n                            // If existing starts with letter (S/D/T), append after it\r\n                            if (/^[SDT]/i.test(ms)) return ms + d\r\n                            return (ms || '') + d\r\n                          })\r\n                        }}>{d}</button>\r\n                      ))}\r\n                      <button className=\"btn bg-rose-600 hover:bg-rose-700 text-white\" onClick={() => setManualScore('')}>Clear</button>\r\n                      <button className=\"btn bg-slate-600 hover:bg-slate-700 text-white\" onClick={() => setManualScore(ms => (ms||'').slice(0,-1))}>⌫</button>\r\n                      <button className=\"btn bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => onApplyManual()} disabled={pendingDarts>=3}>Enter</button>\r\n                    </div>\r\n                    <div className=\"text-xs opacity-70 mt-2\">Tap numbers then press Enter to submit. Use D/T prefixes for doubles/trebles (e.g., D16).</div>\r\n                  </div>\r\n                  <div className=\"mt-auto\">\r\n                    <div className=\"text-sm font-semibold mb-2\">Quick entry</div>\r\n                    {/* Bulls */}\r\n                    <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                      <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                        if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                          const c = nonRegCount + 1\r\n                          setNonRegCount(c)\r\n                          if (c >= 5) setShowRecalModal(true)\r\n                        } else setNonRegCount(0)\r\n                        addDart(25, 'BULL 25', 'BULL'); setHadRecentAuto(false)\r\n                      }}>25</button>\r\n                      <button className=\"btn\" disabled={pendingDarts>=3} onClick={()=>{\r\n                        if (!hadRecentAuto || !lastAutoScore || lastAutoRing === 'MISS' || lastAutoValue === 0) {\r\n                          const c = nonRegCount + 1\r\n                          setNonRegCount(c)\r\n                          if (c >= 5) setShowRecalModal(true)\r\n                        } else setNonRegCount(0)\r\n                        addDart(50, 'INNER_BULL 50', 'INNER_BULL'); setHadRecentAuto(false)\r\n                      }}>50</button>\r\n                    </div>\r\n                    {/* Grouped dropdown: Doubles, Singles, Trebles */}\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <input\r\n                        className=\"input w-full max-w-sm\"\r\n                        list=\"manual-quick-list\"\r\n                        placeholder=\"Type or select (e.g., D16, T20, S5)\"\r\n                        value={quickSelManual}\r\n                        onChange={e=>setQuickSelManual(e.target.value.toUpperCase())}\r\n                        onKeyDown={e=>{ if(e.key==='Enter'){ const m = quickSelManual.match(/^(S|D|T)(\\d{1,2})$/); if(m){ onQuickEntry(parseInt(m[2],10), m[1] as any); } }} }\r\n                      />\r\n                      <datalist id=\"manual-quick-list\">\r\n                        {(['D','S','T'] as const).map(mult => (\r\n                          Array.from({length:20}, (_,i)=>i+1).map(num => (\r\n                            <option key={`${mult}${num}`} value={`${mult}${num}`} />\r\n                          ))\r\n                        ))}\r\n                      </datalist>\r\n                      <button\r\n                        className=\"btn\"\r\n                        disabled={!quickSelManual || pendingDarts>=3}\r\n                        onClick={()=>{\r\n                          const m = quickSelManual.match(/^(S|D|T)(\\d{1,2})$/)\r\n                          if (!m) return\r\n                          const mult = m[1] as 'S'|'D'|'T'\r\n                          const num = parseInt(m[2], 10)\r\n                          onQuickEntry(num, mult)\r\n                        }}\r\n                      >Add</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showScoringModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center\">\r\n          <div className=\"card w-full max-w-4xl relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={()=>setShowScoringModal(false)}>Close</button>\r\n            <h2 className=\"text-xl font-bold mb-4 flex items-center gap-2 text-white\">Scoring</h2>\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {/* Camera section */}\r\n              <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">Camera</h2>\r\n                <ResizablePanel storageKey=\"ndn:camera:size:modal\" className=\"relative rounded-2xl overflow-hidden bg-black\" defaultWidth={480} defaultHeight={360} minWidth={320} minHeight={240} maxWidth={1600} maxHeight={900}>\r\n                  <CameraSelector />\r\n                  {preferredCameraLabel === 'Phone Camera' ? (\r\n                    <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900/50 to-purple-900/50\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-4xl mb-4\">📱</div>\r\n                        <div className=\"text-lg font-semibold text-blue-100 mb-2\">Phone Camera Active</div>\r\n                        <div className=\"text-sm text-slate-300 mb-4\">Your phone camera feed is shown in the floating overlay</div>\r\n                        <div className=\"text-xs text-slate-400\">Camera controls available in Calibrator tab</div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    (() => {\r\n                      const fit = (useUserSettings.getState().cameraFitMode || 'fit') === 'fit'\r\n                      const videoClass = fit\r\n                        ? 'absolute inset-0 w-full h-full object-contain object-center bg-black'\r\n                        : 'absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 min-w-full min-h-full w-auto h-auto object-cover object-center bg-black'\r\n                      return (\r\n                        <div className=\"relative w-full aspect-[4/3] bg-black\">\r\n                          <video ref={videoRef} className={videoClass} playsInline webkit-playsinline=\"true\" muted autoPlay />\r\n                          <canvas ref={overlayRef} className=\"absolute inset-0 w-full h-full\" onClick={onOverlayClick} />\r\n                          {/* Visit status dots: green=counts, red=not counted/miss, gray=not yet thrown */}\r\n                          <div className=\"absolute top-2 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3\"\r\n                            aria-label={`Visit status: ${pendingEntries[0] ? (pendingEntries[0].value>0?'hit':'miss') : 'pending'}, ${pendingEntries[1] ? (pendingEntries[1].value>0?'hit':'miss') : 'pending'}, ${pendingEntries[2] ? (pendingEntries[2].value>0?'hit':'miss') : 'pending'}`}\r\n                          >\r\n                            {[0,1,2].map(i => {\r\n                              const e = pendingEntries[i] as any\r\n                              const isPending = !e\r\n                              const isHit = !!e && (typeof e.value === 'number' ? e.value > 0 : true)\r\n                              const color = isPending ? 'bg-gray-500/70' : (isHit ? 'bg-emerald-400' : 'bg-rose-500')\r\n                              return <span key={i} className={`w-3 h-3 rounded-full shadow ${color}`} />\r\n                            })}\r\n                            {dartTimerEnabled && dartTimeLeft !== null && (\r\n                              <span className=\"px-2 py-0.5 rounded bg-black/60 text-white text-xs font-semibold\">\r\n                                {Math.max(0, dartTimeLeft)}s\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      )\r\n                    })()\r\n                  )}\r\n                </ResizablePanel>\r\n                <div className=\"flex gap-2 mt-3\">\r\n                  {preferredCameraLabel === 'Phone Camera' ? (\r\n                    <div className=\"text-sm text-blue-200 px-3 py-2 rounded bg-blue-900/30 flex-1\">\r\n                      📱 Using phone camera from overlay\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      {!streaming ? (\r\n                        <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={startCamera}>Connect Camera</button>\r\n                      ) : (\r\n                        <button className=\"btn bg-gradient-to-r from-rose-600 to-rose-700 text-white font-bold\" onClick={stopCamera}>Stop Camera</button>\r\n                      )}\r\n                      <button className=\"btn bg-gradient-to-r from-indigo-500 to-indigo-700 text-white font-bold\" onClick={capture} disabled={!streaming}>Capture Still</button>\r\n                      <button className=\"btn bg-gradient-to-r from-slate-600 to-slate-800 text-white font-bold\" disabled={!streaming} onClick={()=>{ detectorRef.current = null; setDetectorSeedVersion(v=>v+1) }}>Reset Autoscore Background</button>\r\n                    </>\r\n                  )}\r\n                  <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:camera-reset' as any)) }catch{} }}>Reset Camera Size</button>\r\n                </div>\r\n              </div>\r\n              {/* Pending Visit section */}\r\n              <div className=\"bg-black/30 rounded-2xl p-4\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">Pending Visit</h2>\r\n                <div className=\"text-sm opacity-80 mb-2\">Up to 3 darts per visit.</div>\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  {[0,1,2].map(i => {\r\n                    const e = pendingEntries[i] as any\r\n                    const isPending = !e\r\n                    const isHit = !!e && (typeof e.value === 'number' ? e.value > 0 : true)\r\n                    const color = isPending ? 'bg-gray-500/70' : (isHit ? 'bg-emerald-400' : 'bg-rose-500')\r\n                    return <span key={i} className={`w-2.5 h-2.5 rounded-full shadow ${color}`} />\r\n                  })}\r\n                  {dartTimerEnabled && dartTimeLeft !== null && (\r\n                    <span className=\"ml-2 px-2 py-0.5 rounded bg-black/40 text-white text-xs font-semibold\">{Math.max(0, dartTimeLeft)}s</span>\r\n                  )}\r\n                </div>\r\n                <ul className=\"text-sm mb-2 list-disc pl-5\">\r\n                  {pendingEntries.length === 0 ? <li className=\"opacity-60\">No darts yet</li> : pendingEntries.map((e,i) => <li key={i}>{e.label}</li>)}\r\n                </ul>\r\n                <div className=\"flex items-center gap-4 mb-2\">\r\n                  <div className=\"font-semibold\">Darts: {pendingDarts}/3</div>\r\n                  <div className=\"font-semibold\">Total: {pendingScore}</div>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                  <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={onUndoDart} disabled={pendingDarts===0}>Undo Dart</button>\r\n                  <button className=\"btn bg-gradient-to-r from-emerald-500 to-emerald-700 text-white font-bold\" onClick={onCommitVisit} disabled={pendingDarts===0}>Commit Visit</button>\r\n                  <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{setPendingDarts(0);setPendingScore(0);setPendingEntries([])}} disabled={pendingDarts===0}>Clear</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showRecalModal && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <div className=\"card max-w-md w-full relative text-left bg-[#2d2250] text-white p-6 rounded-xl shadow-xl\">\r\n            <button className=\"absolute top-2 right-2 btn px-2 py-1 bg-purple-500 text-white font-bold\" onClick={()=>{setShowRecalModal(false); setNonRegCount(0)}}>Close</button>\r\n            <h3 className=\"text-xl font-bold mb-2 flex items-center gap-2 text-white\">Recalibration Recommended</h3>\r\n            <div className=\"mb-4 text-lg font-semibold text-indigo-200\">We detected 3 incorrect autoscores in a row. You can recalibrate now or reset calibration and try again.</div>\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"btn bg-gradient-to-r from-purple-500 to-purple-700 text-white font-bold\" onClick={onRecalibrateNow}>Go to Calibrate</button>\r\n              <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={onResetCalibration}>Reset Calibration</button>\r\n              <button className=\"btn bg-gradient-to-r from-slate-500 to-slate-700 text-white font-bold\" onClick={()=>{setShowRecalModal(false); setNonRegCount(0)}}>Dismiss</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n  {/* Duplicate Pending Visit panel removed to avoid showing the same controls twice when inline panels are visible. */}\r\n    </div>\r\n  )\r\n}\r\n","import React, { useEffect, useRef } from 'react'\r\nimport useHeatmapStore from '../store/heatmap'\r\nimport { BoardRadii } from '../utils/vision'\r\n\r\nfunction polarToCartesian(cx: number, cy: number, r: number, angleDeg: number) {\r\n  const a = (angleDeg - 90) * Math.PI / 180.0\r\n  return { x: cx + (r * Math.cos(a)), y: cy + (r * Math.sin(a)) }\r\n}\r\n\r\nfunction sectorAngle(sector: number) {\r\n  // SectorOrder puts 20 at top; 360/20 = 18deg per sector\r\n  const SectorOrder = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5]\r\n  const idx = SectorOrder.indexOf(sector)\r\n  const mid = (idx * 18) + 9 // middle of sector\r\n  return mid\r\n}\r\n\r\nexport default function HeatMap({ width = 320, height = 320 }: { width?: number; height?: number }) {\r\n  const samples = useHeatmapStore(s => s.samples)\r\n  const ref = useRef<HTMLCanvasElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    const c = ref.current\r\n    if (!c) return\r\n    const ctx = c.getContext('2d')\r\n    if (!ctx) return\r\n    c.width = width; c.height = height\r\n    ctx.clearRect(0,0,width,height)\r\n    // Draw a faint dartboard backdrop (rings)\r\n    const cx = width / 2\r\n    const cy = height / 2\r\n    const scale = Math.min(width, height) / (BoardRadii.doubleOuter * 2 + 20)\r\n    const radii = {\r\n      bullInner: BoardRadii.bullInner * scale,\r\n      bullOuter: BoardRadii.bullOuter * scale,\r\n      trebleInner: BoardRadii.trebleInner * scale,\r\n      trebleOuter: BoardRadii.trebleOuter * scale,\r\n      doubleInner: BoardRadii.doubleInner * scale,\r\n      doubleOuter: BoardRadii.doubleOuter * scale,\r\n    }\r\n    // rings\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)'\r\n    ctx.lineWidth = 1\r\n    const ringOrder = ['doubleOuter','doubleInner','trebleOuter','trebleInner','bullOuter','bullInner'] as const\r\n    for (const k of ringOrder) {\r\n      ctx.beginPath(); ctx.arc(cx, cy, (radii as any)[k], 0, Math.PI*2); ctx.stroke();\r\n    }\r\n\r\n    // Aggregate sample weights by approximate xy\r\n    const points: { x:number;y:number;w:number }[] = []\r\n    for (const s of samples) {\r\n      // if sector unknown, scatter in board\r\n      let angle = Math.random() * 360\r\n      let r = Math.random() * radii.doubleOuter\r\n      if (typeof s.sector === 'number' && s.sector >= 1 && s.sector <= 20) {\r\n        angle = sectorAngle(s.sector)\r\n        // choose radius by mult/ring\r\n        if (s.ring === 'DOUBLE') r = (radii.doubleInner + radii.doubleOuter)/2\r\n        else if (s.ring === 'TRIPLE') r = (radii.trebleInner + radii.trebleOuter)/2\r\n        else if (s.ring === 'INNER_BULL') r = radii.bullInner * 0.5\r\n        else if (s.ring === 'BULL') r = radii.bullOuter * 0.8\r\n        else r = (radii.trebleOuter + radii.doubleInner)/2 * (0.6 + Math.random()*0.4)\r\n      }\r\n      const p = polarToCartesian(cx, cy, r, angle)\r\n      points.push({ x: p.x, y: p.y, w: 1 })\r\n    }\r\n\r\n    // Draw heat circles additive\r\n    for (const p of points) {\r\n      const grd = ctx.createRadialGradient(p.x, p.y, 1, p.x, p.y, 60)\r\n      grd.addColorStop(0, 'rgba(255,0,0,0.9)')\r\n      grd.addColorStop(0.3, 'rgba(255,100,0,0.5)')\r\n      grd.addColorStop(1, 'rgba(255,100,0,0)')\r\n      ctx.fillStyle = grd\r\n      ctx.beginPath(); ctx.arc(p.x, p.y, 60, 0, Math.PI*2); ctx.fill()\r\n    }\r\n\r\n    // Optionally overlay counts per sector\r\n    ctx.fillStyle = 'rgba(255,255,255,0.85)'\r\n    ctx.font = '12px ui-sans-serif'\r\n    // compute counts per sector\r\n    const sectorCounts: Record<number, number> = {}\r\n    for (const s of samples) if (s.sector) sectorCounts[s.sector] = (sectorCounts[s.sector] || 0) + 1\r\n    for (const secStr of Object.keys(sectorCounts)) {\r\n      const sec = Number(secStr)\r\n      const a = sectorAngle(sec)\r\n      const pos = polarToCartesian(cx, cy, radii.trebleOuter + 18, a)\r\n      ctx.fillText(String(sectorCounts[sec]), pos.x-6, pos.y+4)\r\n    }\r\n  }, [samples, width, height])\r\n\r\n  return <canvas ref={ref} style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#081018' }} />\r\n}\r\n","export type DartMult = 'S' | 'D' | 'T'\r\nexport type Dart = { mult: DartMult; num: number } | { bull: 25 | 50 }\r\n\r\nexport type DoublePracticeState = {\r\n\ttargetIndex: number // 0..20 for D1..D20 then 21 for DBULL\r\n\tcompleted: boolean\r\n}\r\n\r\nexport const DOUBLE_PRACTICE_TARGETS: Array<{ label: string; score: number; isBull?: boolean }>[] = [] as any\r\n\r\nexport const DOUBLE_PRACTICE_ORDER: { label: string; score: number; isBull?: boolean }[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => ({ label: `D${i + 1}` , score: (i + 1) * 2 })),\r\n\t{ label: 'DBULL', score: 50, isBull: true },\r\n]\r\n\r\nexport function isDoubleHit(value: number, targetIdx: number): boolean {\r\n\tconst t = DOUBLE_PRACTICE_ORDER[targetIdx]\r\n\treturn !!t && value === t.score\r\n}\r\n\r\nexport function parseManualDart(input: string): number | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n\tif (t === '25' || t === 'OBULL') return 25\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n\tconst num = parseInt(m[2],10)\r\n\tif (num < 1 || num > 20) return null\r\n\tconst multVal = mult==='S'?1:mult==='D'?2:3\r\n\treturn num * multVal\r\n}\r\n\r\n// Parse a detailed dart string like \"T20\", \"D16\", \"S5\", \"25\", \"50\", \"BULL\", returning a structured Dart.\r\nexport function parseDartDetailed(input: string): Dart | null {\r\n\tconst t = input.trim().toUpperCase()\r\n\tif (!t) return null\r\n\tif (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t === 'INNER BULL' || t === 'INNER_BULL') return { bull: 50 }\r\n\tif (t === '25' || t === 'OBULL' || t === 'OUTER BULL' || t === 'BULL25') return { bull: 25 }\r\n\tconst m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n\tif (!m) return null\r\n\tconst mult = (m[1] || 'S') as DartMult\r\n\tconst num = parseInt(m[2], 10)\r\n\tif (num < 1 || num > 20) return null\r\n\treturn { mult, num }\r\n}\r\n\r\n// Convert autoscore ring+sector data into a structured Dart\r\n// ring: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'\r\n// sector: 1..20 for numbered segments; null/undefined for bull/miss\r\nexport function ringSectorToDart(ring?: string, sector?: number | null): Dart | null {\r\n\tif (!ring || ring === 'MISS') return null\r\n\tif (ring === 'BULL') return { bull: 25 }\r\n\tif (ring === 'INNER_BULL') return { bull: 50 }\r\n\tif (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n\t\tconst mult: DartMult = ring === 'DOUBLE' ? 'D' : ring === 'TRIPLE' ? 'T' : 'S'\r\n\t\treturn { mult, num: sector }\r\n\t}\r\n\treturn null\r\n}\r\n","export type ATCState = {\r\n\ttarget: number // 1..20 then 25 (outer bull) then 50 (inner)\r\n\tfinished: boolean\r\n}\r\n\r\nexport const ATC_ORDER: number[] = [\r\n\t...Array.from({ length: 20 }, (_, i) => i + 1),\r\n\t25,\r\n\t50,\r\n]\r\n\r\nexport function nextTarget(current: number): number | null {\r\n\tconst idx = ATC_ORDER.indexOf(current)\r\n\tif (idx < 0) return ATC_ORDER[0]\r\n\tif (idx >= ATC_ORDER.length - 1) return null\r\n\treturn ATC_ORDER[idx + 1]\r\n}\r\n\r\nexport function isCorrectHit(value: number, target: number): boolean {\r\n\treturn value === target\r\n}\r\n\r\n","export type CricketMark = 0 | 1 | 2 | 3\r\nexport type CricketNumber = 15 | 16 | 17 | 18 | 19 | 20 | 25 // 25 is bull (outer+inner)\r\n\r\nexport type CricketState = {\r\n\t// marks per number\r\n\tmarks: Record<CricketNumber, CricketMark>\r\n\t// accumulated points when opponent hasn't closed a number\r\n\tpoints: number\r\n}\r\n\r\nexport const CRICKET_NUMBERS: CricketNumber[] = [20, 19, 18, 17, 16, 15, 25]\r\n\r\nexport function createCricketState(): CricketState {\r\n\tconst marks: any = {}\r\n\tCRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n\treturn { marks, points: 0 }\r\n}\r\n\r\n// Apply a single dart to a player's cricket state\r\n// Returns deltaPoints scored on this dart\r\nexport function applyCricketDart(state: CricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: CricketNumber) => boolean = () => false): number {\r\n\t// Map autoscore terms to logical hits\r\n\tlet num: CricketNumber | null = null\r\n\tlet hits = 0\r\n\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n\t\tnum = 25\r\n\t\thits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n\t} else if (typeof sector === 'number' && (sector as number) >= 15 && (sector as number) <= 20) {\r\n\t\tnum = sector as CricketNumber\r\n\t\tif (ring === 'TRIPLE') hits = 3\r\n\t\telse if (ring === 'DOUBLE') hits = 2\r\n\t\telse hits = 1\r\n\t} else if (value) {\r\n\t\t// Fallback when only numeric score provided (manual): infer by divisibility\r\n\t\tconst cand: CricketNumber[] = [20,19,18,17,16,15]\r\n\t\tfor (const c of cand) {\r\n\t\t\tif (value === c) { num = c; hits = 1; break }\r\n\t\t\tif (value === c*2) { num = c; hits = 2; break }\r\n\t\t\tif (value === c*3) { num = c; hits = 3; break }\r\n\t\t}\r\n\t\tif (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n\t}\r\n\tif (!num) return 0\r\n\r\n\tconst before = state.marks[num]\r\n\tlet remainToClose = Math.max(0, 3 - before)\r\n\tconst toApply = Math.min(remainToClose, hits)\r\n\tconst overflow = Math.max(0, hits - toApply)\r\n\t// Increase marks up to 3\r\n\tconst after = (before + toApply) as CricketMark\r\n\tstate.marks[num] = after > 3 ? 3 : after\r\n\r\n\t// Overflow counts as points only if opponent hasn't closed this number and number is not bull (bull scores too per standard rules when opponent open)\r\n\tlet points = 0\r\n\tif (overflow > 0 && !opponentClosed(num)) {\r\n\t\tif (num === 25) {\r\n\t\t\t// Overflow on bull: each extra hit beyond 3 adds 25 or 50 depending on which ring hit overflowed; approximate as 25 per hit except inner counts double. We don't know exact ring for overflow; assume 25 per extra except when ring provided as INNER_BULL and overflow>0.\r\n\t\t\tif (ring === 'INNER_BULL') points += 50 * overflow\r\n\t\t\telse points += 25 * overflow\r\n\t\t} else {\r\n\t\t\tpoints += num * overflow\r\n\t\t}\r\n\t}\r\n\r\n\tstate.points += points\r\n\treturn points\r\n}\r\n\r\nexport function hasClosedAll(state: CricketState): boolean {\r\n\treturn CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n\r\nexport function cricketWinner(self: CricketState, opponents: CricketState[]): boolean {\r\n\t// Win when all closed and you have >= opponents' points\r\n\tif (!hasClosedAll(self)) return false\r\n\tconst maxOppPoints = Math.max(0, ...opponents.map(o => o.points))\r\n\treturn self.points >= maxOppPoints\r\n}\r\n","export type ShanghaiRound = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20\r\n\r\nexport type ShanghaiState = {\r\n\tround: ShanghaiRound\r\n\tscore: number\r\n\tfinished: boolean\r\n\tshanghaiAchieved: boolean // single+double+triple of target in same 3-dart turn\r\n\tturnHits: { singles: number; doubles: number; triples: number }\r\n}\r\n\r\nexport function createShanghaiState(): ShanghaiState {\r\n\treturn { round: 1, score: 0, finished: false, shanghaiAchieved: false, turnHits: { singles: 0, doubles: 0, triples: 0 } }\r\n}\r\n\r\nexport function getRoundTarget(state: ShanghaiState): number { return state.round }\r\n\r\n// Apply one dart; returns points scored on this dart\r\nexport function applyShanghaiDart(state: ShanghaiState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst target = getRoundTarget(state)\r\n\tlet points = 0\r\n\tif (typeof sector === 'number' && sector === target) {\r\n\t\tif (ring === 'TRIPLE') { points = target * 3; state.turnHits.triples++ }\r\n\t\telse if (ring === 'DOUBLE') { points = target * 2; state.turnHits.doubles++ }\r\n\t\telse if (ring === 'SINGLE') { points = target * 1; state.turnHits.singles++ }\r\n\t} else if (!sector && (value === target || value === target*2 || value === target*3)) {\r\n\t\t// manual numeric entry fallback\r\n\t\tif (value === target*3) { points = target*3; state.turnHits.triples++ }\r\n\t\telse if (value === target*2) { points = target*2; state.turnHits.doubles++ }\r\n\t\telse if (value === target) { points = target; state.turnHits.singles++ }\r\n\t}\r\n\tstate.score += points\r\n\treturn points\r\n}\r\n\r\n// Call at end of 3-dart turn; advances round and checks Shanghai\r\nexport function endShanghaiTurn(state: ShanghaiState) {\r\n\tif (!state.finished) {\r\n\t\tif (state.turnHits.singles>0 && state.turnHits.doubles>0 && state.turnHits.triples>0) {\r\n\t\t\tstate.shanghaiAchieved = true\r\n\t\t\tstate.finished = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst next = (state.round + 1) as ShanghaiRound\r\n\t\tif (next > 20) { state.finished = true } else { state.round = next }\r\n\t}\r\n\t// reset per-turn hits\r\n\tstate.turnHits = { singles: 0, doubles: 0, triples: 0 }\r\n}\r\n","export type HalveItTarget =\r\n\t| { kind: 'ANY_NUMBER' }\r\n\t| { kind: 'DOUBLE'; num: number }\r\n\t| { kind: 'TRIPLE'; num: number }\r\n\t| { kind: 'BULL' }\r\n\t| { kind: 'NUMBER'; num: number }\r\n\r\nexport type HalveItState = {\r\n\tstage: number\r\n\ttargets: HalveItTarget[]\r\n\tscore: number\r\n\tfinished: boolean\r\n\thitThisRound: boolean\r\n}\r\n\r\nexport function createDefaultHalveIt(): HalveItState {\r\n\tconst targets: HalveItTarget[] = [\r\n\t\t{ kind: 'NUMBER', num: 20 },\r\n\t\t{ kind: 'DOUBLE', num: 16 },\r\n\t\t{ kind: 'TRIPLE', num: 14 },\r\n\t\t{ kind: 'NUMBER', num: 19 },\r\n\t\t{ kind: 'BULL' },\r\n\t\t{ kind: 'ANY_NUMBER' },\r\n\t]\r\n\treturn { stage: 0, targets, score: 0, finished: false, hitThisRound: false }\r\n}\r\n\r\nexport function getCurrentHalveTarget(state: HalveItState): HalveItTarget | null {\r\n\treturn state.targets[state.stage] || null\r\n}\r\n\r\nexport function applyHalveItDart(state: HalveItState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\tconst t = getCurrentHalveTarget(state)\r\n\tif (!t) return 0\r\n\tlet scored = 0\r\n\tswitch (t.kind) {\r\n\t\tcase 'NUMBER': {\r\n\t\t\tif (typeof sector === 'number' && sector === t.num) {\r\n\t\t\t\tif (ring === 'TRIPLE') scored = t.num * 3\r\n\t\t\t\telse if (ring === 'DOUBLE') scored = t.num * 2\r\n\t\t\t\telse if (ring === 'SINGLE') scored = t.num\r\n\t\t\t} else if (!sector && (value === t.num || value === t.num*2 || value === t.num*3)) {\r\n\t\t\t\tscored = value\r\n\t\t\t}\r\n\t\t\tif (scored > 0) state.hitThisRound = true\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'DOUBLE': {\r\n\t\t\tif ((ring === 'DOUBLE' && sector === t.num) || value === t.num*2) { scored = t.num*2; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'TRIPLE': {\r\n\t\t\tif ((ring === 'TRIPLE' && sector === t.num) || value === t.num*3) { scored = t.num*3; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'BULL': {\r\n\t\t\tif (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) { scored = (ring === 'INNER_BULL' || value === 50) ? 50 : 25; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tcase 'ANY_NUMBER': {\r\n\t\t\t// any valid score counts\r\n\t\t\tif (value > 0) { scored = value; state.hitThisRound = true }\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHalveItTurn(state: HalveItState) {\r\n\tif (state.finished) return\r\n\tif (!state.hitThisRound) {\r\n\t\tstate.score = Math.floor(state.score / 2)\r\n\t}\r\n\tstate.hitThisRound = false\r\n\tstate.stage += 1\r\n\tif (state.stage >= state.targets.length) state.finished = true\r\n}\r\n","export type HighLowState = {\r\n\tround: number\r\n\tscore: number\r\n\ttarget: 'HIGH' | 'LOW'\r\n\tfinished: boolean\r\n}\r\n\r\nexport function createHighLow(): HighLowState {\r\n\treturn { round: 1, score: 0, target: 'HIGH', finished: false }\r\n}\r\n\r\nexport function applyHighLowDart(state: HighLowState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): number {\r\n\tif (state.finished) return 0\r\n\t// For simplicity: when target is HIGH, count only scores >= 20 (any ring) and bull as 50\r\n\t// When LOW, count only scores <= 10 (any ring) and bull does not count\r\n\tlet scored = 0\r\n\tif (state.target === 'HIGH') {\r\n\t\tif (ring === 'INNER_BULL') scored = 50\r\n\t\telse if (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector >= 20) scored = v\r\n\t\t} else {\r\n\t\t\t// manual numeric fallback\r\n\t\t\tif (value >= 40) scored = value\r\n\t\t}\r\n\t} else {\r\n\t\tif (typeof sector === 'number') {\r\n\t\t\tconst mult = ring === 'TRIPLE' ? 3 : ring === 'DOUBLE' ? 2 : 1\r\n\t\t\tconst v = sector * mult\r\n\t\t\tif (sector <= 10) scored = v\r\n\t\t} else {\r\n\t\t\tif (value > 0 && value <= 30) scored = value\r\n\t\t}\r\n\t}\r\n\tstate.score += scored\r\n\treturn scored\r\n}\r\n\r\nexport function endHighLowTurn(state: HighLowState) {\r\n\tif (state.finished) return\r\n\tstate.round += 1\r\n\tif (state.round > 10) { state.finished = true; return }\r\n\tstate.target = state.target === 'HIGH' ? 'LOW' : 'HIGH'\r\n}\r\n","export type KillerState = {\r\n  number: number // assigned sector 1..20\r\n  lives: number // start with 3\r\n  isKiller: boolean // became killer by hitting own double\r\n  eliminated: boolean\r\n}\r\n\r\nexport function createKillerState(assigned: number, lives = 3): KillerState {\r\n  return { number: assigned, lives, isKiller: false, eliminated: false }\r\n}\r\n\r\n// Assign unique random numbers (1..20) to each player id\r\nexport function assignKillerNumbers<T extends string>(playerIds: T[]): Record<T, number> {\r\n  const pool = Array.from({ length: 20 }, (_, i) => i + 1)\r\n  const res: any = {}\r\n  for (const id of playerIds) {\r\n    // pick a random remaining number\r\n    const idx = Math.floor(Math.random() * pool.length)\r\n    const num = pool.splice(idx, 1)[0]\r\n    res[id] = num\r\n  }\r\n  return res\r\n}\r\n\r\n// Apply a single dart in Killer context.\r\n// Returns an object describing outcomes: becameKiller, victimId (if hit), livesRemoved\r\nexport function applyKillerDart(\r\n  selfId: string,\r\n  states: Record<string, KillerState>,\r\n  ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL',\r\n  sector?: number | null\r\n): { becameKiller: boolean; victimId?: string; livesRemoved?: number } {\r\n  const me = states[selfId]\r\n  if (!me || !sector || !ring) return { becameKiller: false }\r\n  // Becoming killer: hit your own DOUBLE only\r\n  if (!me.isKiller && ring === 'DOUBLE' && sector === me.number) {\r\n    me.isKiller = true\r\n    return { becameKiller: true }\r\n  }\r\n  // If already killer, hitting opponents' doubles/triples removes lives\r\n  if (me.isKiller && (ring === 'DOUBLE' || ring === 'TRIPLE')) {\r\n    const victimId = Object.keys(states).find(pid => pid !== selfId && !states[pid].eliminated && states[pid].number === sector)\r\n    if (victimId) {\r\n      const victim = states[victimId]\r\n      const delta = ring === 'TRIPLE' ? 2 : 1\r\n      victim.lives = Math.max(0, victim.lives - delta)\r\n      if (victim.lives === 0) victim.eliminated = true\r\n      return { becameKiller: false, victimId, livesRemoved: delta }\r\n    }\r\n  }\r\n  return { becameKiller: false }\r\n}\r\n\r\nexport function killerWinner(states: Record<string, KillerState>): string | null {\r\n  const alive = Object.entries(states).filter(([,st]) => !st.eliminated && st.lives > 0)\r\n  if (alive.length === 1) return alive[0][0]\r\n  return null\r\n}\r\n","export type BaseballInning = 1|2|3|4|5|6|7|8|9\r\n\r\nexport type BaseballState = {\r\n  inning: BaseballInning\r\n  score: number\r\n  dartsThisInning: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createBaseball(): BaseballState {\r\n  return { inning: 1, score: 0, dartsThisInning: 0, finished: false }\r\n}\r\n\r\n// Each inning, only the inning number scores; hits count 1, double 2, triple 3 runs (no bull scoring)\r\nexport function applyBaseballDart(state: BaseballState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): number {\r\n  if (state.finished) return 0\r\n  let runs = 0\r\n  if (typeof sector === 'number' && sector === state.inning) {\r\n    if (ring === 'TRIPLE') runs = 3\r\n    else if (ring === 'DOUBLE') runs = 2\r\n    else runs = 1\r\n  } else if (!sector && (value === state.inning || value === state.inning*2 || value === state.inning*3)) {\r\n    runs = value === state.inning*3 ? 3 : value === state.inning*2 ? 2 : 1\r\n  }\r\n  state.score += runs\r\n  state.dartsThisInning += 1\r\n  if (state.dartsThisInning >= 3) {\r\n    const next = (state.inning + 1) as BaseballInning\r\n    if (next > 9) state.finished = true\r\n    else { state.inning = next; state.dartsThisInning = 0 }\r\n  }\r\n  return runs\r\n}\r\n","export type GolfHole = 1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18\r\n\r\n// Simple darts golf: each hole targets a predefined number (map); par is 2 throws; score is number of darts used to hit the target ring.\r\n// For simplicity, we count a hole complete on first valid hit (single/double/triple of the target), score increments by darts used.\r\n\r\nexport const GOLF_TARGETS: Record<GolfHole, number> = {\r\n  1: 5, 2: 20, 3: 1, 4: 18, 5: 4, 6: 13, 7: 6, 8: 10, 9: 15,\r\n  10: 2, 11: 17, 12: 3, 13: 19, 14: 7, 15: 16, 16: 8, 17: 11, 18: 14,\r\n}\r\n\r\nexport type GolfState = {\r\n  hole: GolfHole\r\n  strokes: number\r\n  dartsThisHole: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createGolf(): GolfState {\r\n  return { hole: 1, strokes: 0, dartsThisHole: 0, finished: false }\r\n}\r\n\r\nexport function applyGolfDart(state: GolfState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null): boolean {\r\n  if (state.finished) return false\r\n  const target = GOLF_TARGETS[state.hole]\r\n  state.dartsThisHole += 1\r\n  const hit = (typeof sector === 'number' && sector === target && (ring==='SINGLE'||ring==='DOUBLE'||ring==='TRIPLE')) || (!sector && (value===target || value===target*2 || value===target*3))\r\n  if (hit) {\r\n    state.strokes += state.dartsThisHole\r\n    // advance to next hole\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n    return true\r\n  }\r\n  // If not finished and took 3 darts, score 3 and advance hole\r\n  if (state.dartsThisHole >= 3) {\r\n    state.strokes += 3\r\n    const next = (state.hole + 1) as GolfHole\r\n    if (next > 18) state.finished = true\r\n    else { state.hole = next; state.dartsThisHole = 0 }\r\n  }\r\n  return false\r\n}\r\n","export type TicCell = 0|1|2|3|4|5|6|7|8\r\n\r\n// Map grid cells to targets: center uses Bull; edges/corners use numbers.\r\nexport const TTT_TARGETS: Record<TicCell, { type: 'NUM'|'BULL'; num?: number }> = {\r\n  0: { type: 'NUM', num: 20 }, 1: { type: 'NUM', num: 19 }, 2: { type: 'NUM', num: 18 },\r\n  3: { type: 'NUM', num: 17 }, 4: { type: 'BULL' }, 5: { type: 'NUM', num: 16 },\r\n  6: { type: 'NUM', num: 15 }, 7: { type: 'NUM', num: 14 }, 8: { type: 'NUM', num: 13 },\r\n}\r\n\r\nexport type TicTacToeState = {\r\n  board: Array<'X'|'O'|null>\r\n  turn: 'X'|'O'\r\n  finished: boolean\r\n  winner: 'X'|'O'|'Draw'|null\r\n}\r\n\r\nexport function createTicTacToe(): TicTacToeState {\r\n  return { board: Array(9).fill(null), turn: 'X', finished: false, winner: null }\r\n}\r\n\r\nfunction checkWin(board: Array<'X'|'O'|null>): 'X'|'O'|'Draw'|null {\r\n  const lines = [ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ]\r\n  for (const [a,b,c] of lines) { if (board[a] && board[a]===board[b] && board[a]===board[c]) return board[a] as 'X'|'O' }\r\n  if (board.every(c => c)) return 'Draw'\r\n  return null\r\n}\r\n\r\nexport function tryClaimCell(state: TicTacToeState, cell: TicCell, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null): boolean {\r\n  if (state.finished || state.board[cell]) return false\r\n  const tgt = TTT_TARGETS[cell]\r\n  let ok = false\r\n  if (tgt.type === 'BULL') ok = (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50)\r\n  else if (tgt.type === 'NUM' && typeof tgt.num === 'number') {\r\n    if (typeof sector === 'number' && sector === tgt.num) ok = true\r\n    else if (!sector && (value===tgt.num || value===tgt.num*2 || value===tgt.num*3)) ok = true\r\n  }\r\n  if (!ok) return false\r\n  state.board[cell] = state.turn\r\n  const w = checkWin(state.board)\r\n  if (w) { state.finished = true; state.winner = w; return true }\r\n  state.turn = state.turn === 'X' ? 'O' : 'X'\r\n  return true\r\n}\r\n","/**\r\n * Scam, Fives, and Sevens game logic\r\n * All three follow a similar score-race pattern:\r\n * - Players accumulate scores\r\n * - Only certain numbers count\r\n * - First to reach target wins\r\n */\r\n\r\n// SCAM/SCUM - Hit targets 1→20→Bull in sequence\r\nexport interface ScamState {\r\n  targetIndex: number // 0-20 for numbers 1-20, 21 for bull (25/50)\r\n  darts: number\r\n  finished: boolean\r\n}\r\n\r\nexport function createScamState(): ScamState {\r\n  return {\r\n    targetIndex: 0,\r\n    darts: 0,\r\n    finished: false,\r\n  }\r\n}\r\n\r\nexport const SCAM_TARGETS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25]\r\nexport const SCAM_TARGET_NAMES = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', 'Bull']\r\n\r\nexport function getScamTarget(state: ScamState): number {\r\n  return SCAM_TARGETS[state.targetIndex]\r\n}\r\n\r\nexport function addScamAuto(state: ScamState, value: number, ring?: string): ScamState {\r\n  if (state.finished) return state\r\n\r\n  const target = getScamTarget(state)\r\n  const targetHit = (ring === 'SINGLE' && value === target) || (ring === 'DOUBLE' && value === target) || (ring === 'TRIPLE' && value === target) || (ring === 'INNER_BULL' && target === 25)\r\n\r\n  if (!targetHit) return state\r\n\r\n  // Hit! Move to next target\r\n  const newIndex = state.targetIndex + 1\r\n  const finished = newIndex >= SCAM_TARGETS.length\r\n\r\n  return {\r\n    targetIndex: newIndex,\r\n    darts: state.darts + 1,\r\n    finished,\r\n  }\r\n}\r\n\r\nexport function addScamNumeric(state: ScamState, value: number): ScamState {\r\n  // For manual input, assume single ring hit\r\n  return addScamAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetScam(): ScamState {\r\n  return createScamState()\r\n}\r\n\r\n// FIVES - Only multiples of 5 count (5,10,15,20,25,50)\r\nexport interface FivesState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 50\r\n}\r\n\r\nexport function createFivesState(target: number = 50): FivesState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const FIVES_VALID_NUMBERS = [5, 10, 15, 20, 25, 50]\r\n\r\nexport function isFivesValid(value: number): boolean {\r\n  return FIVES_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addFivesAuto(state: FivesState, value: number, ring?: string): FivesState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 5 count\r\n  if (!isFivesValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addFivesNumeric(state: FivesState, value: number): FivesState {\r\n  return addFivesAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetFives(target: number = 50): FivesState {\r\n  return createFivesState(target)\r\n}\r\n\r\n// SEVENS - Only multiples of 7 count (7,14,21)\r\nexport interface SevensState {\r\n  score: number\r\n  darts: number\r\n  finished: boolean\r\n  target: number // default 70\r\n}\r\n\r\nexport function createSevensState(target: number = 70): SevensState {\r\n  return {\r\n    score: 0,\r\n    darts: 0,\r\n    finished: false,\r\n    target,\r\n  }\r\n}\r\n\r\nexport const SEVENS_VALID_NUMBERS = [7, 14, 21]\r\n\r\nexport function isSevensValid(value: number): boolean {\r\n  return SEVENS_VALID_NUMBERS.includes(value)\r\n}\r\n\r\nexport function addSevensAuto(state: SevensState, value: number, ring?: string): SevensState {\r\n  if (state.finished) return state\r\n\r\n  // Only multiples of 7 count\r\n  if (!isSevensValid(value)) {\r\n    return { ...state, darts: state.darts + 1 }\r\n  }\r\n\r\n  const newScore = state.score + value\r\n  const finished = newScore >= state.target\r\n\r\n  return {\r\n    score: finished ? state.target : newScore,\r\n    darts: state.darts + 1,\r\n    finished,\r\n    target: state.target,\r\n  }\r\n}\r\n\r\nexport function addSevensNumeric(state: SevensState, value: number): SevensState {\r\n  return addSevensAuto(state, value, 'SINGLE')\r\n}\r\n\r\nexport function resetSevens(target: number = 70): SevensState {\r\n  return createSevensState(target)\r\n}\r\n","export type AmCricketMark = 0 | 1 | 2 | 3\r\nexport type AmCricketNumber = 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 25\r\n\r\nexport type AmCricketState = {\r\n  marks: Record<AmCricketNumber, AmCricketMark>\r\n  points: number\r\n}\r\n\r\nexport const AM_CRICKET_NUMBERS: AmCricketNumber[] = [20, 19, 18, 17, 16, 15, 14, 13, 12, 25]\r\n\r\nexport function createAmCricketState(): AmCricketState {\r\n  const marks: any = {}\r\n  AM_CRICKET_NUMBERS.forEach(n => { marks[n] = 0 })\r\n  return { marks, points: 0 }\r\n}\r\n\r\nexport function applyAmCricketDart(state: AmCricketState, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null, opponentClosed: (n: AmCricketNumber) => boolean = () => false): number {\r\n  let num: AmCricketNumber | null = null\r\n  let hits = 0\r\n  if (ring === 'BULL' || ring === 'INNER_BULL' || value === 25 || value === 50) {\r\n    num = 25\r\n    hits = (ring === 'INNER_BULL' || value === 50) ? 2 : 1\r\n  } else if (typeof sector === 'number' && sector >= 12 && sector <= 20) {\r\n    num = sector as AmCricketNumber\r\n    if (ring === 'TRIPLE') hits = 3\r\n    else if (ring === 'DOUBLE') hits = 2\r\n    else hits = 1\r\n  } else if (value) {\r\n    for (const c of [20,19,18,17,16,15,14,13,12] as AmCricketNumber[]) {\r\n      if (value === c) { num = c; hits = 1; break }\r\n      if (value === c*2) { num = c; hits = 2; break }\r\n      if (value === c*3) { num = c; hits = 3; break }\r\n    }\r\n    if (!num && (value === 25 || value === 50)) { num = 25; hits = (value === 50) ? 2 : 1 }\r\n  }\r\n  if (!num) return 0\r\n\r\n  const before = state.marks[num]\r\n  const toClose = Math.max(0, 3 - before)\r\n  const toApply = Math.min(toClose, hits)\r\n  const overflow = Math.max(0, hits - toApply)\r\n  const after = (before + toApply) as AmCricketMark\r\n  state.marks[num] = after > 3 ? 3 : after\r\n\r\n  let points = 0\r\n  if (overflow > 0 && !opponentClosed(num)) {\r\n    if (num === 25) {\r\n      if (ring === 'INNER_BULL') points += 50 * overflow\r\n      else points += 25 * overflow\r\n    } else {\r\n      points += (num as number) * overflow\r\n    }\r\n  }\r\n  state.points += points\r\n  return points\r\n}\r\n\r\nexport function hasClosedAllAm(state: AmCricketState): boolean {\r\n  return AM_CRICKET_NUMBERS.every(n => (state.marks[n] || 0) >= 3)\r\n}\r\n","import type { ReactNode } from 'react'\r\n\r\n// Glassy sticky header bar used across Offline and Online match UIs for visual parity\r\nexport default function GameHeaderBar({\r\n  left,\r\n  right,\r\n  className = '',\r\n  sticky = true,\r\n}: {\r\n  left: ReactNode\r\n  right?: ReactNode\r\n  className?: string\r\n  sticky?: boolean\r\n}) {\r\n  return (\r\n    <div className={`${sticky ? 'sticky top-0' : ''} relative overflow-hidden flex items-center justify-between gap-2 mb-2 px-2 sm:px-3 py-2 rounded-xl bg-white/10 border border-white/10 z-10 backdrop-blur-sm ${className}`}>\r\n      <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-b from-slate-900/30 via-slate-900/10 to-transparent\" />\r\n      <div className=\"flex items-center gap-2 text-xs sm:text-sm leading-none flex-wrap\">\r\n        {left}\r\n      </div>\r\n      <div className=\"flex items-center gap-1 flex-wrap justify-end\">\r\n        {right}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","/**\r\n * Universal Game Scoreboard Component\r\n * Displays game-specific stats based on the game mode and current game state\r\n * Works for Online, Offline, and Tournament modes\r\n */\r\n\r\nimport React from 'react';\r\n\r\nexport type GameMode = 'X01' | 'Cricket' | 'Shanghai' | 'Killer' | 'High-Low' | 'Halve It' | \r\n                       'Around the Clock' | 'Double Practice' | 'Treble Practice' | \r\n                       'Count-Up' | 'High Score' | 'Low Score' | 'Checkout 170' | 'Checkout 121' |\r\n                       'American Cricket' | 'Baseball' | 'Golf' | 'Tic Tac Toe' | \"Bob's 27\" |\r\n                       'Scam' | 'Fives' | 'Sevens';\r\n\r\nexport interface PlayerStats {\r\n  name: string;\r\n  isCurrentTurn: boolean;\r\n  legsWon?: number;\r\n  score?: number;\r\n  lastScore?: number;\r\n  checkoutRate?: number; // 0-100\r\n  bestLeg?: number | string;\r\n  // Cricket-specific\r\n  closed?: Record<number, number>; // { 20: 3, 19: 2, etc }\r\n  points?: number;\r\n  // Shanghai-specific\r\n  round?: number;\r\n  target?: number;\r\n  // Killer-specific\r\n  number?: number;\r\n  lives?: number;\r\n  eliminated?: boolean;\r\n  // Match statistics\r\n  matchAvg?: number; // Current match 3-dart average\r\n  allTimeAvg?: number; // Player's all-time 3-dart average\r\n  // Other generics\r\n  [key: string]: any;\r\n}\r\n\r\ninterface GameScoreboardProps {\r\n  gameMode: GameMode;\r\n  players: PlayerStats[];\r\n  matchScore?: string; // e.g., \"3-1\"\r\n  gameRules?: any; // Additional rules/config for the game\r\n}\r\n\r\nexport default function GameScoreboard({ gameMode, players, matchScore, gameRules }: GameScoreboardProps) {\r\n  if (!players || players.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3\">\r\n      {players.map((player, idx) => (\r\n        <div\r\n          key={idx}\r\n          className={`rounded-lg border p-3 ${\r\n            player.isCurrentTurn\r\n              ? 'border-emerald-500/40 bg-emerald-500/10'\r\n              : 'border-slate-500/40 bg-slate-500/10'\r\n          }`}\r\n        >\r\n          <div className={`text-xs font-semibold mb-2 uppercase tracking-wide ${\r\n            player.isCurrentTurn ? 'text-emerald-300' : 'text-slate-300'\r\n          }`}>\r\n            {player.name}\r\n          </div>\r\n\r\n          <div className=\"space-y-1 text-xs\">\r\n            {/* X01 specific */}\r\n            {gameMode === 'X01' && (\r\n              <>\r\n                <ScoreRow label=\"Legs Won\" value={`● ${player.legsWon || 0}`} highlight />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                <ScoreRow label=\"Last Score\" value={player.lastScore || '0'} mono />\r\n                <ScoreRow label=\"C/Out Rate\" value={`${player.checkoutRate || 0}%`} mono />\r\n                <ScoreRow label=\"Best Leg\" value={player.bestLeg || '—'} mono />\r\n                {/* AVG +/- feature */}\r\n                {player.matchAvg !== undefined && player.allTimeAvg !== undefined && (\r\n                  <>\r\n                    <div className=\"border-t border-white/20 pt-1 mt-1\">\r\n                      <ScoreRow label=\"Match Avg\" value={player.matchAvg.toFixed(2)} mono bold highlight={player.matchAvg > 0} />\r\n                      <AvgDifferenceRow matchAvg={player.matchAvg} allTimeAvg={player.allTimeAvg} />\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Cricket & American Cricket specific */}\r\n            {(gameMode === 'Cricket' || gameMode === 'American Cricket') && (\r\n              <>\r\n                <ScoreRow label=\"Closed\" value={formatCricketClosed(player.closed)} mono />\r\n                <ScoreRow label=\"Points\" value={player.points || 0} mono bold />\r\n                <ScoreRow label=\"Status\" value={getCricketStatus(player)} highlight={player.isCurrentTurn} />\r\n              </>\r\n            )}\r\n\r\n            {/* Shanghai & Halve It - Round-based */}\r\n            {(gameMode === 'Shanghai' || gameMode === 'Halve It') && (\r\n              <>\r\n                <ScoreRow label={gameMode === 'Shanghai' ? 'Round' : 'Stage'} value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || '—'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Killer specific */}\r\n            {gameMode === 'Killer' && (\r\n              <>\r\n                <ScoreRow label=\"Target #\" value={player.number || '—'} mono bold />\r\n                <ScoreRow label=\"Lives\" value={player.lives || 0} mono bold />\r\n                {player.eliminated && (\r\n                  <ScoreRow label=\"Status\" value=\"ELIMINATED\" highlight={false} />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* High-Low specific */}\r\n            {gameMode === 'High-Low' && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Target\" value={player.target || 'High'} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Practice games */}\r\n            {(gameMode === 'Double Practice' || gameMode === 'Treble Practice' || gameMode === 'Around the Clock') && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={player.target || '—'} mono bold />\r\n                <ScoreRow label=\"Hits\" value={player.hits || 0} mono bold />\r\n                {player.totalNeeded && (\r\n                  <ScoreRow label=\"Progress\" value={`${player.hits || 0} / ${player.totalNeeded}`} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Count-Up, High Score, Low Score */}\r\n            {(gameMode === 'Count-Up' || gameMode === 'High Score' || gameMode === 'Low Score') && (\r\n              <>\r\n                <ScoreRow label=\"Round\" value={player.round || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n                {gameMode === 'High Score' && (\r\n                  <ScoreRow label=\"Best\" value={player.bestScore || 0} mono />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Checkout challenges */}\r\n            {(gameMode === 'Checkout 170' || gameMode === 'Checkout 121') && (\r\n              <>\r\n                <ScoreRow label=\"Remaining\" value={player.remaining || 0} mono bold />\r\n                <ScoreRow label=\"Attempts\" value={player.attempts || 0} mono />\r\n                <ScoreRow label=\"Successes\" value={player.successes || 0} mono />\r\n              </>\r\n            )}\r\n\r\n            {/* Bob's 27 */}\r\n            {gameMode === \"Bob's 27\" && (\r\n              <>\r\n                <ScoreRow label=\"Target\" value={`D${player.target || 1}`} mono bold />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Baseball & Golf */}\r\n            {gameMode === 'Baseball' && (\r\n              <>\r\n                <ScoreRow label=\"Inning\" value={player.inning || 1} mono />\r\n                <ScoreRow label=\"Score\" value={player.score || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {gameMode === 'Golf' && (\r\n              <>\r\n                <ScoreRow label=\"Hole\" value={player.hole || 1} mono />\r\n                <ScoreRow label=\"Strokes\" value={player.strokes || 0} mono bold />\r\n              </>\r\n            )}\r\n\r\n            {/* Tic Tac Toe */}\r\n            {gameMode === 'Tic Tac Toe' && (\r\n              <>\r\n                <ScoreRow label=\"Turn\" value={player.turn || 1} mono />\r\n                {player.winner && (\r\n                  <ScoreRow label=\"Result\" value=\"WINNER!\" highlight />\r\n                )}\r\n              </>\r\n            )}\r\n\r\n            {/* Match score display for competitive games */}\r\n            {matchScore && (gameMode === 'X01' || gameMode === 'Cricket' || gameMode === 'American Cricket') && idx === 1 && (\r\n              <div className=\"border-t border-white/10 pt-1 mt-1\">\r\n                <ScoreRow label=\"Match\" value={matchScore} mono bold highlight />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper component for consistent score row display\r\nfunction ScoreRow({ \r\n  label, \r\n  value, \r\n  mono = false, \r\n  bold = false, \r\n  highlight = false \r\n}: { \r\n  label: string; \r\n  value: string | number; \r\n  mono?: boolean;\r\n  bold?: boolean;\r\n  highlight?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">{label}:</span>\r\n      <span className={`${mono ? 'font-mono' : ''} ${bold ? 'font-semibold' : ''} ${\r\n        highlight ? 'text-emerald-300' : ''\r\n      }`}>\r\n        {value}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// AVG +/- component showing difference from all-time average\r\nfunction AvgDifferenceRow({ matchAvg, allTimeAvg }: { matchAvg: number; allTimeAvg: number }) {\r\n  const diff = matchAvg - allTimeAvg;\r\n  const isPositive = diff > 0;\r\n  const isNeutral = Math.abs(diff) < 0.01;\r\n  \r\n  let diffText = '';\r\n  let diffColor = 'text-slate-300';\r\n  \r\n  if (isNeutral) {\r\n    diffText = '= All-time';\r\n    diffColor = 'text-slate-300';\r\n  } else if (isPositive) {\r\n    diffText = `+${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-emerald-400';\r\n  } else {\r\n    diffText = `${diff.toFixed(2)} vs avg`;\r\n    diffColor = 'text-orange-400';\r\n  }\r\n  \r\n  return (\r\n    <div className=\"flex justify-between\">\r\n      <span className=\"opacity-70\">AVG vs Avg:</span>\r\n      <span className={`font-mono font-semibold ${diffColor}`}>\r\n        {diffText}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Cricket helpers\r\nfunction formatCricketClosed(closed?: Record<number, number>): string {\r\n  if (!closed || Object.keys(closed).length === 0) return '—';\r\n  const closedNumbers = Object.entries(closed)\r\n    .filter(([_, count]) => count === 3)\r\n    .map(([num]) => num === '25' ? 'B' : num)\r\n    .join(',');\r\n  return closedNumbers || '—';\r\n}\r\n\r\nfunction getCricketStatus(player: PlayerStats): string {\r\n  if (!player.closed) return 'Starting';\r\n  const closedCount = Object.values(player.closed).filter(c => c === 3).length;\r\n  if (closedCount === 0) return 'No marks';\r\n  if (closedCount < 7) return `${closedCount}/7`;\r\n  return 'Closing in';\r\n}\r\n","/**\r\n * Hook to convert OfflinePlay game state to GameScoreboard format\r\n */\r\n\r\nimport { useMemo } from 'react';\r\nimport type { PlayerStats } from './GameScoreboard';\r\nimport type { GameMode } from './GameScoreboard';\r\nimport { getAllTimeAvg } from '../../store/profileStats';\r\n\r\nexport function useOfflineGameStats(\r\n  gameMode: GameMode,\r\n  // X01 state\r\n  playerScore?: number,\r\n  aiScore?: number,\r\n  playerLegs?: number,\r\n  aiLegs?: number,\r\n  playerLastDart?: number,\r\n  aiLastDart?: number,\r\n  playerVisitSum?: number,\r\n  aiVisitSum?: number,\r\n  playerDoublesHit?: number,\r\n  playerDoublesAtt?: number,\r\n  aiDoublesHit?: number,\r\n  aiDoublesAtt?: number,\r\n  legStats?: Array<any>,\r\n  isPlayerTurn?: boolean,\r\n  ai?: string,\r\n  x01Score?: number,\r\n  // Cricket state\r\n  cricket?: any,\r\n  // Shanghai state\r\n  shanghai?: any,\r\n  // Killer state\r\n  killerPlayers?: Array<any>,\r\n  killerStates?: Record<string, any>,\r\n  killerAssigned?: Record<string, number>,\r\n  killerTurnIdx?: number\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (gameMode === 'X01') {\r\n      // Calculate player match average\r\n      let playerMatchAvg = 0;\r\n      let playerDarts = 0;\r\n      let playerScored = 0;\r\n      if (legStats && legStats.length > 0) {\r\n        for (const leg of legStats) {\r\n          if (leg.dartsThrown && leg.totalScored) {\r\n            playerDarts += leg.dartsThrown;\r\n            playerScored += leg.totalScored;\r\n          }\r\n        }\r\n        if (playerDarts > 0) {\r\n          playerMatchAvg = (playerScored / playerDarts) * 3;\r\n        }\r\n      }\r\n\r\n      // Player card\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        legsWon: playerLegs || 0,\r\n        score: playerScore || 0,\r\n        lastScore: playerVisitSum || playerLastDart || 0,\r\n        checkoutRate: playerDoublesAtt && playerDoublesAtt > 0 \r\n          ? Math.round((playerDoublesHit || 0) / playerDoublesAtt * 100)\r\n          : 0,\r\n        bestLeg: legStats && legStats.length > 0 \r\n          ? `${Math.min(...legStats.map(l => l.doubleDarts + (l.checkoutDarts || 0))) || 0} darts`\r\n          : '—',\r\n        matchAvg: playerMatchAvg,\r\n        allTimeAvg: getAllTimeAvg('You') || 0\r\n      });\r\n\r\n      // AI card (if playing against AI)\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          legsWon: aiLegs || 0,\r\n          score: aiScore || 0,\r\n          lastScore: aiVisitSum || aiLastDart || 0,\r\n          checkoutRate: aiDoublesAtt && aiDoublesAtt > 0 \r\n            ? Math.round((aiDoublesHit || 0) / aiDoublesAtt * 100)\r\n            : 0,\r\n          bestLeg: '—'\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Cricket') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        closed: cricket?.marks || {},\r\n        points: cricket?.points || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          closed: {},\r\n          points: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Shanghai') {\r\n      players.push({\r\n        name: 'You',\r\n        isCurrentTurn: !!isPlayerTurn,\r\n        round: shanghai?.round || 1,\r\n        target: shanghai?.target || 1,\r\n        score: shanghai?.score || 0\r\n      });\r\n\r\n      if (ai && ai !== 'None') {\r\n        players.push({\r\n          name: `${ai} AI`,\r\n          isCurrentTurn: !isPlayerTurn,\r\n          round: shanghai?.round || 1,\r\n          target: shanghai?.target || 1,\r\n          score: 0\r\n        });\r\n      }\r\n    }\r\n\r\n    if (gameMode === 'Killer' && killerPlayers && killerPlayers.length > 0) {\r\n      killerPlayers.forEach((p, idx) => {\r\n        const state = killerStates?.[p.id];\r\n        players.push({\r\n          name: p.name,\r\n          isCurrentTurn: idx === killerTurnIdx,\r\n          number: killerAssigned?.[p.id],\r\n          lives: state?.lives || 0,\r\n          eliminated: state?.eliminated || false\r\n        });\r\n      });\r\n    }\r\n\r\n    return players;\r\n  }, [\r\n    gameMode,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n    playerVisitSum, aiVisitSum,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn, ai,\r\n    cricket,\r\n    shanghai,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  ]);\r\n}\r\n\r\nexport function useOnlineGameStats(\r\n  gameMode: GameMode,\r\n  matchState?: any, // From useMatch() store\r\n  participants?: string[]\r\n): PlayerStats[] {\r\n  return useMemo(() => {\r\n    const players: PlayerStats[] = [];\r\n\r\n    if (!matchState || !matchState.players || matchState.players.length === 0) {\r\n      return players;\r\n    }\r\n\r\n    matchState.players.forEach((player: any, idx: number) => {\r\n      const isCurrentTurn = idx === matchState.currentPlayerIdx;\r\n      \r\n      if (gameMode === 'X01') {\r\n        // Calculate match average for this player\r\n        let matchAvg = 0;\r\n        let totalDarts = 0;\r\n        let totalScored = 0;\r\n\r\n        if (player.legs && player.legs.length > 0) {\r\n          for (const leg of player.legs) {\r\n            if (leg.finished) {\r\n              const legDarts = leg.dartsThrown || 0;\r\n              const legScored = Math.max(0, leg.totalScoreStart - leg.totalScoreRemaining) || 0;\r\n              totalDarts += legDarts;\r\n              totalScored += legScored;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (totalDarts > 0) {\r\n          matchAvg = (totalScored / totalDarts) * 3;\r\n        }\r\n\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          legsWon: player.legsWon || 0,\r\n          score: player.score || 0,\r\n          lastScore: player.lastVisitScore || 0,\r\n          checkoutRate: player.doublesAttempted > 0 \r\n            ? Math.round((player.doublesHit / player.doublesAttempted) * 100)\r\n            : 0,\r\n          bestLeg: player.bestLegDarts ? `${player.bestLegDarts} darts` : '—',\r\n          matchAvg: matchAvg,\r\n          allTimeAvg: player.name ? getAllTimeAvg(player.name) : 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Cricket') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          closed: player.cricket?.marks || {},\r\n          points: player.cricket?.points || 0\r\n        });\r\n      }\r\n\r\n      if (gameMode === 'Killer') {\r\n        players.push({\r\n          name: player.name || `Player ${idx + 1}`,\r\n          isCurrentTurn,\r\n          number: player.killerNumber || null,\r\n          lives: player.killerLives || 3,\r\n          eliminated: player.killerEliminated || false\r\n        });\r\n      }\r\n    });\r\n\r\n    return players;\r\n  }, [gameMode, matchState, participants]);\r\n}\r\n","export const freeGames = ['X01', 'Double Practice'] as const\r\nexport const premiumGames = [\r\n\t'Around the Clock',\r\n\t'Cricket',\r\n\t'Halve It',\r\n\t'Shanghai',\r\n\t'High-Low',\r\n\t'Killer',\r\n\t\"Bob's 27\",\r\n\t'Count-Up',\r\n\t'High Score',\r\n\t'Low Score',\r\n\t'Checkout 170',\r\n\t'Checkout 121',\r\n\t'Treble Practice',\r\n\t'Baseball',\r\n\t'Golf',\r\n\t'Tic Tac Toe',\r\n\t'American Cricket',\r\n\t'Scam',\r\n\t'Fives',\r\n\t'Sevens',\r\n] as const\r\nexport type GameKey = typeof freeGames[number] | typeof premiumGames[number]\r\nexport const allGames: GameKey[] = [...freeGames, ...premiumGames]\r\n","\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { useToast } from '../store/toast';\r\nimport { useCalibration } from '../store/calibration';\r\nimport GameCalibrationStatus from './GameCalibrationStatus';\r\nimport CameraTile from './CameraTile'\r\nimport CameraView from './CameraView'\r\nimport HeatMap from './HeatMap'\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config';\r\nimport { bumpGameMode } from '../store/profileStats'\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart } from '../game/types'\r\nimport { ATC_ORDER } from '../game/aroundTheClock'\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll } from '../game/cricket'\r\nimport { createShanghaiState, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai'\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt'\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow'\r\nimport { createKillerState, assignKillerNumbers, applyKillerDart, killerWinner, KillerState } from '../game/killer'\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball'\r\nimport { createGolf, applyGolfDart } from '../game/golf'\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe'\r\nimport { createScamState, addScamAuto, addScamNumeric, resetScam, getScamTarget, SCAM_TARGET_NAMES, ScamState, createFivesState, addFivesAuto, addFivesNumeric, resetFives, FivesState, createSevensState, addSevensAuto, addSevensNumeric, resetSevens, SevensState } from '../game/scamFivesSevens'\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS, hasClosedAllAm } from '../game/americanCricket'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport { useAudit } from '../store/audit'\r\nimport ResizablePanel from './ui/ResizablePanel'\r\nimport GameHeaderBar from './ui/GameHeaderBar'\r\nimport GameScoreboard from './scoreboards/GameScoreboard'\r\nimport { useOfflineGameStats } from './scoreboards/useGameStats'\r\nimport { freeGames, premiumGames, allGames } from '../utils/games'\r\n\r\nconst aiLevels = ['Easy', 'Medium', 'Hardened'];\r\n\r\nfunction clamp(n: number, min: number, max: number) {\r\n  return Math.max(min, Math.min(max, n))\r\n}\r\n\r\nfunction aiVisitScore(remaining: number, level: string): number {\r\n  // Very simple AI: target a plausible 3-dart total based on difficulty\r\n  // Then adjust down if it would overshoot remaining.\r\n  let target = 0\r\n  if (level === 'Easy') {\r\n    const candidates = [22, 26, 41, 45, 60]\r\n    target = candidates[Math.floor(Math.random() * candidates.length)]\r\n  } else if (level === 'Medium') {\r\n    // around 60 with some variance\r\n    target = Math.round(clamp(60 + (Math.random() * 30 - 15), 30, 100))\r\n  } else {\r\n    // Hardened: around 80 with tighter variance\r\n    target = Math.round(clamp(80 + (Math.random() * 20 - 10), 50, 120))\r\n  }\r\n  if (remaining <= 0) return 0\r\n  if (target > remaining) {\r\n    // Try to pick something that doesn't bust\r\n    const safe = [100, 85, 81, 60, 57, 45, 41, 26, 22, 20, 1].find(v => v <= remaining)\r\n    return safe ?? 0\r\n  }\r\n  return target\r\n}\r\n\r\nfunction X01RulesPopup({ onClose }: { onClose: () => void }) {\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n      <div className=\"card max-w-lg w-full relative\">\r\n        <button className=\"absolute top-2 right-2 btn px-2 py-1\" onClick={onClose}>Close</button>\r\n        <h3 className=\"text-xl font-bold mb-2\">X01 Rules & Regulations</h3>\r\n        <ul className=\"list-disc pl-5 text-left mb-2\">\r\n          <li>Double In: Start scoring only after hitting a double.</li>\r\n          <li>Double Out: Finish the game by hitting a double to reach exactly zero.</li>\r\n          <li>Best Of: Play a set number of legs, winner is first to reach majority.</li>\r\n          <li>First To: Play until a player reaches a set number of legs.</li>\r\n          <li>No Cheating: All scores must be valid, no manual score changes mid-leg.</li>\r\n          <li>Competitive Standard: Follow latest WDF/PDC rules for match play.</li>\r\n        </ul>\r\n        <p className=\"text-sm text-slate-600\">For full details, see official darts governing body rules.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\nexport default function OfflinePlay({ user }: { user: any }) {\r\n  const { offlineLayout } = useUserSettings()\r\n  const [selectedMode, setSelectedMode] = useState<string>('X01');\r\n  const [x01Score, setX01Score] = useState(501);\r\n  const [ai, setAI] = useState('None');\r\n  const [showRules, setShowRules] = useState(false);\r\n  const [inMatch, setInMatch] = useState(false);\r\n  const [playerScore, setPlayerScore] = useState(x01Score);\r\n  const [aiScore, setAiScore] = useState(x01Score);\r\n  const [onDouble, setOnDouble] = useState(false);\r\n  const [showWinPopup, setShowWinPopup] = useState(false);\r\n  // Match format: First-to selector and leg counters\r\n  const [firstTo, setFirstTo] = useState<number>(1)\r\n  const [playerLegs, setPlayerLegs] = useState<number>(0)\r\n  const [aiLegs, setAiLegs] = useState<number>(0)\r\n  const [pendingLegWinner, setPendingLegWinner] = useState<'player'|'ai'|null>(null)\r\n  const [doubleDarts, setDoubleDarts] = useState(1);\r\n  const [checkoutDarts, setCheckoutDarts] = useState(1);\r\n  const [legStats, setLegStats] = useState<{ winner: 'player'|'ai'; doubleDarts: number; checkoutDarts: number; winnerDarts: number; doublesAtt?: number; doublesHit?: number }[]>([]);\r\n  // New: pre-game adjustable AI delay (ms)\r\n  const [aiDelayMs, setAiDelayMs] = useState<number>(2000)\r\n  const toast = useToast();\r\n  // New: match popup state\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  // Mirror Online layout defaults when in modern layout, otherwise keep classic feel\r\n  const [maximized, setMaximized] = useState(offlineLayout === 'modern')\r\n  const [fitAll, setFitAll] = useState(offlineLayout === 'modern')\r\n  // React to layout changes at runtime\r\n  useEffect(() => {\r\n    setMaximized(offlineLayout === 'modern')\r\n    setFitAll(offlineLayout === 'modern')\r\n  }, [offlineLayout])\r\n  const [fitScale, setFitScale] = useState(1)\r\n  const [isPlayerTurn, setIsPlayerTurn] = useState(true)\r\n  // Per-dart input and stats\r\n  const [playerDartPoints, setPlayerDartPoints] = useState<number>(0)\r\n  const [dpIndex, setDpIndex] = useState<number>(0) // 0..20 (DBULL at 20)\r\n  const [dpHits, setDpHits] = useState<number>(0)\r\n  // Around the Clock (offline practice)\r\n  const [atcIndex, setAtcIndex] = useState<number>(0)\r\n  const [atcHits, setAtcHits] = useState<number>(0)\r\n  // Practice mode states\r\n  const [cricket, setCricket] = useState(createCricketState())\r\n  const [shanghai, setShanghai] = useState(createShanghaiState())\r\n  const [halve, setHalve] = useState(createDefaultHalveIt())\r\n  const [highlow, setHighlow] = useState(createHighLow())\r\n  const [practiceTurnDarts, setPracticeTurnDarts] = useState<number>(0)\r\n  // Phase 1 practice modes\r\n  const [b27Stage, setB27Stage] = useState<number>(1)\r\n  const [b27Score, setB27Score] = useState<number>(27)\r\n  const [b27Darts, setB27Darts] = useState<number>(0)\r\n  const [b27Hits, setB27Hits] = useState<number>(0)\r\n  const [b27Finished, setB27Finished] = useState<boolean>(false)\r\n  const [cuRound, setCuRound] = useState<number>(1)\r\n  const [cuScore, setCuScore] = useState<number>(0)\r\n  const [cuDarts, setCuDarts] = useState<number>(0)\r\n  const cuMaxRounds = 8\r\n  const [hsRound, setHsRound] = useState<number>(1)\r\n  const [hsScore, setHsScore] = useState<number>(0)\r\n  const [hsDarts, setHsDarts] = useState<number>(0)\r\n  const hsMaxRounds = 10\r\n  const [lsRound, setLsRound] = useState<number>(1)\r\n  const [lsScore, setLsScore] = useState<number>(0)\r\n  const [lsDarts, setLsDarts] = useState<number>(0)\r\n  const lsMaxRounds = 10\r\n  const [co170Rem, setCo170Rem] = useState<number>(170)\r\n  const [co170Darts, setCo170Darts] = useState<number>(0)\r\n  const [co170Attempts, setCo170Attempts] = useState<number>(0)\r\n  const [co170Successes, setCo170Successes] = useState<number>(0)\r\n  const [co121Rem, setCo121Rem] = useState<number>(121)\r\n  const [co121Darts, setCo121Darts] = useState<number>(0)\r\n  const [co121Attempts, setCo121Attempts] = useState<number>(0)\r\n  const [co121Successes, setCo121Successes] = useState<number>(0)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30)\r\n  const [trebleFinished, setTrebleFinished] = useState<boolean>(false)\r\n  // Phase 2 states\r\n  const [baseball, setBaseball] = useState(createBaseball())\r\n  const [golf, setGolf] = useState(createGolf())\r\n  const [ttt, setTTT] = useState(createTicTacToe())\r\n  const [amCricket, setAmCricket] = useState(createAmCricketState())\r\n  // Killer (hotseat) state\r\n  const [killerPlayers, setKillerPlayers] = useState<Array<{ id: string; name: string }>>([\r\n    { id: 'p1', name: 'Player 1' },\r\n    { id: 'p2', name: 'Player 2' },\r\n  ])\r\n  const [killerStates, setKillerStates] = useState<Record<string, KillerState>>({})\r\n  const [killerAssigned, setKillerAssigned] = useState<Record<string, number>>({})\r\n  const [killerSetupDone, setKillerSetupDone] = useState<boolean>(false)\r\n  const [killerTurnIdx, setKillerTurnIdx] = useState<number>(0)\r\n  const [killerDarts, setKillerDarts] = useState<number>(0)\r\n  const [killerWinnerId, setKillerWinnerId] = useState<string | null>(null)\r\n  const [killerLastEvent, setKillerLastEvent] = useState<string>('')\r\n  // Scam/Scum state\r\n  const [scam, setScam] = useState(createScamState())\r\n  const [scamPlayer, setScamPlayer] = useState(createScamState())\r\n  // Fives state\r\n  const [fives, setFives] = useState(createFivesState(50))\r\n  const [fivesPlayer, setFivesPlayer] = useState(createFivesState(50))\r\n  // Sevens state\r\n  const [sevens, setSevens] = useState(createSevensState(70))\r\n  const [sevensPlayer, setSevensPlayer] = useState(createSevensState(70))\r\n  const [playerDartsThrown, setPlayerDartsThrown] = useState<number>(0)\r\n  const [playerLastDart, setPlayerLastDart] = useState<number>(0)\r\n  const [playerVisitDarts, setPlayerVisitDarts] = useState<number>(0)\r\n  const [playerVisitStart, setPlayerVisitStart] = useState<number>(x01Score)\r\n  const [playerVisitSum, setPlayerVisitSum] = useState<number>(0)\r\n  const [playerVisitDartsAtDouble, setPlayerVisitDartsAtDouble] = useState<number>(0)\r\n  const [aiCountdownMs, setAiCountdownMs] = useState<number>(0)\r\n  const aiTimerRef = useRef<number | null>(null)\r\n  const [aiDartsThrown, setAiDartsThrown] = useState<number>(0)\r\n  const [aiLastDart, setAiLastDart] = useState<number>(0)\r\n  const [aiVisitSum, setAiVisitSum] = useState<number>(0)\r\n  const [aiVisitDartsAtDouble, setAiVisitDartsAtDouble] = useState<number>(0)\r\n  // Doubles attempts/hits\r\n  const [playerDoublesAtt, setPlayerDoublesAtt] = useState<number>(0)\r\n  const [playerDoublesHit, setPlayerDoublesHit] = useState<number>(0)\r\n  const [aiDoublesAtt, setAiDoublesAtt] = useState<number>(0)\r\n  const [aiDoublesHit, setAiDoublesHit] = useState<number>(0)\r\n  // Match-long totals for averages\r\n  const [totalPlayerDarts, setTotalPlayerDarts] = useState<number>(0)\r\n  const [totalAiDarts, setTotalAiDarts] = useState<number>(0)\r\n  const [totalPlayerPoints, setTotalPlayerPoints] = useState<number>(0)\r\n  const [totalAiPoints, setTotalAiPoints] = useState<number>(0)\r\n  // Power scoring and checkout highs\r\n  const [player180s, setPlayer180s] = useState<number>(0)\r\n  const [player140s, setPlayer140s] = useState<number>(0)\r\n  const [player100s, setPlayer100s] = useState<number>(0)\r\n  const [ai180s, setAi180s] = useState<number>(0)\r\n  const [ai140s, setAi140s] = useState<number>(0)\r\n  const [ai100s, setAi100s] = useState<number>(0)\r\n  const [playerHighestCheckout, setPlayerHighestCheckout] = useState<number>(0)\r\n  const [aiHighestCheckout, setAiHighestCheckout] = useState<number>(0)\r\n  // End-of-match summary modal\r\n  const [showMatchSummary, setShowMatchSummary] = useState<boolean>(false)\r\n  // Manual correction input for offline (matches CameraView UX)\r\n  const [manualBox, setManualBox] = useState<string>('')\r\n  const [manualTextarea, setManualTextarea] = useState<string>('')\r\n  // Settings: favourite double and caller\r\n  const { favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, rememberLastOffline, setLastOffline, autoStartOffline, cameraScale, setCameraScale, cameraAspect = 'wide', setCameraAspect, cameraFitMode = 'fill', setCameraFitMode, cameraEnabled, textSize, boxSize, autoscoreProvider, matchType = 'singles', setMatchType, teamAName = 'Team A', setTeamAName, teamBName = 'Team B', setTeamBName } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n\r\n  // Call all game stat hooks unconditionally at component level (React hooks rules)\r\n  const statsX01 = useOfflineGameStats(\r\n    'X01' as any,\r\n    playerScore, aiScore,\r\n    playerLegs, aiLegs,\r\n    playerLastDart, aiLastDart,\r\n    playerVisitSum, aiVisitSum,\r\n    playerDoublesHit, playerDoublesAtt,\r\n    aiDoublesHit, aiDoublesAtt,\r\n    legStats,\r\n    isPlayerTurn,\r\n    ai,\r\n    x01Score\r\n  )\r\n  const statsCricket = useOfflineGameStats(\r\n    'Cricket' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    cricket\r\n  )\r\n  const statsShanghai = useOfflineGameStats(\r\n    'Shanghai' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    isPlayerTurn, ai, undefined,\r\n    cricket, shanghai\r\n  )\r\n  const statsKiller = useOfflineGameStats(\r\n    'Killer' as any,\r\n    undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined,\r\n    undefined, undefined,\r\n    killerPlayers, killerStates, killerAssigned, killerTurnIdx\r\n  )\r\n  const statsScam = useOfflineGameStats('Scam' as any)\r\n  const statsFives = useOfflineGameStats('Fives' as any)\r\n  const statsSevens = useOfflineGameStats('Sevens' as any)\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Fit-all scaling measurement\r\n  const scrollerRef = useRef<HTMLDivElement | null>(null)\r\n  const contentRef = useRef<HTMLDivElement | null>(null)\r\n  const headerBarRef = useRef<HTMLDivElement | null>(null)\r\n  // Match format controls (offline only): First to N or Best of N with editable count\r\n  const [formatType, setFormatType] = useState<'first'|'best'>('first')\r\n  const [formatCount, setFormatCount] = useState<number>(1)\r\n  const formatRef = useRef<HTMLDivElement | null>(null)\r\n  // Keep internal required wins (firstTo) in sync with format selection\r\n  useEffect(() => {\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    const wins = formatType === 'first' ? n : Math.max(1, Math.ceil(n / 2))\r\n    setFirstTo(wins)\r\n  }, [formatType, formatCount])\r\n  useEffect(() => {\r\n    if (!fitAll) { setFitScale(1); return }\r\n    const measure = () => {\r\n      const scroller = scrollerRef.current\r\n      const content = contentRef.current\r\n      if (!scroller || !content) return\r\n      // Available size excludes the sticky header inside the scroller\r\n      const headerH = headerBarRef.current ? headerBarRef.current.getBoundingClientRect().height : 0\r\n      const availH = Math.max(0, scroller.clientHeight - headerH - 6) // small breathing room\r\n      const availW = Math.max(0, scroller.clientWidth - 8)\r\n      // Measure the content size without scale\r\n      const rect = content.getBoundingClientRect()\r\n      const currentScale = fitScale || 1\r\n      const naturalHeight = rect.height / currentScale\r\n      const naturalWidth = rect.width / currentScale\r\n      // Compute scale to fit both height and width\r\n      const scaleH = availH > 0 ? (availH / naturalHeight) : 1\r\n      const scaleW = availW > 0 ? (availW / naturalWidth) : 1\r\n      const next = Math.min(1, Math.max(0.5, Math.min(scaleH, scaleW)))\r\n      setFitScale(next)\r\n    }\r\n    measure()\r\n  const RO: any = (window as any).ResizeObserver\r\n  const ro = RO ? new RO(() => measure()) : null\r\n  ro && scrollerRef.current && ro.observe(scrollerRef.current as any)\r\n  ro && contentRef.current && ro.observe(contentRef.current as any)\r\n    window.addEventListener('resize', measure)\r\n    return () => {\r\n      window.removeEventListener('resize', measure)\r\n      try { ro && scrollerRef.current && ro.unobserve(scrollerRef.current as any) } catch {}\r\n      try { ro && contentRef.current && ro.unobserve(contentRef.current as any) } catch {}\r\n    }\r\n  }, [fitAll, fitScale])\r\n\r\n\r\n  // Auto-start handler (from Home or other tabs)\r\n  useEffect(() => {\r\n    const onAuto = (e: any) => {\r\n      const m = e?.detail?.mode as string | undefined\r\n      if (!m) return\r\n      setSelectedMode(m)\r\n      // For Double Practice we could load a specific flow. For now, we just open the X01-like modal with immediate start.\r\n      startMatch()\r\n    }\r\n    window.addEventListener('ndn:auto-start', onAuto as any)\r\n    return () => window.removeEventListener('ndn:auto-start', onAuto as any)\r\n  }, [])\r\n\r\n  // Accept demo parameters to preconfigure format and starting score before auto-start\r\n  useEffect(() => {\r\n    const onFmt = (e: any) => {\r\n      const t = e?.detail?.formatType\r\n      const c = e?.detail?.formatCount\r\n      const s = e?.detail?.startScore\r\n      if (t === 'first' || t === 'best') setFormatType(t)\r\n      if (typeof c === 'number' && isFinite(c)) setFormatCount(Math.max(1, Math.floor(c)))\r\n      if (typeof s === 'number' && isFinite(s)) setX01Score(Math.max(1, Math.floor(s)))\r\n    }\r\n    window.addEventListener('ndn:offline-format', onFmt as any)\r\n    return () => window.removeEventListener('ndn:offline-format', onFmt as any)\r\n  }, [])\r\n\r\n  // Auto-start last offline match when opening this tab, if enabled\r\n  useEffect(() => {\r\n    if (!autoStartOffline) return\r\n    // Kick off a match after initial render for a smooth modal open\r\n    const id = setTimeout(() => startMatch(), 50)\r\n    return () => clearTimeout(id)\r\n  }, [autoStartOffline])\r\n\r\n  // Drive AI countdown and perform AI visit when countdown elapses\r\n  useEffect(() => {\r\n    if (!showMatchModal || isPlayerTurn || ai === 'None' || aiCountdownMs <= 0) return\r\n    let raf: number\r\n    let last = performance.now()\r\n    const tick = (now: number) => {\r\n      const dt = now - last\r\n      last = now\r\n      setAiCountdownMs(prev => {\r\n        const next = prev - dt\r\n        if (next <= 0) {\r\n          // Execute AI visit per dart (up to 3 darts or until finish/bust)\r\n          let visitDarts = 0\r\n          let remaining = aiScore\r\n          while (visitDarts < 3 && remaining > 0) {\r\n            const targetVisit = aiVisitScore(remaining, ai)\r\n            // break target into up to 3 darts (roughly 20 per dart for easy split)\r\n            const dart = clamp(targetVisit - visitDarts*20, 0, Math.min(60, remaining))\r\n            const after = remaining - dart\r\n            setAiLastDart(dart)\r\n            setAiDartsThrown(d => d + 1)\r\n            setTotalAiDarts(d => d + 1)\r\n            if (after < 0) {\r\n              // bust: revert to remaining before visit\r\n              remaining = aiScore\r\n              setAiVisitSum(0)\r\n              setAiVisitDartsAtDouble(0)\r\n              break\r\n            }\r\n            // Only add points after confirming not a bust\r\n            setAiVisitSum(s => s + dart)\r\n            setTotalAiPoints(p => p + dart)\r\n            // Track darts at double window\r\n            const preRem = remaining\r\n            const postRem = after\r\n            if (preRem > 50 && postRem <= 50) setAiVisitDartsAtDouble(1)\r\n            else if (preRem <= 50) setAiVisitDartsAtDouble(c => c + 1)\r\n            remaining = after\r\n            visitDarts += 1\r\n            if (remaining === 0) break\r\n          }\r\n          setAiScore(remaining)\r\n          if (remaining === 0) {\r\n            // Power score classification\r\n            if (aiVisitSum === 180) setAi180s(n => n + 1)\r\n            else if (aiVisitSum >= 140) setAi140s(n => n + 1)\r\n            else if (aiVisitSum >= 100) setAi100s(n => n + 1)\r\n            // Highest checkout\r\n            const checkout = aiScore\r\n            if (checkout <= 170) setAiHighestCheckout(h => Math.max(h, checkout))\r\n            // Doubles attempts/hit if finished from <= 50\r\n            if (aiScore <= 50) {\r\n              setAiDoublesAtt(a => a + (aiVisitDartsAtDouble > 0 ? aiVisitDartsAtDouble : 1))\r\n              setAiDoublesHit(h => h + 1)\r\n            }\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n            // AI won the leg\r\n            setPendingLegWinner('ai')\r\n            setShowWinPopup(true)\r\n          }\r\n          // If AI did not finish, but threw 3 darts this visit, classify power score and reset visit sum\r\n          if (remaining > 0 && visitDarts >= 3) {\r\n            if (aiVisitSum === 180) setAi180s(n => n + 1)\r\n            else if (aiVisitSum >= 140) setAi140s(n => n + 1)\r\n            else if (aiVisitSum >= 100) setAi100s(n => n + 1)\r\n            setAiVisitSum(0)\r\n            setAiVisitDartsAtDouble(0)\r\n          }\r\n          // Hand turn back to player\r\n          setIsPlayerTurn(true)\r\n          return 0\r\n        }\r\n        return next\r\n      })\r\n      raf = requestAnimationFrame(tick)\r\n    }\r\n    raf = requestAnimationFrame(tick)\r\n    return () => cancelAnimationFrame(raf)\r\n  }, [showMatchModal, isPlayerTurn, ai, aiScore])\r\n\r\n  function startMatch() {\r\n    setInMatch(true);\r\n    setPlayerScore(x01Score);\r\n    setAiScore(x01Score);\r\n    setOnDouble(false);\r\n    setShowMatchModal(true);\r\n    setIsPlayerTurn(true);\r\n    setPlayerDartPoints(0);\r\n    setPlayerDartsThrown(0);\r\n    setPlayerLastDart(0);\r\n    setPlayerVisitDarts(0);\r\n    setPlayerVisitStart(x01Score);\r\n    setPlayerVisitSum(0)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0);\r\n    setAiDartsThrown(0);\r\n    setAiLastDart(0);\r\n    setAiVisitSum(0)\r\n    setPendingLegWinner(null)\r\n    // When starting a brand-new match from menu, reset legs\r\n  setPlayerLegs(0)\r\n  setAiLegs(0)\r\n    setLegStats([])\r\n  // Reset Treble Practice session state when starting a new match\r\n  setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false)\r\n    // Reset match-long totals\r\n    setTotalPlayerDarts(0); setTotalAiDarts(0)\r\n    setTotalPlayerPoints(0); setTotalAiPoints(0)\r\n    setPlayer180s(0); setPlayer140s(0); setPlayer100s(0)\r\n    setAi180s(0); setAi140s(0); setAi100s(0)\r\n    setPlayerHighestCheckout(0); setAiHighestCheckout(0)\r\n    setPlayerDoublesAtt(0); setPlayerDoublesHit(0)\r\n    setAiDoublesAtt(0); setAiDoublesHit(0)\r\n    // Sync required wins from current format selection\r\n    const n = Math.max(1, Math.floor(Number(formatCount) || 1))\r\n    setFirstTo(formatType === 'first' ? n : Math.max(1, Math.ceil(n/2)))\r\n    if (rememberLastOffline) {\r\n      try { setLastOffline({ mode: selectedMode, x01Start: x01Score, firstTo, aiLevel: ai }) } catch {}\r\n    }\r\n  }\r\n\r\n  function startNextLeg() {\r\n    setPlayerScore(x01Score)\r\n    setAiScore(x01Score)\r\n    setOnDouble(false)\r\n    setShowMatchModal(true)\r\n    setIsPlayerTurn(true)\r\n    setPlayerDartPoints(0)\r\n    setPlayerDartsThrown(0)\r\n    setPlayerLastDart(0)\r\n    setPlayerVisitDarts(0)\r\n    setPlayerVisitStart(x01Score)\r\n    setPlayerVisitSum(0)\r\n  setPlayerVisitDartsAtDouble(0)\r\n    setAiCountdownMs(0)\r\n    setAiDartsThrown(0)\r\n    setAiLastDart(0)\r\n    setAiVisitSum(0)\r\n    setPendingLegWinner(null)\r\n  }\r\n\r\n  // --- Offline per-dart helpers ---\r\n  function endTurn(nextRemaining: number) {\r\n    setPlayerVisitDarts(0)\r\n    setPlayerVisitStart(nextRemaining === 0 ? x01Score : playerScore)\r\n    setPlayerVisitDartsAtDouble(0)\r\n    if (ai !== 'None') { setIsPlayerTurn(false); setAiCountdownMs(aiDelayMs) } else setIsPlayerTurn(false)\r\n  }\r\n\r\n  function applyDartValue(dart: number) {\r\n    const remaining = playerScore - dart\r\n    const newVisitDarts = playerVisitDarts + 1\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n  if (remaining < 0) {\r\n      // bust: revert to visit start, end turn\r\n      try {\r\n        const preRemaining = playerScore\r\n        const postRemaining = playerVisitStart\r\n        useAudit.getState().recordVisit('offline-x01', newVisitDarts, 0, { preRemaining, postRemaining, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(playerVisitStart)\r\n      // Count doubles attempts made this visit if we were in the double window\r\n      const bustPreRemaining = playerScore\r\n      if (bustPreRemaining <= 50) {\r\n        // playerVisitDartsAtDouble has previous window darts; include this dart as an attempt too\r\n        const attemptsThisVisit = (playerVisitDartsAtDouble || 0) + 1\r\n        setPlayerDoublesAtt(a => a + attemptsThisVisit)\r\n      }\r\n      // Announce visit total on bust (0 for the visit)\r\n      if (callerEnabled) {\r\n        try { sayScore(user?.username || 'Player', 0, Math.max(playerVisitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      endTurn(playerVisitStart)\r\n      setPlayerDartPoints(0)\r\n      setPlayerVisitSum(0)\r\n      setPlayerVisitDartsAtDouble(0)\r\n      return\r\n    }\r\n    setPlayerScore(remaining)\r\n    // Do not announce per-dart; we announce once per visit when it ends or on checkout\r\n    setPlayerVisitDarts(newVisitDarts)\r\n    setPlayerVisitSum(s => s + dart)\r\n    setTotalPlayerPoints(p => p + dart)\r\n    setPlayerDartPoints(0)\r\n    // Start/continue counting darts at a double when remaining <= 50 and on a valid finish path\r\n    const preRemaining = playerScore\r\n    const postRemaining = remaining\r\n    const startedDoubleWindow = preRemaining > 50 && postRemaining <= 50\r\n    const stillInDoubleWindow = preRemaining <= 50\r\n    if (startedDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(1)\r\n    } else if (stillInDoubleWindow) {\r\n      setPlayerVisitDartsAtDouble(c => c + 1)\r\n    }\r\n    if (remaining === 0) {\r\n      // Player wins the leg\r\n      try {\r\n        const visitTotal = playerVisitSum + dart\r\n        const preRemaining = playerScore\r\n        useAudit.getState().recordVisit('offline-x01', newVisitDarts, visitTotal, { preRemaining, postRemaining: 0, finish: true, bust: false })\r\n      } catch {}\r\n      // Power score classification on final visit\r\n      if (playerVisitSum + dart === 180) setPlayer180s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 140) setPlayer140s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 100) setPlayer100s(n => n + 1)\r\n      // Highest checkout if <= 170\r\n      const checkout = playerVisitStart\r\n      if (checkout <= 170) setPlayerHighestCheckout(h => Math.max(h, checkout))\r\n      // Count doubles attempts in this visit and record a hit when finishing from <= 50\r\n      if (preRemaining <= 50) {\r\n        // Include this dart in attempts\r\n        const attemptsThisVisit = (playerVisitDartsAtDouble || 0) + 1\r\n        setPlayerDoublesAtt(a => a + attemptsThisVisit)\r\n        setPlayerDoublesHit(h => h + 1)\r\n      }\r\n      // Announce total of the visit on checkout\r\n      if (callerEnabled) {\r\n        const visitTotal = playerVisitSum + dart\r\n        try { sayScore(user?.username || 'Player', visitTotal, 0, callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n      return\r\n    }\r\n    if (newVisitDarts >= 3) {\r\n      // Classify power score for completed visit\r\n      try {\r\n        const visitTotal = playerVisitSum + dart\r\n        const preRemaining = playerScore\r\n        const postRemaining = remaining\r\n        useAudit.getState().recordVisit('offline-x01', newVisitDarts, visitTotal, { preRemaining, postRemaining, finish: false, bust: false })\r\n      } catch {}\r\n      if (playerVisitSum + dart === 180) setPlayer180s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 140) setPlayer140s(n => n + 1)\r\n      else if (playerVisitSum + dart >= 100) setPlayer100s(n => n + 1)\r\n      // Count doubles attempts on a non-finishing visit inside double window\r\n      if (preRemaining <= 50) {\r\n        const attemptsThisVisit = (playerVisitDartsAtDouble || 0) + 1\r\n        setPlayerDoublesAtt(a => a + attemptsThisVisit)\r\n      }\r\n      // Announce visit total after third dart\r\n      if (callerEnabled) {\r\n        const visitTotal = playerVisitSum + dart\r\n        try { sayScore(user?.username || 'Player', visitTotal, Math.max(remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      endTurn(remaining)\r\n      setPlayerVisitSum(0)\r\n      setPlayerVisitDartsAtDouble(0)\r\n    }\r\n  }\r\n\r\n  function addDartNumeric() {\r\n    const dart = clamp(Math.round(Number(playerDartPoints) || 0), 0, 60)\r\n    applyDartValue(dart)\r\n  }\r\n\r\n  // Optional: Add a full-visit total (0–180) input for quick entry like \"93\"\r\n  const [visitTotalInput, setVisitTotalInput] = useState<string>(\"\")\r\n  function addVisitTotal() {\r\n    const raw = Math.round(Number(visitTotalInput) || 0)\r\n    const total = clamp(raw, 0, 180)\r\n    if (total === 0 && raw !== 0) { alert('Enter a number 0–180 for visit total'); return }\r\n    const remaining = playerScore - total\r\n    // Track three darts for a full visit entry\r\n    setPlayerDartsThrown(d => d + 3)\r\n    setTotalPlayerDarts(d => d + 3)\r\n    setPlayerVisitDarts(3)\r\n    setPlayerVisitSum(total)\r\n    // Power score classification\r\n    if (total === 180) setPlayer180s(n => n + 1)\r\n    else if (total >= 140) setPlayer140s(n => n + 1)\r\n    else if (total >= 100) setPlayer100s(n => n + 1)\r\n    // Handle bust\r\n    if (remaining < 0) {\r\n      // bust: revert to visit start and end turn\r\n      if (callerEnabled) {\r\n        try { sayScore(user?.username || 'Player', 0, Math.max(playerVisitStart, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n      }\r\n      try {\r\n        const preRemaining = playerScore\r\n        const postRemaining = playerVisitStart\r\n        useAudit.getState().recordVisit('offline-x01', 3, 0, { preRemaining, postRemaining, bust: true, finish: false })\r\n      } catch {}\r\n      setPlayerScore(playerVisitStart)\r\n      endTurn(playerVisitStart)\r\n      setPlayerVisitSum(0)\r\n      setPlayerVisitDarts(0)\r\n      setPlayerVisitDartsAtDouble(0)\r\n      setVisitTotalInput(\"\")\r\n      return\r\n    }\r\n    // Normal reduce\r\n    setPlayerScore(remaining)\r\n    // Announce visit\r\n    if (callerEnabled) {\r\n      try { sayScore(user?.username || 'Player', total, Math.max(remaining, 0), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly }) } catch {}\r\n    }\r\n    // Doubles attempts/hit from visit total if we were in checkout range at visit start\r\n    if (playerVisitStart <= 50) {\r\n      setPlayerDoublesAtt(a => a + 3)\r\n      if (remaining === 0) setPlayerDoublesHit(h => h + 1)\r\n    }\r\n    // Checkout if exactly zero\r\n    if (remaining === 0) {\r\n      const checkout = playerVisitStart\r\n      if (checkout <= 170) setPlayerHighestCheckout(h => Math.max(h, checkout))\r\n      try {\r\n        const preRemaining = playerScore\r\n        useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining: 0, finish: true, bust: false })\r\n      } catch {}\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n      setVisitTotalInput(\"\")\r\n      return\r\n    }\r\n    // Otherwise end turn\r\n    try {\r\n      const preRemaining = playerScore\r\n      const postRemaining = remaining\r\n      useAudit.getState().recordVisit('offline-x01', 3, total, { preRemaining, postRemaining, finish: false, bust: false })\r\n    } catch {}\r\n    endTurn(remaining)\r\n    setPlayerVisitSum(0)\r\n    setPlayerVisitDarts(0)\r\n    setPlayerVisitDartsAtDouble(0)\r\n    setVisitTotalInput(\"\")\r\n  }\r\n\r\n  // --- Double Practice helpers ---\r\n  function addDpValue(val: number) {\r\n    const dart = clamp(Math.round(val || 0), 0, 60)\r\n    setPlayerLastDart(dart)\r\n    setPlayerDartsThrown(d => d + 1)\r\n    setTotalPlayerDarts(d => d + 1)\r\n    if (isDoubleHit(dart, dpIndex)) {\r\n      const nextHits = dpHits + 1\r\n      setDpHits(nextHits)\r\n      setDpIndex(i => Math.min(20, i + 1))\r\n      // End when DBULL (index 20) is hit\r\n      if (nextHits >= 21) {\r\n        setPendingLegWinner('player')\r\n        setShowWinPopup(true)\r\n      }\r\n    }\r\n    setPlayerDartPoints(0)\r\n  }\r\n  function addDpNumeric() { addDpValue(Number(playerDartPoints)) }\r\n  function addDpManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like D16, 50, 25, T20'); return }\r\n    addDpValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // Bob's 27\r\n  function addB27Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (b27Finished) return\r\n    const target = b27Stage\r\n    const hit = (ring === 'DOUBLE' && sector === target) || (!ring && value === target*2)\r\n    if (hit) setB27Hits(h => h + 1)\r\n    setB27Darts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        const totalHits = b27Hits + (hit?1:0)\r\n        if (totalHits > 0) setB27Score(s => s + totalHits * target * 2)\r\n        else setB27Score(s => s - target * 2)\r\n        const next = target + 1\r\n        setB27Stage(next)\r\n        setB27Hits(0)\r\n        if (next > 20) setB27Finished(true)\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addB27Numeric() { addB27Auto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function resetB27() { setB27Stage(1); setB27Score(27); setB27Darts(0); setB27Hits(0); setB27Finished(false) }\r\n\r\n  // Count-Up / High Score / Low Score\r\n  function addCountUpAuto(value: number) { setCuScore(s => s + Math.max(0, value|0)); setCuDarts(d => { const nd=d+1; if(nd>=3){ setCuRound(r=>r+1); return 0 } return nd }) }\r\n  function addHighScoreAuto(value: number) { setHsScore(s => s + Math.max(0, value|0)); setHsDarts(d => { const nd=d+1; if(nd>=3){ setHsRound(r=>r+1); return 0 } return nd }) }\r\n  function addLowScoreAuto(value: number) { setLsScore(s => s + Math.max(0, value|0)); setLsDarts(d => { const nd=d+1; if(nd>=3){ setLsRound(r=>r+1); return 0 } return nd }) }\r\n\r\n  // Checkout routines (double out)\r\n  function applyCheckout(rem: number, setRem: (n:number)=>void, darts: number, setDarts: (f:(n:number)=>number)=>void, setAttempts: (f:(n:number)=>number)=>void, setSuccesses: (f:(n:number)=>number)=>void, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') {\r\n    const next = rem - value\r\n    if (next < 0) {\r\n      // bust: ignore progress during attempt\r\n    } else if (next === 0) {\r\n      if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n        setSuccesses(s => s + 1)\r\n        setAttempts(a => a + 1)\r\n        setDarts(()=>0)\r\n        setRem(rem) // caller will reset to initial value right after\r\n        return\r\n      }\r\n    } else {\r\n      setRem(next)\r\n    }\r\n    setDarts(d => { const nd = d + 1; if (nd>=3) { setAttempts(a=>a+1); return 0 } return nd })\r\n  }\r\n  function addCo170Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') { applyCheckout(co170Rem, setCo170Rem, co170Darts, setCo170Darts, setCo170Attempts, setCo170Successes, value, ring); if (co170Darts+1>=3) setCo170Rem(170) }\r\n  function addCo121Auto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL') { applyCheckout(co121Rem, setCo121Rem, co121Darts, setCo121Darts, setCo121Attempts, setCo121Successes, value, ring); if (co121Darts+1>=3) setCo121Rem(121) }\r\n  function addCoManual(is170: boolean) {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D16, 25, 50'); return }\r\n    const t = manualBox.trim().toUpperCase()\r\n    const isDouble = t.startsWith('D') || t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL' || t.includes('INNER')\r\n    if (is170) addCo170Auto(v, isDouble?'DOUBLE':undefined); else addCo121Auto(v, isDouble?'DOUBLE':undefined)\r\n    setManualBox('')\r\n  }\r\n  function resetCo170() { setCo170Rem(170); setCo170Darts(0); setCo170Attempts(0); setCo170Successes(0) }\r\n  function resetCo121() { setCo121Rem(121); setCo121Darts(0); setCo121Attempts(0); setCo121Successes(0) }\r\n\r\n  // Treble practice\r\n  function addTrebleAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (trebleFinished) return\r\n    const isHit = (ring==='TRIPLE' && sector===trebleTarget) || (!ring && value===trebleTarget*3)\r\n    if (isHit) setTrebleHits(h=>h+1)\r\n    setTrebleDarts(d => {\r\n      const nd = d + 1\r\n      // Auto-rotate target every 3 darts among T20→T19→T18\r\n      if (nd % 3 === 0 && [20,19,18].includes(trebleTarget)) {\r\n        const cycle = [20, 19, 18]\r\n        const idx = cycle.indexOf(trebleTarget)\r\n        const next = cycle[(idx + 1) % cycle.length]\r\n        setTrebleTarget(next)\r\n      }\r\n      // End session at configured throws\r\n      if (trebleMaxDarts > 0 && nd >= trebleMaxDarts) setTrebleFinished(true)\r\n      return nd\r\n    })\r\n  }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0); setTrebleFinished(false) }\r\n\r\n  // Baseball\r\n  function addBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    setBaseball(prev => { const cp = { ...prev }; applyBaseballDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetBaseball() { setBaseball(createBaseball()) }\r\n\r\n  // Golf\r\n  function addGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    setGolf(prev => { const cp = { ...prev }; applyGolfDart(cp as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetGolf() { setGolf(createGolf()) }\r\n\r\n  // Tic Tac Toe\r\n  function addTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setTTT(prev => { const cp = { ...prev, board: [...prev.board] as any }; tryClaimCell(cp as any, cell as any, value, ring as any, sector); return cp })\r\n  }\r\n  function resetTtt() { setTTT(createTicTacToe()) }\r\n\r\n  // American Cricket\r\n  function addAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setAmCricket(prev => { const cp = { ...prev, marks: { ...prev.marks } }; applyAmCricketDart(cp as any, value, ring as any, sector, () => false); return cp })\r\n  }\r\n  function resetAmCricket() { setAmCricket(createAmCricketState()) }\r\n\r\n  // --- Around the Clock helpers ---\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const target = ATC_ORDER[atcIndex]\r\n    let hit = false\r\n    if (typeof sector === 'number' && sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) hit = true\r\n    if (target === 25 && (ring === 'BULL' || val === 25)) hit = true\r\n    if (target === 50 && (ring === 'INNER_BULL' || val === 50)) hit = true\r\n    if (!hit) {\r\n      // Fallback by value only\r\n      if (val === target || val === target * 2 || val === target * 3) hit = true\r\n    }\r\n    if (hit) {\r\n      const newHits = atcHits + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(i => i + 1)\r\n    }\r\n  }\r\n  function addAtcNumeric() { addAtcValue(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n  function addAtcManual() {\r\n    const v = parseManualDart(manualBox)\r\n    if (v == null) { alert('Enter like T20, D5, 25, 50'); return }\r\n    addAtcValue(v)\r\n    setManualBox('')\r\n  }\r\n\r\n  // --- Cricket helpers (solo practice) ---\r\n  function addCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setCricket(prev => {\r\n      const copy = { ...prev, marks: { ...prev.marks } }\r\n      applyCricketDart(copy as any, value, ring, sector, () => false)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1; if (nd >= 3) return 0; return nd\r\n    })\r\n  }\r\n  function addCricketNumeric() { addCricketAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Shanghai helpers ---\r\n  function addShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setShanghai(prev => {\r\n      const copy = { ...prev, turnHits: { ...prev.turnHits } }\r\n      applyShanghaiDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setShanghai(prev => { const cp = { ...prev, turnHits: { ...prev.turnHits } }; endShanghaiTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addShanghaiNumeric() { addShanghaiAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- Halve It helpers ---\r\n  function addHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setHalve(prev => {\r\n      const copy = { ...prev, targets: [...prev.targets] }\r\n      applyHalveItDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHalve(prev => { const cp = { ...prev, targets: [...prev.targets] }; endHalveItTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHalveNumeric() { addHalveAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  // --- High-Low helpers ---\r\n  function addHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setHighlow(prev => {\r\n      const copy = { ...prev }\r\n      applyHighLowDart(copy as any, value, ring, sector)\r\n      return copy\r\n    })\r\n    setPracticeTurnDarts(d => {\r\n      const nd = d + 1\r\n      if (nd >= 3) {\r\n        setHighlow(prev => { const cp = { ...prev }; endHighLowTurn(cp as any); return cp })\r\n        return 0\r\n      }\r\n      return nd\r\n    })\r\n  }\r\n  function addHighLowNumeric() { addHighLowAuto(Math.max(0, playerDartPoints|0)); setPlayerDartPoints(0) }\r\n\r\n  function parseManualBox(): number | null {\r\n    const t = manualBox.trim().toUpperCase()\r\n    if (!t) return null\r\n    if (t === '50' || t === 'BULL' || t === 'DBULL' || t === 'IBULL') return 50\r\n    if (t === '25' || t === 'OBULL') return 25\r\n    const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n    if (!m) return null\r\n    const mult = (m[1] || 'S') as 'S'|'D'|'T'\r\n    const num = parseInt(m[2],10)\r\n    if (num < 1 || num > 20) return null\r\n    const multVal = mult==='S'?1:mult==='D'?2:3\r\n    return num * multVal\r\n  }\r\n\r\n  function addManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    applyDartValue(val)\r\n    setManualBox('')\r\n  }\r\n\r\n  function addManualTextarea() {\r\n    const lines = manualTextarea.trim().split('\\n').map(l => l.trim()).filter(l => l)\r\n    if (lines.length === 0) return\r\n    for (const line of lines) {\r\n      const val = parseManualDart(line)\r\n      if (val == null) { alert(`Invalid score: ${line}`); return }\r\n      applyDartValue(val)\r\n    }\r\n    setManualTextarea('')\r\n  }\r\n\r\n  function replaceLast() {\r\n    if (playerVisitDarts === 0) return\r\n    // Rewind one dart: approximate by adding back last dart into score\r\n    setPlayerScore(s => s + playerLastDart)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n  }\r\n\r\n  function replaceLastManual() {\r\n    const val = parseManualBox()\r\n    if (val == null) { alert('Enter like T20, D16, 5, 25, 50'); return }\r\n    if (playerVisitDarts === 0) { addManual(); return }\r\n    // Rewind last then apply\r\n    const rewind = playerLastDart\r\n    setPlayerScore(s => s + rewind)\r\n    setPlayerVisitDarts(d => Math.max(0, d - 1))\r\n    // Apply new value in next microtask to ensure state has updated\r\n    setTimeout(() => applyDartValue(val), 0)\r\n    setManualBox('')\r\n  }\r\n\r\n  function playerThrow(points: number) {\r\n    let newScore = playerScore - points;\r\n    if (newScore < 0) {\r\n      setPlayerScore(playerScore); // bust\r\n      return;\r\n    }\r\n    setPlayerScore(newScore);\r\n    if (newScore === 0) {\r\n      setPendingLegWinner('player')\r\n      setShowWinPopup(true)\r\n    }\r\n    setOnDouble(newScore <= 40 && newScore % 2 === 0)\r\n  }\r\n\r\n  function aiTurn() {\r\n    // This is now automated inside the modal turn loop\r\n  }\r\n\r\n  function handleBust() {\r\n    setPlayerScore(playerScore); // bust, score unchanged\r\n    setOnDouble(false);\r\n  }\r\n\r\n  function handleWinPopupSubmit() {\r\n    const winner = pendingLegWinner ?? 'player'\r\n    // Approximate per-leg doubles attempts: if winner is player and they finished from <=50, attempts were counted in playerVisitDartsAtDouble; otherwise leave undefined\r\n    const legDoublesAtt = winner==='player' ? (playerVisitDartsAtDouble || undefined) : (aiVisitDartsAtDouble || undefined)\r\n    const legDoublesHit = 1\r\n    const winnerDarts = winner==='player' ? playerDartsThrown : aiDartsThrown\r\n    setLegStats([...legStats, { winner, doubleDarts, checkoutDarts, winnerDarts, doublesAtt: legDoublesAtt, doublesHit: legDoublesHit }]);\r\n    setShowWinPopup(false);\r\n    // Increment legs for the winner\r\n    let p = playerLegs\r\n    let a = aiLegs\r\n    if (pendingLegWinner === 'player') p += 1\r\n    else if (pendingLegWinner === 'ai') a += 1\r\n    setPlayerLegs(p)\r\n    setAiLegs(a)\r\n    setPendingLegWinner(null)\r\n    // Check if match is over\r\n    if (p >= firstTo || a >= firstTo) {\r\n      // End of match: close modal back to menu state\r\n      // Record per-game-mode result (local-only demo)\r\n      try { bumpGameMode(selectedMode, winner === 'player') } catch {}\r\n      setShowMatchModal(false)\r\n      setInMatch(false)\r\n      // Reset leg-specific stats for next match but keep the summary list visible\r\n      setPlayerScore(x01Score)\r\n      setAiScore(x01Score)\r\n      setShowMatchSummary(true)\r\n      return\r\n    }\r\n    // Otherwise, start the next leg immediately\r\n    startNextLeg()\r\n  }\r\n\r\n  const isFreeSelected = freeGames.includes(selectedMode as any)\r\n  const lockedPremium = !isFreeSelected && !(user?.fullAccess || user?.admin)\r\n\r\n  // no external overlay: we render the match modal as absolute inset-0 inside this card\r\n\r\n  return (\r\n  <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n  <h2 className=\"text-2xl font-bold text-brand-700 mb-4\">Offline Game Modes {offlineLayout==='classic' ? <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-white/10 border border-white/10 align-middle\">Classic layout</span> : <span className=\"ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 align-middle\">Modern layout</span>}</h2>\r\n      <div className=\"ndn-shell-body\">\r\n      <div className=\"mb-4 flex flex-col gap-3\">\r\n        <label className=\"font-semibold\">Select game mode:</label>\r\n        <select className=\"input w-full\" value={selectedMode} onChange={e => setSelectedMode(e.target.value)}>\r\n          {freeGames.map(mode => <option key={mode} value={mode}>{mode}</option>)}\r\n          {premiumGames.map(mode => (\r\n            <option key={mode} value={mode} disabled={!(user?.fullAccess || user?.admin)}>{mode} {(user?.fullAccess || user?.admin) ? '' : '(Premium)'}</option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* Calibration Status - displayed below game mode selector */}\r\n        <GameCalibrationStatus \r\n          gameMode={selectedMode} \r\n          compact={true}\r\n        />\r\n\r\n        {selectedMode === 'Treble Practice' && (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end\">\r\n            <div className=\"sm:col-span-1\">\r\n              <label className=\"font-semibold\">Throws per game</label>\r\n              <input className=\"input w-full\" type=\"number\" min={3} step={3} value={trebleMaxDarts} onChange={e=>setTrebleMaxDarts(Math.max(3, Math.floor(Number(e.target.value)||30)))} />\r\n            </div>\r\n            <div className=\"sm:col-span-2 text-xs text-slate-300\">Target cycles T20→T19→T18 every 3 darts. Game ends after the selected number of throws.</div>\r\n          </div>\r\n        )}\r\n        {!user?.fullAccess && (\r\n          <div className=\"mt-2 p-2 rounded-lg bg-slate-800/40 border border-slate-700/40 text-slate-200 text-sm flex items-center gap-2\">\r\n            <span>🔒</span>\r\n            <span>Only X01 and Double Practice are free. Advanced modes (Killer, Cricket, Shanghai, etc.) require PREMIUM.</span>\r\n          </div>\r\n        )}\r\n        {selectedMode === 'X01' && (\r\n          <>\r\n            <label className=\"font-semibold mt-2\">Enter starting score (1-1001):</label>\r\n            <input\r\n              className=\"input w-full\"\r\n              type=\"number\"\r\n              min={1}\r\n              max={1001}\r\n              value={x01Score}\r\n              onChange={e => setX01Score(Number(e.target.value))}\r\n            />\r\n            <label className=\"font-semibold mt-2\">Play against AI bot?</label>\r\n            <select className=\"input w-full\" value={ai} onChange={e => setAI(e.target.value)}>\r\n              <option value=\"None\">None</option>\r\n              {aiLevels.map(level => <option key={level} value={level}>{level}</option>)}\r\n            </select>\r\n            {ai !== 'None' && (\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 items-end mt-2\">\r\n                <div className=\"sm:col-span-2\">\r\n                  <label className=\"font-semibold\">AI throw delay (seconds)</label>\r\n                  <input\r\n                    className=\"input w-full\"\r\n                    type=\"number\"\r\n                    min={0.5}\r\n                    max={10}\r\n                    step={0.5}\r\n                    value={aiDelayMs / 1000}\r\n                    onChange={e => setAiDelayMs(Math.round(Number(e.target.value) * 1000))}\r\n                  />\r\n                </div>\r\n                <div className=\"text-sm text-slate-300\">Controls how long the AI waits before its visit.</div>\r\n              </div>\r\n            )}\r\n            <button className=\"btn mt-2\" onClick={() => setShowRules(true)}>X01 Rules & Regulations!</button>\r\n          </>\r\n        )}\r\n        {selectedMode === 'Double Practice' && (\r\n          <div className=\"mt-2 text-brand-600\">Hit doubles D1 → D20 → DBULL in as few darts as possible. AI and X01 settings don’t apply.</div>\r\n        )}\r\n      </div>\r\n  {!inMatch && <button className=\"btn\" disabled={lockedPremium} title={lockedPremium ? 'PREMIUM required for this mode' : ''} onClick={startMatch}>Start Match</button>}\r\n      {/* Match Modal with turn-by-turn flow */}\r\n      {showMatchModal && (\r\n  <div className={`absolute inset-0 z-[1000] ${maximized ? '' : 'flex items-center justify-center p-3 sm:p-4'}` }>\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:offline-match\"\r\n            className={`${maximized ? 'w-full h-full ndn-modal-tight' : ''} relative flex flex-col overflow-hidden`}\r\n            fullScreen={maximized}\r\n            defaultWidth={1100}\r\n            defaultHeight={720}\r\n            minWidth={720}\r\n            minHeight={480}\r\n            maxWidth={1600}\r\n            maxHeight={1200}\r\n            initialFitHeight\r\n          >\r\n            {/* Header bar with visible mode and actions; sheen is clipped to this area */}\r\n            <div\r\n              className=\"flex-1 min-h-0 overflow-x-hidden pr-1 pt-2 pb-2\"\r\n              style={{ overflowY: fitAll ? 'hidden' as any : 'auto' }}\r\n              ref={(el) => { (scrollerRef as any).current = el }}\r\n            >\r\n              <div ref={(el)=>{ (headerBarRef as any).current = el }}>\r\n                <GameHeaderBar\r\n                  left={(\r\n                    <>\r\n                      <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                      <span className=\"font-medium whitespace-nowrap\">{selectedMode}{selectedMode==='X01' ? ` / ${x01Score}` : ''}</span>\r\n                      <span className=\"opacity-80 whitespace-nowrap\">First to {firstTo} · Legs {playerLegs}-{aiLegs}</span>\r\n                      <span className={`ml-2 px-2 py-0.5 rounded-full border text-[10px] sm:text-xs ${offlineLayout==='modern' ? 'bg-emerald-500/15 text-emerald-200 border-emerald-400/30' : 'bg-white/10 text-white/70 border-white/20'}`}>{offlineLayout==='modern' ? 'Modern layout' : 'Classic layout'}</span>\r\n                    </>\r\n                  )}\r\n                  right={(\r\n                    <>\r\n                      {/* Camera scale controls (match Online UI) */}\r\n                      <div className=\"hidden items-center gap-2 mr-2 text-xs\">\r\n                        <span className=\"opacity-80\">Cam</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.max(0.5, Math.round((cameraScale - 0.05) * 100) / 100))}\r\n                          title=\"Decrease camera size\"\r\n                        >−</button>\r\n                        <span className=\"w-9 text-center\">{Math.round(cameraScale * 100)}%</span>\r\n                        <button\r\n                          className=\"btn btn--ghost px-2 py-1\"\r\n                          onClick={() => setCameraScale(Math.min(1.25, Math.round((cameraScale + 0.05) * 100) / 100))}\r\n                          title=\"Increase camera size\"\r\n                        >+</button>\r\n                      </div>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={fitAll ? 'Actual Size' : 'Fit All'}\r\n                        onClick={() => setFitAll(v => !v)}\r\n                      >{fitAll ? 'Actual Size' : 'Fit All'}</button>\r\n                      <button\r\n                        className=\"btn btn--ghost px-3 py-1 text-sm\"\r\n                        title={maximized ? 'Restore' : 'Maximize'}\r\n                        onClick={() => setMaximized(m => !m)}\r\n                      >{maximized ? 'Restore' : 'Maximize'}</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={() => { startMatch() }}>Restart</button>\r\n                      <button className=\"btn bg-rose-600 hover:bg-rose-700 px-3 py-1 text-sm\" onClick={() => { setShowMatchModal(false); setInMatch(false); }}>Quit</button>\r\n                    </>\r\n                  )}\r\n                />\r\n              </div>\r\n              <div\r\n                ref={(el) => { (contentRef as any).current = el }}\r\n                className=\"will-change-transform\"\r\n                style={fitAll ? { transform: `scale(${fitScale})`, transformOrigin: 'top left', width: '100%', fontSize: `${Math.max(0.8, Math.min(1, fitScale))}em` } : undefined}\r\n              >\r\n            <h3 className=\"text-xl font-bold mb-2 mt-1 leading-tight\">{selectedMode === 'X01' ? 'X01 Match' : selectedMode}</h3>\r\n            <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Mode: {selectedMode}</span>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Start: {x01Score}</span>\r\n              <div ref={formatRef} className=\"inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">\r\n                <span>Format:</span>\r\n                {(() => {\r\n                  const disabled = (playerScore !== x01Score || aiScore !== x01Score || playerVisitDarts > 0)\r\n                  const pillCls = `px-2 py-0.5 rounded border text-xs ${disabled? 'opacity-50 cursor-not-allowed': 'cursor-pointer'} `\r\n                  return (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='first' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('first') }}\r\n                          title=\"First to N\"\r\n                        >First to</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className={`${pillCls} ${formatType==='best' ? 'bg-indigo-500/20 text-indigo-100 border-indigo-400/30' : 'bg-white/10 text-white/80 border-white/20'}`}\r\n                          onClick={() => { if (!disabled) setFormatType('best') }}\r\n                          title=\"Best of N (wins = ceil(N/2)\"\r\n                        >Best of</button>\r\n                      </div>\r\n                      <input\r\n                        className={`input w-16 text-center ${disabled ? 'opacity-50' : ''}`}\r\n                        type=\"number\"\r\n                        min={1}\r\n                        step={1}\r\n                        value={formatCount}\r\n                        onChange={e => setFormatCount(Math.max(1, Math.floor(Number(e.target.value)||1)))}\r\n                        disabled={disabled}\r\n                        title={formatType==='first' ? 'First to N' : 'Best of N (wins = ceil(N/2))'}\r\n                      />\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">Legs: {playerLegs}–{aiLegs}</span>\r\n              {/* Move match type and team names to the right of Legs for a single-row header */}\r\n              <div className=\"ml-auto flex items-center gap-1 text-[10px] flex-wrap\">\r\n                <span className=\"opacity-70\">Match</span>\r\n                <select className={`btn ${buttonSizeClass}`} value={matchType} onChange={e=>setMatchType((e.target.value as 'singles'|'doubles'))}>\r\n                  <option value=\"singles\">Singles</option>\r\n                  <option value=\"doubles\">Doubles</option>\r\n                </select>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamAName} onChange={e=>setTeamAName(e.target.value)} placeholder=\"Team A\" />\r\n                <span className=\"opacity-50\">vs</span>\r\n                <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamBName} onChange={e=>setTeamBName(e.target.value)} placeholder=\"Team B\" />\r\n              </div>\r\n            </div>\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full mb-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                      <span className=\"opacity-80\">Current Target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span>\r\n                    </div>\r\n                    {/* Large counter moved to the camera column to allow the preview to be raised and enlarged */}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Cricket — Close 20–15 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-7 gap-1 text-center text-[11px] mb-2\">\r\n                      {CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, cricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{cricket.points}</span></div>\r\n                    {cricketClosedAll(cricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setCricket(createCricketState()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{shanghai.round}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {shanghai.score}</div>\r\n                    {shanghai.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setShanghai(createShanghaiState()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Stage</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{halve.stage+1}/{halve.targets.length}</span></div>\r\n                    <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const t = getCurrentHalveTarget(halve); if (!t) return '—'; if (t.kind==='ANY_NUMBER') return 'Any'; if (t.kind==='BULL') return 'Bull'; if (t.kind==='DOUBLE' || t.kind==='TRIPLE' || t.kind==='NUMBER') return `${t.kind} ${(t as any).num}`; return '—' })()}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {halve.score}</div>\r\n                    {halve.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setHalve(createDefaultHalveIt()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {highlow.round} · Target {highlow.target}</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {highlow.score}</div>\r\n                    {highlow.finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setHighlow(createHighLow()); setPracticeTurnDarts(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 flex items-center justify-between\"><span>Target</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-semibold\">D{b27Stage}</span></div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {b27Score}</div>\r\n                    {b27Finished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetB27}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {cuRound}/8</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {cuScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {hsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {hsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Round {lsRound}/10</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">Score: {lsScore}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co170Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Remaining</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{co121Rem}</div>\r\n                    <div className=\"text-xs text-slate-400 mt-1\">Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    <div className=\"flex items-center justify-between gap-4\">\r\n                      <div>\r\n                        <div className=\"text-xs text-slate-600\">Treble Target: T{trebleTarget}</div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">Hits: {trebleHits}</div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 flex-wrap\">\r\n                        <label className=\"text-sm\">Target</label>\r\n                        <div className=\"inline-flex items-center gap-1\">\r\n                          {[20,19,18].map(n => (\r\n                            <button key={`tpick-header-${n}`} className={`btn px-2 py-0.5 text-xs ${trebleTarget===n?'bg-emerald-600/30 border border-emerald-400/30':''}`} onClick={()=>setTrebleTarget(n)}>T{n}</button>\r\n                          ))}\r\n                        </div>\r\n                        <span className=\"opacity-60 text-xs\">or</span>\r\n                        <select className=\"input w-24\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                          {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                        </select>\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={resetTreble}>Reset</button>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Inning</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{baseball.inning}</div>\r\n                    <div className=\"text-sm\">Score: <span className=\"font-semibold\">{baseball.score}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Hole</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{golf.hole}</div>\r\n                    <div className=\"text-sm\">Strokes: <span className=\"font-semibold\">{golf.strokes}</span></div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Turn</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{ttt.turn}</div>\r\n                    {ttt.finished && <div className=\"mt-1 text-xs\">Winner: {ttt.winner || '—'}</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Target</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{SCAM_TARGET_NAMES[scam.targetIndex]}</div>\r\n                    <div className=\"text-sm\">Progress: <span className=\"font-semibold\">{scam.targetIndex + 1}/{SCAM_TARGET_NAMES.length}</span></div>\r\n                    {scam.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">🎉 Finished in {scam.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{fives.score}/{fives.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{fives.darts}</span></div>\r\n                    {fives.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">✓ Reached {fives.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600\">Score</div>\r\n                    <div className=\"text-3xl font-extrabold tracking-tight\">{sevens.score}/{sevens.target}</div>\r\n                    <div className=\"text-sm\">Darts: <span className=\"font-semibold\">{sevens.darts}</span></div>\r\n                    {sevens.finished && <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200\">✓ Reached {sevens.target}!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    <div className=\"text-xs text-slate-600 mb-1\">Close 20–12 and Bull; overflow scores points</div>\r\n                    <div className=\"grid grid-cols-10 gap-1 text-center text-[11px] mb-2\">\r\n                      {AM_CRICKET_NUMBERS.map(n => (\r\n                        <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                          <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                          <div className=\"font-semibold\">{Math.min(3, amCricket.marks?.[n]||0)} / 3</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm\">Points: <span className=\"font-semibold\">{amCricket.points}</span></div>\r\n                    {hasClosedAllAm(amCricket) && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetAmCricket}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"text-xs text-slate-600\">Setup players and assign numbers</div>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span>Turn</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">{killerPlayers[killerTurnIdx]?.name || '—'}</span>\r\n                        </div>\r\n                        <div className=\"text-3xl font-extrabold tracking-tight\">{killerWinnerId ? `${killerPlayers.find(p=>p.id===killerWinnerId)?.name || 'Winner'} Wins` : (killerLastEvent || 'Ready')}</div>\r\n                      </>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : offlineLayout === 'modern' ? (\r\n              <div className=\"grid grid-cols-1 gap-2 mb-2 items-stretch\">\r\n                {/* Right area: toolbar + camera takes full width (left column removed) */}\r\n                <div className=\"min-w-0 space-y-2 flex flex-col justify-between\">\r\n                  {!manualScoring ? (\r\n                    <>\r\n                      <div className=\"flex items-center flex-wrap gap-1.5 mt-1\">\r\n                        {/* Match type and names moved to header (next to Legs) */}\r\n                        <div className=\"ml-auto flex items-center gap-1 text-[10px]\">\r\n                          <span className=\"opacity-70\">Cam</span>\r\n                          <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                          <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale*100)}%</span>\r\n                          <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                          <span className=\"opacity-50\">|</span>\r\n                          <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={()=>setCameraFitMode(cameraFitMode==='fill'?'fit':'fill')}>{cameraFitMode==='fill'?'Fill':'Fit'}</button>\r\n                          <span className=\"opacity-50\">|</span>\r\n                          <button className={`btn ${buttonSizeClass}`} title=\"Toggle camera aspect\" onClick={()=>setCameraAspect(cameraAspect==='square'?'wide':'square')}>{cameraAspect==='square'?'Square':'Wide'}</button>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-stretch justify-end min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                        {/* Centered mode counter moved here so camera preview can be pushed up and enlarged */}\r\n                        {(selectedMode as any) === 'Double Practice' && (\r\n                          <div className=\"w-full text-center mb-3\">\r\n                            <div className=\"text-xs text-slate-600\">Current Target</div>\r\n                            <div className=\"text-3xl font-extrabold tracking-tight\">{dpHits} / 21</div>\r\n                          </div>\r\n                        )}\r\n                        {(selectedMode as any) === 'Around the Clock' && (\r\n                          <div className=\"w-full text-center mb-3\">\r\n                            <div className=\"text-xs text-slate-600\">Current Target</div>\r\n                            <div className=\"text-3xl font-extrabold tracking-tight\">{atcHits} / {ATC_ORDER.length}</div>\r\n                          </div>\r\n                        )}\r\n\r\n                        <ResizablePanel\r\n                          storageKey=\"ndn:camera:tile:offline:primary\"\r\n                          className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n                          defaultWidth={720}\r\n                          defaultHeight={420}\r\n                          minWidth={320}\r\n                          minHeight={220}\r\n                          maxWidth={1600}\r\n                          maxHeight={900}\r\n                          autoFill\r\n                        >\r\n                          <CameraTile\r\n                            label=\"Your Board\"\r\n                            autoStart={true}\r\n                            className=\"min-w-0 h-full\"\r\n                            aspect=\"classic\"\r\n                          />\r\n                        </ResizablePanel>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"card\">\r\n                      <div className=\"text-sm font-semibold mb-1\">Manual scoring active</div>\r\n                      <div className=\"text-xs opacity-70\">Camera previews are disabled. Use the manual entry controls below to record your turn.</div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:[grid-template-columns:1fr_1.2fr_1fr] gap-2 mb-2 items-stretch min-w-0\">\r\n                <div className=\"flex items-stretch justify-center md:px-3 min-w-0\">\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                  <span className=\"opacity-80\">You Remain</span>\r\n                  {isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{playerScore}</div>\r\n                <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                  <div className=\"h-full bg-emerald-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (playerScore / x01Score)) * 100))}%` }} />\r\n                </div>\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{playerLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3).toFixed(1) : '0.0'}</span></div>\r\n                <div className=\"text-xs opacity-70 flex items-center gap-2\">\r\n                  <span>Darts thrown: {playerDartsThrown}</span>\r\n                  <span className=\"inline-flex items-center gap-1\" aria-label=\"Visit darts\">\r\n                    {[0,1,2].map(i => (\r\n                      <span key={i} className={`w-2 h-2 rounded-full ${i < playerVisitDarts ? 'bg-emerald-400' : 'bg-white/20'}`}></span>\r\n                    ))}\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {playerDoublesAtt} · Hit {playerDoublesHit}</span></div>\r\n                {playerScore <= 170 && playerScore > 0 && (\r\n                  (() => {\r\n                    const sugs = suggestCheckouts(playerScore, favoriteDouble)\r\n                    const first = sugs[0] || '—'\r\n                    return (\r\n                      <div className=\"mt-2 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-white text-sm\">\r\n                        <span className=\"opacity-70\">Checkout</span>\r\n                        <span className=\"font-semibold\">{first}</span>\r\n                      </div>\r\n                    )\r\n                  })()\r\n                )}\r\n              </div>\r\n              {/* Center camera preview: right-aligned and square when selected */}\r\n              <div className=\"flex items-stretch justify-end md:px-3 min-w-0 flex-1 min-h-0 ndn-camera-tall\">\r\n                <ResizablePanel\r\n                  storageKey=\"ndn:camera:tile:offline:center\"\r\n                  className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n                  defaultWidth={720}\r\n                  defaultHeight={420}\r\n                  minWidth={320}\r\n                  minHeight={220}\r\n                  maxWidth={1600}\r\n                  maxHeight={900}\r\n                  autoFill\r\n                >\r\n                  <CameraTile\r\n                    label=\"Your Board\"\r\n                    autoStart={true}\r\n                    className=\"min-w-0 h-full\"\r\n                    aspect=\"classic\"\r\n                    fill\r\n                  />\r\n                </ResizablePanel>\r\n              </div>\r\n              {/* Match summary (offline) */}\r\n              <div className={`mt-2 ${boxSize === 'small' ? 'p-2' : boxSize === 'large' ? 'p-4' : 'p-3'} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSize === 'small' ? 'text-xs' : textSize === 'large' ? 'text-base' : 'text-sm'}`}>\r\n                <div className=\"font-semibold mb-2\">Match Summary</div>\r\n                {(() => {\r\n                  // In offline X01, player is vs AI or practice\r\n                  const currentThrower = isPlayerTurn ? (user?.username || 'You') : (ai === 'None' ? '—' : `${ai} AI`)\r\n                  const currentRemaining = isPlayerTurn ? playerScore : (ai === 'None' ? 0 : aiScore)\r\n                  const last = isPlayerTurn ? playerLastDart : aiLastDart\r\n                  const lastScoreVisit = isPlayerTurn ? playerVisitSum : aiVisitSum\r\n                  const dartsThrown = isPlayerTurn ? playerDartsThrown : aiDartsThrown\r\n                  const scored = (x01Score - (isPlayerTurn ? playerScore : (ai === 'None' ? x01Score : aiScore)))\r\n                  const avg3 = dartsThrown > 0 ? ((scored / dartsThrown) * 3) : 0\r\n                  const matchScore = `${playerLegs}-${aiLegs}`\r\n                  const bestLegText = legStats.length > 0 ? `${Math.min(...legStats.map(l=>l.doubleDarts + (l.checkoutDarts||0))) || 0} darts` : '—'\r\n                  return (\r\n                    <div className=\"grid grid-cols-2 gap-y-1\">\r\n                      <div className=\"opacity-80\">Current score</div>\r\n                      <div className=\"font-mono text-right\">{matchScore}</div>\r\n                      <div className=\"opacity-80\">Current thrower</div>\r\n                      <div className=\"text-right font-semibold text-lg\">{currentThrower}</div>\r\n                      <div className=\"opacity-80\">Score remaining</div>\r\n                      <div className=\"text-right font-mono font-bold text-xl\">{currentRemaining}</div>\r\n                      <div className=\"opacity-80\">3-dart avg</div>\r\n                      <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n                      <div className=\"opacity-80\">Last score</div>\r\n                      <div className=\"text-right font-mono\">{lastScoreVisit || last}</div>\r\n                      <div className=\"opacity-80\">Best leg</div>\r\n                      <div className=\"text-right\">{bestLegText}</div>\r\n                    </div>\r\n                  )\r\n                })()}\r\n              </div>\r\n              <div className=\"p-3 rounded-2xl glass text-white border border-white/10 min-w-0 flex flex-col h-full\">\r\n                <div className=\"text-xs flex items-center justify-between opacity-80\">\r\n                  <span>{ai === 'None' ? 'Opponent' : `${ai} AI`} Remain</span>\r\n                  {!isPlayerTurn ? (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 text-xs font-bold\">THROWING</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-500/20 text-slate-200 text-xs font-bold\">WAITING TO THROW</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl font-extrabold tracking-tight\">{ai !== 'None' ? aiScore : 'N/A'}</div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"h-1.5 w-full bg-white/10 rounded-full mt-2 overflow-hidden\">\r\n                    <div className=\"h-full bg-fuchsia-400/70\" style={{ width: `${Math.max(0, Math.min(100, (1 - (aiScore / x01Score)) * 100))}%` }} />\r\n                  </div>\r\n                )}\r\n                <div className=\"text-sm mt-1 opacity-90\">Last dart: <span className=\"font-semibold\">{ai === 'None' ? 0 : aiLastDart}</span></div>\r\n                <div className=\"text-sm opacity-90\">3-Dart Avg: <span className=\"font-semibold\">{ai !== 'None' ? (totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3).toFixed(1) : '0.0') : '—'}</span></div>\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-70\">Darts thrown: {aiDartsThrown}</div>\r\n                )}\r\n                {ai !== 'None' && (\r\n                  <div className=\"text-xs opacity-80 mt-1\">Doubles: <span className=\"font-semibold\">Att {aiDoublesAtt} · Hit {aiDoublesHit}</span></div>\r\n                )}\r\n              </div>\r\n                </div>\r\n            </div>\r\n            )}\r\n            {/* Turn area */}\r\n            {selectedMode !== 'X01' ? (\r\n              <div className=\"space-y-2\">\r\n                {selectedMode === 'Double Practice' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || '—'}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} onAutoDart={(value, ring) => {\r\n                        if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                          const hit = isDoubleHit(value, dpIndex)\r\n                          if (hit) { const nh = dpHits + 1; const ni = dpIndex + 1; setDpHits(nh); setDpIndex(ni); if (nh >= DOUBLE_PRACTICE_ORDER.length) setTimeout(()=>{ setDpHits(0); setDpIndex(0) }, 250) }\r\n                        }\r\n                      }} immediateAutoCommit />\r\n                    </div>}\r\n                    <div className=\"flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-24\" type=\"number\" min={0} max={60} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e => { if (e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e => { if (e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn px-3 py-1 text-sm\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-300\">Progress: {dpHits} of 21</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Around the Clock' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || '—')}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addAtcValue(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-44\" placeholder=\"Manual (T20, D5, 25, 50)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                    {atcHits >= ATC_ORDER.length && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={()=>{ setAtcHits(0); setAtcIndex(0) }}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addCricketNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addCricketNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setCricket(createCricketState()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Shanghai' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addShanghaiAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addShanghaiNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addShanghaiNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setShanghai(createShanghaiState()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Halve It' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHalveAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHalveNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHalveNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHalve(createDefaultHalveIt()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High-Low' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addHighLowAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addHighLowNumeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addHighLowNumeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHighlow(createHighLow()); setPracticeTurnDarts(0) }}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === \"Bob's 27\" && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addB27Auto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') addB27Numeric() }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addB27Numeric}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetB27}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Count-Up' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addCountUpAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addCountUpAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setCuRound(1); setCuScore(0); setCuDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {cuRound}/{cuMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'High Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addHighScoreAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addHighScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setHsRound(1); setHsScore(0); setHsDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {hsRound}/{hsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Low Score' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value) => addLowScoreAuto(value)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={0} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') { addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ addLowScoreAuto(playerDartPoints); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{ setLsRound(1); setLsScore(0); setLsDarts(0) }}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Round {lsRound}/{lsMaxRounds}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 170' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring) => addCo170Auto(value, ring === 'MISS' ? undefined : ring)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(true) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(true)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo170}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co170Rem} · Attempts: {co170Attempts} · Successes: {co170Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Checkout 121' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring) => addCo121Auto(value, ring === 'MISS' ? undefined : ring)} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (D16, T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addCoManual(false) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>addCoManual(false)}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetCo121}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Remaining: {co121Rem} · Attempts: {co121Attempts} · Successes: {co121Successes}</div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Treble Practice' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : ring; addTrebleAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"text\" placeholder=\"Manual (T20)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') { const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') } }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ const v = parseManualDart(manualBox); if (v!=null) addTrebleAuto(v, undefined, undefined); setManualBox('') }}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Hits: {trebleHits} · Misses: {Math.max(0, trebleDarts - trebleHits)} · Darts: {trebleDarts}{trebleMaxDarts>0?`/${trebleMaxDarts}`:''}</div>\r\n                    {trebleFinished && (\r\n                      <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetTreble}>Reset</button></div>\r\n                    )}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Baseball' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetBaseball}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Golf' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetGolf}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Tic Tac Toe' && (\r\n                  <>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i).map(cell => (\r\n                        <button key={cell} className={`h-16 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // One-tap claim attempt using autoscore last dart; fallback: prompt numeric\r\n                          // For simplicity here, we use a no-op value and rely on next autoscore dart; as a usable fallback, open a numeric prompt\r\n                          const promptVal = Number(prompt('Enter dart score for this cell (e.g., 20, 40, 60; 25 or 50 for center)')||0)\r\n                          const ring = promptVal%3===0?'TRIPLE': promptVal%2===0?'DOUBLE':'SINGLE'\r\n                          const tcell = cell as unknown as 0|1|2|3|4|5|6|7|8\r\n                          const tgt = TTT_TARGETS[tcell]\r\n                          const num = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          addTttAuto(tcell, promptVal, ring as any, num as any)\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // Attempt to claim the currently tapped-looking cell not tracked; as a simple flow, map by round-robin preference or let user click a cell button above.\r\n                        // No-op here; primary interaction is via buttons with prompt for now.\r\n                      }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetTtt}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'American Cricket' && (\r\n                  <>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:ring; addAmCricketAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={resetAmCricket}>Reset</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Scam' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Target: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{SCAM_TARGET_NAMES[scamPlayer.targetIndex]}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { setScamPlayer(addScamAuto(scamPlayer, value, ring as any)) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={1} max={25} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints)); setPlayerDartPoints(0) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ setScamPlayer(addScamNumeric(scamPlayer, playerDartPoints)); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setScamPlayer(resetScam())}>Reset</button>\r\n                    </div>\r\n                    {scamPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">🎉 Finished in {scamPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Fives' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{fivesPlayer.score}/{fivesPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any)) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={5} max={50} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints)); setPlayerDartPoints(0) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ setFivesPlayer(addFivesNumeric(fivesPlayer, playerDartPoints)); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setFivesPlayer(resetFives(fivesPlayer.target))}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 5, 10, 15, 20, 25, 50 · Darts: {fivesPlayer.darts}</div>\r\n                    {fivesPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">✓ Reached {fivesPlayer.target} in {fivesPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Sevens' && (\r\n                  <>\r\n                    <div className=\"font-semibold\">Score: <span className=\"px-2 py-0.5 rounded-full bg-white/10 border border-white/10\">{sevensPlayer.score}/{sevensPlayer.target}</span></div>\r\n                    {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any)) }} />\r\n                    </div>}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-24\" type=\"number\" min={7} max={21} value={playerDartPoints} onChange={e => setPlayerDartPoints(Number(e.target.value||0))} onKeyDown={e=>{ if(e.key==='Enter') setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints)); setPlayerDartPoints(0) }} />\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{ setSevensPlayer(addSevensNumeric(sevensPlayer, playerDartPoints)); setPlayerDartPoints(0) }}>Add Dart</button>\r\n                      <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setSevensPlayer(resetSevens(sevensPlayer.target))}>Reset</button>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400\">Valid scores: 7, 14, 21 · Darts: {sevensPlayer.darts}</div>\r\n                    {sevensPlayer.finished && <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">✓ Reached {sevensPlayer.target} in {sevensPlayer.darts} darts!</div>}\r\n                  </>\r\n                )}\r\n                {selectedMode === 'Killer' && (\r\n                  <>\r\n                    {!killerSetupDone ? (\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"font-semibold\">Players</div>\r\n                        <div className=\"space-y-1\">\r\n                          {killerPlayers.map((p, idx) => (\r\n                            <div key={p.id} className=\"flex items-center gap-2\">\r\n                              <input className=\"input\" value={p.name} onChange={e=>{\r\n                                const name = e.target.value\r\n                                setKillerPlayers(list => list.map((it,i)=> i===idx?{...it,name}:it))\r\n                              }} />\r\n                              <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => list.filter((_,i)=>i!==idx))} disabled={killerPlayers.length<=2}>Remove</button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <button className=\"btn px-2 py-1\" onClick={()=> setKillerPlayers(list => {\r\n                            const id = `p${list.length+1}`; return [...list, { id, name: `Player ${list.length+1}` }]\r\n                          })}>Add Player</button>\r\n                          <button className=\"btn bg-emerald-600 hover:bg-emerald-700 px-3 py-1\" onClick={()=>{\r\n                            if (killerPlayers.length < 2) { alert('Need at least 2 players'); return }\r\n                            const ids = killerPlayers.map(p=>p.id)\r\n                            const assigned = assignKillerNumbers(ids)\r\n                            const initStates: Record<string,KillerState> = {}\r\n                            ids.forEach(id => { initStates[id] = createKillerState(assigned[id]) })\r\n                            setKillerAssigned(assigned)\r\n                            setKillerStates(initStates)\r\n                            setKillerTurnIdx(0)\r\n                            setKillerDarts(0)\r\n                            setKillerWinnerId(null)\r\n                            setKillerLastEvent('Assigned numbers')\r\n                            setKillerSetupDone(true)\r\n                          }}>Assign Numbers & Start</button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-3\">\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                          {killerPlayers.map(p => {\r\n                            const st = killerStates[p.id]\r\n                            const num = killerAssigned[p.id]\r\n                            return (\r\n                              <div key={p.id} className={`p-2 rounded-xl border ${st?.eliminated? 'opacity-50 border-red-500/40 bg-red-500/10' : 'border-slate-700/50 bg-slate-800/50'}`}>\r\n                                <div className=\"flex items-center justify-between text-xs\">\r\n                                  <div className=\"font-semibold\">{p.name}</div>\r\n                                  <div className={`text-[10px] px-1.5 py-0.5 rounded ${st?.isKiller?'bg-purple-500/20 text-purple-200 border border-purple-400/30':'bg-slate-600/30 text-slate-300'}`}>{st?.isKiller? 'Killer' : 'Not Killer'}</div>\r\n                                </div>\r\n                                <div className=\"mt-1 text-sm\">Number: <span className=\"font-semibold\">{num}</span></div>\r\n                                <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 0}</span></div>\r\n                              </div>\r\n                            )\r\n                          })}\r\n                        </div>\r\n                        {cameraEnabled && <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                          <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                            if (killerWinnerId) return\r\n                            const r = ring === 'MISS' ? undefined : ring\r\n                            const sector = info?.sector ?? null\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            if (!cur) return\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, r as any, sector)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              // Check winner\r\n                              const win = killerWinner(copy)\r\n                              if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) {\r\n                                // advance to next alive\r\n                                let next = killerTurnIdx\r\n                                for (let i=1;i<=killerPlayers.length;i++) {\r\n                                  const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                                  const pid = killerPlayers[idx].id\r\n                                  const st = killerStates[pid]\r\n                                  if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                                }\r\n                                setKillerTurnIdx(next)\r\n                                return 0\r\n                              }\r\n                              return nd\r\n                            })\r\n                          }} />\r\n                        </div>}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <input className=\"input w-40\" placeholder=\"Manual (D16, T5)\" value={manualBox} onChange={e=>setManualBox(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                            if (killerWinnerId) return\r\n                            const t = manualBox.trim().toUpperCase()\r\n                            const m = t.match(/^(S|D|T)?\\s*(\\d{1,2})$/)\r\n                            if (!m) { setManualBox(''); return }\r\n                            const mult = (m[1]||'S') as 'S'|'D'|'T'\r\n                            const num = parseInt(m[2],10)\r\n                            const ring = mult==='D'?'DOUBLE': mult==='T'?'TRIPLE':'SINGLE'\r\n                            const cur = killerPlayers[killerTurnIdx]\r\n                            setKillerStates(prev => {\r\n                              const copy: Record<string,KillerState> = {}\r\n                              Object.keys(prev).forEach(k => copy[k] = { ...prev[k] })\r\n                              const res = applyKillerDart(cur.id, copy, ring as any, num)\r\n                              if (res.becameKiller) setKillerLastEvent(`${cur.name} became a Killer`)\r\n                              else if (res.victimId) {\r\n                                const v = killerPlayers.find(p=>p.id===res.victimId)\r\n                                setKillerLastEvent(`${cur.name} hit ${v?.name}'s ${killerAssigned[res.victimId]} (${res.livesRemoved} life${(res.livesRemoved||0)>1?'s':''})`)\r\n                              } else setKillerLastEvent('No effect')\r\n                              const win = killerWinner(copy); if (win) setKillerWinnerId(win)\r\n                              return copy\r\n                            })\r\n                            setManualBox('')\r\n                            setKillerDarts(d => {\r\n                              const nd = d + 1\r\n                              if (nd >= 3) { let next = killerTurnIdx; for (let i=1;i<=killerPlayers.length;i++){ const idx=(killerTurnIdx+i)%killerPlayers.length; const pid=killerPlayers[idx].id; const st=killerStates[pid]; if (st && !st.eliminated && st.lives>0) { next=idx; break } } setKillerTurnIdx(next); return 0 } return nd\r\n                            })\r\n                          } }} />\r\n                          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Skip to next alive player\r\n                            let next = killerTurnIdx\r\n                            for (let i=1;i<=killerPlayers.length;i++) {\r\n                              const idx = (killerTurnIdx + i) % killerPlayers.length\r\n                              const pid = killerPlayers[idx].id\r\n                              const st = killerStates[pid]\r\n                              if (st && !st.eliminated && st.lives > 0) { next = idx; break }\r\n                            }\r\n                            setKillerTurnIdx(next); setKillerDarts(0)\r\n                          }}>Next Player</button>\r\n                          <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>{\r\n                            // Reset Killer\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Reset</button>\r\n                        </div>\r\n                        {killerWinnerId && (\r\n                          <div className=\"mt-2 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Winner: {killerPlayers.find(p=>p.id===killerWinnerId)?.name} <button className=\"ml-2 underline\" onClick={()=>{\r\n                            setKillerStates({}); setKillerAssigned({}); setKillerSetupDone(false); setKillerTurnIdx(0); setKillerDarts(0); setKillerWinnerId(null); setKillerLastEvent('')\r\n                          }}>Play Again</button></div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            ) : isPlayerTurn ? (\r\n              <div className=\"space-y-2\">\r\n                {/* Scorecard for X01 */}\r\n                {/* Unified Game Scoreboard */}\r\n                {(selectedMode as any) === 'X01' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"X01\"\r\n                      players={statsX01}\r\n                      matchScore={`${playerLegs}-${aiLegs}`}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for X01 auto-scoring */}\r\n                {(selectedMode as any) === 'X01' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring) => {\r\n                        // For X01, apply the dart value directly\r\n                        if (value > 0) applyDartValue(value)\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Cricket' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Cricket\"\r\n                      players={statsCricket}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Cricket auto-scoring */}\r\n                {(selectedMode as any) === 'Cricket' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addCricketAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Shanghai' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Shanghai\"\r\n                      players={statsShanghai}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Shanghai auto-scoring */}\r\n                {(selectedMode as any) === 'Shanghai' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          const r = ring === 'MISS' ? undefined : ring\r\n                          addShanghaiAuto(value, r as any, info?.sector ?? null)\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Killer' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Killer\"\r\n                      players={statsKiller}\r\n                    />\r\n                  </>\r\n                )}\r\n                {(selectedMode as any) === 'Scam' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Scam\"\r\n                      players={statsScam}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Scam auto-scoring */}\r\n                {(selectedMode as any) === 'Scam' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setScamPlayer(addScamAuto(scamPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Fives' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Fives\"\r\n                      players={statsFives}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Fives auto-scoring */}\r\n                {(selectedMode as any) === 'Fives' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setFivesPlayer(addFivesAuto(fivesPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                {(selectedMode as any) === 'Sevens' && (\r\n                  <>\r\n                    <GameScoreboard\r\n                      gameMode=\"Sevens\"\r\n                      players={statsSevens}\r\n                    />\r\n                  </>\r\n                )}\r\n                {/* Camera view for Sevens auto-scoring */}\r\n                {(selectedMode as any) === 'Sevens' && cameraEnabled && (\r\n                  <div className=\"rounded-2xl overflow-hidden bg-black\">\r\n                    <CameraView\r\n                      scoringMode=\"custom\"\r\n                      showToolbar={false}\r\n                      immediateAutoCommit\r\n                      onAutoDart={(value, ring, info) => {\r\n                        if (value > 0) {\r\n                          setSevensPlayer(addSevensAuto(sevensPlayer, value, ring as any))\r\n                        }\r\n                      }}\r\n                    />\r\n                  </div>\r\n                )}\r\n                <div className=\"font-semibold\">Your Turn</div>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-24\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={60}\r\n                      value={playerDartPoints}\r\n                      onChange={e => setPlayerDartPoints(Number(e.target.value||0))}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLast() : addDartNumeric()) }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addDartNumeric} title=\"Add a single dart (0–60)\">Add Dart</button>\r\n                  </div>\r\n                  {/* Visit total entry */}\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-28\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      max={180}\r\n                      placeholder=\"Visit total (0–180)\"\r\n                      value={visitTotalInput}\r\n                      onChange={e=>setVisitTotalInput(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') addVisitTotal() }}\r\n                    />\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addVisitTotal} title=\"Commit a full 3-dart total like 93\">Commit Visit</button>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      className=\"input w-44\"\r\n                      placeholder=\"Manual (T20, D16, 5, 25, 50)\"\r\n                      value={manualBox}\r\n                      onChange={e=>setManualBox(e.target.value)}\r\n                      onKeyDown={e => { if (e.key==='Enter') (e.shiftKey? replaceLastManual() : addManual()) }}\r\n                    />\r\n                    <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={replaceLastManual} disabled={playerVisitDarts===0}>Replace Last</button>\r\n                    <button className=\"btn px-3 py-1 text-sm\" onClick={addManual}>Add</button>\r\n                  </div>\r\n                  <div>\r\n                    <textarea\r\n                      className=\"input w-full h-24 resize-none\"\r\n                      placeholder=\"Type scores manually (one per line, e.g. T20&#10;D16&#10;5&#10;25&#10;50) - No camera needed!\"\r\n                      value={manualTextarea}\r\n                      onChange={e=>setManualTextarea(e.target.value)}\r\n                    />\r\n                    <div className=\"flex gap-2 mt-1\">\r\n                      <button className=\"btn px-3 py-1 text-sm\" onClick={addManualTextarea}>Add All Scores</button>\r\n                      <button className=\"btn btn--ghost px-3 py-1 text-sm\" onClick={() => setManualTextarea('')}>Clear</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-xs text-slate-300\">Tip: Enter to Add · Shift+Enter to Replace Last</div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"font-semibold\">{ai === 'None' ? 'Opponent' : `${ai} AI`} Turn</div>\r\n                {ai !== 'None' ? (\r\n                  <div className=\"text-sm text-slate-300\">Throwing in {Math.ceil(aiCountdownMs/1000)}s...</div>\r\n                ) : (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button className=\"btn\" onClick={() => setIsPlayerTurn(true)}>Switch Back to You</button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"h-1\" />\r\n              </div>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showRules && <X01RulesPopup onClose={() => setShowRules(false)} />}\r\n      {/* Frosted overlay when selecting premium mode without access */}\r\n      {lockedPremium && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">🔒</div>\r\n            <div className=\"font-semibold\">Premium mode locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">Upgrade to PREMIUM to play modes like Killer, Cricket, Shanghai, and more.</div>\r\n            <button\r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  });\r\n                  const data = await res.json();\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url;\r\n                    if (data.development) {\r\n                      toast(\"Opened Stripe test checkout (development mode)\", { type: 'info', timeout: 3000 });\r\n                    }\r\n                  } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                    toast(\"Premium purchases are not available in this development environment. Please visit the production site to upgrade.\", { type: 'error', timeout: 4000 });\r\n                  } else {\r\n                    toast(\"Failed to create checkout session. Please try again.\", { type: 'error', timeout: 4000 });\r\n                  }\r\n                } catch (err) {\r\n                  toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM · {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n        {showWinPopup && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-win\" className=\"w-full relative\" defaultWidth={420} defaultHeight={360} minWidth={360} minHeight={300} maxWidth={800} maxHeight={700} initialFitHeight>\r\n            <h3 className=\"text-lg font-bold mb-2\">Leg Won!</h3>\r\n            <label className=\"block mb-1\">Darts to hit double:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${doubleDarts===n?'bg-brand-600':''}`} onClick={()=>setDoubleDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <label className=\"block mb-1\">Darts for checkout:</label>\r\n            <div className=\"flex gap-2 mb-2\">\r\n              {[1,2,3].map(n => (\r\n                <button key={n} className={`btn ${checkoutDarts===n?'bg-brand-600':''}`} onClick={()=>setCheckoutDarts(n)}>{n}</button>\r\n              ))}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2 mt-2\">\r\n              <button className=\"btn w-full\" onClick={handleWinPopupSubmit}>Submit</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700 w-full\" onClick={() => { setShowWinPopup(false); startMatch(); }}>Rematch</button>\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800 w-full\" onClick={() => { setShowWinPopup(false); setShowMatchModal(false); setInMatch(false); }}>Back to Menu</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {showMatchSummary && (\r\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]\">\r\n          <ResizableModal storageKey=\"ndn:modal:offline-summary\" className=\"w-full relative\" defaultWidth={820} defaultHeight={520} minWidth={600} minHeight={400} maxWidth={1400} maxHeight={1000} initialFitHeight>\r\n            <h3 className=\"text-xl font-extrabold mb-2\">Match Summary</h3>\r\n            <div className=\"text-xs opacity-80 mb-3\">{selectedMode} · {x01Score} start · First to {firstTo}</div>\r\n            {(() => {\r\n              const player3da = totalPlayerDarts>0 ? ((totalPlayerPoints/totalPlayerDarts)*3) : 0\r\n              const player9da = player3da * 3\r\n              const playerBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const playerWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='player' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const playerPct = playerDoublesAtt>0 ? Math.round((playerDoublesHit/playerDoublesAtt)*100) : 0\r\n\r\n              const ai3da = totalAiDarts>0 ? ((totalAiPoints/totalAiDarts)*3) : 0\r\n              const ai9da = ai3da * 3\r\n              const aiBest = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.min(...darts)} darts`\r\n              })()\r\n              const aiWorst = (() => {\r\n                const darts = legStats.filter(l=>l.winner==='ai' && typeof l.winnerDarts==='number').map(l=>l.winnerDarts)\r\n                if (!darts.length) return '—'\r\n                return `${Math.max(...darts)} darts`\r\n              })()\r\n              const aiPct = aiDoublesAtt>0 ? Math.round((aiDoublesHit/aiDoublesAtt)*100) : 0\r\n\r\n              return (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{user?.username || 'You'}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{playerLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{player3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{player9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{playerDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{playerPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{playerBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{playerWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{player180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"hidden md:flex items-center justify-center\">\r\n                    <div className=\"text-4xl font-black\">{playerLegs} – {aiLegs}</div>\r\n                  </div>\r\n                  <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n                    <div className=\"text-sm font-semibold mb-1\">{ai==='None' ? 'Opponent' : `${ai} AI`}</div>\r\n                    <div className=\"text-3xl font-extrabold\">{aiLegs}</div>\r\n                    <div className=\"text-xs opacity-80\">Legs Won</div>\r\n                    <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                      <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{ai3da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{ai9da.toFixed(1)}</div></div>\r\n                      <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{aiDoublesAtt}</div></div>\r\n                      <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{aiPct}%</div></div>\r\n                      <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{aiBest}</div></div>\r\n                      <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{aiWorst}</div></div>\r\n                      <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{ai180s}</div></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            })()}\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Legs Timeline</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {legStats.map((leg, i) => (\r\n                  <div key={i} className={`px-3 py-1 rounded-full border text-xs ${leg.winner==='player' ? 'bg-emerald-500/15 border-emerald-400/30' : 'bg-fuchsia-500/15 border-fuchsia-400/30'}`}>\r\n                    Leg {i+1}: {leg.winner==='player' ? 'You' : (ai==='None'?'Opp':'AI')} · Dbl {leg.doubleDarts} · CO {leg.checkoutDarts}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm font-semibold mb-2\">Shot Heat Map</div>\r\n              <div className=\"rounded-2xl overflow-hidden bg-black p-3\">\r\n                {/* Lazy-load HeatMap component to avoid increasing initial bundle too much */}\r\n                <HeatMap />\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n              <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => setShowMatchSummary(false)}>Close</button>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={() => { setShowMatchSummary(false); startMatch(); }}>Rematch</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      {legStats.length > 0 && (\r\n        <div className=\"mt-4\">\r\n          <h4 className=\"font-semibold mb-2\">Leg Stats</h4>\r\n          <ul>\r\n            {legStats.map((leg, i) => (\r\n              <li key={i}>Leg {i+1}: Double darts: {leg.doubleDarts}, Checkout darts: {leg.checkoutDarts}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      \r\n  {/* Phone camera overlay removed per UX preference; use header badge preview only */}\r\n      </div>\r\n    </div>\r\n  );\r\n}","import { create } from 'zustand'\r\n\r\nexport type DM = { id: string; from: string; message: string; ts: number }\r\n\r\ntype MessagesState = {\r\n  inbox: DM[]\r\n  unread: number\r\n  inGame: boolean\r\n  setInGame: (v: boolean) => void\r\n  add: (m: DM) => void\r\n  load: (arr: DM[]) => void\r\n  markAllRead: () => void\r\n  remove: (id: string) => void\r\n}\r\n\r\nconst LS_INBOX = 'ndn:messages:inbox'\r\nconst LS_UNREAD = 'ndn:messages:unread'\r\n\r\nfunction loadInitial() {\r\n  try {\r\n    const raw = localStorage.getItem(LS_INBOX)\r\n    const arr = raw ? JSON.parse(raw) as DM[] : []\r\n    const unread = Number(localStorage.getItem(LS_UNREAD) || '0') || 0\r\n    // sanitize\r\n    const inbox = Array.isArray(arr) ? arr.filter(m => m && typeof m.id==='string').slice(0,200) : []\r\n    return { inbox, unread }\r\n  } catch { return { inbox: [], unread: 0 } }\r\n}\r\n\r\nfunction save(inbox: DM[], unread: number) {\r\n  try { localStorage.setItem(LS_INBOX, JSON.stringify(inbox)) } catch {}\r\n  try { localStorage.setItem(LS_UNREAD, String(unread)) } catch {}\r\n}\r\n\r\nconst initial = loadInitial()\r\n\r\nexport const useMessages = create<MessagesState>((set, get) => ({\r\n  inbox: initial.inbox,\r\n  unread: initial.unread,\r\n  inGame: false,\r\n  setInGame: (v) => set({ inGame: v }),\r\n  add: (m) => set((s) => {\r\n    const exists = s.inbox.some(x => x.id === m.id && x.ts === m.ts)\r\n    const list = exists ? s.inbox : [m, ...s.inbox].slice(0, 200)\r\n    const unread = s.unread + (exists ? 0 : 1)\r\n    save(list, unread)\r\n    return { inbox: list, unread }\r\n  }),\r\n  load: (arr) => set((s) => {\r\n    const sorted = [...arr].sort((a,b)=>b.ts-a.ts).slice(0,200)\r\n    save(sorted, s.unread)\r\n    return { inbox: sorted, unread: s.unread }\r\n  }),\r\n  markAllRead: () => { const s = get(); save(s.inbox, 0); set({ unread: 0 }) },\r\n  remove: (id) => set((s) => {\r\n    const list = s.inbox.filter(m => m.id !== id)\r\n    const unread = s.unread // keep unread count stable on deletion from history\r\n    save(list, unread)\r\n    return { inbox: list, unread }\r\n  }),\r\n}))\r\n","// Simple profanity filter: replaces detected profane words with asterisks of the same length.\r\n// Note: This is a lightweight heuristic and not exhaustive.\r\n\r\nconst patterns: RegExp[] = [\r\n  /\\b(f+[\\W_]*u+[\\W_]*c+[\\W_]*k+)\\b/gi,\r\n  /\\b(s+[\\W_]*h+[\\W_]*i+[\\W_]*t+)\\b/gi,\r\n  /\\b(b+[\\W_]*i+[\\W_]*t+[\\W_]*c+[\\W_]*h+)\\b/gi,\r\n  /\\b(a+[\\W_]*s+[\\W_]*s+[\\W_]*h+[\\W_]*o+[\\W_]*l+[\\W_]*e+)\\b/gi,\r\n  /\\b(d+[\\W_]*a+[\\W_]*m+[\\W_]*n+)\\b/gi,\r\n  /\\b(c+[\\W_]*r+[\\W_]*a+[\\W_]*p+)\\b/gi,\r\n  /\\b(p+[\\W_]*i+[\\W_]*s+[\\W_]*s+)\\b/gi,\r\n]\r\n\r\nfunction starify(match: string) {\r\n  // Preserve whitespace/punct positions; just replace letters/numbers with *\r\n  return match.replace(/[\\p{L}\\p{N}]/gu, '*')\r\n}\r\n\r\nexport function censorProfanity(input: string): string {\r\n  if (!input) return input\r\n  let out = input\r\n  for (const re of patterns) {\r\n    out = out.replace(re, (m) => starify(m))\r\n  }\r\n  return out\r\n}\r\n\r\nexport function containsProfanity(input: string): boolean {\r\n  if (!input) return false\r\n  return patterns.some((re) => re.test(input))\r\n}\r\n","import React from 'react'\r\n\r\ntype Tab = { key: string; label: string }\r\n\r\nexport default function TabPills({\r\n  tabs,\r\n  active,\r\n  onChange,\r\n  className,\r\n}: {\r\n  tabs: Tab[];\r\n  active: string;\r\n  onChange: (key: string) => void;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={`relative ${className || ''}`}>\r\n      {/* subtle backdrop and border for contrast on mobile */}\r\n      <div className=\"absolute inset-0 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 pointer-events-none\" />\r\n      <div className=\"relative overflow-x-auto no-scrollbar py-1 px-1\">\r\n        <div className=\"flex items-center gap-2 min-w-max\">\r\n          {tabs.map((t) => {\r\n            const isActive = t.key === active\r\n            return (\r\n              <button\r\n                key={t.key}\r\n                type=\"button\"\r\n                onClick={() => onChange(t.key)}\r\n                className={`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98]\r\n                  ${isActive\r\n                    ? 'bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white shadow-indigo-500/30'\r\n                    : 'bg-white/10 text-slate-100 hover:bg-white/15'}\r\n                `}\r\n                aria-pressed={isActive}\r\n              >\r\n                {t.label}\r\n              </button>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n      <style>{`\r\n        /* Hide scrollbars on WebKit/Firefox for a cleaner pill row */\r\n        .no-scrollbar::-webkit-scrollbar { display: none; }\r\n        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\r\n      `}</style>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport { useToast } from '../store/toast'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity } from '../utils/profanity'\r\nimport TabPills from './ui/TabPills'\r\n\r\ntype Friend = { email: string, username?: string, status?: 'online'|'offline'|'ingame', lastSeen?: number, roomId?: string|null, match?: { game: string, mode: string, value: number, startingScore?: number } | null }\r\n\r\nfunction timeAgo(ts?: number) {\r\n  if (!ts) return ''\r\n  const s = Math.floor((Date.now() - ts) / 1000)\r\n  if (s < 60) return `${s}s ago`\r\n  const m = Math.floor(s/60)\r\n  if (m < 60) return `${m}m ago`\r\n  const h = Math.floor(m/60)\r\n  if (h < 24) return `${h}h ago`\r\n  const d = Math.floor(h/24)\r\n  return `${d}d ago`\r\n}\r\n\r\nexport default function Friends({ user }: { user?: any }) {\r\n  const toast = useToast()\r\n  const email = String(user?.email || '').toLowerCase()\r\n  const [friends, setFriends] = useState<Friend[]>([])\r\n  const [suggested, setSuggested] = useState<Friend[]>([])\r\n  const [results, setResults] = useState<Friend[]>([])\r\n  const [q, setQ] = useState('')\r\n  const [filter, setFilter] = useState<'all'|'online'|'offline'|'ingame'|'requests'>('all')\r\n  const [loading, setLoading] = useState(false)\r\n  const msgs = useMessages()\r\n  const [requests, setRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [outgoingRequests, setOutgoingRequests] = useState<Array<{ id: string; fromEmail: string; fromUsername: string; toEmail: string; toUsername: string; requestedAt: number }>>([])\r\n  const [messagePopup, setMessagePopup] = useState<{ show: boolean; toUser?: string; toEmail?: string; replyTo?: string }>({ show: false })\r\n\r\n  async function refresh() {\r\n    if (!email) return\r\n    try {\r\n      const [fl, sg, rq, out] = await Promise.all([\r\n        fetch(`/api/friends/list?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/suggested?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/requests?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n        fetch(`/api/friends/outgoing?email=${encodeURIComponent(email)}`).then(r=>r.json()),\r\n      ])\r\n      setFriends(fl.friends || [])\r\n      setSuggested(sg.suggestions || [])\r\n      setRequests(rq.requests || [])\r\n      setOutgoingRequests(out.requests || [])\r\n    } catch {}\r\n  }\r\n\r\n  useEffect(() => { refresh() }, [email])\r\n\r\n  async function search(term: string) {\r\n    setQ(term)\r\n    if (!term) { setResults([]); return }\r\n    try {\r\n      const res = await fetch(`/api/friends/search?q=${encodeURIComponent(term)}`)\r\n      const data = await res.json()\r\n      setResults(data.results || [])\r\n    } catch {}\r\n  }\r\n\r\n  async function addFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      setQ(''); setResults([])\r\n      toast('Friend added', { type: 'success' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function removeFriend(target: string) {\r\n    if (!email || !target) return\r\n    setLoading(true)\r\n    try {\r\n      await fetch('/api/friends/remove', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, friend: target }) })\r\n      await refresh()\r\n      toast('Friend removed', { type: 'info' })\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  const filtered = useMemo(() => {\r\n    if (filter === 'all') return friends\r\n    return friends.filter(f => (f.status || 'offline') === filter)\r\n  }, [friends, filter])\r\n\r\n  async function spectate(roomId?: string|null) {\r\n    if (!roomId) { toast('Room unavailable', { type: 'error' }); return }\r\n    try {\r\n      const ev = new CustomEvent('ndn:spectate-request', { detail: { roomId } })\r\n      window.dispatchEvent(ev)\r\n      toast('Opening spectator view…', { type: 'info' })\r\n    } catch {}\r\n  }\r\n\r\n  // Friend Requests pill: use real requests data\r\n  const requestsCount = requests.length + outgoingRequests.length;\r\n  return (\r\n    <div className=\"card ndn-game-shell\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Friends</h2>\r\n      <p className=\"mb-2 text-brand-600\">Manage your friends. See who’s online, in-game, or offline; find new teammates; and invite people to play.</p>\r\n      <div className=\"text-xs opacity-70 mb-3\">Online: {friends.filter(f=>f.status==='online').length} · In-game: {friends.filter(f=>f.status==='ingame').length} · Offline: {friends.filter(f=>!f.status || f.status==='offline').length}</div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4\">\r\n        <div className=\"md:col-span-2 p-3 rounded-2xl bg-black/30 border border-white/10\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"font-semibold text-white/90\">Your Friends</div>\r\n          </div>\r\n          <TabPills\r\n            tabs={[\r\n              { key: 'all', label: 'All' },\r\n              { key: 'online', label: 'Online' },\r\n              { key: 'ingame', label: 'In-Game' },\r\n              { key: 'offline', label: 'Offline' },\r\n              { key: 'requests', label: `Requests ${requestsCount > 0 ? '(' + requestsCount + ')' : ''}` },\r\n            ]}\r\n            active={filter}\r\n            onChange={(k)=>setFilter(k as any)}\r\n            className=\"mb-3\"\r\n          />\r\n          {filter === 'requests' ? (\r\n            <ul className=\"space-y-2\">\r\n              {requestsCount > 0 ? (\r\n                <>\r\n                  {/* Incoming requests */}\r\n                  {requests.length > 0 && requests.map(r => (\r\n                    <li key={`incoming-${r.id || r.fromEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.fromUsername || r.fromEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded\">Incoming</span>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/accept', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests and add to friends immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Add to friends list (we'll get the full data on next refresh, but show basic info now)\r\n                              const newFriend = { email: r.fromEmail, username: r.fromUsername, status: 'offline' as const }\r\n                              setFriends(prev => [...prev, newFriend])\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request accepted', { type: 'success' })\r\n                              // Refresh in background to get complete data\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to accept request', { type: 'error' })\r\n                            }\r\n                          } catch (error) {\r\n                            toast('Error accepting request', { type: 'error' })\r\n                          } finally { setLoading(false) }\r\n                        }}>Accept</button>\r\n                        <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={async()=>{\r\n                          setLoading(true)\r\n                          try {\r\n                            const res = await fetch('/api/friends/decline', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, requester: r.fromEmail }) })\r\n                            if (res.ok) {\r\n                              // Remove from requests immediately for better UX\r\n                              setRequests(prev => prev.filter(req => req.id !== r.id))\r\n                              // Also remove from outgoing if it exists\r\n                              setOutgoingRequests(prev => prev.filter(req => req.toEmail !== r.fromEmail))\r\n                              toast('Friend request declined', { type: 'info' })\r\n                              // Refresh in background to ensure consistency\r\n                              setTimeout(() => refresh(), 100)\r\n                            } else {\r\n                              toast('Failed to decline request', { type: 'error' })\r\n                            }\r\n                          } finally { setLoading(false) }\r\n                        }}>Decline</button>\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n                  {/* Outgoing requests */}\r\n                  {outgoingRequests.length > 0 && outgoingRequests.map(r => (\r\n                    <li key={`outgoing-${r.id || r.toEmail}`} className=\"p-3 rounded bg-black/20 flex flex-col gap-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-semibold text-lg\">{r.toUsername || r.toEmail || 'Unknown User'}</span>\r\n                        <span className=\"text-xs bg-amber-600/20 text-amber-400 px-2 py-1 rounded\">Pending</span>\r\n                      </div>\r\n                      <button className=\"btn bg-slate-600 hover:bg-slate-700 self-start\" onClick={async()=>{\r\n                        setLoading(true)\r\n                        try {\r\n                          const res = await fetch('/api/friends/cancel', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, friend: r.toEmail }) })\r\n                          if (res.ok) {\r\n                            // Remove from outgoing requests immediately for better UX\r\n                            setOutgoingRequests(prev => prev.filter(req => req.id !== r.id))\r\n                            toast('Friend request cancelled', { type: 'info' })\r\n                            // Refresh in background to ensure consistency\r\n                            setTimeout(() => refresh(), 100)\r\n                          } else {\r\n                            toast('Failed to cancel request', { type: 'error' })\r\n                          }\r\n                        } finally { setLoading(false) }\r\n                      }}>Cancel</button>\r\n                    </li>\r\n                  ))}\r\n                </>\r\n              ) : (\r\n                <li className=\"text-sm opacity-70\">No friend requests yet.</li>\r\n              )}\r\n            </ul>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {filtered.map(f => (\r\n                <li key={f.email} className=\"p-2 rounded bg-black/20 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className={`inline-block w-2 h-2 rounded-full ${f.status==='online'?'bg-emerald-400':f.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                    <span className=\"font-semibold\">{f.username || f.email}</span>\r\n                    <span className=\"text-xs opacity-70\">{f.status || 'offline'}{(f.status!=='online' && f.lastSeen) ? ` · ${timeAgo(f.lastSeen)}` : ''}</span>\r\n                    {f.status==='ingame' && f.match && (\r\n                      <span className=\"text-[10px] opacity-70 px-2 py-0.5 rounded bg-indigo-500/20 border border-indigo-600/30\">{f.match.game} {f.match.mode==='firstto'?'FT':'BO'} {f.match.value}{f.match.game==='X01' && f.match.startingScore ? ` · ${f.match.startingScore}`:''}</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {f.status==='ingame' && f.roomId && (\r\n                      <button className=\"btn\" onClick={()=>spectate(f.roomId!)}>Spectate</button>\r\n                    )}\r\n                    <button className=\"btn\" disabled={loading || (f.status!=='online' && f.status!=='ingame')} onClick={async()=>{\r\n                      setLoading(true)\r\n                      try {\r\n                        const res = await fetch('/api/friends/invite', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ fromEmail: email, toEmail: f.email, game: 'X01', mode: 'bestof', value: 3, startingScore: 501 }) })\r\n                        const data = await res.json().catch(()=>({}))\r\n                        if (data?.delivered) toast('Invite sent', { type: 'success' })\r\n                        else toast('Friend is offline; invite queued', { type: 'info' })\r\n                      } finally { setLoading(false) }\r\n                    }}>Invite</button>\r\n                    <button className=\"btn\" disabled={loading} onClick={()=>setMessagePopup({ show: true, toUser: f.username || f.email, toEmail: f.email })}>Message</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>removeFriend(f.email)}>Remove</button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {filtered.length === 0 && (\r\n                <li className=\"text-sm opacity-70\">No friends {filter !== 'all' ? `in ${filter}` : ''} yet.</li>\r\n              )}\r\n            </ul>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 rounded-2xl bg-black/20 border border-white/10\">\r\n          <div className=\"font-semibold mb-2 text-white/90\">Find Friends</div>\r\n          <input className=\"input w-full mb-2\" placeholder=\"Search by name or email\" value={q} onChange={e=>search(e.target.value)} />\r\n          <ul className=\"space-y-1 mb-3 max-h-48 overflow-auto\">\r\n            {results.map(r => (\r\n              <li key={r.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${r.status==='online'?'bg-emerald-400':r.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{r.username || r.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(r.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {results.length === 0 && <li className=\"text-xs opacity-60\">Type to search…</li>}\r\n          </ul>\r\n          <div className=\"font-semibold mb-1 text-white/90\">Suggested</div>\r\n          <ul className=\"space-y-1 max-h-48 overflow-auto\">\r\n            {suggested.map(s => (\r\n              <li key={s.email} className=\"flex items-center justify-between p-2 rounded bg-black/10\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className={`inline-block w-2 h-2 rounded-full ${s.status==='online'?'bg-emerald-400':s.status==='ingame'?'bg-amber-400':'bg-slate-400'}`}></span>\r\n                  <span>{s.username || s.email}</span>\r\n                </div>\r\n                <button className=\"btn\" disabled={loading} onClick={()=>addFriend(s.email)}>Add</button>\r\n              </li>\r\n            ))}\r\n            {suggested.length === 0 && <li className=\"text-xs opacity-60\">No suggestions right now.</li>}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Direct Messages */}\r\n      <div className=\"p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <div className=\"font-semibold\">Messages</div>\r\n          <button className=\"btn px-3 py-1 text-sm\" onClick={()=>msgs.markAllRead()}>Mark all read</button>\r\n        </div>\r\n        {msgs.inbox.length === 0 ? (\r\n          <div className=\"text-sm opacity-70\">No messages yet.</div>\r\n        ) : (\r\n          <ul className=\"space-y-2 max-h-72 overflow-auto\">\r\n            {msgs.inbox.map(m => (\r\n              <li key={m.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div><span className=\"font-semibold\">{m.from}</span> <span className=\"opacity-70 text-xs\">· {new Date(m.ts).toLocaleString()}</span></div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button className=\"btn px-2 py-1 text-xs\" onClick={()=>setMessagePopup({ show: true, toUser: m.from, toEmail: m.from, replyTo: m.from })}>Reply</button>\r\n                    <button className=\"btn bg-slate-700 hover:bg-slate-800 px-2 py-1 text-xs\" title=\"Delete this message\" onClick={()=>msgs.remove(m.id)}>Delete</button>\r\n                    <button className=\"btn bg-rose-600 hover:bg-rose-700 px-2 py-1 text-xs\" onClick={async()=>{\r\n                      const reason = prompt('Report reason (what happened)?')\r\n                      if (!reason) return\r\n                      try {\r\n                        await fetch('/api/friends/report', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ reporterEmail: email, offenderEmail: m.from, reason, messageId: m.id }) })\r\n                        toast('Report sent to admin', { type: 'info' })\r\n                      } catch {}\r\n                    }}>Report</button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"mt-1 whitespace-pre-wrap break-words\">{censorProfanity(m.message)}</div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </div>\r\n\r\n      {/* Message Popup */}\r\n      {messagePopup.show && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4\">\r\n            <div className=\"text-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-white\">\r\n                Type Message To {messagePopup.toUser}\r\n              </h3>\r\n            </div>\r\n            <textarea\r\n              className=\"w-full h-32 bg-slate-700 border border-slate-600 rounded p-3 text-white placeholder-slate-400 resize-none\"\r\n              placeholder=\"Type your message here...\"\r\n              id=\"message-input\"\r\n              autoFocus\r\n            />\r\n            <div className=\"flex gap-3 mt-4\">\r\n              <button\r\n                className=\"flex-1 btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async () => {\r\n                  const input = document.getElementById('message-input') as HTMLTextAreaElement\r\n                  const message = input?.value?.trim()\r\n                  if (!message) return\r\n\r\n                  setLoading(true)\r\n                  try {\r\n                    await fetch('/api/friends/message', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify({\r\n                        fromEmail: email,\r\n                        toEmail: messagePopup.toEmail,\r\n                        message\r\n                      })\r\n                    })\r\n                    toast('Message sent', { type: 'success' })\r\n                    setMessagePopup({ show: false })\r\n                  } catch (error) {\r\n                    toast('Failed to send message', { type: 'error' })\r\n                  } finally {\r\n                    setLoading(false)\r\n                  }\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                Send\r\n              </button>\r\n              <button\r\n                className=\"flex-1 btn bg-slate-600 hover:bg-slate-700\"\r\n                onClick={() => setMessagePopup({ show: false })}\r\n              >\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}","import { useToastStore } from '../store/toast'\r\n\r\nexport default function Toaster() {\r\n  const toasts = useToastStore(s => s.toasts)\r\n  const remove = useToastStore(s => s.remove)\r\n  if (!toasts.length) return null\r\n  return (\r\n    <>\r\n      {/* Success messages centered */}\r\n      {toasts.filter(t => t.type === 'success').map(t => (\r\n        <div key={t.id} className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50\">\r\n          <div className={`p-4 rounded-lg shadow-lg border text-sm bg-emerald-700/90 border-emerald-500/60 text-white max-w-sm text-center`}>\r\n            <div className=\"flex items-center justify-center gap-2\">\r\n              <span className=\"flex-1 font-semibold\">{t.message}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n      {/* Other messages bottom right */}\r\n      {toasts.filter(t => t.type !== 'success').length > 0 && (\r\n        <div className=\"fixed bottom-4 right-4 z-50 space-y-2 sm:right-4 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 w-[calc(100%-1.5rem)] sm:w-auto max-w-sm\">\r\n          {toasts.filter(t => t.type !== 'success').map(t => (\r\n            <div key={t.id} className={`p-3 rounded-lg shadow-lg border text-sm ${\r\n              t.type === 'error' ? 'bg-rose-700/80 border-rose-500/60 text-white' :\r\n              'bg-black/70 border-slate-700 text-slate-100'\r\n            }`}>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"flex-1\">{t.message}</span>\r\n                <button className=\"btn btn--ghost px-2 py-1 text-xs\" onClick={()=>remove(t.id)}>Dismiss</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\ntype Datum = { label: string | number; value: number }\r\n\r\nexport default function BarChart({\r\n  data,\r\n  height = 220,\r\n  barWidth = 28,\r\n  gap = 6,\r\n  showValues = false,\r\n}: {\r\n  data: Datum[]\r\n  height?: number\r\n  barWidth?: number\r\n  gap?: number\r\n  showValues?: boolean\r\n}) {\r\n  const max = Math.max(1, ...data.map(d => d.value))\r\n  const totalWidth = data.length * (barWidth + gap)\r\n  return (\r\n    <div className=\"w-full overflow-x-auto\">\r\n      <div className=\"relative\" style={{ height, width: Math.max(600, totalWidth) }}>\r\n        <div className=\"absolute inset-0 flex items-end\">\r\n          {data.map((d, i) => {\r\n            const h = Math.round((d.value / max) * (height - 40)) // leave room for labels\r\n            return (\r\n              <div key={i} className=\"flex flex-col items-center justify-end\" style={{ width: barWidth, marginRight: gap }}>\r\n                <div\r\n                  className=\"w-full rounded-t-md bg-gradient-to-b from-indigo-400 to-fuchsia-500 shadow-sm\"\r\n                  style={{ height: h }}\r\n                  title={`${d.label}: ${d.value}`}\r\n                />\r\n                {showValues && <div className=\"text-[10px] mt-1 text-indigo-200 font-semibold\">{d.value}</div>}\r\n                <div className=\"text-[10px] mt-1 text-slate-200 font-medium select-none\">{d.label}</div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import React, { createContext, useCallback, useContext, useEffect, useMemo, useRef, useState, type ReactNode } from 'react'\r\n\r\ntype WSMessage = any\r\n\r\ntype WSStatus = 'connecting' | 'connected' | 'disconnected'\r\ntype WSContextType = {\r\n  connected: boolean\r\n  status: WSStatus\r\n  send: (msg: WSMessage) => void\r\n  addListener: (fn: (data: WSMessage) => void) => () => void\r\n  reconnect: () => void\r\n}\r\n\r\nconst WSContext = createContext<WSContextType | null>(null)\r\n\r\nexport function WSProvider({ children }: { children: ReactNode }) {\r\n  const [connected, setConnected] = useState(false)\r\n  const [status, setStatus] = useState<WSStatus>('connecting')\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  const listenersRef = useRef(new Set<(data: WSMessage) => void>())\r\n  const shouldReconnectRef = useRef(true)\r\n  const attemptsRef = useRef(0)\r\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n  const heartbeatRef = useRef<ReturnType<typeof setInterval> | null>(null)\r\n\r\n  const endpointsRef = useRef<string[] | null>(null)\r\n  const endpointIdxRef = useRef(0)\r\n  const debug = false\r\n\r\n  const ensureEndpoints = () => {\r\n    if (endpointsRef.current) return endpointsRef.current\r\n    const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n    if (envUrl && envUrl.length > 0) {\r\n      const normalized = envUrl.endsWith('/ws') ? envUrl : envUrl.replace(/\\/$/, '') + '/ws'\r\n      endpointsRef.current = [normalized]\r\n      return endpointsRef.current\r\n    }\r\n    const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n    const host = window.location.hostname\r\n    const sameOrigin = `${proto}://${window.location.host}` // includes port if present\r\n    // Candidate endpoints: prefer same-origin first (works when server serves SPA),\r\n    // then common local ports for dev fallbacks.\r\n    const bases = [\r\n      sameOrigin + '/ws',\r\n      `${proto}://${host}/ws`,\r\n      `${proto}://${host}:8787/ws`,\r\n      `${proto}://${host}:3000/ws`,\r\n    ]\r\n    // Deduplicate\r\n    endpointsRef.current = Array.from(new Set(bases))\r\n    return endpointsRef.current\r\n  }\r\n\r\n  const rotateEndpoint = () => {\r\n    const eps = ensureEndpoints()\r\n    endpointIdxRef.current = (endpointIdxRef.current + 1) % eps.length\r\n    return eps[endpointIdxRef.current]\r\n  }\r\n\r\n  const currentEndpoint = () => {\r\n    const eps = ensureEndpoints()\r\n    return eps[endpointIdxRef.current] || eps[0]\r\n  }\r\n\r\n  const connect = useCallback(() => {\r\n    if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) return\r\n    setStatus('connecting')\r\n    const base = currentEndpoint()\r\n    const url = `${base}`\r\n    if (debug) console.log('[WS] connecting to', url)\r\n    const ws = new WebSocket(url)\r\n    wsRef.current = ws\r\n    ws.onopen = () => {\r\n      setConnected(true)\r\n      setStatus('connected')\r\n      attemptsRef.current = 0\r\n      // start heartbeat\r\n      if (heartbeatRef.current) clearInterval(heartbeatRef.current)\r\n      heartbeatRef.current = setInterval(() => {\r\n        try { wsRef.current?.readyState === WebSocket.OPEN && wsRef.current?.send(JSON.stringify({ type: 'ping', t: Date.now() })) } catch {}\r\n      }, 20000)\r\n      if (debug) console.log('[WS] connected')\r\n    }\r\n    ws.onmessage = (ev) => {\r\n      try {\r\n        const data = JSON.parse(ev.data)\r\n        listenersRef.current.forEach(fn => { try { fn(data) } catch {} })\r\n      } catch {}\r\n    }\r\n    ws.onerror = () => {\r\n      if (debug) console.log('[WS] socket error on', currentEndpoint())\r\n    }\r\n    ws.onclose = () => {\r\n      setConnected(false)\r\n      setStatus('disconnected')\r\n      if (heartbeatRef.current) { clearInterval(heartbeatRef.current); heartbeatRef.current = null }\r\n      if (!shouldReconnectRef.current) return\r\n      const attempt = (attemptsRef.current || 0) + 1\r\n      attemptsRef.current = attempt\r\n      // rotate endpoint every 2 failed attempts for broader coverage\r\n      if (attempt % 2 === 0) rotateEndpoint()\r\n      if (debug) console.log('[WS] closed. attempt', attempt, 'next endpoint', currentEndpoint())\r\n      const base = 1000 * Math.pow(2, attempt - 1)\r\n      const jitter = Math.floor(Math.random() * 1000)\r\n      let delay = Math.min(30000, base + jitter)\r\n      // First retry should be immediate for instant reconnect UX\r\n      if (attempt === 1) delay = 0\r\n      if (timerRef.current) clearTimeout(timerRef.current)\r\n      if (delay === 0) {\r\n        connect()\r\n      } else {\r\n        timerRef.current = setTimeout(connect, delay)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const reconnect = useCallback(() => {\r\n    try {\r\n      // Prevent auto-retry logic from racing while we recreate\r\n      shouldReconnectRef.current = false\r\n      if (timerRef.current) { clearTimeout(timerRef.current); timerRef.current = null }\r\n      if (heartbeatRef.current) { clearInterval(heartbeatRef.current); heartbeatRef.current = null }\r\n      try { wsRef.current?.close() } catch {}\r\n      wsRef.current = null\r\n    } catch {}\r\n    // Reset counters and allow reconnect\r\n    attemptsRef.current = 0\r\n    shouldReconnectRef.current = true\r\n    setStatus('connecting')\r\n    setConnected(false)\r\n    // Attempt immediate connect\r\n    connect()\r\n  }, [connect])\r\n\r\n  useEffect(() => {\r\n    shouldReconnectRef.current = true\r\n    connect()\r\n    const beforeUnload = () => {\r\n      shouldReconnectRef.current = false\r\n      try { wsRef.current?.close() } catch {}\r\n    }\r\n    window.addEventListener('beforeunload', beforeUnload)\r\n    const onVis = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        // nudge reconnect if needed\r\n        if (!connected) connect()\r\n      }\r\n    }\r\n    document.addEventListener('visibilitychange', onVis)\r\n    window.addEventListener('online', connect)\r\n    return () => {\r\n      shouldReconnectRef.current = false\r\n      if (timerRef.current) clearTimeout(timerRef.current)\r\n      if (heartbeatRef.current) clearInterval(heartbeatRef.current)\r\n      try { wsRef.current?.close() } catch {}\r\n      document.removeEventListener('visibilitychange', onVis)\r\n      window.removeEventListener('online', connect)\r\n      window.removeEventListener('beforeunload', beforeUnload)\r\n    }\r\n  }, [connect])\r\n\r\n  const send = useCallback((msg: WSMessage) => {\r\n    try {\r\n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(typeof msg === 'string' ? msg : JSON.stringify(msg))\r\n      }\r\n    } catch {}\r\n  }, [])\r\n\r\n  const addListener = useCallback((fn: (data: WSMessage) => void) => {\r\n    listenersRef.current.add(fn)\r\n    return () => { listenersRef.current.delete(fn) }\r\n  }, [])\r\n\r\n  const value = useMemo(() => ({ connected, status, send, addListener, reconnect }), [connected, status, send, addListener, reconnect])\r\n  return <WSContext.Provider value={value}>{children}</WSContext.Provider>\r\n}\r\n\r\nexport function useWS() {\r\n  const ctx = useContext(WSContext)\r\n  if (!ctx) throw new Error('useWS must be used within WSProvider')\r\n  return ctx\r\n}\r\n","import React from 'react'\r\n\r\ntype Props = {\r\n  status: 'connecting' | 'connected' | 'disconnected'\r\n  title?: string\r\n  size?: number // pixels, defaults to 12\r\n}\r\n\r\nexport default function StatusDot({ status, title, size = 12 }: Props) {\r\n  const s = size\r\n  if (status === 'connecting') {\r\n    return (\r\n      <span\r\n        role=\"img\"\r\n        aria-label=\"Connecting\"\r\n        title={title || 'Connecting…'}\r\n        className=\"inline-flex items-center justify-center\"\r\n        style={{ width: s, height: s }}\r\n      >\r\n        <svg\r\n          width={s}\r\n          height={s}\r\n          viewBox=\"0 0 24 24\"\r\n          className=\"animate-spin\"\r\n          aria-hidden=\"true\"\r\n        >\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"#A7F3D0\" strokeWidth=\"3\" fill=\"none\" opacity=\"0.35\" />\r\n          <path d=\"M22 12a10 10 0 0 0-10-10\" stroke=\"#34D399\" strokeWidth=\"3\" strokeLinecap=\"round\" fill=\"none\" />\r\n        </svg>\r\n      </span>\r\n    )\r\n  }\r\n  if (status === 'connected') {\r\n    return (\r\n      <span\r\n        role=\"img\"\r\n        aria-label=\"Connected\"\r\n        title={title || 'Connected'}\r\n        className=\"inline-flex items-center justify-center\"\r\n        style={{ width: s, height: s }}\r\n      >\r\n        <svg width={s} height={s} viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#34D399\" />\r\n        </svg>\r\n      </span>\r\n    )\r\n  }\r\n  return (\r\n    <span\r\n      role=\"img\"\r\n      aria-label=\"Disconnected\"\r\n      title={title || 'Not connected'}\r\n      className=\"inline-flex items-center justify-center\"\r\n      style={{ width: s, height: s }}\r\n    >\r\n      <svg width={s} height={s} viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n        <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#F87171\" opacity=\"0.15\" />\r\n        <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#F87171\" strokeWidth=\"2\" fill=\"none\" />\r\n        <rect x=\"6\" y=\"11\" width=\"12\" height=\"2\" rx=\"1\" fill=\"#F87171\" />\r\n      </svg>\r\n    </span>\r\n  )\r\n}\r\n","import { useEffect, useRef } from 'react'\r\nimport { useCameraSession } from '../store/cameraSession'\r\n\r\n/**\r\n * CameraStatusBadge\r\n * A compact, always-visible header badge that shows a live thumbnail of the phone camera\r\n * when streaming, with a green tick overlay. Clicking toggles the global phone overlay.\r\n */\r\nexport default function CameraStatusBadge() {\r\n  const camera = useCameraSession()\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null)\r\n  const rafRef = useRef<number | null>(null)\r\n\r\n  const streaming = camera.isStreaming && camera.mode === 'phone'\r\n  const videoEl = camera.getVideoElementRef()\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current\r\n    if (!canvas) return\r\n\r\n    let running = true\r\n    const ctx = canvas.getContext('2d')\r\n    if (!ctx) return\r\n\r\n    const render = () => {\r\n      if (!running) return\r\n      try {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n        if (streaming && videoEl && (videoEl.readyState >= 2)) {\r\n          const vw = videoEl.videoWidth || 640\r\n          const vh = videoEl.videoHeight || 360\r\n          // Fit cover into canvas (letterbox/crop to preserve aspect)\r\n          const cw = canvas.width\r\n          const ch = canvas.height\r\n          const vr = vw / vh\r\n          const cr = cw / ch\r\n          let sx = 0, sy = 0, sw = vw, sh = vh\r\n          if (vr > cr) {\r\n            // video is wider than canvas; crop sides\r\n            const targetW = vh * cr\r\n            sx = (vw - targetW) / 2\r\n            sw = targetW\r\n          } else if (vr < cr) {\r\n            // video is taller; crop top/bottom\r\n            const targetH = vw / cr\r\n            sy = (vh - targetH) / 2\r\n            sh = targetH\r\n          }\r\n          ctx.drawImage(videoEl, sx, sy, sw, sh, 0, 0, cw, ch)\r\n        } else {\r\n          // Placeholder background when not streaming\r\n          ctx.fillStyle = 'rgba(148, 163, 184, 0.25)'\r\n          ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n          ctx.fillStyle = 'rgba(226,232,240,0.8)'\r\n          ctx.font = '10px system-ui, sans-serif'\r\n          ctx.textAlign = 'center'\r\n          ctx.textBaseline = 'middle'\r\n          ctx.fillText('Camera', canvas.width / 2, canvas.height / 2)\r\n        }\r\n      } catch {}\r\n      rafRef.current = requestAnimationFrame(render)\r\n    }\r\n\r\n    rafRef.current = requestAnimationFrame(render)\r\n    return () => {\r\n      running = false\r\n      if (rafRef.current) cancelAnimationFrame(rafRef.current)\r\n    }\r\n    // Include only essentials; avoid re-creating loop unnecessarily\r\n  }, [streaming, videoEl])\r\n\r\n  const onClick = () => {\r\n    try {\r\n      // Toggle global overlay visibility via event (handled by overlay component)\r\n      window.dispatchEvent(new CustomEvent('ndn:toggle-phone-overlay'))\r\n    } catch {}\r\n  }\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      onClick={onClick}\r\n      className=\"relative inline-flex items-center gap-1 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transition-colors shadow-sm overflow-hidden\"\r\n      style={{ height: 36 }}\r\n      title={streaming ? 'Camera connected – click to toggle overlay' : 'Camera not connected'}\r\n    >\r\n      <canvas ref={canvasRef} width={64} height={36} className=\"block\" />\r\n      <span className=\"pr-2 text-xs text-slate-100 select-none hidden xs:inline\">\r\n        {streaming ? 'Phone Cam' : 'No Camera'}\r\n      </span>\r\n      {/* Status tick */}\r\n      <span\r\n        className=\"absolute -top-1 -right-1 text-lg pointer-events-none drop-shadow\"\r\n        aria-hidden=\"true\"\r\n      >\r\n        {streaming ? '✅' : '⚪'}\r\n      </span>\r\n    </button>\r\n  )\r\n}\r\n","// Help Desk AI - Provides intelligent responses to common questions\r\nexport const HELP_TOPICS = {\r\n  calibration: {\r\n    keywords: ['calibration', 'calibrate', 'camera', 'score', 'accuracy', 'aim', 'setup'],\r\n    title: 'How Calibration Works',\r\n    explanation: `Calibration helps our AI precisely detect where your darts land on the board. Here's how it works:\r\n\r\n1. **D20**: Click on the 20 segment to calibrate that area\r\n2. **D6**: Click on the 6 segment to calibrate that area\r\n3. **D3**: Click on the 3 segment to calibrate that area\r\n4. **D11**: Click on the 11 segment to calibrate that area\r\n5. **Bullseye**: Click on the bullseye to calibrate the center\r\n\r\nEach click teaches the system about your board's position and angle. After calibrating all areas, your scoring will be much more accurate!`,\r\n    actions: [\r\n      { id: 'D20', label: '📍 Click D20', color: 'bg-blue-600' },\r\n      { id: 'D6', label: '📍 Click D6', color: 'bg-purple-600' },\r\n      { id: 'D3', label: '📍 Click D3', color: 'bg-pink-600' },\r\n      { id: 'D11', label: '📍 Click D11', color: 'bg-cyan-600' },\r\n      { id: 'Bullseye', label: '🎯 Click Bullseye', color: 'bg-yellow-600' }\r\n    ]\r\n  },\r\n  scoring: {\r\n    keywords: ['score', 'points', 'counting', 'how do i score', 'scoring system'],\r\n    title: 'Dart Scoring',\r\n    explanation: `In darts, each segment on the board has a value:\r\n- Single areas: Face value (1-20)\r\n- Double ring (outer): 2× the segment number\r\n- Triple ring (inner): 3× the segment number\r\n- Bullseye: 50 points\r\n- Bull (outer bull): 25 points\r\n\r\nFor example: hitting Triple 20 = 60 points, Double 10 = 20 points`\r\n  },\r\n  gameplay: {\r\n    keywords: ['game', 'how to play', 'rules', 'x01', 'cricket', 'match', 'round'],\r\n    title: 'How to Play',\r\n    explanation: `Nine Dart Nation supports multiple game modes:\r\n\r\n**X01** (501, 301, 701): Start from the set score and count down to exactly 0. Final dart must be on a double.\r\n\r\n**Cricket**: Players try to \"close\" numbers 15-20 and bullseye by hitting them. First to close all and have the highest score wins.\r\n\r\n**Killer**: Players mark their \"number\" and try to knock out other players' lives.\r\n\r\nSelect your game mode when creating a match, and follow the on-screen instructions!`\r\n  },\r\n  premium: {\r\n    keywords: ['premium', 'subscription', 'features', 'upgrade', 'cost', 'paid'],\r\n    title: 'Premium Features',\r\n    explanation: `Our Premium subscription gives you:\r\n- Tournament creation and entry\r\n- Advanced statistics and replays\r\n- Priority matchmaking\r\n- Custom profiles and themes\r\n- Ad-free experience\r\n\r\nPremium grants are often awarded as tournament prizes!`\r\n  },\r\n  connection: {\r\n    keywords: ['connection', 'disconnect', 'lag', 'latency', 'websocket', 'error', 'offline'],\r\n    title: 'Connection Issues',\r\n    explanation: `If you're experiencing connection issues:\r\n1. Check your internet connection\r\n2. Refresh the page (Ctrl+R or Cmd+R)\r\n3. Clear browser cache\r\n4. Try a different browser\r\n5. Check if the site status page shows any issues\r\n\r\nMost connection issues resolve in seconds. Contact admin if problems persist.`\r\n  },\r\n  camera: {\r\n    keywords: ['camera', 'phone camera', 'mobile', 'video', 'pairing', 'connect'],\r\n    title: 'Camera Setup',\r\n    explanation: `To use our phone camera feature:\r\n1. Open Nine Dart Nation on your phone\r\n2. Go to Settings > Camera Pairing\r\n3. Scan the QR code or enter the pairing code\r\n4. Position your phone to capture the dartboard\r\n5. Run calibration (see calibration help for details)\r\n\r\nYour phone will now act as a live dartboard camera!`\r\n  },\r\n  tournament: {\r\n    keywords: ['tournament', 'compete', 'bracket', 'prize', 'winner', 'playoffs'],\r\n    title: 'Tournaments',\r\n    explanation: `Tournaments are competitive events where you can:\r\n- Play against other skilled players\r\n- Win prizes (Premium subscriptions or cash)\r\n- Climb leaderboards\r\n- Compete in structured brackets\r\n\r\nCheck the Tournaments tab to see upcoming events. Registration typically opens 30 minutes before start time.`\r\n  }\r\n}\r\n\r\nexport interface AIResponse {\r\n  type: 'explanation' | 'suggestion' | 'escalate'\r\n  title: string\r\n  message: string\r\n  actions?: Array<{ id: string; label: string; color: string }>\r\n  followUp?: string\r\n}\r\n\r\nexport function analyzeUserQuestion(question: string): AIResponse | null {\r\n  const lowerQ = question.toLowerCase()\r\n  \r\n  // Find matching topic\r\n  for (const [key, topic] of Object.entries(HELP_TOPICS)) {\r\n    for (const keyword of topic.keywords) {\r\n      if (lowerQ.includes(keyword)) {\r\n        return {\r\n          type: 'explanation',\r\n          title: topic.title,\r\n          message: topic.explanation,\r\n          actions: (topic as any).actions,\r\n          followUp: 'Do you need further assistance? I can connect you with an admin if needed.'\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // No match found - suggest escalation\r\n  return {\r\n    type: 'suggestion',\r\n    title: 'Need More Help?',\r\n    message: `I couldn't find a specific answer to your question. Common topics I can help with:\\n\\n${Object.values(HELP_TOPICS).map(t => `• ${t.title}`).join('\\n')}\\n\\nOr I can connect you with an admin who can help further.`,\r\n    followUp: 'Would you like to speak with an admin?'\r\n  }\r\n}\r\n\r\nexport function getEstimatedWaitTime(): string {\r\n  const hour = new Date().getHours()\r\n  \r\n  if (hour >= 20 || hour < 7) {\r\n    return '20-30 minutes (off-peak hours)'\r\n  } else if (hour >= 12 && hour < 14) {\r\n    return '10-15 minutes (moderate traffic)'\r\n  } else if (hour >= 18 && hour < 20) {\r\n    return '15-20 minutes (peak hours)'\r\n  } else {\r\n    return '5-10 minutes'\r\n  }\r\n}\r\n","import React, { useEffect, useState, useRef, useCallback } from 'react'\r\nimport { useWS } from './WSProvider'\r\nimport { X, Send, Zap, Clock, User } from 'lucide-react'\r\nimport { analyzeUserQuestion, getEstimatedWaitTime } from '../utils/helpDeskAI'\r\n\r\nexport default function HelpdeskChat({ request, user, onClose }: { request: any, user: any, onClose?: () => void }) {\r\n  const ws = (() => { try { return useWS() } catch { return null } })()\r\n  const [messages, setMessages] = useState<any[]>(request?.messages || [])\r\n  const [input, setInput] = useState('')\r\n  const [typingUsers, setTypingUsers] = useState<Record<string, number>>({})\r\n  const [adminConnected, setAdminConnected] = useState(false)\r\n  const [waitTime, setWaitTime] = useState('')\r\n  const msgsRef = useRef<HTMLDivElement | null>(null)\r\n  const typingTimeoutRef = useRef<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (!ws) return\r\n    const un = ws.addListener((data: any) => {\r\n      try {\r\n        if (data?.type === 'help-message' && String(data.requestId) === String(request.id)) {\r\n          setMessages((m) => [...m, data.message])\r\n        }\r\n        if (data?.type === 'help-request-updated' && data.request?.id === request.id) {\r\n          setMessages(data.request.messages || [])\r\n          setAdminConnected(data.request.claimedBy ? true : false)\r\n        }\r\n        if (data?.type === 'help-typing' && String(data.requestId) === String(request.id)) {\r\n          const who = data.fromName || data.fromEmail || (data.admin ? 'admin' : 'user')\r\n          setTypingUsers(prev => ({ ...prev, [who]: Date.now() }))\r\n        }\r\n      } catch {}\r\n    })\r\n    return () => { un() }\r\n  }, [ws, request?.id])\r\n\r\n  const sendMsg = () => {\r\n    if (!input.trim()) return\r\n    \r\n    // Send user message\r\n    const userMessage = input\r\n    const payload = { type: 'help-message', requestId: request.id, message: userMessage }\r\n    try { ws?.send(payload) } catch {}\r\n    \r\n    const msgObj = { fromEmail: user?.email || null, fromName: user?.username || null, message: userMessage, ts: Date.now(), admin: false }\r\n    setMessages(m => [...m, msgObj])\r\n    setInput('')\r\n\r\n    // If admin not connected, try AI response\r\n    if (!adminConnected) {\r\n      setTimeout(() => {\r\n        const aiResponse = analyzeUserQuestion(userMessage)\r\n        if (aiResponse) {\r\n          const aiMsg = {\r\n            fromName: 'AI Assistant',\r\n            message: `${aiResponse.title}\\n\\n${aiResponse.message}`,\r\n            ts: Date.now(),\r\n            admin: true,\r\n            actions: aiResponse.actions,\r\n            followUp: aiResponse.followUp\r\n          }\r\n          setMessages(m => [...m, aiMsg])\r\n        }\r\n      }, 500)\r\n    }\r\n  }\r\n\r\n  const requestAdminConnection = (needsHelp: boolean) => {\r\n    if (!needsHelp) {\r\n      const confirmMsg = { fromName: 'You', message: 'No, I think I have it now. Thanks!', ts: Date.now(), admin: false }\r\n      setMessages(m => [...m, confirmMsg])\r\n      \r\n      setTimeout(() => {\r\n        const aiMsg = {\r\n          fromName: 'AI Assistant',\r\n          message: '✅ Great! Glad I could help. Feel free to reach out anytime you need assistance.',\r\n          ts: Date.now(),\r\n          admin: true\r\n        }\r\n        setMessages(m => [...m, aiMsg])\r\n      }, 300)\r\n      return\r\n    }\r\n\r\n    // Request admin connection\r\n    const confirmMsg = { fromName: 'You', message: 'Yes, I need to speak with an admin', ts: Date.now(), admin: false }\r\n    setMessages(m => [...m, confirmMsg])\r\n\r\n    // Send escalation request to admins\r\n    try {\r\n      ws?.send({ type: 'help-escalate', requestId: request.id })\r\n    } catch {}\r\n\r\n    setWaitTime(getEstimatedWaitTime())\r\n\r\n    setTimeout(() => {\r\n      const waitMsg = {\r\n        fromName: 'System',\r\n        message: `⏳ Connecting you with an admin...\\n\\n📊 Estimated wait time: ${waitTime}\\n\\nAn admin will be with you shortly. Please stay on this chat.`,\r\n        ts: Date.now(),\r\n        admin: true\r\n      }\r\n      setMessages(m => [...m, waitMsg])\r\n    }, 500)\r\n  }\r\n\r\n  // auto-scroll to bottom when messages update\r\n  useEffect(() => {\r\n    if (!msgsRef.current) return\r\n    try {\r\n      msgsRef.current.scrollTop = msgsRef.current.scrollHeight\r\n    } catch {}\r\n  }, [messages])\r\n\r\n  // send typing notifications (debounced)\r\n  const sendTyping = useCallback(() => {\r\n    try {\r\n      ws?.send({ type: 'help-typing', requestId: request.id, fromName: user?.username, fromEmail: user?.email, admin: !!user?.isAdmin })\r\n    } catch {}\r\n    if (typingTimeoutRef.current) {\r\n      clearTimeout(typingTimeoutRef.current)\r\n    }\r\n    typingTimeoutRef.current = window.setTimeout(() => {\r\n      setTypingUsers(prev => {\r\n        const copy = { ...prev }\r\n        delete copy[user?.username || user?.email || 'me']\r\n        return copy\r\n      })\r\n    }, 3000)\r\n  }, [ws, request.id, user])\r\n\r\n  useEffect(() => {\r\n    return () => { if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current) }\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end justify-center p-4\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\r\n      <div className=\"relative w-full max-w-2xl bg-slate-900 rounded-lg shadow-xl overflow-hidden flex flex-col max-h-[80vh]\">\r\n        <div className=\"flex items-center justify-between p-3 border-b border-slate-700 bg-slate-800\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"font-semibold flex items-center gap-2\">\r\n              <Zap className=\"w-4 h-4 text-yellow-400\" />\r\n              Help Desk — {request.username || 'Anonymous'}\r\n            </div>\r\n            {adminConnected && (\r\n              <span className=\"text-xs px-2 py-1 rounded bg-emerald-600\">Admin Connected</span>\r\n            )}\r\n          </div>\r\n          <button className=\"px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600 text-sm\" onClick={onClose}>\r\n            <X className=\"w-4 h-4\"/>\r\n          </button>\r\n        </div>\r\n\r\n        <div ref={msgsRef} className=\"flex-1 overflow-y-auto p-3 space-y-3 bg-black/20\">\r\n          {messages.map((m, i) => (\r\n            <div key={i}>\r\n              <div className={`max-w-[85%] px-3 py-2 rounded ${m.admin ? 'bg-emerald-600/20 border border-emerald-500/40 text-emerald-100 ml-auto' : 'bg-slate-700 text-slate-100'}`}>\r\n                <div className=\"flex items-center justify-between mb-1\">\r\n                  <div className=\"text-xs opacity-70 font-semibold flex items-center gap-1\">\r\n                    {m.admin ? <Zap className=\"w-3 h-3\" /> : <User className=\"w-3 h-3\" />}\r\n                    {m.fromName || m.fromEmail || (m.admin ? 'AI Assistant' : 'You')}\r\n                  </div>\r\n                  <div className=\"text-xs opacity-50 ml-2\">{m.ts ? new Date(m.ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}</div>\r\n                </div>\r\n                <div className=\"whitespace-pre-wrap break-words text-sm\">{m.message}</div>\r\n                \r\n                {/* Calibration actions */}\r\n                {m.actions && m.actions.length > 0 && (\r\n                  <div className=\"mt-3 space-y-2\">\r\n                    <div className=\"text-xs font-semibold opacity-80\">🎯 Try these calibration points:</div>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-5 gap-2\">\r\n                      {m.actions.map((action: any) => (\r\n                        <button\r\n                          key={action.id}\r\n                          className={`${action.color} text-white text-xs py-2 px-2 rounded font-medium hover:opacity-90 transition-opacity`}\r\n                          onClick={() => {\r\n                            const actionMsg = { fromName: 'You', message: `Clicked: ${action.label}`, ts: Date.now(), admin: false }\r\n                            setMessages(prev => [...prev, actionMsg])\r\n                            try { ws?.send({ type: 'help-message', requestId: request.id, message: `User clicked: ${action.id}` }) } catch {}\r\n                          }}\r\n                        >\r\n                          {action.label}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Follow-up prompt */}\r\n                {m.followUp && !adminConnected && (\r\n                  <div className=\"mt-3 space-y-2\">\r\n                    <div className=\"text-xs opacity-80\">{m.followUp}</div>\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        className=\"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors\"\r\n                        onClick={() => requestAdminConnection(true)}\r\n                      >\r\n                        ✅ Yes, connect me\r\n                      </button>\r\n                      <button\r\n                        className=\"flex-1 bg-slate-600 hover:bg-slate-700 text-white text-xs py-2 px-3 rounded font-medium transition-colors\"\r\n                        onClick={() => requestAdminConnection(false)}\r\n                      >\r\n                        ❌ No thanks\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {/* typing indicators */}\r\n          {Object.keys(typingUsers).length > 0 && (\r\n            <div className=\"text-xs text-slate-300 opacity-80 flex items-center gap-2\">\r\n              <span>{Object.keys(typingUsers).join(', ')} typing</span>\r\n              <span className=\"flex gap-1\">\r\n                <span className=\"w-1 h-1 bg-slate-300 rounded-full animate-bounce\"></span>\r\n                <span className=\"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-100\"></span>\r\n                <span className=\"w-1 h-1 bg-slate-300 rounded-full animate-bounce delay-200\"></span>\r\n              </span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 border-t border-slate-700 bg-slate-800 flex gap-2\">\r\n          <input\r\n            className=\"input flex-1 text-sm\"\r\n            value={input}\r\n            onChange={e => {\r\n              setInput(e.target.value)\r\n              sendTyping()\r\n            }}\r\n            onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg() } }}\r\n            placeholder=\"Ask a question (e.g., 'How does calibration work?')...\"\r\n          />\r\n          <button className=\"btn bg-blue-600 hover:bg-blue-700 text-white\" onClick={sendMsg}>\r\n            <Send className=\"w-4 h-4\"/>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport BarChart from './BarChart'\r\nimport TabPills from './ui/TabPills'\r\nimport { getGameModeStats } from '../store/profileStats'\r\nimport { allGames } from '../utils/games'\r\nimport { useWS } from './WSProvider'\r\nimport StatusDot from './ui/StatusDot'\r\nimport CameraStatusBadge from './CameraStatusBadge'\r\nimport HelpdeskChat from './HelpdeskChat'\r\nimport { useCalibration } from '../store/calibration'\r\nimport { getCalibrationConfidenceForGame, getCalibrationQualityText } from '../utils/gameCalibrationRequirements'\r\n\r\nconst OWNER_EMAIL = 'daviesfamily108@gmail.com'\r\n\r\nexport default function AdminDashboard({ user }: { user: any }) {\r\n\tconst ws = (() => { try { return useWS() } catch { return null } })()\r\n\tconst [admins, setAdmins] = useState<string[]>([])\r\n\tconst [email, setEmail] = useState('')\r\n\tconst [status, setStatus] = useState<any>(null)\r\n\tconst [announcement, setAnnouncement] = useState('')\r\n\tconst [loading, setLoading] = useState(false)\r\n\tconst [tournaments, setTournaments] = useState<any[]>([])\r\n\t\tconst [withdrawals, setWithdrawals] = useState<any[]>([])\r\n\tconst [userSearch, setUserSearch] = useState('')\r\n\tconst [userResults, setUserResults] = useState<any[]>([])\r\n\tconst [createForm, setCreateForm] = useState<any>({\r\n\t\ttitle: 'Official Tournament',\r\n\t\tgame: 'X01',\r\n\t\tmode: 'bestof',\r\n\t\tvalue: 3,\r\n\t\tdescription: '',\r\n\t\tstartAt: new Date(Date.now() + 2*60*60*1000).toISOString().slice(0,16),\r\n\t\tcheckinMinutes: 30,\r\n\t\tcapacity: 16,\r\n\t\tprizeType: 'premium',\r\n\t\tprizeAmount: 3,\r\n\t\t\tcurrency: 'GBP',\r\n\t\tprizeNotes: '',\r\n\t})\r\n\tconst [emailCopy, setEmailCopy] = useState<any>({ reset:{}, reminder:{}, confirmEmail:{}, changed:{} })\r\n\tconst [preview, setPreview] = useState<{ open: boolean, kind?: string, html?: string }>({ open: false })\r\n\tconst [activeTab, setActiveTab] = useState<'general' | 'maintenance' | 'premium' | 'helpdesk' | 'tourneys'>('general')\r\n\tconst isOwner = user?.email?.toLowerCase() === OWNER_EMAIL\r\n  const [winners, setWinners] = useState<any[]>([])\r\n\t\tconst [reports, setReports] = useState<any[]>([])\r\n\tconst [helpRequests, setHelpRequests] = useState<any[]>([])\r\n\tconst [helpTyping, setHelpTyping] = useState<Record<string, { who: string, ts: number }>>({})\r\n\tconst [selectedRequest, setSelectedRequest] = useState<any | null>(null)\r\n\tconst [logs, setLogs] = useState<any[]>([])\r\n\tconst [systemHealth, setSystemHealth] = useState<any>(null)\r\n\tconst [clusteringEnabled, setClusteringEnabled] = useState(false)\r\n\tconst [clusterCapacity, setClusterCapacity] = useState(1500)\r\n\r\n\t// --- Game usage (played/won per mode) ---\r\n\tconst [gmVersion, setGmVersion] = useState(0)\r\n\tuseEffect(() => {\r\n\t\tconst on = () => setGmVersion(v => v + 1)\r\n\t\twindow.addEventListener('ndn:stats-updated', on as any)\r\n\t\treturn () => window.removeEventListener('ndn:stats-updated', on as any)\r\n\t}, [])\r\n\tconst gmStats = useMemo(() => getGameModeStats(allGames as unknown as string[]), [gmVersion])\r\n\t\r\n\t// Calibration data and preview effect\r\n\tconst cal = useCalibration()\r\n\t\r\n\tuseEffect(() => {\r\n\t\tif (!preview.open) return\r\n\t\tfunction onKey(e: KeyboardEvent) { if (e.key === 'Escape') setPreview({ open: false }) }\r\n\t\tdocument.addEventListener('keydown', onKey)\r\n\t\treturn () => document.removeEventListener('keydown', onKey)\r\n\t}, [preview.open])\r\n\r\n\t// Calibration quality display\r\n\tconst calibQuality = useMemo(() => {\r\n\t\tconst errorPx = cal.errorPx ?? null\r\n\t\tconst items: any[] = []\r\n\t\tfor (const game of allGames) {\r\n\t\t\tconst confidence = getCalibrationConfidenceForGame(game, errorPx)\r\n\t\t\tconst qualityInfo = getCalibrationQualityText(game, errorPx)\r\n\t\t\titems.push({ game, confidence, qualityInfo })\r\n\t\t}\r\n\t\treturn items\r\n\t}, [cal.errorPx])\r\n\r\n\t// Lightweight derived bars for the Game Usage chart\r\n\tconst gmBars: any[] = useMemo(() => {\r\n\t\tconst bars: any[] = []\r\n\t\tif (gmStats && typeof gmStats === 'object') {\r\n\t\t\tfor (const [gameKey, stats] of Object.entries(gmStats as any)) {\r\n\t\t\t\tconst s = stats as any\r\n\t\t\t\tbars.push({\r\n\t\t\t\t\tlabel: gameKey,\r\n\t\t\t\t\tvalue: s?.played || 0,\r\n\t\t\t\t\twon: s?.won || 0\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn bars\r\n\t}, [gmStats])\r\n\r\n\t// Refresh common admin data (help requests, admins, tournaments)\r\n\tasync function refresh() {\r\n\t\ttry {\r\n\t\t\tconst headers = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst [hrRes, adminsRes, tRes] = await Promise.all([\r\n\t\t\t\tfetch('/api/admin/help-requests', { headers }),\r\n\t\t\t\tfetch('/api/admins', { headers }),\r\n\t\t\t\tfetch('/api/tournaments', { headers }),\r\n\t\t\t])\r\n\t\t\tif (hrRes.ok) {\r\n\t\t\t\tconst d = await hrRes.json();\r\n\t\t\t\tsetHelpRequests(Array.isArray(d) ? d : (d.requests || []))\r\n\t\t\t}\r\n\t\t\tif (adminsRes.ok) {\r\n\t\t\t\tconst d = await adminsRes.json();\r\n\t\t\t\tsetAdmins(Array.isArray(d) ? d : (d.admins || []))\r\n\t\t\t}\r\n\t\t\tif (tRes.ok) {\r\n\t\t\t\tconst d = await tRes.json();\r\n\t\t\t\tsetTournaments(Array.isArray(d) ? d : (d.tournaments || d))\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('refresh failed', e)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function revoke(target: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admins/revoke', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ email: target }) })\r\n\t\t\tawait refresh()\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function grantPremium(email: string, days: number) {\r\n\t\tif (!email) return\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/premium/grant', { method:'POST', headers: { 'Content-Type':'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ email, days }) })\r\n\t\t\tawait refresh()\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function revokePremium(email: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/premium/revoke', { method:'POST', headers: { 'Content-Type':'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ email }) })\r\n\t\t\tawait refresh()\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function sendAnnouncement() {\r\n\t\tif (!announcement.trim()) return\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/announce', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ message: announcement }) })\r\n\t\t\tsetAnnouncement('')\r\n\t\t\tawait refresh()\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function toggleMaintenance(next: boolean) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/maintenance', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ maintenance: next }) })\r\n\t\t\tawait refresh()\r\n\t\t} catch {}\r\n\t}\r\n\r\n\r\n\t\t// Listen for help-typing and help-request events over WS to show live typing indicators and new requests\r\n\t\tuseEffect(() => {\r\n\t\t\tif (!ws) return\r\n\t\t\tconst unsub = ws.addListener((data: any) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (data?.type === 'help-typing') {\r\n\t\t\t\t\t\tconst rid = String(data.requestId || '')\r\n\t\t\t\t\t\tif (!rid) return\r\n\t\t\t\t\t\tsetHelpTyping(prev => ({ ...prev, [rid]: { who: data.fromName || 'someone', ts: Date.now() } }))\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data?.type === 'help-request') {\r\n\t\t\t\t\t\tconst req = data.request\r\n\t\t\t\t\t\tif (!req || !req.id) return\r\n\t\t\t\t\t\tsetHelpRequests(prev => {\r\n\t\t\t\t\t\t\tconst filtered = (prev || []).filter((r:any) => String(r.id) !== String(req.id))\r\n\t\t\t\t\t\t\treturn [req, ...filtered]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data?.type === 'help-request-updated') {\r\n\t\t\t\t\t\trefresh()\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch {}\r\n\t\t\t})\r\n\t\t\tconst iv = setInterval(() => {\r\n\t\t\t\tconst now = Date.now()\r\n\t\t\t\tlet changed = false\r\n\t\t\t\tconst copy = { ...helpTyping }\r\n\t\t\t\tfor (const k of Object.keys(copy)) {\r\n\t\t\t\t\tif (now - copy[k].ts > 3500) { delete copy[k]; changed = true }\r\n\t\t\t\t}\r\n\t\t\t\tif (changed) setHelpTyping(copy)\r\n\t\t\t}, 1500)\r\n\t\t\treturn () => { try { unsub() } catch {} ; clearInterval(iv) }\r\n\t\t}, [ws])\r\n\r\n\r\n\tasync function claimHelp(id: string) {\r\n\t\ttry {\r\n\t\t\tconst headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch(`/api/admin/help-requests/${encodeURIComponent(id)}/claim`, { method: 'POST', headers, body: JSON.stringify({ }) })\r\n\t\t\tif (res.ok) { await refresh() }\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function resolveHelp(id: string) {\r\n\t\ttry {\r\n\t\t\tconst headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch(`/api/admin/help-requests/${encodeURIComponent(id)}/resolve`, { method: 'POST', headers, body: JSON.stringify({ }) })\r\n\t\t\tif (res.ok) { await refresh() }\r\n\t\t} catch {}\r\n\t}\r\n\r\n\tasync function grant() {\r\n\t\tif (!email) return\r\n\t\tawait fetch('/api/admins/grant', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ email }) })\r\n\t\tsetEmail('')\r\n\t\t\t\t\t\r\n\t}\r\n\r\n\tasync function searchUsers() {\r\n\t\tif (!userSearch.trim()) return\r\n\t\ttry {\r\n\t\t\tconst authHeader = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch(`/api/admin/users/search?q=${encodeURIComponent(userSearch)}`, { headers: authHeader })\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tsetUserResults(Array.isArray(data.users) ? data.users : [])\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Search failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function banUser(email: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/users/ban', { \r\n\t\t\t\tmethod: 'POST', \r\n\t\t\t\theaders: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, \r\n\t\t\t\tbody: JSON.stringify({ email }) \r\n\t\t\t})\r\n\t\t\tawait searchUsers() // Refresh results\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Ban failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function unbanUser(email: string) {\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/users/unban', { \r\n\t\t\t\tmethod: 'POST', \r\n\t\t\t\theaders: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, \r\n\t\t\t\tbody: JSON.stringify({ email }) \r\n\t\t\t})\r\n\t\t\tawait searchUsers() // Refresh results\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Unban failed:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function flipPremium(next: boolean) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/subscription', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ fullAccess: next }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function createOfficialTournament() {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tconst start = new Date(createForm.startAt).getTime()\r\n\t\t\tconst res = await fetch('/api/tournaments/create', {\r\n\t\t\t\tmethod: 'POST', headers: { 'Content-Type': 'application/json' },\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\ttitle: createForm.title,\r\n\t\t\t\t\tgame: createForm.game,\r\n\t\t\t\t\tmode: createForm.mode,\r\n\t\t\t\t\tvalue: Number(createForm.value),\r\n\t\t\t\t\tdescription: createForm.description,\r\n\t\t\t\t\tstartAt: start,\r\n\t\t\t\t\tcheckinMinutes: Number(createForm.checkinMinutes),\r\n\t\t\t\t\tcapacity: Number(createForm.capacity),\r\n\t\t\t\t\trequireCalibration: !!createForm.requireCalibration,\r\n\t\t\t\t\tcreatorEmail: user?.email,\r\n\t\t\t\t\tcreatorName: user?.username,\r\n\t\t\t\t\trequesterEmail: user?.email,\r\n\t\t\t\t\tofficial: true,\r\n\t\t\t\t\tprizeType: createForm.prizeType,\r\n\t\t\t\t\tprizeAmount: Number(createForm.prizeAmount||0),\r\n\t\t\t\t\tcurrency: createForm.currency,\r\n\t\t\t\t\tprizeNotes: createForm.prizeNotes,\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t// refresh admin view and broadcast will update lobby for connected clients\r\n\t\t\tawait refresh()\r\n\t\t\ttry {\r\n\t\t\t\t// If creation returned the tournament id, navigate the app to the tournaments tab so lobby is visible\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tif (data && data.tournament && data.tournament.id) {\r\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: 'tournaments' } }))\r\n\t\t\t\t}\r\n\t\t\t} catch {}\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function setWinner(tid: string, winnerEmail: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/winner', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ tournamentId: tid, winnerEmail }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function markPaid(tid: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/mark-paid', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ tournamentId: tid }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function deleteTournament(tid: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/delete', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ tournamentId: tid }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function reseedWeekly() {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tawait fetch('/api/admin/tournaments/reseed-weekly', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\t\tasync function decideWithdrawal(id: string, approve: boolean) {\r\n\t\t\tsetLoading(true)\r\n\t\t\ttry {\r\n\t\t\t\tawait fetch('/api/admin/wallet/withdrawals/decide', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ id, approve }) })\r\n\t\t\t\tawait refresh()\r\n\t\t\t} finally { setLoading(false) }\r\n\t\t}\r\n\r\n\tasync function deleteMatch(id: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\t\tawait fetch('/api/admin/matches/delete', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` }, body: JSON.stringify({ matchId: id }) })\r\n\t\t\tawait refresh()\r\n\t\t} finally { setLoading(false) }\r\n\t}\r\n\r\n\tasync function fetchLogs() {\r\n\t\ttry {\r\n\t\t\tconst authHeader = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch('/api/admin/logs', { headers: authHeader })\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tif (data?.ok) setLogs(data.logs || [])\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to fetch logs:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function fetchSystemHealth() {\r\n\t\ttry {\r\n\t\t\tconst authHeader = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch('/api/admin/system-health', { headers: authHeader })\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst data = await res.json()\r\n\t\t\t\tif (data?.ok && data?.health) {\r\n\t\t\t\t\tsetSystemHealth({\r\n\t\t\t\t\t\tdatabase: data.health.database || false,\r\n\t\t\t\t\t\twebsocket: data.health.websocket || false,\r\n\t\t\t\t\t\thttps: data.health.https || false,\r\n\t\t\t\t\t\tmaintenance: data.health.maintenance || false,\r\n\t\t\t\t\t\tclustering: data.health.clustering || false,\r\n\t\t\t\t\t\tuptime: data.health.uptime || 0,\r\n\t\t\t\t\t\tmemory: data.health.memory || { heapUsed: 0 },\r\n\t\t\t\t\t\tversion: data.health.version || 'unknown'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetClusteringEnabled(data.health?.clustering || false)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to fetch system health:', error)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function toggleClustering(enable: boolean) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tconst res = await fetch('/api/admin/clustering', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` },\r\n\t\t\t\tbody: JSON.stringify({ enabled: enable, maxWorkers: 4, capacity: clusterCapacity })\r\n\t\t\t})\r\n\t\t\tconst data = await res.json()\r\n\t\t\tconsole.log('Clustering response:', data)\r\n\t\t\tif (data?.ok) {\r\n\t\t\t\talert(`Clustering ${enable ? 'enabled' : 'disabled'} successfully. Max capacity: ${clusterCapacity.toLocaleString()} concurrent users. NODE_WORKERS environment variable is set to max capacity.`)\r\n\t\t\t\tawait fetchSystemHealth()\r\n\t\t\t} else {\r\n\t\t\t\talert(`Failed: ${data?.error || data?.message || 'Unknown error'}`)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Clustering toggle failed:', error)\r\n\t\t\talert('Clustering toggle failed: ' + (error instanceof Error ? error.message : String(error)))\r\n\t\t} finally {\r\n\t\t\tsetLoading(false)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function updateClusterCapacity(newCapacity: number) {\r\n\t\tsetClusterCapacity(newCapacity)\r\n\t\t// Capacity is updated locally and sent when clustering toggle is used\r\n\t}\r\n\r\n\tasync function runQuickFix(action: string) {\r\n\t\tsetLoading(true)\r\n\t\ttry {\r\n\t\t\tconst res = await fetch('/api/admin/quick-fix', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}` },\r\n\t\t\t\tbody: JSON.stringify({ action })\r\n\t\t\t})\r\n\t\t\tconst data = await res.json()\r\n\t\t\tif (data?.ok) {\r\n\t\t\t\talert(`${action} completed successfully`)\r\n\t\t\t\tawait fetchSystemHealth() // Refresh health data\r\n\t\t\t} else {\r\n\t\t\t\talert(`Failed: ${data?.error || 'Unknown error'}`)\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Quick fix failed:', error)\r\n\t\t\talert('Quick fix failed')\r\n\t\t} finally {\r\n\t\t\tsetLoading(false)\r\n\t\t}\r\n\t}\r\n\r\n\tasync function loadEmailCopy() {\r\n\t\ttry {\r\n\t\t\tconst authHeader = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch('/api/admin/email-copy', { headers: authHeader })\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tconst d = await res.json()\r\n\t\t\t\tif (d?.ok) setEmailCopy(d.copy || emailCopy)\r\n\t\t\t}\r\n\t\t} catch {}\r\n\t}\r\n\tuseEffect(()=>{ if (isOwner) loadEmailCopy() }, [isOwner])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isOwner && (activeTab === 'general' || activeTab === 'maintenance')) {\r\n\t\t\tfetchLogs()\r\n\t\t\tfetchSystemHealth()\r\n\t\t}\r\n\t}, [isOwner, activeTab])\r\n\r\n\tasync function saveEmailCopy(kind: string, payload: any) {\r\n\t\tawait fetch('/api/admin/email-copy', { method:'POST', headers:{'Content-Type':'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}`}, body: JSON.stringify({ kind, ...payload }) })\r\n\t\tawait loadEmailCopy()\r\n\t}\r\n\r\n\tasync function openInlinePreview(kind: string, openInNewTab?: boolean) {\r\n\t\ttry {\r\n\t\t\tconst authHeader = { Authorization: `Bearer ${localStorage.getItem('authToken')}` }\r\n\t\t\tconst res = await fetch(`/api/email/preview?kind=${encodeURIComponent(kind)}`, { headers: authHeader })\r\n\t\t\tconst html = await res.text()\r\n\t\t\tif (openInNewTab) {\r\n\t\t\t\tconst w = window.open()\r\n\t\t\t\tif (w) {\r\n\t\t\t\t\tw.document.open()\r\n\t\t\t\t\tw.document.write(html)\r\n\t\t\t\t\tw.document.close()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsetPreview({ open: true, kind, html })\r\n\t\t} catch {\r\n\t\t\tsetPreview({ open: true, kind, html: '<!doctype html><html><body style=\"font-family:sans-serif;padding:16px\">Failed to load preview.</body></html>' })\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!preview.open) return\r\n\t\tfunction onKey(e: KeyboardEvent) { if (e.key === 'Escape') setPreview({ open: false }) }\r\n\t\tdocument.addEventListener('keydown', onKey)\r\n\t\treturn () => document.removeEventListener('keydown', onKey)\r\n\t}, [preview.open])\r\n\r\n\tfunction EmailEditor({ kind, label }: { kind:string, label:string }) {\r\n\t\tconst key = kind === 'confirm-email' ? 'confirmEmail' : (kind === 'changed' ? 'changed' : kind)\r\n\t\tconst cfg = emailCopy?.[key] || { title:'', intro:'', buttonLabel:'' }\r\n\t\tconst [title, setTitle] = useState(cfg.title||'')\r\n\t\tconst [intro, setIntro] = useState(cfg.intro||'')\r\n\t\tconst [btn, setBtn] = useState(cfg.buttonLabel||'')\r\n\t\tuseEffect(()=>{ setTitle(cfg.title||''); setIntro(cfg.intro||''); setBtn(cfg.buttonLabel||'') }, [cfg.title, cfg.intro, cfg.buttonLabel])\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"p-2 rounded bg-black/20 space-y-2\">\r\n\t\t\t\t<div className=\"font-semibold\">{label}</div>\r\n\t\t\t\t<input className=\"input w-full\" placeholder=\"Title (optional)\" value={title} onChange={e=>setTitle(e.target.value)} />\r\n\t\t\t\t<textarea className=\"input w-full\" rows={2} placeholder=\"Intro line (optional)\" value={intro} onChange={e=>setIntro(e.target.value)} />\r\n\t\t\t\t<input className=\"input w-full\" placeholder=\"Button label (optional)\" value={btn} onChange={e=>setBtn(e.target.value)} />\r\n\t\t\t\t<div className=\"flex gap-2 justify-end\">\r\n\t\t\t\t\t<button className=\"btn\" type=\"button\" onClick={()=>openInlinePreview(kind, true)}>Preview</button>\r\n\t\t\t\t\t<button className=\"btn\" type=\"button\" onClick={()=>openInlinePreview(kind)}>Popup</button>\r\n\t\t\t\t\t<button className=\"btn\" onClick={()=>saveEmailCopy(kind, { title, intro, buttonLabel: btn })}>Save</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\t\tif (!isOwner) { return (\r\n\t\t<div className=\"card\">\r\n\t\t\t<h2 className=\"text-2xl font-bold mb-2\">Admin</h2>\r\n\t\t\t<div className=\"text-sm opacity-80\">You don’t have permission to manage admins.</div>\r\n\t\t</div>\r\n\t\t) }\r\n\r\n\t/* Top help-requests strip for quick admin actions */\r\n\t\t{helpRequests.length > 0 && (\r\n\t\t\t<div className=\"p-2 rounded-xl bg-amber-900/10 border border-amber-500/20 mt-3\">\r\n\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t<span className=\"font-semibold\">Open Help Requests</span>\r\n\t\t\t\t\t\t<span className=\"text-sm opacity-80\">{helpRequests.length} open</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t<button className=\"btn\" onClick={() => setSelectedRequest(helpRequests[0])}>Open Latest</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-ghost\" onClick={() => refresh()}>Refresh</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"mt-2 flex gap-2 overflow-x-auto\">\r\n\t\t\t\t\t{helpRequests.slice(0,6).map((hr:any) => (\r\n\t\t\t\t\t\t<div key={hr.id} className=\"p-2 rounded bg-black/10 border border-white/10 min-w-[220px]\">\r\n\t\t\t\t\t\t\t<div className=\"font-medium\">{hr.username || 'Anonymous'}</div>\r\n\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">{new Date(hr.ts || 0).toLocaleTimeString()}</div>\r\n\t\t\t\t\t\t\t<div className=\"text-sm truncate mt-1\">{hr.message}</div>\r\n\t\t\t\t\t\t\t<div className=\"mt-2 flex gap-2\">\r\n\t\t\t\t\t\t\t\t{hr.status === 'open' ? (\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={() => claimHelp(hr.id)}>Claim</button>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs opacity-70\">{hr.status} by {hr.claimedBy || '—'}</span>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={() => setSelectedRequest(hr)}>Chat</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)}\r\n\r\n\treturn (\r\n\t\t\t<div className=\"space-y-4 ndn-game-shell\">\r\n\t\t\t\t{/* Top connection status strip */}\r\n\t\t\t\t<div className=\"p-2 rounded-xl bg-white/10 border border-white/10 flex items-center justify-between gap-2 flex-wrap\">\r\n\t\t\t\t\t<div className=\"flex items-center gap-2 text-sm\">\r\n\t\t\t\t\t\t<span className=\"font-semibold\">Connection Status</span>\r\n\t\t\t\t\t\t{ws ? (\r\n\t\t\t\t\t\t\t<span className=\"inline-flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t<StatusDot status={ws.status} title={`WebSocket: ${ws.status}`} />\r\n\t\t\t\t\t\t\t\t<span className=\"text-xs opacity-80\">WS: {ws.status}</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<span className=\"text-xs opacity-70\">WS: unavailable</span>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"shrink-0 flex items-center gap-2\">\r\n\t\t\t\t\t\t{/* Keep the green connected badge; no HTTP/HTTPS pills here */}\r\n\t\t\t\t\t\t<CameraStatusBadge />\r\n\t\t\t\t\t\t{ws && (ws as any).reconnect && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => (ws as any).reconnect()}\r\n\t\t\t\t\t\t\t\tclassName=\"ml-1 rounded-md bg-neutral-700/60 hover:bg-neutral-600/70 px-2.5 py-1 text-xs border border-white/10\"\r\n\t\t\t\t\t\t\t\ttitle=\"Force close and recreate the WebSocket connection\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tRecreate WS\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t{isOwner && (\r\n\t\t\t<TabPills\r\n\t\t\t\ttabs={[\r\n\t\t\t\t\t{ key: 'general', label: 'General' },\r\n\t\t\t\t\t{ key: 'maintenance', label: 'Maintenance' },\r\n\t\t\t\t\t{ key: 'premium', label: 'Premium' },\r\n\t\t\t\t\t{ key: 'tourneys', label: 'Tourneys' },\r\n\t\t\t\t\t{ key: 'helpdesk', label: 'Help Desk' }\r\n\t\t\t\t]}\r\n\t\t\t\tactive={activeTab}\r\n\t\t\t\tonChange={(key) => setActiveTab(key as 'general' | 'maintenance' | 'premium' | 'helpdesk' | 'tourneys')}\r\n\t\t\t\tclassName=\"mb-4\"\r\n\t\t\t/>\r\n\t\t)}\t\t\t{activeTab === 'general' && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Game Usage</h3>\r\n\t\t\t\t\t\t\t<div className=\"rounded-xl border border-indigo-500/40 bg-indigo-500/10 p-3\">\r\n\t\t\t\t\t\t\t\t<BarChart data={gmBars.map(d => ({ label: '', value: d.value }))} />\r\n\t\t\t\t\t\t\t\t<div className=\"mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px] opacity-80\">\r\n\t\t\t\t\t\t\t\t\t{gmBars.map((d, i) => (\r\n\t\t\t\t\t\t\t\t\t\t<div key={i} className=\"flex items-center justify-between px-2 py-1 rounded-md bg-white/5 border border-white/10\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"truncate mr-2\">{d.label}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"whitespace-nowrap\">Played {d.value} · Won {d.won}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Calibration Quality Status</h3>\r\n\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Camera calibration confidence by game mode. Shows current system calibration readiness for each game.</div>\r\n\t\t\t\t\t\t\t<div className=\"rounded-xl border border-amber-500/40 bg-amber-500/5 p-3\">\r\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 text-[11px]\">\r\n\t\t\t\t\t\t\t\t\t{calibQuality.map((item) => {\r\n\t\t\t\t\t\t\t\t\t\tconst colorClass = item.confidence >= 85 ? 'bg-emerald-500/20 border-emerald-500/40 text-emerald-200' \r\n\t\t\t\t\t\t\t\t\t\t\t: item.confidence >= 70 ? 'bg-amber-500/20 border-amber-500/40 text-amber-200'\r\n\t\t\t\t\t\t\t\t\t\t\t: 'bg-rose-500/20 border-rose-500/40 text-rose-200'\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t<div key={item.game} className={`px-2 py-2 rounded-md border ${colorClass}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-xs truncate\">{item.game}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] opacity-80 truncate\">{item.qualityInfo.quality}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-[10px] font-mono mt-0.5\">{Math.round(item.confidence)}%</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h2 className=\"text-2xl font-bold mb-2\">Admin Control</h2>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke Admin to trusted users. Only the owner can perform these actions.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={grant}>Grant</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revoke(email)}>Revoke</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Current Admins:</div>\r\n\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2 mb-4\">\r\n\t\t\t\t\t\t\t{admins.map((admin)=> (\r\n\t\t\t\t\t\t\t\t<div key={admin} className=\"px-2 py-1 rounded bg-indigo-600/20 border border-indigo-500/40 text-sm\">\r\n\t\t\t\t\t\t\t\t\t{admin}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<hr className=\"border-indigo-500/20 my-4\" />\r\n\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Premium Access Control</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke Premium subscription access to users (grants 30 days).</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading || !email.trim()} onClick={() => grantPremium(email, 30)}>Grant Premium</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revokePremium(email)}>Revoke Premium</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80\">Premium grants provide 30 days of unlimited access to all features.</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Announcements</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Send a message to all users. This will appear as a toast notification.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"Announcement message...\" value={announcement} onChange={e=>setAnnouncement(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading || !announcement.trim()} onClick={sendAnnouncement}>Send</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">User Search</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Search for users by email or name.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"Search users...\" value={userSearch} onChange={e=>setUserSearch(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={searchUsers}>Search</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{userResults.length > 0 && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Results:</div>\r\n\t\t\t\t\t\t\t\t{userResults.map((u)=> (\r\n\t\t\t\t\t\t\t\t\t<div key={u.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{u.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{u.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Joined {new Date(u.createdAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{isOwner && (\r\n\t\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Email Templates</h3>\r\n\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Customize titles, intro lines, and button text. Previews open in a new tab or as a popup.</div>\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"reset\" label=\"Password reset\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"reminder\" label=\"Password reset reminder\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"confirm-email\" label=\"Confirm new email\" />\r\n\t\t\t\t\t\t\t\t<EmailEditor kind=\"changed\" label=\"Password changed notice\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'maintenance' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">User Management</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Ban or unban users. Use with caution.</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={userSearch} onChange={e=>setUserSearch(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading} onClick={searchUsers}>Search</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{userResults.length > 0 && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Results:</div>\r\n\t\t\t\t\t\t\t\t{userResults.map((u)=> (\r\n\t\t\t\t\t\t\t\t\t<div key={u.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{u.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{u.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Joined {new Date(u.createdAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-red-600 hover:bg-red-700 text-xs\" onClick={()=>banUser(u.email)}>Ban</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-green-600 hover:bg-green-700 text-xs\" onClick={()=>unbanUser(u.email)}>Unban</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Withdrawals</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{withdrawals.map((w:any) => (\r\n\t\t\t\t\t\t\t\t<li key={w.id} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-mono text-xs\">{w.id}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div>{w.email} · {w.currency} {(w.amountCents/100).toFixed(2)}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{w.status} · {new Date(w.requestedAt).toLocaleString()}</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t{w.status==='pending' && (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading} onClick={()=>decideWithdrawal(w.id, true)}>Approve</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>decideWithdrawal(w.id, false)}>Reject</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{withdrawals.length===0 && <li className=\"opacity-60\">No withdrawal requests.</li>}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">System Health</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Current status of system components and services.</div>\r\n\t\t\t\t\t\t{systemHealth ? (\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Database</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.database ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.database ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>WebSocket</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.websocket ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.websocket ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>HTTPS</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.https ? 'bg-emerald-600' : 'bg-amber-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.https ? 'Enabled' : 'HTTP Only'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Maintenance Mode</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${!systemHealth.maintenance ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{!systemHealth.maintenance ? 'Normal' : 'Active'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Clustering (Auto-Scaling)</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${clusteringEnabled ? 'bg-emerald-600' : 'bg-amber-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{clusteringEnabled ? 'Enabled' : 'Disabled'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Uptime:</span> {Math.floor(systemHealth.uptime / 3600)}h {Math.floor((systemHealth.uptime % 3600) / 60)}m\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Memory:</span> {systemHealth.memory ? Math.round(systemHealth.memory.heapUsed / 1024 / 1024) : '?'}MB used\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Version:</span> {systemHealth.version}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 flex-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Refresh</button>\r\n\t\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\t\tclassName={`btn ${clusteringEnabled ? 'bg-amber-600 hover:bg-amber-700' : 'bg-emerald-600 hover:bg-emerald-700'}`} \r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => toggleClustering(!clusteringEnabled)}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{clusteringEnabled ? 'Disable' : 'Enable'} Clustering\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-center py-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-60 mb-2\">Loading system health...</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Load Health Status</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div className=\"mt-4 pt-4 border-t border-white/10\">\r\n\t\t\t\t\t\t\t<h4 className=\"font-semibold mb-3\">Clustering Capacity</h4>\r\n\t\t\t\t\t\t\t<div className=\"space-y-3\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t<label className=\"font-semibold\">Max Concurrent Users</label>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm bg-blue-600 px-2 py-1 rounded\">{clusterCapacity.toLocaleString()}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\t\t\t\ttype=\"range\" \r\n\t\t\t\t\t\t\t\t\t\tmin=\"1500\" \r\n\t\t\t\t\t\t\t\t\t\tmax=\"50000\" \r\n\t\t\t\t\t\t\t\t\t\tstep=\"500\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={clusterCapacity}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => updateClusterCapacity(Number(e.target.value))}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n\t\t\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\t\t\tbackground: clusteringEnabled ? \r\n\t\t\t\t\t\t\t\t\t\t\t\t`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${((clusterCapacity - 1500) / (50000 - 1500)) * 100}%, #374151 ${((clusterCapacity - 1500) / (50000 - 1500)) * 100}%, #374151 100%)` : \r\n\t\t\t\t\t\t\t\t\t\t\t\t'#374151'\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between text-xs opacity-60 mt-1\">\r\n\t\t\t\t\t\t\t\t\t\t<span>1.5k</span>\r\n\t\t\t\t\t\t\t\t\t\t<span>50k</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex gap-2 flex-wrap\">\r\n\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\tclassName={`btn ${clusteringEnabled ? 'bg-amber-600 hover:bg-amber-700' : 'bg-emerald-600 hover:bg-emerald-700'}`} \r\n\t\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => toggleClustering(!clusteringEnabled)}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{clusteringEnabled ? 'Disable' : 'Enable'} Clustering\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"text-xs opacity-70 mt-2 p-2 bg-white/5 rounded\">\r\n\t\t\t\t\t\t\t\t💡 Clustering enables auto-scaling with capacity up to {clusterCapacity.toLocaleString()} concurrent users. Adjust the slider to set maximum capacity. NODE_WORKERS environment variable is set to handle the configured load behind a reverse proxy.\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">User Reports</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{reports.map((r:any)=> (\r\n\t\t\t\t\t\t\t\t<li key={r.id} className=\"p-2 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-mono text-xs\">{r.id}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div><span className=\"font-semibold\">{r.reporter}</span> → <span className=\"font-semibold\">{r.offender}</span> · {new Date(r.ts).toLocaleString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">Reason: {r.reason}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t{r.messageId && <div className=\"opacity-60 text-xs\">Message ID: {r.messageId}</div>}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-0.5 rounded text-xs ${r.status==='open'?'bg-amber-600':'bg-emerald-600'}`}>{r.status}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t{r.status==='open' && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading} onClick={async()=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait fetch('/api/admin/reports/resolve', { method:'POST', headers:{'Content-Type':'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}`}, body: JSON.stringify({ id: r.id, action: 'resolved' }) })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Resolve</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={async()=>{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst notes = prompt('Enter notes for action taken (e.g., warning, block):') || ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait fetch('/api/admin/reports/resolve', { method:'POST', headers:{'Content-Type':'application/json', Authorization: `Bearer ${localStorage.getItem('authToken')}`}, body: JSON.stringify({ id: r.id, action: 'actioned', notes }) })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Action</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{reports.length===0 && <li className=\"opacity-60\">No reports.</li>}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">System Health</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Current status of system components and services.</div>\r\n\t\t\t\t\t\t{systemHealth ? (\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Database</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.database ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.database ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>WebSocket</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.websocket ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.websocket ? 'Ready' : 'Down'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>HTTPS</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${systemHealth.https ? 'bg-emerald-600' : 'bg-amber-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{systemHealth.https ? 'Enabled' : 'HTTP Only'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span>Maintenance Mode</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${!systemHealth.maintenance ? 'bg-emerald-600' : 'bg-red-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{!systemHealth.maintenance ? 'Normal' : 'Active'}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Uptime:</span> {Math.floor(systemHealth.uptime / 3600)}h {Math.floor((systemHealth.uptime % 3600) / 60)}m\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Memory:</span> {Math.round(systemHealth.memory.heapUsed / 1024 / 1024)}MB used\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-semibold\">Version:</span> {systemHealth.version}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 mt-3\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Refresh</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"text-center py-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-60 mb-2\">Loading system health...</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={fetchSystemHealth}>Load Health Status</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Open Matches</h3>\r\n\t\t\t\t\t\t<ul className=\"space-y-1\">\r\n\t\t\t\t\t\t\t{(status?.matches || []).map((m: any) => (\r\n\t\t\t\t\t\t\t\t<li key={m.id} className=\"flex items-center justify-between p-2 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-mono text-xs\">{m.id}</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-80\">{m.creatorName}</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"opacity-60\">{m.game} {m.mode==='firstto'?'FT':'BO'} {m.value} {m.game==='X01'?`/${m.startingScore}`:''}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={()=>deleteMatch(m.id)}>Remove</button>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{(!status?.matches || status.matches.length === 0) && (\r\n\t\t\t\t\t\t\t\t<li className=\"text-sm opacity-60\">No open matches.</li>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Dangerous Operations</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3 text-red-400\">⚠️ These operations can cause data loss or service disruption. Use with extreme caution.</div>\r\n\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2 text-red-400\">Tournament Deletion</div>\r\n\t\t\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t{tournaments.map((t:any)=> (\r\n\t\t\t\t\t\t\t\t\t\t<li key={t.id} className=\"p-2 rounded bg-red-900/20 border border-red-500/40 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{t.status}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">{t.game} · {t.mode==='firstto'?'FT':'BO'} {t.value}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn bg-red-600 hover:bg-red-700 text-xs\" disabled={loading} onClick={()=>deleteTournament(t.id)}>Delete Tournament</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t{tournaments.length===0 && <li className=\"opacity-60\">No tournaments.</li>}\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold mb-2 text-red-400\">System Maintenance</div>\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"p-3 rounded bg-red-900/20 border border-red-500/40\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold text-red-400 mb-2\">Maintenance Mode</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Put the entire site into maintenance mode. Users won't be able to access games or create matches.</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className={`px-2 py-1 rounded text-xs ${status?.maintenance ? 'bg-red-600' : 'bg-green-600'}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{status?.maintenance ? 'MAINTENANCE ACTIVE' : 'NORMAL OPERATION'}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`btn ${status?.maintenance ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`} \r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loading} \r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={()=>toggleMaintenance(!status?.maintenance)}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{status?.maintenance ? 'Disable' : 'Enable'}\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{selectedRequest && (\r\n\t\t\t\t\t\t<HelpdeskChat request={selectedRequest} user={{ email: user?.email, username: user?.username, isAdmin: true }} onClose={() => setSelectedRequest(null)} />\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'premium' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Premium Subscription Grants</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Grant or revoke premium subscriptions for users (grants 30 days).</div>\r\n\t\t\t\t\t\t<div className=\"flex gap-2 mb-3\">\r\n\t\t\t\t\t\t\t<input className=\"input flex-1\" placeholder=\"user@example.com\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n\t\t\t\t\t\t\t<button className=\"btn\" disabled={loading || !email.trim()} onClick={() => grantPremium(email, 30)}>Grant</button>\r\n\t\t\t\t\t\t\t<button className=\"btn bg-rose-600 hover:bg-rose-700\" disabled={loading} onClick={() => revokePremium(email)}>Revoke</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Premium users get 30 days of access to all features.</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-2\">Premium Winners</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-2\">Users who have won premium through tournaments.</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{winners.map((w: any) => (\r\n\t\t\t\t\t\t\t\t<div key={w.email} className=\"p-2 rounded bg-black/20 text-sm flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{w.name || 'No name'}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-70\">{w.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-60 text-xs\">Expires {new Date(w.expiresAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t{!w.expired ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-emerald-600 text-xs\">Premium Active</span>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-amber-600 text-xs\">Premium Expired</span>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{winners.length === 0 && <div className=\"opacity-60\">No premium winners.</div>}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'tourneys' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Create Official Tournament</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Set up a new official tournament with custom rules, timing, and prizes.</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t<input className=\"input w-full\" placeholder=\"Tournament Title\" value={createForm.title} onChange={e=>setCreateForm((f:any)=>({ ...f, title: e.target.value }))} />\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2\">\r\n\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.game} onChange={e=>setCreateForm((f:any)=>({ ...f, game: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t{['X01','Around the Clock','Cricket','Halve It','Shanghai','High-Low'].map((g)=> <option key={g} value={g}>{g}</option>)}\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.mode} onChange={e=>setCreateForm((f:any)=>({ ...f, mode: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t<option value=\"bestof\">Best of</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"firstto\">First to</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={1} value={createForm.value} onChange={e=>setCreateForm((f:any)=>({ ...f, value: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<textarea className=\"input w-full\" rows={2} placeholder=\"Description\" value={createForm.description} onChange={e=>setCreateForm((f:any)=>({ ...f, description: e.target.value }))} />\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-2\">\r\n\t\t\t\t\t\t\t\t<input className=\"input\" type=\"datetime-local\" value={createForm.startAt} onChange={e=>setCreateForm((f:any)=>({ ...f, startAt: e.target.value }))} />\r\n\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={0} placeholder=\"Checkin minutes\" value={createForm.checkinMinutes} onChange={e=>setCreateForm((f:any)=>({ ...f, checkinMinutes: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<input className=\"input w-full\" type=\"number\" min={6} max={64} placeholder=\"Capacity\" value={createForm.capacity} onChange={e=>setCreateForm((f:any)=>({ ...f, capacity: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-2 items-center\">\r\n\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.prizeType} onChange={e=>{\r\n\t\t\t\t\t\t\t\t\tconst newType = e.target.value\r\n\t\t\t\t\t\t\t\t\tsetCreateForm((f:any)=>({ ...f, prizeType: newType, prizeAmount: newType === 'premium' ? 3 : 0 }))\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t\t<option value=\"premium\">PREMIUM</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"cash\">Cash</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t{createForm.prizeType === 'premium' ? (\r\n\t\t\t\t\t\t\t\t\t<select className=\"input\" value={createForm.prizeAmount} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeAmount: Number(e.target.value) }))}>\r\n\t\t\t\t\t\t\t\t\t\t<option value={1}>1 month</option>\r\n\t\t\t\t\t\t\t\t\t\t<option value={3}>3 months</option>\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<input className=\"input\" type=\"number\" min={0} value={createForm.prizeAmount} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeAmount: Number(e.target.value) }))} />\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t<select className=\"input\" disabled={createForm.prizeType!=='cash'} value={createForm.currency} onChange={e=>setCreateForm((f:any)=>({ ...f, currency: e.target.value }))}>\r\n\t\t\t\t\t\t\t\t\t<option value=\"GBP\">GBP</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"USD\">USD</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"EUR\">EUR</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"CAD\">CAD</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"AUD\">AUD</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<input className=\"input w-full\" placeholder=\"Prize notes (optional)\" value={createForm.prizeNotes} onChange={e=>setCreateForm((f:any)=>({ ...f, prizeNotes: e.target.value }))} />\r\n\t\t\t\t\t\t\t<div className=\"flex justify-end\">\r\n\t\t\t\t\t\t\t\t<button className=\"btn bg-emerald-600 hover:bg-emerald-700\" disabled={loading} onClick={createOfficialTournament}>Create Tournament</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Tournament Premium Winners</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Users who have won premium prizes in tournaments. Grant them access here.</div>\r\n\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{tournaments\r\n\t\t\t\t\t\t\t\t.filter((t: any) => t.status === 'completed' && t.winnerEmail && t.prizeType === 'premium')\r\n\t\t\t\t\t\t\t\t.map((t: any) => {\r\n\t\t\t\t\t\t\t\t\tconst winner = winners.find((w: any) => w.email === t.winnerEmail)\r\n\t\t\t\t\t\t\t\t\tconst hasAccess = winner && !winner.expired\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<div key={t.id} className=\"p-3 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">{new Date(t.startAt).toLocaleDateString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{t.winnerEmail}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">Prize: {t.prizeAmount} month{t.prizeAmount > 1 ? 's' : ''} PREMIUM</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{hasAccess ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-2 py-1 rounded bg-emerald-600 text-xs\">✓ Access Granted</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn bg-emerald-600 hover:bg-emerald-700 text-xs\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => grantPremium(t.winnerEmail, t.prizeAmount * 30)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGrant Access\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t{tournaments.filter((t: any) => t.status === 'completed' && t.winnerEmail && t.prizeType === 'premium').length === 0 && (\r\n\t\t\t\t\t\t\t\t<div className=\"text-center py-4 text-sm opacity-60\">No completed premium tournaments.</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-xl font-semibold mb-3\">Manage Tournaments</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">View and manage all tournaments. Set winners or mark payouts.</div>\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{tournaments.map((t:any)=> (\r\n\t\t\t\t\t\t\t\t<li key={t.id} className=\"p-3 rounded bg-black/20 text-sm\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{t.title}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"opacity-80\">{t.game} · {t.mode==='firstto'?'First to':'Best of'} {t.value}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className={`px-2 py-1 rounded text-xs font-semibold ${\r\n\t\t\t\t\t\t\t\t\t\t\tt.status === 'scheduled' ? 'bg-blue-600' :\r\n\t\t\t\t\t\t\t\t\t\t\tt.status === 'running' ? 'bg-green-600' :\r\n\t\t\t\t\t\t\t\t\t\t\tt.status === 'completed' ? 'bg-purple-600' :\r\n\t\t\t\t\t\t\t\t\t\t\t'bg-gray-600'\r\n\t\t\t\t\t\t\t\t\t\t}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t{t.status}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70 mb-2\">\r\n\t\t\t\t\t\t\t\t\t\tStart: {new Date(t.startAt).toLocaleString()} · Capacity: {t.capacity}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{t.prize && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\tPrize: {t.prizeType==='cash' && t.prizeAmount ? `${t.currency||'USD'} ${t.prizeAmount}` : `${t.prizeAmount || 3} month${(t.prizeAmount || 3) > 1 ? 's' : ''} PREMIUM`} \r\n\t\t\t\t\t\t\t\t\t\t\t{t.prizeType==='cash' && t.status==='completed' && t.payoutStatus && (<span className={`ml-2 px-1.5 py-0.5 rounded ${t.payoutStatus==='paid'?'bg-emerald-600':'bg-amber-600'}`}>{t.payoutStatus}</span>)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t<div className=\"mt-2 flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn text-xs\" disabled={loading || t.status!=='scheduled'} onClick={()=>setWinner(t.id, prompt('Winner email?')||'')}>Set Winner</button>\r\n\t\t\t\t\t\t\t\t\t\t{t.prizeType==='cash' && t.status==='completed' && t.payoutStatus!=='paid' && (\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn text-xs\" disabled={loading} onClick={()=>markPaid(t.id)}>Mark Paid</button>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t<button className=\"btn text-xs\" disabled={loading} onClick={()=>reseedWeekly()}>Reseed</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t{tournaments.length===0 && <li className=\"opacity-60\">No tournaments.</li>}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{activeTab === 'helpdesk' && isOwner && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"card\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Helpdesk Requests</h3>\r\n\t\t\t\t\t\t<div className=\"text-sm opacity-80 mb-3\">Incoming requests from users who asked to speak with an admin. Claim to take over the chat.</div>\r\n\t\t\t\t\t\t{helpRequests.length === 0 ? (\r\n\t\t\t\t\t\t\t<div className=\"text-sm opacity-70\">No open requests.</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\r\n\t\t\t\t\t\t\t\t{helpRequests.map(hr => (\r\n\t\t\t\t\t\t\t\t\t<div key={hr.id} className=\"p-2 rounded bg-black/10 border border-white/10 flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium\">{hr.username || 'Anonymous'}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs opacity-70\">{new Date(hr.ts || 0).toLocaleString()}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm mt-1\">{hr.message}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t{helpTyping[hr.id] && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-amber-300 mt-1\">{helpTyping[hr.id].who} typing...</div>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t{hr.status === 'open' ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={() => claimHelp(hr.id)}>Claim</button>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs opacity-70\">{hr.status} by {hr.claimedBy || '—'}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn btn-ghost\" onClick={() => resolveHelp(hr.id)}>Resolve</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={() => setSelectedRequest(hr)}>Chat</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Inline email preview overlay */}\r\n\t\t\t{preview.open && (\r\n\t\t\t\t<div className=\"fixed inset-0 z-[1000]\" onClick={()=>setPreview({ open: false })}>\r\n\t\t\t\t\t<div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" />\r\n\t\t\t\t\t<div className=\"absolute inset-0 p-4 md:p-8 overflow-auto flex items-start md:items-center justify-center\">\r\n\t\t\t\t\t\t<div className=\"w-full max-w-3xl bg-[#0b1020] rounded-2xl border border-indigo-500/40 shadow-2xl\" onClick={e=>e.stopPropagation()}>\r\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between px-4 py-3 border-b border-indigo-500/20\">\r\n\t\t\t\t\t\t\t\t<div className=\"font-semibold\">Preview: {preview.kind}</div>\r\n\t\t\t\t\t\t\t\t<button className=\"btn\" onClick={()=>setPreview({ open: false })}>Close</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"p-0 bg-black/30\">\r\n\t\t\t\t\t\t\t\t<iframe title=\"Email Preview\" style={{ width: '100%', height: '70vh', border: '0', background: 'transparent' }} srcDoc={preview.html || ''} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"px-4 py-3 border-t border-indigo-500/20 text-xs opacity-70\">Click outside this panel or press Esc to close.</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t)\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { User, Settings, Volume2, Camera, Gamepad2, Eye, Mic, Save, Edit3, Shield, HelpCircle, MessageCircle, X, Send, ChevronDown } from 'lucide-react';\r\nimport { useUserSettings } from '../store/userSettings';\r\nimport { apiFetch } from '../utils/api';\r\n\r\nexport default function SettingsPanel({ user }: { user?: any }) {\r\n  const {\r\n    favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, avgMode,\r\n    autoStartOffline, rememberLastOffline, reducedMotion, compactHeader, allowSpectate,\r\n    cameraScale, cameraAspect, cameraFitMode, autoscoreProvider, autoscoreWsUrl, calibrationGuide,\r\n    preferredCameraId, preferredCameraLabel, cameraEnabled, offlineLayout, textSize, boxSize,\r\n    setFavoriteDouble, setCallerEnabled, setCallerVoice, setCallerVolume, setSpeakCheckoutOnly,\r\n    setAvgMode, setAutoStartOffline, setRememberLastOffline, setReducedMotion, setCompactHeader,\r\n    setAllowSpectate, setCameraScale, setCameraAspect, setCameraFitMode, setAutoscoreProvider, setAutoscoreWsUrl,\r\n    setCalibrationGuide, setPreferredCamera, setCameraEnabled, setOfflineLayout, setTextSize, setBoxSize,\r\n    dartTimerEnabled, dartTimerSeconds, setDartTimerEnabled, setDartTimerSeconds,\r\n    x01DoubleIn, setX01DoubleIn\r\n  } = useUserSettings();\r\n\r\n  // Achievements state\r\n  const [achievements, setAchievements] = useState([\r\n    { key: 'first180', label: 'First 180', unlocked: false, icon: '🎯', desc: 'Score 180 in a match.' },\r\n    { key: 'hundredGames', label: '100 Games Played', unlocked: false, icon: '🏅', desc: 'Play 100 games.' },\r\n    { key: 'tournamentWin', label: 'Tournament Winner', unlocked: false, icon: '🥇', desc: 'Win a tournament.' },\r\n    { key: 'bestLeg', label: 'Best Leg', unlocked: false, icon: '⚡', desc: 'Finish a leg in 12 darts or less.' },\r\n    { key: 'comeback', label: 'Comeback', unlocked: false, icon: '🔥', desc: 'Win after trailing by 3 legs.' },\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    setAchievements(prev => prev.map(a => ({\r\n      ...a,\r\n      unlocked: !!localStorage.getItem(`ndn:achieve:${a.key}:${uname}`)\r\n    })));\r\n  }, [user?.username]);\r\n\r\n  // Profile bio fields with edit mode\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [favPlayer, setFavPlayer] = useState('');\r\n  const [favTeam, setFavTeam] = useState('');\r\n  const [favDarts, setFavDarts] = useState('');\r\n  const [bio, setBio] = useState('');\r\n  const [profilePhoto, setProfilePhoto] = useState('');\r\n  const [allowAnalytics, setAllowAnalytics] = useState(true);\r\n  const [subscription, setSubscription] = useState<any>(null);\r\n\r\n  // Help Assistant state\r\n  const [helpMessages, setHelpMessages] = useState<Array<{text: string | {text: string, links?: Array<{text: string, tab: string}>}, isUser: boolean}>>([\r\n    { text: \"Hi! I'm your Nine Dart Nation assistant. How can I help you today?\", isUser: false }\r\n  ]);\r\n  const [helpInput, setHelpInput] = useState('');\r\n\r\n  useEffect(() => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    try {\r\n      setFavPlayer(localStorage.getItem(`ndn:bio:favPlayer:${uname}`) || '');\r\n      setFavTeam(localStorage.getItem(`ndn:bio:favTeam:${uname}`) || '');\r\n      setFavDarts(localStorage.getItem(`ndn:bio:favDarts:${uname}`) || '');\r\n      setBio(localStorage.getItem(`ndn:bio:bio:${uname}`) || '');\r\n      setProfilePhoto(localStorage.getItem(`ndn:bio:profilePhoto:${uname}`) || '');\r\n      setAllowAnalytics(localStorage.getItem(`ndn:settings:allowAnalytics:${uname}`) !== 'false');\r\n    } catch {}\r\n  }, [user?.username]);\r\n\r\n  useEffect(() => {\r\n    if (!user?.email) return;\r\n    apiFetch(`/api/subscription?email=${encodeURIComponent(user.email)}`)\r\n      .then(r => r.json())\r\n      .then(setSubscription)\r\n      .catch(() => {});\r\n  }, [user?.email]);\r\n\r\n  const saveBio = () => {\r\n    const uname = user?.username || '';\r\n    if (!uname) return;\r\n    try {\r\n      localStorage.setItem(`ndn:bio:favPlayer:${uname}`, favPlayer);\r\n      localStorage.setItem(`ndn:bio:favTeam:${uname}`, favTeam);\r\n      localStorage.setItem(`ndn:bio:favDarts:${uname}`, favDarts);\r\n      localStorage.setItem(`ndn:bio:bio:${uname}`, bio);\r\n      localStorage.setItem(`ndn:bio:profilePhoto:${uname}`, profilePhoto);\r\n      // Dispatch event to notify avatar update\r\n      try { window.dispatchEvent(new CustomEvent('ndn:avatar-updated', { detail: { username: uname, avatar: profilePhoto } })) } catch {}\r\n      localStorage.setItem(`ndn:settings:allowAnalytics:${uname}`, allowAnalytics.toString());\r\n      setIsEditing(false);\r\n    } catch {}\r\n  };\r\n\r\n  // Help Assistant functions\r\n  const faq = {\r\n    'how to play': 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n    'calibration': 'Go to Settings > Camera & Vision > Calibration Guide to set up your camera properly.',\r\n    'premium': 'Premium unlocks all game modes. Click the \"Upgrade to PREMIUM\" button in online play.',\r\n    'username': 'Change your username once for free in Settings > Account.',\r\n    'voice': 'Enable voice caller in Settings > Audio & Voice. Test the voice with the Test Voice button.',\r\n    'friends': 'Add friends in the Friends tab to play together.',\r\n    'stats': 'View your statistics in the Stats tab.',\r\n    'settings': 'Customize your experience in the Settings panel.',\r\n    'support': 'Contact support via email or check the FAQ in Settings > Support.',\r\n  };\r\n\r\n  const navigateToTab = (tabKey: string) => {\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: tabKey } }));\r\n    } catch (error) {\r\n      console.error('Navigation failed:', error);\r\n    }\r\n  };\r\n\r\n  const getResponseWithLinks = (userMessage: string): { text: string, links?: Array<{ text: string, tab: string }> } => {\r\n    const message = userMessage.toLowerCase();\r\n\r\n    if (message.includes('username') || message.includes('change name')) {\r\n      return {\r\n        text: 'You can change your username once for free.',\r\n        links: [{ text: 'Go to Settings > Account', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('premium') || message.includes('upgrade') || message.includes('subscription')) {\r\n      return {\r\n        text: 'Premium unlocks all game modes and features.',\r\n        links: [{ text: 'Go to Online Play', tab: 'online' }]\r\n      };\r\n    }\r\n    if (message.includes('calibrat') || message.includes('camera') || message.includes('vision')) {\r\n      return {\r\n        text: 'Set up your camera properly in Settings.',\r\n        links: [{ text: 'Go to Settings > Camera & Vision', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('voice') || message.includes('caller') || message.includes('audio')) {\r\n      return {\r\n        text: 'Enable voice calling in Settings.',\r\n        links: [{ text: 'Go to Settings > Audio & Voice', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('friend') || message.includes('play together')) {\r\n      return {\r\n        text: 'Add friends to play together.',\r\n        links: [{ text: 'Go to Friends', tab: 'friends' }]\r\n      };\r\n    }\r\n    if (message.includes('stat') || message.includes('score') || message.includes('performance')) {\r\n      return {\r\n        text: 'View your statistics and performance.',\r\n        links: [{ text: 'Go to Stats', tab: 'stats' }]\r\n      };\r\n    }\r\n    if (message.includes('setting') || message.includes('customiz') || message.includes('configur')) {\r\n      return {\r\n        text: 'Customize your experience.',\r\n        links: [{ text: 'Go to Settings', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('tournament') || message.includes('competition')) {\r\n      return {\r\n        text: 'Check out tournaments and competitions.',\r\n        links: [{ text: 'Go to Tournaments', tab: 'tournaments' }]\r\n      };\r\n    }\r\n    if (message.includes('help') || message.includes('support') || message.includes('faq')) {\r\n      return {\r\n        text: 'You\\'re already in the help section! Check the Support section above for more resources.',\r\n        links: [{ text: 'Scroll to Support', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('how to play') || message.includes('game') || message.includes('start')) {\r\n      return {\r\n        text: 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n        links: [\r\n          { text: 'Play Online', tab: 'online' },\r\n          { text: 'Play Offline', tab: 'offline' }\r\n        ]\r\n      };\r\n    }\r\n\r\n    return { text: \"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings.\" };\r\n  };\r\n\r\n  const handleHelpSend = () => {\r\n    if (!helpInput.trim()) return;\r\n    const userMessage = helpInput.toLowerCase();\r\n    setHelpMessages(prev => [...prev, { text: helpInput, isUser: true }]);\r\n    setHelpInput('');\r\n\r\n    // Get response with smart link suggestions\r\n    const response = getResponseWithLinks(userMessage);\r\n\r\n    setTimeout(() => {\r\n      setHelpMessages(prev => [...prev, { text: response, isUser: false }]);\r\n    }, 500);\r\n  };\r\n\r\n  // Username change state\r\n  const [newUsername, setNewUsername] = useState('')\r\n  const [changingUsername, setChangingUsername] = useState(false)\r\n  const [usernameError, setUsernameError] = useState('')\r\n\r\n  // Available voices for caller\r\n  const [availableVoices, setAvailableVoices] = useState<SpeechSynthesisVoice[]>([])\r\n\r\n  useEffect(() => {\r\n    const loadVoices = () => {\r\n      const voices = speechSynthesis.getVoices();\r\n      setAvailableVoices(voices.filter(v => v.lang.startsWith('en')));\r\n    };\r\n    loadVoices();\r\n    speechSynthesis.onvoiceschanged = loadVoices;\r\n  }, []);\r\n\r\n  // Highlights state\r\n  const [showHighlights, setShowHighlights] = useState(false);\r\n\r\n  // Collapsible pill state\r\n  const [expandedPill, setExpandedPill] = useState<'user' | 'calibration' | 'settings' | null>(null);\r\n\r\n  const PillButton = ({ label, icon: Icon, pill, color }: { label: string; icon: any; pill: 'user' | 'calibration' | 'settings'; color: string }) => (\r\n    <button\r\n      onClick={() => setExpandedPill(expandedPill === pill ? null : pill)}\r\n      type=\"button\"\r\n      className={`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] bg-gradient-to-r ${color} text-white flex items-center gap-2`}\r\n    >\r\n      <Icon className=\"w-4 h-4\" /> {label}\r\n      <ChevronDown className={`w-4 h-4 transition-transform ${expandedPill === pill ? 'rotate-180' : ''}`} />\r\n    </button>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* ==== USER INFO PILL ==== */}\r\n      <div className=\"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1\">\r\n        <div className=\"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1\">\r\n          <PillButton label=\"User Info\" icon={User} pill=\"user\" color=\"from-indigo-500 to-fuchsia-500 shadow-indigo-500/30\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* USER INFO CONTENT */}\r\n      {expandedPill === 'user' && (\r\n        <div className=\"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {/* Account */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-red-500/40 bg-red-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-red-100\">\r\n                  <User className=\"w-5 h-5\" /> Account\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex justify-center gap-2\">\r\n                    <button\r\n                      onClick={() => window.dispatchEvent(new CustomEvent('ndn:logout'))}\r\n                      className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n                    >\r\n                      Logout\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setShowHighlights(true)}\r\n                      className=\"px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white rounded-lg font-medium transition-colors\"\r\n                    >\r\n                      Highlights\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"border-t border-red-500/20 pt-3\">\r\n                    <div className=\"font-medium mb-2 text-red-100\">Change Username ({(() => {\r\n                      const count = user?.usernameChangeCount || 0;\r\n                      if (count < 2) return `${2 - count} free changes remaining`;\r\n                      return '£2 per change';\r\n                    })()})</div>\r\n                    <div className=\"text-sm text-red-100 mb-2\">You can change your username up to 2 times for free. Additional changes cost £2 each.</div>\r\n                    {user?.usernameChangeCount >= 2 && !newUsername.trim() ? (\r\n                      <div className=\"text-amber-400 text-sm mb-2\">⚠️ Additional username changes cost £2</div>\r\n                    ) : null}\r\n                    <input\r\n                      className=\"input w-full mb-2\"\r\n                      type=\"text\"\r\n                      placeholder=\"New username\"\r\n                      value={newUsername}\r\n                      onChange={e => setNewUsername(e.target.value)}\r\n                      disabled={changingUsername}\r\n                    />\r\n                    {usernameError && <div className=\"text-red-400 text-sm mb-2\">{usernameError}</div>}\r\n                    <button\r\n                      onClick={async () => {\r\n                        setUsernameError('')\r\n                        if (!newUsername.trim()) {\r\n                          setUsernameError('Username required')\r\n                          return\r\n                        }\r\n                        if (newUsername.length < 3 || newUsername.length > 20) {\r\n                          setUsernameError('Username must be 3-20 characters')\r\n                          return\r\n                        }\r\n                        const currentCount = user?.usernameChangeCount || 0;\r\n                        const isFree = currentCount < 2;\r\n                        if (!isFree) {\r\n                          window.location.href = 'https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02'\r\n                        } else {\r\n                          localStorage.setItem('pendingUsernameChange', newUsername.trim())\r\n                          window.location.href = '/?username-change=free'\r\n                        }\r\n                      }}\r\n                      disabled={changingUsername || !newUsername.trim()}\r\n                      className=\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors\"\r\n                    >\r\n                      {changingUsername ? 'Processing...' : (() => {\r\n                        const count = user?.usernameChangeCount || 0;\r\n                        return count < 2 ? 'Change Username (FREE)' : 'Change Username (£2)';\r\n                      })()}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Premium */}\r\n            {subscription && (\r\n              <div className=\"card\">\r\n                <div className=\"p-3 rounded-xl border border-green-500/40 bg-green-500/10\">\r\n                  <div className=\"font-semibold mb-4 flex items-center gap-2 text-green-100\">\r\n                    <Shield className=\"w-5 h-5\" /> Premium\r\n                  </div>\r\n                  <div className=\"space-y-3 text-sm text-green-100\">\r\n                    <div>Status: <span className={subscription?.status === 'active' ? 'text-green-400' : 'text-yellow-400'}>{subscription?.status === 'active' ? '✓ Active' : 'Not Active'}</span></div>\r\n                    {subscription?.status === 'active' && subscription?.nextBillingDate && (\r\n                      <div>Next Billing: {new Date(subscription.nextBillingDate).toLocaleDateString()}</div>\r\n                    )}\r\n                    {subscription?.source === 'tournament' && subscription?.status === 'active' && (\r\n                      <button\r\n                        onClick={() => window.location.href = 'https://buy.stripe.com/eVq4gB3XqeNS0iw6vAfnO02'}\r\n                        className=\"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-medium transition-colors text-xs\"\r\n                      >\r\n                        Cancel Subscription\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Profile Photo */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-cyan-100\">\r\n                  <Eye className=\"w-5 h-5\" /> Profile Photo\r\n                </div>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => {\r\n                    const file = e.target.files?.[0];\r\n                    if (file) {\r\n                      const reader = new FileReader();\r\n                      reader.onload = () => setProfilePhoto(reader.result as string);\r\n                      reader.readAsDataURL(file);\r\n                    }\r\n                  }}\r\n                  className=\"w-full text-xs text-slate-100\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Online & Socials */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-purple-100\">\r\n                  <MessageCircle className=\"w-5 h-5\" /> Online & Socials\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"allowSpectate\"\r\n                      checked={allowSpectate}\r\n                      onChange={e => setAllowSpectate(e.target.checked)}\r\n                      className=\"w-4 h-4\"\r\n                    />\r\n                    <label htmlFor=\"allowSpectate\" className=\"text-sm text-purple-100\">Allow spectators</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Data & Privacy */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-orange-500/40 bg-orange-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-orange-100\">\r\n                  <Shield className=\"w-5 h-5\" /> Data & Privacy\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"allowAnalytics\"\r\n                      checked={allowAnalytics}\r\n                      onChange={e => setAllowAnalytics(e.target.checked)}\r\n                      className=\"w-4 h-4\"\r\n                    />\r\n                    <label htmlFor=\"allowAnalytics\" className=\"text-sm text-orange-100\">Allow analytics</label>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      const data = { achievements, bio: { favPlayer, favTeam, favDarts, bio } };\r\n                      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n                      const url = URL.createObjectURL(blob);\r\n                      const a = document.createElement('a');\r\n                      a.href = url;\r\n                      a.download = `my-data-${new Date().toISOString().split('T')[0]}.json`;\r\n                      a.click();\r\n                      URL.revokeObjectURL(url);\r\n                    }}\r\n                    className=\"btn bg-orange-600 hover:bg-orange-700 w-full\"\r\n                  >\r\n                    Export My Data\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Privacy & Copyright Notice */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-red-500/40 bg-red-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                  <Shield className=\"w-5 h-5 text-red-400\" /> Privacy & Copyright\r\n                </div>\r\n                <div className=\"space-y-3 text-sm text-slate-300\">\r\n                  <div className=\"bg-red-500/20 border border-red-500/30 rounded-lg p-3\">\r\n                    <p className=\"font-semibold text-red-300 mb-2\">⚠️ Legal Notice</p>\r\n                    <p className=\"mb-2 text-xs\">\r\n                      <strong>Copyright:</strong> All content is protected by copyright law.\r\n                    </p>\r\n                    <p className=\"text-xs\">\r\n                      <strong>Privacy:</strong> Your data is protected and unauthorized access is prohibited.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Blocked Users */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-yellow-100\">\r\n                  <Shield className=\"w-5 h-5\" /> Blocked Users\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <p className=\"text-sm text-yellow-100\">Manage players you've blocked from contacting you.</p>\r\n                  <button\r\n                    onClick={() => window.dispatchEvent(new CustomEvent('ndn:open-blocklist'))}\r\n                    className=\"btn bg-yellow-600 hover:bg-yellow-700 w-full text-sm\"\r\n                  >\r\n                    View Blocked Users\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contact & Support */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-blue-100\">\r\n                  <MessageCircle className=\"w-5 h-5\" /> Contact & Support\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <a\r\n                    href=\"mailto:support@ninedartnation.com\"\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm\"\r\n                  >\r\n                    📧 Email Support\r\n                  </a>\r\n                  <a\r\n                    href=\"https://ninedartnation.com/help\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm\"\r\n                  >\r\n                    ❓ Help Center\r\n                  </a>\r\n                  <a\r\n                    href=\"https://ninedartnation.com/faq\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors text-sm\"\r\n                  >\r\n                    📋 FAQ\r\n                  </a>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Account Deletion */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-red-500/40 bg-red-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2 text-red-100\">\r\n                  <Shield className=\"w-5 h-5\" /> Delete Account\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"bg-red-500/20 border border-red-500/30 rounded-lg p-3 text-xs text-red-200\">\r\n                    <p className=\"font-semibold mb-1\">⚠️ Warning</p>\r\n                    <p>Deleting your account is permanent and cannot be undone. All your stats, achievements, and data will be erased.</p>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      const confirm = window.confirm(\r\n                        'Are you absolutely sure you want to delete your account? This action cannot be undone.\\n\\nAll your stats, achievements, and data will be permanently erased.'\r\n                      );\r\n                      if (confirm) {\r\n                        const finalConfirm = window.confirm(\r\n                          'This is your final warning. Click OK to permanently delete your account.'\r\n                        );\r\n                        if (finalConfirm) {\r\n                          window.dispatchEvent(new CustomEvent('ndn:delete-account'));\r\n                        }\r\n                      }\r\n                    }}\r\n                    className=\"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n                  >\r\n                    Permanently Delete Account\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* ==== CALIBRATION PILL ==== */}\r\n      <div className=\"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1\">\r\n        <div className=\"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1\">\r\n          <PillButton label=\"Calibration\" icon={Camera} pill=\"calibration\" color=\"from-purple-500 to-pink-500 shadow-purple-500/30\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* CALIBRATION CONTENT */}\r\n      {expandedPill === 'calibration' && (\r\n        <div className=\"p-6 rounded-2xl border border-white/10 bg-white/[0.02] animate-in fade-in duration-200 space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {/* Camera & Vision */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                  <Camera className=\"w-5 h-5 text-blue-400\" /> Camera & Vision\r\n                </div>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"cameraEnabled\"\r\n                      checked={cameraEnabled}\r\n                      onChange={e => setCameraEnabled(e.target.checked)}\r\n                      className=\"w-4 h-4\"\r\n                    />\r\n                    <label htmlFor=\"cameraEnabled\" className=\"text-sm\">Enable camera</label>\r\n                  </div>\r\n                  {cameraEnabled && (\r\n                    <>\r\n                      <div>\r\n                        <label htmlFor=\"cameraScale\" className=\"block text-sm mb-2\">Scale: {cameraScale?.toFixed(2)}</label>\r\n                        <input\r\n                          type=\"range\"\r\n                          id=\"cameraScale\"\r\n                          min=\"0.5\"\r\n                          max=\"3\"\r\n                          step=\"0.1\"\r\n                          value={cameraScale || 1}\r\n                          onChange={e => setCameraScale(parseFloat(e.target.value))}\r\n                          className=\"w-full\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label htmlFor=\"cameraAspect\" className=\"block text-sm mb-2\">Aspect Ratio</label>\r\n                        <select\r\n                          id=\"cameraAspect\"\r\n                          value={cameraAspect || 'wide'}\r\n                          onChange={e => setCameraAspect(e.target.value as 'wide' | 'square')}\r\n                          className=\"input w-full\"\r\n                        >\r\n                          <option value=\"wide\">Wide (16:9)</option>\r\n                          <option value=\"square\">Square (1:1)</option>\r\n                        </select>\r\n                      </div>\r\n                      <div>\r\n                        <label htmlFor=\"cameraFitMode\" className=\"block text-sm mb-2\">Fit Mode</label>\r\n                        <select\r\n                          id=\"cameraFitMode\"\r\n                          value={cameraFitMode || 'fit'}\r\n                          onChange={e => setCameraFitMode(e.target.value as 'fill' | 'fit')}\r\n                          className=\"input w-full\"\r\n                        >\r\n                          <option value=\"fill\">Fill (crop)</option>\r\n                          <option value=\"fit\">Fit (letterbox)</option>\r\n                        </select>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => {}}\r\n                        className=\"btn bg-indigo-600 hover:bg-indigo-700 w-full\"\r\n                      >\r\n                        Calibration Guide\r\n                      </button>\r\n                      <div>\r\n                        <label htmlFor=\"autoscoreProvider\" className=\"block text-sm mb-2\">Auto-score Provider</label>\r\n                        <select\r\n                          id=\"autoscoreProvider\"\r\n                          value={autoscoreProvider || 'manual'}\r\n                          onChange={e => setAutoscoreProvider(e.target.value as 'manual' | 'built-in' | 'external-ws')}\r\n                          className=\"input w-full\"\r\n                        >\r\n                          <option value=\"manual\">Manual Scoring</option>\r\n                          <option value=\"built-in\">Built-in Vision</option>\r\n                          <option value=\"external-ws\">External (WebSocket)</option>\r\n                        </select>\r\n                      </div>\r\n                      {autoscoreProvider === 'external-ws' && (\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"WebSocket URL\"\r\n                          value={autoscoreWsUrl || ''}\r\n                          onChange={e => setAutoscoreWsUrl(e.target.value)}\r\n                          className=\"input w-full text-xs\"\r\n                        />\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Audio & Voice */}\r\n            <div className=\"card\">\r\n              <div className=\"p-3 rounded-xl border border-purple-500/40 bg-purple-500/10\">\r\n                <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                  <Volume2 className=\"w-5 h-5 text-purple-400\" /> Audio & Voice\r\n                </div>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"callerEnabled\"\r\n                      checked={callerEnabled}\r\n                      onChange={e => setCallerEnabled(e.target.checked)}\r\n                      className=\"w-4 h-4\"\r\n                    />\r\n                    <label htmlFor=\"callerEnabled\" className=\"text-sm\">Enable voice caller</label>\r\n                  </div>\r\n                  {callerEnabled && (\r\n                    <>\r\n                      <div>\r\n                        <label htmlFor=\"callerVoice\" className=\"block text-sm mb-2\">Voice</label>\r\n                        <select\r\n                          id=\"callerVoice\"\r\n                          value={callerVoice || ''}\r\n                          onChange={e => setCallerVoice(e.target.value)}\r\n                          className=\"input w-full text-xs\"\r\n                        >\r\n                          <option value=\"\">Default</option>\r\n                          {availableVoices.map((v, i) => (\r\n                            <option key={i} value={v.voiceURI}>{v.name}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                      <div>\r\n                        <label htmlFor=\"callerVolume\" className=\"block text-sm mb-2\">Volume: {Math.round((callerVolume || 1) * 100)}%</label>\r\n                        <input\r\n                          type=\"range\"\r\n                          id=\"callerVolume\"\r\n                          min=\"0\"\r\n                          max=\"1\"\r\n                          step=\"0.1\"\r\n                          value={callerVolume || 1}\r\n                          onChange={e => setCallerVolume(parseFloat(e.target.value))}\r\n                          className=\"w-full\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          id=\"speakCheckoutOnly\"\r\n                          checked={speakCheckoutOnly}\r\n                          onChange={e => setSpeakCheckoutOnly(e.target.checked)}\r\n                          className=\"w-4 h-4\"\r\n                        />\r\n                        <label htmlFor=\"speakCheckoutOnly\" className=\"text-sm\">Only speak checkout scores</label>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => {\r\n                          const utterance = new SpeechSynthesisUtterance('Test voice. One hundred and eighty!');\r\n                          utterance.voice = availableVoices.find(v => v.voiceURI === callerVoice) || null;\r\n                          utterance.volume = callerVolume || 1;\r\n                          speechSynthesis.cancel();\r\n                          speechSynthesis.speak(utterance);\r\n                        }}\r\n                        className=\"btn bg-purple-600 hover:bg-purple-700 w-full\"\r\n                      >\r\n                        Test Voice\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* ==== SETTINGS SECTIONS PILL ==== */}\r\n      <div className=\"relative rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-1\">\r\n        <div className=\"flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-1\">\r\n          <PillButton label=\"Settings\" icon={Settings} pill=\"settings\" color=\"from-cyan-500 to-blue-500 shadow-cyan-500/30\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* SETTINGS CONTENT */}\r\n      {expandedPill === 'settings' && (\r\n        <div className=\"space-y-4 animate-in fade-in duration-200\">\r\n\r\n          {/* Profile Bio */}\r\n          <div className=\"card\">\r\n            <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <div className=\"font-semibold flex items-center gap-2\">\r\n                  <User className=\"w-5 h-5 text-brand-400\" /> Profile Bio\r\n                </div>\r\n                {!isEditing ? (\r\n                  <button\r\n                    onClick={() => setIsEditing(true)}\r\n                    className=\"flex items-center gap-2 px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-400 text-sm transition-colors\"\r\n                  >\r\n                    <Edit3 className=\"w-4 h-4\" /> Edit\r\n                  </button>\r\n                ) : (\r\n                  <button\r\n                    onClick={saveBio}\r\n                    className=\"flex items-center gap-2 px-3 py-1 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-green-400 text-sm transition-colors\"\r\n                  >\r\n                    <Save className=\"w-4 h-4\" /> Save\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                {isEditing ? (\r\n                  <>\r\n                    <div>\r\n                      <label className=\"block text-sm mb-1\">Favorite Player</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={favPlayer}\r\n                        onChange={e => setFavPlayer(e.target.value)}\r\n                        className=\"input w-full\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm mb-1\">Favorite Team</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={favTeam}\r\n                        onChange={e => setFavTeam(e.target.value)}\r\n                        className=\"input w-full\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm mb-1\">Favorite Darts</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={favDarts}\r\n                        onChange={e => setFavDarts(e.target.value)}\r\n                        className=\"input w-full\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm mb-1\">Bio / Quote</label>\r\n                      <textarea\r\n                        value={bio}\r\n                        onChange={e => setBio(e.target.value)}\r\n                        rows={3}\r\n                        className=\"input w-full\"\r\n                      />\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <div>Favorite Player: <span className=\"text-brand-300\">{favPlayer || 'Not set'}</span></div>\r\n                    <div>Favorite Team: <span className=\"text-brand-300\">{favTeam || 'Not set'}</span></div>\r\n                    <div>Favorite Darts: <span className=\"text-brand-300\">{favDarts || 'Not set'}</span></div>\r\n                    <div>Bio: <span className=\"text-brand-300\">{bio || 'No bio set'}</span></div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Game Preferences */}\r\n          <div className=\"card\">\r\n            <div className=\"p-3 rounded-xl border border-green-500/40 bg-green-500/10\">\r\n              <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                <Gamepad2 className=\"w-5 h-5 text-green-400\" /> Game Preferences\r\n              </div>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"dartTimerEnabled\"\r\n                    checked={!!dartTimerEnabled}\r\n                    onChange={e => setDartTimerEnabled(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"dartTimerEnabled\" className=\"text-sm\">Enable per-dart throw timer</label>\r\n                </div>\r\n                {dartTimerEnabled && (\r\n                  <div>\r\n                    <label className=\"block mb-2 text-sm font-medium\">Time per throw: {dartTimerSeconds ? Math.round(dartTimerSeconds) : 0}s</label>\r\n                    <input\r\n                      type=\"range\"\r\n                      min=\"3\"\r\n                      max=\"30\"\r\n                      value={dartTimerSeconds || 10}\r\n                      onChange={e => setDartTimerSeconds(parseInt(e.target.value))}\r\n                      className=\"w-full\"\r\n                    />\r\n                    <div className=\"text-xs opacity-70 mt-1\">When the timer reaches zero, the dart is recorded as a miss and advances to the next throw.</div>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <label htmlFor=\"favoriteDouble\" className=\"block text-sm mb-2\">Favorite Finish Double</label>\r\n                  <select\r\n                    id=\"favoriteDouble\"\r\n                    value={favoriteDouble}\r\n                    onChange={e => setFavoriteDouble(e.target.value)}\r\n                    className=\"input w-full\"\r\n                  >\r\n                    <option value=\"any\">Any Double</option>\r\n                    <option value=\"D20\">Double 20</option>\r\n                    <option value=\"D10\">Double 10</option>\r\n                    <option value=\"D5\">Double 5</option>\r\n                    <option value=\"D1\">Double 1</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"avgMode\" className=\"block text-sm mb-2\">Average Display Mode</label>\r\n                  <select\r\n                    id=\"avgMode\"\r\n                    value={avgMode}\r\n                    onChange={e => setAvgMode(e.target.value as 'all-time' | '24h')}\r\n                    className=\"input w-full\"\r\n                  >\r\n                    <option value=\"all-time\">All Time Average</option>\r\n                    <option value=\"24h\">24 Hour Average</option>\r\n                  </select>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"x01DoubleIn\"\r\n                    checked={!!x01DoubleIn}\r\n                    onChange={e => setX01DoubleIn(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"x01DoubleIn\" className=\"text-sm\">Require Double-In for X01</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* UI & Accessibility */}\r\n          <div className=\"card\">\r\n            <div className=\"p-3 rounded-xl border border-pink-500/40 bg-pink-500/10\">\r\n              <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                <Eye className=\"w-5 h-5 text-pink-400\" /> UI & Accessibility\r\n              </div>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"autoStartOffline\"\r\n                    checked={autoStartOffline}\r\n                    onChange={e => setAutoStartOffline(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"autoStartOffline\" className=\"text-sm\">Auto-start offline games</label>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"rememberLastOffline\"\r\n                    checked={rememberLastOffline}\r\n                    onChange={e => setRememberLastOffline(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"rememberLastOffline\" className=\"text-sm\">Remember last offline game settings</label>\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"offlineLayout\" className=\"block text-sm mb-2\">Offline Layout</label>\r\n                  <select\r\n                    id=\"offlineLayout\"\r\n                    value={offlineLayout || 'classic'}\r\n                    onChange={e => setOfflineLayout(e.target.value as 'classic' | 'modern')}\r\n                    className=\"input w-full\"\r\n                  >\r\n                    <option value=\"classic\">Classic Layout</option>\r\n                    <option value=\"modern\">Modern Layout</option>\r\n                  </select>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"reducedMotion\"\r\n                    checked={reducedMotion}\r\n                    onChange={e => setReducedMotion(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"reducedMotion\" className=\"text-sm\">Reduce motion/animations</label>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"compactHeader\"\r\n                    checked={compactHeader}\r\n                    onChange={e => setCompactHeader(e.target.checked)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <label htmlFor=\"compactHeader\" className=\"text-sm\">Compact header</label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Support & Help */}\r\n          <div className=\"card\">\r\n            <div className=\"p-3 rounded-xl border border-blue-500/40 bg-blue-500/10\">\r\n              <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                <HelpCircle className=\"w-5 h-5 text-blue-400\" /> Support & Help\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <p className=\"text-sm opacity-80\">Need help? Contact us via email:</p>\r\n                <a href=\"mailto:support@ninedartnation.com\" className=\"btn bg-blue-600 hover:bg-blue-700 w-full text-xs\">\r\n                  Email Support\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Help Assistant */}\r\n          <div className=\"card\">\r\n            <div className=\"p-3 rounded-xl border border-cyan-500/40 bg-cyan-500/10\">\r\n              <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n                <MessageCircle className=\"w-5 h-5 text-cyan-400\" /> Help Assistant\r\n              </div>\r\n              <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n                {helpMessages.map((msg, i) => (\r\n                  <div key={i} className={`${msg.isUser ? 'text-right' : ''}`}>\r\n                    <div className={`inline-block max-w-xs px-3 py-2 rounded-lg text-sm ${msg.isUser ? 'bg-indigo-600 text-white' : 'bg-white/10 text-slate-100'}`}>\r\n                      {typeof msg.text === 'string' ? msg.text : (\r\n                        <>\r\n                          <div>{msg.text.text}</div>\r\n                          {msg.text.links && (\r\n                            <div className=\"mt-2 space-y-1\">\r\n                              {msg.text.links.map((link, j) => (\r\n                                <button\r\n                                  key={j}\r\n                                  onClick={() => navigateToTab(link.tab)}\r\n                                  className=\"block w-full text-left text-xs px-2 py-1 bg-white/20 hover:bg-white/30 rounded transition\"\r\n                                >\r\n                                  {link.text}\r\n                                </button>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Input */}\r\n              <div className=\"flex gap-2 mt-3\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={helpInput}\r\n                  onChange={(e) => setHelpInput(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && handleHelpSend()}\r\n                  placeholder=\"Ask me anything...\"\r\n                  className=\"flex-1 input\"\r\n                />\r\n                <button\r\n                  onClick={handleHelpSend}\r\n                  className=\"btn bg-blue-600 hover:bg-blue-700\"\r\n                >\r\n                  <Send className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      )}\r\n\r\n      {/* ==== ACHIEVEMENTS & BADGES (ALWAYS VISIBLE) ==== */}\r\n      <div className=\"card\">\r\n        <div className=\"p-3 rounded-xl border border-yellow-500/40 bg-yellow-500/10\">\r\n          <div className=\"font-semibold mb-4 flex items-center gap-2\">\r\n            <HelpCircle className=\"w-5 h-5 text-yellow-400\" /> Achievements & Badges\r\n          </div>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n            {achievements.map(a => (\r\n              <div\r\n                key={a.key}\r\n                className={`p-3 rounded-lg border ${a.unlocked ? 'border-yellow-500/40 bg-yellow-500/10' : 'border-white/10 bg-white/5'}`}\r\n                title={a.desc}\r\n              >\r\n                <div className=\"text-lg\">{a.icon}</div>\r\n                <div className=\"text-xs font-semibold mt-1\">{a.label}</div>\r\n                <div className=\"text-[10px] opacity-70\">{a.unlocked ? '✓ Unlocked' : 'Locked'}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n","import { useState } from 'react';\r\nimport { Eye, EyeOff, Trophy, Users, BarChart3, ShieldCheck, MessageCircle } from 'lucide-react';\r\n\r\n// Demo-only admin credentials. Allow build-time override via Vite env vars so\r\n// deployments (e.g., Netlify) can set their own values without editing code.\r\n// SECURITY NOTE: These live in the client bundle and are NOT secure; for demo only.\r\nconst ADMIN_EMAIL = ((import.meta as any).env?.VITE_ADMIN_EMAIL as string) || 'daviesfamily108@gmail.com';\r\nconst ADMIN_USERNAME = ((import.meta as any).env?.VITE_ADMIN_USERNAME as string) || 'DartsWithG';\r\nconst ADMIN_PASSWORD = ((import.meta as any).env?.VITE_ADMIN_PASSWORD as string) || 'Cymru-2015';\r\n\r\nfunction validatePassword(password: string) {\r\n  return password.length >= 10 && /\\d/.test(password) && /[^A-Za-z0-9]/.test(password);\r\n}\r\n\r\nexport default function Auth({ onAuth }: { onAuth: (user: any) => void }) {\r\n  const [mode, setMode] = useState<'signin' | 'signup' | 'reset'>('signin');\r\n  const [email, setEmail] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [reminder, setReminder] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Use VITE_API_URL for API requests, fallback to relative path for local dev\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n\r\n  async function handleSignIn(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!username || !password) {\r\n      setError('Username and password required.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`${API_URL}/api/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(username.includes('@') ? { email: username, password } : { username, password })\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && data?.user && data?.token) {\r\n        localStorage.setItem('authToken', data.token);\r\n        onAuth(data.user);\r\n      } else {\r\n        setError(data?.error || 'Invalid username or password.');\r\n      }\r\n    } catch {\r\n      setError('Network error.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSignUp(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !username || !password) {\r\n      setError('Email, username, and password required.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      const res = await fetch(`${API_URL}/api/auth/signup`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, username, password })\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && data?.user && data?.token) {\r\n        localStorage.setItem('authToken', data.token);\r\n        onAuth(data.user);\r\n      } else {\r\n        setError(data?.error || 'Signup failed.');\r\n      }\r\n    } catch {\r\n      setError('Network error.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleReset(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !email.includes('@')) { setError('Enter your email address.'); setLoading(false); return }\r\n    try {\r\n      const r = await fetch(`${API_URL}/api/auth/send-reset`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Failed to send reset email')\r\n      setError('Password reset link sent to your email.');\r\n    } catch (err: any) {\r\n      setError(err?.message || 'Failed to send reset email');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSendUsername(e: any) {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    if (!email || !email.includes('@')) { setError('Enter your email address.'); setLoading(false); return }\r\n    try {\r\n      const r = await fetch(`${API_URL}/api/auth/send-username`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Failed to send username email')\r\n      setError('Your username has been emailed to you.');\r\n    } catch (err: any) {\r\n      setError(err?.message || 'Failed to send username email');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center relative overflow-hidden\">\r\n      {/* Animated background accents */}\r\n      <div className=\"background-animated\" />\r\n      <div className=\"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 p-4\">\r\n        {/* Auth Card */}\r\n        <form className=\"card w-full space-y-4\" onSubmit={mode === 'signin' ? handleSignIn : mode === 'signup' ? handleSignUp : handleReset}>\r\n          <div className=\"flex flex-col items-center justify-center gap-2 mb-2 text-center\">\r\n            <h1 className=\"logo text-center\">NINE-DART-NATION 🎯</h1>\r\n            <span className=\"badge\">Welcome</span>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold\">{mode === 'signin' ? 'Sign In' : mode === 'signup' ? 'Create Account' : 'Reset Password'}</h2>\r\n          {(mode === 'signup' || mode === 'reset') && (\r\n            <input className=\"input w-full\" type=\"email\" placeholder=\"Email\" value={email} onChange={e => setEmail(e.target.value)} required />\r\n          )}\r\n          {mode !== 'reset' && (\r\n        <input className=\"input w-full\" type=\"text\" placeholder=\"Username or Email\" value={username} onChange={e => setUsername(e.target.value)} required />\r\n          )}\r\n          {mode !== 'reset' && (\r\n            <div className=\"relative\">\r\n              <input\r\n                className=\"input w-full pr-10\"\r\n                type={showPassword ? 'text' : 'password'}\r\n                placeholder=\"Password\"\r\n                value={password}\r\n                onChange={e => setPassword(e.target.value)}\r\n                autoComplete=\"current-password\"\r\n                required\r\n                onFocus={() => setShowPassword(false)}\r\n                onBlur={() => setShowPassword(false)}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white\"\r\n                tabIndex={-1}\r\n                onMouseDown={e => { e.preventDefault(); setShowPassword(true); }}\r\n                onMouseUp={e => { e.preventDefault(); setShowPassword(false); }}\r\n                onMouseLeave={() => setShowPassword(false)}\r\n                onTouchStart={e => { e.preventDefault(); setShowPassword(true); }}\r\n                onTouchEnd={e => { e.preventDefault(); setShowPassword(false); }}\r\n                aria-label=\"Toggle password visibility\"\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n          )}\r\n          {mode === 'signup' && (\r\n            <input className=\"input w-full\" type=\"text\" placeholder=\"Password Reminder (optional)\" value={reminder} onChange={e => setReminder(e.target.value)} />\r\n          )}\r\n          {error && <div className=\"text-red-400 font-semibold text-sm\">{error}</div>}\r\n          <button className=\"btn w-full\" type=\"submit\" disabled={loading}>{loading ? 'Signing In...' : (mode === 'signin' ? 'Sign In' : mode === 'signup' ? 'Sign Up' : 'Send Reset Link')}</button>\r\n          {mode === 'reset' && (\r\n            <button className=\"btn w-full mt-2 bg-white/10 hover:bg-white/20\" type=\"button\" onClick={handleSendUsername} disabled={loading}>Email me my username</button>\r\n          )}\r\n          <div className=\"flex justify-between text-sm mt-2\">\r\n            <button type=\"button\" className=\"underline\" onClick={() => setMode(mode === 'signin' ? 'signup' : 'signin')} disabled={loading}>{mode === 'signin' ? 'Need an account? Sign Up' : 'Already have an account? Sign In'}</button>\r\n            <button type=\"button\" className=\"underline\" onClick={() => setMode('reset')} disabled={loading}>Forgot password?</button>\r\n          </div>\r\n        </form>\r\n\r\n        {/* Hints / Teaser Panel */}\r\n        <aside className=\"card w-full\">\r\n          <h3 className=\"text-xl font-bold mb-3\">What’s inside</h3>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-start gap-3\"><Users className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Online & Friends</div>\r\n                <div className=\"text-sm text-slate-200/90\">Challenge friends, chat, and join leagues.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><BarChart3 className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Deep Stats</div>\r\n                <div className=\"text-sm text-slate-200/90\">Track 3-dart averages, best legs, and more.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><Trophy className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Game Modes</div>\r\n                <div className=\"text-sm text-slate-200/90\">Start with 3 free online games upon signup. After that, PREMIUM is required to play all games.</div>\r\n              </div>\r\n            </li>\r\n            <li className=\"flex items-start gap-3\"><ShieldCheck className=\"w-5 h-5 text-indigo-300 mt-1\" />\r\n              <div>\r\n                <div className=\"font-semibold\">Premium Perks</div>\r\n                <div className=\"text-sm text-slate-200/90\">Polished UI, upcoming features, and early access.</div>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n          <a\r\n            href={(import.meta as any).env?.VITE_DISCORD_INVITE_URL || 'https://discord.gg/8GtbZ6RU'}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"btn mt-4 flex items-center justify-center gap-2\"\r\n          >\r\n            <MessageCircle className=\"w-5 h-5\" /> Join BullseyeDartsLeague\r\n          </a>\r\n          <a\r\n            href=\"https://discord.gg/NineDartNation\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"btn mt-2 flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20\"\r\n          >\r\n            <MessageCircle className=\"w-5 h-5\" /> Join NineDartNation\r\n          </a>\r\n        </aside>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { createContext, useContext, useEffect, useState } from 'react';\r\n\r\nconst ThemeContext = createContext({\r\n  theme: 'default',\r\n  setTheme: (t: string) => {},\r\n});\r\n\r\nconst THEME_KEY = 'ndn_theme'\r\n\r\nexport function ThemeProvider({ children }: { children: any }) {\r\n  const [theme, setTheme] = useState('default');\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const saved = localStorage.getItem(THEME_KEY)\r\n      if (saved) setTheme(saved)\r\n    } catch {}\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    try { localStorage.setItem(THEME_KEY, theme) } catch {}\r\n  }, [theme])\r\n  return (\r\n    <ThemeContext.Provider value={{ theme, setTheme }}>\r\n      <div className={`theme-${theme}`}>{children}</div>\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  return useContext(ThemeContext);\r\n}\r\n","import ResizableModal from './ui/ResizableModal'\r\nimport type { Player, Leg } from '../store/match'\r\n\r\nfunction computeTotals(p: Player) {\r\n  let points = 0\r\n  let darts = 0\r\n  let bestLeg: number | null = null\r\n  let worstLeg: number | null = null\r\n  let oneEighties = 0\r\n  for (const L of (p.legs || [])) {\r\n    points += (L.totalScoreStart - L.totalScoreRemaining)\r\n    const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n    darts += legDarts\r\n    if (L.finished) {\r\n      if (bestLeg === null || L.dartsThrown < bestLeg) bestLeg = L.dartsThrown\r\n      if (worstLeg === null || L.dartsThrown > worstLeg) worstLeg = L.dartsThrown\r\n    }\r\n    // Count 180s: any visit with 180 points\r\n    for (const v of (L.visits || [])) {\r\n      if ((v?.score || 0) === 180) oneEighties += 1\r\n    }\r\n  }\r\n  const threeDA = darts > 0 ? (points / darts) * 3 : 0\r\n  const nineDA = threeDA * 3\r\n  return { points, darts, threeDA, nineDA, bestLeg, worstLeg, oneEighties }\r\n}\r\n\r\nexport default function MatchSummaryModal({\r\n  open,\r\n  onClose,\r\n  title = 'Match Summary',\r\n  players,\r\n  centerScore,\r\n  doublesStats,\r\n  allowRematch,\r\n  onRematch,\r\n}: {\r\n  open: boolean\r\n  onClose: () => void\r\n  title?: string\r\n  players: Player[]\r\n  centerScore?: string\r\n  doublesStats?: Record<string, { dartsAtDouble?: number; doublesHit?: number }>\r\n  allowRematch?: boolean\r\n  onRematch?: () => void\r\n}) {\r\n  if (!open) return null\r\n  const cards = players.map(p => {\r\n    const t = computeTotals(p)\r\n    const dbl = doublesStats?.[p.id] || {}\r\n    const att = Math.max(0, Number(dbl.dartsAtDouble || 0))\r\n    const hit = Math.max(0, Number(dbl.doublesHit || 0))\r\n    const pct = att > 0 ? Math.round((hit/att)*100) : null\r\n    return { id: p.id, name: p.name, legsWon: p.legsWon, ...t, dartsAtDouble: att, doublesHit: hit, doublePct: pct }\r\n  })\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-[120]\">\r\n      <ResizableModal\r\n        storageKey=\"ndn:modal:match-summary\"\r\n        className=\"w-full relative\"\r\n        defaultWidth={860}\r\n        defaultHeight={540}\r\n        minWidth={640}\r\n        minHeight={420}\r\n        maxWidth={1400}\r\n        maxHeight={1000}\r\n        initialFitHeight\r\n      >\r\n        <h3 className=\"text-xl font-extrabold mb-2\">{title}</h3>\r\n        <div className=\"text-xs opacity-80 mb-3\">Players: {players.map(p=>p.name).join(' vs ')}</div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n          {cards[0] && (\r\n            <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n              <div className=\"text-sm font-semibold mb-1\">{cards[0].name}</div>\r\n              <div className=\"text-3xl font-extrabold\">{cards[0].legsWon}</div>\r\n              <div className=\"text-xs opacity-80\">Legs Won</div>\r\n              <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{cards[0].threeDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{cards[0].nineDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{cards[0].dartsAtDouble ?? '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{cards[0].doublePct !== null && cards[0].doublePct !== undefined ? `${cards[0].doublePct}%` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{cards[0].bestLeg ? `${cards[0].bestLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{cards[0].worstLeg ? `${cards[0].worstLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{cards[0].oneEighties}</div></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"hidden md:flex items-center justify-center\">\r\n            <div className=\"text-4xl font-black\">{centerScore || (players.length===2 ? `${cards[0]?.legsWon ?? 0} – ${cards[1]?.legsWon ?? 0}` : '')}</div>\r\n          </div>\r\n          {cards[1] && (\r\n            <div className=\"p-3 rounded-2xl glass border border-white/10\">\r\n              <div className=\"text-sm font-semibold mb-1\">{cards[1].name}</div>\r\n              <div className=\"text-3xl font-extrabold\">{cards[1].legsWon}</div>\r\n              <div className=\"text-xs opacity-80\">Legs Won</div>\r\n              <div className=\"mt-3 grid grid-cols-2 gap-2 text-sm\">\r\n                <div><span className=\"opacity-70\">Final 3DA</span><div className=\"font-semibold\">{cards[1].threeDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Final 9DA</span><div className=\"font-semibold\">{cards[1].nineDA.toFixed(1)}</div></div>\r\n                <div><span className=\"opacity-70\">Darts At Double</span><div className=\"font-semibold\">{cards[1].dartsAtDouble ?? '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Double %</span><div className=\"font-semibold\">{cards[1].doublePct !== null && cards[1].doublePct !== undefined ? `${cards[1].doublePct}%` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Best Dart Leg</span><div className=\"font-semibold\">{cards[1].bestLeg ? `${cards[1].bestLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">Worst Dart Leg</span><div className=\"font-semibold\">{cards[1].worstLeg ? `${cards[1].worstLeg} darts` : '—'}</div></div>\r\n                <div><span className=\"opacity-70\">180's Hit</span><div className=\"font-semibold\">{cards[1].oneEighties}</div></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n          <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={onClose}>Close</button>\r\n          {allowRematch && <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={onRematch}>Rematch</button>}\r\n        </div>\r\n      </ResizableModal>\r\n    </div>\r\n  )\r\n}\r\n","import { create } from 'zustand'\r\n\r\ntype BlockState = {\r\n  blocked: Record<string, number> // email/username -> ts\r\n  isBlocked: (id: string) => boolean\r\n  block: (id: string) => void\r\n  unblock: (id: string) => void\r\n  all: () => string[]\r\n}\r\n\r\nconst LS = 'ndn:blocked:v1'\r\n\r\nfunction load(): Record<string, number> {\r\n  try { const raw = localStorage.getItem(LS); return raw ? JSON.parse(raw) : {} } catch { return {} }\r\n}\r\nfunction save(map: Record<string, number>) {\r\n  try { localStorage.setItem(LS, JSON.stringify(map)) } catch {}\r\n}\r\n\r\nexport const useBlocklist = create<BlockState>((set, get) => ({\r\n  blocked: load(),\r\n  isBlocked: (id) => !!get().blocked[(id||'').toLowerCase()],\r\n  block: (id) => set((s) => { const map = { ...s.blocked }; map[(id||'').toLowerCase()] = Date.now(); save(map); return { blocked: map } }),\r\n  unblock: (id) => set((s) => { const map = { ...s.blocked }; delete map[(id||'').toLowerCase()]; save(map); return { blocked: map } }),\r\n  all: () => Object.keys(get().blocked),\r\n}))\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { useMatch } from '../store/match'\r\nimport CameraView from './CameraView'\r\nimport CameraTile from './CameraTile'\r\nimport ResizablePanel from './ui/ResizablePanel'\r\nimport { suggestCheckouts, sayScore } from '../utils/checkout'\r\nimport { addSample, getAllTimeAvg } from '../store/profileStats'\r\nimport { getFreeRemaining, incOnlineUsage } from '../utils/quota'\r\nimport { useUserSettings } from '../store/userSettings'\r\nimport { useCalibration } from '../store/calibration'\r\nimport GameCalibrationStatus from './GameCalibrationStatus'\r\nimport MatchSummaryModal from './MatchSummaryModal'\r\nimport { freeGames, premiumGames, allGames, type GameKey } from '../utils/games'\r\nimport { getUserCurrency, formatPriceInCurrency } from '../utils/config'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport GameHeaderBar from './ui/GameHeaderBar'\r\nimport { useToast } from '../store/toast'\r\n// import { TabKey } from './Sidebar'\r\nimport { useWS } from './WSProvider'\r\nimport { useMessages } from '../store/messages'\r\nimport { censorProfanity, containsProfanity } from '../utils/profanity'\r\nimport { useBlocklist } from '../store/blocklist'\r\nimport TabPills from './ui/TabPills'\r\nimport { DOUBLE_PRACTICE_ORDER, isDoubleHit, parseManualDart, ringSectorToDart } from '../game/types'\r\nimport { ATC_ORDER } from '../game/aroundTheClock'\r\nimport { createCricketState, applyCricketDart, CRICKET_NUMBERS, hasClosedAll as cricketClosedAll, cricketWinner } from '../game/cricket'\r\nimport { createShanghaiState, getRoundTarget as shanghaiTarget, applyShanghaiDart, endShanghaiTurn } from '../game/shanghai'\r\nimport { createDefaultHalveIt, getCurrentHalveTarget, applyHalveItDart, endHalveItTurn } from '../game/halveIt'\r\nimport { createHighLow, applyHighLowDart, endHighLowTurn } from '../game/highLow'\r\nimport { assignKillerNumbers, createKillerState, applyKillerDart, killerWinner } from '../game/killer'\r\nimport { apiFetch } from '../utils/api'\r\n// Phase 2 premium games (Online support)\r\nimport { createAmCricketState, applyAmCricketDart, AM_CRICKET_NUMBERS } from '../game/americanCricket'\r\nimport { createBaseball, applyBaseballDart } from '../game/baseball'\r\nimport { createGolf, applyGolfDart, GOLF_TARGETS } from '../game/golf'\r\nimport { createTicTacToe, tryClaimCell, TTT_TARGETS } from '../game/ticTacToe'\r\nimport { useMatchControl } from '../store/matchControl'\r\nimport GameScoreboard from './scoreboards/GameScoreboard'\r\nimport { useOnlineGameStats } from './scoreboards/useGameStats'\r\n\r\nexport default function OnlinePlay({ user }: { user?: any }) {\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || ''\r\n  const toast = useToast();\r\n  const wsGlobal = (() => { try { return useWS() } catch { return null } })()\r\n  const blocklist = useBlocklist()\r\n  const [roomId, setRoomId] = useState('room-1')\r\n  const [connected, setConnected] = useState(false)\r\n  const [chat, setChat] = useState<{from:string;message:string; fromId?: string}[]>([])\r\n  const [showQuick, setShowQuick] = useState(false)\r\n  const [showMessages, setShowMessages] = useState(false)\r\n  // Track last locally-sent chat to avoid duplicating when the server echoes it back\r\n  const lastSentChatRef = useRef<{ text: string; ts: number } | null>(null)\r\n  const [selfId, setSelfId] = useState<string | null>(null)\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  // Reconnect handling\r\n  const reconnectAttemptsRef = useRef(0)\r\n  const reconnectTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n  const shouldReconnectRef = useRef(true)\r\n  const lastToastRef = useRef(0)\r\n  const firstConnectDoneRef = useRef(false)\r\n  const match = useMatch()\r\n  const msgs = useMessages()\r\n  const { favoriteDouble, callerEnabled, callerVoice, callerVolume, speakCheckoutOnly, allowSpectate, cameraScale, setCameraScale, cameraFitMode = 'fill', setCameraFitMode, cameraEnabled, textSize, boxSize, autoscoreProvider, matchType = 'singles', setMatchType, teamAName = 'Team A', setTeamAName, teamBName = 'Team B', setTeamBName, x01DoubleIn: defaultX01DoubleIn } = useUserSettings()\r\n  const manualScoring = autoscoreProvider === 'manual'\r\n\r\n  // Button size classes for toolbar buttons\r\n  const getButtonSizeClasses = (size: string) => {\r\n    switch (size) {\r\n      case 'small': return 'px-1.5 py-0.5 text-xs'\r\n      case 'large': return 'px-3 py-1 text-sm'\r\n      default: return 'px-2 py-0.5 text-sm'\r\n    }\r\n  }\r\n  const buttonSizeClass = getButtonSizeClasses(textSize)\r\n  // Camera resize state\r\n  const [cameraColSpan, setCameraColSpan] = useState(2)\r\n  // Turn-by-turn modal\r\n  const [showMatchModal, setShowMatchModal] = useState(false)\r\n  const [participants, setParticipants] = useState<string[]>([])\r\n  const [turnIdx, setTurnIdx] = useState(0)\r\n  const [visitScore, setVisitScore] = useState(0)\r\n  // Double Practice (online) minimal state synchronized via WS state payload\r\n  const [dpIndex, setDpIndex] = useState(0)\r\n  const [dpHits, setDpHits] = useState(0)\r\n  const [dpManual, setDpManual] = useState('')\r\n  // Around the Clock (online) minimal state\r\n  const [atcIndex, setAtcIndex] = useState(0)\r\n  const [atcHits, setAtcHits] = useState(0)\r\n  const [atcManual, setAtcManual] = useState('')\r\n  // Treble Practice (online)\r\n  const [trebleTarget, setTrebleTarget] = useState<number>(20)\r\n  const [trebleHits, setTrebleHits] = useState<number>(0)\r\n  const [trebleDarts, setTrebleDarts] = useState<number>(0)\r\n  const [trebleManual, setTrebleManual] = useState<string>('')\r\n  const [trebleMaxDarts, setTrebleMaxDarts] = useState<number>(30)\r\n  // X01 Double-In per-match flag (synced over WS)\r\n  const [x01DoubleInMatch, setX01DoubleInMatch] = useState<boolean>(false)\r\n  // Mobile camera pairing\r\n  const [pairingCode, setPairingCode] = useState<string | null>(null)\r\n  // Highlight auto-download UI\r\n  const [highlightCandidate, setHighlightCandidate] = useState<any | null>(null)\r\n  const [showHighlightModal, setShowHighlightModal] = useState(false)\r\n\r\n  // Download highlight to device as a JSON file\r\n  function downloadHighlightToDevice() {\r\n    if (!highlightCandidate) return\r\n    try {\r\n      const blob = new Blob([JSON.stringify(highlightCandidate, null, 2)], { type: 'application/json' })\r\n      const url = URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      const name = `ndn-highlight-${highlightCandidate.player || 'player'}-${highlightCandidate.ts || Date.now()}.json`\r\n      a.href = url\r\n      a.download = name\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      a.remove()\r\n      URL.revokeObjectURL(url)\r\n  toast?.('Downloaded highlight to device', { type: 'success' })\r\n      setShowHighlightModal(false)\r\n    } catch (err) {\r\n  toast?.('Download failed', { type: 'error' })\r\n    }\r\n  }\r\n\r\n  async function saveHighlightToAccount() {\r\n    if (!highlightCandidate) return\r\n    const token = localStorage.getItem('authToken')\r\n  if (!token) { toast?.('You must be signed in to save to account', { type: 'error' }); return }\r\n    try {\r\n      const res = await apiFetch('/api/user/highlights', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: JSON.stringify(highlightCandidate) })\r\n      if (!res.ok) {\r\n        const j = await res.json().catch(()=>({}))\r\n  toast?.(`Save failed: ${j.error || res.statusText}`, { type: 'error' })\r\n        return\r\n      }\r\n      const j = await res.json()\r\n  toast?.('Saved highlight to your account', { type: 'success' })\r\n      setShowHighlightModal(false)\r\n    } catch (err) {\r\n  toast?.('Save failed', { type: 'error' })\r\n    }\r\n  }\r\n  // WebRTC for mobile camera\r\n  const [mobileStream, setMobileStream] = useState<MediaStream | null>(null)\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null)\r\n  // Tic Tac Toe manual input\r\n  const [tttManual, setTttManual] = useState('')\r\n  // Per-player states for premium games\r\n  const [cricketById, setCricketById] = useState<Record<string, ReturnType<typeof createCricketState>>>({})\r\n  const [shanghaiById, setShanghaiById] = useState<Record<string, ReturnType<typeof createShanghaiState>>>({})\r\n  const [halveById, setHalveById] = useState<Record<string, ReturnType<typeof createDefaultHalveIt>>>({})\r\n  const [highlowById, setHighlowById] = useState<Record<string, ReturnType<typeof createHighLow>>>({})\r\n  const [killerById, setKillerById] = useState<Record<string, ReturnType<typeof createKillerState>>>({})\r\n  const [amCricketById, setAmCricketById] = useState<Record<string, ReturnType<typeof createAmCricketState>>>({})\r\n  const [baseballById, setBaseballById] = useState<Record<string, ReturnType<typeof createBaseball>>>({})\r\n  const [golfById, setGolfById] = useState<Record<string, ReturnType<typeof createGolf>>>({})\r\n  const [ttt, setTTT] = useState<ReturnType<typeof createTicTacToe>>(() => createTicTacToe())\r\n  // Track darts this turn for non-X01 games to auto-advance after 3\r\n  const [turnDarts, setTurnDarts] = useState(0)\r\n  // Pause state (synced over WS)\r\n  const [paused, setPausedLocal] = useState<boolean>(false)\r\n  const [pauseRequestedBy, setPauseRequestedBy] = useState<string | null>(null)\r\n  const [pauseAcceptedBy, setPauseAcceptedBy] = useState<Record<string, boolean>>({})\r\n  const [pauseEndsAt, setPauseEndsAt] = useState<number | null>(null)\r\n  const [pauseDurationSec, setPauseDurationSec] = useState<number>(300)\r\n  const setPausedGlobal = useMatchControl(s => s.setPaused)\r\n  // View mode: compact player-by-player (mobile) vs full overview (desktop)\r\n  const [compactView, setCompactView] = useState<boolean>(() => {\r\n    try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false }\r\n  })\r\n  // Online end-of-match summary modal (appears when inProgress flips from true->false)\r\n  const [showX01EndSummary, setShowX01EndSummary] = useState(false)\r\n  const endSummaryPrevRef = useRef<boolean>(!!useMatch.getState().inProgress)\r\n  useEffect(() => {\r\n    const prev = endSummaryPrevRef.current\r\n    const now = !!match.inProgress\r\n    if (prev && !now) {\r\n      const hasFinished = (match.players || []).some(p => (p.legs||[]).some(L => L.finished))\r\n      if (hasFinished) setShowX01EndSummary(true)\r\n    }\r\n    endSummaryPrevRef.current = now\r\n  }, [match.inProgress, match.players])\r\n  // Dev-only: auto-simulate a short X01 leg to validate double-out stats via ?autotest=doubleout\r\n  useEffect(() => {\r\n    try {\r\n      if (!(import.meta as any).env?.DEV) return\r\n      const q = new URLSearchParams(window.location.search)\r\n      if (q.get('autotest') !== 'doubleout') return\r\n      // Prevent re-run on HMR\r\n      if ((window as any).__NDN_AUTO_TESTED__) return\r\n      ;(window as any).__NDN_AUTO_TESTED__ = true\r\n      // Create simple 101 match and simulate visits:\r\n      // You: 41 (attempts=0) -> Opp: 26 -> You: 10 (cross into window; attempts=1) -> Opp: 26 -> You: 40 finish on D20 (attempts=1, finishedByDouble=true)\r\n      match.newMatch([user?.username || 'You', 'Opponent'], 101, 'local-dev')\r\n      // You visit 1: 41 (no attempts yet)\r\n      match.addVisit(41, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 41 })\r\n      match.nextPlayer()\r\n      // Opponent visit: dummy 26\r\n      match.addVisit(26, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 26 })\r\n      match.nextPlayer()\r\n      // You visit 2: 10 (enters window, attempts=1)\r\n      match.addVisit(10, 3, { preOpenDarts: 0, doubleWindowDarts: 1, finishedByDouble: false, visitTotal: 10 })\r\n      match.nextPlayer()\r\n      // Opponent visit: dummy 26\r\n      match.addVisit(26, 3, { preOpenDarts: 0, doubleWindowDarts: 0, finishedByDouble: false, visitTotal: 26 })\r\n      match.nextPlayer()\r\n      // You visit 3: 40 (D20) finish inside window, attempts=1, hit=1\r\n      match.addVisit(40, 1, { preOpenDarts: 0, doubleWindowDarts: 1, finishedByDouble: true, visitTotal: 40 })\r\n      match.endLeg(40)\r\n      match.endGame()\r\n      // Modal will auto-open via inProgress flip hook\r\n    } catch {}\r\n  }, [])\r\n  // Build doubles stats (double-out only) for summary modal\r\n  const doublesStats = (() => {\r\n    const out: Record<string, { dartsAtDouble?: number; doublesHit?: number }> = {}\r\n    for (const p of (match.players || [])) {\r\n      let attempts = 0\r\n      let hits = 0\r\n      for (const L of (p.legs || [])) {\r\n        for (const v of (L.visits || [])) {\r\n          attempts += Math.max(0, Number(v.doubleWindowDarts || 0))\r\n          if (v.finishedByDouble) hits += 1\r\n        }\r\n      }\r\n      out[p.id] = { dartsAtDouble: attempts, doublesHit: hits }\r\n    }\r\n    return out\r\n  })()\r\n  // Ephemeral celebration overlay (e.g., 180), tied to the current player's turn\r\n  const [celebration, setCelebration] = useState<null | { kind: '180' | 'leg'; by: string; turnIdx: number; ts: number }>(null)\r\n  const lastCelebrationRef = useRef<{ kind: '180'|'leg'; by: string; ts: number } | null>(null)\r\n  const audioCtxRef = useRef<AudioContext | null>(null)\r\n  // Auto-unpause when timer elapses\r\n  useEffect(() => {\r\n    if (!paused || !pauseEndsAt) return\r\n    const id = setInterval(() => {\r\n      if (Date.now() >= (pauseEndsAt || 0)) {\r\n        setPausedLocal(false)\r\n        setPauseRequestedBy(null)\r\n        setPauseAcceptedBy({})\r\n        setPauseEndsAt(null)\r\n        setPausedGlobal(false, null)\r\n        sendState()\r\n      }\r\n    }, 1000)\r\n    return () => clearInterval(id)\r\n  }, [paused, pauseEndsAt])\r\n  function ensureAudio() {\r\n    try {\r\n      if (!audioCtxRef.current) {\r\n        const Ctor: any = (window as any).AudioContext || (window as any).webkitAudioContext\r\n        if (Ctor) audioCtxRef.current = new Ctor()\r\n      }\r\n      audioCtxRef.current?.resume?.().catch(()=>{})\r\n    } catch {}\r\n  }\r\n  function beep(freq: number, durMs: number, whenS = 0, gain = 0.05) {\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    const o = ctx.createOscillator()\r\n    const g = ctx.createGain()\r\n    o.type = 'square'\r\n    o.frequency.value = freq\r\n    g.gain.value = gain\r\n    o.connect(g)\r\n    g.connect(ctx.destination)\r\n    const now = ctx.currentTime + whenS\r\n    o.start(now)\r\n    o.stop(now + durMs / 1000)\r\n  }\r\n  function playSting(kind: '180'|'leg') {\r\n    ensureAudio()\r\n    const ctx = audioCtxRef.current\r\n    if (!ctx) return\r\n    if (kind === '180') {\r\n      beep(880, 110, 0, 0.06); beep(1175, 110, 0.06, 0.06); beep(1568, 140, 0.12, 0.06)\r\n    } else {\r\n      beep(659, 140, 0, 0.07); beep(784, 140, 0.08, 0.07); beep(987, 200, 0.16, 0.07)\r\n    }\r\n  }\r\n  function triggerCelebration(kind: '180'|'leg', who: string) {\r\n    const now = Date.now()\r\n    const last = lastCelebrationRef.current\r\n    if (last && last.kind === kind && last.by === who && (now - last.ts) < 500) return\r\n    lastCelebrationRef.current = { kind, by: who, ts: now }\r\n    setCelebration({ kind, by: who, turnIdx: match.currentPlayerIdx, ts: now })\r\n    playSting(kind)\r\n  }\r\n  // Lobby & create-match state\r\n  const [showCreate, setShowCreate] = useState(false)\r\n  const [lobby, setLobby] = useState<any[]>([])\r\n  const [mode, setMode] = useState<'bestof'|'firstto'>('bestof')\r\n  const [modeValue, setModeValue] = useState<number>(5)\r\n  const [startScore, setStartScore] = useState<number>(501)\r\n  const [pendingInvite, setPendingInvite] = useState<any | null>(null)\r\n  const [errorMsg, setErrorMsg] = useState<string>('')\r\n  // Stripe checkout error handler\r\n  function handleStripeError(msg: string) {\r\n    setErrorMsg(msg || 'Failed to create Stripe checkout session. Please try again later.')\r\n    setTimeout(() => setErrorMsg(''), 4000)\r\n    try { toast(msg || 'Stripe checkout failed', { type: 'error' }) } catch {}\r\n  }\r\n  const [lastJoinIntent, setLastJoinIntent] = useState<any | null>(null)\r\n  const [offerNewRoom, setOfferNewRoom] = useState<null | { game: string; mode: 'bestof'|'firstto'; value: number; startingScore?: number }>(null)\r\n  // Game selection\r\n  const [game, setGame] = useState<GameKey>('X01')\r\n  const [currentGame, setCurrentGame] = useState<GameKey>('X01')\r\n  const [requireCalibration, setRequireCalibration] = useState<boolean>(false)\r\n  // Create-match: Treble Practice specific setting\r\n  const [createTrebleMaxDarts, setCreateTrebleMaxDarts] = useState<number>(30)\r\n  // Create-match: X01 Double-In per-match toggle (prefilled from Settings)\r\n  const [createX01DoubleIn, setCreateX01DoubleIn] = useState<boolean>(!!defaultX01DoubleIn)\r\n  const freeLeft = user?.username && !user?.fullAccess ? getFreeRemaining(user.username) : Infinity\r\n  const locked = !user?.fullAccess && (freeLeft <= 0)\r\n  // World Lobby filters\r\n  const [filterMode, setFilterMode] = useState<'all'|'bestof'|'firstto'>('all')\r\n  const [filterStart, setFilterStart] = useState<'all'|301|501|701>('all')\r\n  const [filterGame, setFilterGame] = useState<'all'|GameKey>('all')\r\n  const [nearAvg, setNearAvg] = useState(false)\r\n  const [avgTolerance, setAvgTolerance] = useState<number>(10)\r\n  const { H: calibH } = useCalibration()\r\n  const myAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n  const unread = useMessages(s => s.unread)\r\n  const filteredLobby = (lobby || []).filter((m:any) => {\r\n    if (filterMode !== 'all' && m.mode !== filterMode) return false\r\n    if (filterStart !== 'all' && Number(m.startingScore) !== Number(filterStart)) return false\r\n    if (filterGame !== 'all' && m.game !== filterGame) return false\r\n    if (nearAvg) {\r\n      if (!myAvg || !m.creatorAvg) return false\r\n      const diff = Math.abs(Number(m.creatorAvg) - Number(myAvg))\r\n      if (diff > avgTolerance) return false\r\n    }\r\n    return true\r\n  })\r\n\r\n  // Removed tournaments banner from Online; tournaments live in Tournaments tab only\r\n\r\n  // Demo: prefill Create Match modal from URL (ndn:online-demo)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      const d = e?.detail || {}\r\n      if (d.game) setGame(d.game)\r\n      if (d.mode === 'bestof' || d.mode === 'firstto') setMode(d.mode)\r\n      if (typeof d.value === 'number' && isFinite(d.value)) setModeValue(Math.max(1, Math.floor(d.value)))\r\n      if (typeof d.start === 'number' && isFinite(d.start)) setStartScore(Math.max(1, Math.floor(d.start)))\r\n      setShowCreate(true)\r\n    }\r\n    window.addEventListener('ndn:online-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-demo', handler as any)\r\n  }, [])\r\n\r\n  // Load inbox on mount for the current user\r\n  useEffect(() => {\r\n    const email = String(user?.email || '').toLowerCase()\r\n    if (!email) return\r\n    apiFetch(`/api/friends/messages?email=${encodeURIComponent(email)}`).then(r=>r.json()).then(d=>{\r\n      if (d?.ok && Array.isArray(d.messages)) msgs.load(d.messages)\r\n    }).catch(()=>{})\r\n  }, [user?.email])\r\n\r\n  // Demo: open a populated Online Match view with fake data (local-only)\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const d = e?.detail || {}\r\n        const start = Number(d.start || 501)\r\n        // Create a quick local match with two players\r\n        match.newMatch([user?.username || 'You', 'Opponent'], start, roomId)\r\n        // Seed a few visits to populate UI\r\n        match.addVisit(60, 3) // You\r\n        match.nextPlayer()\r\n        match.addVisit(85, 3) // Opponent\r\n        match.nextPlayer()\r\n        match.addVisit(100, 3) // You\r\n        setCurrentGame('X01')\r\n        setShowMatchModal(true)\r\n      } catch (err) {\r\n        console.error('Demo error:', err)\r\n      }\r\n    }\r\n    window.addEventListener('ndn:online-match-demo', handler as any)\r\n    return () => window.removeEventListener('ndn:online-match-demo', handler as any)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Auto-connect on mount and enable auto-reconnect\r\n    shouldReconnectRef.current = true\r\n    connect()\r\n    return () => {\r\n      shouldReconnectRef.current = false\r\n      if (reconnectTimerRef.current) { clearTimeout(reconnectTimerRef.current) }\r\n      try { wsRef.current?.close() } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Track in-game flag in messages store\r\n  useEffect(() => {\r\n    msgs.setInGame(match.inProgress)\r\n  }, [match.inProgress])\r\n\r\n  // Clear celebration as soon as turn advances to the next player\r\n  useEffect(() => {\r\n    if (celebration && match.currentPlayerIdx !== celebration.turnIdx) {\r\n      setCelebration(null)\r\n    }\r\n  }, [match.currentPlayerIdx, celebration?.turnIdx])\r\n\r\n  // If the user changes the spectate preference, push updated presence to the server\r\n  useEffect(() => {\r\n    try {\r\n      if (wsGlobal && wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      }\r\n    } catch {}\r\n  }, [allowSpectate, wsGlobal?.connected])\r\n\r\n  // Spectator flow: listen to spectate events from Friends and join room as readonly\r\n  useEffect(() => {\r\n    const onSpectate = (e: any) => {\r\n      const rid = e?.detail?.roomId\r\n      if (!rid) return\r\n      setRoomId(rid)\r\n      // send spectate message\r\n      if (wsGlobal) wsGlobal.send({ type: 'spectate', roomId: rid })\r\n      else wsRef.current?.send(JSON.stringify({ type: 'spectate', roomId: rid }))\r\n      setShowMatchModal(true)\r\n      setShowCreate(false)\r\n    }\r\n    window.addEventListener('ndn:spectate-room', onSpectate as any)\r\n    return () => window.removeEventListener('ndn:spectate-room', onSpectate as any)\r\n  }, [wsGlobal])\r\n\r\n  function connect() {\r\n    if (wsGlobal) {\r\n      // If global provider exists, rely on it for connection and just send initial commands\r\n      if (wsGlobal.connected) {\r\n        wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n        wsGlobal.send({ type: 'list-matches' })\r\n        setConnected(true)\r\n      }\r\n      return\r\n    }\r\n    // Avoid duplicate sockets\r\n    try { if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) return } catch {}\r\n  const envUrl = (import.meta as any).env?.VITE_WS_URL as string | undefined\r\n  const proto = (window.location.protocol === 'https:' ? 'wss' : 'ws')\r\n  const host = window.location.hostname\r\n  const fallback = `${proto}://${host}${window.location.port ? '' : ':8787'}`\r\n  const url = envUrl && typeof envUrl === 'string' && envUrl.length > 0 ? envUrl : fallback\r\n  const ws = new WebSocket(url)\r\n    wsRef.current = ws\r\n    ws.onopen = () => {\r\n      setConnected(true)\r\n      // Reset backoff\r\n      reconnectAttemptsRef.current = 0\r\n      if (!firstConnectDoneRef.current) {\r\n        toast('Connected to lobby', { type: 'success' })\r\n        firstConnectDoneRef.current = true\r\n      } else {\r\n        toast('Reconnected to lobby', { type: 'success' })\r\n      }\r\n    ws.send(JSON.stringify({ type: 'join', roomId }))\r\n    // send presence\r\n  ws.send(JSON.stringify({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate }))\r\n      // fetch current lobby\r\n      ws.send(JSON.stringify({ type: 'list-matches' }))\r\n    }\r\n    ws.onmessage = (ev) => {\r\n      const data = JSON.parse(ev.data)\r\n      if (data.type === 'state') {\r\n        match.importState(data.payload)\r\n        // Pull Double Practice progress if present\r\n        const di = Number((data.payload as any)._dpIndex)\r\n        const dh = Number((data.payload as any)._dpHits)\r\n        if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n        if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n        // Pull Around the Clock progress if present\r\n        const ai = Number((data.payload as any)._atcIndex)\r\n        const ah = Number((data.payload as any)._atcHits)\r\n        if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n        if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n        // Pull Treble Practice progress if present\r\n        try {\r\n          const tt = Number((data.payload as any)._trebleTarget)\r\n          const th = Number((data.payload as any)._trebleHits)\r\n          const td = Number((data.payload as any)._trebleDarts)\r\n          const tmax = Number((data.payload as any)._trebleMaxDarts)\r\n          if (Number.isFinite(tt)) setTrebleTarget(Math.max(1, Math.min(20, tt)))\r\n          if (Number.isFinite(th)) setTrebleHits(Math.max(0, th))\r\n          if (Number.isFinite(td)) setTrebleDarts(Math.max(0, td))\r\n          if (Number.isFinite(tmax)) setTrebleMaxDarts(Math.max(0, tmax))\r\n        } catch {}\r\n        // Premium per-player states\r\n        try {\r\n          const _cr = (data.payload as any)._cricketById\r\n          if (_cr && typeof _cr === 'object') setCricketById(_cr)\r\n        } catch {}\r\n        try {\r\n          const _sh = (data.payload as any)._shanghaiById\r\n          if (_sh && typeof _sh === 'object') setShanghaiById(_sh)\r\n        } catch {}\r\n        try {\r\n          const _hv = (data.payload as any)._halveById\r\n          if (_hv && typeof _hv === 'object') setHalveById(_hv)\r\n        } catch {}\r\n        try {\r\n          const _hl = (data.payload as any)._highlowById\r\n          if (_hl && typeof _hl === 'object') setHighlowById(_hl)\r\n        } catch {}\r\n        try {\r\n          const _kr = (data.payload as any)._killerById\r\n          if (_kr && typeof _kr === 'object') setKillerById(_kr)\r\n        } catch {}\r\n        try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n        try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n        try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n        try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n        try {\r\n          const _td = Number((data.payload as any)._turnDarts)\r\n          if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td))\r\n        } catch {}\r\n        // Pull X01 Double-In per-match if present\r\n        try {\r\n          const _di = (data.payload as any)._x01DoubleIn\r\n          if (typeof _di === 'boolean') setX01DoubleInMatch(_di)\r\n        } catch {}\r\n      } else if (data.type === 'joined') {\r\n        // joined room; keep our assigned id to label messages\r\n        if (data.id) setSelfId(data.id)\r\n      } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n        // Maintain a simple list of participant ids. In a real app we would map id->username.\r\n        setParticipants(prev => {\r\n          const set = new Set(prev)\r\n          if (data.id) set.add(data.id)\r\n          return Array.from(set)\r\n        })\r\n      } else if (data.type === 'chat') {\r\n        const isSelf = !!(data.from && selfId && data.from === selfId)\r\n        const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n        const idKey = String(data.from || '')\r\n        // Skip messages from blocked senders (only applies to non-self)\r\n        if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n        // De-dupe if this is our own recently-sent quick message already appended locally\r\n        if (isSelf && lastSentChatRef.current && String(data.message||'') === lastSentChatRef.current.text) {\r\n          // Clear marker and do not append again\r\n          lastSentChatRef.current = null\r\n          return\r\n        }\r\n        setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n      } else if (data.type === 'matches') {\r\n        setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n      } else if (data.type === 'invite') {\r\n        setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n      } else if (data.type === 'match-start') {\r\n        // Both parties received a room id to join\r\n        setRoomId(data.roomId)\r\n        // Auto-join the room\r\n        ws.send(JSON.stringify({ type: 'join', roomId: data.roomId }))\r\n        setShowMatchModal(true)\r\n        setShowCreate(false)\r\n        if (data.match?.game) setCurrentGame(data.match.game)\r\n        // Consume a free game for non-premium users\r\n        if (user?.username && !user?.fullAccess) {\r\n          incOnlineUsage(user.username)\r\n        }\r\n      } else if (data.type === 'declined') {\r\n        toast('Invite declined', { type: 'info' })\r\n      } else if (data.type === 'error') {\r\n        const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n        setErrorMsg(msg)\r\n        if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n          try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n        }\r\n        if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n          setOfferNewRoom({\r\n            game: lastJoinIntent.game,\r\n            mode: lastJoinIntent.mode,\r\n            value: lastJoinIntent.value,\r\n            startingScore: lastJoinIntent.startingScore,\r\n          })\r\n        }\r\n        // auto-clear after a bit\r\n        setTimeout(()=>setErrorMsg(''), 3500)\r\n      } else if (data.type === 'friend-invite') {\r\n        const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n        if (accept) {\r\n          ws.send(JSON.stringify({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore }))\r\n        } else {\r\n          toast('Invite declined', { type: 'info' })\r\n        }\r\n      } else if (data.type === 'friend-message') {\r\n        msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n        // Show toast only if not currently in a game\r\n        if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n      } else if (data.type === 'celebration') {\r\n        const who = data.by || 'Player'\r\n        const kind = data.kind === 'leg' ? 'leg' : '180'\r\n        triggerCelebration(kind, who)\r\n      } else if (data.type === 'cam-code') {\r\n        console.log('Received cam-code:', data.code)\r\n        setPairingCode(data.code)\r\n        toast(`Pairing code: ${data.code}`, { type: 'info' })\r\n      } else if (data.type === 'cam-peer-joined') {\r\n        console.log('Mobile peer joined for code:', data.code)\r\n        // Mobile camera connected, start WebRTC\r\n        startMobileWebRTC(data.code)\r\n      } else if (data.type === 'cam-answer') {\r\n        console.log('Received cam-answer')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.setRemoteDescription(new RTCSessionDescription(data.payload))\r\n      } else if (data.type === 'cam-ice') {\r\n        console.log('Received cam-ice')\r\n        const pc = (window as any).mobilePC\r\n        if (pc) pc.addIceCandidate(data.payload)\r\n      }\r\n    }\r\n    ws.onclose = () => {\r\n      setConnected(false)\r\n      // Auto-reconnect with exponential backoff\r\n      if (!shouldReconnectRef.current) return\r\n      const attempt = (reconnectAttemptsRef.current || 0) + 1\r\n      reconnectAttemptsRef.current = attempt\r\n      const delay = Math.min(30000, 1000 * Math.pow(2, attempt - 1))\r\n      const now = Date.now()\r\n      if (now - lastToastRef.current > 4000) {\r\n        toast(`Disconnected. Reconnecting in ${Math.round(delay/1000)}s...`, { type: 'error' })\r\n        lastToastRef.current = now\r\n      }\r\n      if (reconnectTimerRef.current) clearTimeout(reconnectTimerRef.current)\r\n      reconnectTimerRef.current = setTimeout(() => {\r\n        connect()\r\n      }, delay)\r\n    }\r\n  }\r\n  // Small helper to render the match summary card\r\n  function RenderMatchSummary() {\r\n    const players = match.players || []\r\n    const curIdx = match.currentPlayerIdx || 0\r\n    const cur = players[curIdx]\r\n    const leg = cur?.legs?.[cur?.legs?.length - 1]\r\n    const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n    // TV-style 3-dart average: sum points across all legs / total darts * 3\r\n    const totals = (() => {\r\n      let pts = 0, darts = 0\r\n      if (cur?.legs) {\r\n        for (const L of cur.legs) {\r\n          // Points: sum of scored points this leg\r\n          pts += (L.totalScoreStart - L.totalScoreRemaining)\r\n          // Darts: sum visits darts, subtract pre-open darts (Double-In) if any\r\n          const legDarts = (L.visits || []).reduce((a, v) => a + (v.darts || 0) - (v.preOpenDarts || 0), 0)\r\n          darts += legDarts\r\n        }\r\n      }\r\n      return { pts, darts }\r\n    })()\r\n    const avg3 = totals.darts > 0 ? ((totals.pts / totals.darts) * 3) : 0\r\n    const lastScore = leg?.visits?.[leg.visits.length-1]?.score ?? 0\r\n    let matchScore = 'ÔÇö'\r\n    if (players.length === 2) {\r\n      matchScore = `${players[0]?.legsWon || 0}-${players[1]?.legsWon || 0}`\r\n    } else if (players.length > 2) {\r\n      matchScore = players.map(p => `${p.name}:${p.legsWon||0}`).join(' = ')\r\n    }\r\n    const best = match.bestLegThisMatch\r\n    const bestText = best ? `${best.darts} darts${(() => { const p = players.find(x=>x.id===best.playerId); return p?` (${p.name})`:'' })()}` : '-'\r\n    \r\n    // Text size classes\r\n    const getTextSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'text-xs'\r\n        case 'large': return 'text-base'\r\n        default: return 'text-sm'\r\n      }\r\n    }\r\n    const textSizeClass = getTextSizeClasses(textSize)\r\n    \r\n    // Box size classes\r\n    const getBoxSizeClasses = (size: string) => {\r\n      switch (size) {\r\n        case 'small': return 'p-2'\r\n        case 'large': return 'p-4'\r\n        default: return 'p-3'\r\n      }\r\n    }\r\n    const boxSizeClass = getBoxSizeClasses(boxSize)\r\n    \r\n    return (\r\n      <div className={`${boxSizeClass} rounded-2xl bg-slate-900/40 border border-white/10 text-white ${textSizeClass}`}>\r\n        <div className=\"font-semibold mb-2\">Match Summary</div>\r\n        <div className=\"grid grid-cols-2 gap-y-1\">\r\n          <div className=\"opacity-80\">Current score</div>\r\n          <div className=\"font-mono text-right\">{matchScore}</div>\r\n          <div className=\"opacity-80\">Current thrower</div>\r\n          <div className=\"text-right font-semibold\">{cur?.name || 'ÔÇö'}</div>\r\n          <div className=\"opacity-80\">Score remaining</div>\r\n          <div className=\"text-right font-mono font-bold text-lg\">{remaining}</div>\r\n          <div className=\"opacity-80\">3-dart avg</div>\r\n          <div className=\"text-right font-mono\">{avg3.toFixed(1)}</div>\r\n          <div className=\"opacity-80\">Last score</div>\r\n          <div className=\"text-right font-mono\">{lastScore}</div>\r\n          <div className=\"opacity-80\">Best leg</div>\r\n          <div className=\"text-right\">{bestText}</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  \r\n\r\n  // Subscribe to global WS messages if available\r\n  useEffect(() => {\r\n    if (!wsGlobal) return\r\n    setConnected(wsGlobal.connected)\r\n    const unsub = wsGlobal.addListener((data) => {\r\n      try {\r\n        if (data.type === 'state') {\r\n          match.importState(data.payload)\r\n          // Pull synchronized premium states (when using WS provider)\r\n          try {\r\n            const di = Number((data.payload as any)._dpIndex); const dh = Number((data.payload as any)._dpHits)\r\n            if (Number.isFinite(di)) setDpIndex(Math.max(0, di))\r\n            if (Number.isFinite(dh)) setDpHits(Math.max(0, dh))\r\n          } catch {}\r\n          try {\r\n            const ai = Number((data.payload as any)._atcIndex); const ah = Number((data.payload as any)._atcHits)\r\n            if (Number.isFinite(ai)) setAtcIndex(Math.max(0, ai))\r\n            if (Number.isFinite(ah)) setAtcHits(Math.max(0, ah))\r\n          } catch {}\r\n          try { const _cr = (data.payload as any)._cricketById; if (_cr && typeof _cr === 'object') setCricketById(_cr) } catch {}\r\n          try { const _sh = (data.payload as any)._shanghaiById; if (_sh && typeof _sh === 'object') setShanghaiById(_sh) } catch {}\r\n          try { const _hv = (data.payload as any)._halveById; if (_hv && typeof _hv === 'object') setHalveById(_hv) } catch {}\r\n          try { const _hl = (data.payload as any)._highlowById; if (_hl && typeof _hl === 'object') setHighlowById(_hl) } catch {}\r\n          try { const _kr = (data.payload as any)._killerById; if (_kr && typeof _kr === 'object') setKillerById(_kr) } catch {}\r\n          // Phase 2\r\n          try { const _am = (data.payload as any)._amCricketById; if (_am && typeof _am === 'object') setAmCricketById(_am) } catch {}\r\n          try { const _bb = (data.payload as any)._baseballById; if (_bb && typeof _bb === 'object') setBaseballById(_bb) } catch {}\r\n          try { const _gf = (data.payload as any)._golfById; if (_gf && typeof _gf === 'object') setGolfById(_gf) } catch {}\r\n          try { const _tt = (data.payload as any)._tttState; if (_tt && typeof _tt === 'object') setTTT(_tt) } catch {}\r\n          try { const _td = Number((data.payload as any)._turnDarts); if (Number.isFinite(_td)) setTurnDarts(Math.max(0, _td)) } catch {}\r\n          // Pause sync\r\n          try { const _paused = !!(data.payload as any)._paused; setPausedLocal(_paused); } catch {}\r\n          try { const _pEnds = Number((data.payload as any)._pauseEndsAt); setPauseEndsAt(Number.isFinite(_pEnds) ? _pEnds : null) } catch {}\r\n          try { const _pBy = (data.payload as any)._pauseRequestedBy; setPauseRequestedBy(typeof _pBy === 'string' ? _pBy : null) } catch {}\r\n          try { const _acc = (data.payload as any)._pauseAcceptedBy; if (_acc && typeof _acc === 'object') setPauseAcceptedBy(_acc) } catch {}\r\n          try { const _dur = Number((data.payload as any)._pauseDurationSec); if (Number.isFinite(_dur)) setPauseDurationSec(Math.max(60, Math.min(600, _dur))) } catch {}\r\n      // X01 Double-In per-match\r\n      try { const _di = (data.payload as any)._x01DoubleIn; if (typeof _di === 'boolean') setX01DoubleInMatch(_di) } catch {}\r\n          // Update global pause store\r\n          setPausedGlobal(!!(data.payload as any)._paused, Number((data.payload as any)._pauseEndsAt) || null)\r\n        } else if (data.type === 'joined') {\r\n          if (data.id) setSelfId(data.id)\r\n        } else if (data.type === 'presence' || data.type === 'peer-joined') {\r\n          setParticipants(prev => Array.from(new Set([...(prev||[]), data.id].filter(Boolean))))\r\n        } else if (data.type === 'chat') {\r\n          const isSelf = !!(data.from && selfId && data.from === selfId)\r\n          const label = isSelf ? (user?.username || 'me') : (data.from || 'peer')\r\n          const idKey = String(data.from || '')\r\n          if (!isSelf && idKey && blocklist.isBlocked(idKey)) return\r\n          setChat(prev => [...prev, { from: label, message: data.message, fromId: idKey || undefined }])\r\n        } else if (data.type === 'matches') {\r\n          setLobby(Array.isArray(data.matches) ? data.matches : [])\r\n        } else if (data.type === 'invite') {\r\n          setPendingInvite({ matchId: data.matchId, fromId: data.fromId, fromName: data.fromName, calibrated: !!data.calibrated, boardPreview: data.boardPreview || null, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n        } else if (data.type === 'match-start') {\r\n          setRoomId(data.roomId)\r\n          wsGlobal.send({ type: 'join', roomId: data.roomId })\r\n          setShowMatchModal(true)\r\n          setShowCreate(false)\r\n          if (data.match?.game) setCurrentGame(data.match.game)\r\n          if (user?.username && !user?.fullAccess) {\r\n            incOnlineUsage(user.username)\r\n          }\r\n        } else if (data.type === 'declined') {\r\n          toast('Invite declined', { type: 'info' })\r\n        } else if (data.type === 'error') {\r\n          const msg = typeof data.message === 'string' ? data.message : 'Action not allowed'\r\n          setErrorMsg(msg)\r\n          if (data.code === 'SPECTATE_NOT_ALLOWED') {\r\n            try { toast('This player has spectating turned off.', { type: 'error' }) } catch {}\r\n          }\r\n          if (data.code === 'NOT_FOUND' && lastJoinIntent) {\r\n            setOfferNewRoom({\r\n              game: lastJoinIntent.game,\r\n              mode: lastJoinIntent.mode,\r\n              value: lastJoinIntent.value,\r\n              startingScore: lastJoinIntent.startingScore,\r\n            })\r\n          }\r\n          setTimeout(()=>setErrorMsg(''), 3500)\r\n        } else if (data.type === 'friend-invite') {\r\n          const accept = confirm(`${data.fromName || data.fromEmail} invited you to play ${data.game || 'X01'} (${data.mode==='firstto'?'First To':'Best Of'} ${data.value||1}). Accept?`)\r\n          if (accept) {\r\n            wsGlobal.send({ type: 'start-friend-match', toEmail: data.fromEmail, game: data.game, mode: data.mode, value: data.value, startingScore: data.startingScore })\r\n          } else {\r\n            toast('Invite declined', { type: 'info' })\r\n          }\r\n        } else if (data.type === 'friend-message') {\r\n          msgs.add({ id: data.id || `${data.ts}-${data.from}`, from: data.from, message: data.message, ts: data.ts || Date.now() })\r\n          if (!match.inProgress) toast(`${data.from}: ${data.message}`, { type: 'info' })\r\n        } else if (data.type === 'celebration') {\r\n          const who = data.by || 'Player'\r\n          const kind = data.kind === 'leg' ? 'leg' : '180'\r\n          triggerCelebration(kind, who)\r\n        }\r\n      } catch {}\r\n    })\r\n    // On connect, join and load lobby\r\n    if (wsGlobal.connected) {\r\n      wsGlobal.send({ type: 'join', roomId })\r\n  wsGlobal.send({ type: 'presence', username: user?.username || 'guest', email: (user?.email||'').toLowerCase(), allowSpectate })\r\n      wsGlobal.send({ type: 'list-matches' })\r\n    }\r\n    return () => { unsub() }\r\n  }, [wsGlobal?.connected])\r\n\r\n  function sendState() {\r\n    if (wsGlobal) {\r\n  wsGlobal.send({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _trebleTarget: trebleTarget, _trebleHits: trebleHits, _trebleDarts: trebleDarts, _trebleMaxDarts: trebleMaxDarts, _x01DoubleIn: x01DoubleInMatch, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts, _paused: paused, _pauseEndsAt: pauseEndsAt, _pauseRequestedBy: pauseRequestedBy, _pauseAcceptedBy: pauseAcceptedBy, _pauseDurationSec: pauseDurationSec } })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n  ws.send(JSON.stringify({ type: 'state', payload: { ...match, _turnIdx: turnIdx, _participants: participants, _dpIndex: dpIndex, _dpHits: dpHits, _atcIndex: atcIndex, _atcHits: atcHits, _trebleTarget: trebleTarget, _trebleHits: trebleHits, _trebleDarts: trebleDarts, _trebleMaxDarts: trebleMaxDarts, _x01DoubleIn: x01DoubleInMatch, _cricketById: cricketById, _shanghaiById: shanghaiById, _halveById: halveById, _highlowById: highlowById, _killerById: killerById, _amCricketById: amCricketById, _baseballById: baseballById, _golfById: golfById, _tttState: ttt, _turnDarts: turnDarts, _paused: paused, _pauseEndsAt: pauseEndsAt, _pauseRequestedBy: pauseRequestedBy, _pauseAcceptedBy: pauseAcceptedBy, _pauseDurationSec: pauseDurationSec } }))\r\n  }\r\n\r\n  function sendQuick(msg: string) {\r\n    const label = user?.username || 'me'\r\n    // Optimistically append locally for snappy UX\r\n    setChat(prev => [...prev, { from: label, message: msg, fromId: selfId || 'self' }])\r\n    lastSentChatRef.current = { text: msg, ts: Date.now() }\r\n    if (wsGlobal) {\r\n      wsGlobal.send({ type: 'chat', message: msg })\r\n      return\r\n    }\r\n    const ws = wsRef.current\r\n    if (!ws || ws.readyState !== WebSocket.OPEN) return\r\n    ws.send(JSON.stringify({ type: 'chat', message: msg }))\r\n  }\r\n\r\n  // Double Practice handlers\r\n  function addDpValue(dart: number) {\r\n    const hit = isDoubleHit(dart, dpIndex)\r\n    if (hit) {\r\n      const newHits = dpHits + 1\r\n      const nextIdx = dpIndex + 1\r\n      setDpHits(newHits)\r\n      setDpIndex(nextIdx)\r\n      // Celebrate completion locally\r\n      try {\r\n        if (newHits >= DOUBLE_PRACTICE_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          // Reset for another round\r\n          setDpHits(0)\r\n          setDpIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    // Sync to peers\r\n    sendState()\r\n  }\r\n  function addDpNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addDpValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addDpManual() {\r\n    const val = parseManualDart(dpManual)\r\n    if (val == null) return\r\n    addDpValue(val)\r\n    setDpManual('')\r\n  }\r\n\r\n  // Around the Clock handlers\r\n  function isAtcHit(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const target = ATC_ORDER[atcIndex]\r\n    if (target == null) return false\r\n    if (typeof sector === 'number' && sector >= 1 && sector <= 20) {\r\n      if (sector === target && (ring === 'SINGLE' || ring === 'DOUBLE' || ring === 'TRIPLE')) return true\r\n    }\r\n    if (target === 25) {\r\n      return ring === 'BULL' || val === 25\r\n    }\r\n    if (target === 50) {\r\n      return ring === 'INNER_BULL' || val === 50\r\n    }\r\n    return val === target || val === target * 2 || val === target * 3\r\n  }\r\n  function addAtcValue(val: number, ring?: 'MISS'|'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    if (isAtcHit(val, ring, sector)) {\r\n      const newHits = atcHits + 1\r\n      const nextIdx = atcIndex + 1\r\n      setAtcHits(newHits)\r\n      setAtcIndex(nextIdx)\r\n      try {\r\n        if (newHits >= ATC_ORDER.length) {\r\n          const who = match.players[match.currentPlayerIdx]?.name || 'Player'\r\n          triggerCelebration('leg', who)\r\n          setAtcHits(0)\r\n          setAtcIndex(0)\r\n        }\r\n      } catch {}\r\n    }\r\n    sendState()\r\n  }\r\n  function addAtcNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    addAtcValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addAtcManual() {\r\n    const val = parseManualDart(atcManual)\r\n    if (val == null) return\r\n    addAtcValue(val)\r\n    setAtcManual('')\r\n  }\r\n\r\n  // Treble Practice handlers\r\n  function addTrebleValue(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    // Stop counting beyond configured throws\r\n    if (trebleMaxDarts > 0 && trebleDarts >= trebleMaxDarts) return\r\n    const hit = (ring === 'TRIPLE' && sector === trebleTarget) || (!ring && value === trebleTarget * 3)\r\n    if (hit) setTrebleHits(h => h + 1)\r\n    setTrebleDarts(d => {\r\n      const nd = d + 1\r\n      // Auto-rotate T20→T19→T18 every 3 darts\r\n      if (nd % 3 === 0 && [20,19,18].includes(trebleTarget)) {\r\n        const cycle = [20,19,18]\r\n        const idx = cycle.indexOf(trebleTarget)\r\n        const next = cycle[(idx + 1) % cycle.length]\r\n        setTrebleTarget(next)\r\n      }\r\n      return nd\r\n    })\r\n    sendState()\r\n  }\r\n  function addTrebleNumeric() {\r\n    const v = Math.max(0, Math.floor(visitScore|0))\r\n    // No ring info, rely on numeric value only\r\n    addTrebleValue(v)\r\n    setVisitScore(0)\r\n  }\r\n  function addTrebleManual() {\r\n    const val = parseManualDart(trebleManual)\r\n    if (val == null) return\r\n    addTrebleValue(val)\r\n    setTrebleManual('')\r\n  }\r\n  function resetTreble() { setTrebleHits(0); setTrebleDarts(0) }\r\n\r\n  // Helpers for premium modes\r\n  function currentPlayerId(): string {\r\n    const p = match.players[match.currentPlayerIdx]\r\n    return p?.id ?? String(match.currentPlayerIdx)\r\n  }\r\n  // Ensure state exists for a given player id\r\n  function ensureCricket(pid: string) {\r\n    if (!cricketById[pid]) setCricketById(s => ({ ...s, [pid]: createCricketState() }))\r\n  }\r\n  function ensureShanghai(pid: string) {\r\n    if (!shanghaiById[pid]) setShanghaiById(s => ({ ...s, [pid]: createShanghaiState() }))\r\n  }\r\n  function ensureHalve(pid: string) {\r\n    if (!halveById[pid]) setHalveById(s => ({ ...s, [pid]: createDefaultHalveIt() }))\r\n  }\r\n  function ensureHighLow(pid: string) {\r\n    if (!highlowById[pid]) setHighlowById(s => ({ ...s, [pid]: createHighLow() }))\r\n  }\r\n  function ensureKiller(pid: string) {\r\n    if (!killerById[pid]) {\r\n      // If any existing assignments, pick the highest density or default to pid index\r\n      const used = new Set<number>(Object.values(killerById || {}).map(s => s.number))\r\n      const pool: number[] = []\r\n      for (let i=1;i<=20;i++){ if (!used.has(i)) pool.push(i) }\r\n      const num = pool.length>0 ? pool[Math.floor(Math.random()*pool.length)] : 20\r\n      setKillerById(s => ({ ...s, [pid]: createKillerState(num, 3) }))\r\n    }\r\n  }\r\n  function ensureAmCricket(pid: string) {\r\n    if (!amCricketById[pid]) setAmCricketById(s => ({ ...s, [pid]: createAmCricketState() }))\r\n  }\r\n  function ensureBaseball(pid: string) {\r\n    if (!baseballById[pid]) setBaseballById(s => ({ ...s, [pid]: createBaseball() }))\r\n  }\r\n  function ensureGolf(pid: string) {\r\n    if (!golfById[pid]) setGolfById(s => ({ ...s, [pid]: createGolf() }))\r\n  }\r\n  // Resets darts count on player change for non-X01 games\r\n  useEffect(() => { setTurnDarts(0) }, [match.currentPlayerIdx, currentGame])\r\n\r\n  // Compute whether all opponents have closed a cricket number\r\n  function allOpponentsClosed(num: 15|16|17|18|19|20|25, selfId: string): boolean {\r\n    const opps = match.players.filter(p => p.id !== selfId)\r\n    if (opps.length === 0) return false\r\n    return opps.every(p => (cricketById[p.id]?.marks?.[num] || 0) >= 3)\r\n  }\r\n\r\n  function applyCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureCricket(pid)\r\n    setCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createCricketState()) }\r\n      const pts = applyCricketDart(st, value, ring, sector, (n)=>allOpponentsClosed(n, pid))\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      // end turn\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyShanghaiAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureShanghai(pid)\r\n    setShanghaiById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createShanghaiState()) }\r\n      applyShanghaiDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setShanghaiById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createShanghaiState()) }\r\n        endShanghaiTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHalveAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHalve(pid)\r\n    setHalveById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n      applyHalveItDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHalveById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createDefaultHalveIt()) }\r\n        endHalveItTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyHighLowAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureHighLow(pid)\r\n    setHighlowById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createHighLow()) }\r\n      applyHighLowDart(st, value, ring, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) {\r\n      setHighlowById(prev => {\r\n        const copy = { ...prev }\r\n        const st = { ...(copy[pid] || createHighLow()) }\r\n        endHighLowTurn(st)\r\n        copy[pid] = st\r\n        return copy\r\n      })\r\n      setTurnDarts(0)\r\n      match.nextPlayer(); sendState()\r\n    } else { sendState() }\r\n  }\r\n\r\n  function applyKillerAuto(ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    // Ensure every player has an assignment before applying\r\n    match.players.forEach(p => ensureKiller(p.id))\r\n    setKillerById(prev => {\r\n      const copy: Record<string, ReturnType<typeof createKillerState>> = {}\r\n      for (const [id, st] of Object.entries(prev)) copy[id] = { ...st }\r\n      const res = applyKillerDart(pid, copy, ring, sector)\r\n      // Trigger simple winner check\r\n      const win = killerWinner(copy)\r\n      if (win) {\r\n        try { triggerCelebration('leg', match.players.find(p=>p.id===win)?.name || 'Player') } catch {}\r\n      }\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyAmCricketAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureAmCricket(pid)\r\n    setAmCricketById(prev => {\r\n      const copy = { ...prev }\r\n      const base = (copy[pid] || createAmCricketState())\r\n      const st: ReturnType<typeof createAmCricketState> = { ...(base as any) }\r\n      const oppClosed = (n: 12|13|14|15|16|17|18|19|20|25) => match.players.filter(p=>p.id!==pid).every(p => (((amCricketById[p.id]?.marks as any)?.[n]||0) >= 3))\r\n      applyAmCricketDart(st, value, ring, sector, oppClosed)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyBaseballAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureBaseball(pid)\r\n    setBaseballById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createBaseball()) }\r\n      applyBaseballDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyGolfAuto(value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE', sector?: number | null) {\r\n    const pid = currentPlayerId()\r\n    ensureGolf(pid)\r\n    setGolfById(prev => {\r\n      const copy = { ...prev }\r\n      const st = { ...(copy[pid] || createGolf()) }\r\n      applyGolfDart(st, value, ring as any, sector)\r\n      copy[pid] = st\r\n      return copy\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  function applyTttAuto(cell: number, value: number, ring?: 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL', sector?: number | null) {\r\n    setTTT(prev => {\r\n      const cp = { ...prev, board: [...prev.board] as any }\r\n      tryClaimCell(cp as any, (cell as any), value, ring as any, sector)\r\n      return cp as any\r\n    })\r\n    const nd = turnDarts + 1\r\n    setTurnDarts(nd)\r\n    if (nd >= 3) { setTurnDarts(0); match.nextPlayer(); sendState() } else { sendState() }\r\n  }\r\n\r\n  // Open/close Manual Correction dialog in CameraView\r\n  function openManual() { try { window.dispatchEvent(new Event('ndn:open-manual' as any)) } catch {} }\r\n  function closeManual() { try { window.dispatchEvent(new Event('ndn:close-manual' as any)) } catch {} }\r\n\r\n  // Helper to submit a manual visit with shared logic\r\n  function submitVisitManual(v: number) {\r\n    const score = Math.max(0, v | 0)\r\n    // Estimate double-out attempts and finish for manual numeric entry\r\n    try {\r\n      const p = match.players[match.currentPlayerIdx]\r\n      const leg = p?.legs?.[p.legs.length - 1]\r\n      const preRem = leg ? leg.totalScoreRemaining : match.startingScore\r\n      const postRem = Math.max(0, preRem - score)\r\n      const attempts = preRem <= 50 ? 3 : (postRem <= 50 ? 1 : 0)\r\n      const finished = postRem === 0\r\n      match.addVisit(score, 3, { preOpenDarts: 0, doubleWindowDarts: attempts, finishedByDouble: finished, visitTotal: score })\r\n    } catch {\r\n      match.addVisit(score, 3)\r\n    }\r\n    setVisitScore(0)\r\n    const p = match.players[match.currentPlayerIdx]\r\n    const leg = p.legs[p.legs.length - 1]\r\n    // Instant celebration locally\r\n    try {\r\n      if (score === 180) triggerCelebration('180', p?.name || 'Player')\r\n      if (leg && leg.totalScoreRemaining === 0) triggerCelebration('leg', p?.name || 'Player')\r\n    } catch {}\r\n    if (leg && leg.totalScoreRemaining === 0) { match.endLeg(score) } else { match.nextPlayer() }\r\n    if (callerEnabled) {\r\n      const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n      sayScore(user?.username || 'Player', score, Math.max(0, rem), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n    }\r\n    if (user?.username && p?.name === user.username) { addSample(user.username, 3, score) }\r\n    sendState()\r\n  }\r\n\r\n  function reportMessage(offenderId: string | null, text: string) {\r\n    const payload: any = { type: 'report', offenderId, reason: 'Inappropriate language', message: text }\r\n    try { if (wsGlobal) wsGlobal.send(payload); else wsRef.current?.send(JSON.stringify(payload)) } catch {}\r\n    try { toast('Report submitted', { type: 'info' }) } catch {}\r\n  }\r\n\r\n  function isMobileLike() {\r\n    if (typeof navigator === 'undefined') return false\r\n    const ua = navigator.userAgent || ''\r\n    return /Android|iPhone|iPad|iPod|Mobile/i.test(ua)\r\n  }\r\n\r\n  // Try to take a quick camera snapshot to show to the match creator (non-blocking)\r\n  async function getBoardPreview(): Promise<string | null> {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n      const track = stream.getVideoTracks?.()[0]\r\n      // Create a hidden video element to draw a frame\r\n      const video = document.createElement('video')\r\n      video.srcObject = stream\r\n      await video.play().catch(()=>{})\r\n      // Wait a moment for first frame\r\n      await new Promise(r => setTimeout(r, 120))\r\n      const w = Math.min(320, video.videoWidth || 320)\r\n      const h = Math.max(1, Math.floor((video.videoHeight || 180) * (w / Math.max(1, video.videoWidth || 320))))\r\n      const canvas = document.createElement('canvas')\r\n      canvas.width = w; canvas.height = h\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(video, 0, 0, w, h)\r\n      const url = canvas.toDataURL('image/jpeg', 0.7)\r\n      // Cleanup\r\n      try { if (track) track.stop() } catch {}\r\n      try { (stream as any).getTracks?.().forEach((t:any)=>t.stop()) } catch {}\r\n      return url\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  // WebRTC for mobile camera\r\n  const startMobileWebRTC = async (code: string) => {\r\n    console.log('Starting WebRTC for code:', code)\r\n    try {\r\n      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] })\r\n      pc.ontrack = (event) => {\r\n        console.log('Received track:', event.streams[0])\r\n        setMobileStream(event.streams[0])\r\n        if (mobileVideoRef.current) {\r\n          mobileVideoRef.current.srcObject = event.streams[0]\r\n          console.log('Set video srcObject')\r\n        }\r\n      }\r\n      pc.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          console.log('Sending ICE candidate')\r\n          if (wsGlobal) {\r\n            wsGlobal.send({ type: 'cam-ice', code, payload: event.candidate })\r\n          } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify({ type: 'cam-ice', code, payload: event.candidate }))\r\n          }\r\n        }\r\n      }\r\n      pc.onconnectionstatechange = () => console.log('Connection state:', pc.connectionState)\r\n      const offer = await pc.createOffer()\r\n      await pc.setLocalDescription(offer)\r\n      console.log('Sending offer')\r\n      // Try WebSocket first, otherwise fall back to REST POST\r\n      if (wsGlobal) {\r\n        console.log('Sending offer via wsGlobal')\r\n        wsGlobal.send({ type: 'cam-offer', code, payload: offer })\r\n      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n        console.log('Sending offer via wsRef')\r\n        wsRef.current.send(JSON.stringify({ type: 'cam-offer', code, payload: offer }))\r\n      } else {\r\n        console.log('WS not available, POSTing offer to /cam/signal')\r\n        try {\r\n          await apiFetch(`/cam/signal/${code}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ type: 'cam-offer', payload: offer, source: 'desktop' }) })\r\n        } catch (e) { console.warn('REST offer failed', e) }\r\n      }\r\n      // Store pc for later use\r\n      (window as any).mobilePC = pc\r\n    } catch (err) {\r\n      console.error('WebRTC error:', err)\r\n      toast('Failed to start mobile camera', { type: 'error' })\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell relative overflow-hidden\">\r\n      <h2 className=\"text-xl font-semibold mb-1\">Online Play</h2>\r\n      <div className=\"ndn-shell-body\">\r\n      {/* Pause overlay/banner */}\r\n      {paused && (\r\n        <div className=\"absolute inset-0 z-40 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-center p-4\">\r\n          <div className=\"text-2xl font-bold mb-2\">Game Paused</div>\r\n          <div className=\"text-sm opacity-80 mb-4\">Resumes {pauseEndsAt ? `in ${Math.max(0, Math.ceil((pauseEndsAt - Date.now())/1000))}s` : 'soon'}</div>\r\n          <div className=\"text-xs opacity-60\">Both players can see this pause screen.</div>\r\n        </div>\r\n      )}\r\n      {unread > 0 && !match.inProgress && (\r\n        <div className=\"mb-3 text-sm px-3 py-2 rounded bg-amber-600/30 border border-amber-500/40\">\r\n          You have {unread} unread message{unread>1?'s':''}. Check the Friends tab.\r\n        </div>\r\n      )}\r\n      <div className=\"relative\">\r\n        <div className=\"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <label className=\"text-xs opacity-70 shrink-0\">Room</label>\r\n            <input className=\"input w-28\" value={roomId} onChange={e => setRoomId(e.target.value)} placeholder=\"room-1\" />\r\n          </div>\r\n          {connected ? (\r\n            <span className=\"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0\">Connected</span>\r\n          ) : (\r\n            <button className=\"btn bg-rose-600 hover:bg-rose-700 shrink-0\" onClick={connect}>Connect</button>\r\n          )}\r\n          <button className=\"btn shrink-0\" onClick={sendState} disabled={!connected}>Sync</button>\r\n          {/* Pause controls */}\r\n          {!paused && !pauseRequestedBy && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <label className=\"text-xs opacity-70\">Pause (max 10m)</label>\r\n              <select className=\"input w-28\" value={pauseDurationSec}\r\n                onChange={e => setPauseDurationSec(Math.max(60, Math.min(600, parseInt(e.target.value)||300)))}>\r\n                <option value={120}>2 min</option>\r\n                <option value={300}>5 min</option>\r\n                <option value={600}>10 min</option>\r\n              </select>\r\n              <button className=\"btn\" disabled={!connected}\r\n                onClick={() => {\r\n                  const me = (user?.username || 'player')\r\n                  setPauseRequestedBy(me)\r\n                  setPauseAcceptedBy({ [me]: true })\r\n                  setPausedLocal(false); setPauseEndsAt(null)\r\n                  sendState()\r\n                }}\r\n              >Request Pause</button>\r\n            </div>\r\n          )}\r\n          {!paused && pauseRequestedBy && !pauseAcceptedBy[(user?.username||'')] && (\r\n            <div className=\"flex items-center gap-2 text-xs\">\r\n              <span className=\"opacity-80\">{pauseRequestedBy} requested a {Math.round((pauseDurationSec||300)/60)}m pause</span>\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={() => {\r\n                  const me = (user?.username || '')\r\n                  const next: Record<string, boolean> = { ...pauseAcceptedBy, [me]: true }\r\n                  setPauseAcceptedBy(next)\r\n                  // If at least 2 unique acceptances (both players), start pause\r\n                  const acceptedCount = Object.keys(next).filter((k: string) => !!next[k]).length\r\n                  const required = Math.max(2, (participants?.length || 2))\r\n                  if (acceptedCount >= 2 || acceptedCount >= required) {\r\n                    const ends = Date.now() + Math.min(600, Math.max(60, pauseDurationSec||300)) * 1000\r\n                    setPausedLocal(true); setPauseEndsAt(ends)\r\n                    setPausedGlobal(true, ends)\r\n                  }\r\n                  sendState()\r\n                }}\r\n              >Accept</button>\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                onClick={() => { setPauseRequestedBy(null); setPauseAcceptedBy({}); setPausedLocal(false); setPauseEndsAt(null); setPausedGlobal(false, null); sendState() }}\r\n              >Decline</button>\r\n            </div>\r\n          )}\r\n          {paused && (\r\n            <span className=\"text-[11px] px-2 py-1 rounded-full bg-yellow-500/25 text-yellow-100 border border-yellow-400/40 shrink-0\">\r\n              Paused · {Math.max(0, Math.ceil(((pauseEndsAt||Date.now()) - Date.now())/1000))}s\r\n            </span>\r\n          )}\r\n          <button\r\n            className=\"text-[11px] px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40 shrink-0\"\r\n            title=\"Open a simulated online match demo\"\r\n            onClick={() => { \r\n              try { \r\n                window.dispatchEvent(new CustomEvent('ndn:online-match-demo', { detail: { game: 'X01', start: 501 } })) \r\n              } catch (err) {\r\n                console.error('Demo click error:', err)\r\n              }\r\n            }}\r\n          >DEMO</button>\r\n          {connected && (\r\n            <button className=\"btn shrink-0\" onClick={() => setShowMatchModal(true)} disabled={locked} title={locked ? 'Weekly free games used' : ''}>Open Match</button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {/* Create Match+ box (top-right area) */}\r\n      <div\r\n        className={`mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-end ${(!connected || locked) ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'}`}\r\n        role=\"button\"\r\n        title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n        onClick={() => {\r\n          if (!connected || locked) return\r\n          setShowCreate(true)\r\n          if (wsGlobal) wsGlobal.send({ type: 'list-matches' })\r\n          else wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n        }}\r\n      >\r\n        <button className=\"btn\" disabled={!connected || locked}>Create Match +</button>\r\n      </div>\r\n      <p className=\"text-sm text-slate-600 mt-3\">Open this app on another device and join the same Room ID to sync scores.</p>\r\n      {!user?.fullAccess && (\r\n        <div className=\"text-xs text-slate-400 mt-1\">Weekly free online games remaining: {freeLeft === Infinity ? 'ÔÇö' : freeLeft}</div>\r\n      )}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm\">You've used your 3 free online games this week. PREMIUM required to continue.</div>\r\n      )}\r\n      {errorMsg && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-rose-700/30 border border-rose-600/40 text-rose-200 text-sm font-semibold flex items-center gap-2\">\r\n          <span className=\"material-icons text-rose-300\">error_outline</span>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n      {offerNewRoom && (\r\n        <div className=\"mt-2 p-2 rounded-lg bg-indigo-700/30 border border-indigo-600/40 text-indigo-100 text-sm flex items-center justify-between gap-2\">\r\n          <div>That room is full or no longer available. Create a new clean room with the same settings?</div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button className=\"btn px-3 py-1 text-sm\" onClick={()=>{\r\n              const { game, mode, value, startingScore } = offerNewRoom\r\n              const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n              if (wsGlobal) {\r\n                wsGlobal.send({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg })\r\n                wsGlobal.send({ type: 'list-matches' })\r\n              } else {\r\n                wsRef.current?.send(JSON.stringify({ type: 'create-match', game, mode, value, startingScore: startingScore || 501, creatorAvg }))\r\n                wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n              }\r\n              setOfferNewRoom(null)\r\n            }}>Create New Match</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800 px-3 py-1 text-sm\" onClick={()=>setOfferNewRoom(null)}>Dismiss</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Global toaster is mounted in App */}\r\n\r\n  {/* World Lobby with filters */}\r\n      {connected && (\r\n        <div className=\"mt-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10 flex-1 overflow-auto\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"font-semibold\">World Lobby</div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-xs opacity-80\">Matches: {filteredLobby.length}</div>\r\n              <button className=\"btn px-3 py-1 text-sm\" onClick={()=> (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' })))}>Refresh</button>\r\n              <button\r\n                className=\"btn px-3 py-1 text-sm\"\r\n                title={!connected ? 'Connect to the lobby first' : (locked ? 'Weekly free games used' : 'Create a new match')}\r\n                disabled={!connected || locked}\r\n                onClick={() => { if (!connected || locked) return; setShowCreate(true); (wsGlobal ? wsGlobal.send({ type: 'list-matches' }) : wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))) }}\r\n              >Create Match +</button>\r\n            </div>\r\n          </div>\r\n          {/* Filters */}\r\n          <div className=\"space-y-3 mb-3\">\r\n            <div>\r\n              <label className=\"block text-xs opacity-70 mb-1\">Mode</label>\r\n              <TabPills\r\n                tabs={[{ key: 'all', label: 'All' }, { key: 'bestof', label: 'Best of' }, { key: 'firstto', label: 'First to' }]}\r\n                active={filterMode}\r\n                onChange={(k)=> setFilterMode(k as any)}\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Game</label>\r\n                <select className=\"input w-full text-sm\" value={filterGame as any} onChange={e=>setFilterGame(e.target.value as any)}>\r\n                  <option value=\"all\">All</option>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g}>{g}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Starting Score</label>\r\n                <select className=\"input w-full text-sm\" value={filterStart as any} onChange={e=>{\r\n                  const v = e.target.value\r\n                  if (v==='all') setFilterStart('all'); else setFilterStart(Number(v) as any)\r\n                }} disabled={filterGame !== 'all' && filterGame !== 'X01'}>\r\n                  <option value=\"all\">All</option>\r\n                  <option value=\"301\">301</option>\r\n                  <option value=\"501\">501</option>\r\n                  <option value=\"701\">701</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs opacity-70 mb-2 font-semibold\">Opponent Average</label>\r\n                <div className=\"flex items-center gap-2 h-10 px-3 rounded bg-slate-900/30 border border-slate-500/30\">\r\n                  <input \r\n                    id=\"nearavg\" \r\n                    type=\"checkbox\" \r\n                    className=\"w-4 h-4 cursor-pointer accent-purple-500\" \r\n                    checked={nearAvg} \r\n                    onChange={e=>setNearAvg(e.target.checked)} \r\n                    title={!myAvg || myAvg === 0 ? 'Play a game first to use this filter' : 'Filter matches near your average'}\r\n                  />\r\n                  <label htmlFor=\"nearavg\" className=\"cursor-pointer text-sm flex-1\">Near my avg</label>\r\n                  <input \r\n                    type=\"number\" \r\n                    className=\"input w-20 text-sm px-2 py-1\" \r\n                    min={5} \r\n                    max={40} \r\n                    step={1} \r\n                    value={avgTolerance} \r\n                    onChange={e=>{\r\n                      const val = parseInt(e.target.value || '10');\r\n                      if (!isNaN(val)) setAvgTolerance(Math.max(5, Math.min(40, val)));\r\n                    }}\r\n                    disabled={!nearAvg}\r\n                    title=\"Tolerance range (±)\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center justify-between gap-3 pt-2\">\r\n              <div className=\"flex-1 max-w-xs\">\r\n                <label className={`block text-xs opacity-70 mb-2 font-semibold ${!nearAvg ? 'opacity-40' : ''}`}>Avg Tolerance (±)</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input \r\n                    type=\"range\" \r\n                    min=\"1\" \r\n                    max=\"50\" \r\n                    value={avgTolerance} \r\n                    onChange={e=>{\r\n                      const newVal = parseInt(e.target.value, 10);\r\n                      if (!isNaN(newVal)) {\r\n                        setAvgTolerance(Math.max(1, Math.min(50, newVal)));\r\n                      }\r\n                    }}\r\n                    disabled={!nearAvg}\r\n                    title=\"Drag to set tolerance\"\r\n                    className=\"w-32 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    style={{\r\n                      background: nearAvg \r\n                        ? 'linear-gradient(to right, rgb(55, 65, 81) 0%, rgb(55, 65, 81) ' + ((avgTolerance - 1) / 49 * 100) + '%, rgb(88, 28, 135) ' + ((avgTolerance - 1) / 49 * 100) + '%, rgb(88, 28, 135) 100%)'\r\n                        : 'linear-gradient(to right, rgb(71, 85, 105) 0%, rgb(71, 85, 105) 100%)'\r\n                    }}\r\n                  />\r\n                  <div className=\"text-xs font-mono font-semibold w-8 text-right text-purple-400\">±{avgTolerance}</div>\r\n                </div>\r\n              </div>\r\n              <button \r\n                className=\"btn px-3 py-2 text-sm mt-6\" \r\n                onClick={()=>{ \r\n                  setFilterMode('all'); \r\n                  setFilterGame('all'); \r\n                  setFilterStart('all'); \r\n                  setNearAvg(false); \r\n                  setAvgTolerance(10) \r\n                }}\r\n              >Reset</button>\r\n            </div>\r\n          </div>\r\n          {filteredLobby.length === 0 ? (\r\n            <div className=\"text-sm text-slate-300\">No games waiting. Create one!</div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {filteredLobby.map((m:any)=> (\r\n                <div key={m.id} className=\"p-3 rounded-lg bg-black/20 flex items-center justify-between relative\">\r\n                  <div className=\"text-sm\">\r\n                    <div>{m.game || 'X01'} {m.game==='X01' ? ` ${m.startingScore}` : ''} - {m.mode==='bestof' ? `Best Of ${m.value}` : `First To ${m.value}`} - Created by {m.creatorName}</div>\r\n                    {m.requireCalibration && (\r\n                      <div className=\"text-[11px] inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-600/30 mt-1\">Calibration required</div>\r\n                    )}\r\n                    {m.creatorAvg ? (\r\n                      <div className=\"text-xs opacity-70\">Creator avg: {Number(m.creatorAvg).toFixed(1)}</div>\r\n                    ) : null}\r\n                    <div className=\"text-xs opacity-70\">ID: {m.id}</div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button className=\"btn px-3 py-1 text-sm bg-green-600 hover:bg-green-700\" disabled={locked || (!user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)) || (!!m.requireCalibration && !calibH)} title={\r\n                      !user?.fullAccess && (premiumGames as readonly string[]).includes(m.game)\r\n                        ? 'PREMIUM game'\r\n                        : (locked ? 'Weekly free games used' : (!!m.requireCalibration && !calibH ? 'Calibration required' : ''))\r\n                    } onClick={async ()=>{\r\n                      setLastJoinIntent({ game: m.game, mode: m.mode, value: m.value, startingScore: m.startingScore })\r\n                      const calibrated = !!calibH\r\n                      const boardPreview = await getBoardPreview()\r\n                      try {\r\n                        // Simulate Stripe checkout error for demo\r\n                        // throw new Error('Failed to create checkout session')\r\n                        if (wsGlobal) wsGlobal.send({ type: 'join-match', matchId: m.id, calibrated, boardPreview })\r\n                        else wsRef.current?.send(JSON.stringify({ type: 'join-match', matchId: m.id, calibrated, boardPreview }))\r\n                      } catch (err: any) {\r\n                        handleStripeError(err?.message || 'Failed to create Stripe checkout session. Please try again later.')\r\n                      }\r\n                    }}>Join Now!</button>\r\n                    {selfId && m.creatorId === selfId && (\r\n                      <button\r\n                        className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                        title=\"Close this match\"\r\n                        onClick={()=>{\r\n                          if (wsGlobal) wsGlobal.send({ type: 'cancel-match', matchId: m.id })\r\n                          else wsRef.current?.send(JSON.stringify({ type: 'cancel-match', matchId: m.id }))\r\n                        }}\r\n                        aria-label=\"Close match\"\r\n                      >×</button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Frosted lock overlay when non-premium user is locked */}\r\n      {(!user?.fullAccess && freeLeft !== Infinity && freeLeft <= 0) && (\r\n        <div className=\"absolute inset-0 z-40 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 backdrop-blur-sm bg-slate-900/40\" />\r\n          <div className=\"relative z-10 p-4 rounded-xl bg-black/60 border border-slate-700 text-center\">\r\n            <div className=\"text-3xl mb-2\">­ƒöÆ</div>\r\n            <div className=\"font-semibold\">Online play locked</div>\r\n            <div className=\"text-sm text-slate-200/80\">YouÔÇÖve used your 3 free online games this week. Upgrade to PREMIUM to play all modes.</div>\r\n            <button \r\n              onClick={async () => {\r\n                try {\r\n                  const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ email: user?.email })\r\n                  })\r\n                  const data = await res.json()\r\n                  if (data.ok && data.url) {\r\n                    window.location.href = data.url\r\n                  } else {\r\n                    alert('Failed to create payment session: ' + (data.error || 'Unknown error'))\r\n                  }\r\n                } catch (e) {\r\n                  alert('Network error')\r\n                }\r\n              }}\r\n              className=\"btn mt-3 bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold\"\r\n            >\r\n              Upgrade to PREMIUM = {formatPriceInCurrency(getUserCurrency(), 5)}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showMatchModal && (\r\n        <div className=\"fixed inset-0 z-50\">\r\n          <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" />\r\n          <div className=\"absolute inset-0 flex flex-col\">\r\n            <div className=\"p-2 md:p-3 flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"text-xl md:text-2xl font-bold\">Online Match</h3>\r\n                {/* Room id hidden in-game to reduce clutter */}\r\n              </div>\r\n              <button className=\"btn px-3 py-1\" onClick={() => setShowMatchModal(false)}>Close</button>\r\n            </div>\r\n            <div className=\"relative flex-1 overflow-hidden p-2 md:p-3\">\r\n              <div className=\"card w-full h-full overflow-hidden relative p-2.5 md:p-3\">\r\n            {/* Ephemeral celebration overlay */}\r\n            {celebration && (\r\n              <div className=\"absolute inset-0 pointer-events-none flex items-start justify-center pt-8 z-20\">\r\n                <div className={`px-4 py-2 rounded-full text-lg font-bold shadow ${celebration.kind==='leg' ? 'bg-indigo-500/20 border border-indigo-400/40 text-indigo-100' : 'bg-emerald-500/20 border border-emerald-400/40 text-emerald-100'}`}>\r\n                  {celebration.kind==='leg' ? '­ƒÅü LEG WON ÔÇö ' : '­ƒÄ» ONE HUNDRED AND EIGHTY! ÔÇö '}{celebration.by}\r\n                </div>\r\n                {/* Lightweight confetti for leg wins */}\r\n                {celebration.kind === 'leg' && (\r\n                  <>\r\n                    <style>{`@keyframes ndn-confetti-fall{0%{transform:translateY(-10%) rotate(0deg);opacity:1}100%{transform:translateY(120%) rotate(360deg);opacity:0}}`}</style>\r\n                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                      {[...Array(24)].map((_,i)=>{\r\n                        const left = Math.random()*100\r\n                        const delay = Math.random()*0.2\r\n                        const dur = 1.2 + Math.random()*0.8\r\n                        const size = 6 + Math.random()*6\r\n                        const hue = Math.floor(Math.random()*360)\r\n                        return (\r\n                          <span key={i} style={{ position:'absolute', top:0, left: left+'%', width: size, height: size, background:`hsl(${hue} 90% 60%)`, borderRadius: 2, animation: `ndn-confetti-fall ${dur}s ease-out ${delay}s forwards` }} />\r\n                        )\r\n                      })}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"mb-1.5 text-xs md:text-sm flex items-center justify-between gap-2\">\r\n              <span>Participants: {participants.length || 1}</span>\r\n              <button\r\n                className=\"text-[11px] px-2 py-0.5 rounded-full bg-slate-700/50 hover:bg-slate-700 border border-slate-600\"\r\n                onClick={() => setCompactView(v => !v)}\r\n                title={compactView ? 'Switch to full multi-player view' : 'Switch to compact player-by-player view'}\r\n              >{compactView ? 'Full view' : 'Compact view'}</button>\r\n            </div>\r\n            {/* Header row styled to match Offline X01 screen (sticky, glassy bar) */}\r\n            {(() => {\r\n              const a = match.players?.[0]?.legsWon || 0\r\n              const b = match.players?.[1]?.legsWon || 0\r\n              return (\r\n                <GameHeaderBar\r\n                  left={(\r\n                    <>\r\n                      <span className=\"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs\">Game Mode</span>\r\n                      <span className=\"font-medium whitespace-nowrap\">{currentGame}{currentGame==='X01' ? ` / ${match.startingScore}` : ''}</span>\r\n                      <span className=\"opacity-80 whitespace-nowrap\">Legs {a}–{b}</span>\r\n                    </>\r\n                  )}\r\n                  right={(\r\n                    <>\r\n                      <span className=\"opacity-70 text-[10px]\">Match</span>\r\n                      <select className={`btn ${buttonSizeClass}`} value={matchType} onChange={e=>setMatchType((e.target.value as 'singles'|'doubles'))}>\r\n                        <option value=\"singles\">Singles</option>\r\n                        <option value=\"doubles\">Doubles</option>\r\n                      </select>\r\n                      <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamAName} onChange={e=>setTeamAName(e.target.value)} placeholder=\"Team A\" />\r\n                      <span className=\"opacity-50\">vs</span>\r\n                      <input className={`input ${buttonSizeClass} w-[7.5rem]`} value={teamBName} onChange={e=>setTeamBName(e.target.value)} placeholder=\"Team B\" />\r\n                    </>\r\n                  )}\r\n                />\r\n              )\r\n            })()}\r\n            {/* Summary area */}\r\n            {compactView ? (\r\n              <div className=\"mb-3\">\r\n                {(() => {\r\n                  const idx = match.currentPlayerIdx\r\n                  const p = match.players[idx]\r\n                  if (!p) return null\r\n                  const leg = p.legs[p.legs.length-1]\r\n                  const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                  const isMe = (user?.username && p.name === user.username)\r\n                  const lastVisitScore = leg && leg.visits.length ? leg.visits[leg.visits.length-1].score : 0\r\n                  // TV-style match average for this player across all legs\r\n                  const totals = (() => { let pts=0, d=0; for (const L of (p?.legs||[])) { pts += (L.totalScoreStart - L.totalScoreRemaining); d += (L.visits||[]).reduce((a,v)=>a + (v.darts||0) - (v.preOpenDarts||0), 0) } return { pts, d } })()\r\n                  const avg = totals.d > 0 ? ((totals.pts / totals.d) * 3) : 0\r\n                  if (currentGame === 'X01') {\r\n                    return (\r\n                      <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                        <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                          <span className=\"font-semibold\">{p.name}</span>\r\n                          <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                            {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"text-4xl font-extrabold\">{rem}</div>\r\n                        <div className=\"text-sm mt-1\">Last score: <span className=\"font-semibold\">{lastVisitScore}</span></div>\r\n                        <div className=\"text-sm\">3-Dart Avg: <span className=\"font-semibold\">{avg.toFixed(1)}</span></div>\r\n                        {isMe && idx===match.currentPlayerIdx && rem <= 170 && rem > 0 && (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  }\r\n                  // Non-X01 (e.g., Double Practice, Around the Clock, Treble Practice): show target and progress instead of X01 remaining\r\n                  return (\r\n                    <div className={`p-4 rounded-xl bg-brand-50 text-black ${idx===match.currentPlayerIdx?'ring-2 ring-brand-400':''}`}>\r\n                      <div className=\"text-xs text-slate-600 flex items-center justify-between\">\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        <span className={`px-2 py-0.5 rounded-full ${idx===match.currentPlayerIdx?'bg-emerald-500/20 text-emerald-300':'bg-slate-500/20 text-slate-300'} text-xs font-bold`}>\r\n                          {idx===match.currentPlayerIdx ? 'THROWING' : 'WAITING TO THROW'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"text-sm opacity-80\">{currentGame}</div>\r\n                      {currentGame === 'Double Practice' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                      {currentGame === 'Around the Clock' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Current target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{atcHits} / {ATC_ORDER.length}</div>\r\n                        </>\r\n                      )}\r\n                      {currentGame === 'Treble Practice' && (\r\n                        <>\r\n                          <div className=\"mt-1 text-xs flex items-center justify-between\">\r\n                            <span>Treble Target</span>\r\n                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">T{trebleTarget}</span>\r\n                          </div>\r\n                          <div className=\"text-3xl font-extrabold\">{trebleHits} / {trebleDarts}</div>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  )\r\n                })()}\r\n                {match.players.length > 1 && (\r\n                  <div className=\"mt-2 text-xs text-slate-400\">Next up: {match.players[(match.currentPlayerIdx+1) % match.players.length]?.name}</div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {/* Full overview: slim strip with each player's remaining */}\r\n                <div className=\"mb-3 flex flex-wrap items-center gap-2\">\r\n                  {match.players.map((p, idx) => {\r\n                    const leg = p.legs[p.legs.length-1]\r\n                    const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                    return (\r\n                      <div key={`strip-${p.id}`} className={`px-2 py-1 rounded bg-black/20 border border-slate-700/40 text-xs ${idx===match.currentPlayerIdx ? 'ring-1 ring-brand-400' : ''}`}>\r\n                        <span className=\"font-semibold\">{p.name}</span>\r\n                        {currentGame === 'X01' ? (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">{rem}</span>\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <span className=\"opacity-70\"> = </span>\r\n                            <span className=\"font-mono\">\r\n                              {currentGame === 'Double Practice' ? `${dpHits}/${DOUBLE_PRACTICE_ORDER.length}`\r\n                                : currentGame === 'Around the Clock' ? `${atcHits}/${ATC_ORDER.length}`\r\n                                : currentGame === 'Treble Practice' ? `${trebleHits}/${trebleDarts}`\r\n                                : currentGame === 'Cricket' ? `${(cricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Shanghai' ? `${(shanghaiById[p.id]?.score||0)} pts = R${(shanghaiById[p.id]?.round||1)}`\r\n                                : currentGame === 'Halve It' ? `${(halveById[p.id]?.score||0)} pts = S${(halveById[p.id]?.stage||0)+1}`\r\n                                : currentGame === 'High-Low' ? `${(highlowById[p.id]?.score||0)} pts = ${(highlowById[p.id]?.target||'HIGH')}`\r\n                                : currentGame === 'Killer' ? (() => { const st = killerById[p.id]; return st ? `#${st.number} = ${st.lives}ÔØñ ${st.isKiller?'= K':''}` : 'ÔÇö' })()\r\n                                : currentGame === 'American Cricket' ? `${(amCricketById[p.id]?.points||0)} pts`\r\n                                : currentGame === 'Baseball' ? (() => { const st = baseballById[p.id]; return st ? `R${st.score} = I${st.inning}` : 'ÔÇö' })()\r\n                                : currentGame === 'Golf' ? (() => { const st = golfById[p.id]; return st ? `S${st.strokes} = H${st.hole}` : 'ÔÇö' })()\r\n                                : currentGame === 'Tic Tac Toe' ? (() => { const x = (ttt.board||[]).filter((c:any)=>c==='X').length; const o = (ttt.board||[]).filter((c:any)=>c==='O').length; return `X${x}-O${o}` })()\r\n                                : currentGame}\r\n                            </span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </>\r\n            )}\r\n            {compactView ? (\r\n              <div className=\"space-y-2\">\r\n                {/* Top toolbar */}\r\n                <div className=\"flex flex-col gap-2 mb-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                  <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                  {!manualScoring && (\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={() => {\r\n                      console.log('Sending cam-create')\r\n                      if (wsGlobal) {\r\n                        wsGlobal.send({ type: 'cam-create' })\r\n                      } else if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\r\n                        wsRef.current.send(JSON.stringify({ type: 'cam-create' }))\r\n                      } else {\r\n                        toast('Not connected to server', { type: 'error' })\r\n                      }\r\n                    }}>Pair Phone</button>\r\n                  )}\r\n                  {!manualScoring && pairingCode && (\r\n                    <div className=\"ml-2 text-sm bg-blue-900/50 p-2 rounded\">\r\n                      <div><span className=\"opacity-70\">Mobile pairing code: </span><span className=\"font-mono font-bold text-lg\">{pairingCode}</span></div>\r\n                      <div className=\"text-xs opacity-70 mt-1\">On your phone, go to: <a href={`/mobile-cam.html?code=${pairingCode}`} target=\"_blank\" className=\"underline\">{window.location.origin}/mobile-cam.html?code={pairingCode}</a></div>\r\n                    </div>\r\n                  )}\r\n                  {!manualScoring && (\r\n                    <div className=\"ml-auto flex items-center gap-1 text-[11px]\">\r\n                      <span className=\"opacity-70\">Cam size</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} min-w-[2.5rem] text-center`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={()=>setCameraFitMode(cameraFitMode==='fill'?'fit':'fill')}>{cameraFitMode==='fill'?'Fill':'Fit'}</button>\r\n                    </div>\r\n                  )}\r\n                  </div>\r\n                </div>\r\n                {/* Summary (left) + Camera (right) */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 items-start h-full\">\r\n                  <div className=\"order-1\">\r\n                    {currentGame === 'X01' ? (\r\n                      <RenderMatchSummary />\r\n                    ) : (\r\n                      <GameScoreboard\r\n                        gameMode={currentGame as any}\r\n                        players={useOnlineGameStats(currentGame as any, match, participants)}\r\n                        matchScore={match.players?.length === 2 ? `${match.players[0]?.legsWon || 0}-${match.players[1]?.legsWon || 0}` : undefined}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                  <div className=\"order-2 flex-1 min-h-0\">\r\n                    {cameraEnabled ? (\r\n                      <div className=\"min-w-0 relative z-10 flex-1 min-h-0 ndn-camera-tall\">\r\n                        <ResizablePanel\r\n                          storageKey=\"ndn:camera:tile:online:top\"\r\n                          className=\"relative rounded-2xl overflow-hidden bg-black\"\r\n                          defaultWidth={520}\r\n                          defaultHeight={320}\r\n                          minWidth={280}\r\n                          minHeight={200}\r\n                          maxWidth={1600}\r\n                          maxHeight={900}\r\n                          autoFill\r\n                        >\r\n                          <CameraTile \r\n                            label=\"Your Board\" \r\n                            autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                            aspect=\"classic\"\r\n                            fill\r\n                          />\r\n                        </ResizablePanel>\r\n                        {/** Duplicate compact toolbar removed; header now contains match controls */}\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                </div>\r\n                <div className=\"font-semibold\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                {currentGame === 'X01' && cameraEnabled && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                  <>\r\n                    {/* Camera autoscore module; only render for current thrower */}\r\n                    <CameraView x01DoubleInOverride={x01DoubleInMatch} hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                      if (callerEnabled) {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs[p.legs.length-1]\r\n                        const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                      }\r\n                      const current = match.players[match.currentPlayerIdx]\r\n                      if (user?.username && current?.name === user.username) {\r\n                        addSample(user.username, darts, score)\r\n                      }\r\n                      // Instant local celebration\r\n                      try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                      // If an opponent is present, rotate turns; otherwise stay on the same player for solo practice\r\n                      if (!finished) {\r\n                        const hasOpponent = (participants?.length || 0) >= 2\r\n                        if (hasOpponent) { match.nextPlayer() }\r\n                      }\r\n                      sendState()\r\n\r\n                      try {\r\n                        // Auto-show highlight modal for notable events:\r\n                        // - a checkout (finished) where the visit score was > 50\r\n                        // - a big visit where score > 100\r\n                        if ((finished && score > 50) || score > 100) {\r\n                          const current = match.players[match.currentPlayerIdx]\r\n                          const remaining = (current?.legs?.[current.legs.length-1]?.totalScoreRemaining) ?? match.startingScore\r\n                          const highlight = {\r\n                            player: current?.name || user?.username || 'Player',\r\n                            score,\r\n                            darts,\r\n                            finished,\r\n                            remainingBefore: Math.max(0, (remaining + score)),\r\n                            ts: Date.now(),\r\n                          }\r\n                          setHighlightCandidate(highlight)\r\n                          setShowHighlightModal(true)\r\n                        }\r\n                      } catch {}\r\n                    }} />\r\n                    {/* Highlight modal: offers download or save to account when a notable visit occurs */}\r\n                    {showHighlightModal && highlightCandidate ? (\r\n                      <ResizableModal storageKey=\"ndn:modal:highlight\" className=\"w-[420px]\" defaultWidth={420} defaultHeight={220} minWidth={320} minHeight={160} initialFitHeight>\r\n                        <div className=\"p-4\">\r\n                          <div className=\"text-lg font-semibold mb-2\">Save highlight</div>\r\n                          <div className=\"text-sm mb-3\">Player: <strong>{highlightCandidate.player}</strong> — Score: <strong>{highlightCandidate.score}</strong> — Darts: <strong>{highlightCandidate.darts}</strong></div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <button className=\"btn\" onClick={() => downloadHighlightToDevice()}>Download to device</button>\r\n                            <button className=\"btn\" onClick={() => saveHighlightToAccount()}>Save to account</button>\r\n                            <button className=\"btn btn-ghost ml-auto\" onClick={() => { setShowHighlightModal(false); setHighlightCandidate(null); }}>Close</button>\r\n                          </div>\r\n                          <div className=\"text-xs opacity-70 mt-3\">You can download this JSON to keep a copy, or save it to your account for later access.</div>\r\n                        </div>\r\n                      </ResizableModal>\r\n                    ) : null}\r\n                    <div className=\"flex items-center gap-1.5 mb-2\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn px-2 py-0.5 text-xs\" onClick={() => submitVisitManual(visitScore)}>Submit Visit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-1.5 mt-1.5 text-xs\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                    <div className=\"mt-2 flex items-center gap-1.5 mb-2\">\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                    </div>\r\n                  </>\r\n                ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring) => {\r\n                          if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                            addDpValue(value)\r\n                          }\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addDpManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Around the Clock' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Around the Clock ÔÇö Hit 1ÔåÆ20 then 25 (outer) and 50 (inner)</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Current target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{ATC_ORDER[atcIndex] === 25 ? '25 (Outer Bull)' : ATC_ORDER[atcIndex] === 50 ? '50 (Inner Bull)' : (ATC_ORDER[atcIndex] || 'ÔÇö')}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{atcHits} / {ATC_ORDER.length}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        scoringMode=\"custom\"\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring, info) => {\r\n                          addAtcValue(value, ring, info?.sector ?? null)\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addAtcNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (T20, D5, 25, 50)\" value={atcManual} onChange={e=>setAtcManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addAtcManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addAtcManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Treble Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Treble Practice — Aim for triples only; count hits vs total darts</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Treble target</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">T{trebleTarget}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-extrabold mb-2\">{trebleHits} / {trebleMaxDarts>0?trebleMaxDarts:trebleDarts}</div>\r\n                    {(trebleMaxDarts>0 && trebleDarts >= trebleMaxDarts) && (\r\n                      <div className=\"mt-1 text-xs px-2 py-1 rounded bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 inline-block\">Completed! <button className=\"ml-2 underline\" onClick={resetTreble}>Reset</button></div>\r\n                    )}\r\n                    <div className=\"flex items-center gap-1.5 mb-2\">\r\n                      <span className=\"opacity-70 text-xs\">Quick:</span>\r\n                      {[20,19,18].map(n => (\r\n                        <button key={`tquick-${n}`} className={`btn px-2 py-0.5 text-xs ${trebleTarget===n?'bg-emerald-600/30 border border-emerald-400/30':''}`} onClick={()=>setTrebleTarget(n)}>T{n}</button>\r\n                      ))}\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <select className=\"input w-24 text-sm\" value={trebleTarget} onChange={e=> setTrebleTarget(parseInt(e.target.value,10))}>\r\n                        {Array.from({length:20},(_,i)=>i+1).map(n=> <option key={n} value={n}>{n}</option>)}\r\n                      </select>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={resetTreble}>Reset</button>\r\n                    </div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView\r\n                        scoringMode=\"custom\"\r\n                        showToolbar={false}\r\n                        immediateAutoCommit\r\n                        onAutoDart={(value, ring, info) => {\r\n                          const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL')\r\n                          addTrebleValue(value, r, info?.sector ?? null)\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addTrebleNumeric() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addTrebleNumeric}>Add Dart</button>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 mt-1.5\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Manual (T20)\" value={trebleManual} onChange={e=>setTrebleManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addTrebleManual() }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={addTrebleManual}>Add</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                    {(() => {\r\n                      const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState()\r\n                      return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )\r\n                    })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        {\r\n                          const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL')\r\n                          applyCricketAuto(value, r, info?.sector ?? null)\r\n                        }\r\n                      }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Shanghai ÔÇö Hit only the round's number; Single/Double/Triple score</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">Halve It ÔÇö Hit the target each round or your score halves</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                          <span>Stage</span>\r\n                          <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.stage+1}/{st.targets.length}</span>\r\n                        </div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                      <>\r\n                        <div className=\"text-xs mb-1.5\">High-Low ÔÇö Alternate aiming for high then low segments</div>\r\n                        <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Round</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st.round}</span></div>\r\n                        <div className=\"text-sm\">Target: <span className=\"font-semibold\">{st.target}</span></div>\r\n                        <div className=\"text-2xl font-extrabold mb-2\">Score: {st.score}</div>\r\n                      </>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'American Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">American Cricket ÔÇö Close 12-20 and Bull; overflow scores</div>\r\n                    {(() => { const pid = currentPlayerId(); ensureAmCricket(pid); const st = amCricketById[pid] || createAmCricketState(); return (\r\n                      <div className=\"mb-2 grid grid-cols-5 gap-1 text-center text-[11px]\">\r\n                        {AM_CRICKET_NUMBERS.map(n => (\r\n                          <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                            <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                            <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    ) })()}\r\n                    <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(amCricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyAmCricketAuto(value, r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyAmCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Baseball' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureBaseball(pid); const st = baseballById[pid] || createBaseball(); return (\r\n                      <div className=\"text-xs mb-1.5\">Baseball ÔÇö Inning {st.inning} ÔÇó Runs {st.score}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyBaseballAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyBaseballAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Golf' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    {(() => { const pid = currentPlayerId(); ensureGolf(pid); const st = golfById[pid] || createGolf(); return (\r\n                      <div className=\"text-xs mb-1.5\">Golf ÔÇö Hole {st.hole} (target {GOLF_TARGETS[st.hole]}) ÔÇó Strokes {st.strokes}</div>\r\n                    ) })()}\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring==='MISS'?undefined:(ring as any); applyGolfAuto(value, r as any, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => { applyGolfAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Tic Tac Toe' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Tic Tac Toe ÔÇö Tap a cell to claim by hitting its target</div>\r\n                    <div className=\"grid grid-cols-3 gap-1 mb-2\">\r\n                      {Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).map(cell => (\r\n                        <button key={cell} className={`h-12 rounded-xl border ${ttt.board[cell]?'bg-emerald-500/20 border-emerald-400/30':'bg-slate-800/50 border-slate-700/50'}`} onClick={()=>{\r\n                          if (ttt.finished || ttt.board[cell]) return\r\n                          // Use the manual input value instead of prompt\r\n                          const tgt = TTT_TARGETS[cell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(cell, v, ring as any, sector as any)\r\n                          setTttManual('') // Clear input after use\r\n                        }}>{ttt.board[cell] || ''}</button>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input className=\"input w-40 text-sm\" placeholder=\"Enter dart score (e.g. 20, 40, 60, 25, 50)\" value={tttManual} onChange={e=>setTttManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        // Apply to first available cell\r\n                        const availableCell = Array.from({length:9},(_,i)=>i as 0|1|2|3|4|5|6|7|8).find(cell => !ttt.board[cell] && !ttt.finished)\r\n                        if (availableCell !== undefined) {\r\n                          const tgt = TTT_TARGETS[availableCell]\r\n                          const v = Number(tttManual||0)\r\n                          const ring = (v%3===0)?'TRIPLE': (v%2===0?'DOUBLE':'SINGLE')\r\n                          const sector = tgt.type==='BULL'?null:(tgt.num||null)\r\n                          applyTttAuto(availableCell, v, ring as any, sector as any)\r\n                          setTttManual('')\r\n                        }\r\n                      }}>Claim Cell</button>\r\n                    </div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => {\r\n                        // passive; primary interaction via tapping a cell above\r\n                      }} />\r\n                    </div>\r\n                  </div>\r\n                ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                    <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                      <span>Your number</span>\r\n                      <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); return killerById[pid]?.number || 'ÔÇö' })()}</span>\r\n                    </div>\r\n                    <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{(() => { const pid = currentPlayerId(); return killerById[pid]?.lives ?? 'ÔÇö' })()}</span> {(() => { const pid = currentPlayerId(); return killerById[pid]?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null })()}</div>\r\n                    <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                      <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter'){ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) } }} />\r\n                      <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                  <div className=\"p-3 rounded-xl bg-black/20\">\r\n                    <div className=\"text-xs mb-1.5\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <input className=\"input w-24 text-sm\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                      <button className=\"btn\" onClick={() => {\r\n                        const v = Math.max(0, visitScore|0)\r\n                        match.addVisit(v, 3)\r\n                        setVisitScore(0)\r\n                        match.nextPlayer()\r\n                        sendState()\r\n                      }}>Submit</button>\r\n                      <button className=\"btn px-2 py-0.5 text-xs bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                )}\r\n                <div className=\"mt-2 flex items-center gap-1.5\">\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                  <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                {/* Left column: summary */}\r\n                <div className=\"space-y-1.5\">\r\n                  <RenderMatchSummary />\r\n                </div>\r\n                {/* Main area: toolbar + camera + controls */}\r\n                <div className={`md:col-span-${cameraColSpan} space-y-1.5 relative`}>\r\n                  {/* Toolbar row (separate) */}\r\n                  <div className=\"flex items-center gap-1.5 mt-2\">\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-autoscore' as any)) }catch{} }}>Autoscore</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={()=>{ try{ window.dispatchEvent(new Event('ndn:open-scoring' as any)) }catch{} }}>Scoring</button>\r\n                    <button className={`btn ${buttonSizeClass}`} onClick={openManual}>Manual Correction</button>\r\n                    <div className=\"ml-auto flex items-center gap-1\">\r\n                      <span className=\"text-xs opacity-70\">Cam</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.max(0.5, Math.round((cameraScale-0.05)*100)/100))}>−</button>\r\n                      <span className={`btn ${buttonSizeClass} bg-transparent border-slate-600 text-center min-w-[3rem]`}>{Math.round(cameraScale*100)}%</span>\r\n                      <button className={`btn ${buttonSizeClass}`} onClick={()=>setCameraScale(Math.min(1.25, Math.round((cameraScale+0.05)*100)/100))}>+</button>\r\n                      <button \r\n                        className={`btn ${buttonSizeClass}`} \r\n                        onClick={() => setCameraColSpan(cameraColSpan === 2 ? 3 : 2)}\r\n                        title={cameraColSpan === 2 ? \"Expand camera\" : \"Shrink camera\"}\r\n                      >\r\n                        {cameraColSpan === 2 ? '↔' : '↙'}\r\n                      </button>\r\n                      <span className=\"opacity-50\">|</span>\r\n                      <button className={`btn ${buttonSizeClass}`} title=\"Toggle fit/fill\" onClick={()=>setCameraFitMode(cameraFitMode==='fill'?'fit':'fill')}>{cameraFitMode==='fill'?'Fill':'Fit'}</button>\r\n                    </div>\r\n                  </div>\r\n                  {/* Camera row (under toolbar, left side) */}\r\n                  <div className=\"mt-2 relative flex-1 min-h-0 ndn-camera-tall\">\r\n                    <ResizablePanel\r\n                      storageKey=\"ndn:camera:tile:online:row\"\r\n                      className=\"relative rounded-2xl overflow-hidden bg-black w-full\"\r\n                      defaultWidth={720}\r\n                      defaultHeight={400}\r\n                      minWidth={320}\r\n                      minHeight={220}\r\n                      maxWidth={1600}\r\n                      maxHeight={900}\r\n                      autoFill\r\n                    >\r\n                      <CameraTile \r\n                        label=\"Your Board\" \r\n                        autoStart={user?.username && match.players[match.currentPlayerIdx]?.name === user.username} \r\n                        aspect=\"classic\"\r\n                        fill\r\n                      />\r\n                    </ResizablePanel>\r\n                    {/* Resize handle */}\r\n                    {cameraColSpan < 3 && (\r\n                      <div \r\n                        className=\"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-slate-600/20 hover:bg-slate-600/40 transition-colors flex items-center justify-center group\"\r\n                        onMouseDown={(e) => {\r\n                          e.preventDefault()\r\n                          const startX = e.clientX\r\n                          const startSpan = cameraColSpan\r\n                          \r\n                          const handleMouseMove = (moveEvent: MouseEvent) => {\r\n                            const deltaX = moveEvent.clientX - startX\r\n                            // If dragged more than 50px to the right, expand to 3 columns\r\n                            if (deltaX > 50 && startSpan === 2) {\r\n                              setCameraColSpan(3)\r\n                            }\r\n                          }\r\n                          \r\n                          const handleMouseUp = () => {\r\n                            document.removeEventListener('mousemove', handleMouseMove)\r\n                            document.removeEventListener('mouseup', handleMouseUp)\r\n                          }\r\n                          \r\n                          document.addEventListener('mousemove', handleMouseMove)\r\n                          document.addEventListener('mouseup', handleMouseUp)\r\n                        }}\r\n                      >\r\n                        <div className=\"w-0.5 h-8 bg-slate-400 group-hover:bg-slate-300 transition-colors\"></div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"font-semibold text-sm md:text-base\">Current: {match.players[match.currentPlayerIdx]?.name || 'ÔÇö'}</div>\r\n                  {currentGame === 'X01' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username ? (\r\n                    <>\r\n                      <CameraView x01DoubleInOverride={x01DoubleInMatch} hideInlinePanels showToolbar={false} onVisitCommitted={(score, darts, finished) => {\r\n                        if (callerEnabled) {\r\n                          const p = match.players[match.currentPlayerIdx]\r\n                          const leg = p?.legs[p.legs.length-1]\r\n                          const remaining = leg ? leg.totalScoreRemaining : match.startingScore\r\n                          sayScore(user?.username || 'Player', score, Math.max(0, remaining), callerVoice, { volume: callerVolume, checkoutOnly: speakCheckoutOnly })\r\n                        }\r\n                        const current = match.players[match.currentPlayerIdx]\r\n                        if (user?.username && current?.name === user.username) {\r\n                          addSample(user.username, darts, score)\r\n                        }\r\n                        // Instant local celebration\r\n                        try { if (score === 180) triggerCelebration('180', current?.name || 'Player'); if (finished) triggerCelebration('leg', current?.name || 'Player') } catch {}\r\n                        // Small delay before rotating to next player to avoid dropping late autoscore events\r\n                        if (!finished) {\r\n                          const hasOpponent = (participants?.length || 0) >= 2\r\n                          if (hasOpponent) {\r\n                            setTimeout(() => { try { match.nextPlayer(); sendState() } catch {} }, 750)\r\n                          } else {\r\n                            // Solo: keep turn with current player\r\n                            sendState()\r\n                          }\r\n                        } else {\r\n                          sendState()\r\n                        }\r\n                      }} />\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => submitVisitManual(visitScore)}>Submit Visit (Manual)</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                      {/* Quick entry buttons */}\r\n                      <div className=\"flex flex-wrap items-center gap-2 mt-2 text-sm\">\r\n                        <span className=\"opacity-70\">Quick:</span>\r\n                        {[180,140,100,60].map(v => (\r\n                          <button key={v} className=\"btn px-3 py-1 text-sm\" onClick={()=>submitVisitManual(v)}>{v}</button>\r\n                        ))}\r\n                      </div>\r\n                      {/* Checkout suggestions (full view) */}\r\n                      {(() => {\r\n                        const p = match.players[match.currentPlayerIdx]\r\n                        const leg = p?.legs?.[p.legs?.length-1]\r\n                        const rem = leg ? leg.totalScoreRemaining : match.startingScore\r\n                        return (rem > 0 && rem <= 170) ? (\r\n                          <div className=\"mt-2 p-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-900 text-sm\">\r\n                            Checkout suggestions (fav {favoriteDouble}): {suggestCheckouts(rem, favoriteDouble).join('  ÔÇó  ') || 'ÔÇö'}\r\n                          </div>\r\n                        ) : null\r\n                      })()}\r\n                    </>\r\n                  ) : (currentGame === 'Double Practice' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Double Practice ÔÇö Hit doubles D1ÔåÆD20ÔåÆDBULL</div>\r\n                      <div className=\"mb-1 text-sm flex items-center justify-between\">\r\n                        <span>Current target</span>\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{DOUBLE_PRACTICE_ORDER[dpIndex]?.label || 'ÔÇö'}</span>\r\n                      </div>\r\n                      <div className=\"text-2xl font-extrabold mb-2\">{dpHits} / {DOUBLE_PRACTICE_ORDER.length}</div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView\r\n                          scoringMode=\"custom\"\r\n                          showToolbar={false}\r\n                          immediateAutoCommit\r\n                          onAutoDart={(value, ring) => {\r\n                            if (ring === 'DOUBLE' || ring === 'INNER_BULL') {\r\n                              addDpValue(value)\r\n                            }\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} onKeyDown={e=>{ if(e.key==='Enter') addDpNumeric() }} />\r\n                        <button className=\"btn\" onClick={addDpNumeric}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 mt-1.5\">\r\n                        <input className=\"input w-44\" placeholder=\"Manual (D16, 50, 25, T20)\" value={dpManual} onChange={e=>setDpManual(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') addDpManual() }} />\r\n                        <button className=\"btn\" onClick={addDpManual}>Add</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Cricket' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">Cricket ÔÇö Close 15-20 and Bull; overflow scores points</div>\r\n                      {(() => { const pid = currentPlayerId(); ensureCricket(pid); const st = cricketById[pid] || createCricketState(); return (\r\n                        <div className=\"mb-2 grid grid-cols-7 gap-1 text-center text-[11px]\">\r\n                          {CRICKET_NUMBERS.map(n => (\r\n                            <div key={n} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50\">\r\n                              <div className=\"opacity-70\">{n===25?'Bull':n}</div>\r\n                              <div className=\"font-semibold\">{Math.min(3, st.marks?.[n]||0)} / 3</div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) })()}\r\n                      <div className=\"text-sm mb-2\">Points: <span className=\"font-semibold\">{(cricketById[currentPlayerId()]?.points||0)}</span></div>\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyCricketAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyCricketAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Shanghai' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureShanghai(pid); const st = shanghaiById[pid] || createShanghaiState(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Shanghai ÔÇö Round {st.round} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyShanghaiAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyShanghaiAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Halve It' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHalve(pid); const st = halveById[pid] || createDefaultHalveIt(); const t = getCurrentHalveTarget(st); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">Halve It ÔÇö Stage {st.stage+1}/{st.targets.length} ÔÇó Score {st.score}</div>\r\n                          <div className=\"text-sm\">Target: <span className=\"font-semibold\">{(() => { const tt = t; if (!tt) return 'ÔÇö'; if (tt.kind==='ANY_NUMBER') return 'Any'; if (tt.kind==='BULL') return 'Bull'; if (tt.kind==='DOUBLE' || tt.kind==='TRIPLE' || tt.kind==='NUMBER') return `${tt.kind} ${(tt as any).num}`; return 'ÔÇö' })()}</span></div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHalveAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHalveAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'High-Low' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); ensureHighLow(pid); const st = highlowById[pid] || createHighLow(); return (\r\n                        <>\r\n                          <div className=\"text-sm mb-2\">High-Low ÔÇö Round {st.round} ÔÇó Target {st.target} ÔÇó Score {st.score}</div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 mb-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyHighLowAuto(value, r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyHighLowAuto(Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (currentGame === 'Killer' && user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      {(() => { const pid = currentPlayerId(); match.players.forEach(p=>ensureKiller(p.id)); const st = killerById[pid]; return (\r\n                        <>\r\n                          <div className=\"text-xs mb-1.5\">Killer ÔÇö Hit your own double to become Killer; then remove othersÔÇÖ lives by hitting their doubles/triples.</div>\r\n                          <div className=\"mb-1 text-sm flex items-center justify-between\"><span>Your number</span><span className=\"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30 text-xs font-semibold\">{st?.number || 'ÔÇö'}</span></div>\r\n                          <div className=\"text-sm\">Lives: <span className=\"font-semibold\">{st?.lives ?? 'ÔÇö'}</span> {st?.isKiller ? <span className=\"ml-2 text-emerald-300\">KILLER</span> : null}</div>\r\n                          <div className=\"mt-2 grid grid-cols-2 md:grid-cols-3 gap-1 text-[11px]\">\r\n                            {match.players.map(pp => {\r\n                              const s = killerById[pp.id]\r\n                              return (\r\n                                <div key={pp.id} className=\"p-1 rounded bg-slate-800/50 border border-slate-700/50 flex items-center justify-between\">\r\n                                  <span className=\"opacity-80 truncate\">{pp.name}</span>\r\n                                  <span className=\"font-mono\">{s ? `#${s.number} = ${s.lives}ÔØñ${s.isKiller?' = K':''}` : 'ÔÇö'}</span>\r\n                                </div>\r\n                              )\r\n                            })}\r\n                          </div>\r\n                        </>\r\n                      ) })()}\r\n                      <div className=\"rounded-2xl overflow-hidden bg-black/60 border border-white/10 my-2\">\r\n                        <CameraView scoringMode=\"custom\" showToolbar={false} immediateAutoCommit onAutoDart={(value, ring, info) => { const r = ring === 'MISS' ? undefined : (ring as 'SINGLE'|'DOUBLE'|'TRIPLE'|'BULL'|'INNER_BULL'); applyKillerAuto(r, info?.sector ?? null) }} />\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => { applyKillerAuto('SINGLE', Math.max(0, visitScore|0)); setVisitScore(0) }}>Add Dart</button>\r\n                      </div>\r\n                      <div className=\"text-xs opacity-70\">Tip: Only doubles/triples on the opponentsÔÇÖ numbers remove lives. To become Killer, hit your own double.</div>\r\n                    </div>\r\n                  ) : (user?.username && match.players[match.currentPlayerIdx]?.name === user.username) ? (\r\n                    <div className=\"p-3 rounded-xl bg-black/20\">\r\n                      <div className=\"text-sm mb-2\">{currentGame} (online) ÔÇö manual turn entry</div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input className=\"input w-28\" type=\"number\" min={0} value={visitScore} onChange={e => setVisitScore(parseInt(e.target.value||'0'))} />\r\n                        <button className=\"btn\" onClick={() => {\r\n                          const v = Math.max(0, visitScore|0)\r\n                          match.addVisit(v, 3)\r\n                          setVisitScore(0)\r\n                          match.nextPlayer()\r\n                          sendState()\r\n                        }}>Submit</button>\r\n                        <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={() => { match.undoVisit(); sendState(); }}>Undo</button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"p-4 rounded-xl bg-slate-800/30 border border-slate-700/40 text-center text-slate-300 font-semibold\">WAITING TO THROW</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"md:col-span-1\">\r\n                  <div className=\"flex flex-wrap items-center gap-1.5\">\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowQuick(true)}>Quick Chat</button>\r\n                    <button className=\"btn px-2 py-0.5 text-xs\" onClick={()=>setShowMessages(true)}>Messages</button>\r\n                  </div>\r\n                </div>\r\n                </div>\r\n              )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Create Match modal */}\r\n      {showCreate && (\r\n        <div className=\"fixed inset-0 bg-black/70 z-50\">\r\n          <div className=\"w-full h-full flex items-stretch justify-stretch p-0\">\r\n            <ResizableModal storageKey=\"ndn:modal:create-match\" className=\"w-full h-full rounded-none !border-0 !shadow-none relative\" fullScreen>\r\n              <div className=\"flex items-center justify-between mb-3 sticky top-0 bg-slate-900/80 backdrop-blur border-b border-slate-700 z-10 px-2 py-2\">\r\n                <h3 className=\"text-xl font-bold\">Create Match</h3>\r\n              </div>\r\n              <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 overflow-auto px-2\" style={{ maxHeight: 'calc(100vh - 120px)' }}>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Game</label>\r\n                <select className=\"input w-full\" value={game} onChange={e=>setGame(e.target.value as any)}>\r\n                  {allGames.map(g => (\r\n                    <option key={g} value={g} disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(g)}>\r\n                      {g} {!user?.fullAccess && (premiumGames as readonly string[]).includes(g) ? '(PREMIUM)' : ''}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                {/* Calibration Status - displayed below game selector */}\r\n                <div className=\"mt-2\">\r\n                  <GameCalibrationStatus \r\n                    gameMode={game} \r\n                    compact={true}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Mode</label>\r\n                <select className=\"input w-full\" value={mode} onChange={e=>setMode(e.target.value as any)}>\r\n                  <option value=\"bestof\">Best Of</option>\r\n                  <option value=\"firstto\">First To</option>\r\n                </select>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Value</label>\r\n                {game === 'X01' ? (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {[101, 201, 301, 401, 501].map(val => (\r\n                        <button\r\n                          key={val}\r\n                          className={`btn px-2 py-1 text-xs ${modeValue === val ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                          onClick={() => setModeValue(val)}\r\n                        >\r\n                          {val}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                    <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} placeholder=\"Or enter custom value\" />\r\n                  </div>\r\n                ) : (\r\n                  <input className=\"input w-full\" type=\"number\" min={1} value={modeValue} onChange={e=>setModeValue(parseInt(e.target.value||'1'))} />\r\n                )}\r\n                <div className=\"text-xs opacity-70 mt-1\">Example: Best Of 5 — first to 3</div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Starting Score</label>\r\n                {game === 'X01' ? (\r\n                  <select className=\"input w-full\" value={startScore} onChange={e=>setStartScore(parseInt(e.target.value||'501'))}>\r\n                    {[301, 501, 701].map(s => <option key={s} value={s}>{s}</option>)}\r\n                  </select>\r\n                ) : (\r\n                  <div className=\"text-xs opacity-70 mt-1\">Starting score applies to X01 only</div>\r\n                )}\r\n              </div>\r\n              {game === 'X01' && (\r\n                <div className=\"col-span-1\">\r\n                  <label className=\"block text-sm text-slate-300 mb-1\">X01 Rules</label>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      id=\"create-x01di\"\r\n                      type=\"checkbox\"\r\n                      className=\"accent-purple-500\"\r\n                      checked={!!createX01DoubleIn}\r\n                      onChange={e=> setCreateX01DoubleIn(e.target.checked)}\r\n                    />\r\n                    <label htmlFor=\"create-x01di\" className=\"text-sm opacity-80\">Require Double-In</label>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {game === 'Treble Practice' && (\r\n                <div className=\"col-span-1\">\r\n                  <label className=\"block text-sm text-slate-300 mb-1\">Throws per game</label>\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {[9, 12, 18, 30, 60].map(val => (\r\n                        <button\r\n                          key={val}\r\n                          className={`btn px-2 py-1 text-xs ${createTrebleMaxDarts === val ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                          onClick={() => setCreateTrebleMaxDarts(val)}\r\n                        >\r\n                          {val}\r\n                        </button>\r\n                      ))}\r\n                      <button\r\n                        className={`btn px-2 py-1 text-xs ${createTrebleMaxDarts === 0 ? 'bg-purple-600 hover:bg-purple-700' : ''}`}\r\n                        onClick={() => setCreateTrebleMaxDarts(0)}\r\n                        title=\"Unlimited\"\r\n                      >\r\n                        ∞\r\n                      </button>\r\n                    </div>\r\n                    <input\r\n                      className=\"input w-full\"\r\n                      type=\"number\"\r\n                      min={0}\r\n                      placeholder=\"0 = unlimited\"\r\n                      value={createTrebleMaxDarts}\r\n                      onChange={e=> setCreateTrebleMaxDarts(Math.max(0, parseInt(e.target.value||'0')))}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <div className=\"col-span-1\">\r\n                <label className=\"block text-sm text-slate-300 mb-1\">Require Calibration</label>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input id=\"calibreq\" type=\"checkbox\" className=\"accent-purple-500\" checked={requireCalibration} onChange={e=>setRequireCalibration(e.target.checked)} />\r\n                  <label htmlFor=\"calibreq\" className=\"text-sm opacity-80\">Players must be calibrated</label>\r\n                </div>\r\n              </div>\r\n              <div className=\"col-span-1\">\r\n                <div className=\"p-3 rounded-lg bg-black/20 border border-slate-700/40\">\r\n                  <div className=\"text-xs text-slate-300 uppercase tracking-wide mb-1\">Summary</div>\r\n                  <div className=\"text-sm font-semibold\">{game} — {mode==='bestof' ? `Best Of ${modeValue}` : `First To ${modeValue}`} {game==='X01' ? `— ${startScore}` : ''}</div>\r\n                  {game==='X01' && (\r\n                    <div className=\"text-xs opacity-80 mt-1\">Double-In: {createX01DoubleIn ? 'On' : 'Off'}</div>\r\n                  )}\r\n                  {game==='Treble Practice' && (\r\n                    <div className=\"text-xs opacity-80 mt-1\">Throws per game: {createTrebleMaxDarts || 'Unlimited'}</div>\r\n                  )}\r\n                  {!user?.fullAccess && (premiumGames as readonly string[]).includes(game) && (\r\n                    <div className=\"text-xs text-rose-300 mt-1\">PREMIUM required</div>\r\n                  )}\r\n                </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"sticky bottom-0 bg-slate-900/80 backdrop-blur border-t border-slate-700 z-10 px-2 py-2\">\r\n                <button className=\"btn w-full\" disabled={!user?.fullAccess && (premiumGames as readonly string[]).includes(game)} title={!user?.fullAccess && (premiumGames as readonly string[]).includes(game) ? 'PREMIUM game' : ''} onClick={()=>{\r\n                  const creatorAvg = user?.username ? getAllTimeAvg(user.username) : 0\r\n                  // If Treble Practice, apply the configured max darts locally and include in payload\r\n                  if (game === 'Treble Practice') {\r\n                    setTrebleMaxDarts(Math.max(0, createTrebleMaxDarts|0))\r\n                  }\r\n                  // If X01, apply the Double-In per-match rule locally and include in payload\r\n                  if (game === 'X01') {\r\n                    setX01DoubleInMatch(!!createX01DoubleIn)\r\n                  }\r\n                  const payload: any = { type: 'create-match', game, mode, value: modeValue, startingScore: startScore, creatorAvg, requireCalibration }\r\n                  if (game === 'Treble Practice') {\r\n                    payload.trebleMaxDarts = Math.max(0, createTrebleMaxDarts|0)\r\n                  }\r\n                  if (game === 'X01') {\r\n                    payload.x01DoubleIn = !!createX01DoubleIn\r\n                  }\r\n                  if (wsGlobal) {\r\n                    wsGlobal.send(payload)\r\n                    setShowCreate(false)\r\n                    wsGlobal.send({ type: 'list-matches' })\r\n                  } else {\r\n                    wsRef.current?.send(JSON.stringify(payload))\r\n                    setShowCreate(false)\r\n                    wsRef.current?.send(JSON.stringify({ type: 'list-matches' }))\r\n                  }\r\n                }}>START GAME!</button>\r\n                <div className=\"flex justify-center mt-2\">\r\n                  <button className=\"btn px-2 py-1\" onClick={()=>setShowCreate(false)}>Close</button>\r\n                </div>\r\n              </div>\r\n            </ResizableModal>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Invitation modal for creator */}\r\n      {pendingInvite && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <ResizableModal storageKey=\"ndn:modal:invite\" className=\"w-full relative\" defaultWidth={620} defaultHeight={420} minWidth={520} minHeight={320} maxWidth={1000} maxHeight={800} initialFitHeight>\r\n            <h3 className=\"text-xl font-bold mb-1\">Incoming Match Request</h3>\r\n            <div className=\"text-sm mb-2\">\r\n              <span className=\"font-semibold\">{pendingInvite.fromName}</span> wants to join your match.\r\n              <span className={`ml-2 text-xs px-2 py-0.5 rounded ${pendingInvite.calibrated ? 'bg-emerald-500/20 text-emerald-300 border border-emerald-600/30' : 'bg-amber-500/20 text-amber-200 border border-amber-600/30'}`}>\r\n                {pendingInvite.calibrated ? 'Calibrated' : 'Not calibrated'}\r\n              </span>\r\n            </div>\r\n            {(pendingInvite.game || pendingInvite.mode) && (\r\n              <div className=\"text-xs opacity-80 mb-3\">\r\n                {pendingInvite.game || 'X01'} ÔÇó {pendingInvite.mode==='firstto' ? `First To ${pendingInvite.value}` : `Best Of ${pendingInvite.value}`} {pendingInvite.game==='X01' && pendingInvite.startingScore ? `ÔÇó ${pendingInvite.startingScore}` : ''}\r\n              </div>\r\n            )}\r\n            {/* End-of-match modal for Online/Tournament */}\r\n            {showX01EndSummary && (\r\n              <MatchSummaryModal\r\n                open={showX01EndSummary}\r\n                onClose={() => setShowX01EndSummary(false)}\r\n                title=\"Match Summary\"\r\n                players={match.players || []}\r\n                doublesStats={doublesStats}\r\n                centerScore={(() => {\r\n                  const ps = match.players || []\r\n                  return ps.length===2 ? `${ps[0]?.legsWon||0} – ${ps[1]?.legsWon||0}` : ''\r\n                })()}\r\n              />\r\n            )}\r\n            {pendingInvite.boardPreview ? (\r\n              <div className=\"mb-3\">\r\n                <img src={pendingInvite.boardPreview} alt=\"Board preview\" className=\"rounded-lg w-full max-h-64 object-contain bg-black/40 border border-slate-700\" />\r\n              </div>\r\n            ) : (\r\n              <div className=\"mb-3 text-xs opacity-60\">No camera preview provided.</div>\r\n            )}\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"btn bg-emerald-600 hover:bg-emerald-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: true, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Accept</button>\r\n              <button className=\"btn bg-rose-600 hover:bg-rose-700\" onClick={()=>{\r\n                if (wsGlobal) wsGlobal.send({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId })\r\n                else wsRef.current?.send(JSON.stringify({ type: 'invite-response', matchId: pendingInvite.matchId, accept: false, toId: pendingInvite.fromId }))\r\n                setPendingInvite(null)\r\n              }}>Decline</button>\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Quick Chat popup */}\r\n      {showQuick && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:quick-chat\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={520}\r\n            defaultHeight={280}\r\n            minWidth={360}\r\n            minHeight={220}\r\n            maxWidth={900}\r\n            maxHeight={700}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Quick Chat</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowQuick(false)}>Close</button>\r\n            </div>\r\n            <div className=\"flex flex-wrap gap-1.5\">\r\n              {['Good luck!','Good game!','Nice darts!','Well played!','Ready?'].map((m) => (\r\n                <button key={m} className=\"btn px-2 py-0.5 text-xs\" onClick={()=>{ sendQuick(m); setShowQuick(false) }} disabled={!connected}>{m}</button>\r\n              ))}\r\n            </div>\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n\r\n      {/* Messages popup */}\r\n      {showMessages && (\r\n        <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center\">\r\n          <ResizableModal\r\n            storageKey=\"ndn:modal:messages\"\r\n            className=\"w-full relative\"\r\n            defaultWidth={560}\r\n            defaultHeight={360}\r\n            minWidth={380}\r\n            minHeight={260}\r\n            maxWidth={1000}\r\n            maxHeight={800}\r\n          >\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold\">Messages</h3>\r\n              <button className=\"btn px-2 py-1 text-sm\" onClick={()=>setShowMessages(false)}>Close</button>\r\n            </div>\r\n            <ChatList\r\n              items={chat\r\n                .slice(-30)\r\n                .filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                .map((m, i) => ({ key: String(i), from: m.from, id: String(m.fromId || m.from), text: m.message }))}\r\n              onDelete={(idx) => setChat(prev => prev.filter((_, i) => i !== idx))}\r\n              onReport={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                reportMessage(null, item.message)\r\n              }}\r\n              onBlock={(idx) => {\r\n                const pool = chat.slice(-30).filter((m) => !blocklist.isBlocked(String(m.fromId || '')))\r\n                const item = pool[idx]\r\n                if (!item) return\r\n                try { blocklist.block(String(item.fromId || item.from)) } catch {}\r\n                setChat(prev => prev.filter(m => String(m.fromId || m.from) !== String(item.fromId || item.from)))\r\n                try { toast(`${item.from} blocked`, { type: 'info' }) } catch {}\r\n              }}\r\n            />\r\n          </ResizableModal>\r\n        </div>\r\n      )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Small, self-contained chat list with moderation affordances\r\nfunction ChatList({ items, onDelete, onReport, onBlock }: { items: { key: string; from: string; id?: string; text: string }[]; onDelete: (index: number) => void; onReport: (index: number) => void; onBlock?: (index: number) => void }) {\r\n  const mobile = (() => { try { const ua = navigator.userAgent || ''; return /Android|iPhone|iPad|iPod|Mobile/i.test(ua) } catch { return false } })()\r\n  const [touch, setTouch] = useState<{ x: number; y: number; i: number; t: number } | null>(null)\r\n  const [swiped, setSwiped] = useState<number | null>(null)\r\n  return (\r\n    <div className=\"h-24 overflow-auto text-sm divide-y divide-slate-700/40\">\r\n      {items.length === 0 ? (\r\n        <div className=\"opacity-60 py-1\">No messages yet.</div>\r\n      ) : items.map((m, i) => {\r\n        const text = censorProfanity(m.text)\r\n        const flagged = containsProfanity(m.text)\r\n        return (\r\n          <div\r\n            key={m.key}\r\n            className=\"relative group px-1 py-1 flex items-start gap-2\"\r\n            onTouchStart={mobile ? (e) => { const t = e.touches[0]; setTouch({ x: t.clientX, y: t.clientY, i, t: Date.now() }) } : undefined}\r\n            onTouchMove={mobile ? (e) => { if (!touch || touch.i !== i) return; const t = e.touches[0]; const dx = t.clientX - touch.x; if (dx < -40) setSwiped(i) } : undefined}\r\n            onTouchEnd={mobile ? () => { const held = touch ? (Date.now() - touch.t) : 0; if (swiped === i || held > 600) { onDelete(i); setSwiped(null) } setTouch(null) } : undefined}\r\n          >\r\n            <span className=\"text-slate-400 shrink-0\">[{m.from}]</span>\r\n            <span className=\"text-white break-words whitespace-pre-wrap flex-1\">{text}</span>\r\n            {/* Desktop delete (red X) and Report/Block */}\r\n            {!mobile && (\r\n              <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 ml-2\">\r\n                <button\r\n                  className=\"w-5 h-5 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center\"\r\n                  title=\"Delete message\"\r\n                  aria-label=\"Delete message\"\r\n                  onClick={() => onDelete(i)}\r\n                >├ù</button>\r\n                {onBlock && (\r\n                  <button\r\n                    className=\"px-1.5 py-0.5 rounded bg-slate-700 hover:bg-slate-800 text-slate-100 text-[11px]\"\r\n                    onClick={() => onBlock(i)}\r\n                    title=\"Block sender\"\r\n                  >Block</button>\r\n                )}\r\n                <button\r\n                  className=\"px-1.5 py-0.5 rounded bg-amber-600/40 hover:bg-amber-600/60 text-amber-100 text-[11px]\"\r\n                  onClick={() => onReport(i)}\r\n                  title=\"Report message\"\r\n                >Report</button>\r\n              </div>\r\n            )}\r\n            {/* Flag badge if profanity detected */}\r\n            {flagged && <span className=\"ml-2 text-[10px] px-1 rounded bg-rose-600/30 text-rose-200 border border-rose-600/40\">Filtered</span>}\r\n          </div>\r\n        )\r\n      })}\r\n      \r\n      {/* Phone camera overlay moved to global App header for consistency */}\r\n    </div>\r\n  )\r\n}\r\n","import { useMatch } from '../store/match'\r\nimport { formatAvg } from '../utils/stats'\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport BarChart from './BarChart'\r\nimport { getGameModeStats, getMonthlyAvg3, getMonthlyFirstNineAvg, getAllTimeAvg, getAllTimeFirstNineAvg, getAllTime } from '../store/profileStats'\r\nimport { allGames } from '../utils/games'\r\nimport TabPills from './ui/TabPills'\r\n\r\nexport default function StatsPanel({ user }: { user?: any }) {\r\n  const { players, inProgress, startingScore, newMatch } = useMatch()\r\n  const [family, setFamily] = useState<'x01' | 'other'>('x01')\r\n  const [playersText, setPlayersText] = useState('Player 1, Player 2')\r\n  const [start, setStart] = useState(501)\r\n  const [selectedGameMode, setSelectedGameMode] = useState<string>('')\r\n  // Opponent compare: select a friend to render on the second card\r\n  const [friends, setFriends] = useState<Array<{ email: string; username?: string }>>([])\r\n  const [opponent, setOpponent] = useState<string>('')\r\n  const [showPicker, setShowPicker] = useState<boolean>(false)\r\n  const [q, setQ] = useState<string>('')\r\n  const [results, setResults] = useState<Array<{ email: string; username?: string }>>([])\r\n  const [searching, setSearching] = useState<boolean>(false)\r\n  const me = String(user?.email || '').toLowerCase()\r\n  useEffect(() => {\r\n    let cancelled = false\r\n    async function load() {\r\n      try {\r\n        if (!me) return\r\n        const res = await fetch(`/api/friends/list?email=${encodeURIComponent(me)}`)\r\n        const j = await res.json().catch(()=>({friends:[]}))\r\n        if (!cancelled) setFriends((j.friends||[]) as Array<{email:string;username?:string}>)\r\n      } catch {}\r\n    }\r\n    load()\r\n    // Refresh occasionally in case friends change while open\r\n    const id = setInterval(load, 20000)\r\n    return () => { cancelled = true; clearInterval(id) }\r\n  }, [me])\r\n\r\n  // Rehydrate previously selected opponent from localStorage (per-user key)\r\n  useEffect(() => {\r\n    try {\r\n      const key = me ? `ndn:stats:opponent:${me}` : 'ndn:stats:opponent'\r\n      const saved = localStorage.getItem(key)\r\n      if (saved) setOpponent(saved)\r\n    } catch {}\r\n  }, [me])\r\n\r\n  // Persist opponent selection\r\n  useEffect(() => {\r\n    try {\r\n      const key = me ? `ndn:stats:opponent:${me}` : 'ndn:stats:opponent'\r\n      if (opponent) localStorage.setItem(key, opponent); else localStorage.removeItem(key)\r\n    } catch {}\r\n  }, [opponent, me])\r\n\r\n  async function runSearch(term: string) {\r\n    setQ(term)\r\n    if (!term.trim()) { setResults([]); return }\r\n    setSearching(true)\r\n    try {\r\n      const res = await fetch(`/api/friends/search?q=${encodeURIComponent(term)}`)\r\n      const j = await res.json().catch(()=>({results:[]}))\r\n      setResults((j.results||[]) as Array<{email:string;username?:string}>)\r\n    } finally { setSearching(false) }\r\n  }\r\n\r\n  // Build a score-frequency distribution for the selected family.\r\n  // For now, we only have X01 in the match store; \"other\" is a placeholder that would read other game stats when added.\r\n  const dist = useMemo(() => {\r\n    const freq = new Map<number, number>()\r\n    if (family === 'x01') {\r\n      for (const p of players) {\r\n        for (const leg of p.legs) {\r\n          for (const v of leg.visits) {\r\n            const s = Math.max(0, Math.min(180, v.score))\r\n            freq.set(s, (freq.get(s) ?? 0) + 1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // Convert to sorted array (by score asc) and limit to reasonable width\r\n    const arr = Array.from(freq.entries()).sort((a, b) => a[0] - b[0])\r\n    // If very sparse, still show common x01 bands\r\n    if (arr.length === 0 && family === 'x01') {\r\n      [0, 26, 41, 60, 81, 100, 120, 140, 160, 180].forEach(k => freq.set(k, 0))\r\n      return Array.from(freq.entries()).sort((a, b) => a[0] - b[0]).map(([label, value]) => ({ label, value }))\r\n    }\r\n    return arr.map(([label, value]) => ({ label, value }))\r\n  }, [players, family])\r\n\r\n  // Build Other Modes dataset: one bar per mode with value = played, label = mode name, and show played/won in label\r\n  const otherData = useMemo(() => {\r\n    const gm = getGameModeStats(allGames as unknown as string[])\r\n    return (allGames as unknown as string[]).map(mode => {\r\n      const e = gm[mode] || { played: 0, won: 0 }\r\n      // Bar label stays short; detailed caption rendered below values via custom footer\r\n      return { label: mode, value: e.played, extra: e.won }\r\n    })\r\n  }, [family])\r\n\r\n  // Trigger re-render when any game-mode stat updates elsewhere\r\n  useEffect(() => {\r\n    const onUpdate = () => setFamily(f => f) // noop to refresh memo\r\n    window.addEventListener('ndn:stats-updated', onUpdate as any)\r\n    return () => window.removeEventListener('ndn:stats-updated', onUpdate as any)\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell\" style={{ background: 'linear-gradient(135deg, #393053 0%, #635985 100%)' }}>\r\n      <div className=\"mb-4\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <h2 className=\"text-2xl font-extrabold text-white\">Match Stats</h2>\r\n          <span className=\"text-xs opacity-70\">View</span>\r\n        </div>\r\n        <TabPills\r\n          tabs={[{ key: 'x01', label: 'X01' }, { key: 'other', label: 'Other Modes' }]}\r\n          active={family}\r\n          onChange={(k)=> setFamily((k as 'x01'|'other'))}\r\n        />\r\n      </div>\r\n      {inProgress && (\r\n        <div className=\"mb-3 p-2 rounded-lg text-sm border border-amber-500/40 bg-amber-500/10 text-amber-200\">Note: Detailed leg stats are finalized at the end of the game.</div>\r\n      )}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n        {players.map((p, idx) => (\r\n          <div key={p.id} className=\"p-4 rounded-2xl border border-indigo-500/20 bg-gradient-to-br from-indigo-700/6 to-indigo-900/6 shadow-sm transform transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <div className=\"font-semibold\">{idx===1 && !opponent ? (p.name || 'Opponent') : (idx===1 && opponent ? opponent : p.name)}</div>\r\n              {idx === 1 && (\r\n                <div className=\"flex gap-2 items-center overflow-x-auto py-1\">\r\n                  <button\r\n                    className=\"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10 hover:bg-white/10\"\r\n                    onClick={()=> setShowPicker(s => !s)}\r\n                    title=\"Search user to compare\"\r\n                  >Select Friend</button>\r\n                  {friends.slice(0, 6).map(f => {\r\n                    const lbl = f.username || f.email\r\n                    const active = opponent === lbl\r\n                    return (\r\n                      <button\r\n                        key={f.email}\r\n                        className={`text-[11px] px-3 py-1 rounded-full border ${active ? 'bg-indigo-500/30 border-indigo-400/50' : 'bg-white/6 border-white/8 hover:bg-white/10 transform hover:-translate-y-0.5 transition-all duration-150'}`}\r\n                        onClick={()=> setOpponent(lbl)}\r\n                        title={`Compare vs ${lbl}`}\r\n                      >{lbl}</button>\r\n                    )\r\n                  })}\r\n                  {friends.length === 0 && (\r\n                    <button className=\"text-[11px] px-3 py-1 rounded-full bg-white/5 border border-white/10\" disabled>Find friends to compare</button>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            {idx === 1 && showPicker && (\r\n              <div className=\"mb-2 p-2 rounded-lg bg-black/20 border border-white/10\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <input\r\n                    className=\"input flex-1 py-1\"\r\n                    placeholder=\"Search by name or email\"\r\n                    value={q}\r\n                    onChange={e=> runSearch(e.target.value)}\r\n                  />\r\n                  <button className=\"btn px-3 py-1 text-sm\" onClick={()=> runSearch(q)} disabled={searching}>Search</button>\r\n                </div>\r\n                <ul className=\"max-h-40 overflow-auto space-y-1\">\r\n                  {results.map(r => {\r\n                    const lbl = r.username || r.email\r\n                    return (\r\n                      <li key={r.email}>\r\n                        <button\r\n                          className=\"w-full text-left px-2 py-1 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm\"\r\n                          onClick={()=> { setOpponent(lbl); setShowPicker(false) }}\r\n                        >{lbl}</button>\r\n                      </li>\r\n                    )\r\n                  })}\r\n                  {!results.length && (\r\n                    <li className=\"text-xs opacity-70\">{q.trim() ? 'No results' : 'Type to search…'}</li>\r\n                  )}\r\n                </ul>\r\n              </div>\r\n            )}\r\n            {/* If second card and an opponent is selected, show their all-time stats; otherwise show the match/player stats */}\r\n            {idx === 1 && opponent ? (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).best3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).worst3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{(() => { const a = getAllTime(opponent); return a.bestLegDarts ? `${a.bestLegDarts} darts` : '—' })()}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{getAllTime(opponent).bestCheckout || '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(opponent))} · {formatAvg(getMonthlyAvg3(opponent))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(opponent))} · {formatAvg(getMonthlyFirstNineAvg(opponent))}</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(opponent); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(p.bestThreeDartAvg)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(p.worstThreeDartAvg)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{p.bestNineDart ? `${p.bestNineDart.darts} darts` : '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{p.bestCheckout ?? '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(p.name))} · {formatAvg(getMonthlyAvg3(p.name))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(p.name))} · {formatAvg(getMonthlyFirstNineAvg(p.name))}</span>\r\n                  </div>\r\n                </div>\r\n                {/* All-time snapshot */}\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(p.name); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n        {/* Opponent compare card: if there are fewer than 2 players, show a selector to compare with a friend */}\r\n        {players.length <= 1 && (\r\n          <div className=\"p-3 rounded-2xl border border-purple-500/20 bg-gradient-to-r from-purple-800/6 to-pink-800/6\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <div className=\"font-semibold\">Opponent</div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {friends.slice(0, 6).map(f => {\r\n                  const lbl = f.username || f.email\r\n                  const active = opponent === (f.username || f.email)\r\n                  return (\r\n                    <button\r\n                      key={f.email}\r\n                      className={`text-[11px] px-3 py-1 rounded-full border ${active ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white border-transparent shadow-sm' : 'bg-gradient-to-r from-purple-500/8 to-pink-500/8 border-white/10 hover:from-purple-500/12 hover:to-pink-500/12'}`}\r\n                      onClick={()=> setOpponent(lbl)}\r\n                      title={`Compare vs ${lbl}`}\r\n                    >{lbl}</button>\r\n                  )\r\n                })}\r\n                {friends.length === 0 && (\r\n                  <span className=\"text-xs opacity-70\">Add friends to compare stats.</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {opponent ? (\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Comparing to</div>\r\n                  <div className=\"font-semibold\">{opponent}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTimeAvg(opponent))}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Worst 3-Dart</div>\r\n                  <div className=\"font-semibold\">{formatAvg(getAllTime(opponent).worst3 || 0)}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best 9-Dart (fewest darts)</div>\r\n                  <div className=\"font-semibold\">{(() => { const a = getAllTime(opponent); return a.bestLegDarts ? `${a.bestLegDarts} darts` : '—' })()}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10\">\r\n                  <div className=\"text-slate-300\">Best Checkout</div>\r\n                  <div className=\"font-semibold\">{getAllTime(opponent).bestCheckout || '—'}</div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">Averages (All-time vs Monthly)</div>\r\n                  <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                    <span>3-dart: {formatAvg(getAllTimeAvg(opponent))} · {formatAvg(getMonthlyAvg3(opponent))}</span>\r\n                    <span>First 9: {formatAvg(getAllTimeFirstNineAvg(opponent))} · {formatAvg(getMonthlyFirstNineAvg(opponent))}</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-2 rounded-lg bg-white/5 border border-white/10 col-span-2\">\r\n                  <div className=\"text-slate-300\">All-time snapshot</div>\r\n                  {(() => { const all = getAllTime(opponent); return (\r\n                    <div className=\"font-semibold flex flex-wrap gap-3 text-[13px]\">\r\n                      <span>Best 3-dart: {formatAvg(all.best3||0)}</span>\r\n                      <span>Worst 3-dart: {formatAvg(all.worst3||0)}</span>\r\n                      <span>Best leg: {all.bestLegDarts || 0} darts</span>\r\n                      <span>Best checkout: {all.bestCheckout || 0}</span>\r\n                    </div>\r\n                  )})()}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-sm opacity-70\">Select a friend above to compare.</div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Score distribution for X01 family OR Game Stats for Other Modes */}\r\n      {family !== 'other' ? (\r\n        <div className=\"mt-6\">\r\n          <div className=\"mb-2 text-sm opacity-80\">Score Distribution ({family.toUpperCase()}): Visits by scored points</div>\r\n          <div className=\"rounded-xl border border-indigo-500/20 p-3 min-h-[220px] transform transition-shadow duration-200 hover:shadow-lg overflow-y-auto\" style={{ background: 'linear-gradient(135deg, #393053 0%, #635985 100%)', scrollbarColor: '#8F43EE #18122B' }}>\r\n            <BarChart data={dist} showValues={false} />\r\n          </div>\r\n        </div>\r\n      ) : selectedGameMode && otherData.find(d => d.label === selectedGameMode) ? (\r\n        <div className=\"mt-6\">\r\n          {(() => {\r\n            const game = otherData.find(d => d.label === selectedGameMode)!\r\n            return (\r\n              <div>\r\n                <div className=\"mb-2 text-sm opacity-80\">Game Stats for {game.label}</div>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                  <div className=\"p-4 rounded-lg bg-white/10 border border-white/20\">\r\n                    <div className=\"text-slate-300 text-sm mb-1\">Games Played</div>\r\n                    <div className=\"text-3xl font-bold text-white\">{game.value}</div>\r\n                  </div>\r\n                  <div className=\"p-4 rounded-lg bg-white/10 border border-white/20\">\r\n                    <div className=\"text-slate-300 text-sm mb-1\">Games Won</div>\r\n                    <div className=\"text-3xl font-bold text-green-400\">{game.extra}</div>\r\n                  </div>\r\n                  <div className=\"p-4 rounded-lg bg-white/10 border border-white/20\">\r\n                    <div className=\"text-slate-300 text-sm mb-1\">Win Rate</div>\r\n                    <div className=\"text-3xl font-bold text-blue-400\">{game.value > 0 ? ((game.extra / game.value) * 100).toFixed(1) : 0}%</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )\r\n          })()}\r\n        </div>\r\n      ) : null}\r\n\r\n      {/* Other Modes: Game Mode Selector with Pills */}\r\n      {family === 'other' && (\r\n        <div className=\"mt-6\">\r\n          <div className=\"mb-3\">\r\n            <div className=\"text-sm opacity-80 mb-3\">Other Modes: Click a game to view stats</div>\r\n            <div className=\"rounded-xl bg-white/5 backdrop-blur-md border border-white/10 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar flex-wrap\">\r\n              {otherData.map((d) => (\r\n                <button\r\n                  key={d.label}\r\n                  onClick={() => setSelectedGameMode(d.label)}\r\n                  className={`transition-all select-none whitespace-nowrap rounded-full px-4 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 active:scale-[0.98] ${\r\n                    selectedGameMode === d.label\r\n                      ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg'\r\n                      : 'bg-gradient-to-r from-slate-700 to-slate-600 text-white hover:from-slate-600 hover:to-slate-500'\r\n                  }`}\r\n                >\r\n                  {d.label}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {!selectedGameMode && (\r\n            <div className=\"rounded-xl border border-indigo-500/20 p-4\" style={{ background: 'linear-gradient(135deg, #393053 0%, #635985 100%)' }}>\r\n              <div className=\"text-center text-slate-300\">Select a game mode above to view detailed stats</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useMemo, useState } from 'react'\r\nimport ResizableModal from './ui/ResizableModal'\r\nimport { useToast } from '../store/toast'\r\nimport { useWS } from './WSProvider'\r\nimport { apiFetch } from '../utils/api'\r\nimport { useUserSettings } from '../store/userSettings'\r\n\r\ntype Tournament = {\r\n  id: string\r\n  title: string\r\n  game: string\r\n  mode: 'bestof'|'firstto'\r\n  value: number\r\n  description: string\r\n  startAt: number\r\n  checkinMinutes: number\r\n  capacity: number\r\n  participants: { email: string, username: string }[]\r\n  official?: boolean\r\n  prize?: boolean\r\n  prizeType?: 'premium'|'cash'|'none'\r\n  prizeAmount?: number\r\n  currency?: string\r\n  payoutStatus?: 'none'|'pending'|'paid'\r\n  status: 'scheduled'|'running'|'completed'\r\n  winnerEmail?: string|null\r\n  startingScore?: number\r\n  creatorEmail?: string\r\n  creatorName?: string\r\n}\r\n\r\nexport default function Tournaments({ user }: { user: any }) {\r\n  const toast = useToast()\r\n  const wsGlobal = (() => { try { return useWS() } catch { return null } })()\r\n  // Persisted match preferences (used when creating or joining)\r\n  const { matchType = 'singles', setMatchType, teamAName = 'Team A', setTeamAName, teamBName = 'Team B', setTeamBName } = useUserSettings()\r\n  const [list, setList] = useState<Tournament[]>([])\r\n  const [loading, setLoading] = useState(false)\r\n  const [errorMsg, setErrorMsg] = useState('')\r\n  const [cooldownUntil, setCooldownUntil] = useState<number | null>(null)\r\n  const [showCreate, setShowCreate] = useState(false)\r\n  const [leaveAsk, setLeaveAsk] = useState<{ open: boolean; t: Tournament | null }>({ open: false, t: null })\r\n  const [deleteConfirm, setDeleteConfirm] = useState<{ open: boolean; t: Tournament | null }>({ open: false, t: null })\r\n  const [form, setForm] = useState({\r\n    title: 'Community X01 Tournament',\r\n    game: 'X01',\r\n    mode: 'bestof' as 'bestof'|'firstto',\r\n    value: 3,\r\n    description: '',\r\n    startAt: new Date(Date.now() + 2*60*60*1000).toISOString().slice(0,16), // local yyyy-mm-ddThh:mm\r\n    checkinMinutes: 15,\r\n    capacity: 8,\r\n    startingScore: 501,\r\n    requireCalibration: false,\r\n  })\r\n  const isTouch = (() => {\r\n    try { return ('ontouchstart' in window) || (navigator.maxTouchPoints||0) > 0 } catch { return false }\r\n  })()\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch('/api/tournaments')\r\n      const data = await res.json()\r\n      setList(Array.isArray(data.tournaments) ? data.tournaments : [])\r\n    } catch {}\r\n  }\r\n  useEffect(() => { refresh() }, [])\r\n\r\n  // Listen for WS push updates from global provider if available\r\n  useEffect(() => {\r\n    if (!wsGlobal) return\r\n    const unsub = wsGlobal.addListener((msg) => {\r\n      try {\r\n        if (msg.type === 'tournaments') setList(msg.tournaments || [])\r\n        if (msg.type === 'tournament-win' && msg.message) {\r\n          toast(msg.message, { type: 'success', timeout: 10000 }) // Show for 10 seconds\r\n        }\r\n        // tournament-reminder handled optionally here if desired\r\n      } catch {}\r\n    })\r\n    return () => { unsub() }\r\n  }, [wsGlobal?.connected])\r\n\r\n  const email = String(user?.email || '').toLowerCase()\r\n  \r\n  // Simple, persistent match preference UI\r\n  const MatchPrefs = () => (\r\n    <div className=\"mb-3 p-2 rounded-lg bg-slate-900/40 border border-white/10 text-white text-xs flex items-center gap-2 flex-wrap\">\r\n      <span className=\"opacity-70\">Default match</span>\r\n      <span className=\"btn py-1 px-2 bg-indigo-500/30 border border-indigo-400/50 text-indigo-100\">Singles</span>\r\n      <span className=\"text-xs opacity-60 ml-2\">(tournaments use Singles only)</span>\r\n    </div>\r\n  )\r\n  // Fetch subscription to detect if user is a recent tournament winner (cooldown)\r\n  useEffect(() => {\r\n    let abort = false\r\n    async function check() {\r\n      if (!email) { setCooldownUntil(null); return }\r\n      try {\r\n        const res = await apiFetch(`/api/subscription?email=${encodeURIComponent(email)}`)\r\n        const data = await res.json()\r\n        if (!abort) {\r\n          if (data?.source === 'tournament' && typeof data.expiresAt === 'number' && data.expiresAt > Date.now()) {\r\n            setCooldownUntil(data.expiresAt)\r\n          } else {\r\n            setCooldownUntil(null)\r\n          }\r\n        }\r\n      } catch {\r\n        if (!abort) setCooldownUntil(null)\r\n      }\r\n    }\r\n    check()\r\n    return () => { abort = true }\r\n  }, [email])\r\n  function hasJoined(t: Tournament) {\r\n    return !!t.participants?.some(p => p.email === email)\r\n  }\r\n\r\n  // Helper to delete a tournament with proper error handling and owner fallback\r\n  async function deleteTournament(t: Tournament) {\r\n    if (!email) return\r\n    setDeleteConfirm({ open: true, t })\r\n  }\r\n\r\n  async function confirmDeleteTournament() {\r\n    const t = deleteConfirm.t\r\n    if (!t || !email) return\r\n    setDeleteConfirm({ open: false, t: null })\r\n    setLoading(true)\r\n    try {\r\n      // First try creator/owner shared endpoint\r\n      let res = await apiFetch('/api/tournaments/delete', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ tournamentId: t.id, requesterEmail: email })\r\n      })\r\n\r\n      // If forbidden but user is the owner, try the admin endpoint as a fallback\r\n      if (!res.ok && res.status === 403 && String(email) === 'daviesfamily108@gmail.com') {\r\n        res = await apiFetch('/api/admin/tournaments/delete', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ tournamentId: t.id, requesterEmail: email })\r\n        })\r\n      }\r\n\r\n      if (!res.ok) {\r\n        let msg = 'Delete failed'\r\n        try {\r\n          const data = await res.json()\r\n          if (data?.error) msg = `Delete failed: ${String(data.error)}`\r\n        } catch {}\r\n        toast(msg, { type: 'error' })\r\n        return\r\n      }\r\n\r\n      toast('Tournament deleted', { type: 'success' })\r\n      await refresh()\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  async function join(t: Tournament) {\r\n    if (!email) return\r\n    setLoading(true)\r\n    try {\r\n      const res = await apiFetch('/api/tournaments/join', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: t.id, email, username: user?.username }) })\r\n      if (!res.ok) {\r\n        let data: any = {}\r\n        try { data = await res.json() } catch {}\r\n        if (data?.error === 'WINNER_COOLDOWN' && typeof data.until === 'number') {\r\n          setErrorMsg(`You're a recent NDN tournament winner. You can re-enter after ${fmt(data.until)}.`)\r\n          setTimeout(()=>setErrorMsg(''), 6000)\r\n          toast('Join blocked: winner cooldown active', { type: 'error' })\r\n        } else if (data?.error === 'ALREADY_IN_TOURNAMENT') {\r\n          setErrorMsg(String(data.message || 'You can only join one tournament at a time.'))\r\n          setTimeout(()=>setErrorMsg(''), 6000)\r\n          toast('Join blocked: already in another tournament', { type: 'error' })\r\n        } else if (data?.error) {\r\n          setErrorMsg(String(data.error))\r\n          setTimeout(()=>setErrorMsg(''), 3500)\r\n          toast(`Join failed: ${String(data.error)}`, { type: 'error' })\r\n        }\r\n        return\r\n      }\r\n      toast('Joined tournament', { type: 'success' })\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function leave(t: Tournament) {\r\n    if (!email) return\r\n    setLoading(true)\r\n    try {\r\n      const res = await apiFetch('/api/tournaments/leave', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tournamentId: t.id, email }) })\r\n      if (!res.ok) {\r\n        let data: any = {}\r\n        try { data = await res.json() } catch {}\r\n        if (data?.error) {\r\n          toast(`Leave failed: ${String(data.error)}`, { type: 'error' })\r\n        } else if (res.status === 404) {\r\n          toast('Leave failed (endpoint not found). Restart the server to enable /api/tournaments/leave.', { type: 'error' })\r\n        } else {\r\n          toast('Leave failed. Please try again.', { type: 'error' })\r\n        }\r\n        return\r\n      }\r\n      toast('Left tournament', { type: 'success' })\r\n      // Optimistic local update\r\n      setList(prev => prev.map(it => it.id === t.id ? { ...it, participants: (it.participants||[]).filter(p => p.email !== email) } : it))\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  async function createTournament() {\r\n    setLoading(true)\r\n    try {\r\n      const start = new Date(form.startAt).getTime()\r\n      await apiFetch('/api/tournaments/create', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({\r\n        title: form.title,\r\n        game: form.game,\r\n        mode: form.mode,\r\n        value: Number(form.value),\r\n        description: form.description,\r\n        startAt: start,\r\n        checkinMinutes: Number(form.checkinMinutes),\r\n        capacity: Number(form.capacity),\r\n        startingScore: form.game==='X01' ? Number(form.startingScore||501) : undefined,\r\n        requireCalibration: !!form.requireCalibration,\r\n        creatorEmail: user?.email,\r\n        creatorName: user?.username,\r\n      }) })\r\n      setShowCreate(false)\r\n      toast('Tournament created', { type: 'success' })\r\n      await refresh()\r\n    } finally { setLoading(false) }\r\n  }\r\n\r\n  // Close the create modal on Escape\r\n  useEffect(() => {\r\n    if (!showCreate) return\r\n    const onKey = (e: KeyboardEvent) => { if (e.key === 'Escape') setShowCreate(false) }\r\n    document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [showCreate])\r\n\r\n  const official = useMemo(() => list.filter(t => t.official), [list])\r\n  const community = useMemo(() => list.filter(t => !t.official), [list])\r\n  const nextOfficial = useMemo(() => {\r\n    const upcoming = official\r\n      .filter(t => t.status === 'scheduled')\r\n      .sort((a,b) => a.startAt - b.startAt)\r\n    return upcoming[0] || null\r\n  }, [official])\r\n\r\n  function fmt(ts: number) {\r\n    const d = new Date(ts)\r\n    return d.toLocaleString()\r\n  }\r\n\r\n  return (\r\n    <div className=\"card ndn-game-shell\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h2 className=\"text-2xl font-bold\">Tournaments</h2>\r\n      </div>\r\n      <div className=\"ndn-shell-body\">\r\n      {/* Create Tournament + and default match prefs on a single header row */}\r\n      <div className=\"mb-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 flex items-center justify-between gap-2 flex-wrap\">\r\n        <div className=\"min-w-0\">\r\n          <MatchPrefs />\r\n        </div>\r\n        <div className=\"shrink-0\">\r\n          <button className=\"btn\" onClick={()=>setShowCreate(true)}>Create Tournament +</button>\r\n        </div>\r\n      </div>\r\n  <div className=\"mb-2 text-sm font-semibold text-slate-300\">World Lobby</div>\r\n      {/* Persistent banner for next official weekly tournament */}\r\n      {nextOfficial && (\r\n        <div className=\"mb-4 p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-2\">\r\n            <div>\r\n              <div className=\"text-sm uppercase tracking-wide text-indigo-300 font-semibold\">Weekly Official Tournament</div>\r\n              <div className=\"font-bold\">{nextOfficial.title}</div>\r\n                  <div className=\"text-sm opacity-80\">{nextOfficial.game}{nextOfficial.game==='X01' && nextOfficial.startingScore?`/${nextOfficial.startingScore}`:''} · {nextOfficial.mode==='firstto'?'First to':'Best of'} {nextOfficial.value} · Starts {fmt(nextOfficial.startAt)} · Cap {nextOfficial.capacity} · Joined {nextOfficial.participants.length}</div>\r\n              {nextOfficial.prize && (\r\n                <div className=\"text-xs mt-1\">\r\n                  Prize: {nextOfficial.prizeType === 'cash' && nextOfficial.prizeAmount ? `${nextOfficial.currency||'USD'} ${nextOfficial.prizeAmount}` : '3 months PREMIUM'}\r\n                </div>\r\n              )}\r\n              {nextOfficial.status !== 'scheduled' && <div className=\"text-xs\">Status: {nextOfficial.status}</div>}\r\n              {cooldownUntil && cooldownUntil > Date.now() && (\r\n                <div className=\"text-xs text-rose-300\">Recent winners can re-enter after {fmt(cooldownUntil)}.</div>\r\n              )}\r\n            </div>\r\n            <div className=\"shrink-0\">\r\n              <button\r\n                className={`btn ${hasJoined(nextOfficial) ? 'bg-emerald-600 hover:bg-emerald-600' : ''}`}\r\n                title={hasJoined(nextOfficial)\r\n                  ? 'Double-click to leave this tournament'\r\n                  : (nextOfficial.official && cooldownUntil && cooldownUntil > Date.now() ? `Recent winners can re-enter after ${fmt(cooldownUntil)}` : '')}\r\n                disabled={loading || nextOfficial.status!=='scheduled' || (!hasJoined(nextOfficial) && (nextOfficial.participants.length>=nextOfficial.capacity || (!!cooldownUntil && cooldownUntil > Date.now())))}\r\n                onClick={()=> {\r\n                  if (!hasJoined(nextOfficial)) { join(nextOfficial) }\r\n                  else if (isTouch) { setLeaveAsk({ open: true, t: nextOfficial }) }\r\n                }}\r\n                onDoubleClick={()=> { if (!isTouch && hasJoined(nextOfficial)) setLeaveAsk({ open: true, t: nextOfficial }) }}\r\n                aria-label={hasJoined(nextOfficial) ? 'Already Joined' : 'Join Now'}\r\n              >{hasJoined(nextOfficial) ? 'Already Joined!' : 'Join Now'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {errorMsg && (\r\n        <div className=\"mb-3 p-2 rounded-lg bg-amber-700/30 border border-amber-600/40 text-amber-200 text-sm\">{errorMsg}</div>\r\n      )}\r\n      <div className=\"space-y-4\">\r\n        <section>\r\n          <div className=\"font-semibold mb-1\">Official</div>\r\n          <div className=\"text-xs opacity-70 mb-2\">\r\n            {cooldownUntil && cooldownUntil > Date.now() ? (\r\n              <>You’re a recent NDN tournament winner — to keep it fair, you can re-enter after {fmt(cooldownUntil)}.</>\r\n            ) : (\r\n              <>Note: Weekly winners can re-enter once their 3 months of PREMIUM ends.</>\r\n            )}\r\n          </div>\r\n          <ul className=\"space-y-2\">\r\n            {official.map(t => (\r\n              <li key={t.id} className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\r\n                <div className=\"space-y-0.5\">\r\n                  <div className=\"font-semibold\">{t.title} {t.prize && (\r\n                    <span className=\"inline-flex items-center gap-1 ml-2 align-middle\">\r\n                      <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500 text-black\">Prize</span>\r\n                      <span\r\n                        className=\"inline-flex items-center justify-center w-4 h-4 rounded-full bg-slate-600 text-white text-[10px] leading-none cursor-help\"\r\n                        title={t.prizeType==='cash' ? 'Official cash prize tournament — payout handled by admin.' : 'Weekly winners get 3 months of PREMIUM and can re-enter once their prize period ends.'}\r\n                        aria-label=\"Prize info\"\r\n                      >i</span>\r\n                    </span>\r\n                  )}</div>\r\n                  <div className=\"text-sm opacity-80\">{t.game}{t.game==='X01' && t.startingScore?`/${t.startingScore}`:''} · {t.mode==='firstto'?'First to':'Best of'} {t.value} · {fmt(t.startAt)} · Cap {t.capacity} · Joined {t.participants.length}</div>\r\n                  {t.prize && (\r\n                    <div className=\"text-xs\">\r\n                      Prize: {t.prizeType === 'cash' && t.prizeAmount ? `${t.currency||'USD'} ${t.prizeAmount}` : '3 months PREMIUM'}\r\n                      {t.status==='completed' && t.prizeType==='cash' && t.payoutStatus && (\r\n                        <span className={`ml-2 px-2 py-0.5 rounded ${t.payoutStatus==='paid'?'bg-emerald-600':'bg-amber-600'}`}>{t.payoutStatus==='paid'?'Paid':'Pending'}</span>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                  {t.status !== 'scheduled' && <div className=\"text-xs\">Status: {t.status}</div>}\r\n                  {hasJoined(t) && <div className=\"text-xs text-emerald-400 font-semibold\">Already Joined</div>}\r\n                  {t.official && cooldownUntil && cooldownUntil > Date.now() && (\r\n                    <div className=\"text-xs text-rose-300\">Cooldown active until {fmt(cooldownUntil)}.</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className={`btn ${hasJoined(t) ? 'bg-emerald-600 hover:bg-emerald-600' : ''}`}\r\n                    title={hasJoined(t)\r\n                      ? 'Double-click to leave this tournament'\r\n                      : (t.official && cooldownUntil && cooldownUntil > Date.now() ? `Recent winners can re-enter after ${fmt(cooldownUntil)}` : '')}\r\n                    disabled={loading || t.status!=='scheduled' || (!hasJoined(t) && (t.participants.length>=t.capacity || (t.official && !!cooldownUntil && cooldownUntil > Date.now())))}\r\n                    onClick={()=> { if (!hasJoined(t)) { join(t) } else if (isTouch) { setLeaveAsk({ open: true, t }) } }}\r\n                    onDoubleClick={()=> { if (!isTouch && hasJoined(t)) setLeaveAsk({ open: true, t }) }}\r\n                    aria-label={hasJoined(t) ? 'Already Joined' : 'Join Now'}\r\n                  >{hasJoined(t) ? 'Already Joined!' : 'Join Now'}</button>\r\n                  {/* Delete button when you are the creator (owner-created official) and it hasn't started */}\r\n                  {(t.status==='scheduled' && email && t.creatorEmail && String(t.creatorEmail).toLowerCase()===email) && (\r\n                    <button\r\n                      className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                      title=\"Delete this tournament\"\r\n                      onClick={()=>deleteTournament(t)}\r\n                      aria-label=\"Delete tournament\"\r\n                    >×</button>\r\n                  )}\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {official.length === 0 && <li className=\"text-sm opacity-60\">No official tournaments yet.</li>}\r\n          </ul>\r\n        </section>\r\n\r\n        <section>\r\n          <div className=\"font-semibold mb-1\">Community</div>\r\n          <ul className=\"space-y-2\">\r\n            {community.map(t => (\r\n              <li key={t.id} className=\"p-3 rounded bg-black/10 flex items-center justify-between relative\">\r\n                <div className=\"space-y-0.5\">\r\n                  <div className=\"font-semibold\">{t.title}</div>\r\n                  <div className=\"text-sm opacity-80\">{t.game}{t.game==='X01' && t.startingScore?`/${t.startingScore}`:''} · {t.mode==='firstto'?'First to':'Best of'} {t.value} · {fmt(t.startAt)} · Cap {t.capacity} · Joined {t.participants.length}</div>\r\n                  {t.description && <div className=\"text-xs opacity-80\">{t.description}</div>}\r\n                  {hasJoined(t) && <div className=\"text-xs text-emerald-400 font-semibold\">Already Joined</div>}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    className=\"btn\"\r\n                    title={hasJoined(t) ? 'Double-click to leave this tournament' : ''}\r\n                    disabled={loading || t.status!=='scheduled' || (!hasJoined(t) && t.participants.length>=t.capacity)}\r\n                    onClick={()=> { if (!hasJoined(t)) { join(t) } else if (isTouch) { setLeaveAsk({ open: true, t }) } }}\r\n                    onDoubleClick={()=> { if (!isTouch && hasJoined(t)) setLeaveAsk({ open: true, t }) }}\r\n                  >{hasJoined(t) ? 'Already Joined' : 'Join Now'}</button>\r\n                  {/* Delete button for creator to delete their own scheduled tournament */}\r\n                  {(t.status==='scheduled' && email && t.creatorEmail && String(t.creatorEmail).toLowerCase()===email) && (\r\n                    <button\r\n                      className=\"w-6 h-6 rounded-full bg-rose-600 hover:bg-rose-700 text-white text-xs flex items-center justify-center shadow\"\r\n                      title=\"Delete this tournament\"\r\n                      onClick={()=>deleteTournament(t)}\r\n                      aria-label=\"Delete tournament\"\r\n                    >×</button>\r\n                  )}\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {community.length === 0 && <li className=\"text-sm opacity-60\">No community tournaments yet.</li>}\r\n          </ul>\r\n        </section>\r\n      </div>\r\n\r\n      {showCreate && (\r\n        <div className=\"mb-4\">\r\n          <div className=\"card relative\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <h3 className=\"text-xl font-semibold\">Create Tournament</h3>\r\n              <button className=\"btn\" onClick={()=>setShowCreate(false)}>Close</button>\r\n            </div>\r\n            <div className=\"space-y-3 md:space-y-0 md:grid md:grid-cols-2 md:gap-4 pr-1\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Title</label>\r\n                <input className=\"input w-full\" value={form.title} onChange={e=>setForm(f=>({ ...f, title: e.target.value }))} />\r\n              </div>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Game</label>\r\n                  <select className=\"input w-full\" value={form.game} onChange={e=>setForm(f=>({ ...f, game: e.target.value }))}>\r\n                    {['X01', 'Cricket', 'Killer'].map(g => <option key={g} value={g}>{g}</option>)}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Mode</label>\r\n                  <select className=\"input w-full\" value={form.mode} onChange={e=>setForm(f=>({ ...f, mode: e.target.value as any }))}>\r\n                    <option value=\"bestof\">Best of</option>\r\n                    <option value=\"firstto\">First to</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Number</label>\r\n                  <input className=\"input w-full\" type=\"number\" min={1} value={form.value} onChange={e=>setForm(f=>({ ...f, value: Number(e.target.value) }))} />\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Description</label>\r\n                <textarea className=\"input w-full\" rows={5} value={form.description} onChange={e=>setForm(f=>({ ...f, description: e.target.value }))} />\r\n              </div>\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Start time</label>\r\n                  <input className=\"input w-full\" type=\"datetime-local\" value={form.startAt} onChange={e=>setForm(f=>({ ...f, startAt: e.target.value }))} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">Check-in reminder (min)</label>\r\n                  <input className=\"input w-full\" type=\"number\" min={0} value={form.checkinMinutes} onChange={e=>setForm(f=>({ ...f, checkinMinutes: Number(e.target.value) }))} />\r\n                </div>\r\n              </div>\r\n              {form.game==='X01' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold mb-1\">X01 Starting Score</label>\r\n                  <select className=\"input w-full\" value={String(form.startingScore)} onChange={e=>setForm(f=>({ ...f, startingScore: Number(e.target.value) }))}>\r\n                    {[301, 501, 701].map(s => <option key={s} value={s}>{s}</option>)}\r\n                  </select>\r\n                </div>\r\n              )}\r\n              <div>\r\n                <label className=\"inline-flex items-center gap-2 text-sm\">\r\n                  <input type=\"checkbox\" className=\"accent-purple-500\" checked={!!form.requireCalibration} onChange={e=>setForm(f=>({ ...f, requireCalibration: !!e.target.checked }))} />\r\n                  <span className=\"font-semibold\">Require calibration</span>\r\n                </label>\r\n                <div className=\"text-xs opacity-70 mt-1\">If checked, players must have a calibrated board to join matches spawned from this tournament.</div>\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-semibold mb-1\">Capacity</label>\r\n                <input className=\"input w-full\" type=\"number\" min={6} max={64} value={form.capacity} onChange={e=>setForm(f=>({ ...f, capacity: Number(e.target.value) }))} />\r\n              </div>\r\n              <div className=\"text-xs opacity-70\">Note: community tournaments do not award prizes.</div>\r\n              <div className=\"flex justify-end\">\r\n                <button className=\"btn\" disabled={loading} onClick={createTournament}>Create</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {leaveAsk.open && leaveAsk.t && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n          <div className=\"absolute inset-0 bg-black/40\" onClick={()=>setLeaveAsk({ open: false, t: null })} />\r\n          <div className=\"relative card p-4 w-[360px] max-w-[90vw]\">\r\n            <div className=\"text-lg font-semibold mb-2\">Leave tournament?</div>\r\n            <div className=\"text-sm opacity-80 mb-4\">Are you sure you want to remove yourself from “{leaveAsk.t.title}”?</div>\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <button\r\n                className=\"btn bg-rose-600 hover:bg-rose-700\"\r\n                onClick={()=>setLeaveAsk({ open: false, t: null })}\r\n              >Decline</button>\r\n              <button\r\n                className=\"btn bg-emerald-600 hover:bg-emerald-700\"\r\n                onClick={async ()=>{ const t = leaveAsk.t!; setLeaveAsk({ open: false, t: null }); await leave(t) }}\r\n              >Accept</button>\r\n            </div>\r\n        </div>\r\n      </div>\r\n      )}\r\n\r\n      {/* Delete Tournament Confirmation Modal */}\r\n      {deleteConfirm.open && deleteConfirm.t && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-slate-800 border border-slate-600 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n            <div className=\"text-center\">\r\n              <div className=\"text-xl font-semibold mb-4 text-white\">Delete Tournament</div>\r\n              <div className=\"text-slate-300 mb-6\">\r\n                Are you sure you want to delete <span className=\"font-semibold text-white\">\"{deleteConfirm.t.title}\"</span>?\r\n                <br />\r\n                <span className=\"text-sm text-slate-400\">This action cannot be undone.</span>\r\n              </div>\r\n              <div className=\"flex gap-3 justify-center\">\r\n                <button\r\n                  className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors\"\r\n                  onClick={() => setDeleteConfirm({ open: false, t: null })}\r\n                >\r\n                  Decline\r\n                </button>\r\n                <button\r\n                  className=\"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors\"\r\n                  onClick={confirmDeleteTournament}\r\n                >\r\n                  Continue\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n  {/* Phone camera overlay removed per UX preference; header badge preview only */}\r\n    </div>\r\n    </div>\r\n  )\r\n}","import { useEffect, useState } from 'react';\r\nimport { useToast } from '../store/toast';\r\n\r\nexport default function AdminAccess({ user }: { user?: any }) {\r\n  const [subscription, setSubscription] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n  const toast = useToast();\r\n\r\n  useEffect(() => {\r\n    const fetchSubscription = async () => {\r\n      try {\r\n        const q = user?.email ? `?email=${encodeURIComponent(user.email)}` : '';\r\n        const res = await fetch(`${API_URL}/api/subscription` + q);\r\n        if (!res.ok) throw new Error('Failed to fetch subscription');\r\n        const data = await res.json();\r\n        setSubscription(data);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Something went wrong');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchSubscription();\r\n  }, [user?.email]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"card\">\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-4\"></div>\r\n          <p>Loading subscription...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"card\">\r\n        <h2 className=\"text-2xl font-bold text-red-300 mb-2\">Subscription Error</h2>\r\n        <p className=\"mb-4 text-red-200\">{error}</p>\r\n        <button \r\n          onClick={() => window.location.reload()} \r\n          className=\"btn bg-red-600 hover:bg-red-700\"\r\n        >\r\n          Retry\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const hasAccess = subscription?.fullAccess;\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-indigo-300 mb-2\">\r\n        {hasAccess ? 'PREMIUM Active' : 'PREMIUM'}\r\n      </h2>\r\n      \r\n      {hasAccess ? (\r\n        <div className=\"mb-4\">\r\n          <div className=\"bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4\">\r\n            <div className=\"flex items-center gap-2 text-green-300 font-semibold mb-2\">\r\n              ✅ PREMIUM Access Active\r\n            </div>\r\n            <p className=\"text-green-200 text-sm\">\r\n              You have full access to all premium features!\r\n            </p>\r\n            {subscription?.source && (\r\n              <p className=\"text-green-200 text-xs mt-1\">\r\n                Source: {subscription.source}\r\n                {subscription?.expiresAt && ` (expires: ${new Date(subscription.expiresAt).toLocaleDateString()})`}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          <h3 className=\"text-lg font-semibold mb-2 text-indigo-200\">Your Benefits:</h3>\r\n        </div>\r\n      ) : (\r\n        <p className=\"mb-2 text-indigo-200\">Unlock every game mode known to darts, advanced stats, and premium features.</p>\r\n      )}\r\n      \r\n      <ul className=\"mb-4\">\r\n        <li>All game modes (including paid/advanced)</li>\r\n        <li>Online play with all rules and variations</li>\r\n        <li>Advanced analytics and leaderboards</li>\r\n        <li>Premium camera modes and autoscoring</li>\r\n      </ul>\r\n\r\n      {!hasAccess && (\r\n        <button\r\n          onClick={async () => {\r\n            try {\r\n              const res = await fetch(`${API_URL}/api/stripe/create-checkout-session`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email: user.email })\r\n              });\r\n              const data = await res.json();\r\n              if (data.ok && data.url) {\r\n                window.location.href = data.url;\r\n              } else if (data.error === 'STRIPE_NOT_CONFIGURED') {\r\n                toast(\"Premium purchases are not available. Payment link not configured.\", { type: 'error', timeout: 4000 });\r\n              } else {\r\n                toast(\"Failed to get payment link. Please try again.\", { type: 'error', timeout: 4000 });\r\n              }\r\n            } catch (err) {\r\n              toast(\"Error creating checkout. Please try again.\", { type: 'error', timeout: 4000 });\r\n            }\r\n          }}\r\n          className=\"btn bg-gradient-to-r from-indigo-500 to-fuchsia-600 text-white font-bold shadow-lg hover:scale-105 transition\"\r\n        >\r\n          Subscribe to PREMIUM\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}","import React, { useEffect, type ReactNode } from 'react'\r\n\r\ntype DrawerProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n  width?: number | string\r\n  title?: string\r\n  footer?: ReactNode\r\n  children: ReactNode\r\n  side?: 'left' | 'right'\r\n}\r\n\r\nexport default function Drawer({ open, onClose, width = 700, title, footer, children, side = 'right' }: DrawerProps) {\r\n  useEffect(() => {\r\n    function onKey(e: KeyboardEvent) { if (e.key === 'Escape') onClose() }\r\n    if (open) document.addEventListener('keydown', onKey)\r\n    return () => document.removeEventListener('keydown', onKey)\r\n  }, [open, onClose])\r\n\r\n  return (\r\n    <div className={`fixed inset-0 z-50 ${open ? '' : 'pointer-events-none'}`} aria-hidden={!open}>\r\n      {/* Backdrop */}\r\n      <div className={`absolute inset-0 bg-black/60 transition-opacity ${open ? 'opacity-100' : 'opacity-0'}`} onClick={onClose} />\r\n      {/* Panel */}\r\n      <div\r\n        className={`absolute top-0 ${side==='right' ? 'right-0 border-l' : 'left-0 border-r'} h-full bg-slate-900 border-slate-700 shadow-2xl w-full sm:w-auto flex flex-col transition-transform duration-200 ${open ? 'translate-x-0' : (side==='right' ? 'translate-x-full' : '-translate-x-full')}`}\r\n        style={{ width: typeof width === 'number' ? `${width}px` : width }}\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-700 sticky top-0 bg-slate-900 z-10\">\r\n          <div className=\"text-lg font-semibold\">{title}</div>\r\n          <button className=\"btn px-3 py-1 text-sm\" onClick={onClose}>Close</button>\r\n        </div>\r\n        {/* Body */}\r\n        <div className=\"flex-1 overflow-auto p-4\">\r\n          {children}\r\n        </div>\r\n        {/* Footer */}\r\n        {footer && (\r\n          <div className=\"px-4 py-3 border-t border-slate-700 sticky bottom-0 bg-slate-900 z-10\">\r\n            {footer}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { useEffect, useState } from 'react'\r\nimport { useIsAdmin } from '../utils/admin'\r\nimport { apiFetch } from '../utils/api'\r\n\r\ntype Ready = { ok: boolean; ws?: boolean; rooms?: number; clients?: number; mem?: { rss: number; heapUsed: number } }\r\n\r\nexport default function OpsDashboard({ user }: { user: any }) {\r\n  const isAdmin = useIsAdmin(user?.email)\r\n  const [ready, setReady] = useState<Ready|null>(null)\r\n  const [ann, setAnn] = useState<string>('')\r\n  const [msg, setMsg] = useState<string>('')\r\n\r\n  async function refresh() {\r\n    try {\r\n      const res = await apiFetch('/readyz')\r\n      setReady(await res.json())\r\n    } catch {}\r\n  }\r\n  useEffect(() => {\r\n    refresh()\r\n    const id = setInterval(refresh, 5000)\r\n    return () => clearInterval(id)\r\n  }, [])\r\n\r\n  if (!isAdmin) return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div>Restricted</div>\r\n    </div>\r\n  )\r\n\r\n  async function toggleMaintenance(enabled: boolean) {\r\n    setMsg('')\r\n    try {\r\n      const res = await apiFetch('/api/admin/maintenance', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ enabled, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg(`Maintenance ${enabled ? 'enabled' : 'disabled'}`)\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  async function announce() {\r\n    setMsg('')\r\n    const text = ann.trim()\r\n    if (!text) return\r\n    try {\r\n      const res = await apiFetch('/api/admin/announce', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: text, requesterEmail: user?.email }) })\r\n      const j = await res.json()\r\n      if (!res.ok || !j?.ok) setMsg(j?.error || 'Failed')\r\n      else setMsg('Announcement broadcasted')\r\n      setAnn('')\r\n    } catch { setMsg('Network error') }\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 className=\"text-2xl font-bold text-brand-700 mb-2\">Ops</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Readiness</div>\r\n          <div className=\"text-sm\">HTTP: <span className={`font-semibold ${ready?.ok ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ok)}</span></div>\r\n          <div className=\"text-sm\">WS: <span className={`font-semibold ${ready?.ws ? 'text-emerald-300' : 'text-rose-300'}`}>{String(!!ready?.ws)}</span></div>\r\n          <div className=\"text-sm\">Clients: <span className=\"font-semibold\">{ready?.clients ?? 0}</span></div>\r\n          <div className=\"text-sm\">Rooms: <span className=\"font-semibold\">{ready?.rooms ?? 0}</span></div>\r\n          <div className=\"text-sm\">Heap Used: <span className=\"font-semibold\">{ready?.mem ? Math.round(ready.mem.heapUsed/1024/1024) : 0} MB</span></div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Maintenance</div>\r\n          <div className=\"flex gap-2\">\r\n            <button className=\"btn\" onClick={()=>toggleMaintenance(true)}>Enable</button>\r\n            <button className=\"btn bg-slate-700 hover:bg-slate-800\" onClick={()=>toggleMaintenance(false)}>Disable</button>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-3 rounded-xl border border-indigo-500/40 bg-indigo-500/10\">\r\n          <div className=\"font-semibold mb-1\">Announcement</div>\r\n          <div className=\"flex gap-2\">\r\n            <input className=\"input flex-1\" placeholder=\"Message to broadcast\" value={ann} onChange={e=>setAnn(e.target.value)} />\r\n            <button className=\"btn\" onClick={announce}>Send</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {msg && <div className=\"text-xs mt-2\">{msg}</div>}\r\n      <div className=\"text-xs opacity-70 mt-2\">✅ Clustering enabled! For 1.5k+ concurrent users, deploy behind a reverse proxy (NGINX/Cloudflare) with sticky sessions for WebSockets. Set NODE_WORKERS environment variable to control worker count.</div>\r\n    </div>\r\n  )\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { HelpCircle, MessageCircle, X, Send } from 'lucide-react';\r\nimport { apiFetch } from '../utils/api'\r\nimport { useWS } from './WSProvider'\r\nimport HelpdeskChat from './HelpdeskChat'\r\n\r\ninterface HelpAssistantProps {}\r\n\r\nexport default function HelpAssistant({}: HelpAssistantProps) {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [messages, setMessages] = useState<Array<{text: string | {text: string, links?: Array<{text: string, tab: string}>}, isUser: boolean}>>([\r\n    { text: \"Hi! I'm your Nine Dart Nation assistant. How can I help you today?\", isUser: false }\r\n  ]);\r\n  const [input, setInput] = useState('');\r\n  const [awaitingAdminConfirm, setAwaitingAdminConfirm] = useState(false)\r\n  const [lastUserQuestion, setLastUserQuestion] = useState('')\r\n  const [myRequest, setMyRequest] = useState<any | null>(null)\r\n  const ws = (() => { try { return useWS() } catch { return null } })()\r\n\r\n  useEffect(() => {\r\n    if (!ws) return\r\n    const unsub = ws.addListener((data: any) => {\r\n      try {\r\n        if (data?.type === 'help-message' && myRequest && String(data.requestId) === String(myRequest.id)) {\r\n          // append message to chat (the HelpdeskChat modal will also get WS events, but keep assistant messages synced)\r\n          // We don't duplicate state here; just forward to help chat placeholder by refreshing request from server\r\n        }\r\n        if (data?.type === 'help-request-updated' && myRequest && data.request?.id === myRequest.id) {\r\n          setMyRequest(data.request)\r\n        }\r\n      } catch {}\r\n    })\r\n    return () => unsub()\r\n  }, [ws, myRequest])\r\n\r\n  const faq = {\r\n    'how to play': 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n    'calibration': 'Go to Settings > Camera & Vision > Calibration Guide to set up your camera properly.',\r\n    'premium': 'Premium unlocks all game modes. Click the \"Upgrade to PREMIUM\" button in online play.',\r\n    'username': 'Change your username once for free in Settings > Account.',\r\n    'voice': 'Enable voice caller in Settings > Audio & Voice. Test the voice with the Test Voice button.',\r\n    'friends': 'Add friends in the Friends tab to play together.',\r\n    'stats': 'View your statistics in the Stats tab.',\r\n    'settings': 'Customize your experience in the Settings panel.',\r\n    'support': 'Contact support via email or check the FAQ in Settings > Support.',\r\n    'scoring': 'Auto-scoring assigns each detected dart to the correct board segment using the detection pipeline. You can review scores in the Match Summary after the round.',\r\n    'autoscore': 'AutoScore attempts to place darts automatically. If a dart placement looks wrong, you can adjust it in the match review screen or disable immediate auto-commit in Settings.',\r\n    'pairing': 'To pair a phone or camera, open the Pairing flow from the main menu and follow the QR / pairing code steps. Ensure both devices are on the same network.',\r\n    'highlights': 'Highlights are saved when you checkout 50+ or visit 100+. You can download them from Settings > Highlights or save to your account.',\r\n    'legal': 'See the Legal Notice in the footer for Privacy & Copyright information. Click the footer link to view the full policy.',\r\n  };\r\n\r\n  const navigateToTab = (tabKey: string) => {\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('ndn:change-tab', { detail: { tab: tabKey } }));\r\n      setIsOpen(false); // Close the help modal after navigation\r\n    } catch (error) {\r\n      console.error('Navigation failed:', error);\r\n    }\r\n  };\r\n\r\n  const getResponseWithLinks = (userMessage: string): { text: string, links?: Array<{ text: string, tab: string }> } => {\r\n    const message = userMessage.toLowerCase();\r\n\r\n    if (message.includes('username') || message.includes('change name')) {\r\n      return {\r\n        text: 'You can change your username once for free.',\r\n        links: [{ text: 'Go to Settings > Account', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('premium') || message.includes('upgrade') || message.includes('subscription')) {\r\n      return {\r\n        text: 'Premium unlocks all game modes and features.',\r\n        links: [{ text: 'Go to Online Play', tab: 'online' }]\r\n      };\r\n    }\r\n    if (message.includes('calibrat') || message.includes('camera') || message.includes('vision')) {\r\n      return {\r\n        text: 'Set up your camera properly in Settings.',\r\n        links: [{ text: 'Go to Settings > Camera & Vision', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('voice') || message.includes('caller') || message.includes('audio')) {\r\n      return {\r\n        text: 'Enable voice calling in Settings.',\r\n        links: [{ text: 'Go to Settings > Audio & Voice', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('friend') || message.includes('play together')) {\r\n      return {\r\n        text: 'Add friends to play together.',\r\n        links: [{ text: 'Go to Friends', tab: 'friends' }]\r\n      };\r\n    }\r\n    if (message.includes('stat') || message.includes('score') || message.includes('performance')) {\r\n      return {\r\n        text: 'View your statistics and performance.',\r\n        links: [{ text: 'Go to Stats', tab: 'stats' }]\r\n      };\r\n    }\r\n    if (message.includes('setting') || message.includes('customiz') || message.includes('configur')) {\r\n      return {\r\n        text: 'Customize your experience.',\r\n        links: [{ text: 'Go to Settings', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('tournament') || message.includes('competition')) {\r\n      return {\r\n        text: 'Check out tournaments and competitions.',\r\n        links: [{ text: 'Go to Tournaments', tab: 'tournaments' }]\r\n      };\r\n    }\r\n    if (message.includes('score') || message.includes('scoring') || message.includes('autoscore')) {\r\n      return {\r\n        text: 'Auto-scoring assigns darts to board segments automatically. You can review and adjust placements in the Match Summary screen.',\r\n        links: [{ text: 'Go to Match Summary', tab: 'matchsummary' }]\r\n      }\r\n    }\r\n    if (message.includes('pair') || message.includes('pairing') || message.includes('phone') || message.includes('camera pairing')) {\r\n      return {\r\n        text: 'Use the Pairing flow to connect phones and cameras. Make sure devices are on the same Wi‑Fi and scan the QR code shown.',\r\n        links: [{ text: 'Open Pairing', tab: 'pairing' }]\r\n      }\r\n    }\r\n    if (message.includes('highlight') || message.includes('download') || message.includes('save')) {\r\n      return {\r\n        text: 'Highlights can be downloaded or saved to your account from the Highlights section. We keep a record when you hit milestone checkouts or visits.',\r\n        links: [{ text: 'Open Highlights', tab: 'highlights' }]\r\n      }\r\n    }\r\n    if (message.includes('privacy') || message.includes('copyright') || message.includes('legal')) {\r\n      return {\r\n        text: 'Our Legal Notice and Privacy information are available in the footer. You can view privacy, copyright, and contact details there.',\r\n        links: [{ text: 'View Legal Notice', tab: 'footer' }]\r\n      }\r\n    }\r\n    if (message.includes('help') || message.includes('support') || message.includes('faq')) {\r\n      return {\r\n        text: 'You\\'re already in the help section! Check Settings for more resources.',\r\n        links: [{ text: 'Go to Settings > Support', tab: 'settings' }]\r\n      };\r\n    }\r\n    if (message.includes('how to play') || message.includes('game') || message.includes('start')) {\r\n      return {\r\n        text: 'To play darts, select a game mode from the menu. For online play, join a match. For offline, start a local game.',\r\n        links: [\r\n          { text: 'Play Online', tab: 'online' },\r\n          { text: 'Play Offline', tab: 'offline' }\r\n        ]\r\n      };\r\n    }\r\n\r\n    return { text: \"I'm not sure about that. Try asking about playing, calibration, premium, username changes, voice settings, friends, stats, or settings.\" };\r\n  };\r\n\r\n  const handleSend = () => {\r\n    if (!input.trim()) return;\r\n    const userMessageRaw = input.trim()\r\n    const userMessage = userMessageRaw.toLowerCase();\r\n    setMessages(prev => [...prev, { text: userMessageRaw, isUser: true }]);\r\n    setInput('');\r\n\r\n    // If we're awaiting admin confirmation, interpret YES/NO\r\n    if (awaitingAdminConfirm) {\r\n      if (userMessage.startsWith('y')) {\r\n        // Send help request to server\r\n        setMessages(prev => [...prev, { text: 'Okay — I will notify an admin. Please wait for them to join the chat.', isUser: false }]);\r\n  setAwaitingAdminConfirm(false);\r\n        // fire-and-forget\r\n        (async () => {\r\n          try {\r\n            const payload = { message: lastUserQuestion || userMessageRaw }\r\n            const res = await apiFetch('/api/help/requests', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) })\r\n            const j = await res.json().catch(() => null)\r\n            // If server returns the request record, open the live chat\r\n            if (j && j.request) {\r\n              setMyRequest(j.request)\r\n              setMessages(prev => [...prev, { text: 'Okay — I will notify an admin. Please wait for them to join the chat.', isUser: false }])\r\n            } else {\r\n              setMessages(prev => [...prev, { text: 'Okay — I will notify an admin. Please wait for them to join the chat.', isUser: false }])\r\n            }\r\n          } catch (err) {\r\n            setMessages(prev => [...prev, { text: 'Failed to contact admins. Please try again later.', isUser: false }])\r\n          }\r\n        })()\r\n        return\r\n      } else {\r\n        setMessages(prev => [...prev, { text: \"Okay — I won't notify an admin. If you change your mind, just ask.\", isUser: false }]);\r\n  setAwaitingAdminConfirm(false);\r\n        return\r\n      }\r\n    }\r\n\r\n    // Get response with smart link suggestions\r\n    const response = getResponseWithLinks(userMessage);\r\n\r\n    // If the bot couldn't answer well, offer to escalate\r\n    if (typeof response.text === 'string' && response.text.includes(\"I'm not sure about that\")) {\r\n      setLastUserQuestion(userMessageRaw)\r\n  setAwaitingAdminConfirm(true);\r\n      setTimeout(() => {\r\n        setMessages(prev => [...prev, { text: { text: 'I can connect you to a member of our admin team — would you like that? Type YES or NO.', links: [] }, isUser: false }]);\r\n      }, 350)\r\n      return\r\n    }\r\n\r\n    setTimeout(() => {\r\n      setMessages(prev => [...prev, { text: response, isUser: false }]);\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Floating Button */}\r\n      <button\r\n        onClick={() => setIsOpen(true)}\r\n        className=\"fixed bottom-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-colors\"\r\n        title=\"Help Assistant\"\r\n      >\r\n        <HelpCircle className=\"w-6 h-6\" />\r\n      </button>\r\n\r\n      {/* Modal */}\r\n      {isOpen && (\r\n        <div className=\"fixed inset-0 z-50 flex items-end justify-end p-4\">\r\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setIsOpen(false)} />\r\n          <div className=\"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-md h-96 flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-4 border-b border-slate-700\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <MessageCircle className=\"w-5 h-5 text-blue-400\" />\r\n                <span className=\"font-semibold\">Help Assistant</span>\r\n              </div>\r\n              <button\r\n                onClick={() => setIsOpen(false)}\r\n                className=\"text-slate-400 hover:text-white\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n              {messages.map((msg, i) => (\r\n                <div key={i} className={`flex ${msg.isUser ? 'justify-end' : 'justify-start'}`}>\r\n                  <div className={`max-w-xs px-3 py-2 rounded-lg ${\r\n                    msg.isUser \r\n                      ? 'bg-blue-600 text-white' \r\n                      : 'bg-slate-700 text-slate-200'\r\n                  }`}>\r\n                    {typeof msg.text === 'string' ? (\r\n                      msg.text\r\n                    ) : (\r\n                      <div className=\"space-y-2\">\r\n                        <div>{msg.text.text}</div>\r\n                        {msg.text.links && (\r\n                          <div className=\"space-y-1\">\r\n                            {msg.text.links.map((link, linkIndex) => (\r\n                              <button\r\n                                key={linkIndex}\r\n                                onClick={() => navigateToTab(link.tab)}\r\n                                className=\"block w-full text-left text-blue-300 hover:text-blue-200 underline text-sm\"\r\n                              >\r\n                                {link.text}\r\n                              </button>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Input */}\r\n            <div className=\"p-4 border-t border-slate-700\">\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={input}\r\n                  onChange={(e) => setInput(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && handleSend()}\r\n                  placeholder=\"Ask me anything...\"\r\n                  className=\"flex-1 input\"\r\n                />\r\n                <button\r\n                  onClick={handleSend}\r\n                  className=\"btn bg-blue-600 hover:bg-blue-700\"\r\n                >\r\n                  <Send className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n        {/* Render live chat modal if a help request exists for this user */}\r\n        {myRequest && (\r\n          <HelpdeskChat request={myRequest} user={{ email: null, username: null, isAdmin: false }} onClose={() => setMyRequest(null)} />\r\n        )}\r\n    </>\r\n  );\r\n}","import { useEffect, useRef } from 'react'\r\nimport { useCameraSession } from '../store/cameraSession'\r\n\r\n// GlobalCameraLogger: attaches to the camera session and emits detailed logs\r\n// about video element, media stream, and peer connection state so logs are\r\n// visible even when navigating away from Calibrator.\r\nexport default function GlobalCameraLogger() {\r\n  const camera = useCameraSession()\r\n  const lastStateRef = useRef<any>({})\r\n  const listenersRef = useRef<any>({})\r\n\r\n  useEffect(() => {\r\n    function dumpState(prefix = '[GlobalCamera]') {\r\n      try {\r\n        const video = camera.getVideoElementRef()\r\n        const media = camera.getMediaStream()\r\n        const pc = camera.getPcRef && camera.getPcRef()\r\n        const ws = camera.getWsRef && camera.getWsRef()\r\n        console.log(prefix, {\r\n          isStreaming: camera.isStreaming,\r\n          mode: camera.mode,\r\n          showOverlay: camera.showOverlay,\r\n          hasVideoElement: !!video,\r\n          video: video ? { videoWidth: video.videoWidth, videoHeight: video.videoHeight, srcObject: !!video.srcObject } : null,\r\n          mediaTracks: media ? media.getTracks().map(t => ({ kind: t.kind, enabled: t.enabled, id: t.id })) : null,\r\n          pcState: pc ? pc.connectionState || pc.iceConnectionState : null,\r\n          wsState: ws ? (ws.readyState || 'unknown') : null\r\n        })\r\n      } catch (e) { console.warn('[GlobalCamera] dumpState failed', e) }\r\n    }\r\n\r\n    // Initial dump\r\n    dumpState('[GlobalCamera] INIT')\r\n\r\n    // Subscribe to Zustand changes by polling minimal differences (safe & simple)\r\n    let mounted = true\r\n    const interval = setInterval(() => {\r\n      if (!mounted) return\r\n      try {\r\n        const video = camera.getVideoElementRef()\r\n        const media = camera.getMediaStream()\r\n        const pc = camera.getPcRef && camera.getPcRef()\r\n        const snapshot = {\r\n          isStreaming: camera.isStreaming,\r\n          mode: camera.mode,\r\n          hasVideo: !!video,\r\n          videoW: video ? video.videoWidth : 0,\r\n          videoH: video ? video.videoHeight : 0,\r\n          tracks: media ? media.getTracks().length : 0,\r\n          pcState: pc ? pc.connectionState || pc.iceConnectionState : null\r\n        }\r\n        const prev = lastStateRef.current\r\n        // Shallow compare a few keys\r\n        if (\r\n          snapshot.isStreaming !== prev.isStreaming ||\r\n          snapshot.hasVideo !== prev.hasVideo ||\r\n          snapshot.videoW !== prev.videoW ||\r\n          snapshot.videoH !== prev.videoH ||\r\n          snapshot.tracks !== prev.tracks ||\r\n          snapshot.pcState !== prev.pcState ||\r\n          camera.showOverlay !== prev.showOverlay\r\n        ) {\r\n          lastStateRef.current = snapshot\r\n          dumpState('[GlobalCamera] CHANGE')\r\n        }\r\n      } catch (e) { console.warn('[GlobalCamera] poll failed', e) }\r\n    }, 750)\r\n\r\n    // Attach video element listeners when available to capture events like loadedmetadata/playing\r\n    function attachVideoListeners(v: HTMLVideoElement | null) {\r\n      try {\r\n        const prev = listenersRef.current.video\r\n        if (prev && prev.el === v) return\r\n        if (prev && prev.el) {\r\n          try { prev.el.removeEventListener('loadedmetadata', prev.loadedmetadata) } catch {}\r\n          try { prev.el.removeEventListener('playing', prev.playing) } catch {}\r\n          try { prev.el.removeEventListener('pause', prev.pause) } catch {}\r\n          try { prev.el.removeEventListener('ended', prev.ended) } catch {}\r\n        }\r\n        listenersRef.current.video = null\r\n        if (v) {\r\n          const loadedmetadata = () => console.log('[GlobalCamera] video loadedmetadata', { videoWidth: v.videoWidth, videoHeight: v.videoHeight })\r\n          const playing = () => {\r\n            console.log('[GlobalCamera] video playing', { paused: v.paused })\r\n            try { camera.setStreaming(true) } catch {}\r\n          }\r\n          const pause = () => {\r\n            console.log('[GlobalCamera] video pause')\r\n            try { camera.setStreaming(false) } catch {}\r\n          }\r\n          const ended = () => {\r\n            console.log('[GlobalCamera] video ended')\r\n            try { camera.setStreaming(false) } catch {}\r\n          }\r\n          v.addEventListener('loadedmetadata', loadedmetadata)\r\n          v.addEventListener('playing', playing)\r\n          v.addEventListener('pause', pause)\r\n          v.addEventListener('ended', ended)\r\n          listenersRef.current.video = { el: v, loadedmetadata, playing, pause, ended }\r\n        }\r\n      } catch (e) { console.warn('[GlobalCamera] attachVideoListeners failed', e) }\r\n    }\r\n\r\n    // Watch for PC state changes if RTCPeerConnection is present\r\n    function attachPc(pc: RTCPeerConnection | null) {\r\n      try {\r\n        const prev = listenersRef.current.pc\r\n        if (prev && prev.pc === pc) return\r\n        if (prev && prev.pc) {\r\n          try { prev.pc.removeEventListener('connectionstatechange', prev.connChange) } catch {}\r\n        }\r\n        listenersRef.current.pc = null\r\n        if (pc) {\r\n          const connChange = () => console.log('[GlobalCamera] pc state change', { connectionState: pc.connectionState, iceState: (pc as any).iceConnectionState })\r\n          pc.addEventListener('connectionstatechange', connChange)\r\n          listenersRef.current.pc = { pc, connChange }\r\n        }\r\n      } catch (e) { console.warn('[GlobalCamera] attachPc failed', e) }\r\n    }\r\n\r\n    // Periodically re-attach listeners if refs change\r\n    const attachInterval = setInterval(() => {\r\n      try {\r\n        attachVideoListeners(camera.getVideoElementRef())\r\n        attachPc(camera.getPcRef && camera.getPcRef())\r\n      } catch (e) {}\r\n    }, 1000)\r\n\r\n    return () => {\r\n      mounted = false\r\n      clearInterval(interval)\r\n      clearInterval(attachInterval)\r\n      // cleanup listeners\r\n      try {\r\n        const v = listenersRef.current.video\r\n        if (v && v.el) {\r\n          v.el.removeEventListener('loadedmetadata', v.loadedmetadata)\r\n          v.el.removeEventListener('playing', v.playing)\r\n        }\r\n      } catch (e) {}\r\n      try {\r\n        const p = listenersRef.current.pc\r\n        if (p && p.pc) p.pc.removeEventListener('connectionstatechange', p.connChange)\r\n      } catch (e) {}\r\n    }\r\n  }, [camera])\r\n\r\n  return null\r\n}\r\n","import { useEffect, useRef } from 'react'\r\nimport { useCameraSession } from '../store/cameraSession'\r\n\r\n/**\r\n * GlobalPhoneVideoSink\r\n * Keeps a hidden video element alive across navigation and feeds it the phone camera stream\r\n * so other components (overlay, badge) can draw frames even when Calibrator unmounts.\r\n */\r\nexport default function GlobalPhoneVideoSink() {\r\n  const camera = useCameraSession()\r\n  const vref = useRef<HTMLVideoElement | null>(null)\r\n  const lastStreamRef = useRef<MediaStream | null>(null)\r\n  const lastTimeRef = useRef<number>(0)\r\n  const stallSecondsRef = useRef<number>(0)\r\n  const lastReconnectAtRef = useRef<number>(0)\r\n  const attemptRef = useRef<number>(0)\r\n\r\n  // Ensure the global ref is registered for others to use\r\n  useEffect(() => {\r\n    if (vref.current) {\r\n      camera.setVideoElementRef(vref.current)\r\n    }\r\n  }, [camera])\r\n\r\n  // Apply the current stream and keep it playing\r\n  useEffect(() => {\r\n    let mounted = true\r\n\r\n    const apply = async () => {\r\n      if (!mounted) return\r\n      try {\r\n        const s = camera.getMediaStream()\r\n        const vid = vref.current\r\n        if (!vid || !s) return\r\n        if (lastStreamRef.current !== s || vid.srcObject !== s) {\r\n          vid.srcObject = s\r\n          lastStreamRef.current = s\r\n        }\r\n        vid.muted = true\r\n        ;(vid as any).playsInline = true\r\n        try { await vid.play() } catch {}\r\n      } catch {}\r\n    }\r\n\r\n    // Try immediately and then poll a bit to catch late streams\r\n    apply()\r\n    const t = setInterval(apply, 750)\r\n    return () => { mounted = false; clearInterval(t) }\r\n  }, [camera])\r\n\r\n  // Watchdog: if the video currentTime doesn't advance for >3s while streaming, request a reconnect with backoff\r\n  useEffect(() => {\r\n    const tick = () => {\r\n      const v = vref.current\r\n      const now = Date.now()\r\n      if (!v || !camera.isStreaming || camera.mode !== 'phone' || !v.srcObject) {\r\n        stallSecondsRef.current = 0\r\n        return\r\n      }\r\n      const ct = (v as HTMLVideoElement).currentTime || 0\r\n      if (!Number.isFinite(ct)) return\r\n      if (ct === lastTimeRef.current) {\r\n        stallSecondsRef.current += 1\r\n      } else {\r\n        stallSecondsRef.current = 0\r\n      }\r\n      lastTimeRef.current = ct\r\n      if (stallSecondsRef.current >= 3) {\r\n        const minBackoff = [3000, 6000, 10000][Math.min(attemptRef.current, 2)]\r\n        if (now - lastReconnectAtRef.current >= minBackoff) {\r\n          lastReconnectAtRef.current = now\r\n          attemptRef.current = Math.min(attemptRef.current + 1, 3)\r\n          try {\r\n            window.dispatchEvent(new CustomEvent('ndn:phone-camera-reconnect', { detail: { reason: 'stall', ts: now } }))\r\n            // Try to nudge playback locally as well\r\n            v.play().catch(()=>{})\r\n          } catch {}\r\n        }\r\n      } else if (stallSecondsRef.current === 0) {\r\n        // Reset attempts on healthy playback\r\n        attemptRef.current = 0\r\n      }\r\n    }\r\n    const id = setInterval(tick, 1000)\r\n    return () => clearInterval(id)\r\n  }, [camera])\r\n\r\n  // Keep dimensions tiny but visible so playback isn't throttled by display:none in some browsers\r\n  return (\r\n    <video\r\n      ref={vref}\r\n      style={{ position: 'fixed', width: 1, height: 1, left: -9999, top: -9999, opacity: 0 }}\r\n      muted\r\n      playsInline\r\n      aria-hidden\r\n    />\r\n  )\r\n}\r\n","import React, { useState } from 'react'\r\nimport ResizableModal from './ui/ResizableModal'\r\n\r\nexport default function Footer() {\r\n  const [show, setShow] = useState(false)\r\n  const year = new Date().getFullYear()\r\n  return (\r\n    <>\r\n      <div className=\"w-full text-center text-xs text-gray-500 py-2 select-none\">© {year} Nine Dart Nation — <button className=\"underline\" onClick={() => setShow(true)}>Legal Notice</button></div>\r\n      {show ? (\r\n        <ResizableModal storageKey=\"ndn:modal:legal\" className=\"w-[640px]\" defaultWidth={640} defaultHeight={420} minWidth={420} minHeight={220} initialFitHeight>\r\n          <div className=\"p-4 space-y-3\">\r\n            <div className=\"text-lg font-semibold\">Privacy & Copyright Notice</div>\r\n            <div className=\"text-sm\">⚠️ IMPORTANT LEGAL NOTICE</div>\r\n            <div className=\"text-sm\">Copyright Protection: All code, assets, and intellectual property in Nine Dart Nation are protected by copyright law. Unauthorized copying, modification, or distribution of this software is strictly prohibited.</div>\r\n            <div className=\"text-sm\">Legal Consequences: Any attempt to edit, reverse-engineer, or redistribute this code will result in immediate legal action, including but not limited to copyright infringement lawsuits and potential criminal charges.</div>\r\n            <div className=\"text-sm\">Privacy: Your personal data and gameplay information are protected. Any unauthorized access or data collection violates privacy laws and will be prosecuted to the full extent of the law.</div>\r\n            <div className=\"flex items-center gap-2 mt-3\">\r\n              <button className=\"btn\" onClick={() => setShow(false)}>Close</button>\r\n            </div>\r\n          </div>\r\n        </ResizableModal>\r\n      ) : null}\r\n    </>\r\n  )\r\n}\r\n","import { useEffect, useRef, useState } from 'react'\r\nimport { Sidebar, TabKey } from './components/Sidebar'\r\nimport Home from './components/Home'\r\nimport ScrollFade from './components/ScrollFade'\r\nimport Calibrator from './components/Calibrator'\r\nimport OfflinePlay from './components/OfflinePlay'\r\nimport Friends from './components/Friends'\r\nimport Toaster from './components/Toaster'\r\nimport AdminDashboard from './components/AdminDashboard'\r\nimport SettingsPanel from './components/SettingsPanel'\r\nimport Auth from './components/Auth'\r\nimport { ThemeProvider } from './components/ThemeContext'\r\nimport { useWS } from './components/WSProvider'\r\nimport StatusDot from './components/ui/StatusDot'\r\nimport { getRollingAvg, getAllTimeAvg } from './store/profileStats'\r\nimport { useUserSettings } from './store/userSettings'\r\nimport { useCalibration } from './store/calibration'\r\nimport './styles/premium.css'\r\nimport Scoreboard from './components/Scoreboard'\r\nimport CameraView from './components/CameraView'\r\nimport OnlinePlay from './components/OnlinePlay'\r\nimport MatchSettings from './components/MatchSettings'\r\nimport StatsPanel from './components/StatsPanel'\r\nimport Tournaments from './components/Tournaments'\r\nimport AdminAccess from './components/AdminAccess'\r\n// AdminAccess already imported above\r\nimport Drawer from './components/ui/Drawer'\r\nimport { getDominantColorFromImage, stringToColor } from './utils/color'\r\nimport OpsDashboard from './components/OpsDashboard'\r\nimport HelpAssistant from './components/HelpAssistant'\r\nimport GlobalCameraLogger from './components/GlobalCameraLogger'\r\nimport GlobalPhoneVideoSink from './components/GlobalPhoneVideoSink'\r\nimport CameraStatusBadge from './components/CameraStatusBadge'\r\nimport Footer from './components/Footer'\r\n\r\nexport default function App() {\r\n  const appRef = useRef<HTMLDivElement | null>(null);\r\n  const [avatar, setAvatar] = useState<string>('');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [httpsInfo, setHttpsInfo] = useState<{ https: boolean; port: number } | null>(null);\r\n  const ws = (() => { try { return useWS() } catch { return null } })()\r\n  const [tab, setTab] = useState<TabKey>('score')\r\n  const [isMobile, setIsMobile] = useState<boolean>(false)\r\n  const [navOpen, setNavOpen] = useState<boolean>(false)\r\n  const [user, setUser] = useState<any>(null)\r\n  const [allTimeAvg, setAllTimeAvg] = useState<number>(0)\r\n  const { avgMode } = useUserSettings()\r\n  const { H: calibH, locked: calibLocked, errorPx } = useCalibration()\r\n\r\n\r\n  // Restore user from token on mount\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('authToken');\r\n    if (token) {\r\n      // Validate token with server\r\n      const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n      fetch(`${API_URL}/api/auth/me`, {\r\n        headers: { 'Authorization': `Bearer ${token}` }\r\n      })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data?.user) {\r\n          setUser(data.user);\r\n          fetchSubscription(data.user);\r\n        } else {\r\n          // Token invalid, remove it\r\n          localStorage.removeItem('authToken');\r\n        }\r\n      })\r\n      .catch(() => {\r\n        // Network error, keep token for offline retry\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const onLogout = () => {\r\n      try {\r\n        localStorage.removeItem('mockUser');\r\n        localStorage.removeItem('authToken');\r\n      } catch {}\r\n      setUser(null);\r\n      setTab('score');\r\n    };\r\n    window.addEventListener('ndn:logout' as any, onLogout as any);\r\n    return () => window.removeEventListener('ndn:logout' as any, onLogout as any);\r\n  }, []);\r\n  // Refresh all-time avg when user changes or stats update\r\n  useEffect(() => {\r\n    if (!user?.username) return\r\n    const refresh = () => setAllTimeAvg(avgMode === '24h' ? getRollingAvg(user.username) : getAllTimeAvg(user.username))\r\n    refresh()\r\n    const onUpdate = () => refresh()\r\n    window.addEventListener('ndn:stats-updated', onUpdate as any)\r\n    return () => window.removeEventListener('ndn:stats-updated', onUpdate as any)\r\n  }, [user?.username, avgMode])\r\n\r\n  // Load avatar from localStorage when user changes\r\n  useEffect(() => {\r\n    if (!user?.username) {\r\n      setAvatar('');\r\n      return;\r\n    }\r\n    const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n    setAvatar(storedAvatar || '');\r\n  }, [user?.username])\r\n\r\n  // Listen for avatar updates from SettingsPanel\r\n  useEffect(() => {\r\n    const handleStorageChange = (e: StorageEvent) => {\r\n      if (e.key?.startsWith('ndn:bio:profilePhoto:') && user?.username && e.key.endsWith(user.username)) {\r\n        setAvatar(e.newValue || '');\r\n      }\r\n    };\r\n    const handleAvatarUpdate = (e: any) => {\r\n      // Check if this update is for the current user\r\n      if (e.detail?.username === user?.username) {\r\n        setAvatar(e.detail?.avatar || '');\r\n      }\r\n      // Also check localStorage as backup for any avatar update\r\n      if (user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        setAvatar(storedAvatar || '');\r\n      }\r\n    };\r\n    // Also check localStorage when window becomes visible (user switches tabs)\r\n    const handleVisibilityChange = () => {\r\n      if (!document.hidden && user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        setAvatar(storedAvatar || '');\r\n      }\r\n    };\r\n    \r\n    // Check localStorage every 2 seconds as a fallback\r\n    const checkAvatarInterval = setInterval(() => {\r\n      if (user?.username) {\r\n        const storedAvatar = localStorage.getItem(`ndn:bio:profilePhoto:${user.username}`);\r\n        if (storedAvatar && storedAvatar !== avatar) {\r\n          setAvatar(storedAvatar);\r\n        }\r\n      }\r\n    }, 2000);\r\n    \r\n    window.addEventListener('storage', handleStorageChange);\r\n    window.addEventListener('ndn:avatar-updated' as any, handleAvatarUpdate as any);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('ndn:avatar-updated' as any, handleAvatarUpdate as any);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      clearInterval(checkAvatarInterval);\r\n    };\r\n  }, [user?.username, avatar]);\r\n\r\n  // Handle payment success for username change\r\n  useEffect(() => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const paid = urlParams.get('paid');\r\n    const usernameChange = urlParams.get('username-change');\r\n    if (paid === '1' || paid === 'username-change' || usernameChange === 'free') {\r\n      const pendingUsername = localStorage.getItem('pendingUsernameChange');\r\n      if (pendingUsername && user?.email) {\r\n        // Call the change username API\r\n        const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n        fetch(`${API_URL}/api/change-username`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ email: user.email, newUsername: pendingUsername })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          if (data.ok) {\r\n            alert('Username changed successfully!');\r\n            localStorage.removeItem('pendingUsernameChange');\r\n            // Update user data and token\r\n            if (data.token) {\r\n              localStorage.setItem('authToken', data.token);\r\n            }\r\n            if (data.user) {\r\n              setUser(data.user);\r\n            }\r\n            // Clean up URL\r\n            window.history.replaceState({}, document.title, window.location.pathname);\r\n          } else {\r\n            alert('Failed to change username: ' + (data.error || 'Unknown error'));\r\n          }\r\n        })\r\n        .catch(() => {\r\n          alert('Network error while changing username');\r\n        });\r\n      }\r\n    }\r\n  }, [user?.email]);\r\n\r\n  // Handle payment success for premium subscription\r\n  useEffect(() => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const subscription = urlParams.get('subscription');\r\n    if (subscription === 'success' && user?.email) {\r\n      // Refresh user data to get updated subscription status\r\n      const API_URL = (import.meta as any).env?.VITE_API_URL || '';\r\n      fetch(`${API_URL}/api/auth/me`, {\r\n        headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }\r\n      })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data?.user) {\r\n          setUser(data.user);\r\n          alert('Premium subscription activated successfully!');\r\n          // Clean up URL\r\n          window.history.replaceState({}, document.title, window.location.pathname);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        alert('Subscription activated, but failed to refresh user data. Please refresh the page.');\r\n      });\r\n    }\r\n  }, [user?.email]);\r\n\r\n  // Detect mobile/tablet layout via comprehensive device detection\r\n  useEffect(() => {\r\n    const update = () => {\r\n      const width = window.innerWidth\r\n      const height = window.innerHeight\r\n      const pixelRatio = window.devicePixelRatio || 1\r\n\r\n      // Comprehensive mobile/tablet detection\r\n      const mqMobile = window.matchMedia('(max-width: 768px)').matches\r\n      const mqTablet = window.matchMedia('(max-width: 1024px) and (min-width: 769px)').matches\r\n      const uaMobile = /Mobi|Android|iPhone|iPad|iPod|Mobile|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent || '')\r\n      const uaTablet = /iPad|Android(?=.*\\bMobile\\b)|Tablet|PlayBook|Silk/i.test(navigator.userAgent || '')\r\n      const touchScreen = 'ontouchstart' in window || navigator.maxTouchPoints > 0\r\n      const smallScreen = width < 1025\r\n      const verySmallScreen = width < 769\r\n\r\n      // Determine device type\r\n      const isTablet = (mqTablet && touchScreen) || uaTablet || (width >= 769 && width <= 1024 && touchScreen)\r\n      const isMobile = mqMobile || uaMobile || verySmallScreen || (width < 769 && touchScreen)\r\n      const isMobileDevice = isMobile || isTablet\r\n\r\n      setIsMobile(isMobileDevice)\r\n    }\r\n    update()\r\n    window.addEventListener('resize', update)\r\n    window.addEventListener('orientationchange', update)\r\n\r\n    const mqMobile = window.matchMedia('(max-width: 768px)')\r\n    const mqTablet = window.matchMedia('(max-width: 1024px) and (min-width: 769px)')\r\n\r\n    try {\r\n      mqMobile.addEventListener('change', update)\r\n      mqTablet.addEventListener('change', update)\r\n    } catch {}\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', update)\r\n      window.removeEventListener('orientationchange', update)\r\n      try {\r\n        mqMobile.removeEventListener('change', update)\r\n        mqTablet.removeEventListener('change', update)\r\n      } catch {}\r\n    }\r\n  }, [])\r\n\r\n  // Global logout handler: return to sign-in screen and clear minimal local user context\r\n  useEffect(() => {\r\n    const onLogout = () => {\r\n      try {\r\n        // Clear any lightweight local flags (keep stats unless explicitly reset)\r\n        localStorage.removeItem('ndn:avatar')\r\n      } catch {}\r\n      setUser(null)\r\n      setTab('score')\r\n    }\r\n    window.addEventListener('ndn:logout' as any, onLogout as any)\r\n    return () => window.removeEventListener('ndn:logout' as any, onLogout as any)\r\n  }, [])\r\n\r\n  // Apply username changes from Settings globally and propagate via WS presence\r\n  useEffect(() => {\r\n    const onName = (e: any) => {\r\n      try {\r\n        const next = String(e?.detail?.username || '').trim()\r\n        if (!next) return\r\n        setUser((prev: any) => {\r\n          const u = prev ? { ...prev, username: next } : prev\r\n          return u\r\n        })\r\n        // Recompute name color on next effect pass based on new username/avatar\r\n        // Send presence update so friends/lobby reflect the new name\r\n        try {\r\n          const email = (user?.email || '').toLowerCase()\r\n          if (ws && next && email) ws.send({ type: 'presence', username: next, email })\r\n        } catch {}\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:username-changed' as any, onName as any)\r\n    return () => window.removeEventListener('ndn:username-changed' as any, onName as any)\r\n  }, [ws, user?.email])\r\n\r\n  // Handle tab changes from Home component quick access pills\r\n  useEffect(() => {\r\n    const onTabChange = (e: any) => {\r\n      try {\r\n        const tab = String(e?.detail?.tab || '').trim()\r\n        if (tab && ['score', 'offline', 'online', 'stats', 'settings', 'admin', 'tournaments', 'friends'].includes(tab)) {\r\n          setTab(tab as TabKey)\r\n        }\r\n      } catch {}\r\n    }\r\n    window.addEventListener('ndn:change-tab' as any, onTabChange as any)\r\n    return () => window.removeEventListener('ndn:change-tab' as any, onTabChange as any)\r\n  }, [])\r\n\r\n  async function fetchSubscription(u: any) {\r\n    try {\r\n      const q = u?.email ? `?email=${encodeURIComponent(u.email)}` : ''\r\n      const res = await fetch('/api/subscription' + q);\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      setUser({ ...u, fullAccess: !!data?.fullAccess });\r\n    } catch {}\r\n  }\r\n\r\n  if (!user) {\r\n    return <Auth onAuth={(u:any) => { setUser(u); fetchSubscription(u); }} />;\r\n  }\r\n  const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username||'NDN')}&background=8F43EE&color=fff&bold=true&rounded=true&size=64`\r\n  return (\r\n    <ThemeProvider>\r\n  <div ref={appRef} className={`${user?.fullAccess ? 'premium-body' : ''} h-screen overflow-hidden pt-1 pb-0 px-1 xs:pt-2 xs:pb-0 xs:px-2 sm:pt-3 sm:pb-0 sm:px-3 md:pt-4 md:pb-0 md:px-4`}>\r\n        <Toaster />\r\n  <div className=\"max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[auto,1fr] gap-2 xs:gap-3 sm:gap-4 h-full overflow-hidden\">\r\n          {/* Desktop sidebar; hidden on mobile/tablet */}\r\n          {!isMobile && (\r\n            <div className=\"relative hidden lg:block\" style={{ width: 240 }}>\r\n              <Sidebar active={tab} onChange={(k)=>{ setTab(k); }} user={user} />\r\n            </div>\r\n          )}\r\n          {/* Wrap header + scroller in a column so header stays static and only content scrolls below it */}\r\n          <div className=\"flex flex-col h-full overflow-hidden\">\r\n            <div className=\"pt-1 xs:pt-2\">\r\n            <header id=\"ndn-header\" className={`header glass flex-col xs:flex-col sm:flex-row gap-2 xs:gap-2 sm:gap-3`}>\r\n              {/* Left: Brand */}\r\n              <div className=\"flex items-center gap-2 order-1\">\r\n                <h1\r\n                  className=\"text-lg xs:text-xl sm:text-xl md:text-2xl font-bold text-brand-700 whitespace-nowrap cursor-pointer select-none\"\r\n                  onClick={() => { setTab('score') }}\r\n                  title={'Go Home'}\r\n                >\r\n                  NINE-DART-NATION 🎯\r\n                </h1>\r\n              </div>\r\n              {/* Middle: Welcome band (full width on mobile) */}\r\n              <div className=\"order-3 xs:order-3 sm:order-2 w-full sm:w-auto flex-1 flex flex-col items-center justify-center text-center sm:text-left !text-black\">\r\n                <span className=\"text-sm xs:text-base sm:text-base md:text-lg font-semibold flex items-center gap-2 max-w-full truncate !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>\r\n                  <span className=\"hidden xs:inline !text-black\">Welcome</span>\r\n                  <img src={avatar || fallbackAvatar} alt=\"avatar\" className=\"w-5 h-5 xs:w-6 xs:h-6 sm:w-6 sm:h-6 md:w-7 md:h-7 rounded-full ring-2 ring-white/20\" />\r\n                  <span className=\"truncate !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>{user.username}🎯</span>\r\n                </span>\r\n                <span className=\"hidden xs:inline text-xs xs:text-xs sm:text-xs md:text-sm !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>All-time 3-dart avg: <span className=\"font-semibold !text-black\" style={{ color: '#000000', WebkitTextFillColor: '#000000' }}>{allTimeAvg.toFixed(2)}</span></span>\r\n                {isMobile && (\r\n                  <button\r\n                    className=\"btn px-3 py-1 xs:px-3 xs:py-1 sm:px-3 sm:py-1 mt-1 text-sm xs:text-sm\"\r\n                    aria-label=\"Open navigation\"\r\n                    onClick={()=> setNavOpen(true)}\r\n                  >☰ Menu</button>\r\n                )}\r\n              </div>\r\n              {/* Calibration Status - visible across all tabs */}\r\n              {calibLocked && calibH && (\r\n                <button\r\n                  onClick={() => setTab('calibrate')}\r\n                  className=\"order-4 sm:order-4 md:order-3 px-3 py-1 text-xs sm:text-sm rounded-full bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-100 border border-emerald-400/50 transition-colors\"\r\n                  title=\"Click to adjust calibration\"\r\n                >\r\n                  ✓ Calibration Active {errorPx != null && `• ${errorPx.toFixed(1)}px`}\r\n                </button>\r\n              )}\r\n              {/* Right: Status + Actions */}\r\n              <div className=\"order-2 md:order-3 ml-0 md:ml-auto flex items-center gap-2 flex-wrap\">\r\n                <button\r\n                  className=\"px-3 py-1 text-sm rounded-full bg-white/5 hover:bg-white/10 border border-white/10\"\r\n                  onClick={() => {\r\n                    const el = appRef.current\r\n                    if (!el) return\r\n                    if (!document.fullscreenElement) el.requestFullscreen().catch(()=>{})\r\n                    else document.exitFullscreen().catch(()=>{})\r\n                  }}\r\n                  title={isFullscreen ? 'Exit Full Screen' : 'Enter Full Screen'}\r\n                >{isFullscreen ? 'Exit Full Screen' : 'Full Screen'}</button>\r\n                {tab === 'online' && (\r\n                  <button\r\n                    className=\"text-[10px] md:text-xs px-3 py-1 rounded-full bg-indigo-500/25 text-indigo-100 border border-indigo-400/40 hover:bg-indigo-500/40\"\r\n                    title=\"Open a simulated online match\"\r\n                    onClick={() => {\r\n                      setTimeout(() => {\r\n                        try { window.dispatchEvent(new CustomEvent('ndn:online-match-demo', { detail: { game: 'X01', start: 501 } })) } catch {}\r\n                      }, 40)\r\n                    }}\r\n                  >ONLINE DEMO</button>\r\n                )}\r\n                {/* Camera status badge */}\r\n                <CameraStatusBadge />\r\n                {ws ? (\r\n                  <span className=\"ml-0 md:ml-2\"><StatusDot status={ws.status} /></span>\r\n                ) : null}\r\n                {/* Protocol pill removed per request: keep green connected badge only */}\r\n              </div>\r\n            </header>\r\n            </div>\r\n            {/* Mobile drawer navigation */}\r\n            {isMobile && (\r\n              <MobileNav\r\n                open={navOpen}\r\n                onClose={()=> setNavOpen(false)}\r\n                active={tab}\r\n                onChange={(k)=>{ setTab(k); setNavOpen(false) }}\r\n                user={user}\r\n              />\r\n            )}\r\n            <main id=\"ndn-main-scroll\" className=\"space-y-4 flex-1 overflow-y-auto pr-1 flex flex-col\">\r\n            {tab === 'settings' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <SettingsPanel user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'score' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <Home user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'online' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <OnlinePlay user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'offline' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <OfflinePlay user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {/* Always keep Calibrator mounted to preserve phone camera stream, but hide when not active */}\r\n            <div className={tab === 'calibrate' ? '' : 'hidden'}>\r\n              <ScrollFade>\r\n                <Calibrator />\r\n              </ScrollFade>\r\n            </div>\r\n            {tab === 'friends' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <Friends user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'stats' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <StatsPanel user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'tournaments' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <Tournaments user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'admin' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <div className=\"flex-1 min-h-0 space-y-6\">\r\n                  <AdminDashboard user={user} />\r\n                  <OpsDashboard user={user} />\r\n                </div>\r\n              </ScrollFade>\r\n            )}\r\n            {tab === 'fullaccess' && (\r\n              <ScrollFade className=\"flex-1 min-h-0\">\r\n                <AdminAccess user={user} />\r\n              </ScrollFade>\r\n            )}\r\n            </main>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n  {/* Floating Help Assistant - Always visible */}\r\n  <HelpAssistant />\r\n  {/* App footer with legal notice */}\r\n  <Footer />\r\n  {/* Global camera logger: logs stream lifecycle and video/pc events across site */}\r\n  <GlobalCameraLogger />\r\n      {/* Global phone camera overlay - visibility controlled by store */}\r\n  {/* Keep a hidden global video element alive across navigation */}\r\n  <GlobalPhoneVideoSink />\r\n    </ThemeProvider>\r\n  )\r\n}\r\n\r\n// Lightweight mobile drawer that reuses the same Sidebar\r\nfunction MobileNav({ open, onClose, active, onChange, user }: { open: boolean; onClose: () => void; active: TabKey; onChange: (k: TabKey)=>void; user: any }) {\r\n  return (\r\n    <Drawer open={open} onClose={onClose} width={320} side=\"left\" title=\"Navigate\">\r\n      <div className=\"mt-2\">\r\n        <Sidebar active={active} onChange={onChange} user={user} className=\"flex relative static max-h-[80vh] w-full\" />\r\n      </div>\r\n    </Drawer>\r\n  )\r\n}\r\n","import { useEffect, useState } from 'react'\r\n\r\nfunction validatePassword(password: string) {\r\n  return password.length >= 10 && /\\d/.test(password) && /[^A-Za-z0-9]/.test(password)\r\n}\r\n\r\nexport default function ResetPassword() {\r\n  const [token, setToken] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [confirm, setConfirm] = useState('')\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState('')\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const sp = new URLSearchParams(window.location.search)\r\n      const t = sp.get('token') || ''\r\n      setToken(t)\r\n    } catch {}\r\n  }, [])\r\n\r\n  async function onSubmit(e: any) {\r\n    e.preventDefault()\r\n    setError(''); setSuccess('')\r\n    if (!token) { setError('Missing or invalid reset token.'); return }\r\n    if (!password || password !== confirm) { setError('Passwords do not match.'); return }\r\n    if (!validatePassword(password)) { setError('Password must be at least 10 chars and include a number and symbol.'); return }\r\n    try {\r\n      const r = await fetch('/api/auth/confirm-reset', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ token, newPassword: password }) })\r\n      const j = await r.json()\r\n      if (!j?.ok) throw new Error(j?.error || 'Reset failed')\r\n      setSuccess('Password changed. You can now sign in.')\r\n    } catch (e: any) {\r\n      setError(e?.message || 'Reset failed')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center relative overflow-hidden\">\r\n      <div className=\"background-animated\" />\r\n      <div className=\"relative z-10 w-full max-w-lg mx-auto p-4\">\r\n        <form className=\"card w-full space-y-4\" onSubmit={onSubmit}>\r\n          <div className=\"flex flex-col items-center justify-center gap-2 mb-2 text-center\">\r\n            <h1 className=\"logo text-center\">Reset your password</h1>\r\n          </div>\r\n          {!token && (\r\n            <div className=\"text-red-400\">This reset link is missing a token. Please use the link from your email.</div>\r\n          )}\r\n          <input className=\"input w-full\" type=\"password\" placeholder=\"New password\" value={password} onChange={e=>setPassword(e.target.value)} required />\r\n          <input className=\"input w-full\" type=\"password\" placeholder=\"Confirm password\" value={confirm} onChange={e=>setConfirm(e.target.value)} required />\r\n          {error && <div className=\"text-red-400 font-semibold text-sm\">{error}</div>}\r\n          {success && <div className=\"text-emerald-400 font-semibold text-sm\">{success}</div>}\r\n          <button className=\"btn w-full\" type=\"submit\" disabled={!token}>Change Password</button>\r\n          <a className=\"underline text-sm text-center\" href=\"/\">Back to sign in</a>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { Component, type ReactNode } from 'react'\r\n\r\nexport default class ErrorBoundary extends Component<{\r\n  children: ReactNode\r\n}, { hasError: boolean; message?: string }>{\r\n  constructor(props: any) {\r\n    super(props)\r\n    this.state = { hasError: false }\r\n  }\r\n  static getDerivedStateFromError(err: any) {\r\n    return { hasError: true, message: String(err?.message || err) }\r\n  }\r\n  componentDidCatch(error: any, info: any) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[ErrorBoundary]', error, info)\r\n  }\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center p-6\">\r\n          <div className=\"card max-w-lg w-full text-center\">\r\n            <h2 className=\"text-2xl font-bold mb-2\">Something went wrong</h2>\r\n            <p className=\"opacity-80 mb-4\">Please refresh the page. If this persists, let us know.</p>\r\n            {this.state.message && (\r\n              <pre className=\"text-xs bg-black/40 rounded p-2 overflow-auto text-left\">{this.state.message}</pre>\r\n            )}\r\n            <button className=\"btn mt-4\" onClick={() => window.location.reload()}>Reload</button>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n    return this.props.children as any\r\n  }\r\n}\r\n","import { StrictMode } from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport './index.css'\r\nimport App from './App'\r\nimport ResetPassword from './components/ResetPassword'\r\nimport { WSProvider } from './components/WSProvider'\r\nimport ErrorBoundary from './components/ErrorBoundary'\r\nimport { installApiInterceptor } from './utils/api'\r\n\r\n// In some hosting setups, third-party or legacy code may expect a global React.\r\n// This ensures `React` is available at runtime to prevent 'React is not defined' errors.\r\ntry { (window as any).React = (window as any).React || {} } catch {}\r\n\r\ninstallApiInterceptor()\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <StrictMode>\r\n    <ErrorBoundary>\r\n      <WSProvider>\r\n        <Root />\r\n      </WSProvider>\r\n    </ErrorBoundary>\r\n  </StrictMode>,\r\n)\r\n\r\nfunction Root() {\r\n  const path = window.location.pathname\r\n  if (path === '/reset') return <ResetPassword />\r\n  return <App />\r\n}\r\n\r\n"],"names":["f","require$$0","k","l","m","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","KEY","user","getWeekId","date","dayNum","yearStart","weekNo","week","getOnlineUsage","raw","u","currentWeek","setOnlineUsage","usage","incOnlineUsage","cap","next","getFreeRemaining","LS_KEY","getCache","setCache","email","v","fetchIsAdmin","owner","__vite_import_meta_env__","force","hit","useIsAdmin","isAdmin","setIsAdmin","useState","useEffect","on","BASE_PRICE_GBP","FX","formatPriceInCurrency","currency","gbpAmount","cur","rate","val","getUserCurrency","parts","DISCORD_INVITE_URL","cachedBaseUrl","computeApiBase","envUrl","protocol","host","hostname","sameOrigin","normalizePath","path","base","cleanPath","resolveApiUrl","apiFetch","init","url","installApiInterceptor","anyWindow","originalFetch","input","reqUrl","cloned","href","err","getTabs","baseTabs","LayoutDashboard","Users","Trophy","Camera","Settings","PoundSterling","Sidebar","active","onChange","className","tabs","t","idx","adminTab","showDiscord","setShowDiscord","showNDNDiscord","setShowNDNDiscord","freeLeft","notifications","setNotifications","fetchNotifications","requestsRes","messagesRes","requests","unreadMessages","interval","onKey","key","label","Icon","jsxs","jsx","Lock","MessageCircle","createPortal","createStoreImpl","createState","state","listeners","setState","partial","replace","nextState","previousState","listener","getState","api","initialState","createStore","React","is","x","y","objectIs","useLayoutEffect","useDebugValue","useSyncExternalStore$2","subscribe","getSnapshot","value","_useState","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","nextValue","useSyncExternalStore$1","shim","useSyncExternalStoreShim_production","shimModule","require$$1","useSyncExternalStore","useRef","useMemo","withSelector_production","getServerSnapshot","selector","isEqual","instRef","memoizedSelector","nextSnapshot","hasMemo","memoizedSnapshot","currentSelection","memoizedSelection","nextSelection","maybeGetServerSnapshot","withSelectorModule","ReactExports","useSyncExternalStoreWithSelector","useSyncExternalStoreExports","didWarnAboutEqualityFn","identity","arg","useStore","equalityFn","slice","createImpl","useBoundStore","create","nextId","useToastStore","set","message","opts","s","id","useToast","formatAvg","n","keyFor","name","keySeriesFor","getAllTime","parsed","getAllTimeAvg","darts","scored","getAllTimeFirstNineAvg","fnDarts","fnScored","keyGameModes","getGameModeStats","allModeKeys","obj","setGameModeStats","stats","bumpGameMode","mode","won","current","entry","getSeries","arr","setSeries","entries","pruneOld","maxAgeMs","now","addSample","when","list","getRollingAvg","windowMs","getRollingFirstNineAvg","getMonthlyAvg3","windowed","matchOnly","use","getMonthlyFirstNineAvg","load","j","save","prev","useUserSettings","get","vol","cfg","size","goTab","tab","API_URL","Home","showLegal","setShowLegal","showHowTo","setShowHowTo","fact","setFact","lastOffline","toast","facts","all","isPremium","GRID","Row","left","right","lock","data","ScrollFade","children","style","ref","raf","updateClip","wrapper","header","scroller","scrollTop","headerH","overlap","mask","onScrollOrResize","DartLoader","calibrationComplete","showTick","setShowTick","fade","setFade","canPromise","toSJISFunction","CODEWORDS_COUNT","utils","version","digit","kanji","exports","fromString","string","level","defaultValue","BitBuffer","index","bufIndex","num","length","i","bit","bitBuffer","BitMatrix","row","col","reserved","bitMatrix","getSymbolSize","posCount","intervals","positions","coords","pos","posLength","FINDER_PATTERN_SIZE","finderPattern","PenaltyScores","points","sameCountCol","sameCountRow","lastCol","lastRow","module","last","bitsCol","bitsRow","darkCount","modulesCount","getMaskAt","maskPattern","pattern","setupFormatFunc","numPatterns","bestPattern","lowerPenalty","penalty","ECLevel","EC_BLOCKS_TABLE","EC_CODEWORDS_TABLE","errorCorrectionCode","errorCorrectionLevel","EXP_TABLE","LOG_TABLE","galoisField","GF","p1","p2","coeff","divident","divisor","result","offset","degree","poly","Polynomial","ReedSolomonEncoder","paddedData","remainder","start","buff","reedSolomonEncoder","versionCheck","numeric","alphanumeric","byte","regex","TEST_KANJI","TEST_NUMERIC","TEST_ALPHANUMERIC","str","VersionCheck","Regex","dataStr","Utils","ECCode","require$$2","Mode","require$$3","require$$4","G18","G18_BCH","getBestVersionForDataLength","currentVersion","getReservedBitsCount","getTotalBitsFromDataArray","segments","totalBits","reservedBits","getBestVersionForMixedData","totalCodewords","ecTotalCodewords","dataTotalCodewordsBits","usableBits","seg","ecl","G15","G15_MASK","G15_BCH","formatInfo","NumericData","group","remainingNum","numericData","ALPHA_NUM_CHARS","AlphanumericData","alphanumericData","ByteData","byteData","KanjiData","kanjiData","dijkstra","graph","predecessors","costs","open","closest","cost_of_s_to_u","adjacent_nodes","cost_of_e","cost_of_s_to_u_plus_cost_of_e","cost_of_s_to_v","first_visit","msg","nodes","T","cost","item","require$$5","require$$6","require$$7","getStringByteLength","getSegments","getSegmentsFromString","numSegs","alphaNumSegs","byteSegs","kanjiSegs","s1","s2","getSegmentBitsLength","mergeSegments","segs","acc","curr","prevSeg","buildNodes","buildGraph","table","prevNodeIds","nodeGroup","currentNodeIds","node","prevNodeId","buildSingleSegment","modesHint","bestMode","array","optimizedSegs","AlignmentPattern","FinderPattern","MaskPattern","require$$8","Version","require$$9","FormatInfo","require$$10","require$$11","Segments","require$$12","setupFinderPattern","matrix","r","setupTimingPattern","setupAlignmentPattern","setupVersionInfo","bits","mod","setupFormatInfo","setupData","inc","bitIndex","byteIndex","dark","createData","buffer","remainingByte","createCodewords","dataTotalCodewords","ecTotalBlocks","blocksInGroup2","blocksInGroup1","totalCodewordsInGroup1","dataCodewordsInGroup1","dataCodewordsInGroup2","ecCount","rs","dcData","ecData","maxDataSize","dataSize","createSymbol","estimatedVersion","rawSegments","bestVersion","dataBits","moduleCount","modules","qrcode","options","hex2rgba","hex","hexCode","hexValue","margin","width","scale","qrSize","imgData","qr","symbolSize","scaledMargin","palette","posDst","pxColor","iSrc","jSrc","clearCanvas","ctx","canvas","getCanvasElement","qrData","canvasEl","image","type","rendererOpts","getColorAttrib","color","attrib","alpha","svgCmd","cmd","qrToPath","moveBy","newRow","lineLength","svgTag","cb","qrcodesize","bg","viewBox","QRCode","CanvasRenderer","SvgRenderer","renderCanvas","renderFunc","text","args","argsNum","isLastArgCb","resolve","reject","browser","_","loadImage","src","img","composeQrWithLogo","qrDataUrl","qrImg","logoImg","w","cx","cy","logoSize","shape","pad","bx","by","bw","bh","radius","makeQrDataUrlWithLogo","logo","createJSONStorage","getStorage","storage","_a","parse","str2","newValue","toThenable","fn","onFulfilled","_onRejected","_onFulfilled","onRejected","oldImpl","config","baseOptions","persistedState","currentState","hasHydrated","hydrationListeners","finishHydrationListeners","thenableSerialize","setItem","errorInSync","thenable","serializedValue","savedSetState","configResult","stateFromStorage","hydrate","postRehydrationCallback","storageValue","deserializedStorageValue","migratedState","_a2","newOptions","newImpl","_b","migrationResult","migrated","persistImpl","persist","useCalibration","error","legacy","videoElementRefHolder","mediaStreamRefHolder","pcRefHolder","wsRefHolder","useCameraSession","streaming","code","time","paired","stream","pc","ws","BoardRadii","SectorOrder","applyHomography","H","nx","ny","scaleHomography","sx","sy","invertHomography","A","B","C","D","E","F","G","Hh","det","computeHomographyDLT","dst","X","Y","solveLeastSquares","AtA","Atb","gaussianSolve","M","maxRow","tmp","canonicalRimTargets","doubleR","sampleRing","steps","pts","theta","rmsError","e2","dx","dy","imageToBoard","H_boardToImage","pImg","inv","scoreAtBoardPoint","deg","sector","drawPolyline","drawCross","clamp","lo","hi","sobelAtGray","gx","gy","xi","gray","refinePointSobel","best","mag","CV","height","imageSrc","imageDst","len","threshold","kernelSize","hist","sum","sumB","wB","wF","max","mu","between","heightMinus1","widthMinus1","mult","shift","stack","stackStart","imageMean","kernel","horizontal","limit","center","sigma","scale2X","binary","contours","deltas","pix","nbd","outer","hole","point","contour","pos1","pos3","pos4","s_end","epsilon","right_slice","pt","start_pt","end_pt","dist","max_dist","le_eps","warpSize","sx1","sx2","dx1","dx2","sy1","sy2","dy1","dy2","p3","p4","rq","sq","px","py","den","orientation","convex","cur_pt","prev_pt","dxdy0","dydx0","dx0","dy0","min","square","span","nz","posSrc","cv","AR","corners","minSize","minLength","candidates","swap","minDist","notTooNear","markers","candidate","marker","minZero","rotations","distances","pair","ids","minSum","rotation","aruco","SVD","flag","its","jj","nm","anorm","z","rv1","at","bt","ct","svd","POS","modelSize","focalLength","half","np","vectors","imagePoints","posRotation1","posRotation2","posTranslation","rotation1","rotation2","translation1","translation2","error1","error2","valid1","valid2","translation","imageVectors","i0","j0","ivec","jvec","row1","row2","row3","i0i0","j0j0","i0j0","delta","lambda","zmin","zi","posRotation","oldSopImagePoints","sopImagePoints","converged","iteration","oldImageDifference","imageDifference","factor","move","projection","errorvec","euclidean","pixels","maximum","wmax","cn","posit1","Vec3","Mat3","eps","yi","xs","ys","ij","inorm","jnorm","temp","prevError","v1","v2","v3","v4","modeled","ia1","ia2","ia3","ia4","ma1","ma2","ma3","ma4","x1","y1","x2","y2","vector","posit2","jsAruco","MARKER_TARGETS","detector","ensureDetector","centerFromCorners","corner","count","detectMarkersFromImage","assignments","found","missing","detectMarkersFromCanvas","tryDetect","imageData","off","octx","range","yn","ROW_PATTERNS","markerIdToMatrix","rows","bit3","bit1","findDartboardRings","edges","pidx","bestCenter","bestScore","ringCount","ringStrength","testRadii","testR","strength","pixelCount","edge","refinedCx","refinedCy","maxStrength","confidence","knownR","expectedPixelR","detectBoard","centerX","centerY","detection","detected","calibrationPoints","canonicalSrc","homography","errorPx","errorConfidence","refineRingDetection","expectedRatios","actualRatios","ratioError","ratioCount","expected","actual","avgRatioError","adjustedConfidence","discoverNetworkDevices","devices","localIPs","getLocalIPs","localIP","scanResults","scanNetwork","device","probeDevice","ips","offer","timeout","event","ipMatch","ip","isPrivateIP","ports","results","baseIP","promises","port","checkPort","portIndex","ipIndex","response","endpoints","endpoint","contentType","discoverUSBDevices","probeUSBDevice","requestUSBDevice","reader","done","connectToNetworkDevice","streamUrl","video","drawFrame","connectToUSBDevice","Calibrator","videoRef","canvasRef","overlayRef","fileInputRef","cameraPerm","setCameraPerm","videoDevices","setVideoDevices","selectedDeviceId","setSelectedDeviceId","setStreaming","videoPlayBlocked","setVideoPlayBlocked","phase","setPhase","setMode","dstPoints","setDstPoints","snapshotSet","setSnapshotSet","frameSize","setFrameSize","zoom","setZoom","mobileLandingOverride","setMobileLandingOverride","isMobileDevice","setIsMobileDevice","setCalibration","reset","locked","cameraSession","calibrationGuide","setCalibrationGuide","preferredCameraId","cameraEnabled","setCameraEnabled","preferredCameraLocked","setPreferredCameraLocked","setPreferredCamera","setDetected","liveDetect","setLiveDetect","setConfidence","markerResult","setMarkerResult","verificationResults","setVerificationResults","useCallback","cols","cellW","cellH","pairCode","setPairCode","pairCodeRef","setWs","pcRef","pendingIceCandidatesRef","expiresAt","setExpiresAt","setNow","setPaired","updatePairCode","setQrDataUrl","lanHost","setLanHost","httpsInfo","setHttpsInfo","showTips","setShowTips","wifiDevices","setWifiDevices","discoveringWifi","setDiscoveringWifi","copyFeedback","setCopyFeedback","copyTimeoutRef","mobileUrl","useHttps","mobileLandingLink","coarseQuery","detect","uaMobile","coarse","narrow","logoPath","mounted","testCamera","deviceId","constraints","ttl","copyValue","textarea","handleReconnectRequest","stopCamera","startPhonePairing","ensureWS","normalizedEnv","socket","lockSelectionForPairing","ev","codeForSession","imgSize","payload","peer","inbound","pending","startWifiConnection","connectToWifiDevice","startCamera","playErr","autoRevert","regenerateCode","triggerUpload","openMarkerSheet","markerSheetUrl","captureFrame","autoDetectRings","drawOverlay","currentPoints","HH","o","Huse","rings","ringColor","ringWidth","drawCircle","targets","ax","ay","onClickOverlay","el","rect","cssX","cssY","scaleX","scaleY","compute","Hcalc","runVerification","tests","imgP","detectedBoard","match","dw","dh","tctx","d0","f0","g0","h0","maxMag","cx0","cy0","rMin","rMax","stepC","stepR","samples","ang","OCX","OCY","OR","radialScore","rPx","rScaled","ratios","refineAround","expectedR","pctWindow","bestR","bestS","dOuter","dInner","tOuter","tInner","bOuter","bInner","totalEdge","norm","conf","adjustedConf","autoLock","autoCalibrate","boardDetection","shouldLock","confidenceLevel","detectMarkers","missingMsg","foundMsg","fullMsg","imageSize","tick","bodyStr","token","DevicePicker","preferredCameraLabel","setDevices","localDevicesSnapshot","setLocalDevicesSnapshot","setErr","dropdownOpen","setDropdownOpen","dropdownRef","ignoreCloseUntilRef","suspendDocHandlerRef","dropdownPortal","enumerate","cams","handleClickOutside","tgt","clickedInsideMain","clickedInsidePortal","selectedDevice","selectedLabel","localSelectedLabel","setLocalSelectedLabel","preferredCameraUnavailable","linkForMobile","doubles","dVal","tag","prefsDoubleScore","fav","suggestCheckouts","remaining","favoriteDouble","hardcoded","target","routes","sayScore","voiceName","synth","isCheckout","GAME_CALIBRATION_REQUIREMENTS","getCalibrationConfidenceForGame","gameMode","req","excess","isCalibrationSuitableForGame","getCalibrationQualityText","getRecalibrationRecommendation","GameCalibrationStatus","compact","onRecalibrate","suitable","quality","recommendation","requirement","AlertTriangle","bgColor","textColor","icon","CheckCircle","AlertCircle","Zap","CameraTile","autoStart","scaleOverride","aspect","fill","setPc","saved","usbDevices","setUsbDevices","discoveringUsb","setDiscoveringUsb","autoscoreProvider","fallbackClass","fallbackStyle","ignore","stop","apply","startUsbConnection","newDevice","connectToUsbDevice","proto","isLocalhost","isRenderHost","renderWS","stopAll","CameraFrame","props","cameraScale","storedAspect","globalFitMode","effectiveFitMode","clamped","aspectChoice","shouldMaintainAspect","aspectClass","containerClass","containerStyle","viewportClass","commonVideoProps","videoElement","baseVideoClass","Fragment","useAudit","visitTotal","meta","recent","totals","bm","updated","calcThreeDartAvg","leg","finishedLegStats","avg","isCompleted","updatePlayerEndOfGameStats","player","avgs","bestNine","bestCheckout","st","useMatch","playerNames","startingScore","roomId","score","preRem","postRem","bust","finish","checkoutScore","newState","scoreFromImagePoint","pBoard","DartDetector","frame","diff","sum2","cnt","isHighlight","maxc","minc","satApprox","isHi","var_","dynamicThresh","visited","bestArea","bestIdxs","idxs","area","qh","nbs","nb","minX","minY","maxX","maxY","meanX","meanY","cxx","cyy","cxy","trace","l1","vx","vy","vlen","dxc","dyc","outward","rlen","rx","ry","cosAng","maxT","tipX","tipY","dxr","dyr","minR2","bboxW","bboxH","bboxArea","radial","l2","yy","xx","tip","close","out","parseExternalDart","ring","normalizeRing","finalizeFromValue","sec","mul","inner","subscribeExternalWS","onDart","alive","lastSig","lastSigAt","DEDUP_WINDOW_MS","seenIds","seenSet","considerForward","pid","old","sig","connect","ResizablePanel","storageKey","defaultWidth","defaultHeight","minWidth","minHeight","maxWidth","maxHeight","autoFill","setSize","startRef","containerRef","onReset","beginResize","dir","onMove","endResize","ResizableModal","fullScreen","initialFitHeight","parent","cs","padTop","padBottom","parentInner","effMaxH","baseClass","useHeatmapStore","usePendingVisit","total","useMatchControl","endsAt","CameraView","onVisitCommitted","showToolbar","onAutoDart","immediateAutoCommit","hideInlinePanels","scoringMode","onGenericDart","onGenericReplace","x01DoubleInOverride","autoscoreWsUrl","cameraAspect","cameraFitMode","manualOnly","availableCameras","setAvailableCameras","cameraStarting","setCameraStarting","snapshotUrl","setSnapshotUrl","resetCalibration","_hydrated","lastAutoScore","setLastAutoScore","manualScore","setManualScore","lastAutoValue","setLastAutoValue","lastAutoRing","setLastAutoRing","pendingDarts","setPendingDarts","pendingScore","setPendingScore","pendingEntries","setPendingEntries","pendingPreOpenDarts","setPendingPreOpenDarts","pendingDartsAtDouble","setPendingDartsAtDouble","x01DoubleInSetting","x01DoubleIn","openedById","setOpenedById","matchState","currentPlayerId","isOpened","setOpened","setVisit","resetPendingVisit","addVisit","endLeg","addHeatSample","quickSelAuto","setQuickSelAuto","quickSelManual","setQuickSelManual","nonRegCount","setNonRegCount","showRecalModal","setShowRecalModal","hadRecentAuto","setHadRecentAuto","pulseManualPill","setPulseManualPill","pulseTimeoutRef","activeTab","setActiveTab","showManualModal","setShowManualModal","showAutoModal","setShowAutoModal","showScoringModal","setShowScoringModal","manualPreviewRef","dartTimerEnabled","dartTimerSeconds","dartTimeLeft","setDartTimeLeft","timerRef","paused","detectorRef","rafRef","detectorSeedVersion","setDetectorSeedVersion","onOpen","refresh","onClose","inProgress","shouldRun","addDart","vw","vh","cw","ch","retryErr","enumErr","capture","CameraSelector","Hs","sourceVideo","canceled","proc","cImg","rImg","roiR","tipRefined","pCal","ox","oy","ax1","ay1","ax2","ay2","sub","onOverlayClick","parseManual","bull","outerBull","multVal","getCurrentRemaining","newDarts","willCount","applied","appliedValue","newScore","after","isFinish","preOpenTotal","postAfter","postBefore","attemptsThisDart","attemptsTotal","onAddAutoDart","onApplyManual","onReplaceManual","prevDarts","prevScore","onRecalibrateNow","onResetCalibration","onQuickEntry","onUndoDart","onCommitVisit","fit","videoClass","isPending","isHit","stateClass","title","baseClasses","okNow","pulseClass","ms","polarToCartesian","angleDeg","sectorAngle","HeatMap","radii","ringOrder","angle","grd","sectorCounts","secStr","DOUBLE_PRACTICE_ORDER","isDoubleHit","targetIdx","parseManualDart","ATC_ORDER","CRICKET_NUMBERS","createCricketState","marks","applyCricketDart","opponentClosed","hits","cand","before","remainToClose","toApply","overflow","hasClosedAll","createShanghaiState","getRoundTarget","applyShanghaiDart","endShanghaiTurn","createDefaultHalveIt","getCurrentHalveTarget","applyHalveItDart","endHalveItTurn","createHighLow","applyHighLowDart","endHighLowTurn","createKillerState","assigned","lives","assignKillerNumbers","playerIds","pool","res","applyKillerDart","selfId","states","me","victimId","victim","killerWinner","createBaseball","applyBaseballDart","runs","GOLF_TARGETS","createGolf","applyGolfDart","TTT_TARGETS","createTicTacToe","checkWin","board","lines","tryClaimCell","cell","ok","createScamState","SCAM_TARGETS","SCAM_TARGET_NAMES","getScamTarget","addScamAuto","newIndex","finished","addScamNumeric","resetScam","createFivesState","FIVES_VALID_NUMBERS","isFivesValid","addFivesAuto","addFivesNumeric","resetFives","createSevensState","SEVENS_VALID_NUMBERS","isSevensValid","addSevensAuto","addSevensNumeric","resetSevens","AM_CRICKET_NUMBERS","createAmCricketState","applyAmCricketDart","toClose","hasClosedAllAm","GameHeaderBar","sticky","GameScoreboard","players","matchScore","gameRules","ScoreRow","AvgDifferenceRow","formatCricketClosed","getCricketStatus","mono","bold","highlight","matchAvg","allTimeAvg","isPositive","isNeutral","diffText","diffColor","closed","closedCount","useOfflineGameStats","playerScore","aiScore","playerLegs","aiLegs","playerLastDart","aiLastDart","playerVisitSum","aiVisitSum","playerDoublesHit","playerDoublesAtt","aiDoublesHit","aiDoublesAtt","legStats","isPlayerTurn","ai","x01Score","cricket","shanghai","killerPlayers","killerStates","killerAssigned","killerTurnIdx","playerMatchAvg","playerDarts","playerScored","useOnlineGameStats","participants","isCurrentTurn","totalDarts","totalScored","legDarts","legScored","freeGames","premiumGames","allGames","aiLevels","aiVisitScore","X01RulesPopup","OfflinePlay","offlineLayout","selectedMode","setSelectedMode","setX01Score","setAI","showRules","setShowRules","inMatch","setInMatch","setPlayerScore","setAiScore","onDouble","setOnDouble","showWinPopup","setShowWinPopup","firstTo","setFirstTo","setPlayerLegs","setAiLegs","pendingLegWinner","setPendingLegWinner","doubleDarts","setDoubleDarts","checkoutDarts","setCheckoutDarts","setLegStats","aiDelayMs","setAiDelayMs","showMatchModal","setShowMatchModal","maximized","setMaximized","fitAll","setFitAll","fitScale","setFitScale","setIsPlayerTurn","playerDartPoints","setPlayerDartPoints","dpIndex","setDpIndex","dpHits","setDpHits","atcIndex","setAtcIndex","atcHits","setAtcHits","setCricket","setShanghai","halve","setHalve","highlow","setHighlow","practiceTurnDarts","setPracticeTurnDarts","b27Stage","setB27Stage","b27Score","setB27Score","b27Darts","setB27Darts","b27Hits","setB27Hits","b27Finished","setB27Finished","cuRound","setCuRound","cuScore","setCuScore","cuDarts","setCuDarts","cuMaxRounds","hsRound","setHsRound","hsScore","setHsScore","hsDarts","setHsDarts","hsMaxRounds","lsRound","setLsRound","lsScore","setLsScore","lsDarts","setLsDarts","lsMaxRounds","co170Rem","setCo170Rem","co170Darts","setCo170Darts","co170Attempts","setCo170Attempts","co170Successes","setCo170Successes","co121Rem","setCo121Rem","co121Darts","setCo121Darts","co121Attempts","setCo121Attempts","co121Successes","setCo121Successes","trebleTarget","setTrebleTarget","trebleHits","setTrebleHits","trebleDarts","setTrebleDarts","trebleMaxDarts","setTrebleMaxDarts","trebleFinished","setTrebleFinished","baseball","setBaseball","golf","setGolf","ttt","setTTT","amCricket","setAmCricket","setKillerPlayers","setKillerStates","setKillerAssigned","killerSetupDone","setKillerSetupDone","setKillerTurnIdx","killerDarts","setKillerDarts","killerWinnerId","setKillerWinnerId","killerLastEvent","setKillerLastEvent","scam","setScam","scamPlayer","setScamPlayer","fives","setFives","fivesPlayer","setFivesPlayer","sevens","setSevens","sevensPlayer","setSevensPlayer","playerDartsThrown","setPlayerDartsThrown","setPlayerLastDart","playerVisitDarts","setPlayerVisitDarts","playerVisitStart","setPlayerVisitStart","setPlayerVisitSum","playerVisitDartsAtDouble","setPlayerVisitDartsAtDouble","aiCountdownMs","setAiCountdownMs","aiDartsThrown","setAiDartsThrown","setAiLastDart","setAiVisitSum","aiVisitDartsAtDouble","setAiVisitDartsAtDouble","setPlayerDoublesAtt","setPlayerDoublesHit","setAiDoublesAtt","setAiDoublesHit","totalPlayerDarts","setTotalPlayerDarts","totalAiDarts","setTotalAiDarts","totalPlayerPoints","setTotalPlayerPoints","totalAiPoints","setTotalAiPoints","player180s","setPlayer180s","player140s","setPlayer140s","player100s","setPlayer100s","ai180s","setAi180s","ai140s","setAi140s","ai100s","setAi100s","playerHighestCheckout","setPlayerHighestCheckout","aiHighestCheckout","setAiHighestCheckout","showMatchSummary","setShowMatchSummary","manualBox","setManualBox","manualTextarea","setManualTextarea","callerEnabled","callerVoice","callerVolume","speakCheckoutOnly","rememberLastOffline","setLastOffline","autoStartOffline","setCameraScale","setCameraAspect","setCameraFitMode","textSize","boxSize","matchType","setMatchType","teamAName","setTeamAName","teamBName","setTeamBName","manualScoring","statsX01","statsCricket","statsShanghai","statsKiller","statsScam","statsFives","statsSevens","buttonSizeClass","scrollerRef","contentRef","headerBarRef","formatType","setFormatType","formatCount","setFormatCount","formatRef","wins","measure","content","availH","availW","currentScale","naturalHeight","naturalWidth","scaleH","scaleW","RO","ro","onAuto","startMatch","onFmt","dt","visitDarts","targetVisit","dart","checkout","startNextLeg","endTurn","nextRemaining","applyDartValue","newVisitDarts","preRemaining","postRemaining","attemptsThisVisit","startedDoubleWindow","stillInDoubleWindow","addDartNumeric","visitTotalInput","setVisitTotalInput","addVisitTotal","addDpValue","nextHits","addDpNumeric","addDpManual","addB27Auto","nd","totalHits","addB27Numeric","resetB27","addCountUpAuto","addHighScoreAuto","addLowScoreAuto","applyCheckout","rem","setRem","setDarts","setAttempts","setSuccesses","addCo170Auto","addCo121Auto","addCoManual","is170","isDouble","resetCo170","resetCo121","addTrebleAuto","cycle","resetTreble","addBaseballAuto","cp","resetBaseball","addGolfAuto","resetGolf","addTttAuto","resetTtt","addAmCricketAuto","resetAmCricket","addAtcValue","newHits","addAtcNumeric","addAtcManual","addCricketAuto","copy","addCricketNumeric","addShanghaiAuto","addShanghaiNumeric","addHalveAuto","addHalveNumeric","addHighLowAuto","addHighLowNumeric","parseManualBox","addManual","addManualTextarea","line","replaceLast","replaceLastManual","rewind","handleWinPopupSubmit","winner","legDoublesAtt","legDoublesHit","winnerDarts","lockedPremium","disabled","pillCls","cricketClosedAll","first","currentThrower","currentRemaining","lastScoreVisit","dartsThrown","avg3","bestLegText","nh","ni","info","promptVal","tcell","win","it","initStates","player3da","player9da","playerBest","playerWorst","playerPct","ai3da","ai9da","aiBest","aiWorst","aiPct","LS_INBOX","LS_UNREAD","loadInitial","unread","inbox","initial","useMessages","exists","sorted","patterns","starify","censorProfanity","re","containsProfanity","TabPills","isActive","timeAgo","ts","Friends","friends","setFriends","suggested","setSuggested","setResults","setQ","filter","setFilter","loading","setLoading","msgs","setRequests","outgoingRequests","setOutgoingRequests","messagePopup","setMessagePopup","fl","sg","search","term","addFriend","removeFriend","filtered","spectate","requestsCount","newFriend","reason","Toaster","toasts","remove","BarChart","barWidth","gap","showValues","totalWidth","WSContext","createContext","WSProvider","connected","setConnected","status","setStatus","wsRef","listenersRef","shouldReconnectRef","attemptsRef","heartbeatRef","endpointsRef","endpointIdxRef","ensureEndpoints","normalized","bases","rotateEndpoint","currentEndpoint","attempt","jitter","delay","reconnect","beforeUnload","onVis","send","addListener","useWS","useContext","StatusDot","CameraStatusBadge","camera","videoEl","running","render","vr","cr","sw","sh","targetW","targetH","onClick","HELP_TOPICS","analyzeUserQuestion","question","lowerQ","topic","keyword","getEstimatedWaitTime","hour","HelpdeskChat","request","messages","setMessages","setInput","typingUsers","setTypingUsers","adminConnected","setAdminConnected","waitTime","setWaitTime","msgsRef","typingTimeoutRef","un","who","sendMsg","userMessage","msgObj","aiResponse","aiMsg","requestAdminConnection","needsHelp","confirmMsg","waitMsg","sendTyping","User","action","actionMsg","Send","OWNER_EMAIL","AdminDashboard","admins","setAdmins","setEmail","announcement","setAnnouncement","tournaments","setTournaments","withdrawals","setWithdrawals","userSearch","setUserSearch","userResults","setUserResults","createForm","setCreateForm","emailCopy","setEmailCopy","preview","setPreview","isOwner","winners","setWinners","reports","setReports","helpRequests","setHelpRequests","helpTyping","setHelpTyping","selectedRequest","setSelectedRequest","logs","setLogs","systemHealth","setSystemHealth","clusteringEnabled","setClusteringEnabled","clusterCapacity","setClusterCapacity","gmVersion","setGmVersion","gmStats","cal","calibQuality","items","game","qualityInfo","gmBars","bars","gameKey","headers","hrRes","adminsRes","tRes","revoke","grantPremium","days","revokePremium","sendAnnouncement","toggleMaintenance","unsub","rid","iv","changed","claimHelp","resolveHelp","grant","searchUsers","authHeader","banUser","unbanUser","createOfficialTournament","setWinner","tid","winnerEmail","markPaid","deleteTournament","reseedWeekly","decideWithdrawal","approve","deleteMatch","fetchLogs","fetchSystemHealth","toggleClustering","enable","updateClusterCapacity","newCapacity","loadEmailCopy","saveEmailCopy","kind","openInlinePreview","openInNewTab","html","EmailEditor","setTitle","intro","setIntro","btn","setBtn","hr","colorClass","admin","notes","newType","hasAccess","SettingsPanel","avgMode","reducedMotion","compactHeader","allowSpectate","setFavoriteDouble","setCallerEnabled","setCallerVoice","setCallerVolume","setSpeakCheckoutOnly","setAvgMode","setAutoStartOffline","setRememberLastOffline","setReducedMotion","setCompactHeader","setAllowSpectate","setAutoscoreProvider","setAutoscoreWsUrl","setOfflineLayout","setTextSize","setBoxSize","setDartTimerEnabled","setDartTimerSeconds","setX01DoubleIn","achievements","setAchievements","uname","isEditing","setIsEditing","favPlayer","setFavPlayer","favTeam","setFavTeam","favDarts","setFavDarts","bio","setBio","profilePhoto","setProfilePhoto","allowAnalytics","setAllowAnalytics","subscription","setSubscription","helpMessages","setHelpMessages","helpInput","setHelpInput","saveBio","navigateToTab","tabKey","getResponseWithLinks","handleHelpSend","newUsername","setNewUsername","changingUsername","setChangingUsername","usernameError","setUsernameError","availableVoices","setAvailableVoices","loadVoices","voices","showHighlights","setShowHighlights","expandedPill","setExpandedPill","PillButton","pill","ChevronDown","Shield","Eye","file","blob","Volume2","utterance","Save","Edit3","Gamepad2","HelpCircle","link","Auth","onAuth","username","setUsername","password","setPassword","reminder","setReminder","setError","showPassword","setShowPassword","handleSignIn","handleSignUp","handleReset","handleSendUsername","EyeOff","BarChart3","ShieldCheck","ThemeContext","THEME_KEY","ThemeProvider","theme","setTheme","computeTotals","bestLeg","worstLeg","oneEighties","L","threeDA","nineDA","MatchSummaryModal","centerScore","doublesStats","allowRematch","onRematch","cards","dbl","att","pct","LS","map","useBlocklist","OnlinePlay","wsGlobal","blocklist","setRoomId","chat","setChat","showQuick","setShowQuick","showMessages","setShowMessages","lastSentChatRef","setSelfId","reconnectAttemptsRef","reconnectTimerRef","lastToastRef","firstConnectDoneRef","defaultX01DoubleIn","cameraColSpan","setCameraColSpan","setParticipants","turnIdx","setTurnIdx","visitScore","setVisitScore","dpManual","setDpManual","atcManual","setAtcManual","trebleManual","setTrebleManual","x01DoubleInMatch","setX01DoubleInMatch","pairingCode","setPairingCode","highlightCandidate","setHighlightCandidate","showHighlightModal","setShowHighlightModal","downloadHighlightToDevice","saveHighlightToAccount","mobileStream","setMobileStream","mobileVideoRef","tttManual","setTttManual","cricketById","setCricketById","shanghaiById","setShanghaiById","halveById","setHalveById","highlowById","setHighlowById","killerById","setKillerById","amCricketById","setAmCricketById","baseballById","setBaseballById","golfById","setGolfById","turnDarts","setTurnDarts","setPausedLocal","pauseRequestedBy","setPauseRequestedBy","pauseAcceptedBy","setPauseAcceptedBy","pauseEndsAt","setPauseEndsAt","pauseDurationSec","setPauseDurationSec","setPausedGlobal","compactView","setCompactView","ua","showX01EndSummary","setShowX01EndSummary","endSummaryPrevRef","attempts","celebration","setCelebration","lastCelebrationRef","audioCtxRef","sendState","ensureAudio","Ctor","beep","freq","durMs","whenS","gain","playSting","triggerCelebration","showCreate","setShowCreate","lobby","setLobby","modeValue","setModeValue","startScore","setStartScore","pendingInvite","setPendingInvite","errorMsg","setErrorMsg","handleStripeError","lastJoinIntent","setLastJoinIntent","offerNewRoom","setOfferNewRoom","setGame","currentGame","setCurrentGame","requireCalibration","setRequireCalibration","createTrebleMaxDarts","setCreateTrebleMaxDarts","createX01DoubleIn","setCreateX01DoubleIn","filterMode","setFilterMode","filterStart","setFilterStart","filterGame","setFilterGame","nearAvg","setNearAvg","avgTolerance","setAvgTolerance","calibH","myAvg","filteredLobby","handler","onSpectate","fallback","di","ah","tt","th","td","tmax","_cr","_sh","_hv","_hl","_kr","_am","_bb","_gf","_tt","_td","_di","isSelf","idKey","startMobileWebRTC","RenderMatchSummary","curIdx","lastScore","bestText","textSizeClass","boxSizeClass","_paused","_pEnds","_pBy","_acc","_dur","sendQuick","nextIdx","isAtcHit","addTrebleValue","addTrebleNumeric","addTrebleManual","ensureCricket","ensureShanghai","ensureHalve","ensureHighLow","ensureKiller","used","ensureAmCricket","ensureBaseball","ensureGolf","allOpponentsClosed","opps","applyCricketAuto","applyShanghaiAuto","applyHalveAuto","applyHighLowAuto","applyKillerAuto","applyAmCricketAuto","applyBaseballAuto","applyGolfAuto","applyTttAuto","openManual","submitVisitManual","reportMessage","offenderId","getBoardPreview","track","acceptedCount","required","ends","creatorAvg","newVal","calibrated","boardPreview","dur","hue","isMe","lastVisitScore","availableCell","startX","startSpan","handleMouseMove","moveEvent","handleMouseUp","pp","ps","ChatList","onDelete","onReport","onBlock","mobile","touch","setTouch","swiped","setSwiped","flagged","held","StatsPanel","newMatch","family","setFamily","playersText","setPlayersText","setStart","selectedGameMode","setSelectedGameMode","opponent","setOpponent","showPicker","setShowPicker","searching","setSearching","cancelled","runSearch","otherData","gm","onUpdate","lbl","Tournaments","setList","cooldownUntil","setCooldownUntil","leaveAsk","setLeaveAsk","deleteConfirm","setDeleteConfirm","form","setForm","isTouch","MatchPrefs","abort","check","hasJoined","confirmDeleteTournament","join","fmt","leave","createTournament","official","community","nextOfficial","AdminAccess","Drawer","footer","side","OpsDashboard","ready","setReady","ann","setAnn","setMsg","enabled","announce","HelpAssistant","isOpen","setIsOpen","awaitingAdminConfirm","setAwaitingAdminConfirm","lastUserQuestion","setLastUserQuestion","myRequest","setMyRequest","handleSend","userMessageRaw","linkIndex","GlobalCameraLogger","lastStateRef","dumpState","prefix","media","snapshot","attachVideoListeners","loadedmetadata","playing","pause","ended","attachPc","connChange","attachInterval","GlobalPhoneVideoSink","vref","lastStreamRef","lastTimeRef","stallSecondsRef","lastReconnectAtRef","attemptRef","vid","minBackoff","Footer","show","setShow","year","App","appRef","avatar","setAvatar","isFullscreen","setIsFullscreen","setTab","isMobile","setIsMobile","navOpen","setNavOpen","setUser","setAllTimeAvg","calibLocked","fetchSubscription","onLogout","storedAvatar","handleStorageChange","handleAvatarUpdate","handleVisibilityChange","checkAvatarInterval","urlParams","paid","usernameChange","pendingUsername","update","mqMobile","mqTablet","uaTablet","touchScreen","verySmallScreen","isTablet","onName","onTabChange","fallbackAvatar","MobileNav","validatePassword","ResetPassword","setToken","confirm","setConfirm","success","setSuccess","onSubmit","ErrorBoundary","Component","ReactDOM","StrictMode","Root"],"mappings":";;;;;;;;6CASa,IAAIA,EAAEC,GAAA,EAAiBC,EAAE,OAAO,IAAI,eAAe,EAAEC,EAAE,OAAO,IAAI,gBAAgB,EAAEC,EAAE,OAAO,UAAU,eAAe,EAAEJ,EAAE,mDAAmD,kBAAkBK,EAAE,CAAC,IAAI,GAAG,IAAI,GAAG,OAAO,GAAG,SAAS,EAAE,EAClP,SAASC,EAAEC,EAAEC,EAAEC,EAAE,CAAC,IAAIC,EAAEC,EAAE,CAAA,EAAGC,EAAE,KAAKC,EAAE,KAAcJ,IAAT,SAAaG,EAAE,GAAGH,GAAYD,EAAE,MAAX,SAAiBI,EAAE,GAAGJ,EAAE,KAAcA,EAAE,MAAX,SAAiBK,EAAEL,EAAE,KAAK,IAAIE,KAAKF,EAAEJ,EAAE,KAAKI,EAAEE,CAAC,GAAG,CAACL,EAAE,eAAeK,CAAC,IAAIC,EAAED,CAAC,EAAEF,EAAEE,CAAC,GAAG,GAAGH,GAAGA,EAAE,aAAa,IAAIG,KAAKF,EAAED,EAAE,aAAaC,EAAWG,EAAED,CAAC,IAAZ,SAAgBC,EAAED,CAAC,EAAEF,EAAEE,CAAC,GAAG,MAAM,CAAC,SAASR,EAAE,KAAKK,EAAE,IAAIK,EAAE,IAAIC,EAAE,MAAMF,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,OAAAG,YAAiBX,EAAEW,GAAA,IAAYR,EAAEQ,GAAA,KAAaR,2CCPxWS,GAAA,QAAiBd,GAAA,qECDnB,IAAIG,EAAIH,GAAA,EAEN,OAAAe,GAAA,WAAqBZ,EAAE,WACvBY,GAAA,YAAsBZ,EAAE,uDCF1B,MAAMa,GAAOC,GAAiB,oBAAoBA,CAAI,GAOtD,SAASC,GAAUR,EAAI,IAAI,KAAgB,CAEzC,MAAMS,EAAO,IAAI,KAAK,KAAK,IAAIT,EAAE,YAAA,EAAeA,EAAE,SAAA,EAAYA,EAAE,QAAA,CAAS,CAAC,EAEpEU,EAASD,EAAK,UAAA,GAAe,EACnCA,EAAK,WAAWA,EAAK,WAAA,EAAe,EAAIC,CAAM,EAC9C,MAAMC,EAAY,IAAI,KAAK,KAAK,IAAIF,EAAK,eAAA,EAAkB,EAAG,CAAC,CAAC,EAC1DG,EAAS,KAAK,OAAOH,EAAK,UAAYE,EAAU,QAAA,GAAa,MAAW,GAAK,CAAC,EAC9EE,EAAO,OAAOD,CAAM,EAAE,SAAS,EAAG,GAAG,EAC3C,MAAO,GAAGH,EAAK,eAAA,CAAgB,IAAII,CAAI,EACzC,CAEO,SAASC,GAAeP,EAAqB,CAClD,GAAI,CACF,MAAMQ,EAAM,aAAa,QAAQT,GAAIC,CAAI,CAAC,EAC1C,GAAI,CAACQ,EAAK,MAAO,CAAE,KAAMP,GAAA,EAAa,KAAM,CAAA,EAC5C,MAAMQ,EAAI,KAAK,MAAMD,CAAG,EAClBE,EAAcT,GAAA,EACpB,MAAI,CAACQ,EAAE,MAAQA,EAAE,OAASC,EAAoB,CAAE,KAAMA,EAAa,KAAM,CAAA,EAClE,CAAE,KAAM,OAAOD,EAAE,IAAI,EAAG,KAAM,OAAOA,EAAE,IAAI,GAAK,CAAA,CACzD,MAAQ,CACN,MAAO,CAAE,KAAMR,KAAa,KAAM,CAAA,CACpC,CACF,CAEO,SAASU,GAAeX,EAAcY,EAAc,CACzD,GAAI,CAAE,aAAa,QAAQb,GAAIC,CAAI,EAAG,KAAK,UAAUY,CAAK,CAAC,CAAE,MAAQ,CAAC,CACxE,CAEO,SAASC,GAAeb,EAAcc,EAAM,EAAU,CAC3D,MAAMJ,EAAcT,GAAA,EACdQ,EAAIF,GAAeP,CAAI,EACvBe,EAAc,CAAE,KAAML,EAAa,MAAOD,EAAE,OAASC,EAAcD,EAAE,KAAO,GAAK,CAAA,EAEvF,OAAAE,GAAeX,EAAMe,CAAI,EAClBA,CACT,CAEO,SAASC,GAAiBhB,EAAcc,EAAM,EAAW,CAC9D,MAAML,EAAIF,GAAeP,CAAI,EAC7B,OAAO,KAAK,IAAI,EAAGc,GAAOL,EAAE,MAAQ,EAAE,CACxC,wICjDMQ,GAAS,iBAIf,SAASC,IAAkB,CACzB,GAAI,CAAE,MAAMV,EAAM,aAAa,QAAQS,EAAM,EAAG,OAAOT,EAAM,KAAK,MAAMA,CAAG,EAAI,CAAA,CAAG,MAAQ,CAAE,MAAO,CAAA,CAAG,CACxG,CACA,SAASW,GAASC,EAAeC,EAAY,CAC3C,GAAI,CACF,MAAMhC,EAAI6B,GAAA,EACV7B,GAAG+B,GAAO,IAAI,YAAA,CAAa,EAAI,CAAE,EAAAC,EAAG,GAAI,KAAK,KAAI,EACjD,aAAa,QAAQJ,GAAQ,KAAK,UAAU5B,CAAC,CAAC,CAChD,MAAQ,CAAC,CACX,CAEA,eAAsBiC,GAAaF,EAAuC,CACxE,MAAM1B,EAAI,OAAO0B,GAAS,EAAE,EAAE,YAAA,EAC9B,GAAI,CAAC1B,EAAG,MAAO,GAEf,GAAI,CACF,MAAM6B,EAAQ,OAAQC,IAA0B,kBAAoB,EAAE,EAAE,YAAA,EACxE,GAAID,GAAS7B,IAAM6B,EAAO,MAAO,EACnC,MAAQ,CAAC,CAET,GAAI7B,IAAM,4BAA6B,MAAO,GAC9C,GAAI,CACF,MAAM+B,EAAQ,aAAa,QAAQ,gBAAgB,EACnD,GAAIA,IAAU,KAAOA,IAAU,OAAQ,MAAO,EAChD,MAAQ,CAAC,CAGT,MAAMC,EADIR,GAAA,EACIxB,CAAC,EACf,GAAIgC,GAAQ,KAAK,IAAA,EAAQA,EAAI,GAAM,IAAS,IAAM,MAAO,CAAC,CAACA,EAAI,EAC/D,GAAI,CAGF,MAAML,EAAI,CAAC,EADE,MADD,MAAM,MAAM,2BAA2B,mBAAmB3B,CAAC,CAAC,EAAE,GACnD,KAAA,EAAO,MAAM,KAAK,CAAA,EAAG,IAC1B,QAClB,OAAAyB,GAASzB,EAAG2B,CAAC,EACNA,CACT,MAAQ,CACN,MAAO,CAAC,CAAEK,GAAK,CACjB,CACF,CAEO,SAASC,GAAWP,EAAqB,CAC9C,MAAM1B,EAAI,OAAO0B,GAAS,EAAE,EAAE,YAAA,EACxB,CAACQ,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAK,EAC5CC,OAAAA,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAK,GACT,GAAI,CAACtC,EAAG,CAAEmC,EAAW,EAAK,EAAG,MAAO,CAEpC,GAAI,CACF,MAAMN,EAAQ,OAAQC,IAA0B,kBAAoB,EAAE,EAAE,YAAA,EAClEC,GAAS,IAAe,CAAE,GAAI,CAAE,MAAMJ,EAAI,aAAa,QAAQ,gBAAgB,EAAG,OAAOA,IAAM,KAAOA,IAAM,MAAO,MAAQ,CAAE,MAAO,EAAM,CAAE,GAAA,EAClJ,GAAIE,GAAS7B,IAAM6B,EAAO,CAAEM,EAAW,EAAI,EAAG,MAAO,CACrD,GAAIJ,EAAO,CAAEI,EAAW,EAAI,EAAG,MAAO,CACxC,MAAQ,CAAC,CACT,GAAInC,IAAM,4BAA6B,CAAEmC,EAAW,EAAI,EAAG,MAAO,CAClE,OAAAP,GAAa5B,CAAC,EAAE,KAAK2B,GAAK,CAAMW,GAAIH,EAAW,CAAC,CAACR,CAAC,CAAE,CAAC,EAC9C,IAAM,CAAEW,EAAK,EAAM,CAC5B,EAAG,CAACtC,CAAC,CAAC,EACCkC,CACT,aC/DaK,GAAiB,EAGxBC,GAA6B,CAClC,IAAK,EACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,IACN,EAEO,SAASC,GAAsBC,EAAkBC,EAAYJ,GAAgB,CACnF,MAAMK,GAAOF,GAAY,OAAO,YAAA,EAC1BG,EAAOL,GAAGI,CAAG,GAAK,EAClBE,EAAMH,EAAYE,EACxB,GAAI,CACH,OAAO,IAAI,KAAK,aAAa,OAAW,CAAE,MAAO,WAAY,SAAUD,CAAA,CAAK,EAAE,OAAOE,CAAG,CACzF,MAAQ,CAEP,MAAO,GAAGF,CAAG,IAAIE,EAAI,QAAQ,CAAC,CAAC,EAChC,CACD,CAEO,SAASC,IAA0B,CACzC,GAAI,CAEH,MAAMC,EAAQ,IAAI,KAAK,aAAA,EAAe,gBAAA,EAEhCxD,EAAI,OAAOwD,EAAM,MAAM,EAAE,YAAA,EAC/B,OAAIxD,EAAE,SAAS,KAAK,EAAU,MAC1BA,EAAE,SAAS,KAAK,GAAKA,EAAE,SAAS,KAAK,GAAKA,EAAE,SAAS,KAAK,GAAKA,EAAE,SAAS,KAAK,GAAKA,EAAE,SAAS,KAAK,GAAKA,EAAE,SAAS,KAAK,EAAU,MACnIA,EAAE,SAAS,KAAK,EAAU,MAC1BA,EAAE,SAAS,KAAK,EAAU,MAC1BA,EAAE,SAAS,KAAK,EAAU,MAC1BA,EAAE,SAAS,KAAK,EAAU,MACvB,KACR,MAAQ,CACP,MAAO,KACR,CACD,CAGO,MAAMyD,GAA8BnB,IAAyB,yBAA2B,8BC1C/F,IAAIoB,GAA+B,KAEnC,SAASC,IAAyB,CAChC,GAAID,GAAe,OAAOA,GAC1B,MAAME,EAAW,wBAA+D,KAAA,EAChF,GAAIA,EACF,OAAAF,GAAgBE,EAAO,QAAQ,MAAO,EAAE,EACjCF,GAET,GAAI,OAAO,OAAW,IAAa,CACjC,KAAM,CAAE,SAAAG,EAAU,KAAAC,EAAM,SAAAC,CAAA,EAAa,OAAO,SACtCC,EAAa,GAAGH,CAAQ,KAAKC,CAAI,GACvC,OAAIC,EAAS,SAAS,cAAc,GAAKA,IAAa,aAAeA,IAAa,YAChFL,GAAgBM,EAAW,QAAQ,MAAO,EAAE,EAE5CN,GAAgB,sCAEXA,EACT,CAEA,OAAAA,GAAgB,sCACTA,EACT,CAEA,SAASO,GAAcC,EAAuB,CAC5C,GAAI,gBAAgB,KAAKA,CAAI,EAAG,OAAOA,EACvC,MAAMC,EAAOR,GAAA,EACPS,EAAYF,EAAK,WAAW,GAAG,EAAIA,EAAO,IAAIA,CAAI,GACxD,MAAO,GAAGC,CAAI,GAAGC,CAAS,EAC5B,CAEO,SAASC,GAAcH,EAAuB,CACnD,OAAOD,GAAcC,CAAI,CAC3B,CAEO,SAASI,GAASJ,EAAeK,EAAoB,CAC1D,MAAMC,EAAMH,GAAcH,CAAI,EAC9B,OAAO,MAAMM,EAAKD,CAAI,CACxB,CAEO,SAASE,IAAwB,CACtC,GAAI,OAAO,OAAW,KAAe,OAAO,OAAO,OAAU,WAAY,OACzE,MAAMC,EAAY,OAClB,GAAIA,EAAU,gBAAiB,OAC/B,MAAMC,EAAgB,OAAO,MAAM,KAAK,MAAM,EAC9C,OAAO,MAAQ,CAACC,EAA0BL,IAAuB,CAC/D,GAAI,CACF,GAAI,OAAOK,GAAU,SACnB,OAAIA,EAAM,WAAW,GAAG,EACfD,EAAcN,GAAcO,CAAK,EAAGL,CAAI,EAE1CI,EAAcC,EAAOL,CAAI,EAElC,GAAIK,aAAiB,QAAS,CAC5B,MAAMC,EAASD,EAAM,IAAI,WAAW,GAAG,EAAIP,GAAcO,EAAM,GAAG,EAAIA,EAAM,IAC5E,GAAIC,IAAWD,EAAM,IACnB,OAAOD,EAAcC,EAAOL,CAAI,EAElC,MAAMO,EAAS,IAAI,QAAQD,EAAQD,CAAK,EACxC,OAAOD,EAAcG,EAAQP,CAAI,CACnC,CACA,GAAIK,aAAiB,IAAK,CACxB,MAAMG,EAAOH,EAAM,KAAK,WAAW,GAAG,EAAIP,GAAcO,EAAM,IAAI,EAAIA,EAAM,KAC5E,OAAOD,EAAcI,EAAMR,CAAI,CACjC,CACF,OAASS,EAAK,CACZ,QAAQ,KAAK,2DAA4DA,CAAG,CAC9E,CACA,OAAOL,EAAcC,EAAcL,CAAI,CACzC,EACAG,EAAU,gBAAkB,EAC9B,CC/DO,SAASO,GAAQnE,EAAW,CACjC,MAAMoE,EAAW,CACf,CAAE,IAAK,QAAS,MAAO,OAAQ,KAAMC,EAAA,EACrC,CAAE,IAAK,SAAU,MAAO,SAAU,KAAMC,EAAA,EACxC,CAAE,IAAK,UAAW,MAAO,UAAW,KAAMC,EAAA,EAC1C,CAAE,IAAK,cAAe,MAAO,cAAe,KAAMA,EAAA,EAClD,CAAE,IAAK,UAAW,MAAO,UAAW,KAAMD,EAAA,EAC1C,CAAE,IAAK,QAAS,MAAO,QAAS,KAAMC,EAAA,EACtC,CAAE,IAAK,YAAa,MAAO,YAAa,KAAMC,EAAA,EAC9C,CAAE,IAAK,WAAY,MAAO,WAAY,KAAMC,EAAA,CAAS,EAGvD,OAAKzE,GAAM,YACToE,EAAS,KAAK,CAAE,IAAK,aAAc,MAAO,cAAe,KAAMM,GAAe,EAEzEN,CACT,CAEO,SAASO,GAAQ,CACtB,OAAAC,EACA,SAAAC,EACA,KAAA7E,EACA,UAAA8E,CACF,EAKG,CACD,MAAMC,EAAOZ,GAAQnE,CAAI,EACnB4B,EAAUD,GAAW3B,GAAM,KAAK,EAItC,GAAI4B,GAAW,CAACmD,EAAK,QAAUC,EAAE,MAAQ,OAAO,EAAG,CACjD,MAAMC,EAAMF,EAAK,UAAUC,GAAKA,EAAE,MAAQ,UAAU,EAC9CE,EAAW,CAAE,IAAK,QAAS,MAAO,QAAS,KAAMT,EAAA,EACnDQ,GAAO,EAAGF,EAAK,OAAOE,EAAK,EAAGC,CAAe,EAAQH,EAAK,KAAKG,CAAe,CACpF,CACA,KAAM,CAACC,EAAaC,CAAc,EAAItD,EAAAA,SAAS,EAAK,EAC9C,CAACuD,EAAgBC,CAAiB,EAAIxD,EAAAA,SAAS,EAAK,EACpDyD,EAAWvF,GAAM,UAAY,CAACA,GAAM,WAAagB,GAAiBhB,EAAK,QAAQ,EAAI,IAGnF,CAACwF,EAAeC,CAAgB,EAAI3D,WAAS,CACjD,eAAgB,EAChB,SAAU,EACV,YAAa,CAAA,CACd,EAGDC,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC/B,GAAM,MAAO,OAElB,MAAM0F,EAAqB,SAAY,CACrC,GAAI,CACF,KAAM,CAACC,EAAaC,CAAW,EAAI,MAAM,QAAQ,IAAI,CACnDpC,GAAS,+BAA+B,mBAAmBxD,EAAK,KAAK,CAAC,EAAE,EACxEwD,GAAS,+BAA+B,mBAAmBxD,EAAK,KAAK,CAAC,EAAE,CAAA,CACzE,EAEK6F,EAAWF,EAAY,GAAK,MAAMA,EAAY,OAAS,CAAE,SAAU,EAAC,EAIpEG,GAHWF,EAAY,GAAK,MAAMA,EAAY,OAAS,CAAE,SAAU,EAAC,GAG1C,UAAU,OAAQ1G,GAAW,CAACA,EAAE,IAAI,EAAE,QAAU,EAEhFuG,EAAiB,CACf,eAAgBI,EAAS,UAAU,QAAU,EAC7C,SAAUC,EACV,YAAa,CAAA,CACd,CACH,OAAS5B,EAAK,CACZ,QAAQ,MAAM,iCAAkCA,CAAG,CACrD,CACF,EAEAwB,EAAA,EAEA,MAAMK,EAAW,YAAYL,EAAoB,GAAK,EACtD,MAAO,IAAM,cAAcK,CAAQ,CACrC,EAAG,CAAC/F,GAAM,KAAK,CAAC,EAEhB+B,EAAAA,UAAU,IAAM,CACd,GAAI,CAACoD,EAAa,OAClB,MAAMa,EAAStG,GAAqB,EAAMA,EAAE,MAAQ,UAAYA,EAAE,MAAQ,YAAwB,EAAK,CAAE,EACzG,gBAAS,iBAAiB,UAAWsG,CAAK,EACnC,IAAM,SAAS,oBAAoB,UAAWA,CAAK,CAC5D,EAAG,CAACb,CAAW,CAAC,SAEb,QAAA,CAAM,UAAW,GAAGnF,GAAM,WAAa,kBAAoB,EAAE,kBAAkB8E,EAAY,GAAK,MAAM,2BAA2BA,GAAa,gBAAgB,qDAAqDA,EAAY,GAAK,2CAA2C,GAC7Q,SAAA,CAAAC,EAAK,IAAI,CAAC,CAAE,IAAAkB,EAAK,MAAAC,EAAO,KAAMC,KAC/BF,IAAQ,SAAW,CAACrE,EAAgB,KAElCwE,EAAAA,KAAC,SAAA,CAEC,UAAW,+DAA+DxB,IAAWqB,EAAM,cAAgB,eAAe,IAC1H,QAAS,IAAMpB,EAASoB,CAAa,EACrC,MAAOC,EACP,MAAO,CAAE,WAAY,IAAK,SAAU,SAAU,MAAOtB,IAAWqB,EAAM,OAAS,UAAW,cAAe,QAAA,EAEzG,SAAA,CAAAI,EAAAA,IAACF,EAAA,CAAK,UAAU,SAAA,CAAU,EAC1BC,EAAAA,KAAC,OAAA,CAAK,UAAU,0BACb,SAAA,CAAAF,EACAD,IAAQ,UAAY,CAACjG,GAAM,YAAcuF,GAAY,GACpDa,EAAAA,KAAC,OAAA,CAAK,MAAM,yBAAyB,UAAU,gGAC7C,SAAA,CAAAC,EAAAA,IAACC,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,QAAA,EAE9B,EAGDL,IAAQ,WAAaT,EAAc,eAAiB,GACnDa,EAAAA,IAAC,OAAA,CAAK,UAAU,0GACb,SAAAb,EAAc,eAAiB,EAAI,KAAOA,EAAc,eAC3D,EAEDS,IAAQ,UAAYT,EAAc,SAAW,GAAKA,EAAc,YAAc,IAC7Ea,EAAAA,IAAC,OAAA,CAAK,UAAU,0GACZ,SAAAb,EAAc,SAAWA,EAAc,YAAe,EAAI,KAAQA,EAAc,SAAWA,EAAc,WAAA,CAC7G,CAAA,CAAA,CAEJ,CAAA,CAAA,EA1BKS,CAAA,CA8BR,EAEDG,EAAAA,KAAC,SAAA,CACC,UAAU,wGACV,QAAS,IAAMhB,EAAe,EAAI,EAClC,MAAM,sBACN,MAAO,CAAE,WAAY,IAAK,SAAU,SAAU,cAAe,QAAA,EAE7D,SAAA,CAAAiB,EAAAA,IAACE,GAAA,CAAc,UAAU,SAAA,CAAU,EACnCF,EAAAA,IAAC,OAAA,CAAK,UAAU,WAAW,SAAA,qBAAA,CAAmB,CAAA,CAAA,CAAA,EAGhDD,EAAAA,KAAC,SAAA,CACC,UAAU,wGACV,QAAS,IAAMd,EAAkB,EAAI,EACrC,MAAM,iBACN,MAAO,CAAE,WAAY,IAAK,SAAU,SAAU,cAAe,QAAA,EAE7D,SAAA,CAAAe,EAAAA,IAACE,GAAA,CAAc,UAAU,SAAA,CAAU,EACnCF,EAAAA,IAAC,OAAA,CAAK,UAAU,WAAW,SAAA,gBAAA,CAAc,CAAA,CAAA,CAAA,EAG1ClB,GAAeqB,GAAAA,aACdJ,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAA+B,QAAS,IAAMjB,EAAe,EAAK,EAAG,aAAc,IAAMA,EAAe,EAAK,CAAA,CAAG,EAC/HiB,EAAAA,IAAC,MAAA,CAAI,UAAU,wDACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,KAAK,SAAS,aAAW,OAAO,UAAU,yDAC7C,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,yCAAyC,aAAW,QAAQ,QAAS,IAAMjB,EAAe,EAAK,EAAG,SAAA,GAAA,CAAC,EACrHgB,EAAAA,KAAC,KAAA,CAAG,UAAU,gEACZ,SAAA,CAAAC,EAAAA,IAACE,GAAA,CAAc,UAAU,SAAA,CAAU,EAAE,sBAAA,EACvC,EACAF,EAAAA,IAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,uFAAoF,EACtIA,EAAAA,IAAC,IAAA,CACC,KAAM1D,GACA,OAAO,SACP,IAAI,+BACJ,UAAU,uDACX,SAAA,cAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,CAAA,EACF,EACA,SAAS,IAAA,EAGV0C,GAAkBmB,GAAAA,aACjBJ,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAA+B,QAAS,IAAMf,EAAkB,EAAK,EAAG,aAAc,IAAMA,EAAkB,EAAK,CAAA,CAAG,EACrIe,EAAAA,IAAC,MAAA,CAAI,UAAU,wDACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,KAAK,SAAS,aAAW,OAAO,UAAU,yDAC7C,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,yCAAyC,aAAW,QAAQ,QAAS,IAAMf,EAAkB,EAAK,EAAG,SAAA,GAAA,CAAC,EACxHc,EAAAA,KAAC,KAAA,CAAG,UAAU,gEACZ,SAAA,CAAAC,EAAAA,IAACE,GAAA,CAAc,UAAU,SAAA,CAAU,EAAE,iBAAA,EACvC,EACAF,EAAAA,IAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,4CAAyC,EAC3FA,EAAAA,IAAC,IAAA,CACC,KAAK,gCACC,OAAO,SACP,IAAI,+BACJ,UAAU,uDACX,SAAA,cAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,CAAA,EACF,EACA,SAAS,IAAA,CACX,EACF,CAEJ,aC9MMI,GAAmBC,GAAgB,CACvC,IAAIC,EACJ,MAAMC,MAAgC,IAChCC,EAAW,CAACC,EAASC,IAAY,CACrC,MAAMC,EAAY,OAAOF,GAAY,WAAaA,EAAQH,CAAK,EAAIG,EACnE,GAAI,CAAC,OAAO,GAAGE,EAAWL,CAAK,EAAG,CAChC,MAAMM,EAAgBN,EACtBA,EAASI,IAA4B,OAAOC,GAAc,UAAYA,IAAc,MAAQA,EAAY,OAAO,OAAO,CAAA,EAAIL,EAAOK,CAAS,EAC1IJ,EAAU,QAASM,GAAaA,EAASP,EAAOM,CAAa,CAAC,CAChE,CACF,EACME,EAAW,IAAMR,EAcjBS,EAAM,CAAE,SAAAP,EAAU,SAAAM,EAAU,gBAbV,IAAME,EAaqB,UAZhCH,IACjBN,EAAU,IAAIM,CAAQ,EACf,IAAMN,EAAU,OAAOM,CAAQ,GAUsB,QAR9C,IAAM,EACf1F,GAAkB,aAAuB,UAAY,cACxD,QAAQ,KACN,wMAAA,EAGJoF,EAAU,MAAA,CACZ,CAC8D,EACxDS,EAAeV,EAAQD,EAAYG,EAAUM,EAAUC,CAAG,EAChE,OAAOA,CACT,EACME,GAAeZ,GAAgBA,EAAcD,GAAgBC,CAAW,EAAID;;;;;;;;6CClBlF,IAAIc,EAAQxI,GAAA,EACZ,SAASyI,EAAGC,EAAGC,EAAG,CAChB,OAAQD,IAAMC,IAAYD,IAAN,GAAW,EAAIA,IAAM,EAAIC,IAAQD,IAAMA,GAAKC,IAAMA,CACxE,CACA,IAAIC,EAA0B,OAAO,OAAO,IAA7B,WAAkC,OAAO,GAAKH,EAC3D1F,EAAWyF,EAAM,SACjBxF,EAAYwF,EAAM,UAClBK,EAAkBL,EAAM,gBACxBM,EAAgBN,EAAM,cACxB,SAASO,EAAuBC,EAAWC,EAAa,CACtD,IAAIC,EAAQD,EAAW,EACrBE,EAAYpG,EAAS,CAAE,KAAM,CAAE,MAAOmG,EAAO,YAAaD,CAAW,EAAI,EACzEG,EAAOD,EAAU,CAAC,EAAE,KACpBE,EAAcF,EAAU,CAAC,EAC3B,OAAAN,EACE,UAAY,CACVO,EAAK,MAAQF,EACbE,EAAK,YAAcH,EACnBK,EAAuBF,CAAI,GAAKC,EAAY,CAAE,KAAMD,CAAI,CAAE,CAChE,EACI,CAACJ,EAAWE,EAAOD,CAAW,GAEhCjG,EACE,UAAY,CACV,OAAAsG,EAAuBF,CAAI,GAAKC,EAAY,CAAE,KAAMD,CAAI,CAAE,EACnDJ,EAAU,UAAY,CAC3BM,EAAuBF,CAAI,GAAKC,EAAY,CAAE,KAAMD,CAAI,CAAE,CAClE,CAAO,CACP,EACI,CAACJ,CAAS,GAEZF,EAAcI,CAAK,EACZA,CACT,CACA,SAASI,EAAuBF,EAAM,CACpC,IAAIG,EAAoBH,EAAK,YAC7BA,EAAOA,EAAK,MACZ,GAAI,CACF,IAAII,EAAYD,EAAiB,EACjC,MAAO,CAACX,EAASQ,EAAMI,CAAS,CACpC,MAAkB,CACd,MAAO,EACX,CACA,CACA,SAASC,EAAuBT,EAAWC,EAAa,CACtD,OAAOA,EAAW,CACpB,CACA,IAAIS,EACc,OAAO,OAAvB,KACgB,OAAO,OAAO,SAA9B,KACgB,OAAO,OAAO,SAAS,cAAvC,IACID,EACAV,EACN,OAAAY,GAAA,qBACanB,EAAM,uBAAjB,OAAwCA,EAAM,qBAAuBkB,2CC9DrEE,GAAA,QAAiB5J,GAAA;;;;;;;;6CCQnB,IAAIwI,EAAQxI,GAAA,EACV0J,EAAOG,GAAA,EACT,SAASpB,EAAGC,EAAGC,EAAG,CAChB,OAAQD,IAAMC,IAAYD,IAAN,GAAW,EAAIA,IAAM,EAAIC,IAAQD,IAAMA,GAAKC,IAAMA,CACxE,CACA,IAAIC,EAA0B,OAAO,OAAO,IAA7B,WAAkC,OAAO,GAAKH,EAC3DqB,EAAuBJ,EAAK,qBAC5BK,EAASvB,EAAM,OACfxF,EAAYwF,EAAM,UAClBwB,EAAUxB,EAAM,QAChBM,EAAgBN,EAAM,cACxB,OAAAyB,GAAA,iCAA2C,SACzCjB,EACAC,EACAiB,EACAC,EACAC,EACA,CACA,IAAIC,EAAUN,EAAO,IAAI,EACzB,GAAaM,EAAQ,UAAjB,KAA0B,CAC5B,IAAIjB,EAAO,CAAE,SAAU,GAAI,MAAO,IAAI,EACtCiB,EAAQ,QAAUjB,CACtB,MAASA,EAAOiB,EAAQ,QACtBA,EAAUL,EACR,UAAY,CACV,SAASM,EAAiBC,EAAc,CACtC,GAAI,CAACC,EAAS,CAIZ,GAHAA,EAAU,GACVC,EAAmBF,EACnBA,EAAeJ,EAASI,CAAY,EACrBH,IAAX,QAAsBhB,EAAK,SAAU,CACvC,IAAIsB,EAAmBtB,EAAK,MAC5B,GAAIgB,EAAQM,EAAkBH,CAAY,EACxC,OAAQI,EAAoBD,CAC1C,CACU,OAAQC,EAAoBJ,CACtC,CAEQ,GADAG,EAAmBC,EACf/B,EAAS6B,EAAkBF,CAAY,EAAG,OAAOG,EACrD,IAAIE,EAAgBT,EAASI,CAAY,EACzC,OAAeH,IAAX,QAAsBA,EAAQM,EAAkBE,CAAa,GACvDH,EAAmBF,EAAeG,IAC5CD,EAAmBF,EACXI,EAAoBC,EACpC,CACM,IAAIJ,EAAU,GACZC,EACAE,EACAE,EACaX,IAAX,OAA+B,KAAOA,EAC1C,MAAO,CACL,UAAY,CACV,OAAOI,EAAiBrB,GAAa,CAC/C,EACiB4B,IAAT,KACI,OACA,UAAY,CACV,OAAOP,EAAiBO,GAAwB,CAC9D,EAEA,EACI,CAAC5B,EAAaiB,EAAmBC,EAAUC,CAAO,GAEpD,IAAIlB,EAAQY,EAAqBd,EAAWqB,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,EAClE,OAAArH,EACE,UAAY,CACVoG,EAAK,SAAW,GAChBA,EAAK,MAAQF,CACnB,EACI,CAACA,CAAK,GAERJ,EAAcI,CAAK,EACZA,CACT,2CCjFE4B,GAAA,QAAiB9K,GAAA,gDCEb,CAAE,cAAA8I,IAAkBiC,GACpB,CAAE,iCAAAC,IAAqCC,GAC7C,IAAIC,GAAyB,GAC7B,MAAMC,GAAYC,GAAQA,EAC1B,SAASC,GAAShD,EAAK8B,EAAWgB,GAAUG,EAAY,EACjD7I,GAAkB,aAAuB,UAAY,cAAgB6I,GAAc,CAACJ,KACvF,QAAQ,KACN,wNAAA,EAEFA,GAAyB,IAE3B,MAAMK,EAAQP,GACZ3C,EAAI,UACJA,EAAI,SACJA,EAAI,gBAAkBA,EAAI,gBAC1B8B,EACAmB,CAAA,EAEF,OAAAxC,GAAcyC,CAAK,EACZA,CACT,CACA,MAAMC,GAAc7D,GAAgB,EAC7BlF,GAAkB,aAAuB,UAAY,cAAgB,OAAOkF,GAAgB,YAC/F,QAAQ,KACN,iIAAA,EAGJ,MAAMU,EAAM,OAAOV,GAAgB,WAAaY,GAAYZ,CAAW,EAAIA,EACrE8D,EAAgB,CAACtB,EAAUmB,IAAeD,GAAShD,EAAK8B,EAAUmB,CAAU,EAClF,cAAO,OAAOG,EAAepD,CAAG,EACzBoD,CACT,EACMC,GAAU/D,GAAgBA,EAAc6D,GAAW7D,CAAW,EAAI6D,GC1BxE,IAAIG,GAAS,EAEN,MAAMC,GAAgBF,GAAoBG,IAAS,CACxD,OAAQ,CAAA,EACR,KAAM,CAACC,EAASC,IAASF,EAAKG,GAAM,CAClC,MAAMC,EAAKN,KACL1F,EAAW,CAAE,GAAAgG,EAAI,QAAAH,EAAS,KAAMC,GAAM,MAAQ,OAAQ,QAASA,GAAM,SAAW,GAAA,EAEtF,OAAI9F,EAAE,SAAWA,EAAE,QAAU,GAC3B,WAAW,IAAM,CACf4F,EAAKtI,IAAS,CAAE,OAAQA,EAAI,OAAO,OAAOmF,GAAKA,EAAE,KAAOuD,CAAE,CAAA,EAAI,CAChE,EAAGhG,EAAE,OAAO,EAEP,CAAE,OAAQ,CAAC,GAAG+F,EAAE,OAAQ/F,CAAC,CAAA,CAClC,CAAC,EACD,OAASgG,GAAOJ,EAAK,IAAO,CAAE,OAAQ,EAAE,OAAO,OAAO5F,GAAKA,EAAE,KAAOgG,CAAE,GAAI,EAC1E,MAAO,IAAMJ,EAAI,CAAE,OAAQ,CAAA,EAAI,CACjC,EAAE,EAEK,SAASK,IAAW,CAEzB,OADaN,GAAcI,GAAKA,EAAE,IAAI,CAExC,CC5BO,SAASG,GAAUC,EAAY,CACpC,OAAQA,GAAK,GAAG,QAAQ,CAAC,CAC3B,CCWA,MAAMC,GAAUC,GAAiB,aAAaA,CAAI,GAC5CC,GAAgBD,GAAiB,gBAAgBA,CAAI,GAGpD,SAASE,GAAWF,EAA6B,CACtD,GAAI,CACF,MAAM7K,EAAM,aAAa,QAAQ4K,GAAOC,CAAI,CAAC,EAC7C,GAAI,CAAC7K,EAAK,MAAO,CAAE,MAAO,EAAG,OAAQ,CAAA,EACrC,MAAMgL,EAAS,KAAK,MAAMhL,CAAG,EAC7B,MAAO,CACL,MAAO,OAAOgL,EAAO,KAAK,GAAK,EAC/B,OAAQ,OAAOA,EAAO,MAAM,GAAK,EACjC,QAAS,OAAOA,EAAO,OAAO,GAAK,EACnC,SAAU,OAAOA,EAAO,QAAQ,GAAK,EACrC,MAAO,OAAOA,EAAO,OAAU,SAAWA,EAAO,MAAQ,EACzD,OAAQ,OAAOA,EAAO,QAAW,SAAWA,EAAO,OAAS,EAC5D,aAAc,OAAOA,EAAO,cAAiB,SAAWA,EAAO,aAAe,EAC9E,aAAc,OAAOA,EAAO,cAAiB,SAAWA,EAAO,aAAe,EAC9E,cAAe,OAAOA,EAAO,eAAkB,SAAWA,EAAO,cAAgB,EACjF,UAAW,OAAOA,EAAO,WAAc,SAAWA,EAAO,UAAY,EACrE,WAAY,OAAOA,EAAO,YAAe,SAAWA,EAAO,WAAa,CAAA,CAE5E,MAAQ,CACN,MAAO,CAAE,MAAO,EAAG,OAAQ,CAAA,CAC7B,CACF,CAqBO,SAASC,GAAcJ,EAAsB,CAClD,KAAM,CAAE,MAAAK,EAAO,OAAAC,GAAWJ,GAAWF,CAAI,EACzC,OAAKK,EACGC,EAASD,EAAS,EADP,CAErB,CAEO,SAASE,GAAuBP,EAAsB,CAC3D,KAAM,CAAE,QAAAQ,EAAU,EAAG,SAAAC,EAAW,CAAA,EAAMP,GAAWF,CAAI,EACrD,OAAKQ,EACGC,EAAWD,EAAW,EADT,CAEvB,CAiBA,MAAME,GAAe,sBAEd,SAASC,GAAiBC,EAAuC,CACtE,IAAIC,EAAqB,CAAA,EACzB,GAAI,CACF,MAAM1L,EAAM,aAAa,QAAQuL,EAAY,EACzCvL,IAAK0L,EAAM,KAAK,MAAM1L,CAAG,EAC/B,MAAQ,CAAC,CAET,GAAI,MAAM,QAAQyL,CAAW,EAC3B,UAAWjN,KAAKiN,EACTC,EAAIlN,CAAC,IAAGkN,EAAIlN,CAAC,EAAI,CAAE,OAAQ,EAAG,IAAK,CAAA,GAG5C,OAAOkN,CACT,CAEO,SAASC,GAAiBC,EAAsB,CACrD,GAAI,CACF,aAAa,QAAQL,GAAc,KAAK,UAAUK,CAAK,CAAC,EACxD,OAAO,cAAc,IAAI,YAAY,oBAAqB,CAAE,OAAQ,CAAE,UAAW,EAAA,CAAK,CAAG,CAAC,CAC5F,MAAQ,CAAC,CACX,CAEO,SAASC,GAAaC,EAAcC,EAAc,CACvD,MAAMC,EAAUR,GAAA,EACVS,EAAQD,EAAQF,CAAI,GAAK,CAAE,OAAQ,EAAG,IAAK,CAAA,EACjDG,EAAM,QAAU,EACZF,MAAW,KAAO,GACtBC,EAAQF,CAAI,EAAIG,EAChBN,GAAiBK,CAAO,CAC1B,CAGA,SAASE,GAAUrB,EAA2B,CAC5C,GAAI,CACF,MAAM7K,EAAM,aAAa,QAAQ8K,GAAaD,CAAI,CAAC,EACnD,GAAI,CAAC7K,EAAK,MAAO,CAAA,EACjB,MAAMmM,EAAM,KAAK,MAAMnM,CAAG,EAC1B,OAAK,MAAM,QAAQmM,CAAG,EACfA,EAAI,IAAKjN,IAAY,CAC1B,EAAG,OAAOA,EAAE,CAAC,GAAG,EAChB,MAAO,OAAOA,EAAE,KAAK,GAAG,EACxB,OAAQ,OAAOA,EAAE,MAAM,GAAG,EAC1B,QAAS,OAAOA,EAAE,OAAO,GAAG,EAC5B,SAAU,OAAOA,EAAE,QAAQ,GAAG,CAAA,EAC9B,EAAE,OAAOA,GAAKA,EAAE,EAAI,CAAC,EAPS,CAAA,CAQlC,MAAQ,CAAE,MAAO,CAAA,CAAG,CACtB,CAEA,SAASkN,GAAUvB,EAAcwB,EAAsB,CACrD,GAAI,CACF,aAAa,QAAQvB,GAAaD,CAAI,EAAG,KAAK,UAAUwB,CAAO,CAAC,EAChE,OAAO,cAAc,IAAI,YAAY,oBAAqB,CAAE,OAAQ,CAAE,KAAAxB,CAAA,CAAK,CAAG,CAAC,CACjF,MAAQ,CAAC,CACX,CAEA,SAASyB,GAASD,EAAsBE,EAA+B,CACrE,MAAMC,EAAM,KAAK,IAAA,EACjB,OAAOH,EAAQ,OAAOnN,GAAKsN,EAAMtN,EAAE,GAAKqN,CAAQ,CAClD,CAEO,SAASE,GAAU5B,EAAcK,EAAeC,EAAgBuB,EAAe,KAAK,IAAA,EAAOrB,EAAkBC,EAAmB,CACrI,GAAIJ,GAAS,EAAG,OAChB,MAAMyB,EAAOT,GAAUrB,CAAI,EACrBtK,EAAO+L,GAAS,CAAC,GAAGK,EAAM,CAAE,EAAGD,EAAM,MAAAxB,EAAO,OAAAC,EAAQ,QAAAE,EAAS,SAAAC,EAAU,EAAG,IAAO,GAAK,GAAK,GAAK,EAAE,EACxGc,GAAUvB,EAAMtK,CAAI,CACtB,CAEO,SAASqM,GAAc/B,EAAcgC,EAAmB,IAAO,GAAK,GAAK,GAAY,CAC1F,MAAMF,EAAOT,GAAUrB,CAAI,EAC3B,GAAI,CAAC8B,EAAK,OAAQ,MAAO,GACzB,MAAMH,EAAM,KAAK,IAAA,EACjB,IAAItB,EAAQ,EAAGC,EAAS,EACxB,UAAWjM,KAAKyN,EACVH,EAAMtN,EAAE,GAAK2N,IAAY3B,GAAShM,EAAE,MAAOiM,GAAUjM,EAAE,QAE7D,OAAIgM,GAAS,EAAU,EACfC,EAASD,EAAS,CAC5B,CAEO,SAAS4B,GAAuBjC,EAAcgC,EAAmB,IAAO,GAAK,GAAK,GAAK,GAAY,CACxG,MAAMF,EAAOT,GAAUrB,CAAI,EAC3B,GAAI,CAAC8B,EAAK,OAAQ,MAAO,GACzB,MAAMH,EAAM,KAAK,IAAA,EACjB,IAAItB,EAAQ,EAAGC,EAAS,EACxB,UAAWjM,KAAKyN,EACVH,EAAMtN,EAAE,GAAK2N,IACf3B,GAAUhM,EAAE,SAAW,EACvBiM,GAAWjM,EAAE,UAAY,GAG7B,OAAIgM,GAAS,EAAU,EACfC,EAASD,EAAS,CAC5B,CAkCO,SAAS6B,GAAelC,EAAsB,CAEnD,MAAM8B,EAAOT,GAAUrB,CAAI,EAC3B,GAAI,CAAC8B,EAAK,OAAQ,MAAO,GACzB,MAAMH,EAAM,KAAK,IAAA,EAEXQ,EAAWL,EAAK,UAAYH,EAAMtN,EAAE,GAAK,MAAW,EACpD+N,EAAYD,EAAS,UAAY,OAAO9N,EAAE,SAAY,QAAQ,EAC9DgO,EAAMD,EAAU,OAASA,EAAYD,EAC3C,IAAI9B,EAAQ,EAAGC,EAAS,EACxB,UAAWjM,KAAKgO,EAAOhC,GAAShM,EAAE,MAAOiM,GAAUjM,EAAE,OACrD,OAAIgM,GAAS,EAAU,EACfC,EAASD,EAAS,CAC5B,CACO,SAASiC,GAAuBtC,EAAsB,CAE3D,OAAOiC,GAAuBjC,EAAM,MAAW,CACjD,CC/JA,MAAMtL,GAAM,oBAEZ,SAAS6N,IAAilB,CACxlB,GAAI,CACF,MAAMpN,EAAM,aAAa,QAAQT,EAAG,EACtC,GAAI,CAACS,EAAK,MAAO,CAAE,eAAgB,MAAO,cAAe,GAAM,YAAa,GAAI,aAAc,EAAG,kBAAmB,GAAO,QAAS,WAAY,iBAAkB,GAAO,oBAAqB,GAAM,YAAa,CAAE,KAAM,MAAO,SAAU,IAAK,QAAS,EAAG,QAAS,MAAA,EAAU,cAAe,GAAO,cAAe,GAAO,cAAe,GAAM,YAAa,EAAK,aAAc,OAAQ,cAAe,MAAO,iBAAkB,GAAM,kBAAmB,OAAW,qBAAsB,OAAW,cAAe,GAAM,cAAe,SAAU,kBAAmB,WAAY,eAAgB,GAAI,SAAU,SAAU,QAAS,SAAU,UAAW,UAAW,UAAW,SAAU,UAAW,SAAU,iBAAkB,GAAO,iBAAkB,GAAI,YAAa,EAAA,EACtuB,MAAMqN,EAAI,KAAK,MAAMrN,CAAG,EACxB,MAAO,CACL,eAAgBqN,EAAE,gBAAkB,MACpC,cAAe,OAAOA,EAAE,eAAkB,UAAYA,EAAE,cAAgB,GACxE,YAAaA,EAAE,aAAe,GAC9B,aAAe,OAAOA,EAAE,cAAiB,SAAY,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAE,YAAY,CAAC,EAAI,EAChG,kBAAmB,CAAC,CAACA,EAAE,kBACvB,QAASA,EAAE,UAAY,MAAQ,MAAQ,WACvC,iBAAkB,CAAC,CAACA,EAAE,iBACtB,oBAAsB,OAAOA,EAAE,qBAAwB,UAAaA,EAAE,oBAAsB,GAC5F,YAAaA,EAAE,aAAe,OAAOA,EAAE,aAAgB,SAAW,CAChE,KAAMA,EAAE,YAAY,MAAQ,MAC5B,SAAU,OAAOA,EAAE,YAAY,QAAQ,GAAK,IAC5C,QAAS,OAAOA,EAAE,YAAY,OAAO,GAAK,EAC1C,QAASA,EAAE,YAAY,SAAW,MAAA,EAChC,CAAE,KAAM,MAAO,SAAU,IAAK,QAAS,EAAG,QAAS,MAAA,EACvD,cAAe,CAAC,CAACA,EAAE,cACnB,cAAe,CAAC,CAACA,EAAE,cACnB,cAAgB,OAAOA,EAAE,eAAkB,UAAaA,EAAE,cAAgB,GAC9E,YAAc,OAAOA,EAAE,aAAgB,UAAY,SAASA,EAAE,WAAW,EAAK,KAAK,IAAI,GAAK,KAAK,IAAI,KAAMA,EAAE,WAAW,CAAC,EAAI,EAC7H,aAAcA,EAAE,eAAiB,SAAW,SAAW,OACvD,cAAgBA,EAAE,gBAAkB,OAASA,EAAE,gBAAkB,OAAUA,EAAE,cAAgB,MAC7F,kBAAoBA,EAAE,oBAAsB,cAAiB,cAAiBA,EAAE,oBAAsB,SAAW,SAAW,WAC5H,eAAgB,OAAOA,EAAE,gBAAmB,SAAWA,EAAE,eAAiB,GACtE,iBAAmB,OAAOA,EAAE,kBAAqB,UAAaA,EAAE,iBAAmB,GACvF,kBAAmB,OAAOA,EAAE,mBAAsB,SAAWA,EAAE,kBAAoB,OACnF,qBAAsB,OAAOA,EAAE,sBAAyB,SAAWA,EAAE,qBAAuB,OAC5F,sBAAwB,OAAOA,EAAE,uBAA0B,UAAaA,EAAE,sBAAwB,GAC9F,cAAgB,OAAOA,EAAE,eAAkB,UAAaA,EAAE,cAAgB,GAC1E,cAAeA,EAAE,gBAAkB,UAAY,UAAY,SAC3D,SAAWA,EAAE,WAAa,SAAWA,EAAE,WAAa,QAAWA,EAAE,SAAW,SAC5E,QAAUA,EAAE,UAAY,SAAWA,EAAE,UAAY,QAAWA,EAAE,QAAU,SACxE,UAAYA,EAAE,YAAc,UAAa,UAAY,UACrD,UAAW,OAAOA,EAAE,WAAc,SAAWA,EAAE,UAAY,SAC3D,UAAW,OAAOA,EAAE,WAAc,SAAWA,EAAE,UAAY,SAC3D,iBAAmB,OAAOA,EAAE,kBAAqB,UAAaA,EAAE,iBAAmB,GACnF,iBAAmB,OAAOA,EAAE,kBAAqB,UAAY,SAASA,EAAE,gBAAgB,EAAK,KAAK,IAAI,EAAG,KAAK,IAAI,GAAIA,EAAE,gBAAgB,CAAC,EAAI,GAC7I,YAAc,OAAOA,EAAE,aAAgB,UAAaA,EAAE,YAAc,EAAA,CAExE,MAAQ,CACR,MAAO,CAAE,eAAgB,MAAO,cAAe,GAAM,YAAa,GAAI,aAAc,EAAG,kBAAmB,GAAO,QAAS,WAAY,iBAAkB,GAAO,oBAAqB,GAAM,YAAa,CAAE,KAAM,MAAO,SAAU,IAAK,QAAS,EAAG,QAAS,MAAA,EAAU,cAAe,GAAO,cAAe,GAAO,cAAe,GAAM,YAAa,EAAK,aAAc,OAAQ,cAAe,MAAO,iBAAkB,GAAM,kBAAmB,OAAW,qBAAsB,OAAW,sBAAuB,GAAO,cAAe,GAAM,cAAe,SAAU,kBAAmB,WAAY,eAAgB,GAAI,SAAU,SAAU,QAAS,SAAU,UAAW,UAAW,UAAW,SAAU,UAAW,SAAU,iBAAkB,GAAO,iBAAkB,GAAI,YAAa,EAAA,CAC5vB,CACF,CAEA,SAASC,GAAKhH,EAAiC,CAC7C,GAAI,CACF,MAAMiH,EAAOH,GAAA,EACb,aAAa,QAAQ7N,GAAK,KAAK,UAAU,CAAE,GAAGgO,EAAM,GAAGjH,CAAA,CAAS,CAAC,CACnE,MAAQ,CAAC,CACX,CAEO,MAAMkH,GAAkBvD,GAAsB,CAACG,EAAKqD,KAAS,CAClE,GAAGL,GAAA,EACH,kBAAoBnO,GAAM,CAAEqO,GAAK,CAAE,eAAgBrO,EAAG,EAAGmL,EAAI,CAAE,eAAgBnL,EAAG,CAAE,EACpF,iBAAmB4B,GAAM,CAAEyM,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EACjF,eAAiBgK,GAAS,CAAEyC,GAAK,CAAE,YAAazC,EAAM,EAAGT,EAAI,CAAE,YAAaS,EAAM,CAAE,EACpF,WAAaiB,GAAS,CAAEwB,GAAK,CAAE,QAASxB,EAAM,EAAG1B,EAAI,CAAE,QAAS0B,EAAM,CAAE,EACxE,gBAAkBjL,GAAM,CAAE,MAAM6M,EAAM,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG7M,CAAC,CAAC,EAAGyM,GAAK,CAAE,aAAcI,EAAK,EAAGtD,EAAI,CAAE,aAAcsD,EAAK,CAAE,EAC3H,qBAAuB7M,GAAM,CAAEyM,GAAK,CAAE,kBAAmBzM,EAAG,EAAGuJ,EAAI,CAAE,kBAAmBvJ,EAAG,CAAE,EAC7F,oBAAsBA,GAAM,CAAEyM,GAAK,CAAE,iBAAkBzM,EAAG,EAAGuJ,EAAI,CAAE,iBAAkBvJ,EAAG,CAAE,EAC1F,uBAAyBA,GAAM,CAAEyM,GAAK,CAAE,oBAAqBzM,EAAG,EAAGuJ,EAAI,CAAE,oBAAqBvJ,EAAG,CAAE,EACnG,eAAiB8M,GAAQ,CAAmC,MAAMpN,EAAO,CAAE,GAAnC6M,KAAO,YAAqC,GAAGO,CAAA,EAAOL,GAAK,CAAE,YAAa/M,EAAM,EAAG6J,EAAI,CAAE,YAAa7J,EAAM,CAAE,EACtJ,iBAAmBM,GAAM,CAAEyM,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EACjF,iBAAmBA,GAAM,CAAEyM,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EACjF,iBAAmBA,GAAM,CAAEyM,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EAEjF,0BAA2B,GAC3B,6BAA+BA,GAAe,CAAEyM,GAAK,CAAA,CAAS,EAAGlD,EAAI,CAAE,0BAA2BvJ,EAAG,CAAE,EACvG,eAAiB8J,GAAM,CAAE,MAAMJ,EAAI,KAAK,IAAI,GAAK,KAAK,IAAI,KAAMI,CAAC,CAAC,EAAG2C,GAAK,CAAE,YAAa/C,EAAG,EAAGH,EAAI,CAAE,YAAaG,EAAG,CAAE,EACvH,gBAAkBzL,GAAM,CAAE,MAAM+B,EAAK/B,IAAM,SAAY,SAAW,OAAQwO,GAAK,CAAE,aAAczM,EAAG,EAAGuJ,EAAI,CAAE,aAAcvJ,EAAG,CAAE,EAC9H,iBAAmBnC,GAAM,CAAE,MAAMmC,EAAKnC,IAAM,MAAS,MAAQ,OAAQ4O,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EAC3H,qBAAuBlC,GAAM,CAAE2O,GAAK,CAAE,kBAAmB3O,EAAG,EAAGyL,EAAI,CAAE,kBAAmBzL,EAAG,CAAE,EAC7F,kBAAoBsB,GAAM,CAAEqN,GAAK,CAAE,eAAgBrN,EAAG,EAAGmK,EAAI,CAAE,eAAgBnK,EAAG,CAAE,EACpF,oBAAsBY,GAAM,CAAEyM,GAAK,CAAE,iBAAkBzM,EAAG,EAAGuJ,EAAI,CAAE,iBAAkBvJ,EAAG,CAAE,EAC1F,mBAAoB,CAAC2J,EAAI9E,EAAOzE,EAAQ,KAAU,CAChD,GAAI,CACF,MAAMkF,EAAQsH,EAAA,EAEd,GADA,QAAQ,IAAI,4CAA6C,CAAE,GAAAjD,EAAI,MAAA9E,EAAO,MAAAzE,EAAO,OAAQkF,EAAM,sBAAuB,EAC9GA,EAAM,uBAAyB,CAAClF,EAAO,CAEzC,QAAQ,IAAI,yEAAyE,EACrF,MACF,CACF,MAAQ,CAAC,CACT,QAAQ,IAAI,0CAA2C,CAAE,GAAAuJ,EAAI,MAAA9E,EAAO,EACpE4H,GAAK,CAAE,kBAAmB9C,EAAI,qBAAsB9E,EAAO,EAC3D0E,EAAI,CAAE,kBAAmBI,EAAI,qBAAsB9E,EAAO,CAC5D,EACA,yBAA2B7E,GAAM,CAAEyM,GAAK,CAAE,sBAAuBzM,EAAG,EAAGuJ,EAAI,CAAE,sBAAuBvJ,EAAG,CAAE,EACzG,iBAAmBA,GAAM,CAAEyM,GAAK,CAAE,cAAezM,EAAG,EAAGuJ,EAAI,CAAE,cAAevJ,EAAG,CAAE,EACjF,iBAAmBiL,GAAS,CAAEwB,GAAK,CAAE,cAAexB,EAAM,EAAG1B,EAAI,CAAE,cAAe0B,EAAM,CAAE,EAC1F,YAAc8B,GAAS,CAAEN,GAAK,CAAE,SAAUM,EAAM,EAAGxD,EAAI,CAAE,SAAUwD,EAAM,CAAE,EAC3E,WAAaA,GAAS,CAAEN,GAAK,CAAE,QAASM,EAAM,EAAGxD,EAAI,CAAE,QAASwD,EAAM,CAAE,EACxE,aAAepJ,GAAM,CAAE,MAAM3D,EAAK2D,IAAM,UAAa,UAAY,UAAW8I,GAAK,CAAE,UAAWzM,EAAG,EAAGuJ,EAAI,CAAE,UAAWvJ,EAAG,CAAE,EAC1H,aAAegK,GAAS,CAAE,MAAMhK,EAAIgK,GAAM,KAAA,GAAU,SAAUyC,GAAK,CAAE,UAAWzM,EAAG,EAAGuJ,EAAI,CAAE,UAAWvJ,EAAG,CAAE,EAC5G,aAAegK,GAAS,CAAE,MAAMhK,EAAIgK,GAAM,KAAA,GAAU,SAAUyC,GAAK,CAAE,UAAWzM,EAAG,EAAGuJ,EAAI,CAAE,UAAWvJ,EAAG,CAAE,EAC5G,oBAAsBA,GAAM,CAAEyM,GAAK,CAAE,iBAAkBzM,EAAG,EAAGuJ,EAAI,CAAE,iBAAkBvJ,EAAG,CAAE,EAC1F,oBAAsB8J,GAAM,CAAE,MAAMJ,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,KAAK,MAAMI,CAAC,CAAC,CAAC,EAAG2C,GAAK,CAAE,iBAAkB/C,EAAG,EAAGH,EAAI,CAAE,iBAAkBG,EAAG,CAAE,EAC9I,eAAiB1J,GAAM,CAAEyM,GAAK,CAAE,YAAazM,EAAG,EAAGuJ,EAAI,CAAE,YAAavJ,EAAG,CAAE,CAC7E,EAAE,EC9KF,SAASgN,GAAMC,EAAa,CAC1B,GAAI,CAAE,OAAO,cAAc,IAAI,YAAY,iBAAkB,CAAE,OAAQ,CAAE,IAAAA,CAAA,CAAI,CAAG,CAAC,CAAE,MAAQ,CAAC,CAC9F,CAEA,MAAMC,GAAW,wBAEjB,SAAwBC,GAAK,CAAE,KAAAxO,GAAwB,CACrD,KAAM,CAACyO,EAAWC,CAAY,EAAI5M,EAAAA,SAAS,EAAK,EAC1C,CAAC6M,EAAWC,CAAY,EAAI9M,EAAAA,SAAS,EAAK,EAC1C,CAAC+M,EAAMC,CAAO,EAAIhN,EAAAA,SAAiB,EAAE,EACrC,CAAE,YAAAiN,CAAA,EAAgBf,GAAA,EAClBgB,EAAQ/D,GAAA,EAGdlJ,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMkN,EAAkB,CACtB,0DACA,qDACA,oDACA,6DACA,2DACA,kEACA,uEACA,kEACA,8DACA,oEAAA,EAEIhK,EAAM,KAAK,MAAM,KAAK,OAAA,EAAWgK,EAAM,MAAM,EACnDH,EAAQG,EAAMhK,CAAG,CAAC,CACpB,EAAG,CAAA,CAAE,EAEHmB,OAAC,OAAI,UAAW,GAAGpG,GAAM,WAAa,eAAiB,EAAE,oFAEvD,SAAA,CAAAoG,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,iGAAiG,EAChHA,EAAAA,IAAC,MAAA,CAAI,UAAU,gGAAgG,EAC/GA,EAAAA,IAAC,MAAA,CAAI,UAAU,oGAAoG,CAAA,EACrH,EAGJD,EAAAA,KAAC,MAAA,CAAI,UAAU,iKACf,SAAA,OAAC,KAAA,CAAG,UAAU,sNAAsN,SAAA,8BAA2B,QAC9P,IAAA,CAAE,UAAU,gGAAgG,SAAA,2DAAwD,QACpK,IAAA,CAAE,UAAU,gGAAgG,SAAA,sDAAmD,EAGzJyI,SACE,MAAA,CAAI,UAAU,mCACb,SAAAzI,EAAAA,KAAC,MAAA,CAAI,UAAU,0JACb,SAAA,OAAC,OAAA,CAAK,UAAU,qCAAqC,SAAA,gBAAa,EAAO,UAAE,OAAA,CAAK,UAAU,kCAAmC,SAAAyI,EAAK,CAAA,CAAA,CACpI,CAAA,CACF,EAGRzI,EAAAA,KAAC,MAAA,CAAI,UAAU,8FACP,SAAA,CAAAA,EAAAA,KAAC,SAAA,CACC,QAAS,IAAI,CAEXiI,GAAM,SAAS,EACf,GAAI,CAEF,OAAO,cAAc,IAAI,YAAY,qBAAsB,CACzD,OAAQ,CACN,WAAY,QACZ,YAAa,OAAOU,GAAa,OAAO,GAAK,EAC7C,WAAY,OAAOA,GAAa,QAAQ,GAAK,GAAA,CAC/C,CACD,CAAC,CACJ,MAAQ,CAAC,CACT,GAAI,CAEF,WAAW,IAAM,CACf,OAAO,cAAc,IAAI,YAAY,iBAAkB,CACrD,OAAQ,CAAE,KAAMA,GAAa,MAAQ,KAAA,CAAM,CAC5C,CAAC,CACJ,EAAG,EAAE,CACP,MAAQ,CAAC,CACX,EACA,UAAU,6TAEV,SAAA,OAAC,OAAA,CAAK,cAAW,GAAC,SAAA,KAAE,EAAO,kBAAA,CAAA,CAAA,EAE7B3I,EAAAA,KAAC,SAAA,CACC,QAAS,IAAIiI,GAAM,OAAO,EAC1B,UAAU,2TAEV,SAAA,OAAC,OAAA,CAAK,cAAW,GAAC,SAAA,KAAE,EAAO,aAAA,CAAA,CAAA,EAE7BjI,EAAAA,KAAC,SAAA,CACC,QAAS,IAAIiI,GAAM,QAAQ,EAC3B,UAAU,0TAEV,SAAA,OAAC,OAAA,CAAK,cAAW,GAAC,SAAA,KAAE,EAAO,oBAAA,CAAA,CAAA,EAE7BjI,EAAAA,KAAC,SAAA,CACC,QAAS,IAAI,CAAEiI,GAAM,SAAS,EAAG,GAAI,CAAE,OAAO,cAAc,IAAI,YAAY,iBAAkB,CAAE,OAAQ,CAAE,KAAM,iBAAA,CAAkB,CAAG,CAAC,CAAE,MAAQ,CAAC,CAAE,EACnJ,UAAU,2TAEV,SAAA,OAAC,OAAA,CAAK,cAAW,GAAC,SAAA,KAAE,EAAO,mBAAA,CAAA,CAAA,CAC7B,EACF,GAKE,IAAM,CACN,MAAMhD,EAAOrL,GAAM,UAAY,WACzBkP,EAAM3D,GAAWF,CAAI,EACrB8D,EAAY,CAAC,CAACnP,GAAM,WACpBoP,EAAO,8DACPC,EAAM,CAAC,CAAE,MAAAnJ,EAAO,KAAAoJ,EAAM,MAAAC,EAAO,KAAAC,KACjCpJ,EAAAA,KAAC,MAAA,CAAI,UAAW,YAAYgJ,CAAI,sCAAsCI,EAAO,oDAAsD,8CAA8C,QAC/K,SAAA,OAAC,MAAA,CAAI,UAAU,wCAAyC,SAAAtJ,EAAM,EAC9DG,EAAAA,IAAC,OAAI,UAAW,qCAAqCmJ,EAAO,0BAA4B,EAAE,GAAK,SAAAF,CAAA,CAAK,EACpGjJ,EAAAA,IAAC,OAAI,UAAW,qCAAqCmJ,EAAO,0BAA4B,EAAE,GAAK,SAAAD,CAAA,CAAM,EACpGC,GACCnJ,EAAAA,IAAC,SAAA,CACC,UAAU,gHACV,QAAS,SAAY,CACnB,GAAI,CAMF,MAAMoJ,EAAO,MALD,MAAM,MAAM,GAAGlB,EAAO,sCAAuC,CACvE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CAAE,MAAOvO,EAAK,MAAO,CAAA,CAC3C,GACsB,KAAA,EACnByP,EAAK,IAAMA,EAAK,IAClB,OAAO,SAAS,KAAOA,EAAK,IACnBA,EAAK,QAAU,wBACxBT,EAAM,oHAAqH,CAAE,KAAM,QAAS,QAAS,IAAM,EAE3JA,EAAM,uDAAwD,CAAE,KAAM,QAAS,QAAS,IAAM,CAElG,MAAc,CACZA,EAAM,6CAA8C,CAAE,KAAM,QAAS,QAAS,IAAM,CACtF,CACF,EACA,MAAM,sBAEN,eAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,iBAAc,CAAA,CAAA,CAC5D,EAEJ,EAEF,OACE5I,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,QAAC,MAAA,CAAI,UAAW,GAAGgJ,CAAI,yDACrB,SAAA,OAAC,MAAA,CAAI,UAAU,oCAAoC,SAAA,QAAK,QACvD,MAAA,CAAI,UAAU,wCAAwC,SAAA,OAAI,QAC1D,MAAA,CAAI,UAAU,wCAAwC,SAAA,QAAK,CAAA,EAC9D,QACCC,EAAA,CAAI,MAAM,aAAa,KAAMnE,GAAUgE,EAAI,OAAO,CAAC,EAAG,MAAOhE,GAAUgE,EAAI,QAAQ,CAAC,EAAG,QACvFG,EAAA,CAAI,MAAM,aAAa,KAAMnE,GAAUgE,EAAI,WAAW,CAAC,EAAG,MAAOhE,GAAUgE,EAAI,YAAY,CAAC,EAAG,KAAM,CAACC,EAAW,QACjHE,EAAA,CAAI,MAAM,cAAc,KAAM,OAAOH,EAAI,cAAc,CAAC,EAAG,MAAO,OAAOA,EAAI,eAAe,CAAC,EAAG,KAAM,CAACC,EAAW,QAClHE,EAAA,CAAI,MAAM,WAAW,KAAM,OAAOH,EAAI,cAAc,CAAC,EAAG,MAAO,IAAK,KAAM,CAACC,EAAW,CAAA,EACzF,CAEJ,GAAA,EAEN9I,EAAAA,IAAC,UAAO,UAAU,2QAA2Q,QAAS,IAAMuI,EAAa,EAAI,EAAG,SAAA,+BAAA,CAA6B,CAAA,EACzV,QAGC,SAAA,CAAO,UAAU,6JAChB,SAAAxI,EAAAA,KAAC,SAAA,CAAO,UAAU,+DAA+D,QAAS,IAAMsI,EAAa,EAAI,EAC/G,SAAA,CAAArI,EAAAA,IAAC,QAAK,SAAA,IAAC,QACN,OAAA,CAAK,MAAO,CAAE,cAAe,QAAA,EAAY,SAAA,gBAAA,CAAc,CAAA,CAAA,CAC1D,CAAA,CACF,EAGCoI,SACE,MAAA,CAAI,UAAU,6EACb,SAAArI,EAAAA,KAAC,MAAA,CAAI,UAAU,2FACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,0EAA0E,QAAS,IAAMqI,EAAa,EAAK,EAAG,SAAA,OAAA,CAAK,QACpI,KAAA,CAAG,UAAU,yBAAyB,SAAA,oBAAiB,EACxDtI,EAAAA,KAAC,KAAA,CAAG,UAAU,sBACZ,SAAA,CAAAC,EAAAA,IAAC,MAAG,SAAA,sEAAmE,EACvEA,EAAAA,IAAC,MAAG,SAAA,2EAAwE,SAC3E,KAAA,CAAG,SAAA,CAAA,eAAa,IAAI,KAAA,EAAO,YAAA,EAAc,uCAAA,EAAqC,EAC/EA,EAAAA,IAAC,MAAG,SAAA,sCAAmC,CAAA,EACzC,QACC,IAAA,CAAE,UAAU,0BAA0B,SAAA,qEAAkE,CAAA,CAAA,CAC3G,CAAA,CACF,EAIDsI,SACE,MAAA,CAAI,UAAU,6EACb,SAAAvI,EAAAA,KAAC,MAAA,CAAI,UAAU,2FACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,UAAU,0EAA0E,QAAS,IAAMuI,EAAa,EAAK,EAAG,SAAA,OAAA,CAAK,QACpI,KAAA,CAAG,UAAU,yBAAyB,SAAA,kBAAe,EACtDxI,EAAAA,KAAC,KAAA,CAAG,UAAU,sBACZ,SAAA,CAAAC,EAAAA,IAAC,MAAG,SAAA,sDAAmD,EACvDA,EAAAA,IAAC,MAAG,SAAA,kDAA+C,EACnDA,EAAAA,IAAC,MAAG,SAAA,uDAAoD,EACxDA,EAAAA,IAAC,MAAG,SAAA,sDAAmD,EACvDA,EAAAA,IAAC,MAAG,SAAA,0DAAuD,CAAA,EAC7D,QACC,IAAA,CAAE,UAAU,0BAA0B,SAAA,8DAA2D,CAAA,CAAA,CACpG,CAAA,CACF,CAAA,EAEJ,CAEJ,CC/MA,SAAwBqJ,GAAW,CAAE,SAAAC,EAAU,UAAA7K,EAAW,MAAA8K,GAA0B,CAClF,MAAMC,EAAM/G,EAAAA,OAA8B,IAAI,EAG9C/G,OAAAA,EAAAA,UAAU,IAAM,CACd,IAAI+N,EAAM,EACV,MAAMC,EAAa,IAAM,CACvB,MAAMC,EAAUH,EAAI,QACpB,GAAI,CAACG,EAAS,OAClB,MAAMC,EAAS,SAAS,eAAe,YAAY,EAC/C,GAAI,CAACA,EAAQ,CACXD,EAAQ,MAAM,SAAW,GACzB,MACF,CACC,MAAME,EAAW,SAAS,eAAe,iBAAiB,EACpDC,EAAYD,EAAWA,EAAS,UAAa,OAAO,SAAW,EAK/DE,EAAUH,EAAO,sBAAA,EAAwB,OACzCI,EAAUF,EAAY,EAAIC,EAAU,EAC1C,GAAI,CAEF,IAAIE,EAAON,EAAQ,cAAc,qBAAqB,EACjDM,IACHA,EAAO,SAAS,cAAc,KAAK,EACnCA,EAAK,aAAa,oBAAqB,GAAG,EAE1C,OAAO,OAAOA,EAAK,MAAO,CACxB,SAAU,WACV,KAAM,MACN,MAAO,MACP,IAAK,MACL,OAAQ,MACR,cAAe,OACf,OAAQ,KACR,WAAY,gEAAA,CACb,EACDN,EAAQ,MAAM,SAAWA,EAAQ,MAAM,UAAY,WACnDA,EAAQ,aAAaM,EAAMN,EAAQ,UAAU,GAE3CK,EAAU,GACZC,EAAK,MAAM,OAAS,GAAGD,CAAO,KAC9BC,EAAK,MAAM,QAAU,KAErBA,EAAK,MAAM,OAAS,MACpBA,EAAK,MAAM,QAAU,QAGvBN,EAAQ,MAAM,UAAY,KAC5B,MAAY,CACVA,EAAQ,MAAM,UAAY,KAC5B,CACH,EACAD,EAAA,EACA,MAAMQ,EAAmB,IAAM,CACzBT,wBAA0BA,CAAG,EACjCA,EAAM,sBAAsBC,CAAU,CACxC,EAEMG,EAAW,SAAS,eAAe,iBAAiB,EAC5D,OAAAA,GAAU,iBAAiB,SAAUK,EAAyB,CAAE,QAAS,GAAa,EAEpF,OAAO,iBAAiB,SAAUA,EAAkB,CAAE,QAAS,GAAM,EACrE,OAAO,iBAAiB,SAAUA,CAAgB,EAC3C,IAAM,CACfL,GAAU,oBAAoB,SAAUK,CAAuB,EAC3D,OAAO,oBAAoB,SAAUA,CAAgB,EACrD,OAAO,oBAAoB,SAAUA,CAAgB,EACjDT,wBAA0BA,CAAG,CACnC,CACF,EAAG,CAAA,CAAE,EAGHzJ,EAAAA,IAAC,MAAA,CAAI,IAAAwJ,EAAU,UAAA/K,EAAsB,MAAA8K,EAClC,SAAAD,EACH,CAEJ,CChFA,MAAMa,GAAwC,CAAC,CAAE,oBAAAC,KAA0B,CACzE,KAAM,CAACC,EAAUC,CAAW,EAAI7O,EAAAA,SAAS,EAAK,EACxC,CAAC8O,EAAMC,CAAO,EAAI/O,EAAAA,SAAS,EAAK,EAEtCC,OAAAA,EAAAA,UAAU,IAAM,CACV0O,GACFE,EAAY,EAAI,EAChB,WAAW,IAAME,EAAQ,EAAI,EAAG,IAAI,IAEpCF,EAAY,EAAK,EACjBE,EAAQ,EAAK,EAEjB,EAAG,CAACJ,CAAmB,CAAC,EAGtBrK,EAAAA,KAAC,MAAA,CACC,UAAW,2FAA2FwK,EAAO,YAAc,aAAa,GACxI,MAAO,CAAE,cAAe,OAAQ,SAAU,WAAY,MAAO,EAAG,OAAQ,EAAA,EAExE,SAAA,CAAAxK,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,MAAM,KACN,OAAO,KACP,QAAQ,YACR,UAAW,qBAAqBqK,EAAW,YAAc,aAAa,mCACtE,MAAO,CAAE,WAAY,cAAA,EAGrB,gBAAC,IAAA,CACC,SAAA,CAAArK,EAAAA,IAAC,OAAA,CAAK,EAAE,KAAK,EAAE,KAAK,MAAM,IAAI,OAAO,KAAK,GAAG,IAAI,KAAK,UAAU,EAChEA,EAAAA,IAAC,UAAA,CAAQ,OAAO,oBAAoB,KAAK,UAAU,EACnDA,EAAAA,IAAC,OAAA,CAAK,EAAE,KAAK,EAAE,KAAK,MAAM,IAAI,OAAO,KAAK,GAAG,IAAI,KAAK,UAAU,EAChEA,EAAAA,IAAC,UAAA,CAAQ,OAAO,oBAAoB,KAAK,SAAA,CAAU,CAAA,CAAA,CACrD,CAAA,CAAA,EAEDqK,GACCtK,EAAAA,KAAC,MAAA,CAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,UAAU,WAAW,MAAO,CAAE,KAAM,EAAG,IAAK,GAC1F,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,GAAG,KAAK,GAAG,KAAK,EAAE,KAAK,KAAK,OAAO,OAAO,UAAU,YAAY,IAAI,EAC5EA,EAAAA,IAAC,WAAA,CAAS,OAAO,oBAAoB,KAAK,OAAO,OAAO,UAAU,YAAY,IAAI,cAAc,QAAQ,eAAe,OAAA,CAAQ,CAAA,CAAA,CACjI,CAAA,EAEJ,QACC,MAAA,CAAI,UAAU,6CACZ,SAAAqK,EAAW,wBAA0B,wBAAA,CACxC,CAAA,CAAA,CAAA,CAGN,iDCjDAI,GAAiB,UAAY,CAC3B,OAAO,OAAO,SAAY,YAAc,QAAQ,WAAa,QAAQ,UAAU,IACjF,4DCNA,IAAIC,EACJ,MAAMC,EAAkB,CACtB,EACA,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC1C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC7C,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KACtD,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IACxD,EAQAC,OAAAA,GAAA,cAAwB,SAAwBC,EAAS,CACvD,GAAI,CAACA,EAAS,MAAM,IAAI,MAAM,uCAAuC,EACrE,GAAIA,EAAU,GAAKA,EAAU,GAAI,MAAM,IAAI,MAAM,2CAA2C,EAC5F,OAAOA,EAAU,EAAI,EACvB,EAQAD,GAAA,wBAAkC,SAAkCC,EAAS,CAC3E,OAAOF,EAAgBE,CAAO,CAChC,EAQAD,GAAA,YAAsB,SAAUxB,EAAM,CACpC,IAAI0B,EAAQ,EAEZ,KAAO1B,IAAS,GACd0B,IACA1B,KAAU,EAGZ,OAAO0B,CACT,EAEAF,GAAA,kBAA4B,SAA4BnS,EAAG,CACzD,GAAI,OAAOA,GAAM,WACf,MAAM,IAAI,MAAM,uCAAuC,EAGzDiS,EAAiBjS,CACnB,EAEAmS,GAAA,mBAA6B,UAAY,CACvC,OAAO,OAAOF,EAAmB,GACnC,EAEAE,GAAA,OAAiB,SAAiBG,EAAO,CACvC,OAAOL,EAAeK,CAAK,CAC7B,8DC9DAC,EAAA,EAAY,CAAE,IAAK,CAAC,EACpBA,EAAA,EAAY,CAAE,IAAK,CAAC,EACpBA,EAAA,EAAY,CAAE,IAAK,CAAC,EACpBA,EAAA,EAAY,CAAE,IAAK,CAAC,EAEpB,SAASC,EAAYC,EAAQ,CAC3B,GAAI,OAAOA,GAAW,SACpB,MAAM,IAAI,MAAM,uBAAuB,EAKzC,OAFcA,EAAO,YAAW,EAEnB,CACX,IAAK,IACL,IAAK,MACH,OAAOF,EAAQ,EAEjB,IAAK,IACL,IAAK,SACH,OAAOA,EAAQ,EAEjB,IAAK,IACL,IAAK,WACH,OAAOA,EAAQ,EAEjB,IAAK,IACL,IAAK,OACH,OAAOA,EAAQ,EAEjB,QACE,MAAM,IAAI,MAAM,qBAAuBE,CAAM,CACnD,CACA,CAEAF,EAAA,QAAkB,SAAkBG,EAAO,CACzC,OAAOA,GAAS,OAAOA,EAAM,IAAQ,KACnCA,EAAM,KAAO,GAAKA,EAAM,IAAM,CAClC,EAEAH,EAAA,KAAe,SAAepJ,EAAOwJ,EAAc,CACjD,GAAIJ,EAAQ,QAAQpJ,CAAK,EACvB,OAAOA,EAGT,GAAI,CACF,OAAOqJ,EAAWrJ,CAAK,CAC3B,MAAc,CACV,OAAOwJ,CACX,CACA,yDCjDA,SAASC,GAAa,CACpB,KAAK,OAAS,CAAA,EACd,KAAK,OAAS,CAChB,CAEA,OAAAA,EAAU,UAAY,CAEpB,IAAK,SAAUC,EAAO,CACpB,MAAMC,EAAW,KAAK,MAAMD,EAAQ,CAAC,EACrC,OAAS,KAAK,OAAOC,CAAQ,IAAO,EAAID,EAAQ,EAAM,KAAO,CACjE,EAEE,IAAK,SAAUE,EAAKC,EAAQ,CAC1B,QAASC,EAAI,EAAGA,EAAID,EAAQC,IAC1B,KAAK,QAASF,IAASC,EAASC,EAAI,EAAM,KAAO,CAAC,CAExD,EAEE,gBAAiB,UAAY,CAC3B,OAAO,KAAK,MAChB,EAEE,OAAQ,SAAUC,EAAK,CACrB,MAAMJ,EAAW,KAAK,MAAM,KAAK,OAAS,CAAC,EACvC,KAAK,OAAO,QAAUA,GACxB,KAAK,OAAO,KAAK,CAAC,EAGhBI,IACF,KAAK,OAAOJ,CAAQ,GAAM,MAAU,KAAK,OAAS,GAGpD,KAAK,QACT,CACA,EAEAK,GAAiBP,kDC/BjB,SAASQ,EAAW9D,EAAM,CACxB,GAAI,CAACA,GAAQA,EAAO,EAClB,MAAM,IAAI,MAAM,mDAAmD,EAGrE,KAAK,KAAOA,EACZ,KAAK,KAAO,IAAI,WAAWA,EAAOA,CAAI,EACtC,KAAK,YAAc,IAAI,WAAWA,EAAOA,CAAI,CAC/C,CAWA,OAAA8D,EAAU,UAAU,IAAM,SAAUC,EAAKC,EAAKnK,EAAOoK,EAAU,CAC7D,MAAMV,EAAQQ,EAAM,KAAK,KAAOC,EAChC,KAAK,KAAKT,CAAK,EAAI1J,EACfoK,IAAU,KAAK,YAAYV,CAAK,EAAI,GAC1C,EASAO,EAAU,UAAU,IAAM,SAAUC,EAAKC,EAAK,CAC5C,OAAO,KAAK,KAAKD,EAAM,KAAK,KAAOC,CAAG,CACxC,EAUAF,EAAU,UAAU,IAAM,SAAUC,EAAKC,EAAKnK,EAAO,CACnD,KAAK,KAAKkK,EAAM,KAAK,KAAOC,CAAG,GAAKnK,CACtC,EASAiK,EAAU,UAAU,WAAa,SAAUC,EAAKC,EAAK,CACnD,OAAO,KAAK,YAAYD,EAAM,KAAK,KAAOC,CAAG,CAC/C,EAEAE,GAAiBJ,8DCtDjB,MAAMK,EAAgBxT,KAAmB,cAgBzCsS,EAAA,gBAA0B,SAA0BH,EAAS,CAC3D,GAAIA,IAAY,EAAG,MAAO,CAAA,EAE1B,MAAMsB,EAAW,KAAK,MAAMtB,EAAU,CAAC,EAAI,EACrC9C,EAAOmE,EAAcrB,CAAO,EAC5BuB,EAAYrE,IAAS,IAAM,GAAK,KAAK,MAAMA,EAAO,KAAO,EAAIoE,EAAW,EAAE,EAAI,EAC9EE,EAAY,CAACtE,EAAO,CAAC,EAE3B,QAAS2D,EAAI,EAAGA,EAAIS,EAAW,EAAGT,IAChCW,EAAUX,CAAC,EAAIW,EAAUX,EAAI,CAAC,EAAIU,EAGpC,OAAAC,EAAU,KAAK,CAAC,EAETA,EAAU,QAAO,CAC1B,EAsBArB,EAAA,aAAuB,SAAuBH,EAAS,CACrD,MAAMyB,EAAS,CAAA,EACTC,EAAMvB,EAAQ,gBAAgBH,CAAO,EACrC2B,EAAYD,EAAI,OAEtB,QAASb,EAAI,EAAGA,EAAIc,EAAWd,IAC7B,QAASlE,EAAI,EAAGA,EAAIgF,EAAWhF,IAExBkE,IAAM,GAAKlE,IAAM,GACjBkE,IAAM,GAAKlE,IAAMgF,EAAY,GAC7Bd,IAAMc,EAAY,GAAKhF,IAAM,GAIlC8E,EAAO,KAAK,CAACC,EAAIb,CAAC,EAAGa,EAAI/E,CAAC,CAAC,CAAC,EAIhC,OAAO8E,CACT,4DClFA,MAAMJ,EAAgBxT,KAAmB,cACnC+T,EAAsB,EAS5B,OAAAC,GAAA,aAAuB,SAAuB7B,EAAS,CACrD,MAAM9C,EAAOmE,EAAcrB,CAAO,EAElC,MAAO,CAEL,CAAC,EAAG,CAAC,EAEL,CAAC9C,EAAO0E,EAAqB,CAAC,EAE9B,CAAC,EAAG1E,EAAO0E,CAAmB,CAClC,CACA,8DCjBAzB,EAAA,SAAmB,CACjB,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,WAAY,CACd,EAMA,MAAM2B,EAAgB,CACpB,GAAI,EACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACN,EAQA3B,EAAA,QAAkB,SAAkBf,EAAM,CACxC,OAAOA,GAAQ,MAAQA,IAAS,IAAM,CAAC,MAAMA,CAAI,GAAKA,GAAQ,GAAKA,GAAQ,CAC7E,EASAe,EAAA,KAAe,SAAepJ,EAAO,CACnC,OAAOoJ,EAAQ,QAAQpJ,CAAK,EAAI,SAASA,EAAO,EAAE,EAAI,MACxD,EASAoJ,EAAA,aAAuB,SAAuB5B,EAAM,CAClD,MAAMrB,EAAOqB,EAAK,KAClB,IAAIwD,EAAS,EACTC,EAAe,EACfC,EAAe,EACfC,EAAU,KACVC,EAAU,KAEd,QAASlB,EAAM,EAAGA,EAAM/D,EAAM+D,IAAO,CACnCe,EAAeC,EAAe,EAC9BC,EAAUC,EAAU,KAEpB,QAASjB,EAAM,EAAGA,EAAMhE,EAAMgE,IAAO,CACnC,IAAIkB,EAAS7D,EAAK,IAAI0C,EAAKC,CAAG,EAC1BkB,IAAWF,EACbF,KAEIA,GAAgB,IAAGD,GAAUD,EAAc,IAAME,EAAe,IACpEE,EAAUE,EACVJ,EAAe,GAGjBI,EAAS7D,EAAK,IAAI2C,EAAKD,CAAG,EACtBmB,IAAWD,EACbF,KAEIA,GAAgB,IAAGF,GAAUD,EAAc,IAAMG,EAAe,IACpEE,EAAUC,EACVH,EAAe,EAEvB,CAEQD,GAAgB,IAAGD,GAAUD,EAAc,IAAME,EAAe,IAChEC,GAAgB,IAAGF,GAAUD,EAAc,IAAMG,EAAe,GACxE,CAEE,OAAOF,CACT,EAOA5B,EAAA,aAAuB,SAAuB5B,EAAM,CAClD,MAAMrB,EAAOqB,EAAK,KAClB,IAAIwD,EAAS,EAEb,QAASd,EAAM,EAAGA,EAAM/D,EAAO,EAAG+D,IAChC,QAASC,EAAM,EAAGA,EAAMhE,EAAO,EAAGgE,IAAO,CACvC,MAAMmB,EAAO9D,EAAK,IAAI0C,EAAKC,CAAG,EAC5B3C,EAAK,IAAI0C,EAAKC,EAAM,CAAC,EACrB3C,EAAK,IAAI0C,EAAM,EAAGC,CAAG,EACrB3C,EAAK,IAAI0C,EAAM,EAAGC,EAAM,CAAC,GAEvBmB,IAAS,GAAKA,IAAS,IAAGN,GACpC,CAGE,OAAOA,EAASD,EAAc,EAChC,EAQA3B,EAAA,aAAuB,SAAuB5B,EAAM,CAClD,MAAMrB,EAAOqB,EAAK,KAClB,IAAIwD,EAAS,EACTO,EAAU,EACVC,EAAU,EAEd,QAAStB,EAAM,EAAGA,EAAM/D,EAAM+D,IAAO,CACnCqB,EAAUC,EAAU,EACpB,QAASrB,EAAM,EAAGA,EAAMhE,EAAMgE,IAC5BoB,EAAYA,GAAW,EAAK,KAAS/D,EAAK,IAAI0C,EAAKC,CAAG,EAClDA,GAAO,KAAOoB,IAAY,MAASA,IAAY,KAAQP,IAE3DQ,EAAYA,GAAW,EAAK,KAAShE,EAAK,IAAI2C,EAAKD,CAAG,EAClDC,GAAO,KAAOqB,IAAY,MAASA,IAAY,KAAQR,GAEjE,CAEE,OAAOA,EAASD,EAAc,EAChC,EAUA3B,EAAA,aAAuB,SAAuB5B,EAAM,CAClD,IAAIiE,EAAY,EAChB,MAAMC,EAAelE,EAAK,KAAK,OAE/B,QAASsC,EAAI,EAAGA,EAAI4B,EAAc5B,IAAK2B,GAAajE,EAAK,KAAKsC,CAAC,EAI/D,OAFU,KAAK,IAAI,KAAK,KAAM2B,EAAY,IAAMC,EAAgB,CAAC,EAAI,EAAE,EAE5DX,EAAc,EAC3B,EAUA,SAASY,EAAWC,EAAa9B,EAAGlE,EAAG,CACrC,OAAQgG,EAAW,CACjB,KAAKxC,EAAQ,SAAS,WAAY,OAAQU,EAAIlE,GAAK,IAAM,EACzD,KAAKwD,EAAQ,SAAS,WAAY,OAAOU,EAAI,IAAM,EACnD,KAAKV,EAAQ,SAAS,WAAY,OAAOxD,EAAI,IAAM,EACnD,KAAKwD,EAAQ,SAAS,WAAY,OAAQU,EAAIlE,GAAK,IAAM,EACzD,KAAKwD,EAAQ,SAAS,WAAY,OAAQ,KAAK,MAAMU,EAAI,CAAC,EAAI,KAAK,MAAMlE,EAAI,CAAC,GAAK,IAAM,EACzF,KAAKwD,EAAQ,SAAS,WAAY,OAAQU,EAAIlE,EAAK,EAAKkE,EAAIlE,EAAK,IAAM,EACvE,KAAKwD,EAAQ,SAAS,WAAY,OAASU,EAAIlE,EAAK,EAAKkE,EAAIlE,EAAK,GAAK,IAAM,EAC7E,KAAKwD,EAAQ,SAAS,WAAY,OAASU,EAAIlE,EAAK,GAAKkE,EAAIlE,GAAK,GAAK,IAAM,EAE7E,QAAS,MAAM,IAAI,MAAM,mBAAqBgG,CAAW,CAC7D,CACA,CAQAxC,EAAA,UAAoB,SAAoByC,EAASrE,EAAM,CACrD,MAAMrB,EAAOqB,EAAK,KAElB,QAAS2C,EAAM,EAAGA,EAAMhE,EAAMgE,IAC5B,QAASD,EAAM,EAAGA,EAAM/D,EAAM+D,IACxB1C,EAAK,WAAW0C,EAAKC,CAAG,GAC5B3C,EAAK,IAAI0C,EAAKC,EAAKwB,EAAUE,EAAS3B,EAAKC,CAAG,CAAC,CAGrD,EAQAf,EAAA,YAAsB,SAAsB5B,EAAMsE,EAAiB,CACjE,MAAMC,EAAc,OAAO,KAAK3C,EAAQ,QAAQ,EAAE,OAClD,IAAI4C,EAAc,EACdC,EAAe,IAEnB,QAAS/U,EAAI,EAAGA,EAAI6U,EAAa7U,IAAK,CACpC4U,EAAgB5U,CAAC,EACjBkS,EAAQ,UAAUlS,EAAGsQ,CAAI,EAGzB,MAAM0E,EACJ9C,EAAQ,aAAa5B,CAAI,EACzB4B,EAAQ,aAAa5B,CAAI,EACzB4B,EAAQ,aAAa5B,CAAI,EACzB4B,EAAQ,aAAa5B,CAAI,EAG3B4B,EAAQ,UAAUlS,EAAGsQ,CAAI,EAErB0E,EAAUD,IACZA,EAAeC,EACfF,EAAc9U,EAEpB,CAEE,OAAO8U,CACT,4DCzOA,MAAMG,EAAUrV,GAAA,EAEVsV,EAAkB,CAEtB,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GACT,EAAG,EAAG,GAAI,GACV,EAAG,EAAG,GAAI,GACV,EAAG,EAAG,GAAI,GACV,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,EAAG,GAAI,GAAI,GACX,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,IAGRC,EAAqB,CAEzB,EAAG,GAAI,GAAI,GACX,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,GACZ,GAAI,GAAI,GAAI,IACZ,GAAI,GAAI,IAAK,IACb,GAAI,GAAI,IAAK,IACb,GAAI,IAAK,IAAK,IACd,GAAI,IAAK,IAAK,IACd,GAAI,IAAK,IAAK,IACd,GAAI,IAAK,IAAK,IACd,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,IACf,IAAK,IAAK,IAAK,KACf,IAAK,IAAK,IAAK,KACf,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,IAAK,KAAM,KAChB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,KACjB,IAAK,KAAM,KAAM,MAWnB,OAAAC,GAAA,eAAyB,SAAyBrD,EAASsD,EAAsB,CAC/E,OAAQA,EAAoB,CAC1B,KAAKJ,EAAQ,EACX,OAAOC,GAAiBnD,EAAU,GAAK,EAAI,CAAC,EAC9C,KAAKkD,EAAQ,EACX,OAAOC,GAAiBnD,EAAU,GAAK,EAAI,CAAC,EAC9C,KAAKkD,EAAQ,EACX,OAAOC,GAAiBnD,EAAU,GAAK,EAAI,CAAC,EAC9C,KAAKkD,EAAQ,EACX,OAAOC,GAAiBnD,EAAU,GAAK,EAAI,CAAC,EAC9C,QACE,OAEN,EAUAqD,GAAA,uBAAiC,SAAiCrD,EAASsD,EAAsB,CAC/F,OAAQA,EAAoB,CAC1B,KAAKJ,EAAQ,EACX,OAAOE,GAAoBpD,EAAU,GAAK,EAAI,CAAC,EACjD,KAAKkD,EAAQ,EACX,OAAOE,GAAoBpD,EAAU,GAAK,EAAI,CAAC,EACjD,KAAKkD,EAAQ,EACX,OAAOE,GAAoBpD,EAAU,GAAK,EAAI,CAAC,EACjD,KAAKkD,EAAQ,EACX,OAAOE,GAAoBpD,EAAU,GAAK,EAAI,CAAC,EACjD,QACE,OAEN,2DCtIA,MAAMuD,EAAY,IAAI,WAAW,GAAG,EAC9BC,EAAY,IAAI,WAAW,GAAG,EASnC,OAAC,UAAuB,CACvB,IAAIjN,EAAI,EACR,QAASsK,EAAI,EAAGA,EAAI,IAAKA,IACvB0C,EAAU1C,CAAC,EAAItK,EACfiN,EAAUjN,CAAC,EAAIsK,EAEftK,IAAM,EAIFA,EAAI,MACNA,GAAK,KAQT,QAASsK,EAAI,IAAKA,EAAI,IAAKA,IACzB0C,EAAU1C,CAAC,EAAI0C,EAAU1C,EAAI,GAAG,CAEpC,GAAC,EAQD4C,GAAA,IAAc,SAAcxJ,EAAG,CAC7B,GAAIA,EAAI,EAAG,MAAM,IAAI,MAAM,OAASA,EAAI,GAAG,EAC3C,OAAOuJ,EAAUvJ,CAAC,CACpB,EAQAwJ,GAAA,IAAc,SAAcxJ,EAAG,CAC7B,OAAOsJ,EAAUtJ,CAAC,CACpB,EASAwJ,GAAA,IAAc,SAAclN,EAAGC,EAAG,CAChC,OAAID,IAAM,GAAKC,IAAM,EAAU,EAIxB+M,EAAUC,EAAUjN,CAAC,EAAIiN,EAAUhN,CAAC,CAAC,CAC9C,wDCpEA,MAAMkN,EAAK7V,GAAA,EASXsS,EAAA,IAAc,SAAcwD,EAAIC,EAAI,CAClC,MAAMC,EAAQ,IAAI,WAAWF,EAAG,OAASC,EAAG,OAAS,CAAC,EAEtD,QAAS/C,EAAI,EAAGA,EAAI8C,EAAG,OAAQ9C,IAC7B,QAASlE,EAAI,EAAGA,EAAIiH,EAAG,OAAQjH,IAC7BkH,EAAMhD,EAAIlE,CAAC,GAAK+G,EAAG,IAAIC,EAAG9C,CAAC,EAAG+C,EAAGjH,CAAC,CAAC,EAIvC,OAAOkH,CACT,EASA1D,EAAA,IAAc,SAAc2D,EAAUC,EAAS,CAC7C,IAAIC,EAAS,IAAI,WAAWF,CAAQ,EAEpC,KAAQE,EAAO,OAASD,EAAQ,QAAW,GAAG,CAC5C,MAAMF,EAAQG,EAAO,CAAC,EAEtB,QAASnD,EAAI,EAAGA,EAAIkD,EAAQ,OAAQlD,IAClCmD,EAAOnD,CAAC,GAAK6C,EAAG,IAAIK,EAAQlD,CAAC,EAAGgD,CAAK,EAIvC,IAAII,EAAS,EACb,KAAOA,EAASD,EAAO,QAAUA,EAAOC,CAAM,IAAM,GAAGA,IACvDD,EAASA,EAAO,MAAMC,CAAM,CAChC,CAEE,OAAOD,CACT,EASA7D,EAAA,qBAA+B,SAA+B+D,EAAQ,CACpE,IAAIC,EAAO,IAAI,WAAW,CAAC,CAAC,CAAC,EAC7B,QAAS,EAAI,EAAG,EAAID,EAAQ,IAC1BC,EAAOhE,EAAQ,IAAIgE,EAAM,IAAI,WAAW,CAAC,EAAGT,EAAG,IAAI,CAAC,CAAC,CAAC,CAAC,EAGzD,OAAOS,CACT,yDC7DA,MAAMC,EAAavW,GAAA,EAEnB,SAASwW,EAAoBH,EAAQ,CACnC,KAAK,QAAU,OACf,KAAK,OAASA,EAEV,KAAK,QAAQ,KAAK,WAAW,KAAK,MAAM,CAC9C,CAQA,OAAAG,EAAmB,UAAU,WAAa,SAAqBH,EAAQ,CAErE,KAAK,OAASA,EACd,KAAK,QAAUE,EAAW,qBAAqB,KAAK,MAAM,CAC5D,EAQAC,EAAmB,UAAU,OAAS,SAAiB9F,EAAM,CAC3D,GAAI,CAAC,KAAK,QACR,MAAM,IAAI,MAAM,yBAAyB,EAK3C,MAAM+F,EAAa,IAAI,WAAW/F,EAAK,OAAS,KAAK,MAAM,EAC3D+F,EAAW,IAAI/F,CAAI,EAInB,MAAMgG,EAAYH,EAAW,IAAIE,EAAY,KAAK,OAAO,EAKnDE,EAAQ,KAAK,OAASD,EAAU,OACtC,GAAIC,EAAQ,EAAG,CACb,MAAMC,EAAO,IAAI,WAAW,KAAK,MAAM,EACvC,OAAAA,EAAK,IAAIF,EAAWC,CAAK,EAElBC,CACX,CAEE,OAAOF,CACT,EAEAG,GAAiBL,6DCjDjBM,GAAA,QAAkB,SAAkB3E,EAAS,CAC3C,MAAO,CAAC,MAAMA,CAAO,GAAKA,GAAW,GAAKA,GAAW,EACvD,sDCRA,MAAM4E,EAAU,SACVC,EAAe,oBACrB,IAAI3E,EAAQ,mNAIZA,EAAQA,EAAM,QAAQ,KAAM,KAAK,EAEjC,MAAM4E,EAAO,6BAA+B5E,EAAQ;AAAA,MAEpD6E,GAAA,MAAgB,IAAI,OAAO7E,EAAO,GAAG,EACrC6E,GAAA,WAAqB,IAAI,OAAO,wBAAyB,GAAG,EAC5DA,GAAA,KAAe,IAAI,OAAOD,EAAM,GAAG,EACnCC,GAAA,QAAkB,IAAI,OAAOH,EAAS,GAAG,EACzCG,GAAA,aAAuB,IAAI,OAAOF,EAAc,GAAG,EAEnD,MAAMG,EAAa,IAAI,OAAO,IAAM9E,EAAQ,GAAG,EACzC+E,EAAe,IAAI,OAAO,IAAML,EAAU,GAAG,EAC7CM,EAAoB,IAAI,OAAO,wBAAwB,EAE7D,OAAAH,GAAA,UAAoB,SAAoBI,EAAK,CAC3C,OAAOH,EAAW,KAAKG,CAAG,CAC5B,EAEAJ,GAAA,YAAsB,SAAsBI,EAAK,CAC/C,OAAOF,EAAa,KAAKE,CAAG,CAC9B,EAEAJ,GAAA,iBAA2B,SAA2BI,EAAK,CACzD,OAAOD,EAAkB,KAAKC,CAAG,CACnC,wDC9BA,MAAMC,EAAevX,GAAA,EACfwX,EAAQ3N,GAAA,EASdyI,EAAA,QAAkB,CAChB,GAAI,UACJ,IAAK,EACL,OAAQ,CAAC,GAAI,GAAI,EAAE,CACrB,EAWAA,EAAA,aAAuB,CACrB,GAAI,eACJ,IAAK,EACL,OAAQ,CAAC,EAAG,GAAI,EAAE,CACpB,EAOAA,EAAA,KAAe,CACb,GAAI,OACJ,IAAK,EACL,OAAQ,CAAC,EAAG,GAAI,EAAE,CACpB,EAWAA,EAAA,MAAgB,CACd,GAAI,QACJ,IAAK,EACL,OAAQ,CAAC,EAAG,GAAI,EAAE,CACpB,EAQAA,EAAA,MAAgB,CACd,IAAK,EACP,EAUAA,EAAA,sBAAgC,SAAgC/E,EAAM4E,EAAS,CAC7E,GAAI,CAAC5E,EAAK,OAAQ,MAAM,IAAI,MAAM,iBAAmBA,CAAI,EAEzD,GAAI,CAACgK,EAAa,QAAQpF,CAAO,EAC/B,MAAM,IAAI,MAAM,oBAAsBA,CAAO,EAG/C,OAAIA,GAAW,GAAKA,EAAU,GAAW5E,EAAK,OAAO,CAAC,EAC7C4E,EAAU,GAAW5E,EAAK,OAAO,CAAC,EACpCA,EAAK,OAAO,CAAC,CACtB,EAQA+E,EAAA,mBAA6B,SAA6BmF,EAAS,CACjE,OAAID,EAAM,YAAYC,CAAO,EAAUnF,EAAQ,QACtCkF,EAAM,iBAAiBC,CAAO,EAAUnF,EAAQ,aAChDkF,EAAM,UAAUC,CAAO,EAAUnF,EAAQ,MACtCA,EAAQ,IACtB,EAQAA,EAAA,SAAmB,SAAmB/E,EAAM,CAC1C,GAAIA,GAAQA,EAAK,GAAI,OAAOA,EAAK,GACjC,MAAM,IAAI,MAAM,cAAc,CAChC,EAQA+E,EAAA,QAAkB,SAAkB/E,EAAM,CACxC,OAAOA,GAAQA,EAAK,KAAOA,EAAK,MAClC,EAQA,SAASgF,EAAYC,EAAQ,CAC3B,GAAI,OAAOA,GAAW,SACpB,MAAM,IAAI,MAAM,uBAAuB,EAKzC,OAFcA,EAAO,YAAW,EAEnB,CACX,IAAK,UACH,OAAOF,EAAQ,QACjB,IAAK,eACH,OAAOA,EAAQ,aACjB,IAAK,QACH,OAAOA,EAAQ,MACjB,IAAK,OACH,OAAOA,EAAQ,KACjB,QACE,MAAM,IAAI,MAAM,iBAAmBE,CAAM,CAC/C,CACA,CAUAF,EAAA,KAAe,SAAepJ,EAAOwJ,EAAc,CACjD,GAAIJ,EAAQ,QAAQpJ,CAAK,EACvB,OAAOA,EAGT,GAAI,CACF,OAAOqJ,EAAWrJ,CAAK,CAC3B,MAAc,CACV,OAAOwJ,CACX,CACA,+DCtKA,MAAMgF,EAAQ1X,GAAA,EACR2X,EAAS9N,GAAA,EACTwL,EAAUuC,GAAA,EACVC,EAAOC,GAAA,EACPP,EAAeQ,GAAA,EAGfC,EAAO,KACPC,EAAUP,EAAM,YAAYM,CAAG,EAErC,SAASE,EAA6B3K,EAAMwF,EAAQ0C,EAAsB,CACxE,QAAS0C,EAAiB,EAAGA,GAAkB,GAAIA,IACjD,GAAIpF,GAAUT,EAAQ,YAAY6F,EAAgB1C,EAAsBlI,CAAI,EAC1E,OAAO4K,CAKb,CAEA,SAASC,EAAsB7K,EAAM4E,EAAS,CAE5C,OAAO0F,EAAK,sBAAsBtK,EAAM4E,CAAO,EAAI,CACrD,CAEA,SAASkG,EAA2BC,EAAUnG,EAAS,CACrD,IAAIoG,EAAY,EAEhB,OAAAD,EAAS,QAAQ,SAAU5H,EAAM,CAC/B,MAAM8H,EAAeJ,EAAqB1H,EAAK,KAAMyB,CAAO,EAC5DoG,GAAaC,EAAe9H,EAAK,cAAa,CAClD,CAAG,EAEM6H,CACT,CAEA,SAASE,EAA4BH,EAAU7C,EAAsB,CACnE,QAAS0C,EAAiB,EAAGA,GAAkB,GAAIA,IAEjD,GADeE,EAA0BC,EAAUH,CAAc,GACnD7F,EAAQ,YAAY6F,EAAgB1C,EAAsBoC,EAAK,KAAK,EAChF,OAAOM,CAKb,CAUA7F,EAAA,KAAe,SAAepJ,EAAOwJ,EAAc,CACjD,OAAI6E,EAAa,QAAQrO,CAAK,EACrB,SAASA,EAAO,EAAE,EAGpBwJ,CACT,EAWAJ,EAAA,YAAsB,SAAsBH,EAASsD,EAAsBlI,EAAM,CAC/E,GAAI,CAACgK,EAAa,QAAQpF,CAAO,EAC/B,MAAM,IAAI,MAAM,yBAAyB,EAIvC,OAAO5E,EAAS,MAAaA,EAAOsK,EAAK,MAG7C,MAAMa,EAAiBhB,EAAM,wBAAwBvF,CAAO,EAGtDwG,EAAmBhB,EAAO,uBAAuBxF,EAASsD,CAAoB,EAG9EmD,GAA0BF,EAAiBC,GAAoB,EAErE,GAAIpL,IAASsK,EAAK,MAAO,OAAOe,EAEhC,MAAMC,EAAaD,EAAyBR,EAAqB7K,EAAM4E,CAAO,EAG9E,OAAQ5E,EAAI,CACV,KAAKsK,EAAK,QACR,OAAO,KAAK,MAAOgB,EAAa,GAAM,CAAC,EAEzC,KAAKhB,EAAK,aACR,OAAO,KAAK,MAAOgB,EAAa,GAAM,CAAC,EAEzC,KAAKhB,EAAK,MACR,OAAO,KAAK,MAAMgB,EAAa,EAAE,EAEnC,KAAKhB,EAAK,KACV,QACE,OAAO,KAAK,MAAMgB,EAAa,CAAC,CACtC,CACA,EAUAvG,EAAA,sBAAgC,SAAgC5B,EAAM+E,EAAsB,CAC1F,IAAIqD,EAEJ,MAAMC,EAAM1D,EAAQ,KAAKI,EAAsBJ,EAAQ,CAAC,EAExD,GAAI,MAAM,QAAQ3E,CAAI,EAAG,CACvB,GAAIA,EAAK,OAAS,EAChB,OAAO+H,EAA2B/H,EAAMqI,CAAG,EAG7C,GAAIrI,EAAK,SAAW,EAClB,MAAO,GAGToI,EAAMpI,EAAK,CAAC,CAChB,MACIoI,EAAMpI,EAGR,OAAOwH,EAA4BY,EAAI,KAAMA,EAAI,UAAS,EAAIC,CAAG,CACnE,EAYAzG,EAAA,eAAyB,SAAyBH,EAAS,CACzD,GAAI,CAACoF,EAAa,QAAQpF,CAAO,GAAKA,EAAU,EAC9C,MAAM,IAAI,MAAM,yBAAyB,EAG3C,IAAIzR,EAAIyR,GAAW,GAEnB,KAAOuF,EAAM,YAAYhX,CAAC,EAAIuX,GAAW,GACvCvX,GAAMsX,GAAQN,EAAM,YAAYhX,CAAC,EAAIuX,EAGvC,OAAQ9F,GAAW,GAAMzR,CAC3B,4DClKA,MAAMgX,EAAQ1X,GAAA,EAERgZ,EAAO,KACPC,EAAY,MACZC,EAAUxB,EAAM,YAAYsB,CAAG,EAYrC,OAAAG,GAAA,eAAyB,SAAyB1D,EAAsBlE,EAAM,CAC5E,MAAMb,EAAS+E,EAAqB,KAAO,EAAKlE,EAChD,IAAI,EAAIb,GAAQ,GAEhB,KAAOgH,EAAM,YAAY,CAAC,EAAIwB,GAAW,GACvC,GAAMF,GAAQtB,EAAM,YAAY,CAAC,EAAIwB,EAMvC,OAASxI,GAAQ,GAAM,GAAKuI,CAC9B,wDC5BA,MAAMpB,EAAO7X,GAAA,EAEb,SAASoZ,EAAa1I,EAAM,CAC1B,KAAK,KAAOmH,EAAK,QACjB,KAAK,KAAOnH,EAAK,SAAQ,CAC3B,CAEA,OAAA0I,EAAY,cAAgB,SAAwBrG,EAAQ,CAC1D,MAAO,IAAK,KAAK,MAAMA,EAAS,CAAC,GAAMA,EAAS,EAAOA,EAAS,EAAK,EAAI,EAAK,EAChF,EAEAqG,EAAY,UAAU,UAAY,UAAsB,CACtD,OAAO,KAAK,KAAK,MACnB,EAEAA,EAAY,UAAU,cAAgB,UAA0B,CAC9D,OAAOA,EAAY,cAAc,KAAK,KAAK,MAAM,CACnD,EAEAA,EAAY,UAAU,MAAQ,SAAgBlG,EAAW,CACvD,IAAIF,EAAGqG,EAAOnQ,EAId,IAAK8J,EAAI,EAAGA,EAAI,GAAK,KAAK,KAAK,OAAQA,GAAK,EAC1CqG,EAAQ,KAAK,KAAK,OAAOrG,EAAG,CAAC,EAC7B9J,EAAQ,SAASmQ,EAAO,EAAE,EAE1BnG,EAAU,IAAIhK,EAAO,EAAE,EAKzB,MAAMoQ,EAAe,KAAK,KAAK,OAAStG,EACpCsG,EAAe,IACjBD,EAAQ,KAAK,KAAK,OAAOrG,CAAC,EAC1B9J,EAAQ,SAASmQ,EAAO,EAAE,EAE1BnG,EAAU,IAAIhK,EAAOoQ,EAAe,EAAI,CAAC,EAE7C,EAEAC,GAAiBH,kDC1CjB,MAAMvB,EAAO7X,GAAA,EAWPwZ,EAAkB,CACtB,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC5D,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC5D,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAC1C,EAEA,SAASC,EAAkB/I,EAAM,CAC/B,KAAK,KAAOmH,EAAK,aACjB,KAAK,KAAOnH,CACd,CAEA,OAAA+I,EAAiB,cAAgB,SAAwB1G,EAAQ,CAC/D,MAAO,IAAK,KAAK,MAAMA,EAAS,CAAC,EAAI,GAAKA,EAAS,EACrD,EAEA0G,EAAiB,UAAU,UAAY,UAAsB,CAC3D,OAAO,KAAK,KAAK,MACnB,EAEAA,EAAiB,UAAU,cAAgB,UAA0B,CACnE,OAAOA,EAAiB,cAAc,KAAK,KAAK,MAAM,CACxD,EAEAA,EAAiB,UAAU,MAAQ,SAAgBvG,EAAW,CAC5D,IAAI,EAIJ,IAAK,EAAI,EAAG,EAAI,GAAK,KAAK,KAAK,OAAQ,GAAK,EAAG,CAE7C,IAAIhK,EAAQsQ,EAAgB,QAAQ,KAAK,KAAK,CAAC,CAAC,EAAI,GAGpDtQ,GAASsQ,EAAgB,QAAQ,KAAK,KAAK,EAAI,CAAC,CAAC,EAGjDtG,EAAU,IAAIhK,EAAO,EAAE,CAC3B,CAIM,KAAK,KAAK,OAAS,GACrBgK,EAAU,IAAIsG,EAAgB,QAAQ,KAAK,KAAK,CAAC,CAAC,EAAG,CAAC,CAE1D,EAEAE,GAAiBD,kDC1DjB,MAAM5B,EAAO7X,GAAA,EAEb,SAAS2Z,EAAUjJ,EAAM,CACvB,KAAK,KAAOmH,EAAK,KACb,OAAQnH,GAAU,SACpB,KAAK,KAAO,IAAI,YAAW,EAAG,OAAOA,CAAI,EAEzC,KAAK,KAAO,IAAI,WAAWA,CAAI,CAEnC,CAEA,OAAAiJ,EAAS,cAAgB,SAAwB5G,EAAQ,CACvD,OAAOA,EAAS,CAClB,EAEA4G,EAAS,UAAU,UAAY,UAAsB,CACnD,OAAO,KAAK,KAAK,MACnB,EAEAA,EAAS,UAAU,cAAgB,UAA0B,CAC3D,OAAOA,EAAS,cAAc,KAAK,KAAK,MAAM,CAChD,EAEAA,EAAS,UAAU,MAAQ,SAAUzG,EAAW,CAC9C,QAASF,EAAI,EAAG9S,EAAI,KAAK,KAAK,OAAQ8S,EAAI9S,EAAG8S,IAC3CE,EAAU,IAAI,KAAK,KAAKF,CAAC,EAAG,CAAC,CAEjC,EAEA4G,GAAiBD,kDC7BjB,MAAM9B,EAAO7X,GAAA,EACP0X,EAAQ7N,GAAA,EAEd,SAASgQ,EAAWnJ,EAAM,CACxB,KAAK,KAAOmH,EAAK,MACjB,KAAK,KAAOnH,CACd,CAEA,OAAAmJ,EAAU,cAAgB,SAAwB9G,EAAQ,CACxD,OAAOA,EAAS,EAClB,EAEA8G,EAAU,UAAU,UAAY,UAAsB,CACpD,OAAO,KAAK,KAAK,MACnB,EAEAA,EAAU,UAAU,cAAgB,UAA0B,CAC5D,OAAOA,EAAU,cAAc,KAAK,KAAK,MAAM,CACjD,EAEAA,EAAU,UAAU,MAAQ,SAAU3G,EAAW,CAC/C,IAAIF,EAKJ,IAAKA,EAAI,EAAGA,EAAI,KAAK,KAAK,OAAQA,IAAK,CACrC,IAAI9J,EAAQwO,EAAM,OAAO,KAAK,KAAK1E,CAAC,CAAC,EAGrC,GAAI9J,GAAS,OAAUA,GAAS,MAE9BA,GAAS,cAGAA,GAAS,OAAUA,GAAS,MAErCA,GAAS,UAET,OAAM,IAAI,MACR,2BAA6B,KAAK,KAAK8J,CAAC,EAAI;AAAA,gCACX,EAKrC9J,GAAWA,IAAU,EAAK,KAAQ,KAASA,EAAQ,KAGnDgK,EAAU,IAAIhK,EAAO,EAAE,CAC3B,CACA,EAEA4Q,GAAiBD,wEC9BjB,IAAIE,EAAW,CACb,6BAA8B,SAASC,EAAOhO,EAAGtL,EAAG,CAGlD,IAAIuZ,EAAe,CAAA,EAIfC,EAAQ,CAAA,EACZA,EAAMlO,CAAC,EAAI,EAMX,IAAImO,EAAOJ,EAAS,cAAc,KAAI,EACtCI,EAAK,KAAKnO,EAAG,CAAC,EAUd,QARIoO,EACA1Y,EAAGY,EACH+X,EACAC,EACAC,EACAC,EACAC,EACAC,EACG,CAACP,EAAK,SAAS,CAGpBC,EAAUD,EAAK,IAAG,EAClBzY,EAAI0Y,EAAQ,MACZC,EAAiBD,EAAQ,KAGzBE,EAAiBN,EAAMtY,CAAC,GAAK,CAAA,EAK7B,IAAKY,KAAKgY,EACJA,EAAe,eAAehY,CAAC,IAEjCiY,EAAYD,EAAehY,CAAC,EAK5BkY,EAAgCH,EAAiBE,EAMjDE,EAAiBP,EAAM5X,CAAC,EACxBoY,EAAe,OAAOR,EAAM5X,CAAC,EAAM,KAC/BoY,GAAeD,EAAiBD,KAClCN,EAAM5X,CAAC,EAAIkY,EACXL,EAAK,KAAK7X,EAAGkY,CAA6B,EAC1CP,EAAa3X,CAAC,EAAIZ,GAI9B,CAEI,GAAI,OAAOhB,EAAM,KAAe,OAAOwZ,EAAMxZ,CAAC,EAAM,IAAa,CAC/D,IAAIia,EAAM,CAAC,8BAA+B3O,EAAG,OAAQtL,EAAG,GAAG,EAAE,KAAK,EAAE,EACpE,MAAM,IAAI,MAAMia,CAAG,CACzB,CAEI,OAAOV,CACX,EAEE,4CAA6C,SAASA,EAAcvZ,EAAG,CAIrE,QAHIka,EAAQ,CAAA,EACRlZ,EAAIhB,EAEDgB,GACLkZ,EAAM,KAAKlZ,CAAC,EACEuY,EAAavY,CAAC,EAC5BA,EAAIuY,EAAavY,CAAC,EAEpB,OAAAkZ,EAAM,QAAO,EACNA,CACX,EAEE,UAAW,SAASZ,EAAOhO,EAAGtL,EAAG,CAC/B,IAAIuZ,EAAeF,EAAS,6BAA6BC,EAAOhO,EAAGtL,CAAC,EACpE,OAAOqZ,EAAS,4CACdE,EAAcvZ,CAAC,CACrB,EAKE,cAAe,CACb,KAAM,SAAUqL,EAAM,CACpB,IAAI8O,EAAId,EAAS,cACb9T,EAAI,CAAA,EACJiB,EACJ6E,EAAOA,GAAQ,CAAA,EACf,IAAK7E,KAAO2T,EACNA,EAAE,eAAe3T,CAAG,IACtBjB,EAAEiB,CAAG,EAAI2T,EAAE3T,CAAG,GAGlB,OAAAjB,EAAE,MAAQ,CAAA,EACVA,EAAE,OAAS8F,EAAK,QAAU8O,EAAE,eACrB5U,CACb,EAEI,eAAgB,SAAU1F,EAAGE,EAAG,CAC9B,OAAOF,EAAE,KAAOE,EAAE,IACxB,EAMI,KAAM,SAAUyI,EAAO4R,EAAM,CAC3B,IAAIC,EAAO,CAAC,MAAO7R,EAAO,KAAM4R,CAAI,EACpC,KAAK,MAAM,KAAKC,CAAI,EACpB,KAAK,MAAM,KAAK,KAAK,MAAM,CACjC,EAKI,IAAK,UAAY,CACf,OAAO,KAAK,MAAM,MAAK,CAC7B,EAEI,MAAO,UAAY,CACjB,OAAO,KAAK,MAAM,SAAW,CACnC,CACA,GAMExG,UAAiBwF,uECnKnB,MAAMlC,EAAO7X,GAAA,EACPoZ,EAAcvP,GAAA,EACd4P,EAAmB7B,GAAA,EACnB+B,EAAW7B,GAAA,EACX+B,EAAY9B,GAAA,EACZP,EAAQwD,GAAA,EACRtD,EAAQuD,GAAA,EACRlB,EAAWmB,GAAA,EAQjB,SAASC,EAAqB7D,EAAK,CACjC,OAAO,SAAS,mBAAmBA,CAAG,CAAC,EAAE,MAC3C,CAUA,SAAS8D,EAAalE,EAAO3J,EAAM+J,EAAK,CACtC,MAAMgB,EAAW,CAAA,EACjB,IAAInC,EAEJ,MAAQA,EAASe,EAAM,KAAKI,CAAG,KAAO,MACpCgB,EAAS,KAAK,CACZ,KAAMnC,EAAO,CAAC,EACd,MAAOA,EAAO,MACd,KAAM5I,EACN,OAAQ4I,EAAO,CAAC,EAAE,OACnB,EAGH,OAAOmC,CACT,CASA,SAAS+C,EAAuB5D,EAAS,CACvC,MAAM6D,EAAUF,EAAY5D,EAAM,QAASK,EAAK,QAASJ,CAAO,EAC1D8D,EAAeH,EAAY5D,EAAM,aAAcK,EAAK,aAAcJ,CAAO,EAC/E,IAAI+D,EACAC,EAEJ,OAAI/D,EAAM,sBACR8D,EAAWJ,EAAY5D,EAAM,KAAMK,EAAK,KAAMJ,CAAO,EACrDgE,EAAYL,EAAY5D,EAAM,MAAOK,EAAK,MAAOJ,CAAO,IAExD+D,EAAWJ,EAAY5D,EAAM,WAAYK,EAAK,KAAMJ,CAAO,EAC3DgE,EAAY,CAAA,GAGDH,EAAQ,OAAOC,EAAcC,EAAUC,CAAS,EAG1D,KAAK,SAAUC,EAAIC,EAAI,CACtB,OAAOD,EAAG,MAAQC,EAAG,KAC3B,CAAK,EACA,IAAI,SAAUxO,EAAK,CAClB,MAAO,CACL,KAAMA,EAAI,KACV,KAAMA,EAAI,KACV,OAAQA,EAAI,MACpB,CACA,CAAK,CACL,CAUA,SAASyO,EAAsB7I,EAAQxF,EAAM,CAC3C,OAAQA,EAAI,CACV,KAAKsK,EAAK,QACR,OAAOuB,EAAY,cAAcrG,CAAM,EACzC,KAAK8E,EAAK,aACR,OAAO4B,EAAiB,cAAc1G,CAAM,EAC9C,KAAK8E,EAAK,MACR,OAAOgC,EAAU,cAAc9G,CAAM,EACvC,KAAK8E,EAAK,KACR,OAAO8B,EAAS,cAAc5G,CAAM,CAC1C,CACA,CAQA,SAAS8I,EAAeC,EAAM,CAC5B,OAAOA,EAAK,OAAO,SAAUC,EAAKC,EAAM,CACtC,MAAMC,EAAUF,EAAI,OAAS,GAAK,EAAIA,EAAIA,EAAI,OAAS,CAAC,EAAI,KAC5D,OAAIE,GAAWA,EAAQ,OAASD,EAAK,MACnCD,EAAIA,EAAI,OAAS,CAAC,EAAE,MAAQC,EAAK,KAC1BD,IAGTA,EAAI,KAAKC,CAAI,EACND,EACX,EAAK,CAAA,CAAE,CACP,CAkBA,SAASG,EAAYJ,EAAM,CACzB,MAAMlB,EAAQ,CAAA,EACd,QAAS5H,EAAI,EAAGA,EAAI8I,EAAK,OAAQ9I,IAAK,CACpC,MAAM8F,EAAMgD,EAAK9I,CAAC,EAElB,OAAQ8F,EAAI,KAAI,CACd,KAAKjB,EAAK,QACR+C,EAAM,KAAK,CAAC9B,EACV,CAAE,KAAMA,EAAI,KAAM,KAAMjB,EAAK,aAAc,OAAQiB,EAAI,MAAM,EAC7D,CAAE,KAAMA,EAAI,KAAM,KAAMjB,EAAK,KAAM,OAAQiB,EAAI,MAAM,EACtD,EACD,MACF,KAAKjB,EAAK,aACR+C,EAAM,KAAK,CAAC9B,EACV,CAAE,KAAMA,EAAI,KAAM,KAAMjB,EAAK,KAAM,OAAQiB,EAAI,MAAM,EACtD,EACD,MACF,KAAKjB,EAAK,MACR+C,EAAM,KAAK,CAAC9B,EACV,CAAE,KAAMA,EAAI,KAAM,KAAMjB,EAAK,KAAM,OAAQsD,EAAoBrC,EAAI,IAAI,CAAC,EACzE,EACD,MACF,KAAKjB,EAAK,KACR+C,EAAM,KAAK,CACT,CAAE,KAAM9B,EAAI,KAAM,KAAMjB,EAAK,KAAM,OAAQsD,EAAoBrC,EAAI,IAAI,CAAC,EACzE,CACT,CACA,CAEE,OAAO8B,CACT,CAcA,SAASuB,EAAYvB,EAAOzI,EAAS,CACnC,MAAMiK,EAAQ,CAAA,EACRpC,EAAQ,CAAE,MAAO,CAAA,CAAE,EACzB,IAAIqC,EAAc,CAAC,OAAO,EAE1B,QAASrJ,EAAI,EAAGA,EAAI4H,EAAM,OAAQ5H,IAAK,CACrC,MAAMsJ,EAAY1B,EAAM5H,CAAC,EACnBuJ,EAAiB,CAAA,EAEvB,QAASzN,EAAI,EAAGA,EAAIwN,EAAU,OAAQxN,IAAK,CACzC,MAAM0N,EAAOF,EAAUxN,CAAC,EAClB5H,EAAM,GAAK8L,EAAIlE,EAErByN,EAAe,KAAKrV,CAAG,EACvBkV,EAAMlV,CAAG,EAAI,CAAE,KAAMsV,EAAM,UAAW,CAAC,EACvCxC,EAAM9S,CAAG,EAAI,CAAA,EAEb,QAASkF,EAAI,EAAGA,EAAIiQ,EAAY,OAAQjQ,IAAK,CAC3C,MAAMqQ,EAAaJ,EAAYjQ,CAAC,EAE5BgQ,EAAMK,CAAU,GAAKL,EAAMK,CAAU,EAAE,KAAK,OAASD,EAAK,MAC5DxC,EAAMyC,CAAU,EAAEvV,CAAG,EACnB0U,EAAqBQ,EAAMK,CAAU,EAAE,UAAYD,EAAK,OAAQA,EAAK,IAAI,EACzEZ,EAAqBQ,EAAMK,CAAU,EAAE,UAAWD,EAAK,IAAI,EAE7DJ,EAAMK,CAAU,EAAE,WAAaD,EAAK,SAEhCJ,EAAMK,CAAU,IAAGL,EAAMK,CAAU,EAAE,UAAYD,EAAK,QAE1DxC,EAAMyC,CAAU,EAAEvV,CAAG,EAAI0U,EAAqBY,EAAK,OAAQA,EAAK,IAAI,EAClE,EAAI3E,EAAK,sBAAsB2E,EAAK,KAAMrK,CAAO,EAE7D,CACA,CAEIkK,EAAcE,CAClB,CAEE,QAASnQ,EAAI,EAAGA,EAAIiQ,EAAY,OAAQjQ,IACtC4N,EAAMqC,EAAYjQ,CAAC,CAAC,EAAE,IAAM,EAG9B,MAAO,CAAE,IAAK4N,EAAO,MAAOoC,CAAK,CACnC,CAUA,SAASM,EAAoBhM,EAAMiM,EAAW,CAC5C,IAAIpP,EACJ,MAAMqP,EAAW/E,EAAK,mBAAmBnH,CAAI,EAK7C,GAHAnD,EAAOsK,EAAK,KAAK8E,EAAWC,CAAQ,EAGhCrP,IAASsK,EAAK,MAAQtK,EAAK,IAAMqP,EAAS,IAC5C,MAAM,IAAI,MAAM,IAAMlM,EAAO,iCACOmH,EAAK,SAAStK,CAAI,EACpD;AAAA,sBAA4BsK,EAAK,SAAS+E,CAAQ,CAAC,EAQvD,OAJIrP,IAASsK,EAAK,OAAS,CAACH,EAAM,mBAAkB,IAClDnK,EAAOsK,EAAK,MAGNtK,EAAI,CACV,KAAKsK,EAAK,QACR,OAAO,IAAIuB,EAAY1I,CAAI,EAE7B,KAAKmH,EAAK,aACR,OAAO,IAAI4B,EAAiB/I,CAAI,EAElC,KAAKmH,EAAK,MACR,OAAO,IAAIgC,EAAUnJ,CAAI,EAE3B,KAAKmH,EAAK,KACR,OAAO,IAAI8B,EAASjJ,CAAI,CAC9B,CACA,CAiBA4B,EAAA,UAAoB,SAAoBuK,EAAO,CAC7C,OAAOA,EAAM,OAAO,SAAUd,EAAKjD,EAAK,CACtC,OAAI,OAAOA,GAAQ,SACjBiD,EAAI,KAAKW,EAAmB5D,EAAK,IAAI,CAAC,EAC7BA,EAAI,MACbiD,EAAI,KAAKW,EAAmB5D,EAAI,KAAMA,EAAI,IAAI,CAAC,EAG1CiD,CACX,EAAK,CAAA,CAAE,CACP,EAUAzJ,EAAA,WAAqB,SAAqB5B,EAAMyB,EAAS,CACvD,MAAM2J,EAAOT,EAAsB3K,EAAMgH,EAAM,mBAAkB,CAAE,EAE7DkD,EAAQsB,EAAWJ,CAAI,EACvB9B,EAAQmC,EAAWvB,EAAOzI,CAAO,EACjC9N,EAAO0V,EAAS,UAAUC,EAAM,IAAK,QAAS,KAAK,EAEnD8C,EAAgB,CAAA,EACtB,QAAS9J,EAAI,EAAGA,EAAI3O,EAAK,OAAS,EAAG2O,IACnC8J,EAAc,KAAK9C,EAAM,MAAM3V,EAAK2O,CAAC,CAAC,EAAE,IAAI,EAG9C,OAAOV,EAAQ,UAAUuJ,EAAciB,CAAa,CAAC,CACvD,EAYAxK,EAAA,SAAmB,SAAmB5B,EAAM,CAC1C,OAAO4B,EAAQ,UACb+I,EAAsB3K,EAAMgH,EAAM,mBAAkB,CAAE,CAC1D,CACA,sDCzUA,MAAMA,EAAQ1X,GAAA,EACRqV,EAAUxL,GAAA,EACV8I,EAAYiF,GAAA,EACZzE,EAAY2E,GAAA,EACZiF,EAAmBhF,GAAA,EACnBiF,EAAgBhC,GAAA,EAChBiC,EAAchC,GAAA,EACdtD,EAASuD,GAAA,EACT1E,EAAqB0G,GAAA,EACrBC,EAAUC,GAAA,EACVC,EAAaC,GAAA,EACbzF,EAAO0F,GAAA,EACPC,EAAWC,GAAA,EAkCjB,SAASC,EAAoBC,EAAQxL,EAAS,CAC5C,MAAM9C,EAAOsO,EAAO,KACd9J,EAAMmJ,EAAc,aAAa7K,CAAO,EAE9C,QAASa,EAAI,EAAGA,EAAIa,EAAI,OAAQb,IAAK,CACnC,MAAMI,EAAMS,EAAIb,CAAC,EAAE,CAAC,EACdK,EAAMQ,EAAIb,CAAC,EAAE,CAAC,EAEpB,QAAS4K,EAAI,GAAIA,GAAK,EAAGA,IACvB,GAAI,EAAAxK,EAAMwK,GAAK,IAAMvO,GAAQ+D,EAAMwK,GAEnC,QAAStd,EAAI,GAAIA,GAAK,EAAGA,IACnB+S,EAAM/S,GAAK,IAAM+O,GAAQgE,EAAM/S,IAE9Bsd,GAAK,GAAKA,GAAK,IAAMtd,IAAM,GAAKA,IAAM,IACxCA,GAAK,GAAKA,GAAK,IAAMsd,IAAM,GAAKA,IAAM,IACtCA,GAAK,GAAKA,GAAK,GAAKtd,GAAK,GAAKA,GAAK,EACpCqd,EAAO,IAAIvK,EAAMwK,EAAGvK,EAAM/S,EAAG,GAAM,EAAI,EAEvCqd,EAAO,IAAIvK,EAAMwK,EAAGvK,EAAM/S,EAAG,GAAO,EAAI,EAIlD,CACA,CASA,SAASud,EAAoBF,EAAQ,CACnC,MAAMtO,EAAOsO,EAAO,KAEpB,QAASC,EAAI,EAAGA,EAAIvO,EAAO,EAAGuO,IAAK,CACjC,MAAM1U,EAAQ0U,EAAI,IAAM,EACxBD,EAAO,IAAIC,EAAG,EAAG1U,EAAO,EAAI,EAC5ByU,EAAO,IAAI,EAAGC,EAAG1U,EAAO,EAAI,CAChC,CACA,CAUA,SAAS4U,EAAuBH,EAAQxL,EAAS,CAC/C,MAAM0B,EAAMkJ,EAAiB,aAAa5K,CAAO,EAEjD,QAASa,EAAI,EAAGA,EAAIa,EAAI,OAAQb,IAAK,CACnC,MAAMI,EAAMS,EAAIb,CAAC,EAAE,CAAC,EACdK,EAAMQ,EAAIb,CAAC,EAAE,CAAC,EAEpB,QAAS4K,EAAI,GAAIA,GAAK,EAAGA,IACvB,QAAStd,EAAI,GAAIA,GAAK,EAAGA,IACnBsd,IAAM,IAAMA,IAAM,GAAKtd,IAAM,IAAMA,IAAM,GAC1Csd,IAAM,GAAKtd,IAAM,EAClBqd,EAAO,IAAIvK,EAAMwK,EAAGvK,EAAM/S,EAAG,GAAM,EAAI,EAEvCqd,EAAO,IAAIvK,EAAMwK,EAAGvK,EAAM/S,EAAG,GAAO,EAAI,CAIlD,CACA,CAQA,SAASyd,EAAkBJ,EAAQxL,EAAS,CAC1C,MAAM9C,EAAOsO,EAAO,KACdK,EAAOb,EAAQ,eAAehL,CAAO,EAC3C,IAAIiB,EAAKC,EAAK4K,EAEd,QAASjL,EAAI,EAAGA,EAAI,GAAIA,IACtBI,EAAM,KAAK,MAAMJ,EAAI,CAAC,EACtBK,EAAML,EAAI,EAAI3D,EAAO,EAAI,EACzB4O,GAAQD,GAAQhL,EAAK,KAAO,EAE5B2K,EAAO,IAAIvK,EAAKC,EAAK4K,EAAK,EAAI,EAC9BN,EAAO,IAAItK,EAAKD,EAAK6K,EAAK,EAAI,CAElC,CASA,SAASC,EAAiBP,EAAQlI,EAAsBX,EAAa,CACnE,MAAMzF,EAAOsO,EAAO,KACdK,EAAOX,EAAW,eAAe5H,EAAsBX,CAAW,EACxE,IAAI9B,EAAGiL,EAEP,IAAKjL,EAAI,EAAGA,EAAI,GAAIA,IAClBiL,GAAQD,GAAQhL,EAAK,KAAO,EAGxBA,EAAI,EACN2K,EAAO,IAAI3K,EAAG,EAAGiL,EAAK,EAAI,EACjBjL,EAAI,EACb2K,EAAO,IAAI3K,EAAI,EAAG,EAAGiL,EAAK,EAAI,EAE9BN,EAAO,IAAItO,EAAO,GAAK2D,EAAG,EAAGiL,EAAK,EAAI,EAIpCjL,EAAI,EACN2K,EAAO,IAAI,EAAGtO,EAAO2D,EAAI,EAAGiL,EAAK,EAAI,EAC5BjL,EAAI,EACb2K,EAAO,IAAI,EAAG,GAAK3K,EAAI,EAAI,EAAGiL,EAAK,EAAI,EAEvCN,EAAO,IAAI,EAAG,GAAK3K,EAAI,EAAGiL,EAAK,EAAI,EAKvCN,EAAO,IAAItO,EAAO,EAAG,EAAG,EAAG,EAAI,CACjC,CAQA,SAAS8O,EAAWR,EAAQjN,EAAM,CAChC,MAAMrB,EAAOsO,EAAO,KACpB,IAAIS,EAAM,GACNhL,EAAM/D,EAAO,EACbgP,EAAW,EACXC,EAAY,EAEhB,QAASjL,EAAMhE,EAAO,EAAGgE,EAAM,EAAGA,GAAO,EAGvC,IAFIA,IAAQ,GAAGA,MAEF,CACX,QAAS/S,EAAI,EAAGA,EAAI,EAAGA,IACrB,GAAI,CAACqd,EAAO,WAAWvK,EAAKC,EAAM/S,CAAC,EAAG,CACpC,IAAIie,GAAO,GAEPD,EAAY5N,EAAK,SACnB6N,IAAU7N,EAAK4N,CAAS,IAAMD,EAAY,KAAO,GAGnDV,EAAO,IAAIvK,EAAKC,EAAM/S,EAAGie,EAAI,EAC7BF,IAEIA,IAAa,KACfC,IACAD,EAAW,EAEvB,CAKM,GAFAjL,GAAOgL,EAEHhL,EAAM,GAAK/D,GAAQ+D,EAAK,CAC1BA,GAAOgL,EACPA,EAAM,CAACA,EACP,KACR,CACA,CAEA,CAUA,SAASI,EAAYrM,EAASsD,EAAsB6C,EAAU,CAE5D,MAAMmG,EAAS,IAAI9L,EAEnB2F,EAAS,QAAQ,SAAU5H,EAAM,CAE/B+N,EAAO,IAAI/N,EAAK,KAAK,IAAK,CAAC,EAS3B+N,EAAO,IAAI/N,EAAK,UAAS,EAAImH,EAAK,sBAAsBnH,EAAK,KAAMyB,CAAO,CAAC,EAG3EzB,EAAK,MAAM+N,CAAM,CACrB,CAAG,EAGD,MAAM/F,EAAiBhB,EAAM,wBAAwBvF,CAAO,EACtDwG,EAAmBhB,EAAO,uBAAuBxF,EAASsD,CAAoB,EAC9EmD,GAA0BF,EAAiBC,GAAoB,EAgBrE,IATI8F,EAAO,kBAAoB,GAAK7F,GAClC6F,EAAO,IAAI,EAAG,CAAC,EAQVA,EAAO,kBAAoB,IAAM,GACtCA,EAAO,OAAO,CAAC,EAOjB,MAAMC,GAAiB9F,EAAyB6F,EAAO,gBAAe,GAAM,EAC5E,QAASzL,EAAI,EAAGA,EAAI0L,EAAe1L,IACjCyL,EAAO,IAAIzL,EAAI,EAAI,GAAO,IAAM,CAAC,EAGnC,OAAO2L,EAAgBF,EAAQtM,EAASsD,CAAoB,CAC9D,CAWA,SAASkJ,EAAiBzL,EAAWf,EAASsD,EAAsB,CAElE,MAAMiD,EAAiBhB,EAAM,wBAAwBvF,CAAO,EAGtDwG,EAAmBhB,EAAO,uBAAuBxF,EAASsD,CAAoB,EAG9EmJ,EAAqBlG,EAAiBC,EAGtCkG,EAAgBlH,EAAO,eAAexF,EAASsD,CAAoB,EAGnEqJ,EAAiBpG,EAAiBmG,EAClCE,EAAiBF,EAAgBC,EAEjCE,GAAyB,KAAK,MAAMtG,EAAiBmG,CAAa,EAElEI,GAAwB,KAAK,MAAML,EAAqBC,CAAa,EACrEK,GAAwBD,GAAwB,EAGhDE,GAAUH,GAAyBC,GAGnCG,GAAK,IAAI5I,EAAmB2I,EAAO,EAEzC,IAAI/I,GAAS,EACb,MAAMiJ,GAAS,IAAI,MAAMR,CAAa,EAChCS,GAAS,IAAI,MAAMT,CAAa,EACtC,IAAIU,EAAc,EAClB,MAAMd,GAAS,IAAI,WAAWvL,EAAU,MAAM,EAG9C,QAASzS,GAAI,EAAGA,GAAIoe,EAAepe,KAAK,CACtC,MAAM+e,GAAW/e,GAAIse,EAAiBE,GAAwBC,GAG9DG,GAAO5e,EAAC,EAAIge,GAAO,MAAMrI,GAAQA,GAASoJ,EAAQ,EAGlDF,GAAO7e,EAAC,EAAI2e,GAAG,OAAOC,GAAO5e,EAAC,CAAC,EAE/B2V,IAAUoJ,GACVD,EAAc,KAAK,IAAIA,EAAaC,EAAQ,CAChD,CAIE,MAAM9O,GAAO,IAAI,WAAWgI,CAAc,EAC1C,IAAI9F,GAAQ,EACRI,GAAG4K,GAGP,IAAK5K,GAAI,EAAGA,GAAIuM,EAAavM,KAC3B,IAAK4K,GAAI,EAAGA,GAAIiB,EAAejB,KACzB5K,GAAIqM,GAAOzB,EAAC,EAAE,SAChBlN,GAAKkC,IAAO,EAAIyM,GAAOzB,EAAC,EAAE5K,EAAC,GAMjC,IAAKA,GAAI,EAAGA,GAAImM,GAASnM,KACvB,IAAK4K,GAAI,EAAGA,GAAIiB,EAAejB,KAC7BlN,GAAKkC,IAAO,EAAI0M,GAAO1B,EAAC,EAAE5K,EAAC,EAI/B,OAAOtC,EACT,CAWA,SAAS+O,EAAc/O,EAAMyB,EAASsD,EAAsBX,EAAa,CACvE,IAAIwD,EAEJ,GAAI,MAAM,QAAQ5H,CAAI,EACpB4H,EAAWkF,EAAS,UAAU9M,CAAI,UACzB,OAAOA,GAAS,SAAU,CACnC,IAAIgP,GAAmBvN,EAEvB,GAAI,CAACuN,GAAkB,CACrB,MAAMC,GAAcnC,EAAS,SAAS9M,CAAI,EAG1CgP,GAAmBvC,EAAQ,sBAAsBwC,GAAalK,CAAoB,CACxF,CAII6C,EAAWkF,EAAS,WAAW9M,EAAMgP,IAAoB,EAAE,CAC/D,KACI,OAAM,IAAI,MAAM,cAAc,EAIhC,MAAME,EAAczC,EAAQ,sBAAsB7E,EAAU7C,CAAoB,EAGhF,GAAI,CAACmK,EACH,MAAM,IAAI,MAAM,yDAAyD,EAI3E,GAAI,CAACzN,EACHA,EAAUyN,UAGDzN,EAAUyN,EACnB,MAAM,IAAI,MAAM;AAAA;AAAA,qDAE0CA,EAAc;AAAA,CAC5E,EAGE,MAAMC,EAAWrB,EAAWrM,EAASsD,EAAsB6C,CAAQ,EAG7DwH,EAAcpI,EAAM,cAAcvF,CAAO,EACzC4N,EAAU,IAAI5M,EAAU2M,CAAW,EAGzC,OAAApC,EAAmBqC,EAAS5N,CAAO,EACnC0L,EAAmBkC,CAAO,EAC1BjC,EAAsBiC,EAAS5N,CAAO,EAMtC+L,EAAgB6B,EAAStK,EAAsB,CAAC,EAE5CtD,GAAW,GACb4L,EAAiBgC,EAAS5N,CAAO,EAInCgM,EAAU4B,EAASF,CAAQ,EAEvB,MAAM/K,CAAW,IAEnBA,EAAcmI,EAAY,YAAY8C,EACpC7B,EAAgB,KAAK,KAAM6B,EAAStK,CAAoB,CAAC,GAI7DwH,EAAY,UAAUnI,EAAaiL,CAAO,EAG1C7B,EAAgB6B,EAAStK,EAAsBX,CAAW,EAEnD,CACL,QAASiL,EACT,QAAS5N,EACT,qBAAsBsD,EACtB,YAAaX,EACb,SAAUwD,CACd,CACA,CAWA,OAAA0H,GAAA,OAAiB,SAAiBtP,EAAMuP,EAAS,CAC/C,GAAI,OAAOvP,EAAS,KAAeA,IAAS,GAC1C,MAAM,IAAI,MAAM,eAAe,EAGjC,IAAI+E,EAAuBJ,EAAQ,EAC/BlD,EACAZ,EAEJ,OAAI,OAAO0O,EAAY,MAErBxK,EAAuBJ,EAAQ,KAAK4K,EAAQ,qBAAsB5K,EAAQ,CAAC,EAC3ElD,EAAUgL,EAAQ,KAAK8C,EAAQ,OAAO,EACtC1O,EAAO0L,EAAY,KAAKgD,EAAQ,WAAW,EAEvCA,EAAQ,YACVvI,EAAM,kBAAkBuI,EAAQ,UAAU,GAIvCR,EAAa/O,EAAMyB,EAASsD,EAAsBlE,CAAI,CAC/D,oEC9eA,SAAS2O,EAAUC,EAAK,CAKtB,GAJI,OAAOA,GAAQ,WACjBA,EAAMA,EAAI,SAAQ,GAGhB,OAAOA,GAAQ,SACjB,MAAM,IAAI,MAAM,uCAAuC,EAGzD,IAAIC,EAAUD,EAAI,MAAK,EAAG,QAAQ,IAAK,EAAE,EAAE,MAAM,EAAE,EACnD,GAAIC,EAAQ,OAAS,GAAKA,EAAQ,SAAW,GAAKA,EAAQ,OAAS,EACjE,MAAM,IAAI,MAAM,sBAAwBD,CAAG,GAIzCC,EAAQ,SAAW,GAAKA,EAAQ,SAAW,KAC7CA,EAAU,MAAM,UAAU,OAAO,MAAM,CAAA,EAAIA,EAAQ,IAAI,SAAU9f,EAAG,CAClE,MAAO,CAACA,EAAGA,CAAC,CAClB,CAAK,CAAC,GAIA8f,EAAQ,SAAW,GAAGA,EAAQ,KAAK,IAAK,GAAG,EAE/C,MAAMC,EAAW,SAASD,EAAQ,KAAK,EAAE,EAAG,EAAE,EAE9C,MAAO,CACL,EAAIC,GAAY,GAAM,IACtB,EAAIA,GAAY,GAAM,IACtB,EAAIA,GAAY,EAAK,IACrB,EAAGA,EAAW,IACd,IAAK,IAAMD,EAAQ,MAAM,EAAG,CAAC,EAAE,KAAK,EAAE,CAC1C,CACA,CAEA9N,EAAA,WAAqB,SAAqB2N,EAAS,CAC5CA,IAASA,EAAU,CAAA,GACnBA,EAAQ,QAAOA,EAAQ,MAAQ,CAAA,GAEpC,MAAMK,EAAS,OAAOL,EAAQ,OAAW,KACvCA,EAAQ,SAAW,MACnBA,EAAQ,OAAS,EACf,EACAA,EAAQ,OAENM,EAAQN,EAAQ,OAASA,EAAQ,OAAS,GAAKA,EAAQ,MAAQ,OAC/DO,EAAQP,EAAQ,OAAS,EAE/B,MAAO,CACL,MAAOM,EACP,MAAOA,EAAQ,EAAIC,EACnB,OAAQF,EACR,MAAO,CACL,KAAMJ,EAASD,EAAQ,MAAM,MAAQ,WAAW,EAChD,MAAOC,EAASD,EAAQ,MAAM,OAAS,WAAW,GAEpD,KAAMA,EAAQ,KACd,aAAcA,EAAQ,cAAgB,CAAA,CAC1C,CACA,EAEA3N,EAAA,SAAmB,SAAmBmO,EAAQ1U,EAAM,CAClD,OAAOA,EAAK,OAASA,EAAK,OAAS0U,EAAS1U,EAAK,OAAS,EACtDA,EAAK,OAAS0U,EAAS1U,EAAK,OAAS,GACrCA,EAAK,KACX,EAEAuG,EAAA,cAAwB,SAAwBmO,EAAQ1U,EAAM,CAC5D,MAAMyU,EAAQlO,EAAQ,SAASmO,EAAQ1U,CAAI,EAC3C,OAAO,KAAK,OAAO0U,EAAS1U,EAAK,OAAS,GAAKyU,CAAK,CACtD,EAEAlO,EAAA,cAAwB,SAAwBoO,EAASC,EAAI5U,EAAM,CACjE,MAAMsD,EAAOsR,EAAG,QAAQ,KAClBjQ,EAAOiQ,EAAG,QAAQ,KAClBH,EAAQlO,EAAQ,SAASjD,EAAMtD,CAAI,EACnC6U,EAAa,KAAK,OAAOvR,EAAOtD,EAAK,OAAS,GAAKyU,CAAK,EACxDK,EAAe9U,EAAK,OAASyU,EAC7BM,EAAU,CAAC/U,EAAK,MAAM,MAAOA,EAAK,MAAM,IAAI,EAElD,QAASiH,EAAI,EAAGA,EAAI4N,EAAY5N,IAC9B,QAASlE,EAAI,EAAGA,EAAI8R,EAAY9R,IAAK,CACnC,IAAIiS,GAAU/N,EAAI4N,EAAa9R,GAAK,EAChCkS,EAAUjV,EAAK,MAAM,MAEzB,GAAIiH,GAAK6N,GAAgB/R,GAAK+R,GAC5B7N,EAAI4N,EAAaC,GAAgB/R,EAAI8R,EAAaC,EAAc,CAChE,MAAMI,EAAO,KAAK,OAAOjO,EAAI6N,GAAgBL,CAAK,EAC5CU,EAAO,KAAK,OAAOpS,EAAI+R,GAAgBL,CAAK,EAClDQ,EAAUF,EAAQpQ,EAAKuQ,EAAO5R,EAAO6R,CAAI,EAAI,EAAI,CAAC,CAC1D,CAEMR,EAAQK,GAAQ,EAAIC,EAAQ,EAC5BN,EAAQK,GAAQ,EAAIC,EAAQ,EAC5BN,EAAQK,GAAQ,EAAIC,EAAQ,EAC5BN,EAAQK,CAAM,EAAIC,EAAQ,CAChC,CAEA,+DClGA,MAAMtJ,EAAQ1X,GAAA,EAEd,SAASmhB,EAAaC,EAAKC,EAAQhS,EAAM,CACvC+R,EAAI,UAAU,EAAG,EAAGC,EAAO,MAAOA,EAAO,MAAM,EAE1CA,EAAO,QAAOA,EAAO,MAAQ,CAAA,GAClCA,EAAO,OAAShS,EAChBgS,EAAO,MAAQhS,EACfgS,EAAO,MAAM,OAAShS,EAAO,KAC7BgS,EAAO,MAAM,MAAQhS,EAAO,IAC9B,CAEA,SAASiS,GAAoB,CAC3B,GAAI,CACF,OAAO,SAAS,cAAc,QAAQ,CAC1C,MAAc,CACV,MAAM,IAAI,MAAM,sCAAsC,CAC1D,CACA,CAEAhP,EAAA,OAAiB,SAAiBiP,EAAQF,EAAQpB,EAAS,CACzD,IAAIlU,EAAOkU,EACPuB,EAAWH,EAEX,OAAOtV,EAAS,MAAgB,CAACsV,GAAU,CAACA,EAAO,cACrDtV,EAAOsV,EACPA,EAAS,QAGNA,IACHG,EAAWF,EAAgB,GAG7BvV,EAAO2L,EAAM,WAAW3L,CAAI,EAC5B,MAAMsD,EAAOqI,EAAM,cAAc6J,EAAO,QAAQ,KAAMxV,CAAI,EAEpDqV,EAAMI,EAAS,WAAW,IAAI,EAC9BC,EAAQL,EAAI,gBAAgB/R,EAAMA,CAAI,EAC5C,OAAAqI,EAAM,cAAc+J,EAAM,KAAMF,EAAQxV,CAAI,EAE5CoV,EAAYC,EAAKI,EAAUnS,CAAI,EAC/B+R,EAAI,aAAaK,EAAO,EAAG,CAAC,EAErBD,CACT,EAEAlP,EAAA,gBAA0B,SAA0BiP,EAAQF,EAAQpB,EAAS,CAC3E,IAAIlU,EAAOkU,EAEP,OAAOlU,EAAS,MAAgB,CAACsV,GAAU,CAACA,EAAO,cACrDtV,EAAOsV,EACPA,EAAS,QAGNtV,IAAMA,EAAO,CAAA,GAElB,MAAMyV,EAAWlP,EAAQ,OAAOiP,EAAQF,EAAQtV,CAAI,EAE9C2V,EAAO3V,EAAK,MAAQ,YACpB4V,EAAe5V,EAAK,cAAgB,CAAA,EAE1C,OAAOyV,EAAS,UAAUE,EAAMC,EAAa,OAAO,CACtD,4DC9DA,MAAMjK,EAAQ1X,GAAA,EAEd,SAAS4hB,EAAgBC,EAAOC,EAAQ,CACtC,MAAMC,EAAQF,EAAM,EAAI,IAClBvK,EAAMwK,EAAS,KAAOD,EAAM,IAAM,IAExC,OAAOE,EAAQ,EACXzK,EAAM,IAAMwK,EAAS,aAAeC,EAAM,QAAQ,CAAC,EAAE,MAAM,CAAC,EAAI,IAChEzK,CACN,CAEA,SAAS0K,EAAQC,EAAKvZ,EAAGC,EAAG,CAC1B,IAAI2O,EAAM2K,EAAMvZ,EAChB,OAAI,OAAOC,EAAM,MAAa2O,GAAO,IAAM3O,GAEpC2O,CACT,CAEA,SAAS4K,EAAUxR,EAAMrB,EAAMiR,EAAQ,CACrC,IAAIjc,EAAO,GACP8d,EAAS,EACTC,EAAS,GACTC,EAAa,EAEjB,QAASrP,EAAI,EAAGA,EAAItC,EAAK,OAAQsC,IAAK,CACpC,MAAMK,EAAM,KAAK,MAAML,EAAI3D,CAAI,EACzB+D,EAAM,KAAK,MAAMJ,EAAI3D,CAAI,EAE3B,CAACgE,GAAO,CAAC+O,IAAQA,EAAS,IAE1B1R,EAAKsC,CAAC,GACRqP,IAEMrP,EAAI,GAAKK,EAAM,GAAK3C,EAAKsC,EAAI,CAAC,IAClC3O,GAAQ+d,EACJJ,EAAO,IAAK3O,EAAMiN,EAAQ,GAAMlN,EAAMkN,CAAM,EAC5C0B,EAAO,IAAKG,EAAQ,CAAC,EAEzBA,EAAS,EACTC,EAAS,IAGL/O,EAAM,EAAIhE,GAAQqB,EAAKsC,EAAI,CAAC,IAChC3O,GAAQ2d,EAAO,IAAKK,CAAU,EAC9BA,EAAa,IAGfF,GAEN,CAEE,OAAO9d,CACT,CAEA,OAAAie,GAAA,OAAiB,SAAiBf,EAAQtB,EAASsC,EAAI,CACrD,MAAMxW,EAAO2L,EAAM,WAAWuI,CAAO,EAC/B5Q,EAAOkS,EAAO,QAAQ,KACtB7Q,EAAO6Q,EAAO,QAAQ,KACtBiB,EAAanT,EAAOtD,EAAK,OAAS,EAElC0W,EAAM1W,EAAK,MAAM,MAAM,EAEzB,SAAW6V,EAAe7V,EAAK,MAAM,MAAO,MAAM,EAClD,YAAcyW,EAAa,IAAMA,EAAa,SAF9C,GAIEne,EACJ,SAAWud,EAAe7V,EAAK,MAAM,KAAM,QAAQ,EACnD,OAASmW,EAASxR,EAAMrB,EAAMtD,EAAK,MAAM,EAAI,MAEzC2W,EAAU,gBAAuBF,EAAa,IAAMA,EAAa,IAIjEF,EAAS,4CAFAvW,EAAK,MAAa,UAAYA,EAAK,MAAQ,aAAeA,EAAK,MAAQ,KAA1D,IAEwC2W,EAAU,iCAAmCD,EAAKpe,EAAO;AAAA,EAE7H,OAAI,OAAOke,GAAO,YAChBA,EAAG,KAAMD,CAAM,EAGVA,CACT,+CC/EA,MAAMvQ,EAAa/R,GAAA,EAEb2iB,EAAS9Y,GAAA,EACT+Y,EAAiBhL,GAAA,EACjBiL,EAAc/K,GAAA,EAEpB,SAASgL,EAAcC,EAAY1B,EAAQ2B,EAAMjX,EAAMwW,EAAI,CACzD,MAAMU,EAAO,CAAA,EAAG,MAAM,KAAK,UAAW,CAAC,EACjCC,EAAUD,EAAK,OACfE,EAAc,OAAOF,EAAKC,EAAU,CAAC,GAAM,WAEjD,GAAI,CAACC,GAAe,CAACpR,IACnB,MAAM,IAAI,MAAM,oCAAoC,EAGtD,GAAIoR,EAAa,CACf,GAAID,EAAU,EACZ,MAAM,IAAI,MAAM,4BAA4B,EAG1CA,IAAY,GACdX,EAAKS,EACLA,EAAO3B,EACPA,EAAStV,EAAO,QACPmX,IAAY,IACjB7B,EAAO,YAAc,OAAOkB,EAAO,KACrCA,EAAKxW,EACLA,EAAO,SAEPwW,EAAKxW,EACLA,EAAOiX,EACPA,EAAO3B,EACPA,EAAS,QAGjB,KAAS,CACL,GAAI6B,EAAU,EACZ,MAAM,IAAI,MAAM,4BAA4B,EAG9C,OAAIA,IAAY,GACdF,EAAO3B,EACPA,EAAStV,EAAO,QACPmX,IAAY,GAAK,CAAC7B,EAAO,aAClCtV,EAAOiX,EACPA,EAAO3B,EACPA,EAAS,QAGJ,IAAI,QAAQ,SAAU+B,EAASC,EAAQ,CAC5C,GAAI,CACF,MAAM3S,EAAOiS,EAAO,OAAOK,EAAMjX,CAAI,EACrCqX,EAAQL,EAAWrS,EAAM2Q,EAAQtV,CAAI,CAAC,CAC9C,OAAepL,EAAG,CACV0iB,EAAO1iB,CAAC,CAChB,CACA,CAAK,CACL,CAEE,GAAI,CACF,MAAM+P,EAAOiS,EAAO,OAAOK,EAAMjX,CAAI,EACrCwW,EAAG,KAAMQ,EAAWrS,EAAM2Q,EAAQtV,CAAI,CAAC,CAC3C,OAAWpL,EAAG,CACV4hB,EAAG5hB,CAAC,CACR,CACA,CAEA,OAAA2iB,GAAA,OAAiBX,EAAO,OACxBW,GAAA,SAAmBR,EAAa,KAAK,KAAMF,EAAe,MAAM,EAChEU,GAAA,UAAoBR,EAAa,KAAK,KAAMF,EAAe,eAAe,EAG1EU,GAAA,SAAmBR,EAAa,KAAK,KAAM,SAAUpS,EAAM6S,EAAGxX,EAAM,CAClE,OAAO8W,EAAY,OAAOnS,EAAM3E,CAAI,CACtC,CAAC,iCCzED,eAAeyX,GAAUC,EAAwC,CAC/D,OAAO,IAAI,QAAQ,CAACL,EAASC,IAAW,CACtC,MAAMK,EAAM,IAAI,MAChBA,EAAI,OAAS,IAAMN,EAAQM,CAAG,EAC9BA,EAAI,QAAW/iB,GAAM0iB,EAAO1iB,CAAC,EAC7B+iB,EAAI,IAAMD,CACZ,CAAC,CACH,CAgBA,eAAsBE,GAAkBC,EAAmB7X,EAAsC,CAC/F,KAAM,CAAC8X,EAAOC,CAAO,EAAI,MAAM,QAAQ,IAAI,CACzCN,GAAUI,CAAS,EACnBJ,GAAUzX,EAAK,OAAO,CAAA,CACvB,EACKgY,EAAI,KAAK,IAAI,IAAKF,EAAM,OAAS,GAAG,EACpCjjB,EAAI,KAAK,IAAI,IAAKijB,EAAM,QAAU,GAAG,EACrCxC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQ0C,EACf1C,EAAO,OAASzgB,EAChB,MAAMwgB,EAAMC,EAAO,WAAW,IAAI,EAClCD,EAAI,UAAY,UAChBA,EAAI,SAAS,EAAG,EAAG2C,EAAGnjB,CAAC,EAEvBwgB,EAAI,sBAAwB,GAC5BA,EAAI,UAAUyC,EAAO,EAAG,EAAGE,EAAGnjB,CAAC,EAE/B,MAAMojB,EAAKD,EAAI,EACTE,EAAKrjB,EAAI,EACT4f,EAAQ,KAAK,IAAI,IAAM,KAAK,IAAI,IAAMzU,EAAK,WAAa,EAAG,CAAC,EAC5DmY,EAAW,KAAK,MAAM,KAAK,IAAIH,EAAGnjB,CAAC,EAAI4f,CAAK,EAC5C,EAAI,KAAK,MAAMwD,EAAKE,EAAW,CAAC,EAChCvb,EAAI,KAAK,MAAMsb,EAAKC,EAAW,CAAC,EAEtC,GAAInY,EAAK,OAAS,GAAO,CACvB,MAAMoY,EAAQpY,EAAK,OAAS,eACtBqY,EAAM,KAAK,IAAI,EAAG,KAAK,MAAMF,EAAW,GAAI,CAAC,EAC7CG,EAAK,EAAID,EACTE,EAAK3b,EAAIyb,EACTG,EAAKL,EAAWE,EAAM,EACtBI,EAAKN,EAAWE,EAAM,EAE5B,GADAhD,EAAI,UAAA,EACA+C,IAAU,SAAU,CACtB,MAAMvG,EAAI,KAAK,IAAI2G,EAAIC,CAAE,EAAI,EAC7BpD,EAAI,IAAIiD,EAAKE,EAAG,EAAGD,EAAKE,EAAG,EAAG5G,EAAG,EAAG,KAAK,GAAK,CAAC,CACjD,SAAWuG,IAAU,OACnB/C,EAAI,KAAKiD,EAAIC,EAAIC,EAAIC,CAAE,MAClB,CACL,MAAMC,EAAS,KAAK,IAAI,EAAG1Y,EAAK,UAAY,KAAK,MAAMmY,EAAW,GAAI,CAAC,EACjEtG,EAAI,KAAK,IAAI6G,EAAQF,EAAG,EAAGC,EAAG,CAAC,EACrCpD,EAAI,OAAOiD,EAAKzG,EAAG0G,CAAE,EACrBlD,EAAI,MAAMiD,EAAKE,EAAID,EAAID,EAAKE,EAAID,EAAKE,EAAI5G,CAAC,EAC1CwD,EAAI,MAAMiD,EAAKE,EAAID,EAAKE,EAAIH,EAAIC,EAAKE,EAAI5G,CAAC,EAC1CwD,EAAI,MAAMiD,EAAIC,EAAKE,EAAIH,EAAIC,EAAI1G,CAAC,EAChCwD,EAAI,MAAMiD,EAAIC,EAAID,EAAKE,EAAID,EAAI1G,CAAC,EAChCwD,EAAI,UAAA,CACN,CAEAA,EAAI,UAAY,UAChBA,EAAI,KAAA,EAEJA,EAAI,UAAY,EAChBA,EAAI,YAAcrV,EAAK,YAAc,mBACrCqV,EAAI,OAAA,CACN,CAIA,GADAA,EAAI,KAAA,EACArV,EAAK,QAAU,SAAU,CAC3B,MAAM6R,EAAIsG,EAAW,EACrB9C,EAAI,UAAA,EACJA,EAAI,IAAI,EAAIxD,EAAGjV,EAAIiV,EAAGA,EAAG,EAAG,KAAK,GAAK,CAAC,EACvCwD,EAAI,KAAA,CACN,CACA,OAAAA,EAAI,sBAAwB,GAC5BA,EAAI,UAAU0C,EAAS,EAAGnb,EAAGub,EAAUA,CAAQ,EAC/C9C,EAAI,QAAA,EACGC,EAAO,UAAU,WAAW,CACrC,CAUA,eAAsBqD,GAAsB1B,EAAc/C,EAAyC,CACjG,KAAM,CAAE,MAAAM,EAAQ,IAAK,OAAAD,EAAS,EAAG,qBAAA7K,EAAuB,IAAK,MAAAoM,EAAQ,CAAE,KAAM,UAAW,MAAO,SAAA,EAAa,KAAA8C,CAAA,EAAS1E,GAAW,CAAA,EAC1H3b,EAAO,MAAMqe,GAAO,UAAUK,EAAM,CAAE,MAAAzC,EAAO,OAAAD,EAAQ,qBAAA7K,EAAsB,MAAAoM,EAAO,EACxF,OAAK8C,EACEhB,GAAkBrf,EAAMqgB,CAAI,EADjBrgB,CAEpB,aC2IA,SAASsgB,GAAkBC,EAAY5E,EAAS,CAC9C,IAAI6E,EACJ,GAAI,CACFA,EAAUD,EAAA,CACZ,MAAa,CACX,MACF,CAsBA,MArBuB,CACrB,QAAUvY,GAAS,CACjB,IAAIyY,EACJ,MAAMC,EAASC,GACTA,IAAS,KACJ,KAEF,KAAK,MAAMA,EAAwB,MAAwB,EAE9D3N,GAAOyN,EAAKD,EAAQ,QAAQxY,CAAI,IAAM,KAAOyY,EAAK,KACxD,OAAIzN,aAAe,QACVA,EAAI,KAAK0N,CAAK,EAEhBA,EAAM1N,CAAG,CAClB,EACA,QAAS,CAAChL,EAAM4Y,IAAaJ,EAAQ,QACnCxY,EACA,KAAK,UAAU4Y,EAA4B,MAAyB,CAAA,EAEtE,WAAa5Y,GAASwY,EAAQ,WAAWxY,CAAI,CAAA,CAGjD,CACA,MAAM6Y,GAAcC,GAAQrgB,GAAU,CACpC,GAAI,CACF,MAAMoR,EAASiP,EAAGrgB,CAAK,EACvB,OAAIoR,aAAkB,QACbA,EAEF,CACL,KAAKkP,EAAa,CAChB,OAAOF,GAAWE,CAAW,EAAElP,CAAM,CACvC,EACA,MAAMmP,EAAa,CACjB,OAAO,IACT,CAAA,CAEJ,OAAS3kB,EAAG,CACV,MAAO,CACL,KAAK4kB,EAAc,CACjB,OAAO,IACT,EACA,MAAMC,EAAY,CAChB,OAAOL,GAAWK,CAAU,EAAE7kB,CAAC,CACjC,CAAA,CAEJ,CACF,EACM8kB,GAAU,CAACC,EAAQC,IAAgB,CAAC9Z,EAAKqD,EAAK7G,IAAQ,CAC1D,IAAI4X,EAAU,CACZ,WAAY,IAAM,aAClB,UAAW,KAAK,UAChB,YAAa,KAAK,MAClB,WAAarY,GAAUA,EACvB,QAAS,EACT,MAAO,CAACge,EAAgBC,KAAkB,CACxC,GAAGA,EACH,GAAGD,CAAA,GAEL,GAAGD,CAAA,EAEDG,EAAc,GAClB,MAAMC,MAAyC,IACzCC,MAA+C,IACrD,IAAIlB,EACJ,GAAI,CACFA,EAAU7E,EAAQ,WAAA,CACpB,MAAa,CACb,CACA,GAAI,CAAC6E,EACH,OAAOY,EACL,IAAIzC,IAAS,CACX,QAAQ,KACN,uDAAuDhD,EAAQ,IAAI,gDAAA,EAErEpU,EAAI,GAAGoX,CAAI,CACb,EACA/T,EACA7G,CAAA,EAGJ,MAAM4d,EAAoBd,GAAWlF,EAAQ,SAAS,EAChDiG,EAAU,IAAM,CACpB,MAAMte,EAAQqY,EAAQ,WAAW,CAAE,GAAG/Q,EAAA,EAAO,EAC7C,IAAIiX,EACJ,MAAMC,EAAWH,EAAkB,CAAE,MAAAre,EAAO,QAASqY,EAAQ,OAAA,CAAS,EAAE,KACrEoG,GAAoBvB,EAAQ,QAAQ7E,EAAQ,KAAMoG,CAAe,CAAA,EAClE,MAAO1lB,GAAM,CACbwlB,EAAcxlB,CAChB,CAAC,EACD,GAAIwlB,EACF,MAAMA,EAER,OAAOC,CACT,EACME,EAAgBje,EAAI,SAC1BA,EAAI,SAAW,CAACT,EAAOI,IAAY,CACjCse,EAAc1e,EAAOI,CAAO,EACvBke,EAAA,CACP,EACA,MAAMK,EAAeb,EACnB,IAAIzC,IAAS,CACXpX,EAAI,GAAGoX,CAAI,EACNiD,EAAA,CACP,EACAhX,EACA7G,CAAA,EAEF,IAAIme,EACJ,MAAMC,EAAU,IAAM,CACpB,IAAI1B,EACJ,GAAI,CAACD,EAAS,OACdgB,EAAc,GACdC,EAAmB,QAASxD,GAAOA,EAAGrT,EAAA,CAAK,CAAC,EAC5C,MAAMwX,IAA4B3B,EAAK9E,EAAQ,qBAAuB,KAAO,OAAS8E,EAAG,KAAK9E,EAAS/Q,EAAA,CAAK,IAAM,OAClH,OAAOiW,GAAWL,EAAQ,QAAQ,KAAKA,CAAO,CAAC,EAAE7E,EAAQ,IAAI,EAAE,KAAM0G,GAAiB,CACpF,GAAIA,EACF,OAAO1G,EAAQ,YAAY0G,CAAY,CAE3C,CAAC,EAAE,KAAMC,GAA6B,CACpC,GAAIA,EACF,GAAI,OAAOA,EAAyB,SAAY,UAAYA,EAAyB,UAAY3G,EAAQ,QAAS,CAChH,GAAIA,EAAQ,QACV,OAAOA,EAAQ,QACb2G,EAAyB,MACzBA,EAAyB,OAAA,EAG7B,QAAQ,MACN,uFAAA,CAEJ,KACE,QAAOA,EAAyB,KAGtC,CAAC,EAAE,KAAMC,GAAkB,CACzB,IAAIC,EACJ,OAAAN,EAAmBvG,EAAQ,MACzB4G,GACCC,EAAM5X,MAAU,KAAO4X,EAAMP,CAAA,EAEhC1a,EAAI2a,EAAkB,EAAI,EACnBN,EAAA,CACT,CAAC,EAAE,KAAK,IAAM,CAC+BQ,IAAwBF,EAAkB,MAAM,EAC3FV,EAAc,GACdE,EAAyB,QAASzD,GAAOA,EAAGiE,CAAgB,CAAC,CAC/D,CAAC,EAAE,MAAO7lB,GAAM,CAC6B+lB,IAAwB,OAAQ/lB,CAAC,CAC9E,CAAC,CACH,EACA,OAAA0H,EAAI,QAAU,CACZ,WAAa0e,GAAe,CAC1B9G,EAAU,CACR,GAAGA,EACH,GAAG8G,CAAA,EAEDA,EAAW,aACbjC,EAAUiC,EAAW,WAAA,EAEzB,EACA,aAAc,IAAM,CACSjC,GAAQ,WAAW7E,EAAQ,IAAI,CAC5D,EACA,WAAY,IAAMA,EAClB,UAAW,IAAMwG,EAAA,EACjB,YAAa,IAAMX,EACnB,UAAYvD,IACVwD,EAAmB,IAAIxD,CAAE,EAClB,IAAM,CACXwD,EAAmB,OAAOxD,CAAE,CAC9B,GAEF,kBAAoBA,IAClByD,EAAyB,IAAIzD,CAAE,EACxB,IAAM,CACXyD,EAAyB,OAAOzD,CAAE,CACpC,EACF,EAEFkE,EAAA,EACOD,GAAoBD,CAC7B,EACMS,GAAU,CAACtB,EAAQC,IAAgB,CAAC9Z,EAAKqD,EAAK7G,IAAQ,CAC1D,IAAI4X,EAAU,CACZ,QAAS2E,GAAkB,IAAM,YAAY,EAC7C,WAAahd,GAAUA,EACvB,QAAS,EACT,MAAO,CAACge,EAAgBC,KAAkB,CACxC,GAAGA,EACH,GAAGD,CAAA,GAEL,GAAGD,CAAA,EAEDG,EAAc,GAClB,MAAMC,MAAyC,IACzCC,MAA+C,IACrD,IAAIlB,EAAU7E,EAAQ,QACtB,GAAI,CAAC6E,EACH,OAAOY,EACL,IAAIzC,IAAS,CACX,QAAQ,KACN,uDAAuDhD,EAAQ,IAAI,gDAAA,EAErEpU,EAAI,GAAGoX,CAAI,CACb,EACA/T,EACA7G,CAAA,EAGJ,MAAM6d,EAAU,IAAM,CACpB,MAAMte,EAAQqY,EAAQ,WAAW,CAAE,GAAG/Q,EAAA,EAAO,EAC7C,OAAO4V,EAAQ,QAAQ7E,EAAQ,KAAM,CACnC,MAAArY,EACA,QAASqY,EAAQ,OAAA,CAClB,CACH,EACMqG,EAAgBje,EAAI,SAC1BA,EAAI,SAAW,CAACT,EAAOI,IAAY,CACjCse,EAAc1e,EAAOI,CAAO,EACvBke,EAAA,CACP,EACA,MAAMK,EAAeb,EACnB,IAAIzC,IAAS,CACXpX,EAAI,GAAGoX,CAAI,EACNiD,EAAA,CACP,EACAhX,EACA7G,CAAA,EAEFA,EAAI,gBAAkB,IAAMke,EAC5B,IAAIC,EACJ,MAAMC,EAAU,IAAM,CACpB,IAAI1B,EAAIkC,EACR,GAAI,CAACnC,EAAS,OACdgB,EAAc,GACdC,EAAmB,QAASxD,GAAO,CACjC,IAAIuE,EACJ,OAAOvE,GAAIuE,EAAM5X,EAAA,IAAU,KAAO4X,EAAMP,CAAY,CACtD,CAAC,EACD,MAAMG,IAA4BO,EAAKhH,EAAQ,qBAAuB,KAAO,OAASgH,EAAG,KAAKhH,GAAU8E,EAAK7V,EAAA,IAAU,KAAO6V,EAAKwB,CAAY,IAAM,OACrJ,OAAOpB,GAAWL,EAAQ,QAAQ,KAAKA,CAAO,CAAC,EAAE7E,EAAQ,IAAI,EAAE,KAAM2G,GAA6B,CAChG,GAAIA,EACF,GAAI,OAAOA,EAAyB,SAAY,UAAYA,EAAyB,UAAY3G,EAAQ,QAAS,CAChH,GAAIA,EAAQ,QACV,MAAO,CACL,GACAA,EAAQ,QACN2G,EAAyB,MACzBA,EAAyB,OAAA,CAC3B,EAGJ,QAAQ,MACN,uFAAA,CAEJ,KACE,OAAO,CAAC,GAAOA,EAAyB,KAAK,EAGjD,MAAO,CAAC,GAAO,MAAM,CACvB,CAAC,EAAE,KAAMM,GAAoB,CAC3B,IAAIJ,EACJ,KAAM,CAACK,EAAUN,CAAa,EAAIK,EAMlC,GALAV,EAAmBvG,EAAQ,MACzB4G,GACCC,EAAM5X,MAAU,KAAO4X,EAAMP,CAAA,EAEhC1a,EAAI2a,EAAkB,EAAI,EACtBW,EACF,OAAOjB,EAAA,CAEX,CAAC,EAAE,KAAK,IAAM,CAC+BQ,IAAwBF,EAAkB,MAAM,EAC3FA,EAAmBtX,EAAA,EACnB4W,EAAc,GACdE,EAAyB,QAASzD,GAAOA,EAAGiE,CAAgB,CAAC,CAC/D,CAAC,EAAE,MAAO7lB,GAAM,CAC6B+lB,IAAwB,OAAQ/lB,CAAC,CAC9E,CAAC,CACH,EACA,OAAA0H,EAAI,QAAU,CACZ,WAAa0e,GAAe,CAC1B9G,EAAU,CACR,GAAGA,EACH,GAAG8G,CAAA,EAEDA,EAAW,UACbjC,EAAUiC,EAAW,QAEzB,EACA,aAAc,IAAM,CACSjC,GAAQ,WAAW7E,EAAQ,IAAI,CAC5D,EACA,WAAY,IAAMA,EAClB,UAAW,IAAMwG,EAAA,EACjB,YAAa,IAAMX,EACnB,UAAYvD,IACVwD,EAAmB,IAAIxD,CAAE,EAClB,IAAM,CACXwD,EAAmB,OAAOxD,CAAE,CAC9B,GAEF,kBAAoBA,IAClByD,EAAyB,IAAIzD,CAAE,EACxB,IAAM,CACXyD,EAAyB,OAAOzD,CAAE,CACpC,EACF,EAEGtC,EAAQ,eACXwG,EAAA,EAEKD,GAAoBD,CAC7B,EACMa,GAAc,CAAC1B,EAAQC,IACvB,eAAgBA,GAAe,cAAeA,GAAe,gBAAiBA,IAC3EljB,GAAkB,aAAuB,UAAY,cACxD,QAAQ,KACN,gHAAA,EAGGgjB,GAAQC,EAAQC,CAAW,GAE7BqB,GAAQtB,EAAQC,CAAW,EAE9B0B,GAAUD,GCpjBHE,GAAiB5b,GAAA,EAA2B2b,GAAQ,CAACxb,EAAKqD,KAAS,CAC9E,EAAG,KACH,UAAW,KACX,QAAS,KACT,UAAW,KACX,QAAS,KACT,OAAQ,GACR,UAAW,GACX,eAAiB5O,GAAMuL,EAAKG,IAAO,CAAE,GAAGA,EAAG,GAAG1L,CAAA,EAAI,EAClD,MAAO,IAAMuL,EAAI,CAAE,EAAG,KAAM,UAAW,KAAM,QAAS,KAAM,UAAW,KAAM,QAAS,KAAM,OAAQ,GAAO,CAC7G,GAAI,CACF,KAAM,qBACN,QAAS+Y,GAAkB,IAAM,YAAY,EAE7C,mBAAoB,IAAM,CAAChd,EAAO2f,IAAU,CAE1C,GAAI,EAAAA,GAAS,CAAC3f,GACd,GAAI,CACF,GAAIA,GAAS,CAACA,EAAM,EAAG,CACrB,MAAM4f,EAAS,aAAa,QAAQ,oBAAoB,EACxD,GAAIA,EAAQ,CACV,MAAM1Y,EAAI,KAAK,MAAM0Y,CAAM,EACvB1Y,IAAMA,EAAE,GAAKA,EAAE,YACjBlH,EAAM,eAAe,CACnB,EAAGkH,EAAE,GAAK,KACV,UAAWA,EAAE,WAAa,KAC1B,QAASA,EAAE,SAAW,KACtB,UAAWA,EAAE,WAAa,KAC1B,QAASA,EAAE,SAAW,KACtB,OAAQ,CAAC,CAACA,EAAE,MAAA,CACb,CAEL,CACF,CAEAlH,EAAM,UAAY,EACpB,MAAQ,CAAC,CACX,CACF,CAAC,CAAC,EC/CF,IAAI6f,GAAiD,KACjDC,GAA2C,KAC3CC,GAAwC,KACxCC,GAAgC,KAsC7B,MAAMC,GAAmBnc,GAAA,EAA6B2b,GAAQ,CAACxb,EAAKqD,KAAS,CAClF,YAAa,GACb,KAAM,QACN,YAAa,KACb,UAAW,KACX,SAAU,GACV,UAAW,KACX,YAAa,GAEb,aAAe4Y,GAAc,CAC3B,QAAQ,IAAI,iCAAkCA,CAAS,EACvDjc,EAAI,CAAE,YAAaic,EAAW,CAChC,EACA,QAAUva,GAAS,CACjB,QAAQ,IAAI,4BAA6BA,CAAI,EAC7C1B,EAAI,CAAE,KAAA0B,EAAM,CACd,EACA,eAAiBwa,GAASlc,EAAI,CAAE,YAAakc,EAAM,EACnD,aAAeC,GAASnc,EAAI,CAAE,UAAWmc,EAAM,EAC/C,UAAYC,GAAWpc,EAAI,CAAE,SAAUoc,EAAQ,EAC/C,aAAetjB,GAAQkH,EAAI,CAAE,UAAWlH,EAAK,EAC7C,eAAiBrC,GAAMuJ,EAAI,CAAE,YAAa,CAAC,CAACvJ,EAAG,EAG/C,eAAiB4lB,GAAW,CAC1BR,GAAuBQ,CACzB,EACA,eAAgB,IAAMR,GAEtB,SAAWS,GAAO,CAChBR,GAAcQ,CAChB,EACA,SAAU,IAAMR,GAEhB,SAAWS,GAAO,CAChBR,GAAcQ,CAChB,EACA,SAAU,IAAMR,GAGhB,mBAAoB,IAAM,CACxB,MAAM9W,EAAM2W,GACZ,OAAK3W,GACH,QAAQ,KAAK,8DAA8D,EAEtEA,CACT,EACA,mBAAqBA,GAAQ,CACvBA,EACF,QAAQ,IAAI,yEAA0E,CACpF,QAASA,EAAI,QACb,UAAW,CAAC,CAACA,EAAI,SAAA,CAClB,EAED,QAAQ,IAAI,6DAA6D,EAE3E2W,GAAwB3W,CAC1B,EAEA,aAAc,IAAM,CAClB2W,GAAwB,KACxBC,GAAuB,KACvBC,GAAc,KACdC,GAAc,KACd/b,EAAI,CACF,YAAa,GACb,YAAa,KACb,UAAW,KACX,SAAU,GACV,UAAW,IAAA,CAEZ,CACH,CACF,GAAI,CACF,KAAM,qBACN,QAAS+Y,GAAkB,IAAM,YAAY,EAE7C,WAAahd,IAAW,CACtB,YAAaA,EAAM,YACnB,KAAMA,EAAM,KACZ,YAAaA,EAAM,YACnB,UAAWA,EAAM,UACjB,SAAUA,EAAM,SAChB,UAAWA,EAAM,UACjB,YAAaA,EAAM,WAAA,EAEvB,CAAC,CAAC,ECzHWygB,GAAa,CACzB,UAAW,KACX,UAAW,KACX,YAAa,GACb,YAAa,IACb,YAAa,IACb,YAAa,GACd,EAEaC,GAAc,CAAC,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,CAAC,EAe1F,SAASC,GAAgBC,EAAepoB,EAAiB,CAC/D,MAAMsI,EAAItI,EAAE,EAAGuI,EAAIvI,EAAE,EACf2jB,EAAIyE,EAAE,CAAC,EAAI9f,EAAI8f,EAAE,CAAC,EAAI7f,EAAI6f,EAAE,CAAC,EAC7BC,GAAMD,EAAE,CAAC,EAAI9f,EAAI8f,EAAE,CAAC,EAAI7f,EAAI6f,EAAE,CAAC,GAAKzE,EACpC2E,GAAMF,EAAE,CAAC,EAAI9f,EAAI8f,EAAE,CAAC,EAAI7f,EAAI6f,EAAE,CAAC,GAAKzE,EAC1C,MAAO,CAAE,EAAG0E,EAAI,EAAGC,CAAA,CACpB,CAIO,SAASC,GAAgBH,EAAeI,EAAYC,EAAwB,CAClF,MAAO,CACND,EAAKJ,EAAE,CAAC,EAAGI,EAAKJ,EAAE,CAAC,EAAGI,EAAKJ,EAAE,CAAC,EAC9BK,EAAKL,EAAE,CAAC,EAAGK,EAAKL,EAAE,CAAC,EAAGK,EAAKL,EAAE,CAAC,EAC9BA,EAAE,CAAC,EAAOA,EAAE,CAAC,EAAOA,EAAE,CAAC,CAAA,CAEzB,CAEO,SAASM,GAAiBN,EAA2B,CAE3D,MAAMroB,EAAIqoB,EACJjoB,EAAIJ,EAAE,CAAC,EAAGM,EAAIN,EAAE,CAAC,EAAGG,EAAIH,EAAE,CAAC,EAAGO,EAAIP,EAAE,CAAC,EAAGQ,EAAIR,EAAE,CAAC,EAAGJ,EAAII,EAAE,CAAC,EAAGK,EAAIL,EAAE,CAAC,EAAGS,EAAIT,EAAE,CAAC,EAAG6S,EAAI7S,EAAE,CAAC,EACvF4oB,EAAIpoB,EAAIqS,EAAIjT,EAAIa,EAChBooB,EAAI1oB,EAAIM,EAAIH,EAAIuS,EAChBiW,EAAIxoB,EAAIV,EAAIO,EAAIK,EAChBuoB,EAAInpB,EAAIS,EAAIE,EAAIsS,EAChBmW,EAAI5oB,EAAIyS,EAAI1S,EAAIE,EAChB4oB,EAAI9oB,EAAII,EAAIH,EAAIR,EAChBspB,EAAI3oB,EAAIE,EAAID,EAAIH,EAChB8oB,EAAK7oB,EAAID,EAAID,EAAIK,EACjB,EAAIL,EAAII,EAAIF,EAAIC,EAChB6oB,EAAMhpB,EAAIwoB,EAAItoB,EAAIyoB,EAAI5oB,EAAI+oB,EAChC,GAAI,KAAK,IAAIE,CAAG,EAAI,MAAO,MAAM,IAAI,MAAM,qBAAqB,EAMhE,MALY,CACXR,EAAIQ,EAAKP,EAAIO,EAAKN,EAAIM,EACtBL,EAAIK,EAAKJ,EAAII,EAAKH,EAAIG,EACtBF,EAAIE,EAAKD,EAAKC,EAAK,EAAIA,CAAA,CAGzB,CAKO,SAASC,GAAqB/F,EAAcgG,EAA0B,CAC5E,GAAIhG,EAAI,OAAS,GAAKgG,EAAI,OAAS,EAAG,MAAM,IAAI,MAAM,iCAAiC,EACvF,GAAIhG,EAAI,SAAWgG,EAAI,OAAQ,MAAM,IAAI,MAAM,wCAAwC,EAEvF,MAAMV,EAAgB,CAAA,EAChBC,EAAc,CAAA,EACpB,QAAS/oB,EAAI,EAAGA,EAAIwjB,EAAI,OAAQxjB,IAAK,CACpC,KAAM,CAAE,EAAGypB,EAAG,EAAGC,CAAA,EAAMlG,EAAIxjB,CAAC,EACtB,CAAE,EAAAyI,EAAM,EAAAC,GAAS8gB,EAAIxpB,CAAC,EAK5B8oB,EAAE,KAAK,CAACW,EAAGC,EAAG,EAAG,EAAG,EAAG,EAAG,CAACjhB,EAAIghB,EAAG,CAAChhB,EAAIihB,CAAC,CAAC,EACzCX,EAAE,KAAKtgB,CAAC,EACRqgB,EAAE,KAAK,CAAC,EAAG,EAAG,EAAGW,EAAGC,EAAG,EAAG,CAAChhB,EAAI+gB,EAAG,CAAC/gB,EAAIghB,CAAC,CAAC,EACzCX,EAAE,KAAKrgB,CAAC,CACT,CACA,MAAM/H,EAAIgpB,GAAkBb,EAAGC,CAAC,EAEhC,MADsB,CAACpoB,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAG,CAAC,CAEzE,CAGA,SAASgpB,GAAkBb,EAAetoB,EAAuB,CAEhE,MAAMN,EAAI4oB,EAAE,OAAQ3c,EAAI2c,EAAE,CAAC,EAAE,OACvBc,EAAkB,MAAM,KAAK,CAAE,OAAQzd,CAAA,EAAK,IAAM,IAAI,MAAMA,CAAC,EAAE,KAAK,CAAC,CAAC,EACtE0d,EAAgB,IAAI,MAAM1d,CAAC,EAAE,KAAK,CAAC,EACzC,QAASwR,EAAI,EAAGA,EAAIzd,EAAGyd,IACtB,QAAS5K,EAAI,EAAGA,EAAI5G,EAAG4G,IAAK,CAC3B8W,EAAI9W,CAAC,GAAK+V,EAAEnL,CAAC,EAAE5K,CAAC,EAAIvS,EAAEmd,CAAC,EACvB,QAAS9O,EAAI,EAAGA,EAAI1C,EAAG0C,IACtB+a,EAAI7W,CAAC,EAAElE,CAAC,GAAKia,EAAEnL,CAAC,EAAE5K,CAAC,EAAI+V,EAAEnL,CAAC,EAAE9O,CAAC,CAE/B,CAED,OAAOib,GAAcF,EAAKC,CAAG,CAC9B,CAEA,SAASC,GAAcC,EAAe1nB,EAAuB,CAC5D,MAAM8J,EAAI9J,EAAE,OAENymB,EAAIiB,EAAE,IAAI,CAAC5W,EAAKJ,IAAMI,EAAI,OAAO,CAAC9Q,EAAE0Q,CAAC,CAAC,CAAC,CAAC,EAC9C,QAAS,EAAI,EAAG,EAAI5G,EAAG,IAAK,CAE3B,IAAI6d,EAAS,EACb,QAASrM,EAAI,EAAI,EAAGA,EAAIxR,EAAGwR,IACtB,KAAK,IAAImL,EAAEnL,CAAC,EAAE,CAAC,CAAC,EAAI,KAAK,IAAImL,EAAEkB,CAAM,EAAE,CAAC,CAAC,IAAGA,EAASrM,GAE1D,GAAI,KAAK,IAAImL,EAAEkB,CAAM,EAAE,CAAC,CAAC,EAAI,MAAO,MAAM,IAAI,MAAM,iBAAiB,EACrE,GAAIA,IAAW,EAAG,CACjB,MAAMC,EAAMnB,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAIA,EAAEkB,CAAM,EAAGlB,EAAEkB,CAAM,EAAIC,CACjD,CAEA,QAAStM,EAAI,EAAI,EAAGA,EAAIxR,EAAGwR,IAAK,CAC/B,MAAM7d,EAAIgpB,EAAEnL,CAAC,EAAE,CAAC,EAAImL,EAAE,CAAC,EAAE,CAAC,EAC1B,QAAS,EAAI,EAAG,GAAK3c,EAAG,IAAK2c,EAAEnL,CAAC,EAAE,CAAC,GAAK7d,EAAIgpB,EAAE,CAAC,EAAE,CAAC,CACnD,CACD,CAEA,MAAMrgB,EAAI,IAAI,MAAM0D,CAAC,EAAE,KAAK,CAAC,EAC7B,QAAS,EAAIA,EAAI,EAAG,GAAK,EAAG,IAAK,CAChC,IAAIJ,EAAI+c,EAAE,CAAC,EAAE3c,CAAC,EACd,QAAS9L,EAAI,EAAI,EAAGA,EAAI8L,EAAG9L,IAAK0L,GAAK+c,EAAE,CAAC,EAAEzoB,CAAC,EAAIoI,EAAEpI,CAAC,EAClDoI,EAAE,CAAC,EAAIsD,EAAI+c,EAAE,CAAC,EAAE,CAAC,CAClB,CACA,OAAOrgB,CACR,CAQO,SAASyhB,IAA+B,CAC9C,MAAMC,EAAU/B,GAAW,YAC3B,MAAO,CACN,CAAE,EAAG,EAAG,EAAG,CAAC+B,CAAA,EACZ,CAAE,EAAGA,EAAS,EAAG,CAAA,EACjB,CAAE,EAAG,EAAG,EAAGA,CAAA,EACX,CAAE,EAAG,CAACA,EAAS,EAAG,CAAA,EAClB,CAAE,EAAG,EAAG,EAAG,CAAA,CAAE,CAEf,CAGO,SAASC,GAAW7B,EAAe/D,EAAgB6F,EAAQ,IAAc,CAC/E,MAAMC,EAAe,CAAA,EACrB,QAAStqB,EAAI,EAAGA,EAAIqqB,EAAOrqB,IAAK,CAC/B,MAAMuqB,EAASvqB,EAAIqqB,EAAS,KAAK,GAAK,EAChClqB,EAAImoB,GAAgBC,EAAG,CAAE,EAAG/D,EAAS,KAAK,IAAI+F,CAAK,EAAG,EAAG/F,EAAS,KAAK,IAAI+F,CAAK,EAAG,EACzFD,EAAI,KAAKnqB,CAAC,CACX,CACA,OAAOmqB,CACR,CAEO,SAASE,GAASjC,EAAe/E,EAAcgG,EAAsB,CAC3E,IAAIiB,EAAK,EACT,QAAS1X,EAAI,EAAGA,EAAIyQ,EAAI,OAAQzQ,IAAK,CACpC,MAAM5S,EAAImoB,GAAgBC,EAAG/E,EAAIzQ,CAAC,CAAC,EAC7B2X,EAAKvqB,EAAE,EAAIqpB,EAAIzW,CAAC,EAAE,EAClB4X,EAAKxqB,EAAE,EAAIqpB,EAAIzW,CAAC,EAAE,EACxB0X,GAAMC,EAAKA,EAAKC,EAAKA,CACtB,CACA,OAAO,KAAK,KAAKF,EAAKjH,EAAI,MAAM,CACjC,CAGO,SAASoH,GAAaC,EAA4BC,EAAoB,CAC5E,MAAMC,EAAMlC,GAAiBgC,CAAc,EAC3C,OAAOvC,GAAgByC,EAAmBD,CAAI,CAC/C,CAGO,SAASE,GAAkB7qB,EAA+H,CAChK,MAAMwd,EAAI,KAAK,MAAMxd,EAAE,EAAGA,EAAE,CAAC,EAG7B,IAAI8qB,EAFQ,KAAK,MAAM9qB,EAAE,EAAGA,EAAE,CAAC,EAEf,IAAM,KAAK,GAC3B8qB,GAAOA,EAAM,IAAM,IAAM,IACzB,MAAMC,EAAS7C,GAAY,KAAK,OAAQ,IAAM4C,GAAO,IAAO,EAAE,CAAC,EAE/D,OAAItN,GAAKyK,GAAW,UAAkB,CAAE,KAAM,GAAI,KAAM,aAAc,OAAQ,GAAI,KAAM,CAAA,EACpFzK,GAAKyK,GAAW,UAAkB,CAAE,KAAM,GAAI,KAAM,OAAQ,OAAQ,GAAI,KAAM,CAAA,EAC9EzK,GAAKyK,GAAW,YAAoB,CAAE,KAAM,EAAG,KAAM,OAAQ,OAAQ,KAAM,KAAM,CAAA,EACjFzK,GAAKyK,GAAW,YAAoB,CAAE,KAAM8C,EAAS,EAAG,KAAM,SAAU,OAAAA,EAAQ,KAAM,CAAA,EACtFvN,GAAKyK,GAAW,YAAoB,CAAE,KAAM8C,EAAQ,KAAM,SAAU,OAAAA,EAAQ,KAAM,CAAA,EAClFvN,GAAKyK,GAAW,YAAoB,CAAE,KAAM8C,EAAS,EAAG,KAAM,SAAU,OAAAA,EAAQ,KAAM,CAAA,EACnF,CAAE,KAAMA,EAAQ,KAAM,SAAU,OAAAA,EAAQ,KAAM,CAAA,CACtD,CAEO,SAASC,GAAahK,EAA+BmJ,EAAc1I,EAAQ,UAAWtB,EAAQ,EAAG,CACvG,GAAKgK,EAAI,OACT,CAAAnJ,EAAI,KAAA,EACJA,EAAI,YAAcS,EAClBT,EAAI,UAAYb,EAChBa,EAAI,UAAA,EACJA,EAAI,OAAOmJ,EAAI,CAAC,EAAE,EAAGA,EAAI,CAAC,EAAE,CAAC,EAC7B,QAASvX,EAAI,EAAGA,EAAIuX,EAAI,OAAQvX,IAAKoO,EAAI,OAAOmJ,EAAIvX,CAAC,EAAE,EAAGuX,EAAIvX,CAAC,EAAE,CAAC,EAClEoO,EAAI,UAAA,EACJA,EAAI,OAAA,EACJA,EAAI,QAAA,EACL,CAEO,SAASiK,GAAUjK,EAA+BhhB,EAAUyhB,EAAQ,UAAW,CACrFT,EAAI,KAAA,EACJA,EAAI,YAAcS,EAClBT,EAAI,UAAY,EAChBA,EAAI,UAAA,EACJA,EAAI,OAAOhhB,EAAE,EAAI,EAAGA,EAAE,CAAC,EACvBghB,EAAI,OAAOhhB,EAAE,EAAI,EAAGA,EAAE,CAAC,EACvBghB,EAAI,OAAOhhB,EAAE,EAAGA,EAAE,EAAI,CAAC,EACvBghB,EAAI,OAAOhhB,EAAE,EAAGA,EAAE,EAAI,CAAC,EACvBghB,EAAI,OAAA,EACJA,EAAI,QAAA,CACL,CAGA,SAASkK,GAAMhpB,EAAWipB,EAAYC,EAAY,CAAE,OAAO,KAAK,IAAID,EAAI,KAAK,IAAIC,EAAIlpB,CAAC,CAAC,CAAE,CAEzF,SAASmpB,GAAY/H,EAAgBhb,EAAWC,EAAmB,CAClE,KAAM,CAAE,MAAA4X,EAAO,KAAA7P,CAAA,EAASgT,EAElBgI,EAAK,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,EAChCC,EAAK,CAAC,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,EACtC,IAAI/C,EAAK,EAAGC,EAAK,EACjB,QAAS/Z,EAAI,GAAIA,GAAK,EAAGA,IACxB,QAASkE,EAAI,GAAIA,GAAK,EAAGA,IAAK,CAC7B,MAAM4Y,EAAKN,GAAM5iB,EAAIsK,EAAG,EAAGuN,EAAQ,CAAC,EAE9Bra,GADKolB,GAAM3iB,EAAImG,EAAG,EAAG4U,EAAI,OAAS,CAAC,EACvBnD,EAAQqL,GAAM,EAC1BhO,EAAIlN,EAAKxK,CAAG,EAAG1F,EAAIkQ,EAAKxK,EAAI,CAAC,EAAGzF,EAAIiQ,EAAKxK,EAAI,CAAC,EAC9C2lB,EAAO,KAAMjO,EAAI,KAAMpd,EAAI,KAAMC,EACvCmoB,GAAMiD,EAAOH,EAAG5c,EAAE,CAAC,EAAEkE,EAAE,CAAC,EACxB6V,GAAMgD,EAAOF,EAAG7c,EAAE,CAAC,EAAEkE,EAAE,CAAC,CACzB,CAED,OAAO,KAAK,MAAM4V,EAAIC,CAAE,CACzB,CAEO,SAASiD,GAAiBzK,EAA2BjhB,EAAUqkB,EAAS,EAAU,CAExF,MAAMf,EADMrC,EAAO,WAAW,IAAI,EAClB,aAAa,EAAG,EAAGA,EAAO,MAAOA,EAAO,MAAM,EACxD2C,EAAKsH,GAAM,KAAK,MAAMlrB,EAAE,CAAC,EAAG,EAAGihB,EAAO,MAAQ,CAAC,EAC/C4C,EAAKqH,GAAM,KAAK,MAAMlrB,EAAE,CAAC,EAAG,EAAGihB,EAAO,OAAS,CAAC,EACtD,IAAI0K,EAAO,CAAE,EAAG/H,EAAI,EAAGC,EAAI,IAAK,EAAA,EAChC,QAAStb,EAAIsb,EAAKQ,EAAQ9b,GAAKsb,EAAKQ,EAAQ9b,IAC3C,QAASD,EAAIsb,EAAKS,EAAQ/b,GAAKsb,EAAKS,EAAQ/b,IAAK,CAChD,GAAIA,GAAK,GAAKC,GAAK,GAAKD,GAAK2Y,EAAO,MAAM,GAAK1Y,GAAK0Y,EAAO,OAAO,EAAG,SACrE,MAAM2K,EAAMP,GAAY/H,EAAKhb,EAAGC,CAAC,EAC7BqjB,EAAMD,EAAK,QAAY,CAAE,EAAArjB,EAAG,EAAAC,EAAG,IAAAqjB,CAAA,EACpC,CAED,MAAO,CAAE,EAAGD,EAAK,EAAG,EAAGA,EAAK,CAAA,CAC7B,8CCvPA,IAAIE,EAAKA,GAAM,CAAA,EAEf,OAAAA,EAAG,MAAQ,SAAS1L,EAAO2L,EAAQxb,EAAK,CACtC,KAAK,MAAQ6P,GAAS,EACtB,KAAK,OAAS2L,GAAU,EACxB,KAAK,KAAOxb,GAAQ,CAAA,CACtB,EAEAub,EAAG,UAAY,SAASE,EAAUC,EAAS,CAIzC,QAHI3I,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KAAMC,EAAM5I,EAAI,OACpDzQ,EAAI,EAAGlE,EAAI,EAERkE,EAAIqZ,EAAKrZ,GAAK,EACnByW,EAAI3a,GAAI,EACL2U,EAAIzQ,CAAC,EAAI,KAAQyQ,EAAIzQ,EAAI,CAAC,EAAI,KAAQyQ,EAAIzQ,EAAI,CAAC,EAAI,KAAQ,GAAO,IAGvE,OAAAoZ,EAAS,MAAQD,EAAS,MAC1BC,EAAS,OAASD,EAAS,OAEpBC,CACT,EAEAH,EAAG,UAAY,SAASE,EAAUC,EAAUE,EAAU,CACpD,IAAI7I,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KACpCC,EAAM5I,EAAI,OAAQlU,EAAM,CAAA,EAAIyD,EAEhC,IAAKA,EAAI,EAAGA,EAAI,IAAK,EAAGA,EACtBzD,EAAIyD,CAAC,EAAIA,GAAKsZ,EAAW,EAAG,IAG9B,IAAKtZ,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtByW,EAAIzW,CAAC,EAAIzD,EAAKkU,EAAIzQ,CAAC,CAAC,EAGtB,OAAAoZ,EAAS,MAAQD,EAAS,MAC1BC,EAAS,OAASD,EAAS,OAEpBC,CACT,EAEAH,EAAG,kBAAoB,SAASE,EAAUC,EAAUG,EAAYD,EAAU,CACxE,IAAI7I,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KAAMC,EAAM5I,EAAI,OAAQlU,EAAM,CAAA,EAAIyD,EAI1E,IAFAiZ,EAAG,aAAaE,EAAUC,EAAUG,CAAU,EAEzCvZ,EAAI,EAAGA,EAAI,IAAK,EAAGA,EACtBzD,EAAIyD,CAAC,EAAKA,EAAI,KAAO,CAACsZ,EAAY,IAAK,EAGzC,IAAKtZ,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtByW,EAAIzW,CAAC,EAAIzD,EAAKkU,EAAIzQ,CAAC,EAAIyW,EAAIzW,CAAC,EAAI,GAAG,EAGrC,OAAAoZ,EAAS,MAAQD,EAAS,MAC1BC,EAAS,OAASD,EAAS,OAEpBC,CACT,EAEAH,EAAG,KAAO,SAASE,EAAS,CAC1B,IAAI1I,EAAM0I,EAAS,KAAME,EAAM5I,EAAI,OAAQ+I,EAAO,CAAA,EAC9CF,EAAY,EAAGG,EAAM,EAAGC,EAAO,EAAGC,EAAK,EAAGC,EAAK,EAAGC,EAAM,EACxDC,EAAIC,EAAS/Z,EAEjB,IAAKA,EAAI,EAAGA,EAAI,IAAK,EAAGA,EACtBwZ,EAAKxZ,CAAC,EAAI,EAGZ,IAAKA,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtBwZ,EAAM/I,EAAIzQ,CAAC,KAGb,IAAKA,EAAI,EAAGA,EAAI,IAAK,EAAGA,EACtByZ,GAAOD,EAAKxZ,CAAC,EAAIA,EAGnB,IAAKA,EAAI,EAAGA,EAAI,IAAK,EAAGA,EAEtB,GADA2Z,GAAMH,EAAKxZ,CAAC,EACF2Z,IAAN,EAAS,CAGX,GADAC,EAAKP,EAAMM,EACDC,IAAN,EACF,MAGFF,GAAQF,EAAKxZ,CAAC,EAAIA,EAElB8Z,EAAMJ,EAAOC,GAASF,EAAMC,GAAQE,EAEpCG,EAAUJ,EAAKC,EAAKE,EAAKA,EAErBC,EAAUF,IACZA,EAAME,EACNT,EAAYtZ,EAEpB,CAGE,OAAOsZ,CACT,EAEAL,EAAG,iBACD,CAAC,EAAG,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAG,EAE1EA,EAAG,kBACD,CAAC,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,EAAE,EAE5DA,EAAG,UAAY,UAAU,CACvB,KAAK,MAAQ,EACb,KAAK,KAAO,IACd,EAEAA,EAAG,aAAe,SAASE,EAAUC,EAAUG,EAAW,CACxD,IAAI9I,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KACpCF,EAASC,EAAS,OAAQ5L,EAAQ4L,EAAS,MAC3Ca,EAAed,EAAS,EAAGe,EAAc1M,EAAQ,EACjDlR,EAAOkd,EAAaA,EAAa,EAAG9H,EAAS8H,EAAa,EAC1DW,EAAOjB,EAAG,iBAAiBM,CAAU,EACrCY,EAAQlB,EAAG,kBAAkBM,CAAU,EACvCa,EAAOC,EAAYxL,EAAO4K,EAAK5Y,EAAK8C,EAAOvW,EAAGsI,EAAGC,EAAGqK,EAGxD,IADAoa,EAAQC,EAAa,IAAIpB,EAAG,UACvBjZ,EAAI,EAAGA,EAAI3D,EAAM,EAAG2D,EACvBoa,EAAQA,EAAM,KAAO,IAAInB,EAAG,UAM9B,IAJAmB,EAAM,KAAOC,EAEbxZ,EAAM,EAEDlL,EAAI,EAAGA,EAAIujB,EAAQ,EAAGvjB,EAAE,CAO3B,IANAgO,EAAQ9C,EAERgO,EAAQ4B,EAAI5P,CAAG,EACf4Y,EAAMhI,EAAS5C,EAEfuL,EAAQC,EACHra,EAAI,EAAGA,EAAIyR,EAAQ,EAAGzR,EACzBoa,EAAM,MAAQvL,EACduL,EAAQA,EAAM,KAEhB,IAAKpa,EAAI,EAAGA,EAAIyR,EAAQ,EAAGzR,EACzBoa,EAAM,MAAQ3J,EAAI5P,EAAMb,CAAC,EACzByZ,GAAOW,EAAM,MACbA,EAAQA,EAAM,KAIhB,IADAA,EAAQC,EACH3kB,EAAI,EAAGA,EAAI6X,EAAO,EAAG7X,EACxB+gB,EAAI5V,GAAM,EAAK4Y,EAAMS,IAAUC,EAE/B/sB,EAAIsI,EAAI+b,EACRrkB,EAAIuW,GAASvW,EAAI6sB,EAAa7sB,EAAG6sB,GACjCR,GAAOW,EAAM,MAAQ3J,EAAIrjB,CAAC,EAE1BgtB,EAAM,MAAQ3J,EAAIrjB,CAAC,EACnBgtB,EAAQA,EAAM,IAEpB,CAEE,IAAK1kB,EAAI,EAAGA,EAAI6X,EAAO,EAAG7X,EAAE,CAQ1B,IAPAmL,EAAMnL,EACNiO,EAAQ9C,EAAM0M,EAEdsB,EAAQ4H,EAAI5V,CAAG,EACf4Y,EAAMhI,EAAS5C,EAEfuL,EAAQC,EACHra,EAAI,EAAGA,EAAIyR,EAAQ,EAAGzR,EACzBoa,EAAM,MAAQvL,EACduL,EAAQA,EAAM,KAEhB,IAAKpa,EAAI,EAAGA,EAAIyR,EAAQ,EAAGzR,EACzBoa,EAAM,MAAQ3D,EAAI9S,CAAK,EACvB8V,GAAOW,EAAM,MACbA,EAAQA,EAAM,KAEdzW,GAAS4J,EAIX,IADA6M,EAAQC,EACH1kB,EAAI,EAAGA,EAAIujB,EAAQ,EAAGvjB,EACzB8gB,EAAI5V,CAAG,EAAK4Y,EAAMS,IAAUC,EAE5B/sB,EAAIuI,EAAI8b,EACRrkB,EAAIsI,GAAOtI,EAAI4sB,EAAc5sB,EAAG4sB,GAAgBzM,EAChDkM,GAAOW,EAAM,MAAQ3D,EAAIrpB,CAAC,EAE1BgtB,EAAM,MAAQ3D,EAAIrpB,CAAC,EACnBgtB,EAAQA,EAAM,KAEdvZ,GAAO0M,CAEb,CAEE,OAAO6L,CACT,EAEAH,EAAG,aAAe,SAASE,EAAUC,EAAUkB,EAAWf,EAAW,CACnE,IAAIgB,EAAStB,EAAG,eAAeM,CAAU,EAEzC,OAAAH,EAAS,MAAQD,EAAS,MAC1BC,EAAS,OAASD,EAAS,OAE3BmB,EAAU,MAAQnB,EAAS,MAC3BmB,EAAU,OAASnB,EAAS,OAE5BF,EAAG,mBAAmBE,EAAUmB,EAAWC,EAAQ,EAAI,EACvDtB,EAAG,mBAAmBqB,EAAWlB,EAAUmB,EAAQ,EAAK,EAEjDnB,CACT,EAEAH,EAAG,mBAAqB,SAASE,EAAUC,EAAUmB,EAAQC,EAAW,CACtE,IAAI/J,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KACpCF,EAASC,EAAS,OAAQ5L,EAAQ4L,EAAS,MAC3CtY,EAAM,EAAG4Z,EAAQF,EAAO,QAAU,EAClChqB,EAAK2F,EAAO8J,EAAGlE,EAAG7O,EAEtB,IAAK+S,EAAI,EAAGA,EAAIkZ,EAAQ,EAAGlZ,EAEzB,IAAKlE,EAAI,EAAGA,EAAIyR,EAAO,EAAGzR,EAAE,CAG1B,IAFA5F,EAAQ,EAEHjJ,EAAI,CAACwtB,EAAOxtB,GAAKwtB,EAAO,EAAGxtB,EAE1ButB,GACFjqB,EAAMsQ,EAAM5T,GACR6O,EAAI7O,EAAI,GAGH6O,EAAI7O,GAAKsgB,KAChBhd,EAAMsQ,KAGRtQ,EAAMsQ,EAAO5T,EAAIsgB,GACbvN,EAAI/S,EAAI,GAGH+S,EAAI/S,GAAKisB,KAChB3oB,EAAMsQ,IAIV3K,GAASqkB,EAAOE,EAAQxtB,CAAC,EAAIwjB,EAAIlgB,CAAG,EAGtCkmB,EAAI5V,GAAM,EAAI2Z,EAAYtkB,EAAQA,EAAQ,GAAO,GACvD,CAGE,OAAOkjB,CACT,EAEAH,EAAG,eAAiB,SAASM,EAAW,CACtC,IAAIhd,EACF,CAAE,CAAC,CAAC,EACF,CAAC,IAAM,GAAK,GAAI,EAChB,CAAC,MAAQ,IAAM,KAAO,IAAM,KAAM,EAClC,CAAC,OAAS,QAAU,OAAS,OAAS,OAAS,QAAU,MAAO,CAAC,EACnEge,EAAS,CAAA,EAAIG,EAAQC,EAAOC,EAASnB,EAAK/jB,EAAGsK,EAE/C,GAAMuZ,GAAc,GAAOA,EAAa,IAAM,EAC5CgB,EAAShe,EAAIgd,GAAc,CAAC,MACzB,CAKH,IAJAmB,GAAUnB,EAAa,GAAO,GAC9BoB,EAAQ,GAAO,IAAOD,EAAS,GAC/BE,EAAU,KAAQD,EAAQA,GAC1BlB,EAAM,EACDzZ,EAAI,EAAGA,EAAIuZ,EAAY,EAAGvZ,EAC7BtK,EAAIsK,EAAI0a,EACRjB,GAAOc,EAAOva,CAAC,EAAI,KAAK,IAAI4a,EAAUllB,EAAIA,CAAC,EAG7C,IADA+jB,EAAM,EAAIA,EACLzZ,EAAI,EAAGA,EAAIuZ,EAAY,EAAGvZ,EAC7Bua,EAAOva,CAAC,GAAKyZ,CAEnB,CAEE,OAAOc,CACT,EAEAtB,EAAG,aAAe,SAASE,EAAU0B,EAAO,CAC1C,IAAItN,EAAQ4L,EAAS,MAAOD,EAASC,EAAS,OAAQ2B,EAAW,CAAA,EAC7DrK,EAAKsK,EAAQla,EAAKma,EAAKC,EAAKC,EAAOC,EAAMnb,EAAGlE,EAShD,IAPA2U,EAAMwI,EAAG,aAAaE,EAAU0B,CAAM,EAEtCE,EAAS9B,EAAG,mBAAmB1L,EAAQ,CAAC,EAExC1M,EAAM0M,EAAQ,EACd0N,EAAM,EAEDjb,EAAI,EAAGA,EAAIkZ,EAAQ,EAAGlZ,EAAGa,GAAO,EAEnC,IAAK/E,EAAI,EAAGA,EAAIyR,EAAO,EAAGzR,EAAG,EAAG+E,EAC9Bma,EAAMvK,EAAI5P,CAAG,EAEHma,IAAN,IACFE,EAAQC,EAAO,GAELH,IAAN,GAAmBvK,EAAI5P,EAAM,CAAC,IAAjB,EACfqa,EAAQ,GAEDF,GAAO,GAAWvK,EAAI5P,EAAM,CAAC,IAAjB,IACnBsa,EAAO,KAGLD,GAASC,KACX,EAAGF,EAEHH,EAAS,KAAM7B,EAAG,gBAAgBxI,EAAK5P,EAAKoa,EAAK,CAAC,EAAGnf,EAAG,EAAGkE,CAAC,EAAGmb,EAAMJ,CAAM,CAAC,IAMpF,OAAOD,CACT,EAEA7B,EAAG,gBAAkB,SAASxI,EAAK5P,EAAKoa,EAAKG,EAAOD,EAAMJ,EAAO,CAC/D,IAAIM,EAAU,GAAIC,EAAMC,EAAMC,EAAMxiB,EAAGyiB,EAEvCJ,EAAQ,KAAOF,EAEfniB,EAAIyiB,EAAQN,EAAM,EAAG,EACrB,EAGE,IAFAniB,EAAKA,EAAI,EAAK,EACdsiB,EAAOza,EAAMka,EAAO/hB,CAAC,EACjByX,EAAI6K,CAAI,IAAM,EAChB,YAEGtiB,IAAMyiB,GAEb,GAAIziB,IAAMyiB,EACRhL,EAAI5P,CAAG,EAAI,CAACoa,EACZI,EAAQ,KAAM,CAAC,EAAGD,EAAM,EAAG,EAAGA,EAAM,CAAC,CAAC,MAMtC,KAHAG,EAAO1a,IAGI,CACT4a,EAAQziB,EAER,GACEwiB,EAAOD,EAAOR,EAAO,EAAG/hB,CAAC,QACpByX,EAAI+K,CAAI,IAAM,GAkBrB,GAhBAxiB,GAAK,EAEGA,EAAI,IAAO,EAAMyiB,IAAU,EACjChL,EAAI8K,CAAI,EAAI,CAACN,EAENxK,EAAI8K,CAAI,IAAM,IACrB9K,EAAI8K,CAAI,EAAIN,GAGdI,EAAQ,KAAM,CAAC,EAAGD,EAAM,EAAG,EAAGA,EAAM,CAAC,CAAC,EAItCA,EAAM,GAAKnC,EAAG,aAAajgB,CAAC,EAAE,CAAC,EAC/BoiB,EAAM,GAAKnC,EAAG,aAAajgB,CAAC,EAAE,CAAC,EAEzBwiB,IAAS3a,GAAS0a,IAASD,EAC/B,MAGFC,EAAOC,EACPxiB,EAAKA,EAAI,EAAK,CACpB,CAGE,OAAOqiB,CACT,EAEApC,EAAG,aACD,CAAE,CAAC,EAAG,CAAC,EAAG,CAAC,EAAG,EAAE,EAAG,CAAC,EAAG,EAAE,EAAG,CAAC,GAAI,EAAE,EAAG,CAAC,GAAI,CAAC,EAAG,CAAC,GAAI,CAAC,EAAG,CAAC,EAAG,CAAC,EAAG,CAAC,EAAG,CAAC,CAAC,EAExEA,EAAG,mBAAqB,SAAS1L,EAAM,CAGrC,QAFIwN,EAAS,CAAA,EAAI1B,EAAMJ,EAAG,aAAa,OAAQjZ,EAAI,EAE5CA,EAAIqZ,EAAK,EAAGrZ,EACjB+a,EAAO/a,CAAC,EAAIiZ,EAAG,aAAajZ,CAAC,EAAE,CAAC,EAAKiZ,EAAG,aAAajZ,CAAC,EAAE,CAAC,EAAIuN,EAG/D,OAAOwN,EAAO,OAAOA,CAAM,CAC7B,EAEA9B,EAAG,aAAe,SAASoC,EAASK,EAAQ,CAC1C,IAAInjB,EAAQ,CAAC,YAAa,EAAG,UAAW,CAAC,EACrCojB,EAAc,CAAC,YAAa,EAAG,UAAW,CAAC,EAC3CrY,EAAO,CAAA,EAAI8W,EAAQ,CAAA,EAAIf,EAAMgC,EAAQ,OACrCO,EAAIC,EAAUC,EAAQC,EAAMC,EAAUC,EACtCtE,EAAIC,EAAI5X,EAAGlE,EAAG7O,EAMlB,IAJAyuB,GAAWA,EAEXzuB,EAAI,EAEC+S,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAOpB,IANAgc,EAAW,EAEX/uB,GAAKA,EAAI0uB,EAAY,aAAetC,EACpCwC,EAAWR,EAAQpuB,CAAC,EAChB,EAAGA,IAAMosB,IAAMpsB,EAAI,GAElB6O,EAAI,EAAGA,EAAIud,EAAK,EAAGvd,EACtB8f,EAAKP,EAAQpuB,CAAC,EACV,EAAGA,IAAMosB,IAAMpsB,EAAI,GAEvB0qB,EAAKiE,EAAG,EAAIC,EAAS,EACrBjE,EAAKgE,EAAG,EAAIC,EAAS,EACrBE,EAAOpE,EAAKA,EAAKC,EAAKA,EAElBmE,EAAOC,IACTA,EAAWD,EACXJ,EAAY,YAAc7f,GAsBhC,IAjBIkgB,GAAYN,EACdpY,EAAK,KAAM,CAAC,EAAGuY,EAAS,EAAG,EAAGA,EAAS,CAAC,CAAC,GAGzCtjB,EAAM,YAActL,EACpBsL,EAAM,UAAaojB,EAAY,aAAepjB,EAAM,YAEpDojB,EAAY,aAAeA,EAAY,aAAetC,EAAKA,EAAK,EAChEsC,EAAY,UAAYpjB,EAAM,YAC1BojB,EAAY,UAAYA,EAAY,cACtCA,EAAY,WAAatC,GAG3Be,EAAM,KAAM,CAAC,YAAauB,EAAY,YAAa,UAAWA,EAAY,SAAS,CAAC,EACpFvB,EAAM,KAAM,CAAC,YAAa7hB,EAAM,YAAa,UAAWA,EAAM,SAAS,CAAC,GAGpE6hB,EAAM,SAAW,GAAE,CAOvB,GANA7hB,EAAQ6hB,EAAM,IAAG,EAEjB0B,EAAST,EAAQ9iB,EAAM,UAAY8gB,CAAG,EACtCwC,EAAWR,EAAQpuB,EAAIsL,EAAM,YAAc8gB,CAAG,EAC1C,EAAGpsB,IAAMosB,IAAMpsB,EAAI,GAEnBsL,EAAM,WAAaA,EAAM,YAAc,EACzC0jB,EAAS,OAEN,CAMH,IALAD,EAAW,EAEXrE,EAAKmE,EAAO,EAAID,EAAS,EACzBjE,EAAKkE,EAAO,EAAID,EAAS,EAEpB7b,EAAIzH,EAAM,YAAc,EAAGyH,EAAIzH,EAAM,UAAW,EAAGyH,EACtD4b,EAAKP,EAAQpuB,CAAC,EACV,EAAGA,IAAMosB,IAAMpsB,EAAI,GAEvB8uB,EAAO,KAAK,KAAMH,EAAG,EAAIC,EAAS,GAAKlE,GAAMiE,EAAG,EAAIC,EAAS,GAAKjE,CAAE,EAEhEmE,EAAOC,IACTA,EAAWD,EACXJ,EAAY,YAAc3b,GAI9Bic,EAASD,EAAWA,GAAYN,GAAW/D,EAAKA,EAAKC,EAAKA,EAChE,CAEQqE,EACF3Y,EAAK,KAAM,CAAC,EAAGuY,EAAS,EAAG,EAAGA,EAAS,CAAC,CAAC,GAGzCF,EAAY,UAAYpjB,EAAM,UAC9BA,EAAM,UAAYojB,EAAY,YAE9BvB,EAAM,KAAM,CAAC,YAAauB,EAAY,YAAa,UAAWA,EAAY,SAAS,CAAC,EACpFvB,EAAM,KAAM,CAAC,YAAa7hB,EAAM,YAAa,UAAWA,EAAM,SAAS,CAAC,EAE9E,CAEE,OAAO+K,CACT,EAEA2V,EAAG,KAAO,SAASE,EAAUC,EAAUiC,EAASa,EAAS,CACvD,IAAIzL,EAAM0I,EAAS,KAAM1C,EAAM2C,EAAS,KACpC7L,EAAQ4L,EAAS,MAAOD,EAASC,EAAS,OAC1CtY,EAAM,EACNsb,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAK5Z,EAAIC,EAAI4Z,EAAIC,EACpDzvB,EAAGyd,EAAG5R,EAAG/F,EAAGvE,EAAGY,EAAGyhB,EAAGrb,EAAGC,EAAGqK,GAAGlE,GAQlC,IANA3O,EAAI8rB,EAAG,wBAAwBoC,EAASa,EAAW,CAAC,EAEpDtR,EAAIzd,EAAE,CAAC,EACP6L,EAAI7L,EAAE,CAAC,EACP8F,EAAI9F,EAAE,CAAC,EAEF6S,GAAI,EAAGA,GAAIkc,EAAU,EAAGlc,GAS3B,IARA4K,GAAKzd,EAAE,CAAC,EACR6L,GAAK7L,EAAE,CAAC,EACR8F,GAAK9F,EAAE,CAAC,EAERuB,EAAIkc,EACJtb,EAAI0J,EACJ+X,EAAI9d,EAEC6I,GAAI,EAAGA,GAAIogB,EAAU,EAAGpgB,GAC3BpN,GAAKvB,EAAE,CAAC,EACRmC,GAAKnC,EAAE,CAAC,EACR4jB,GAAK5jB,EAAE,CAAC,EAERuI,EAAIpG,EAAIZ,EACRiH,EAAIob,EAAIriB,EAERytB,EAAMzmB,IAAM,EACZ0mB,EAAOD,IAAQ5O,EAAQ,EAAI4O,EAAKA,EAAM,EACtCE,EAAM3mB,EAAIymB,EACVG,EAAM,EAAMD,EAEZE,EAAM5mB,IAAM,EACZ6mB,EAAOD,IAAQrD,EAAS,EAAIqD,EAAKA,EAAM,EACvCE,EAAM9mB,EAAI4mB,EACVG,EAAM,EAAMD,EAEZ3Z,EAAKC,EAAKwZ,EAAMhP,EAChBoP,EAAKC,EAAKJ,EAAMjP,EAEhBkJ,EAAI5V,GAAM,EACP6b,GAAOJ,EAAM7L,EAAI3N,EAAKqZ,CAAG,EAAIE,EAAM5L,EAAI1N,EAAKqZ,CAAG,GAC/CK,GAAOH,EAAM7L,EAAIkM,EAAKR,CAAG,EAAIE,EAAM5L,EAAImM,EAAKR,CAAG,GAAO,IAK7D,OAAAhD,EAAS,MAAQ8C,EACjB9C,EAAS,OAAS8C,EAEX9C,CACT,EAEAH,EAAG,wBAA0B,SAASxI,EAAKpU,EAAK,CAC9C,IAAIwgB,EAAK5D,EAAG,YAAYxI,CAAG,EAE3B,OAAAoM,EAAG,CAAC,GAAKxgB,EACTwgB,EAAG,CAAC,GAAKxgB,EACTwgB,EAAG,CAAC,GAAKxgB,EACTwgB,EAAG,CAAC,GAAKxgB,EACTwgB,EAAG,CAAC,GAAKxgB,EACTwgB,EAAG,CAAC,GAAKxgB,EAEFwgB,CACT,EAEA5D,EAAG,YAAc,SAASxI,EAAI,CAC5B,IAAIqM,EAAK,CAAA,EAAIC,EAAIC,EAAIX,EAAKC,EAAKG,EAAKC,EAAKO,EAEzC,OAAAF,EAAKtM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAC7CuM,EAAKvM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAEnCsM,IAAN,GAAkBC,IAAN,GACdF,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAC1BqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAC1BqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EACfqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAC1BqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAC1BqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EACfqM,EAAG,CAAC,EAAI,EACRA,EAAG,CAAC,EAAI,EACRA,EAAG,CAAC,EAAI,IAGRT,EAAM5L,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EACxB6L,EAAM7L,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EACxBgM,EAAMhM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EACxBiM,EAAMjM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EACxBwM,EAAMZ,EAAMK,EAAMJ,EAAMG,EAExBK,EAAG,CAAC,GAAKC,EAAKL,EAAMJ,EAAMU,GAAMC,EAChCH,EAAG,CAAC,GAAKT,EAAMW,EAAKD,EAAKN,GAAOQ,EAChCH,EAAG,CAAC,EAAI,EACRA,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAC7CqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAC7CqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EACfqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAC7CqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAAIA,EAAI,CAAC,EAAE,EAAIqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,EAC7CqM,EAAG,CAAC,EAAIrM,EAAI,CAAC,EAAE,GAGVqM,CACT,EAEA7D,EAAG,gBAAkB,SAASoC,EAAQ,CACpC,IAAI6B,EAAc,EAAGC,EAAS,GAC1B9D,EAAMgC,EAAQ,OAAQ,EAAI,EAAGvf,EAAI,EACjCshB,EAAQC,EAASC,EAAOC,EAAOC,EAAKC,EAAK9F,EAAIC,EAQjD,IANAyF,EAAUhC,EAAQhC,EAAM,CAAC,EACzB+D,EAAS/B,EAAQ,CAAC,EAElBmC,EAAMJ,EAAO,EAAIC,EAAQ,EACzBI,EAAML,EAAO,EAAIC,EAAQ,EAElB,EAAIhE,EAAK,EAAG,EAAE,CAanB,GAZI,EAAGvd,IAAMud,IAAMvd,EAAI,GAEvBuhB,EAAUD,EACVA,EAAS/B,EAAQvf,CAAC,EAElB6b,EAAKyF,EAAO,EAAIC,EAAQ,EACxBzF,EAAKwF,EAAO,EAAIC,EAAQ,EACxBC,EAAQ3F,EAAK8F,EACbF,EAAQ3F,EAAK4F,EAEbN,GAAeK,EAAQD,EAAO,EAAIC,EAAQD,EAAO,EAAG,EAE1CJ,IAAN,EAAkB,CAClBC,EAAS,GACT,KACR,CAEIK,EAAM7F,EACN8F,EAAM7F,CACV,CAEE,OAAOuF,CACT,EAEAlE,EAAG,UAAY,SAAS3V,EAAK,CAI3B,QAHI+V,EAAM/V,EAAK,OAAQtD,EAAI,EAAGlE,EAAIud,EAAM,EACpCjsB,EAAI,EAAKuqB,EAAIC,EAEV5X,EAAIqZ,EAAKvd,EAAIkE,IAClB2X,EAAKrU,EAAKtD,CAAC,EAAE,EAAIsD,EAAKxH,CAAC,EAAE,EACzB8b,EAAKtU,EAAKtD,CAAC,EAAE,EAAIsD,EAAKxH,CAAC,EAAE,EAEzB1O,GAAK,KAAK,KAAKuqB,EAAKA,EAAKC,EAAKA,CAAE,EAGlC,OAAOxqB,CACT,EAEA6rB,EAAG,cAAgB,SAAS3V,EAAK,CAI/B,QAHI+V,EAAM/V,EAAK,OAAQtD,EAAI,EAAGlE,EAAIud,EAAM,EACpCqE,EAAM,IAAUhwB,EAAGiqB,EAAIC,EAEpB5X,EAAIqZ,EAAKvd,EAAIkE,IAClB2X,EAAKrU,EAAKtD,CAAC,EAAE,EAAIsD,EAAKxH,CAAC,EAAE,EACzB8b,EAAKtU,EAAKtD,CAAC,EAAE,EAAIsD,EAAKxH,CAAC,EAAE,EAEzBpO,EAAIiqB,EAAKA,EAAKC,EAAKA,EAEflqB,EAAIgwB,IACNA,EAAMhwB,GAIV,OAAO,KAAK,KAAKgwB,CAAG,CACtB,EAEAzE,EAAG,aAAe,SAASE,EAAUwE,EAAO,CAC1C,IAAIlN,EAAM0I,EAAS,KAAMD,EAASyE,EAAO,OAAQpQ,EAAQoQ,EAAO,MAC5D9c,EAAM8c,EAAO,EAAKA,EAAO,EAAIxE,EAAS,MACtCyE,EAAOzE,EAAS,MAAQ5L,EACxBsQ,EAAK,EAAG7d,EAAGlE,EAEf,IAAKkE,EAAI,EAAGA,EAAIkZ,EAAQ,EAAGlZ,EAAE,CAE3B,IAAKlE,EAAI,EAAGA,EAAIyR,EAAO,EAAGzR,EAEb2U,EAAI5P,GAAM,IAAhB,GACH,EAAGgd,EAIPhd,GAAO+c,CACX,CAEE,OAAOC,CACT,EAEA5E,EAAG,aAAe,SAASE,EAAU1C,EAAI,CACvC,IAAIhG,EAAM0I,EAAS,KAAMD,EAASC,EAAS,OAAQ5L,EAAQ4L,EAAS,MAChE2E,EAAS,EAAG/P,EAAS,EAAG/N,EAAGlE,EAE/B,IAAKA,EAAI,GAAIA,EAAIyR,EAAO,EAAGzR,EACzB2a,EAAI1I,GAAS,EAAI,EAGnB,IAAK/N,EAAI,EAAGA,EAAIkZ,EAAQ,EAAGlZ,EAAE,CAG3B,IAFAyW,EAAI1I,GAAS,EAAI,EAEZjS,EAAI,EAAGA,EAAIyR,EAAO,EAAGzR,EACxB2a,EAAI1I,GAAS,EAAW0C,EAAIqN,GAAS,IAAnB,EAAsB,EAAG,EAG7CrH,EAAI1I,GAAS,EAAI,CACrB,CAEE,IAAKjS,EAAI,GAAIA,EAAIyR,EAAO,EAAGzR,EACzB2a,EAAI1I,GAAS,EAAI,EAGnB,OAAO0I,CACT,EAEAsH,GAAiB9E,kDCrsBjB,IAAIA,EAAKjsB,GAAA,EAELgxB,EAAKA,GAAM,CAAA,EAEf,OAAAA,EAAG,OAAS,SAAS/kB,EAAIglB,EAAQ,CAC/B,KAAK,GAAKhlB,EACV,KAAK,QAAUglB,CACjB,EAEAD,EAAG,SAAW,UAAU,CACtB,KAAK,KAAO,IAAI/E,EAAG,MACnB,KAAK,MAAQ,IAAIA,EAAG,MACpB,KAAK,WAAa,IAAIA,EAAG,MACzB,KAAK,OAAS,CAAA,EACd,KAAK,SAAW,CAAA,EAChB,KAAK,MAAQ,CAAA,EACb,KAAK,WAAa,CAAA,CACpB,EAEA+E,EAAG,SAAS,UAAU,OAAS,SAASvP,EAAM,CAC5C,OAAAwK,EAAG,UAAUxK,EAAO,KAAK,IAAI,EAC7BwK,EAAG,kBAAkB,KAAK,KAAM,KAAK,MAAO,EAAG,CAAC,EAEhD,KAAK,SAAWA,EAAG,aAAa,KAAK,MAAO,KAAK,MAAM,EAEvD,KAAK,WAAa,KAAK,eAAe,KAAK,SAAUxK,EAAM,MAAQ,GAAM,IAAM,EAAE,EACjF,KAAK,WAAa,KAAK,iBAAiB,KAAK,UAAU,EACvD,KAAK,WAAa,KAAK,WAAW,KAAK,WAAY,EAAE,EAE9C,KAAK,YAAY,KAAK,KAAM,KAAK,WAAY,EAAE,CACxD,EAEAuP,EAAG,SAAS,UAAU,eAAiB,SAASlD,EAAUoD,EAASxC,EAASyC,EAAU,CACpF,IAAIC,EAAa,CAAA,EAAI/E,EAAMyB,EAAS,OAAQO,EAAS/X,EAAMtD,EAI3D,IAFA,KAAK,MAAQ,CAAA,EAERA,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtBqb,EAAUP,EAAS9a,CAAC,EAEhBqb,EAAQ,QAAU6C,IACpB5a,EAAO2V,EAAG,aAAaoC,EAASA,EAAQ,OAASK,CAAO,EAExD,KAAK,MAAM,KAAKpY,CAAI,EAERA,EAAK,SAAX,GAAwB2V,EAAG,gBAAgB3V,CAAI,GAE9C2V,EAAG,cAAc3V,CAAI,GAAK6a,GAC7BC,EAAW,KAAK9a,CAAI,GAM5B,OAAO8a,CACT,EAEAJ,EAAG,SAAS,UAAU,iBAAmB,SAASI,EAAW,CAC3D,IAAI/E,EAAM+E,EAAW,OAAQ/B,EAAKC,EAAKG,EAAKC,EAAK2B,EAAMre,EAEvD,IAAKA,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtBqc,EAAM+B,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAAIoe,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAC5Cyc,EAAM2B,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAAIoe,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAC5Csc,EAAM8B,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAAIoe,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAC5C0c,EAAM0B,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAAIoe,EAAWpe,CAAC,EAAE,CAAC,EAAE,EAEtCqc,EAAMK,EAAMD,EAAMH,EAAO,IAC7B+B,EAAOD,EAAWpe,CAAC,EAAE,CAAC,EACtBoe,EAAWpe,CAAC,EAAE,CAAC,EAAIoe,EAAWpe,CAAC,EAAE,CAAC,EAClCoe,EAAWpe,CAAC,EAAE,CAAC,EAAIqe,GAIvB,OAAOD,CACT,EAEAJ,EAAG,SAAS,UAAU,WAAa,SAASI,EAAYE,EAAQ,CAC9D,IAAIC,EAAa,CAAA,EAAIlF,EAAM+E,EAAW,OAAQrC,EAAMpE,EAAIC,EAAI5X,EAAGlE,EAAG7O,EAElE,IAAK+S,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EAEtB,IAAKlE,EAAIkE,EAAI,EAAGlE,EAAIud,EAAK,EAAGvd,EAAE,CAG5B,IAFAigB,EAAO,EAEF9uB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB0qB,EAAKyG,EAAWpe,CAAC,EAAE/S,CAAC,EAAE,EAAImxB,EAAWtiB,CAAC,EAAE7O,CAAC,EAAE,EAC3C2qB,EAAKwG,EAAWpe,CAAC,EAAE/S,CAAC,EAAE,EAAImxB,EAAWtiB,CAAC,EAAE7O,CAAC,EAAE,EAE3C8uB,GAAQpE,EAAKA,EAAKC,EAAKA,EAGnBmE,EAAO,EAAMuC,EAAUA,IAEtBrF,EAAG,UAAWmF,EAAWpe,CAAC,CAAC,EAAKiZ,EAAG,UAAWmF,EAAWtiB,CAAC,GAC7DsiB,EAAWpe,CAAC,EAAE,QAAU,GAExBoe,EAAWtiB,CAAC,EAAE,QAAU,GAGlC,CAGE,IAAKkE,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EAChBoe,EAAWpe,CAAC,EAAE,SAClBue,EAAW,KAAMH,EAAWpe,CAAC,CAAC,EAIlC,OAAOue,CACT,EAEAP,EAAG,SAAS,UAAU,YAAc,SAAS7E,EAAUiF,EAAYlC,EAAS,CAC1E,IAAIsC,EAAU,CAAA,EAAInF,EAAM+E,EAAW,OAAQK,EAAWC,EAAQ1e,EAE9D,IAAKA,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtBye,EAAYL,EAAWpe,CAAC,EAExBiZ,EAAG,KAAKE,EAAU,KAAK,WAAYsF,EAAWvC,CAAQ,EAEtDjD,EAAG,UAAU,KAAK,WAAY,KAAK,WAAYA,EAAG,KAAK,KAAK,UAAU,CAAC,EAEvEyF,EAAS,KAAK,UAAU,KAAK,WAAYD,CAAS,EAC9CC,GACFF,EAAQ,KAAKE,CAAM,EAIvB,OAAOF,CACT,EAEAR,EAAG,SAAS,UAAU,UAAY,SAAS7E,EAAUsF,EAAU,CAC7D,IAAIlR,EAAS4L,EAAS,MAAQ,IAAO,EACjCwF,EAAWpR,EAAQA,GAAU,EAC7BvC,EAAO,CAAA,EAAI4T,EAAY,CAAA,EAAIC,EAAY,CAAA,EACvClB,EAAQmB,EAAM1T,EAAKpL,EAAGlE,EAE1B,IAAKkE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAGpB,IAFAoL,EAAapL,IAAN,GAAiBA,IAAN,EAAU,EAAG,EAE1BlE,EAAI,EAAGA,EAAI,EAAGA,GAAKsP,EAEtB,GADAuS,EAAS,CAAC,EAAG7hB,EAAIyR,EAAO,EAAGvN,EAAIuN,EAAO,MAAOA,EAAO,OAAQA,CAAK,EAC5D0L,EAAG,aAAaE,EAAUwE,CAAM,EAAIgB,EACvC,OAAO,KAKb,IAAK3e,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAGpB,IAFAgL,EAAKhL,CAAC,EAAI,CAAA,EAELlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB6hB,EAAS,CAAC,GAAI7hB,EAAI,GAAKyR,EAAO,GAAIvN,EAAI,GAAKuN,EAAO,MAAOA,EAAO,OAAQA,CAAK,EAE7EvC,EAAKhL,CAAC,EAAElE,CAAC,EAAImd,EAAG,aAAaE,EAAUwE,CAAM,EAAIgB,EAAS,EAAG,EASjE,IALAC,EAAU,CAAC,EAAI5T,EACf6T,EAAU,CAAC,EAAI,KAAK,gBAAiBD,EAAU,CAAC,CAAC,EAEjDE,EAAO,CAAC,MAAOD,EAAU,CAAC,EAAG,OAAQ,CAAC,EAEjC7e,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB4e,EAAU5e,CAAC,EAAI,KAAK,OAAQ4e,EAAU5e,EAAI,CAAC,CAAC,EAC5C6e,EAAU7e,CAAC,EAAI,KAAK,gBAAiB4e,EAAU5e,CAAC,CAAC,EAE7C6e,EAAU7e,CAAC,EAAI8e,EAAK,QACtBA,EAAK,MAAQD,EAAU7e,CAAC,EACxB8e,EAAK,OAAS9e,GAIlB,OAAU8e,EAAK,QAAX,EACK,KAGF,IAAId,EAAG,OACZ,KAAK,OAAQY,EAAUE,EAAK,MAAM,CAAC,EACnC,KAAK,QAAQL,EAAW,EAAIK,EAAK,MAAM,CAAC,CAC5C,EAEAd,EAAG,SAAS,UAAU,gBAAkB,SAAShT,EAAK,CACpD,IAAI+T,EAAM,CAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,EAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,EAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,EAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,EAC1DhD,EAAO,EAAGtC,EAAKuF,EAAQhf,EAAGlE,EAAG7O,EAEjC,IAAK+S,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAAE,CAGtB,IAFAgf,EAAS,IAEJljB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAAE,CAGtB,IAFA2d,EAAM,EAEDxsB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAClBwsB,GAAOzO,EAAKhL,CAAC,EAAE/S,CAAC,IAAM8xB,EAAIjjB,CAAC,EAAE7O,CAAC,EAAG,EAAG,EAGpCwsB,EAAMuF,IACRA,EAASvF,EAEjB,CAEIsC,GAAQiD,CACZ,CAEE,OAAOjD,CACT,EAEAiC,EAAG,SAAS,UAAU,OAAS,SAAShT,EAAK,CAC3C,IAAI/R,EAAK,EAAG+G,EAEZ,IAAKA,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB/G,IAAO,EACPA,GAAM+R,EAAKhL,CAAC,EAAE,CAAC,EACf/G,IAAO,EACPA,GAAM+R,EAAKhL,CAAC,EAAE,CAAC,EAGjB,OAAO/G,CACT,EAEA+kB,EAAG,SAAS,UAAU,OAAS,SAASvN,EAAI,CAC1C,IAAIgG,EAAM,CAAA,EAAI4C,EAAM5I,EAAI,OAAQ,EAAG3U,EAEnC,IAAK,EAAI,EAAG,EAAIud,EAAK,EAAG,EAEtB,IADA5C,EAAI,CAAC,EAAI,CAAA,EACJ3a,EAAI,EAAGA,EAAI2U,EAAI,CAAC,EAAE,OAAQ,EAAG3U,EAChC2a,EAAI,CAAC,EAAE3a,CAAC,EAAI2U,EAAIA,EAAI,CAAC,EAAE,OAAS3U,EAAI,CAAC,EAAE,CAAC,EAI5C,OAAO2a,CACT,EAEAuH,EAAG,SAAS,UAAU,QAAU,SAASvN,EAAKwO,EAAS,CACrD,IAAIxI,EAAM,CAAA,EAAI4C,EAAM5I,EAAI,OAAQzQ,EAEhC,IAAKA,EAAI,EAAGA,EAAIqZ,EAAK,EAAGrZ,EACtByW,EAAIzW,CAAC,EAAIyQ,GAAMwO,EAAWjf,GAAKqZ,CAAG,EAGpC,OAAO5C,CACT,EAEAyI,GAAiBlB,kDClPjB,IAAImB,EAAMA,GAAO,GAEjB,OAAAA,EAAI,OAAS,SAAS,EAAGhyB,EAAGiM,EAAG2X,EAAGzhB,EAAE,CAClC,IAAI8vB,EAAMpf,EAAGqf,EAAKvjB,EAAGwjB,EAAIryB,EAAGC,EAAGqyB,EAC3BC,EAAQ,EAAKlyB,EAAGP,EAAGS,EAAI,EAAKI,EAAGoL,EAAGwU,EAAQ,EAAK9X,EAAGC,EAAG8pB,EAAGC,EAAM,GAGlE,IAAK1f,EAAI,EAAGA,EAAI5G,EAAG,EAAG4G,EAAE,CAItB,GAHA9S,EAAI8S,EAAI,EACR0f,EAAI1f,CAAC,EAAIwN,EAAQhgB,EACjBA,EAAIwL,EAAIwU,EAAQ,EACZxN,EAAI7S,EAAE,CACR,IAAKF,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EACpBugB,GAAS,KAAK,IAAK,EAAEvgB,CAAC,EAAE+S,CAAC,GAE3B,GAAYwN,IAAR,EAAc,CAChB,IAAKvgB,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EACpB,EAAEA,CAAC,EAAE+S,CAAC,GAAKwN,EACXxU,GAAK,EAAE/L,CAAC,EAAE+S,CAAC,EAAI,EAAE/S,CAAC,EAAE+S,CAAC,EAMvB,IAJAjT,EAAI,EAAEiT,CAAC,EAAEA,CAAC,EACVxS,EAAI,CAAC2xB,EAAI,KAAM,KAAK,KAAKnmB,CAAC,EAAGjM,GAC7Ba,EAAIb,EAAIS,EAAIwL,EACZ,EAAEgH,CAAC,EAAEA,CAAC,EAAIjT,EAAIS,EACTsO,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EAAE,CACtB,IAAK9C,EAAI,EAAK/L,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EAC7B+L,GAAK,EAAE/L,CAAC,EAAE+S,CAAC,EAAI,EAAE/S,CAAC,EAAE6O,CAAC,EAGvB,IADA/O,EAAIiM,EAAIpL,EACHX,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EACpB,EAAEA,CAAC,EAAE6O,CAAC,GAAK/O,EAAI,EAAEE,CAAC,EAAE+S,CAAC,CAEjC,CACQ,IAAK/S,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EACpB,EAAEA,CAAC,EAAE+S,CAAC,GAAKwN,CAErB,CACA,CAGI,GAFAuD,EAAE/Q,CAAC,EAAIwN,EAAQhgB,EACfA,EAAIwL,EAAIwU,EAAQ,EACVxN,EAAI7S,GAAO6S,IAAM5G,EAAI,EAAI,CAC7B,IAAKnM,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpBugB,GAAS,KAAK,IAAK,EAAExN,CAAC,EAAE/S,CAAC,GAE3B,GAAYugB,IAAR,EAAc,CAChB,IAAKvgB,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpB,EAAE+S,CAAC,EAAE/S,CAAC,GAAKugB,EACXxU,GAAK,EAAEgH,CAAC,EAAE/S,CAAC,EAAI,EAAE+S,CAAC,EAAE/S,CAAC,EAMvB,IAJAF,EAAI,EAAEiT,CAAC,EAAE9S,CAAC,EACVM,EAAI,CAAC2xB,EAAI,KAAM,KAAK,KAAKnmB,CAAC,EAAGjM,GAC7Ba,EAAIb,EAAIS,EAAIwL,EACZ,EAAEgH,CAAC,EAAE9S,CAAC,EAAIH,EAAIS,EACTP,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpByyB,EAAIzyB,CAAC,EAAI,EAAE+S,CAAC,EAAE/S,CAAC,EAAIW,EAErB,IAAKkO,EAAI5O,EAAG4O,EAAI3O,EAAG,EAAG2O,EAAE,CACtB,IAAK9C,EAAI,EAAK/L,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EAC7B+L,GAAK,EAAE8C,CAAC,EAAE7O,CAAC,EAAI,EAAE+S,CAAC,EAAE/S,CAAC,EAEvB,IAAKA,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpB,EAAE6O,CAAC,EAAE7O,CAAC,GAAK+L,EAAI0mB,EAAIzyB,CAAC,CAEhC,CACQ,IAAKA,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpB,EAAE+S,CAAC,EAAE/S,CAAC,GAAKugB,CAErB,CACA,CACIgS,EAAQ,KAAK,IAAIA,EAAS,KAAK,IAAKzO,EAAE/Q,CAAC,CAAC,EAAK,KAAK,IAAK0f,EAAI1f,CAAC,CAAC,CAAE,CACnE,CAGE,IAAKA,EAAI5G,EAAI,EAAG4G,GAAK,EAAG,EAAGA,EAAE,CAC3B,GAAIA,EAAI5G,EAAI,EAAE,CACZ,GAAY5L,IAAR,EAAU,CACZ,IAAKsO,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EACpBxM,EAAEwM,CAAC,EAAEkE,CAAC,EAAM,EAAEA,CAAC,EAAElE,CAAC,EAAI,EAAEkE,CAAC,EAAE9S,CAAC,EAAMM,EAEpC,IAAKsO,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EAAE,CACtB,IAAK9C,EAAI,EAAK/L,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EAC7B+L,GAAK,EAAEgH,CAAC,EAAE/S,CAAC,EAAIqC,EAAErC,CAAC,EAAE6O,CAAC,EAEvB,IAAK7O,EAAIC,EAAGD,EAAImM,EAAG,EAAGnM,EACpBqC,EAAErC,CAAC,EAAE6O,CAAC,GAAK9C,EAAI1J,EAAErC,CAAC,EAAE+S,CAAC,CAEjC,CACA,CACM,IAAKlE,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EACpBxM,EAAE0Q,CAAC,EAAElE,CAAC,EAAIxM,EAAEwM,CAAC,EAAEkE,CAAC,EAAI,CAE5B,CACI1Q,EAAE0Q,CAAC,EAAEA,CAAC,EAAI,EACVxS,EAAIkyB,EAAI1f,CAAC,EACT9S,EAAI8S,CACR,CAGE,IAAKA,EAAI,KAAK,IAAI5G,EAAGjM,CAAC,EAAI,EAAG6S,GAAK,EAAG,EAAGA,EAAE,CAGxC,IAFA9S,EAAI8S,EAAI,EACRxS,EAAIujB,EAAE/Q,CAAC,EACFlE,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EACpB,EAAEkE,CAAC,EAAElE,CAAC,EAAI,EAEZ,GAAYtO,IAAR,EAAU,CAEZ,IADAA,EAAI,EAAMA,EACLsO,EAAI5O,EAAG4O,EAAI1C,EAAG,EAAG0C,EAAE,CACtB,IAAK9C,EAAI,EAAK/L,EAAIC,EAAGD,EAAIE,EAAG,EAAGF,EAC7B+L,GAAK,EAAE/L,CAAC,EAAE+S,CAAC,EAAI,EAAE/S,CAAC,EAAE6O,CAAC,EAGvB,IADA/O,EAAKiM,EAAI,EAAEgH,CAAC,EAAEA,CAAC,EAAKxS,EACfP,EAAI+S,EAAG/S,EAAIE,EAAG,EAAGF,EACpB,EAAEA,CAAC,EAAE6O,CAAC,GAAK/O,EAAI,EAAEE,CAAC,EAAE+S,CAAC,CAE/B,CACM,IAAKlE,EAAIkE,EAAGlE,EAAI3O,EAAG,EAAG2O,EACpB,EAAEA,CAAC,EAAEkE,CAAC,GAAKxS,CAEnB,KACQ,KAAKsO,EAAIkE,EAAGlE,EAAI3O,EAAG,EAAG2O,EACpB,EAAEA,CAAC,EAAEkE,CAAC,EAAI,EAGhB,EAAG,EAAEA,CAAC,EAAEA,CAAC,CACb,CAGE,IAAK/S,EAAImM,EAAI,EAAGnM,GAAK,EAAG,EAAGA,EACzB,IAAKoyB,EAAM,EAAGA,GAAO,GAAI,EAAGA,EAAI,CAE9B,IADAD,EAAO,GACFlyB,EAAID,EAAGC,GAAK,EAAG,EAAGA,EAAE,CAEvB,GADAqyB,EAAKryB,EAAI,EACJ,KAAK,IAAKwyB,EAAIxyB,CAAC,CAAC,EAAKsyB,IAAUA,EAAO,CACzCJ,EAAO,GACP,KACV,CACQ,GAAK,KAAK,IAAKrO,EAAEwO,CAAE,CAAC,EAAKC,IAAUA,EACjC,KAEV,CACM,GAAIJ,EAGF,IAFA9xB,EAAI,EACJ0L,EAAI,EACCgH,EAAI9S,EAAG8S,GAAK/S,IACfF,EAAIiM,EAAI0mB,EAAI1f,CAAC,EACR,KAAK,IAAIjT,CAAC,EAAIyyB,IAAUA,GAFX,EAAGxf,EAWrB,IANAxS,EAAIujB,EAAE/Q,CAAC,EACPpS,EAAIuxB,EAAI,OAAOpyB,EAAGS,CAAC,EACnBujB,EAAE/Q,CAAC,EAAIpS,EACPA,EAAI,EAAMA,EACVN,EAAIE,EAAII,EACRoL,EAAI,CAACjM,EAAIa,EACJkO,EAAI,EAAGA,GAAK3O,EAAG,EAAG2O,EACrBnG,EAAI,EAAEmG,CAAC,EAAEyjB,CAAE,EACXE,EAAI,EAAE3jB,CAAC,EAAEkE,CAAC,EACV,EAAElE,CAAC,EAAEyjB,CAAE,EAAI5pB,EAAIrI,EAAImyB,EAAIzmB,EACvB,EAAE8C,CAAC,EAAEkE,CAAC,EAAIyf,EAAInyB,EAAIqI,EAAIqD,EAO5B,GADAymB,EAAI1O,EAAE9jB,CAAC,EACHC,IAAMD,EAAE,CACV,GAAIwyB,EAAI,EAEN,IADA1O,EAAE9jB,CAAC,EAAI,CAACwyB,EACH3jB,EAAI,EAAGA,EAAI1C,EAAG,EAAG0C,EACpBxM,EAAEwM,CAAC,EAAE7O,CAAC,EAAI,CAACqC,EAAEwM,CAAC,EAAE7O,CAAC,EAGrB,KACR,CAEM,GAAWoyB,IAAP,GACF,MAAO,GAeT,IAXA3pB,EAAIqb,EAAE7jB,CAAC,EACPqyB,EAAKtyB,EAAI,EACT0I,EAAIob,EAAEwO,CAAE,EACR/xB,EAAIkyB,EAAIH,CAAE,EACV3xB,EAAI8xB,EAAIzyB,CAAC,EACTF,IAAO4I,EAAI8pB,IAAM9pB,EAAI8pB,IAAMjyB,EAAII,IAAMJ,EAAII,KAAQ,EAAMA,EAAI+H,GAC3DnI,EAAI2xB,EAAI,OAAQpyB,EAAG,CAAG,EACtBA,IAAO2I,EAAI+pB,IAAM/pB,EAAI+pB,GAAK7xB,GAAO+H,GAAK5I,EAAIoyB,EAAI,KAAK3xB,EAAGT,CAAC,GAAQa,IAAO8H,EAGtEpI,EAAI0L,EAAI,EACH8C,EAAI5O,EAAG4O,GAAKyjB,EAAI,EAAGzjB,EAAE,CAcxB,IAbAkE,EAAIlE,EAAI,EACRtO,EAAIkyB,EAAI1f,CAAC,EACTrK,EAAIob,EAAE/Q,CAAC,EACPpS,EAAIoL,EAAIxL,EACRA,EAAIF,EAAIE,EACRiyB,EAAIN,EAAI,OAAOpyB,EAAGa,CAAC,EACnB8xB,EAAI5jB,CAAC,EAAI2jB,EACTnyB,EAAIP,EAAI0yB,EACRzmB,EAAIpL,EAAI6xB,EACR1yB,EAAI2I,EAAIpI,EAAIE,EAAIwL,EAChBxL,EAAIA,EAAIF,EAAIoI,EAAIsD,EAChBpL,EAAI+H,EAAIqD,EACRrD,GAAKrI,EACAgyB,EAAK,EAAGA,EAAKlmB,EAAG,EAAGkmB,EACtB5pB,EAAIpG,EAAEgwB,CAAE,EAAExjB,CAAC,EACX2jB,EAAInwB,EAAEgwB,CAAE,EAAEtf,CAAC,EACX1Q,EAAEgwB,CAAE,EAAExjB,CAAC,EAAIpG,EAAIpI,EAAImyB,EAAIzmB,EACvB1J,EAAEgwB,CAAE,EAAEtf,CAAC,EAAIyf,EAAInyB,EAAIoI,EAAIsD,EAWzB,IATAymB,EAAIN,EAAI,OAAOpyB,EAAGa,CAAC,EACnBmjB,EAAEjV,CAAC,EAAI2jB,EACKA,IAAR,IACFA,EAAI,EAAMA,EACVnyB,EAAIP,EAAI0yB,EACRzmB,EAAIpL,EAAI6xB,GAEV1yB,EAAIO,EAAIE,EAAIwL,EAAIrD,EAChBD,EAAIpI,EAAIqI,EAAIqD,EAAIxL,EACX8xB,EAAK,EAAGA,EAAKnyB,EAAG,EAAGmyB,EACtB3pB,EAAI,EAAE2pB,CAAE,EAAExjB,CAAC,EACX2jB,EAAI,EAAEH,CAAE,EAAEtf,CAAC,EACX,EAAEsf,CAAE,EAAExjB,CAAC,EAAInG,EAAIrI,EAAImyB,EAAIzmB,EACvB,EAAEsmB,CAAE,EAAEtf,CAAC,EAAIyf,EAAInyB,EAAIqI,EAAIqD,CAEjC,CACM0mB,EAAIxyB,CAAC,EAAI,EACTwyB,EAAIzyB,CAAC,EAAIF,EACTgkB,EAAE9jB,CAAC,EAAIyI,CACb,CAGE,MAAO,EACT,EAEAypB,EAAI,OAAS,SAAS,EAAG1xB,EAAE,CACzB,IAAIkyB,EAAK,KAAK,IAAI,CAAC,EAAGC,EAAK,KAAK,IAAInyB,CAAC,EAAGoyB,EAExC,OAAIF,EAAKC,GACPC,EAAKD,EAAKD,EACHA,EAAK,KAAK,KAAK,EAAME,EAAKA,CAAE,GAGzBD,IAAR,EACK,GAGTC,EAAKF,EAAKC,EACHA,EAAK,KAAK,KAAK,EAAMC,EAAKA,CAAE,EACrC,EAEAV,EAAI,KAAO,SAAS,EAAG1xB,EAAE,CACvB,OAAOA,GAAK,EAAK,KAAK,IAAI,CAAC,EAAG,CAAC,KAAK,IAAI,CAAC,CAC3C,EAEAqyB,GAAiBX,kDC/PjB,IAAIA,EAAMnyB,KAEN+yB,EAAMA,GAAO,GAEjB,OAAAA,EAAI,MAAQ,SAASC,EAAWC,EAAY,CAC1C,KAAK,aAAe,KAAK,WAAWD,CAAS,EAC7C,KAAK,YAAcC,EAEnB,KAAK,cAAgB,GACrB,KAAK,aAAe,GACpB,KAAK,aAAe,CAAC,CAAA,EAAG,CAAA,EAAG,CAAA,CAAE,EAE7B,KAAK,KAAI,CACX,EAEAF,EAAI,MAAM,UAAU,WAAa,SAASC,EAAU,CAClD,IAAIE,EAAOF,EAAY,EAEvB,MAAO,CACL,CAAC,CAACE,EAAOA,EAAM,CAAG,EAClB,CAAEA,EAAOA,EAAM,CAAG,EAClB,CAAEA,EAAM,CAACA,EAAM,CAAG,EAClB,CAAC,CAACA,EAAM,CAACA,EAAM,CAAG,CAAC,CACvB,EAEAH,EAAI,MAAM,UAAU,KAAO,UAAU,CACnC,IAAII,EAAK,KAAK,aAAa,OACvBC,EAAU,CAAA,EAAI,EAAI,CAAA,EAAI/G,EAAM,EAAKjZ,EAAM,EAAGJ,EAE9C,IAAKA,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrB,KAAK,cAAcA,CAAC,EAAI,CAAC,KAAK,aAAaA,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EAChD,KAAK,aAAaA,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EAChD,KAAK,aAAaA,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,CAAC,EAE1EogB,EAAQpgB,CAAC,EAAI,CAAC,KAAK,cAAcA,CAAC,EAAE,CAAC,EACvB,KAAK,cAAcA,CAAC,EAAE,CAAC,EACvB,KAAK,cAAcA,CAAC,EAAE,CAAC,CAAC,EAGxC,KAAcqZ,IAAR,GACJ,EAAE,CAAC,EAAI,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcjZ,CAAG,EAAE,CAAC,EACpD,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcA,CAAG,EAAE,CAAC,EAC3D,EAAE,CAAC,EAAI,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcA,CAAG,EAAE,CAAC,EACpD,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcA,CAAG,EAAE,CAAC,EAC3D,EAAE,CAAC,EAAI,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcA,CAAG,EAAE,CAAC,EACpD,KAAK,cAAc,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcA,CAAG,EAAE,CAAC,EAE3DiZ,EAAM,KAAK,KAAK,EAAE,CAAC,EAAI,EAAE,CAAC,EAAI,EAAE,CAAC,EAAI,EAAE,CAAC,EAAI,EAAE,CAAC,EAAI,EAAE,CAAC,CAAC,EAEvD,EAAGjZ,EAGL,IAAKJ,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,KAAK,aAAaA,CAAC,EAAI,EAAEA,CAAC,EAAIqZ,EAGhC0G,EAAI,cAAcK,EAASD,EAAI,KAAK,YAAY,CAClD,EAEAJ,EAAI,MAAM,UAAU,KAAO,SAASM,EAAY,CAC9C,IAAIC,EAAe,CAAC,GAAG,CAAA,EAAG,CAAA,CAAE,EAAGC,EAAe,CAAC,CAAA,EAAG,CAAA,EAAG,EAAE,EAAGC,EAAiB,CAAA,EACvEC,EAAY,CAAC,CAAA,EAAG,CAAA,EAAG,CAAA,CAAE,EAAGC,EAAY,CAAC,GAAG,CAAA,EAAG,CAAA,CAAE,EAAGC,EAAe,CAAA,EAAIC,EAAe,CAAA,EAClFC,EAAQC,EAAQC,EAAQC,EAAQhhB,EAAGlE,EAkBvC,IAhBA,KAAK,IAAIukB,EAAaC,EAAcC,EAAcC,CAAc,EAEhEO,EAAS,KAAK,QAAQT,EAAcE,CAAc,EAC9CO,EACFF,EAAS,KAAK,QAAQR,EAAaC,EAAcE,EAAgBC,EAAWE,CAAY,EAExFE,EAAS,CAAC,UAAW,GAAM,OAAQ,GAAI,QAAS,EAAI,EAGtDG,EAAS,KAAK,QAAQT,EAAcC,CAAc,EAC9CQ,EACFF,EAAS,KAAK,QAAQT,EAAaE,EAAcC,EAAgBE,EAAWE,CAAY,EAExFE,EAAS,CAAC,UAAW,GAAM,OAAQ,GAAI,QAAS,EAAI,EAGjD9gB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAChBilB,IACFJ,EAAa3gB,CAAC,GAAKygB,EAAUzgB,CAAC,EAAElE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAEA,CAAC,GAEzDklB,IACFJ,EAAa5gB,CAAC,GAAK0gB,EAAU1gB,CAAC,EAAElE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAEA,CAAC,GAKjE,OAAO+kB,EAAO,UAAYC,EAAO,UAC/B,IAAIf,EAAI,KAAKc,EAAO,OAAQJ,EAAWE,EAAcG,EAAO,OAAQJ,EAAWE,CAAY,EAC3F,IAAIb,EAAI,KAAKe,EAAO,OAAQJ,EAAWE,EAAcC,EAAO,OAAQJ,EAAWE,CAAY,CAC/F,EAEAZ,EAAI,MAAM,UAAU,IAAM,SAASM,EAAaI,EAAWC,EAAWO,EAAY,CAChF,IAAId,EAAK,KAAK,aAAa,OAAQe,EAAe,CAAA,EAC9CC,EAAK,CAAA,EAAIC,EAAK,CAAA,EAAIC,EAAO,CAAA,EAAIC,EAAO,CAAA,EAAIC,EAAO,CAAA,EAAIC,EAAO,CAAA,EAAIC,EAAO,CAAA,EACrEC,EAAMC,EAAMC,EAAMC,EAAOx0B,EAAGy0B,EAAQhI,EAAItM,EAAOxN,EAAGlE,EAEtD,IAAKkE,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrBkhB,EAAalhB,CAAC,EAAI,CAACqgB,EAAYrgB,CAAC,EAAE,EAAIqgB,EAAY,CAAC,EAAE,EAClCA,EAAYrgB,CAAC,EAAE,EAAIqgB,EAAY,CAAC,EAAE,CAAC,EAIxD,IAAKrgB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAGpB,IAFAmhB,EAAGnhB,CAAC,EAAI,EACRohB,EAAGphB,CAAC,EAAI,EACHlE,EAAI,EAAGA,EAAIqkB,EAAI,EAAGrkB,EACrBqlB,EAAGnhB,CAAC,GAAK,KAAK,aAAaA,CAAC,EAAElE,CAAC,EAAIolB,EAAaplB,CAAC,EAAE,CAAC,EACpDslB,EAAGphB,CAAC,GAAK,KAAK,aAAaA,CAAC,EAAElE,CAAC,EAAIolB,EAAaplB,CAAC,EAAE,CAAC,EAkCxD,IA9BA4lB,EAAOP,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EACnDQ,EAAOP,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EAAIA,EAAG,CAAC,EACnDQ,EAAOT,EAAG,CAAC,EAAIC,EAAG,CAAC,EAAID,EAAG,CAAC,EAAIC,EAAG,CAAC,EAAID,EAAG,CAAC,EAAIC,EAAG,CAAC,EAGnDS,GAASF,EAAOD,IAASC,EAAOD,GAAQ,GAAOE,EAAOA,GAElDD,EAAOD,GAAQ,EACjBr0B,GAAKs0B,EAAOD,EAAO,KAAK,KAAKG,CAAK,GAAM,EAExCx0B,GAAKs0B,EAAOD,EAAO,KAAK,KAAKG,CAAK,GAAM,EAGtCx0B,GAAK,GACPy0B,EAAS,KAAK,KAAKz0B,CAAC,EACRy0B,IAAR,EACFhI,EAAK,EAELA,EAAK,CAAC8H,EAAOE,IAGfA,EAAS,KAAK,KAAM,EAAEF,EAAOA,GAAQv0B,CAAC,EAC1By0B,IAAR,EACFhI,EAAK,KAAK,KAAK4H,EAAOC,CAAI,EAE1B7H,EAAK,CAAC8H,EAAOE,GAKZ9hB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBqhB,EAAKrhB,CAAC,EAAImhB,EAAGnhB,CAAC,EAAI8hB,EAAS,KAAK,aAAa9hB,CAAC,EAC9CshB,EAAKthB,CAAC,EAAIohB,EAAGphB,CAAC,EAAI8Z,EAAK,KAAK,aAAa9Z,CAAC,EAK5C,IAFAwN,EAAQ,KAAK,KAAK6T,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAIA,EAAK,CAAC,CAAC,EAEtErhB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBuhB,EAAKvhB,CAAC,EAAIqhB,EAAKrhB,CAAC,EAAIwN,EACpBgU,EAAKxhB,CAAC,EAAIshB,EAAKthB,CAAC,EAAIwN,EAOtB,IAJAiU,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAC9CC,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAC9CC,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAEzCxhB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBygB,EAAU,CAAC,EAAEzgB,CAAC,EAAIuhB,EAAKvhB,CAAC,EACxBygB,EAAU,CAAC,EAAEzgB,CAAC,EAAIwhB,EAAKxhB,CAAC,EACxBygB,EAAU,CAAC,EAAEzgB,CAAC,EAAIyhB,EAAKzhB,CAAC,EAI1B,IAAKA,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBqhB,EAAKrhB,CAAC,EAAImhB,EAAGnhB,CAAC,EAAI8hB,EAAS,KAAK,aAAa9hB,CAAC,EAC9CshB,EAAKthB,CAAC,EAAIohB,EAAGphB,CAAC,EAAI8Z,EAAK,KAAK,aAAa9Z,CAAC,EAG5C,IAAKA,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBuhB,EAAKvhB,CAAC,EAAIqhB,EAAKrhB,CAAC,EAAIwN,EACpBgU,EAAKxhB,CAAC,EAAIshB,EAAKthB,CAAC,EAAIwN,EAOtB,IAJAiU,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAC9CC,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAC9CC,EAAK,CAAC,EAAIF,EAAK,CAAC,EAAIC,EAAK,CAAC,EAAID,EAAK,CAAC,EAAIC,EAAK,CAAC,EAEzCxhB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB0gB,EAAU,CAAC,EAAE1gB,CAAC,EAAIuhB,EAAKvhB,CAAC,EACxB0gB,EAAU,CAAC,EAAE1gB,CAAC,EAAIwhB,EAAKxhB,CAAC,EACxB0gB,EAAU,CAAC,EAAE1gB,CAAC,EAAIyhB,EAAKzhB,CAAC,EAI1BihB,EAAY,CAAC,EAAIZ,EAAY,CAAC,EAAE,EAAI7S,EACpCyT,EAAY,CAAC,EAAIZ,EAAY,CAAC,EAAE,EAAI7S,EACpCyT,EAAY,CAAC,EAAI,KAAK,YAAczT,CACtC,EAEAuS,EAAI,MAAM,UAAU,QAAU,SAASd,EAAUgC,EAAY,CAG3D,QAFId,EAAK,KAAK,aAAa,OAAQ4B,EAAO,IAAU/hB,EAAI,EAAGgiB,EAEpDhiB,EAAImgB,EAAI,EAAGngB,EAChBgiB,EAAKf,EAAY,CAAC,GACfhC,EAAS,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcjf,CAAC,EAAE,CAAC,EACxCif,EAAS,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcjf,CAAC,EAAE,CAAC,EACxCif,EAAS,CAAC,EAAE,CAAC,EAAI,KAAK,cAAcjf,CAAC,EAAE,CAAC,GACvCgiB,EAAKD,IACPA,EAAOC,GAIX,OAAOD,GAAQ,CACjB,EAEAhC,EAAI,MAAM,UAAU,QAAU,SAASM,EAAa4B,EAAazB,EAAgBvB,EAAUgC,EAAY,CACrG,IAAId,EAAK,KAAK,aAAa,OACvB+B,EAAoB,CAAA,EAAIC,EAAiB,CAAA,EACzC1B,EAAY,CAAC,GAAG,CAAA,EAAG,CAAA,CAAE,EAAGC,EAAY,CAAC,CAAA,EAAG,CAAA,EAAG,EAAE,EAC7CC,EAAe,CAAA,EAAIC,EAAe,CAAA,EAClCwB,EAAY,GAAOC,EAAY,EAC/BC,EAAoBC,EAAiBC,EACrCjO,EAAOsM,EAAQC,EAAQe,EAAO7hB,EAAGlE,EAErC,IAAKkE,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrBkiB,EAAkBliB,CAAC,EAAI,CAAC,EAAGqgB,EAAYrgB,CAAC,EAAE,EAClB,EAAGqgB,EAAYrgB,CAAC,EAAE,CAAC,EAG7C,IAAKA,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAAE,CACtB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBmjB,EAASjf,CAAC,EAAElE,CAAC,EAAImmB,EAAYjiB,CAAC,EAAElE,CAAC,EAEnCmlB,EAAYjhB,CAAC,EAAIwgB,EAAexgB,CAAC,CACrC,CAEE,IAAKA,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EAAE,CAEvB,IADAwiB,EAAS,EACJ1mB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB0mB,GAAU,KAAK,cAAcxiB,CAAC,EAAElE,CAAC,EAAImjB,EAAS,CAAC,EAAEnjB,CAAC,EAAImlB,EAAY,CAAC,EAErEkB,EAAeniB,CAAC,EAAI,CAAC,GAAI,EAAMwiB,GAAUnC,EAAYrgB,CAAC,EAAE,EACnC,GAAI,EAAMwiB,GAAUnC,EAAYrgB,CAAC,EAAE,CAAC,CAC7D,CAIE,IAFAuiB,EAAkB,EAEbviB,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrBuiB,GAAmB,KAAK,IAAIJ,EAAeniB,CAAC,EAAE,EAAIkiB,EAAkBliB,CAAC,EAAE,CAAC,EACxEuiB,GAAmB,KAAK,IAAIJ,EAAeniB,CAAC,EAAE,EAAIkiB,EAAkBliB,CAAC,EAAE,CAAC,EAG1E,IAAKA,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB2gB,EAAa3gB,CAAC,EAAIihB,EAAYjhB,CAAC,GAC5Bif,EAASjf,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACvCif,EAASjf,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACvCif,EAASjf,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,GAQ5C,IALAuU,EAAQsM,EAAS,KAAK,MAAMR,EAAapB,EAAU0B,CAAY,EAG/DyB,EAAqBvB,EAAO,SAAf,GAA2B0B,EAAkB,IAEnDF,IAAe,KAAO,CAACD,GAAW,CAEvC,IAAKpiB,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrBkiB,EAAkBliB,CAAC,EAAE,EAAImiB,EAAeniB,CAAC,EAAE,EAC3CkiB,EAAkBliB,CAAC,EAAE,EAAImiB,EAAeniB,CAAC,EAAE,EAK7C,IAFA,KAAK,IAAImiB,EAAgB1B,EAAWC,EAAWO,CAAW,EAErDjhB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB2gB,EAAa3gB,CAAC,EAAIihB,EAAYjhB,CAAC,GAC5BygB,EAAUzgB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACxCygB,EAAUzgB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACxCygB,EAAUzgB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,GAE3C4gB,EAAa5gB,CAAC,EAAIihB,EAAYjhB,CAAC,GAC5B0gB,EAAU1gB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACxC0gB,EAAU1gB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,EACxC0gB,EAAU1gB,CAAC,EAAE,CAAC,EAAI,KAAK,aAAa,CAAC,EAAE,CAAC,GAM7C,GAHA6gB,EAAS,KAAK,MAAMR,EAAaI,EAAWE,CAAY,EACxDG,EAAS,KAAK,MAAMT,EAAaK,EAAWE,CAAY,EAElDC,EAAO,WAAa,GAASC,EAAO,WAAa,EACrD,GAAIA,EAAO,UAAYD,EAAO,UAE5B,IADAtM,EAAQuM,EACH9gB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBmjB,EAASjf,CAAC,EAAElE,CAAC,EAAI4kB,EAAU1gB,CAAC,EAAElE,CAAC,MAKnC,KADAyY,EAAQsM,EACH7gB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBmjB,EAASjf,CAAC,EAAElE,CAAC,EAAI2kB,EAAUzgB,CAAC,EAAElE,CAAC,EAMvC,GAAM+kB,EAAO,UAAY,GAASC,EAAO,WAAa,EAEpD,IADAvM,EAAQuM,EACH9gB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBmjB,EAASjf,CAAC,EAAElE,CAAC,EAAI4kB,EAAU1gB,CAAC,EAAElE,CAAC,EAKrC,GAAMglB,EAAO,UAAY,GAASD,EAAO,WAAa,EAEpD,IADAtM,EAAQsM,EACH7gB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBmjB,EAASjf,CAAC,EAAElE,CAAC,EAAI2kB,EAAUzgB,CAAC,EAAElE,CAAC,EAKrC,IAAKkE,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EAAE,CAEvB,IADAwiB,EAAS,EACJ1mB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB0mB,GAAU,KAAK,cAAcxiB,CAAC,EAAElE,CAAC,EAAImjB,EAAS,CAAC,EAAEnjB,CAAC,EAAImlB,EAAY,CAAC,EAErEkB,EAAeniB,CAAC,EAAE,GAAK,EAAMwiB,GAAUnC,EAAYrgB,CAAC,EAAE,EACtDmiB,EAAeniB,CAAC,EAAE,GAAK,EAAMwiB,GAAUnC,EAAYrgB,CAAC,EAAE,CAC5D,CAKI,IAHAsiB,EAAqBC,EACrBA,EAAkB,EAEbviB,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrBuiB,GAAmB,KAAK,IAAIJ,EAAeniB,CAAC,EAAE,EAAIkiB,EAAkBliB,CAAC,EAAE,CAAC,EACxEuiB,GAAmB,KAAK,IAAIJ,EAAeniB,CAAC,EAAE,EAAIkiB,EAAkBliB,CAAC,EAAE,CAAC,EAG1E6hB,EAAQ,KAAK,IAAIU,EAAkBD,CAAkB,EAErDF,EAAqB7N,EAAM,SAAd,GAA0BsN,EAAQ,GACnD,CAEE,OAAOtN,CACT,EAEAwL,EAAI,MAAM,UAAU,MAAQ,SAASM,EAAapB,EAAUgC,EAAY,CACtE,IAAId,EAAK,KAAK,aAAa,OACvBsC,EAAO,CAAA,EAAIC,EAAa,CAAA,EAAIC,EAAW,CAAA,EACvCC,EAAY,EAAKC,EAAS,EAAKC,EAAU,EACzC9iB,EAAGlE,EAAG7O,EAEV,GAAK,CAAC,KAAK,QAAQgyB,EAAUgC,CAAW,EACtC,MAAO,CAAC,UAAW,GAAM,OAAQ,GAAI,QAAS,EAAI,EAGpD,IAAKjhB,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EAErB,IADAyiB,EAAKziB,CAAC,EAAI,GACLlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB2mB,EAAKziB,CAAC,EAAElE,CAAC,EAAImlB,EAAYnlB,CAAC,EAI9B,IAAKkE,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrB,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAK7O,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpBw1B,EAAKziB,CAAC,EAAElE,CAAC,GAAKmjB,EAASnjB,CAAC,EAAE7O,CAAC,EAAI,KAAK,aAAa+S,CAAC,EAAE/S,CAAC,EAK3D,IAAK+S,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EAErB,IADA0iB,EAAW1iB,CAAC,EAAI,GACXlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB4mB,EAAW1iB,CAAC,EAAElE,CAAC,EAAI,KAAK,YAAc2mB,EAAKziB,CAAC,EAAElE,CAAC,EAAI2mB,EAAKziB,CAAC,EAAE,CAAC,EAIhE,IAAKA,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrB2iB,EAAS3iB,CAAC,EAAI,CAAC0iB,EAAW1iB,CAAC,EAAE,CAAC,EAAIqgB,EAAYrgB,CAAC,EAAE,EAClC0iB,EAAW1iB,CAAC,EAAE,CAAC,EAAIqgB,EAAYrgB,CAAC,EAAE,CAAC,EAGpD,IAAKA,EAAI,EAAGA,EAAImgB,EAAI,EAAGngB,EACrB4iB,GAAa,KAAK,KAAKD,EAAS3iB,CAAC,EAAE,CAAC,EAAI2iB,EAAS3iB,CAAC,EAAE,CAAC,EAC9B2iB,EAAS3iB,CAAC,EAAE,CAAC,EAAI2iB,EAAS3iB,CAAC,EAAE,CAAC,CAAC,EAEtD6iB,GAAU,KAAK,IAAK,KAAK,MAAMH,EAAW1iB,CAAC,EAAE,CAAC,CAAC,EAAI,KAAK,MAAMqgB,EAAYrgB,CAAC,EAAE,CAAC,CAAC,EACrE,KAAK,IAAK,KAAK,MAAM0iB,EAAW1iB,CAAC,EAAE,CAAC,CAAC,EAAI,KAAK,MAAMqgB,EAAYrgB,CAAC,EAAE,CAAC,GAE1E,KAAK,IAAI2iB,EAAS3iB,CAAC,EAAE,CAAC,CAAC,EAAI8iB,IAC7BA,EAAU,KAAK,IAAIH,EAAS3iB,CAAC,EAAE,CAAC,CAAC,GAE/B,KAAK,IAAI2iB,EAAS3iB,CAAC,EAAE,CAAC,CAAC,EAAI8iB,IAC7BA,EAAU,KAAK,IAAIH,EAAS3iB,CAAC,EAAE,CAAC,CAAC,GAIrC,MAAO,CAAC,UAAW4iB,EAAYzC,EAAI,OAAQ0C,EAAQ,QAASC,CAAO,CACrE,EAEA/C,EAAI,cAAgB,SAASxyB,EAAG6L,EAAG3L,EAAE,CACnC,IAAIsjB,EAAI,CAAA,EAAIzhB,EAAI,CAAC,CAAA,EAAG,CAAA,EAAG,CAAA,CAAE,EAAG0J,EAAI,CAAC,GAAG,CAAA,EAAG,CAAA,CAAE,EACrC+pB,EAAO,EAAKC,EAAK,EACjBhjB,EAAGlE,EAAG7O,EAIV,IAFAkyB,EAAI,OAAO5xB,EAAG6L,EAAG,EAAG2X,EAAGzhB,CAAC,EAEnB0Q,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAChB+Q,EAAE/Q,CAAC,EAAI+iB,IACTA,EAAOhS,EAAE/Q,CAAC,GAMd,IAFA+iB,GAAQ,IAEH/iB,EAAI,EAAGA,EAAI,EAAG,EAAGA,EAChB+Q,EAAE/Q,CAAC,EAAI+iB,IACThS,EAAE/Q,CAAC,EAAI,GAIX,IAAKlE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,GAAYiV,EAAEjV,CAAC,IAAX,EAEF,IADA,EAAGknB,EACE/1B,EAAI6O,EAAG7O,EAAI,EAAG,EAAGA,EAAE,CACtB,IAAK+S,EAAI,EAAGA,EAAI5G,EAAG,EAAG4G,EACpBzS,EAAEyS,CAAC,EAAE/S,CAAC,EAAIM,EAAEyS,CAAC,EAAE/S,EAAI,CAAC,EAEtB,IAAK+S,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB1Q,EAAE0Q,CAAC,EAAE/S,CAAC,EAAIqC,EAAE0Q,CAAC,EAAE/S,EAAI,CAAC,CAE9B,CAIE,IAAK6O,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACRiV,EAAEjV,CAAC,IAAX,IACFiV,EAAEjV,CAAC,EAAIiV,EAAEjV,EAAI,CAAC,GAIlB,IAAKkE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI,EAAIknB,EAAI,EAAGlnB,EACzB9C,EAAEgH,CAAC,EAAElE,CAAC,EAAIxM,EAAE0Q,CAAC,EAAElE,CAAC,EAAIiV,EAAEjV,CAAC,EAI3B,IAAKkE,EAAI,EAAGA,EAAI,EAAG,EAAGA,EACpB,IAAKlE,EAAI,EAAGA,EAAI1C,EAAG,EAAG0C,EAEpB,IADArO,EAAEuS,CAAC,EAAElE,CAAC,EAAI,EACL7O,EAAI,EAAGA,EAAI,EAAI+1B,EAAI,EAAG/1B,EACzBQ,EAAEuS,CAAC,EAAElE,CAAC,GAAK9C,EAAEgH,CAAC,EAAE/S,CAAC,EAAIM,EAAEuO,CAAC,EAAE7O,CAAC,CAInC,EAEA8yB,EAAI,KAAO,SAASc,EAAQJ,EAAWE,EAAcG,EAAQJ,EAAWE,EAAa,CACnF,KAAK,UAAYC,EACjB,KAAK,aAAeJ,EACpB,KAAK,gBAAkBE,EACvB,KAAK,iBAAmBG,EACxB,KAAK,oBAAsBJ,EAC3B,KAAK,uBAAyBE,CAChC,EAEAqC,GAAiBlD,kDCldjB,IAAIZ,EAAMnyB,KAEN+yB,EAAMA,GAAO,GAEjBA,EAAI,MAAQ,SAASC,EAAWC,EAAY,CAC1C,KAAK,MAAQ,KAAK,WAAWD,CAAS,EACtC,KAAK,YAAcC,EAEnB,KAAK,KAAI,CACX,EAEAF,EAAI,MAAM,UAAU,WAAa,SAASC,EAAU,CAClD,IAAIE,EAAOF,EAAY,EAEvB,MAAO,CACL,IAAIkD,EAAK,CAAChD,EAAOA,EAAM,CAAG,EAC1B,IAAIgD,EAAMhD,EAAOA,EAAM,CAAG,EAC1B,IAAIgD,EAAMhD,EAAM,CAACA,EAAM,CAAG,EAC1B,IAAIgD,EAAK,CAAChD,EAAM,CAACA,EAAM,CAAG,CAAC,CAC/B,EAEAH,EAAI,MAAM,UAAU,KAAO,UAAU,CACnC,IAAIryB,EAAI,IAAIw1B,EAAQ5zB,EAAI,IAAI6zB,EAAQz0B,EAEpC,KAAK,aAAey0B,EAAK,SACrBD,EAAK,IAAI,KAAK,MAAM,CAAC,EAAG,KAAK,MAAM,CAAC,CAAC,EACrCA,EAAK,IAAI,KAAK,MAAM,CAAC,EAAG,KAAK,MAAM,CAAC,CAAC,EACrCA,EAAK,IAAI,KAAK,MAAM,CAAC,EAAG,KAAK,MAAM,CAAC,CAAC,GAEzCx0B,EAAIy0B,EAAK,MAAM,KAAK,YAAY,EAEhChE,EAAI,OAAOzwB,EAAE,EAAG,EAAG,EAAGhB,EAAE,EAAG4B,EAAE,CAAC,EAE9B,KAAK,mBAAqB6zB,EAAK,KAC7BA,EAAK,KAAK7zB,EAAG6zB,EAAK,aAAcD,EAAK,QAAQx1B,CAAC,CAAC,CAAE,EAAIy1B,EAAK,UAAUz0B,CAAC,CAAC,EAExE,KAAK,YAAcY,EAAE,OAAQ5B,EAAE,SAAQ,EACzC,EAEAqyB,EAAI,MAAM,UAAU,KAAO,SAAS7e,EAAO,CACzC,IAAIkiB,EAAM,IAAIF,EAAK,EAAK,EAAK,CAAG,EAC5BzC,EAAY,IAAI0C,EAAQzC,EAAY,IAAIyC,EACxCxC,EAAe,IAAIuC,EAAQtC,EAAe,IAAIsC,EAC9CrC,EAAQC,EAEZ,YAAK,IAAI5f,EAAQkiB,EAAK3C,EAAWC,EAAWC,EAAcC,CAAY,EAEtEC,EAAS,KAAK,QAAQ3f,EAAQuf,EAAWE,CAAY,EACrDG,EAAS,KAAK,QAAQ5f,EAAQwf,EAAWE,CAAY,EAE9CC,EAASC,EACd,IAAIf,EAAI,KAAKc,EAAQJ,EAAU,EAAGE,EAAa,EAAGG,EAAQJ,EAAU,EAAGE,EAAa,CAAC,EACrF,IAAIb,EAAI,KAAKe,EAAQJ,EAAU,EAAGE,EAAa,EAAGC,EAAQJ,EAAU,EAAGE,EAAa,CAAC,CACzF,EAEAZ,EAAI,MAAM,UAAU,IAAM,SAAS7e,EAAQkiB,EAAK3C,EAAWC,EAAWC,EAAcC,EAAa,CAC/F,IAAIhI,EAAK,IAAIsK,EAAKhiB,EAAO,CAAC,EAAE,EAAGA,EAAO,CAAC,EAAE,EAAGA,EAAO,CAAC,EAAE,CAAC,EACnDmiB,EAAK,IAAIH,EAAKhiB,EAAO,CAAC,EAAE,EAAGA,EAAO,CAAC,EAAE,EAAGA,EAAO,CAAC,EAAE,CAAC,EACnDoiB,EAAKJ,EAAK,UAAWA,EAAK,KAAKtK,EAAIwK,CAAG,EAAG,CAACliB,EAAO,CAAC,EAAE,CAAC,EACrDqiB,EAAKL,EAAK,UAAWA,EAAK,KAAKG,EAAID,CAAG,EAAG,CAACliB,EAAO,CAAC,EAAE,CAAC,EACrDigB,EAAKgC,EAAK,WAAW,KAAK,mBAAoBG,CAAE,EAChDlC,EAAK+B,EAAK,WAAW,KAAK,mBAAoBI,CAAE,EAChDvqB,EAAIooB,EAAG,SAAWD,EAAG,OAAM,EAC3BqC,EAAKN,EAAK,IAAI/B,EAAIC,CAAE,EACpBxW,EAAI,EAAK4M,EAAQ,EACjBxX,EAAGlE,EAAG7O,EAAGw2B,EAAOC,EAAOlW,EAAOmW,EAAM7B,EAAQhI,EAEpC9gB,IAAR,GACF4R,EAAI,KAAK,KAAM,KAAK,IAAI,EAAM4Y,CAAE,GAChChM,EAAS,CAAC,KAAK,GAAK,GAAQgM,EAAK,EAAK,GAAKA,EAAK,EAAK,EAAK,KAE1D5Y,EAAI,KAAK,KAAM,KAAK,KAAK5R,EAAIA,EAAI,EAAMwqB,EAAKA,CAAE,CAAC,EAC/ChM,EAAQ,KAAK,KAAK,GAAOgM,EAAKxqB,CAAC,EAC3BA,EAAI,IACNwe,GAAS,KAAK,IAEhBA,GAAS,GAGXsK,EAASlX,EAAI,KAAK,IAAI4M,CAAK,EAC3BsC,EAAKlP,EAAI,KAAK,IAAI4M,CAAK,EAGvBxX,EAAIkjB,EAAK,IAAI/B,EAAI+B,EAAK,WAAW,KAAK,YAAapB,CAAM,GACzDhmB,EAAIonB,EAAK,IAAI9B,EAAI8B,EAAK,WAAW,KAAK,YAAapJ,CAAE,GACrD2J,EAAQzjB,EAAE,YACV0jB,EAAQ5nB,EAAE,YACV7O,EAAIi2B,EAAK,MAAMljB,EAAGlE,CAAC,EACnB2kB,EAAU,KAAM0C,EAAK,SAASnjB,EAAGlE,EAAG7O,CAAC,GAErCugB,GAASiW,EAAQC,GAAS,EAC1BC,EAAOR,EAAK,WAAW1C,EAAW,KAAK,MAAM,CAAC,CAAC,EAC/CE,EAAa,EAAI,CACfzf,EAAO,CAAC,EAAE,EAAIsM,EAAQmW,EAAK,EAAE,CAAC,EAC9BziB,EAAO,CAAC,EAAE,EAAIsM,EAAQmW,EAAK,EAAE,CAAC,EAC9B,KAAK,YAAcnW,CAAK,EAG1BxN,EAAIkjB,EAAK,IAAI/B,EAAI+B,EAAK,WAAW,KAAK,YAAapB,CAAM,GACzDhmB,EAAIonB,EAAK,IAAI9B,EAAI8B,EAAK,WAAW,KAAK,YAAapJ,CAAE,GACrD2J,EAAQzjB,EAAE,YACV0jB,EAAQ5nB,EAAE,YACV7O,EAAIi2B,EAAK,MAAMljB,EAAGlE,CAAC,EACnB4kB,EAAU,KAAMyC,EAAK,SAASnjB,EAAGlE,EAAG7O,CAAC,GAErCugB,GAASiW,EAAQC,GAAS,EAC1BC,EAAOR,EAAK,WAAWzC,EAAW,KAAK,MAAM,CAAC,CAAC,EAC/CE,EAAa,EAAI,CACf1f,EAAO,CAAC,EAAE,EAAIsM,EAAQmW,EAAK,EAAE,CAAC,EAC9BziB,EAAO,CAAC,EAAE,EAAIsM,EAAQmW,EAAK,EAAE,CAAC,EAC9B,KAAK,YAAcnW,CAAK,CAC5B,EAEAuS,EAAI,MAAM,UAAU,QAAU,SAAS7e,EAAQ+d,EAAUgC,EAAY,CAMnE,QALI2C,EAAY,IACZnD,EAAY,IAAI0C,EAAQzC,EAAY,IAAIyC,EACxCxC,EAAe,IAAIuC,EAAQtC,EAAe,IAAIsC,EAC9CljB,EAAI,EAAGojB,EAAK7O,EAAOsM,EAAQC,EAExB9gB,EAAI,MACTojB,EAAMF,EAAK,UAAWA,EAAK,WACzBC,EAAK,WAAY,KAAK,aAAclE,EAAS,IAAI,CAAC,CAAC,EAAI,EAAMgC,EAAY,EAAE,CAAC,CAAC,EAAG,CAAG,EAErF,KAAK,IAAI/f,EAAQkiB,EAAK3C,EAAWC,EAAWC,EAAcC,CAAY,EAEtEC,EAAS,KAAK,SAAS3f,EAAQuf,EAAWE,CAAY,EACtDG,EAAS,KAAK,SAAS5f,EAAQwf,EAAWE,CAAY,EAElDC,EAASC,GACX7B,EAAS,KAAKwB,CAAS,EACvBQ,EAAY,KAAKN,CAAY,EAC7BpM,EAAQsM,IAER5B,EAAS,KAAKyB,CAAS,EACvBO,EAAY,KAAKL,CAAY,EAC7BrM,EAAQuM,GAGJ,EAAAvM,GAAS,GAASA,EAAQqP,IAnBlB,EAAG5jB,EAuBjB4jB,EAAYrP,EAGd,OAAOA,CACT,EAEAwL,EAAI,MAAM,UAAU,SAAW,SAAS7e,EAAQ+d,EAAUgC,EAAY,CACpE,IAAI4C,EAAKX,EAAK,IAAKC,EAAK,WAAWlE,EAAU,KAAK,MAAM,CAAC,CAAC,EAAGgC,CAAW,EACpE6C,EAAKZ,EAAK,IAAKC,EAAK,WAAWlE,EAAU,KAAK,MAAM,CAAC,CAAC,EAAGgC,CAAW,EACpE8C,EAAKb,EAAK,IAAKC,EAAK,WAAWlE,EAAU,KAAK,MAAM,CAAC,CAAC,EAAGgC,CAAW,EACpE+C,EAAKd,EAAK,IAAKC,EAAK,WAAWlE,EAAU,KAAK,MAAM,CAAC,CAAC,EAAGgC,CAAW,EACpEgD,EAASC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAEhD,OAAAZ,EAAKA,EAAG,EAAGC,EAAKA,EAAG,EAAGC,EAAKA,EAAG,EAAGC,EAAKA,EAAG,EAEzCH,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCA,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCC,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCA,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCC,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCA,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCC,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAChCA,EAAG,CAAC,GAAK,KAAK,YAAcA,EAAG,CAAC,EAEhCC,EAAU,CACR,CAAC,EAAGJ,EAAG,CAAC,EAAG,EAAGA,EAAG,CAAC,CAAC,EACnB,CAAC,EAAGC,EAAG,CAAC,EAAG,EAAGA,EAAG,CAAC,CAAC,EACnB,CAAC,EAAGC,EAAG,CAAC,EAAG,EAAGA,EAAG,CAAC,CAAC,EACnB,CAAC,EAAGC,EAAG,CAAC,EAAG,EAAGA,EAAG,CAAC,CAAC,CACvB,EAEEE,EAAM,KAAK,MAAOhjB,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACjDijB,EAAM,KAAK,MAAOjjB,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACjDkjB,EAAM,KAAK,MAAOljB,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EACjDmjB,EAAM,KAAK,MAAOnjB,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGA,EAAO,CAAC,CAAC,EAEjDojB,EAAM,KAAK,MAAOL,EAAQ,CAAC,EAAGA,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,EACpDM,EAAM,KAAK,MAAON,EAAQ,CAAC,EAAGA,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,EACpDO,EAAM,KAAK,MAAOP,EAAQ,CAAC,EAAGA,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,EACpDQ,EAAM,KAAK,MAAOR,EAAQ,CAAC,EAAGA,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,GAE3C,KAAK,IAAIC,EAAMI,CAAG,EAClB,KAAK,IAAIH,EAAMI,CAAG,EAClB,KAAK,IAAIH,EAAMI,CAAG,EAClB,KAAK,IAAIH,EAAMI,CAAG,GAAM,CACnC,EAEA1E,EAAI,MAAM,UAAU,MAAQ,SAASxyB,EAAGE,EAAGH,EAAE,CAC3C,IAAIo3B,EAAKj3B,EAAE,EAAIF,EAAE,EAAGo3B,EAAKl3B,EAAE,EAAIF,EAAE,EAC7Bq3B,EAAKt3B,EAAE,EAAIC,EAAE,EAAGs3B,EAAKv3B,EAAE,EAAIC,EAAE,EAEjC,OAAO,KAAK,MAAOm3B,EAAKE,EAAKD,EAAKE,IAC/B,KAAK,KAAKH,EAAKA,EAAKC,EAAKA,CAAE,EAAI,KAAK,KAAKC,EAAKA,EAAKC,EAAKA,CAAE,EAAG,EAAK,IAAQ,KAAK,EACpF,EAEA9E,EAAI,KAAO,SAASc,EAAQJ,EAAWE,EAAcG,EAAQJ,EAAWE,EAAa,CACnF,KAAK,UAAYC,EACjB,KAAK,aAAeJ,EACpB,KAAK,gBAAkBE,EACvB,KAAK,iBAAmBG,EACxB,KAAK,oBAAsBJ,EAC3B,KAAK,uBAAyBE,CAChC,EAEA,IAAIsC,EAAO,SAASxtB,EAAGC,EAAG8pB,EAAE,CAC1B,KAAK,EAAI,CAAC/pB,GAAK,EAAKC,GAAK,EAAK8pB,GAAK,CAAG,CACxC,EAEAyD,EAAK,UAAU,KAAO,SAAS31B,EAAE,CAC/B,IAAI+B,EAAI,KAAK,EAEb,OAAA/B,EAAIA,EAAE,EAEN+B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EACV+B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EACV+B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAEH,IACT,EAEA21B,EAAK,IAAM,SAAS31B,EAAGE,EAAE,CACvB,IAAIq3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAEf6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EAEVq3B,CACT,EAEA5B,EAAK,IAAM,SAAS31B,EAAGE,EAAE,CACvB,IAAIq3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAEf6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EAEVq3B,CACT,EAEA5B,EAAK,KAAO,SAAS31B,EAAGE,EAAE,CACxB,IAAIq3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAEf6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EACjB6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAAE,CAAC,EAEVq3B,CACT,EAEA5B,EAAK,UAAY,SAAS31B,EAAGE,EAAE,CAC7B,IAAIq3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAEN+B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EACd6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EACd6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAEPq3B,CACT,EAEA5B,EAAK,WAAa,SAAS31B,EAAGE,EAAE,CAC9B,IAAIq3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAEN+B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EACd6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EACd6B,EAAE,CAAC,EAAI/B,EAAE,CAAC,EAAIE,EAEPq3B,CACT,EAEA5B,EAAK,IAAM,SAAS31B,EAAGE,EAAE,CACvB,OAAAF,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAERF,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAIE,EAAE,CAAC,CAC/C,EAEAy1B,EAAK,MAAQ,SAAS31B,EAAGE,EAAE,CACzB,OAAAF,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAET,IAAIy1B,EACR31B,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAIE,EAAE,CAAC,EACxBF,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAIE,EAAE,CAAC,EACxBF,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAIE,EAAE,CAAC,CAAC,CAC7B,EAEAy1B,EAAK,UAAU,UAAY,UAAU,CACnC,IAAI5zB,EAAI,KAAK,EACT+pB,EAAM,KAAK,KAAK/pB,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,CAAC,EAE3D,OAAI+pB,EAAM,IACR/pB,EAAE,CAAC,GAAK+pB,EACR/pB,EAAE,CAAC,GAAK+pB,EACR/pB,EAAE,CAAC,GAAK+pB,GAGHA,CACT,EAEA6J,EAAK,QAAU,SAAS31B,EAAE,CACxB,IAAIu3B,EAAS,IAAI5B,EAAQ5zB,EAAIw1B,EAAO,EAEpC,OAAAv3B,EAAIA,EAAE,EAEFA,EAAE,CAAC,IAAM,IACX+B,EAAE,CAAC,EAAI,EAAM/B,EAAE,CAAC,GAEdA,EAAE,CAAC,IAAM,IACX+B,EAAE,CAAC,EAAI,EAAM/B,EAAE,CAAC,GAEdA,EAAE,CAAC,IAAM,IACX+B,EAAE,CAAC,EAAI,EAAM/B,EAAE,CAAC,GAGXu3B,CACT,EAEA5B,EAAK,UAAU,OAAS,UAAU,CAChC,IAAI5zB,EAAI,KAAK,EAEb,OAAOA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,CAC/C,EAEA4zB,EAAK,UAAU,SAAW,UAAU,CAClC,IAAI5zB,EAAI,KAAK,EAEb,OAAOA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAG,EAAG,EAAKA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAG,EAAG,CAC5D,EAEA,IAAI6zB,EAAO,UAAU,CACnB,KAAK,EAAI,CAAE,CAAC,EAAK,EAAK,CAAG,EACd,CAAC,EAAK,EAAK,CAAG,EACd,CAAC,EAAK,EAAK,CAAG,EAC3B,EAEA,OAAAA,EAAK,MAAQ,SAAS51B,EAAE,CACtB,IAAIod,EAAS,IAAIwY,EAAQh2B,EAAIwd,EAAO,EAEpC,OAAApd,EAAIA,EAAE,EAENJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAETod,CACT,EAEAwY,EAAK,UAAU,KAAO,SAAS51B,EAAE,CAC/B,IAAIJ,EAAI,KAAK,EAEb,OAAAI,EAAIA,EAAE,EAENJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAET,IACT,EAEA41B,EAAK,SAAW,SAAS51B,EAAGE,EAAGH,EAAE,CAC/B,IAAIqd,EAAS,IAAIwY,EAAQh2B,EAAIwd,EAAO,EAEpC,OAAApd,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAAGH,EAAIA,EAAE,EAExBH,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EACbJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EACbJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EACbJ,EAAE,CAAC,EAAE,CAAC,EAAIM,EAAE,CAAC,EACbN,EAAE,CAAC,EAAE,CAAC,EAAIM,EAAE,CAAC,EACbN,EAAE,CAAC,EAAE,CAAC,EAAIM,EAAE,CAAC,EACbN,EAAE,CAAC,EAAE,CAAC,EAAIG,EAAE,CAAC,EACbH,EAAE,CAAC,EAAE,CAAC,EAAIG,EAAE,CAAC,EACbH,EAAE,CAAC,EAAE,CAAC,EAAIG,EAAE,CAAC,EAENqd,CACT,EAEAwY,EAAK,aAAe,SAAS51B,EAAE,CAC7B,IAAIod,EAAS,IAAIwY,EAAQh2B,EAAIwd,EAAO,EAEpC,OAAApd,EAAIA,EAAE,EAENJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EACbJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EACbJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAENod,CACT,EAEAwY,EAAK,UAAY,SAAS51B,EAAE,CAC1B,IAAIod,EAAS,IAAIwY,EAAQh2B,EAAIwd,EAAO,EAEpC,OAAApd,EAAIA,EAAE,EAENJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAChBJ,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAETod,CACT,EAEAwY,EAAK,KAAO,SAAS51B,EAAGE,EAAE,CACxB,IAAIkd,EAAS,IAAIwY,EAAQh2B,EAAIwd,EAAO,EAEpC,OAAApd,EAAIA,EAAE,EAAGE,EAAIA,EAAE,EAEfN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClEN,EAAE,CAAC,EAAE,CAAC,EAAII,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAAIF,EAAE,CAAC,EAAE,CAAC,EAAIE,EAAE,CAAC,EAAE,CAAC,EAClE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","x_google_ignoreList":[0,1,2,8,9,10,11,12,13,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,50,54,55,56,57,58,59]}
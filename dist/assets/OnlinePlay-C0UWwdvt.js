import{y as $t,a as Ht,z as Gt,u as Vt,A as Xt,b as zt,o as qt,h as ke,C as Ut,j as a}from"./index-BjeBmmUT.js";import{r as t}from"./ui-Vpbk6UnN.js";import{u as Ae}from"./match-WHYhX1sr.js";import{a as Kt,C as Qt}from"./CameraView-DjbB_S6n.js";import{c as Yt,s as Zt,G as es,a as ts}from"./GameScoreboard-BYIFdWae.js";import{M as ss}from"./MatchStartShowcase-D24XUUPz.js";import{u as Ee}from"./messages-BHwNRRh1.js";import"./vendor-D3F3s8fL.js";import"./pendingVisit-Bd9CY6yY.js";const Be="ndn:blocked:v1";function as(){try{const d=localStorage.getItem(Be);return d?JSON.parse(d):{}}catch{return{}}}function Oe(d){try{localStorage.setItem(Be,JSON.stringify(d))}catch{}}const ns=$t((d,y)=>({blocked:as(),isBlocked:n=>!!y().blocked[(n||"").toLowerCase()],block:n=>d(i=>{const l={...i.blocked};return l[(n||"").toLowerCase()]=Date.now(),Oe(l),{blocked:l}}),unblock:n=>d(i=>{const l={...i.blocked};return delete l[(n||"").toLowerCase()],Oe(l),{blocked:l}}),all:()=>Object.keys(y().blocked)}));function Qa({user:d}){const y=Ht(),n=Ae(),i=Gt(),l=t.useRef(null);let te=async()=>{};const _e=ns();function B(){try{i&&i.connected?i.send({type:"sync",match:n}):l.current&&l.current.readyState===WebSocket.OPEN&&l.current.send(JSON.stringify({type:"sync",match:n}))}catch{}}const[w,D]=t.useState("room-1"),[N,_]=t.useState(!1),[rs,Le]=t.useState([]),[os,cs]=t.useState(!1),[is,ls]=t.useState(!1),L=t.useRef(null),[se,Fe]=t.useState(null),F=t.useRef(0),I=t.useRef(null),W=t.useRef(!0),ae=t.useRef(0),ne=t.useRef(!1),J=Ee(),{favoriteDouble:ds,callerEnabled:We,callerVoice:Je,callerVolume:$e,speakCheckoutOnly:us,allowSpectate:C,cameraScale:ms,setCameraScale:fs,cameraFitMode:re="fill",setCameraFitMode:oe,cameraEnabled:ps,textSize:hs,boxSize:ys,autoscoreProvider:bs,matchType:gs="singles",setMatchType:Ss,teamAName:xs="Team A",setTeamAName:ws,teamBName:vs="Team B",setTeamBName:Ns,x01DoubleIn:He}=Vt();t.useEffect(()=>{re!=="fit"&&oe("fit")},[re,oe]);const[Is,Cs]=t.useState(2),[js,$]=t.useState(!1),[Ts,Ge]=t.useState([]),[ce,Ve]=t.useState(!1),[ie,Xe]=t.useState(!1),[Ms,Ps]=t.useState(1),[Ds,Rs]=t.useState(0),[ks,As]=t.useState(0),[Es,ze]=t.useState(0),[Os,qe]=t.useState(0),[Bs,_s]=t.useState(""),[Ls,Ue]=t.useState(0),[Fs,Ke]=t.useState(0),[Ws,Js]=t.useState(""),[$s,Qe]=t.useState(20),[Hs,Ye]=t.useState(0),[Gs,Ze]=t.useState(0),[Vs,Xs]=t.useState(""),[zs,et]=t.useState(30),[qs,tt]=t.useState(!1),[Us,le]=t.useState(null),[Ks,st]=t.useState(!1),[Qs,de]=t.useState(null),x=t.useRef(null),R=t.useRef(null),[Ys,at]=t.useState(0);t.useEffect(()=>()=>{try{x.current&&window.clearInterval(x.current)}catch{}try{R.current&&window.clearTimeout(R.current)}catch{}},[]);const[Zs,ea]=t.useState(null),[ta,sa]=t.useState(!1),[aa,nt]=t.useState(null),ue=t.useRef(null),[na,ra]=t.useState(""),[oa,rt]=t.useState({}),[ca,ot]=t.useState({}),[ia,ct]=t.useState({}),[la,it]=t.useState({}),[da,lt]=t.useState({}),[ua,dt]=t.useState({}),[ma,ut]=t.useState({}),[fa,mt]=t.useState({}),[pa,ft]=t.useState(()=>Yt()),[ha,H]=t.useState(0),[me,pt]=t.useState(!1),fe=t.useRef(null),[pe,ht]=t.useState(!1),[ya,yt]=t.useState(null),[ba,bt]=t.useState({}),[G,gt]=t.useState(null),[ga,Sa]=t.useState(300),St=Kt(s=>s.setPaused),[xa,wa]=t.useState(()=>{try{const s=navigator.userAgent||"";return/Android|iPhone|iPad|iPod|Mobile/i.test(s)}catch{return!1}}),[va,xt]=t.useState(!1),he=t.useRef(!!Ae.getState().inProgress),[wt,V]=t.useState(!1),X=t.useRef(!1),[z,ye]=t.useState(null),[j,be]=t.useState(null),[q,k]=t.useState(null),[vt,ge]=t.useState({}),[Nt,U]=t.useState(!1),[Na,K]=t.useState(!1);t.useEffect(()=>{let s=null;return j?(k(Math.max(0,Math.ceil((j-Date.now())/1e3))),s=setInterval(()=>{k(Math.max(0,Math.ceil((j-Date.now())/1e3)))},1e3)):k(null),()=>{s&&clearInterval(s)}},[j]),t.useEffect(()=>{const s=he.current,r=!!n.inProgress;s&&!r&&(n.players||[]).some(m=>(m.legs||[]).some(p=>p.finished))&&xt(!0),he.current=r,r||(X.current=!1),r&&!X.current&&(X.current=!0,V(!0))},[n.inProgress,n.players]),t.useEffect(()=>{try{return}catch{}},[]),(()=>{const s={};for(const r of n.players||[]){let o=0,m=0;for(const p of r.legs||[])for(const f of p.visits||[])o+=Math.max(0,Number(f.doubleWindowDarts||0)),f.finishedByDouble&&(m+=1);s[r.id]={dartsAtDouble:o,doublesHit:m}}return s})();const[Q,Se]=t.useState(null),xe=t.useRef(null),T=t.useRef(null);t.useEffect(()=>{if(!pe||!G)return;const s=setInterval(()=>{Date.now()>=(G||0)&&(ht(!1),yt(null),bt({}),gt(null),St(!1,null),B())},1e3);return()=>clearInterval(s)},[pe,G]);function It(){try{if(!T.current){const s=window.AudioContext||window.webkitAudioContext;s&&(T.current=new s)}T.current?.resume?.().catch(()=>{})}catch{}}function v(s,r,o=0,m=.05){const p=T.current;if(!p)return;const f=p.createOscillator(),S=p.createGain();f.type="square",f.frequency.value=s,S.gain.value=m,f.connect(S),S.connect(p.destination);const e=p.currentTime+o;f.start(e),f.stop(e+r/1e3)}function Ct(s){It(),T.current&&(s==="180"?(v(880,110,0,.06),v(1175,110,.06,.06),v(1568,140,.12,.06)):(v(659,140,0,.07),v(784,140,.08,.07),v(987,200,.16,.07)))}function jt(s,r){const o=Date.now(),m=xe.current;m&&m.kind===s&&m.by===r&&o-m.ts<500||(xe.current={kind:s,by:r,ts:o},Se({kind:s,by:r,turnIdx:n.currentPlayerIdx,ts:o}),Ct(s))}const[Ia,M]=t.useState(!1),[Tt,Mt]=t.useState([]),[Ca,Pt]=t.useState("bestof"),[ja,Dt]=t.useState(5),[Ta,Rt]=t.useState(501),[b,we]=t.useState(null),[kt,Y]=t.useState(60),[Ma,ve]=t.useState(""),[P,At]=t.useState(null),[Pa,Et]=t.useState(null),[Da,Ot]=t.useState("X01"),[A,Ne]=t.useState("X01"),[Ra,ka]=t.useState(!1),[Aa,Ea]=t.useState(30),[Oa,Ba]=t.useState(!!He),Bt=d?.username&&!d?.fullAccess?Xt(d.username):1/0,Z=!d?.fullAccess&&Bt<=0,[Ie,_a]=t.useState("all"),[Ce,La]=t.useState("all"),[je,Fa]=t.useState("all"),[_t,Wa]=t.useState(!1),[Lt,Ja]=t.useState(10),{H:Ft}=zt(),Te=d?.username?qt(d.username):0;Ee(s=>s.unread);const E=(Tt||[]).filter(s=>!(Ie!=="all"&&s.mode!==Ie||Ce!=="all"&&Number(s.startingScore)!==Number(Ce)||je!=="all"&&s.game!==je||_t&&(!Te||!s.creatorAvg||Math.abs(Number(s.creatorAvg)-Number(Te))>Lt)));t.useEffect(()=>{const s=r=>{const o=r?.detail||{};o.game&&Ot(o.game),(o.mode==="bestof"||o.mode==="firstto")&&Pt(o.mode),typeof o.value=="number"&&isFinite(o.value)&&Dt(Math.max(1,Math.floor(o.value))),typeof o.start=="number"&&isFinite(o.start)&&Rt(Math.max(1,Math.floor(o.start))),M(!0)};return window.addEventListener("ndn:online-demo",s),()=>window.removeEventListener("ndn:online-demo",s)},[]),t.useEffect(()=>{const s=String(d?.email||"").toLowerCase();s&&ke(`/api/friends/messages?email=${encodeURIComponent(s)}`).then(r=>r.json()).then(r=>{r?.ok&&Array.isArray(r.messages)&&J.load(r.messages)}).catch(()=>{})},[d?.email]),t.useEffect(()=>{const s=r=>{try{const o=r?.detail||{},m=Number(o.start||501);n.newMatch([d?.username||"You","Opponent"],m,w),n.addVisit(60,3),n.nextPlayer(),n.addVisit(85,3),n.nextPlayer(),n.addVisit(100,3),Ne("X01"),$(!0)}catch(o){console.error("Demo error:",o)}};return window.addEventListener("ndn:online-match-demo",s),()=>window.removeEventListener("ndn:online-match-demo",s)},[]),t.useEffect(()=>(W.current=!0,ee(),()=>{W.current=!1,I.current&&clearTimeout(I.current);try{l.current?.close()}catch{}}),[]),t.useEffect(()=>{J.setInGame(n.inProgress)},[n.inProgress]),t.useEffect(()=>{Q&&n.currentPlayerIdx!==Q.turnIdx&&Se(null)},[n.currentPlayerIdx,Q?.turnIdx]),t.useEffect(()=>{try{i&&i.connected?i.send({type:"presence",username:d?.username||"guest",email:(d?.email||"").toLowerCase(),allowSpectate:C}):l.current&&l.current.readyState===WebSocket.OPEN&&l.current.send(JSON.stringify({type:"presence",username:d?.username||"guest",email:(d?.email||"").toLowerCase(),allowSpectate:C}))}catch{}},[C,i?.connected]),t.useEffect(()=>{const s=r=>{const o=r?.detail?.roomId;o&&(D(o),i?i.send({type:"spectate",roomId:o}):l.current?.send(JSON.stringify({type:"spectate",roomId:o})),$(!0),M(!1))};return window.addEventListener("ndn:spectate-room",s),()=>window.removeEventListener("ndn:spectate-room",s)},[i]),t.useEffect(()=>{let s=null;return b?(Y(60),s=setInterval(()=>Y(r=>Math.max(0,r-1)),1e3)):Y(60),()=>{s&&clearInterval(s)}},[b]);function Me(s){if(b){try{i?i.send({type:"invite-response",matchId:b.matchId,accept:s,toId:b.fromId}):l.current?.send(JSON.stringify({type:"invite-response",matchId:b.matchId,accept:s,toId:b.fromId}))}catch{}we(null)}}function ee(){if(i){i.connected&&(i.send({type:"join",roomId:w}),i.send({type:"presence",username:d?.username||"guest",email:(d?.email||"").toLowerCase(),allowSpectate:C}),i.send({type:"list-matches"}),_(!0));return}try{if(l.current&&(l.current.readyState===WebSocket.OPEN||l.current.readyState===WebSocket.CONNECTING))return}catch{}const s="ws://localhost:8787",r=window.location.protocol==="https:"?"wss":"ws",o=window.location.hostname,m=`${r}://${o}${window.location.port?"":":8787"}`,p=s.length>0?s:m,f=new WebSocket(p);l.current=f,f.onopen=()=>{_(!0),F.current=0,ne.current?y("Reconnected to lobby",{type:"success"}):(y("Connected to lobby",{type:"success"}),ne.current=!0),f.send(JSON.stringify({type:"join",roomId:w})),f.send(JSON.stringify({type:"presence",username:d?.username||"guest",email:(d?.email||"").toLowerCase(),allowSpectate:C})),f.send(JSON.stringify({type:"list-matches"}))},f.onmessage=S=>{const e=JSON.parse(S.data);if(e.type==="state"){n.importState(e.payload);const u=Number(e.payload._dpIndex),h=Number(e.payload._dpHits);Number.isFinite(u)&&ze(Math.max(0,u)),Number.isFinite(h)&&qe(Math.max(0,h));const g=Number(e.payload._atcIndex),O=Number(e.payload._atcHits);Number.isFinite(g)&&Ue(Math.max(0,g)),Number.isFinite(O)&&Ke(Math.max(0,O));try{const c=Number(e.payload._trebleTarget),Pe=Number(e.payload._trebleHits),De=Number(e.payload._trebleDarts),Re=Number(e.payload._trebleMaxDarts);Number.isFinite(c)&&Qe(Math.max(1,Math.min(20,c))),Number.isFinite(Pe)&&Ye(Math.max(0,Pe)),Number.isFinite(De)&&Ze(Math.max(0,De)),Number.isFinite(Re)&&et(Math.max(0,Re))}catch{}try{const c=e.payload._cricketById;c&&typeof c=="object"&&rt(c)}catch{}try{const c=e.payload._shanghaiById;c&&typeof c=="object"&&ot(c)}catch{}try{const c=e.payload._halveById;c&&typeof c=="object"&&ct(c)}catch{}try{const c=e.payload._highlowById;c&&typeof c=="object"&&it(c)}catch{}try{const c=e.payload._killerById;c&&typeof c=="object"&&lt(c)}catch{}try{const c=e.payload._amCricketById;c&&typeof c=="object"&&dt(c)}catch{}try{const c=e.payload._baseballById;c&&typeof c=="object"&&ut(c)}catch{}try{const c=e.payload._golfById;c&&typeof c=="object"&&mt(c)}catch{}try{const c=e.payload._tttState;c&&typeof c=="object"&&ft(c)}catch{}try{const c=Number(e.payload._turnDarts);Number.isFinite(c)&&H(Math.max(0,c))}catch{}try{const c=e.payload._x01DoubleIn;typeof c=="boolean"&&tt(c)}catch{}}else if(e.type==="joined")e.id&&Fe(e.id);else if(e.type==="presence"||e.type==="peer-joined")Ge(u=>{const h=new Set(u);return e.id&&h.add(e.id),Array.from(h)});else if(e.type==="chat"){const u=!!(e.from&&se&&e.from===se),h=u?d?.username||"me":e.from||"peer",g=String(e.from||"");if(!u&&g&&_e.isBlocked(g))return;if(u&&L.current&&String(e.message||"")===L.current.text){L.current=null;return}Le(O=>[...O,{from:h,message:e.message,fromId:g||void 0}])}else if(e.type==="matches")Mt(Array.isArray(e.matches)?e.matches:[]);else if(e.type==="invite")we({matchId:e.matchId,fromId:e.fromId,fromName:e.fromName,calibrated:!!e.calibrated,boardPreview:e.boardPreview||null,game:e.game,mode:e.mode,value:e.value,startingScore:e.startingScore});else if(e.type==="match-prestart"){D(e.roomId),ye(e.roomId),be(Number(e.prestartEndsAt)||Date.now()+15e3),V(!0),M(!1);try{const u=e.match&&e.match.creatorName?e.match.creatorName:n.players?.[0]?.name||"Host",h=b&&b.fromName?b.fromName:"Opponent",g=[{id:"0",name:u,legsWon:0,legs:[]},{id:"1",name:h,legsWon:0,legs:[]}];n.importState({roomId:e.roomId,players:g,currentPlayerIdx:0,startingScore:e.match?.startingScore||501,inProgress:!1})}catch(u){console.warn("Failed to seed prestart match players",u)}}else if(e.type==="match-start")D(e.roomId),f.send(JSON.stringify({type:"join",roomId:e.roomId})),$(!0),M(!1),e.match?.game&&Ne(e.match.game),d?.username&&!d?.fullAccess&&Ut(d.username);else if(e.type==="declined")y("Invite declined",{type:"info"});else if(e.type==="error"){const u=typeof e.message=="string"?e.message:"Action not allowed";if(ve(u),e.code==="SPECTATE_NOT_ALLOWED")try{y("This player has spectating turned off.",{type:"error"})}catch{}e.code==="NOT_FOUND"&&P&&Et({game:P.game,mode:P.mode,value:P.value,startingScore:P.startingScore}),setTimeout(()=>ve(""),3500)}else if(e.type==="friend-invite")confirm(`${e.fromName||e.fromEmail} invited you to play ${e.game||"X01"} (${e.mode==="firstto"?"First To":"Best Of"} ${e.value||1}). Accept?`)?f.send(JSON.stringify({type:"start-friend-match",toEmail:e.fromEmail,game:e.game,mode:e.mode,value:e.value,startingScore:e.startingScore})):y("Invite declined",{type:"info"});else if(e.type==="friend-message")J.add({id:e.id||`${e.ts}-${e.from}`,from:e.from,message:e.message,ts:e.ts||Date.now()}),n.inProgress||y(`${e.from}: ${e.message}`,{type:"info"});else if(e.type==="celebration"){const u=e.by||"Player",h=e.kind==="leg"?"leg":"180";jt(h,u)}else if(e.type==="cam-code"){console.log("Received cam-code:",e.code),le(e.code),st(!1);try{R.current&&window.clearTimeout(R.current)}catch{}const u=120*1e3,h=Date.now()+u;de(h),y(`Pairing code: ${e.code}`,{type:"info"});try{x.current&&window.clearInterval(x.current)}catch{}x.current=window.setInterval(()=>{const g=Math.max(0,Math.ceil((h-Date.now())/1e3));if(at(g),g<=0){try{x.current&&window.clearInterval(x.current)}catch{}x.current=null,le(null),de(null)}},1e3)}else if(e.type==="prestart-choice-notify")ge(u=>({...u,[String(e.playerId)]:e.choice}));else if(e.type==="prestart-bull")U(!0);else if(e.type==="prestart-bull-tie")K(!0);else if(e.type==="prestart-bull-winner"){U(!1),K(!1);try{y(`${e.winnerId?e.winnerId:"Player"} wins bull-up`)}catch{}try{We&&Zt(e.winnerId?.toString()||"Player",0,0,Je,{volume:$e})}catch{}}else if(e.type==="cam-peer-joined")console.log("Mobile peer joined for code:",e.code),te(e.code);else if(e.type==="cam-answer"){console.log("Received cam-answer");const u=window.mobilePC;u&&u.setRemoteDescription(new RTCSessionDescription(e.payload))}else if(e.type==="cam-ice"){console.log("Received cam-ice");const u=window.mobilePC;u&&u.addIceCandidate(e.payload)}},f.onclose=()=>{if(_(!1),!W.current)return;const S=(F.current||0)+1;F.current=S;const e=Math.min(3e4,1e3*Math.pow(2,S-1)),u=Date.now();u-ae.current>4e3&&(y(`Disconnected. Reconnecting in ${Math.round(e/1e3)}s...`,{type:"error"}),ae.current=u),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{ee()},e)}}t.useEffect(()=>{H(0)},[n.currentPlayerIdx,A]),t.useEffect(()=>{function s(){me&&(pt(!1),H(0),n.nextPlayer(),B(),fe.current&&clearTimeout(fe.current))}return window.addEventListener("ndn:darts-cleared",s),()=>window.removeEventListener("ndn:darts-cleared",s)},[me]);function Wt(s){const r=z||w;if(!r)return;const o={type:"prestart-choice",roomId:r,choice:s};try{i?i.send(o):l.current?.send(JSON.stringify(o))}catch{}}function Jt(s){const r=z||w;if(r)try{i?i.send({type:"prestart-bull-throw",roomId:r,score:s}):l.current?.send(JSON.stringify({type:"prestart-bull-throw",roomId:r,score:s}))}catch{}}return te=async s=>{console.log("Starting WebRTC for code:",s);try{const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});r.ontrack=m=>{console.log("Received track:",m.streams[0]),nt(m.streams[0]),ue.current&&(ue.current.srcObject=m.streams[0],console.log("Set video srcObject"))},r.onicecandidate=m=>{m.candidate&&(console.log("Sending ICE candidate"),i?i.send({type:"cam-ice",code:s,payload:m.candidate}):l.current&&l.current.readyState===WebSocket.OPEN&&l.current.send(JSON.stringify({type:"cam-ice",code:s,payload:m.candidate})))},r.onconnectionstatechange=()=>console.log("Connection state:",r.connectionState);const o=await r.createOffer();if(await r.setLocalDescription(o),console.log("Sending offer"),i)console.log("Sending offer via wsGlobal"),i.send({type:"cam-offer",code:s,payload:o});else if(l.current&&l.current.readyState===WebSocket.OPEN)console.log("Sending offer via wsRef"),l.current.send(JSON.stringify({type:"cam-offer",code:s,payload:o}));else{console.log("WS not available, POSTing offer to /cam/signal");try{await ke(`/cam/signal/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cam-offer",payload:o,source:"desktop"})})}catch(m){console.warn("REST offer failed",m)}}window.mobilePC=r}catch(r){console.error("WebRTC error:",r),y("Failed to start mobile camera",{type:"error"})}},a.jsxs("div",{className:"card ndn-game-shell relative overflow-hidden",children:[a.jsx("h2",{className:"text-3xl font-bold text-brand-700 mb-4",children:"Online Play"}),a.jsx("div",{className:"ndn-shell-body",children:a.jsxs("div",{className:"grid grid-cols-12 gap-4 min-h-[420px]",children:[a.jsxs("div",{className:"col-span-12 md:col-span-4 flex flex-col gap-3",children:[a.jsxs("div",{className:"rounded-2xl bg-white/5 backdrop-blur border border-white/10 p-2 flex items-center gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-xs opacity-70 shrink-0",children:"Room"}),a.jsx("input",{className:"input w-28",value:w,onChange:s=>D(s.target.value),placeholder:"room-1"})]}),N?a.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-600/20 text-emerald-200 border border-emerald-400/40 shrink-0",children:"Connected"}):a.jsx("button",{className:"btn bg-rose-600 hover:bg-rose-700 shrink-0",onClick:ee,children:"Connect"}),a.jsx("button",{className:"btn shrink-0",onClick:B,disabled:!N,children:"Sync"})]}),a.jsx("div",{className:"mt-3 p-3 rounded-xl bg-indigo-500/10 border border-indigo-500/40 opacity-60 text-center text-sm",children:"Lobby tools"})]}),a.jsx("div",{className:"col-span-12 md:col-span-4",children:n.inProgress?a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(es,{left:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden xs:inline px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-200 border border-indigo-400/30 text-[10px] sm:text-xs",children:"Game Mode"}),a.jsxs("span",{className:"font-medium whitespace-nowrap",children:[A,A==="X01"?` / ${n.startingScore}`:""]}),a.jsxs("span",{className:"opacity-80 whitespace-nowrap",children:["Players: ",n.players?.length||0]})]}),right:a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:ie?"Actual Size":"Fit All",onClick:()=>Xe(s=>!s),children:ie?"Actual Size":"Fit All"}),a.jsx("button",{className:"btn btn--ghost px-3 py-1 text-sm",title:ce?"Restore":"Maximize",onClick:()=>Ve(s=>!s),children:ce?"Restore":"Maximize"})]})}),a.jsx("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-3 text-slate-100 shadow-lg backdrop-blur-sm",children:(()=>{const s=(n.players||[]).map((o,m)=>{const p=o.legs?.[o.legs.length-1],f=p?p.totalScoreRemaining:n.startingScore,S=p?.visits?.[p.visits.length-1];return{name:o.name||o.id||`Player ${m+1}`,isCurrentTurn:(n.currentPlayerIdx||0)===m,legsWon:o.legsWon||0,score:f,lastScore:S?.score??0,matchAvg:void 0,allTimeAvg:void 0}}),r=n.players&&n.players.length===2?`${n.players[0]?.legsWon||0}-${n.players[1]?.legsWon||0}`:void 0;return a.jsx(ts,{gameMode:A,players:s,matchScore:r})})()})]}):a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx("div",{className:`p-3 rounded-2xl bg-slate-900/60 border border-white/10 p-3 text-slate-100 shadow-lg backdrop-blur-sm ${!N||Z?"opacity-60":""}`,role:"button",title:N?Z?"Weekly free games used":"Create a new match":"Connect to the lobby first",onClick:()=>{!N||Z||(M(!0),i?i.send({type:"list-matches"}):l.current?.send(JSON.stringify({type:"list-matches"})))},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{className:"btn btn--primary",children:"Create Match +"}),a.jsxs("div",{className:"text-sm opacity-80 ml-auto",children:["Matches: ",E.length]})]})}),a.jsxs("div",{className:"rounded-2xl bg-slate-900/60 border border-white/10 p-3 text-slate-100 shadow-lg backdrop-blur-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("div",{className:"font-semibold",children:"World Lobby"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"text-xs opacity-80",children:["Matches: ",E.length]}),a.jsx("button",{className:"btn px-3 py-1 text-sm",onClick:()=>i?i.send({type:"list-matches"}):l.current?.send(JSON.stringify({type:"list-matches"})),children:"Refresh"})]})]}),a.jsxs("ul",{className:"space-y-2",children:[E.map(s=>a.jsxs("li",{className:"p-2 rounded bg-white/3 border border-white/6 flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm",children:[s.game," · ",s.mode," · ",s.startingScore]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs opacity-70",children:s.creator||"host"}),a.jsx("button",{className:"btn btn-sm",onClick:()=>{try{const r={type:"join-match",matchId:s.id,calibrated:!!Ft,boardPreview:null};i?i.send(r):l.current?.send(JSON.stringify(r)),At({game:s.game,mode:s.mode,value:s.value,startingScore:s.startingScore})}catch{}},children:"Join"})]})]},s.id)),E.length===0&&a.jsx("li",{className:"text-sm opacity-60",children:"No matches found."})]})]})]})}),a.jsx("div",{className:"col-span-12 md:col-span-4",children:a.jsxs("div",{className:"rounded-2xl p-3 border border-white/10 bg-black/5 h-full min-h-[200px]",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"font-semibold",children:"Camera Preview"}),a.jsx("div",{className:"flex items-center gap-2"})]}),n.inProgress||j&&q!==null&&q<=10?a.jsx(Qt,{}):a.jsxs("div",{className:"rounded-2xl bg-slate-900/40 border border-white/10 p-4 text-slate-200 opacity-70",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Camera Preview"}),a.jsx("div",{className:"text-sm",children:"Camera is only available while a match is in progress. Join or create a match to enable camera pairing and live preview."})]})]})})]})}),wt&&a.jsx(ss,{players:n.players||[],user:d,initialSeconds:q??15,roomId:z??w,onDone:()=>{V(!1),ye(null),be(null),k(null),ge({}),U(!1),K(!1)},onChoice:s=>{Wt(s)},choices:vt,bullActive:Nt,onBullThrow:s=>{Jt(s)}}),b&&a.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/80 p-4",children:a.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-lg w-full",children:[a.jsx("div",{className:"text-lg font-bold mb-2",children:"Join Request"}),a.jsxs("div",{className:"opacity-80 mb-4",children:[b.fromName||"Player"," wants to join your match (",b.game,"). Accept?"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("button",{className:"btn btn-primary",onClick:()=>Me(!0),children:["Accept (",kt,"s)"]}),a.jsx("button",{className:"btn btn-ghost",onClick:()=>Me(!1),children:"Decline"})]})]})})]})}export{Qa as default};
//# sourceMappingURL=OnlinePlay-C0UWwdvt.js.map

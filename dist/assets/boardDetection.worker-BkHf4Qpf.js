(function(){"use strict";const B={bullInner:6.35,bullOuter:15.9,trebleInner:99,trebleOuter:107,doubleInner:162,doubleOuter:170},be=[20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];function ge(t,r){const e=new Array(9).fill(0);for(let n=0;n<3;n++)for(let l=0;l<3;l++)for(let s=0;s<3;s++)e[n*3+l]+=t[n*3+s]*r[s*3+l];return e}function te(t,r){const e=r.x,n=r.y,l=t[6]*e+t[7]*n+t[8],s=(t[0]*e+t[1]*n+t[2])/l,f=(t[3]*e+t[4]*n+t[5])/l;return{x:s,y:f}}function Le(t,r,e){return[r*t[0],r*t[1],r*t[2],e*t[3],e*t[4],e*t[5],t[6],t[7],t[8]]}function Pe(t,r){const e=Math.cos(r),n=Math.sin(r),l=[e,-n,0,n,e,0,0,0,1];return ge(t,l)}function Se(t,r,e){return ge([1,0,r,0,1,e,0,0,1],t)}function re(t,r){if(t.length<4||r.length<4)throw new Error("Need at least 4 correspondences");if(t.length!==r.length)throw new Error("Correspondences must have equal length");const e=[],n=[];for(let f=0;f<t.length;f++){const{x:c,y}=t[f],{x:C,y:O}=r[f];e.push([c,y,1,0,0,0,-C*c,-C*y]),n.push(C),e.push([0,0,0,c,y,1,-O*c,-O*y]),n.push(O)}const l=ke(e,n);return[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],1]}function ke(t,r){const e=t.length,n=t[0].length,l=Array.from({length:n},()=>new Array(n).fill(0)),s=new Array(n).fill(0);for(let f=0;f<e;f++)for(let c=0;c<n;c++){s[c]+=t[f][c]*r[f];for(let y=0;y<n;y++)l[c][y]+=t[f][c]*t[f][y]}return Fe(l,s)}function Fe(t,r){const e=r.length,n=t.map((s,f)=>s.concat([r[f]]));for(let s=0;s<e;s++){let f=s;for(let c=s+1;c<e;c++)Math.abs(n[c][s])>Math.abs(n[f][s])&&(f=c);if(Math.abs(n[f][s])<1e-12)throw new Error("Singular matrix");if(f!==s){const c=n[s];n[s]=n[f],n[f]=c}for(let c=s+1;c<e;c++){const y=n[c][s]/n[s][s];for(let C=s;C<=e;C++)n[c][C]-=y*n[s][C]}}const l=new Array(e).fill(0);for(let s=e-1;s>=0;s--){let f=n[s][e];for(let c=s+1;c<e;c++)f-=n[s][c]*l[c];l[s]=f/n[s][s]}return l}function Ne(t="center"){const r=(B.doubleInner+B.doubleOuter)/2,n=[20,6,3,11].map(l=>{const f=be.indexOf(l)/be.length*Math.PI*2-Math.PI/2,c=r*Math.cos(f),y=r*Math.sin(f);return{x:Math.abs(c)<1e-9?0:c,y:Math.abs(y)<1e-9?0:y}});return n.push({x:0,y:0}),n}function Ue(t,r,e=256){const n=[];for(let l=0;l<e;l++){const s=l/e*Math.PI*2,f=te(t,{x:r*Math.cos(s),y:r*Math.sin(s)});n.push(f)}return n}function Q(t,r,e){let n=0;for(let l=0;l<r.length;l++){const s=te(t,r[l]),f=s.x-e[l].x,c=s.y-e[l].y;n+=f*f+c*c}return Math.sqrt(n/r.length)}function $e(t,r,e={}){const n=t.length;if(n<4||r.length<4)throw new Error("Need at least 4 correspondences");const l=e.thresholdPx??8,s=e.maxIter??500,f=e.minInliers??4,c=e.rng??Math.random;let y=null,C=new Array(n).fill(!1),O=0,d=1/0;for(let x=0;x<s;x++){const T=new Set;for(;T.size<4;)T.add(Math.floor(c()*n));const P=Array.from(T),U=[],k=[];for(const M of P)U.push(t[M]),k.push(r[M]);let A;try{A=re(U,k)}catch{continue}const I=new Array(n).fill(!1);let i=0;for(let M=0;M<n;M++){const z=te(A,t[M]),W=z.x-r[M].x,G=z.y-r[M].y;Math.hypot(W,G)<=l&&(I[M]=!0,i++)}if(i<f)continue;const h=[],p=[];for(let M=0;M<n;M++)I[M]&&(h.push(t[M]),p.push(r[M]));let _;try{_=re(h,p)}catch{continue}const L=Q(_,h,p);(i>O||i===O&&L<d)&&(O=i,d=L,y=_,C=I.slice())}if(!y||O<f)return{H:null,inliers:new Array(n).fill(!1),errorPx:null};const m=[],R=[];for(let x=0;x<n;x++)C[x]&&(m.push(t[x]),R.push(r[x]));const E=m.length>0?Q(y,m,R):null;return{H:y,inliers:C,errorPx:E}}function je(t){if(t==null||Number.isNaN(t)||t<0)return null;let r;t<=.25?r=99.5+(.25-t)*2:t<=1?r=98+(1-t)*2:t<=2?r=95+(2-t)*3:t<=5?r=90+(5-t)*1.66:r=Math.max(0,90-(t-5)*5);const e=Math.max(0,Math.min(100,r));return Number(e.toFixed(1))}const Ve={},xe=t=>{let r;const e=new Set,n=(O,d)=>{const m=typeof O=="function"?O(r):O;if(!Object.is(m,r)){const R=r;r=d??(typeof m!="object"||m===null)?m:Object.assign({},r,m),e.forEach(E=>E(r,R))}},l=()=>r,y={setState:n,getState:l,getInitialState:()=>C,subscribe:O=>(e.add(O),()=>e.delete(O)),destroy:()=>{(Ve?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),e.clear()}},C=r=t(n,l,y);return y},qe=t=>t?xe(t):xe;function Me(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ae={exports:{}},D={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ve;function Be(){if(ve)return D;ve=1;var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),f=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),d=Symbol.iterator;function m(o){return o===null||typeof o!="object"?null:(o=d&&o[d]||o["@@iterator"],typeof o=="function"?o:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,x={};function T(o,a,u){this.props=o,this.context=a,this.refs=x,this.updater=u||R}T.prototype.isReactComponent={},T.prototype.setState=function(o,a){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,a,"setState")},T.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function P(){}P.prototype=T.prototype;function U(o,a,u){this.props=o,this.context=a,this.refs=x,this.updater=u||R}var k=U.prototype=new P;k.constructor=U,E(k,T.prototype),k.isPureReactComponent=!0;var A=Array.isArray,I=Object.prototype.hasOwnProperty,i={current:null},h={key:!0,ref:!0,__self:!0,__source:!0};function p(o,a,u){var b,w={},v=null,N=null;if(a!=null)for(b in a.ref!==void 0&&(N=a.ref),a.key!==void 0&&(v=""+a.key),a)I.call(a,b)&&!h.hasOwnProperty(b)&&(w[b]=a[b]);var g=arguments.length-2;if(g===1)w.children=u;else if(1<g){for(var F=Array(g),j=0;j<g;j++)F[j]=arguments[j+2];w.children=F}if(o&&o.defaultProps)for(b in g=o.defaultProps,g)w[b]===void 0&&(w[b]=g[b]);return{$$typeof:t,type:o,key:v,ref:N,props:w,_owner:i.current}}function _(o,a){return{$$typeof:t,type:o.type,key:a,ref:o.ref,props:o.props,_owner:o._owner}}function L(o){return typeof o=="object"&&o!==null&&o.$$typeof===t}function M(o){var a={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(u){return a[u]})}var z=/\/+/g;function W(o,a){return typeof o=="object"&&o!==null&&o.key!=null?M(""+o.key):a.toString(36)}function G(o,a,u,b,w){var v=typeof o;(v==="undefined"||v==="boolean")&&(o=null);var N=!1;if(o===null)N=!0;else switch(v){case"string":case"number":N=!0;break;case"object":switch(o.$$typeof){case t:case r:N=!0}}if(N)return N=o,w=w(N),o=b===""?"."+W(N,0):b,A(w)?(u="",o!=null&&(u=o.replace(z,"$&/")+"/"),G(w,a,u,"",function(j){return j})):w!=null&&(L(w)&&(w=_(w,u+(!w.key||N&&N.key===w.key?"":(""+w.key).replace(z,"$&/")+"/")+o)),a.push(w)),1;if(N=0,b=b===""?".":b+":",A(o))for(var g=0;g<o.length;g++){v=o[g];var F=b+W(v,g);N+=G(v,a,u,F,w)}else if(F=m(o),typeof F=="function")for(o=F.call(o),g=0;!(v=o.next()).done;)v=v.value,F=b+W(v,g++),N+=G(v,a,u,F,w);else if(v==="object")throw a=String(o),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return N}function H(o,a,u){if(o==null)return o;var b=[],w=0;return G(o,b,"","",function(v){return a.call(u,v,w++)}),b}function ne(o){if(o._status===-1){var a=o._result;a=a(),a.then(function(u){(o._status===0||o._status===-1)&&(o._status=1,o._result=u)},function(u){(o._status===0||o._status===-1)&&(o._status=2,o._result=u)}),o._status===-1&&(o._status=0,o._result=a)}if(o._status===1)return o._result.default;throw o._result}var $={current:null},X={transition:null},V={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:X,ReactCurrentOwner:i};function oe(){throw Error("act(...) is not supported in production builds of React.")}return D.Children={map:H,forEach:function(o,a,u){H(o,function(){a.apply(this,arguments)},u)},count:function(o){var a=0;return H(o,function(){a++}),a},toArray:function(o){return H(o,function(a){return a})||[]},only:function(o){if(!L(o))throw Error("React.Children.only expected to receive a single React element child.");return o}},D.Component=T,D.Fragment=e,D.Profiler=l,D.PureComponent=U,D.StrictMode=n,D.Suspense=y,D.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,D.act=oe,D.cloneElement=function(o,a,u){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var b=E({},o.props),w=o.key,v=o.ref,N=o._owner;if(a!=null){if(a.ref!==void 0&&(v=a.ref,N=i.current),a.key!==void 0&&(w=""+a.key),o.type&&o.type.defaultProps)var g=o.type.defaultProps;for(F in a)I.call(a,F)&&!h.hasOwnProperty(F)&&(b[F]=a[F]===void 0&&g!==void 0?g[F]:a[F])}var F=arguments.length-2;if(F===1)b.children=u;else if(1<F){g=Array(F);for(var j=0;j<F;j++)g[j]=arguments[j+2];b.children=g}return{$$typeof:t,type:o.type,key:w,ref:v,props:b,_owner:N}},D.createContext=function(o){return o={$$typeof:f,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:s,_context:o},o.Consumer=o},D.createElement=p,D.createFactory=function(o){var a=p.bind(null,o);return a.type=o,a},D.createRef=function(){return{current:null}},D.forwardRef=function(o){return{$$typeof:c,render:o}},D.isValidElement=L,D.lazy=function(o){return{$$typeof:O,_payload:{_status:-1,_result:o},_init:ne}},D.memo=function(o,a){return{$$typeof:C,type:o,compare:a===void 0?null:a}},D.startTransition=function(o){var a=X.transition;X.transition={};try{o()}finally{X.transition=a}},D.unstable_act=oe,D.useCallback=function(o,a){return $.current.useCallback(o,a)},D.useContext=function(o){return $.current.useContext(o)},D.useDebugValue=function(){},D.useDeferredValue=function(o){return $.current.useDeferredValue(o)},D.useEffect=function(o,a){return $.current.useEffect(o,a)},D.useId=function(){return $.current.useId()},D.useImperativeHandle=function(o,a,u){return $.current.useImperativeHandle(o,a,u)},D.useInsertionEffect=function(o,a){return $.current.useInsertionEffect(o,a)},D.useLayoutEffect=function(o,a){return $.current.useLayoutEffect(o,a)},D.useMemo=function(o,a){return $.current.useMemo(o,a)},D.useReducer=function(o,a,u){return $.current.useReducer(o,a,u)},D.useRef=function(o){return $.current.useRef(o)},D.useState=function(o){return $.current.useState(o)},D.useSyncExternalStore=function(o,a,u){return $.current.useSyncExternalStore(o,a,u)},D.useTransition=function(){return $.current.useTransition()},D.version="18.3.1",D}var Ce;function se(){return Ce||(Ce=1,ae.exports=Be()),ae.exports}var ze=se(),Ge=Me(ze),ce={exports:{}},ie={},le={exports:{}},ue={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oe;function We(){if(Oe)return ue;Oe=1;var t=se();function r(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var e=typeof Object.is=="function"?Object.is:r,n=t.useState,l=t.useEffect,s=t.useLayoutEffect,f=t.useDebugValue;function c(d,m){var R=m(),E=n({inst:{value:R,getSnapshot:m}}),x=E[0].inst,T=E[1];return s(function(){x.value=R,x.getSnapshot=m,y(x)&&T({inst:x})},[d,R,m]),l(function(){return y(x)&&T({inst:x}),d(function(){y(x)&&T({inst:x})})},[d]),f(R),R}function y(d){var m=d.getSnapshot;d=d.value;try{var R=m();return!e(d,R)}catch{return!0}}function C(d,m){return m()}var O=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?C:c;return ue.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:O,ue}var Ie;function He(){return Ie||(Ie=1,le.exports=We()),le.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we;function Xe(){if(we)return ie;we=1;var t=se(),r=He();function e(C,O){return C===O&&(C!==0||1/C===1/O)||C!==C&&O!==O}var n=typeof Object.is=="function"?Object.is:e,l=r.useSyncExternalStore,s=t.useRef,f=t.useEffect,c=t.useMemo,y=t.useDebugValue;return ie.useSyncExternalStoreWithSelector=function(C,O,d,m,R){var E=s(null);if(E.current===null){var x={hasValue:!1,value:null};E.current=x}else x=E.current;E=c(function(){function P(i){if(!U){if(U=!0,k=i,i=m(i),R!==void 0&&x.hasValue){var h=x.value;if(R(h,i))return A=h}return A=i}if(h=A,n(k,i))return h;var p=m(i);return R!==void 0&&R(h,p)?(k=i,h):(k=i,A=p)}var U=!1,k,A,I=d===void 0?null:d;return[function(){return P(O())},I===null?void 0:function(){return P(I())}]},[O,d,m,R]);var T=l(C,E[0],E[1]);return f(function(){x.hasValue=!0,x.value=T},[T]),y(T),T},ie}var De;function Ye(){return De||(De=1,ce.exports=Xe()),ce.exports}var Je=Ye(),Ke=Me(Je);const Ee={},{useDebugValue:Qe}=Ge,{useSyncExternalStoreWithSelector:Ze}=Ke;let Re=!1;const et=t=>t;function tt(t,r=et,e){(Ee?"production":void 0)!=="production"&&e&&!Re&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Re=!0);const n=Ze(t.subscribe,t.getState,t.getServerState||t.getInitialState,r,e);return Qe(n),n}const Te=t=>{(Ee?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof t=="function"?qe(t):t,e=(n,l)=>tt(r,n,l);return Object.assign(e,r),e},rt=t=>t?Te(t):Te,fe="ndn_user_settings";function de(){try{const t=localStorage.getItem(fe);if(!t)return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",cameraRecordDarts:!0,cameraShowLabels:!1,cameraLowLatency:!1,cameraProcessingFps:15,calibrationGuide:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:!0,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",hideInGameSidebar:!0,autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"immediate",confirmUncertainDarts:!1,autoScoreConfidenceThreshold:.82,autoscoreDetectorMinArea:30,autoscoreDetectorThresh:15,autoscoreDetectorRequireStableN:2,harshLightingMode:!1,enhanceBigTrebles:!1,allowAutocommitInOnline:!1,textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1};const r=JSON.parse(t);if(Number(r?.__version||0)<2){const n={...r,autoCommitMode:"immediate",confirmUncertainDarts:!1,cameraRecordDarts:!0,autoScoreConfidenceThreshold:.82,__version:2};try{localStorage.setItem(fe,JSON.stringify(n))}catch{}}return{favoriteDouble:r.favoriteDouble||"D16",callerEnabled:typeof r.callerEnabled=="boolean"?r.callerEnabled:!0,callerVoice:r.callerVoice||"",callerVolume:typeof r.callerVolume=="number"?Math.max(0,Math.min(1,r.callerVolume)):1,speakCheckoutOnly:!!r.speakCheckoutOnly,avgMode:r.avgMode==="24h"?"24h":"all-time",autoStartOffline:!!r.autoStartOffline,rememberLastOffline:typeof r.rememberLastOffline=="boolean"?r.rememberLastOffline:!0,lastOffline:r.lastOffline&&typeof r.lastOffline=="object"?{mode:r.lastOffline.mode||"X01",x01Start:Number(r.lastOffline.x01Start)||501,firstTo:Number(r.lastOffline.firstTo)||1,aiLevel:r.lastOffline.aiLevel||"None"}:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!!r.reducedMotion,compactHeader:!!r.compactHeader,allowSpectate:typeof r.allowSpectate=="boolean"?r.allowSpectate:!0,cameraScale:typeof r.cameraScale=="number"&&isFinite(r.cameraScale)?Math.max(.5,Math.min(1.25,r.cameraScale)):1,cameraAspect:r.cameraAspect==="square"?"square":"wide",cameraFitMode:r.cameraFitMode==="fit"||r.cameraFitMode==="fill"?r.cameraFitMode:"fit",calibrationUseRansac:typeof r.calibrationUseRansac=="boolean"?r.calibrationUseRansac:!0,autoscoreProvider:(()=>{let n=r.autoscoreProvider;return n!=="external-ws"&&n!=="manual"&&n!=="built-in"&&n!=="built-in-v2"&&(n="built-in"),n})(),autoscoreWsUrl:typeof r.autoscoreWsUrl=="string"?r.autoscoreWsUrl:"",autoCommitMode:r.autoCommitMode==="immediate"?"immediate":"wait-for-clear",confirmUncertainDarts:typeof r.confirmUncertainDarts=="boolean"?r.confirmUncertainDarts:!1,autoScoreConfidenceThreshold:typeof r.autoScoreConfidenceThreshold=="number"&&isFinite(r.autoScoreConfidenceThreshold)?Math.max(.5,Math.min(.99,r.autoScoreConfidenceThreshold)):.82,autoscoreDetectorMinArea:typeof r.autoscoreDetectorMinArea=="number"&&isFinite(r.autoscoreDetectorMinArea)?Math.max(5,Math.min(500,Math.round(r.autoscoreDetectorMinArea))):30,autoscoreDetectorThresh:typeof r.autoscoreDetectorThresh=="number"&&isFinite(r.autoscoreDetectorThresh)?Math.max(5,Math.min(60,Math.round(r.autoscoreDetectorThresh))):15,autoscoreDetectorRequireStableN:typeof r.autoscoreDetectorRequireStableN=="number"&&isFinite(r.autoscoreDetectorRequireStableN)?Math.max(1,Math.min(10,Math.round(r.autoscoreDetectorRequireStableN))):2,harshLightingMode:typeof r.harshLightingMode=="boolean"?r.harshLightingMode:!1,enhanceBigTrebles:typeof r.enhanceBigTrebles=="boolean"?r.enhanceBigTrebles:!1,allowAutocommitInOnline:!!r.allowAutocommitInOnline,calibrationGuide:typeof r.calibrationGuide=="boolean"?r.calibrationGuide:!0,preferredCameraId:typeof r.preferredCameraId=="string"?r.preferredCameraId:void 0,preserveCalibrationOverlay:typeof r.preserveCalibrationOverlay=="boolean"?r.preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:typeof r.preserveCalibrationOnCameraChange=="boolean"?r.preserveCalibrationOnCameraChange:!0,preferredCameraLabel:typeof r.preferredCameraLabel=="string"?r.preferredCameraLabel:void 0,preferredCameraLocked:typeof r.preferredCameraLocked=="boolean"?r.preferredCameraLocked:!1,cameraEnabled:typeof r.cameraEnabled=="boolean"?r.cameraEnabled:!0,hideCameraOverlay:typeof r.hideCameraOverlay=="boolean"?r.hideCameraOverlay:!1,offlineLayout:r.offlineLayout==="classic"?"classic":"modern",hideInGameSidebar:typeof r.hideInGameSidebar=="boolean"?r.hideInGameSidebar:!0,textSize:r.textSize==="small"||r.textSize==="large"?r.textSize:"medium",boxSize:r.boxSize==="small"||r.boxSize==="large"?r.boxSize:"medium",matchType:r.matchType==="doubles"?"doubles":"singles",teamAName:typeof r.teamAName=="string"?r.teamAName:"Team A",teamBName:typeof r.teamBName=="string"?r.teamBName:"Team B",dartTimerEnabled:typeof r.dartTimerEnabled=="boolean"?r.dartTimerEnabled:!1,dartTimerSeconds:typeof r.dartTimerSeconds=="number"&&isFinite(r.dartTimerSeconds)?Math.max(3,Math.min(60,r.dartTimerSeconds)):10,x01DoubleIn:typeof r.x01DoubleIn=="boolean"?r.x01DoubleIn:!1,cameraRecordDarts:typeof r.cameraRecordDarts=="boolean"?r.cameraRecordDarts:!0,cameraShowLabels:typeof r.cameraShowLabels=="boolean"?r.cameraShowLabels:!1}}catch{return{favoriteDouble:"D16",callerEnabled:!0,callerVoice:"",callerVolume:1,speakCheckoutOnly:!1,avgMode:"all-time",autoStartOffline:!1,rememberLastOffline:!0,lastOffline:{mode:"X01",x01Start:501,firstTo:1,aiLevel:"None"},reducedMotion:!1,compactHeader:!1,allowSpectate:!0,cameraScale:1,cameraAspect:"wide",cameraFitMode:"fit",calibrationGuide:!0,calibrationUseRansac:!0,preferredCameraId:void 0,preferredCameraLabel:void 0,preferredCameraLocked:!1,preserveCalibrationOverlay:!0,preserveCalibrationOnCameraChange:!0,cameraEnabled:!0,hideCameraOverlay:!1,offlineLayout:"modern",hideInGameSidebar:!0,autoscoreProvider:"built-in",autoscoreWsUrl:"",autoCommitMode:"immediate",confirmUncertainDarts:!1,autoScoreConfidenceThreshold:.82,harshLightingMode:!1,enhanceBigTrebles:!1,textSize:"medium",boxSize:"medium",matchType:"singles",teamAName:"Team A",teamBName:"Team B",dartTimerEnabled:!1,dartTimerSeconds:10,x01DoubleIn:!1}}}function S(t){try{const r=de();localStorage.setItem(fe,JSON.stringify({...r,...t}))}catch{}}const nt=rt((t,r)=>({...de(),setFavoriteDouble:e=>{S({favoriteDouble:e}),t({favoriteDouble:e})},setCallerEnabled:e=>{S({callerEnabled:e}),t({callerEnabled:e})},setCallerVoice:e=>{S({callerVoice:e}),t({callerVoice:e})},setAvgMode:e=>{S({avgMode:e}),t({avgMode:e})},setCallerVolume:e=>{const n=Math.max(0,Math.min(1,e));S({callerVolume:n}),t({callerVolume:n})},setSpeakCheckoutOnly:e=>{S({speakCheckoutOnly:e}),t({speakCheckoutOnly:e})},setAutoStartOffline:e=>{S({autoStartOffline:e}),t({autoStartOffline:e})},setRememberLastOffline:e=>{S({rememberLastOffline:e}),t({rememberLastOffline:e})},setLastOffline:e=>{const l={...de().lastOffline,...e};S({lastOffline:l}),t({lastOffline:l})},setReducedMotion:e=>{S({reducedMotion:e}),t({reducedMotion:e})},setCompactHeader:e=>{S({compactHeader:e}),t({compactHeader:e})},setAllowSpectate:e=>{S({allowSpectate:e}),t({allowSpectate:e})},ignorePreferredCameraSync:!1,setIgnorePreferredCameraSync:e=>{S({}),t({ignorePreferredCameraSync:e})},setCameraScale:e=>{const n=Math.max(.5,Math.min(2,e));S({cameraScale:n}),t({cameraScale:n})},setCameraAspect:e=>{const n=e==="square"?"square":"wide";S({cameraAspect:n}),t({cameraAspect:n})},setCameraFitMode:e=>{const n=e==="fit"?"fit":"fill";S({cameraFitMode:n}),t({cameraFitMode:n})},setAutoscoreProvider:e=>{const n=e;S({autoscoreProvider:n}),t({autoscoreProvider:n})},setAutoscoreWsUrl:e=>{S({autoscoreWsUrl:e}),t({autoscoreWsUrl:e})},setAutoCommitMode:e=>{const n=e==="immediate"?"immediate":"wait-for-clear";S({autoCommitMode:n}),t({autoCommitMode:n})},setConfirmUncertainDarts:e=>{const n=!!e;S({confirmUncertainDarts:n}),t({confirmUncertainDarts:n})},setAutoScoreConfidenceThreshold:e=>{const n=typeof e=="number"&&isFinite(e)?Math.max(.5,Math.min(.99,e)):.85;S({autoScoreConfidenceThreshold:n}),t({autoScoreConfidenceThreshold:n})},setAutoscoreDetectorMinArea:e=>{const n=typeof e=="number"&&isFinite(e)?Math.max(5,Math.min(500,Math.round(e))):30;S({autoscoreDetectorMinArea:n}),t({autoscoreDetectorMinArea:n})},setAutoscoreDetectorThresh:e=>{const n=typeof e=="number"&&isFinite(e)?Math.max(5,Math.min(60,Math.round(e))):15;S({autoscoreDetectorThresh:n}),t({autoscoreDetectorThresh:n})},setAutoscoreDetectorRequireStableN:e=>{const n=typeof e=="number"&&isFinite(e)?Math.max(1,Math.min(10,Math.round(e))):2;S({autoscoreDetectorRequireStableN:n}),t({autoscoreDetectorRequireStableN:n})},setHarshLightingMode:e=>{const n=!!e;S({harshLightingMode:n}),t({harshLightingMode:n})},setEnhanceBigTrebles:e=>{const n=!!e;S({enhanceBigTrebles:n}),t({enhanceBigTrebles:n})},setAllowAutocommitInOnline:e=>{S({allowAutocommitInOnline:e}),t({allowAutocommitInOnline:e})},setCalibrationGuide:e=>{S({calibrationGuide:e}),t({calibrationGuide:e})},setCalibrationUseRansac:e=>{S({calibrationUseRansac:e}),t({calibrationUseRansac:e})},setPreserveCalibrationOverlay:e=>{S({preserveCalibrationOverlay:e}),t({preserveCalibrationOverlay:e})},setPreserveCalibrationOnCameraChange:e=>{S({preserveCalibrationOnCameraChange:e}),t({preserveCalibrationOnCameraChange:!!e})},setPreferredCamera:(e,n,l=!1)=>{try{if(r().preferredCameraLocked&&!l){console.log("[USERSETTINGS] Camera selection locked and force=false, ignoring update");return}}catch{}try{const s=r();if(s.preferredCameraId===e&&s.preferredCameraLabel===n)return}catch{}S({preferredCameraId:e,preferredCameraLabel:n}),t({preferredCameraId:e,preferredCameraLabel:n})},setPreferredCameraLocked:e=>{try{if(r().ignorePreferredCameraSync&&e===!0){console.debug("[USERSETTINGS] Ignoring auto-lock due to ignorePreferredCameraSync");return}}catch{}S({preferredCameraLocked:e}),t({preferredCameraLocked:e})},setCameraEnabled:e=>{S({cameraEnabled:e}),t({cameraEnabled:e})},setHideCameraOverlay:e=>{S({hideCameraOverlay:e}),t({hideCameraOverlay:e})},setCameraShowLabels:e=>{S({cameraShowLabels:e}),t({cameraShowLabels:!!e})},setCameraRecordDarts:e=>{const n=!!e;S({cameraRecordDarts:n}),t({cameraRecordDarts:n})},setCameraLowLatency:e=>{const n=!!e;S({cameraLowLatency:n}),t({cameraLowLatency:n})},setCameraProcessingFps:e=>{const n=Math.max(5,Math.min(30,Math.round(e)));S({cameraProcessingFps:n}),t({cameraProcessingFps:n})},setOfflineLayout:e=>{S({offlineLayout:e}),t({offlineLayout:e})},setHideInGameSidebar:e=>{S({hideInGameSidebar:e}),t({hideInGameSidebar:e})},setTextSize:e=>{S({textSize:e}),t({textSize:e})},setBoxSize:e=>{S({boxSize:e}),t({boxSize:e})},setMatchType:e=>{const n=e==="doubles"?"doubles":"singles";S({matchType:n}),t({matchType:n})},setTeamAName:e=>{const n=e?.trim()||"Team A";S({teamAName:n}),t({teamAName:n})},setTeamBName:e=>{const n=e?.trim()||"Team B";S({teamBName:n}),t({teamBName:n})},setDartTimerEnabled:e=>{S({dartTimerEnabled:e}),t({dartTimerEnabled:e})},setDartTimerSeconds:e=>{const n=Math.max(3,Math.min(60,Math.round(e)));S({dartTimerSeconds:n}),t({dartTimerSeconds:n})},setX01DoubleIn:e=>{S({x01DoubleIn:e}),t({x01DoubleIn:e})}})),ot=t=>!!t&&Number.isFinite(t.x)&&Number.isFinite(t.y),at=t=>Array.isArray(t)&&t.length===9&&t.every(Number.isFinite);function st(t,r){const e=t.getContext("2d",{willReadFrequently:!0});if(!e)return null;const n=t.width,l=t.height,s=160,f=s/n,c=Math.floor(l*f),C=new OffscreenCanvas(s,c).getContext("2d",{willReadFrequently:!0});if(!C)return null;C.drawImage(t,0,0,s,c);const d=C.getImageData(0,0,s,c).data,m=new Float32Array(s*c),R=8;for(let a=1;a<c-1;a++)for(let u=1;u<s-1;u++){const b=(a*s+u)*4,w=b-4,v=b+4,N=b-s*4,g=b+s*4,F=d[w]*.299+d[w+1]*.587+d[w+2]*.114,j=d[v]*.299+d[v+1]*.587+d[v+2]*.114,q=d[N]*.299+d[N+1]*.587+d[N+2]*.114,Y=d[g]*.299+d[g+1]*.587+d[g+2]*.114,J=j-F,K=Y-q,Z=Math.sqrt(J*J+K*K);if(Z>R){const _e=J/Z,Ae=K/Z,ft=s*.03,dt=s*.6;for(let ee=ft;ee<dt;ee+=1){const me=Math.round(u+_e*ee),he=Math.round(a+Ae*ee);me>=0&&me<s&&he>=0&&he<c&&m[he*s+me]++;const pe=Math.round(u-_e*ee),ye=Math.round(a-Ae*ee);pe>=0&&pe<s&&ye>=0&&ye<c&&m[ye*s+pe]++}}}const E=new Float32Array(s*c),x=2;for(let a=x;a<c-x;a++)for(let u=x;u<s-x;u++){let b=0;for(let w=-x;w<=x;w++)for(let v=-x;v<=x;v++)b+=m[(a+w)*s+(u+v)];E[a*s+u]=b}let T=0,P=s/2,U=c/2;const k=5;for(let a=k;a<c-k;a++)for(let u=k;u<s-k;u++){const b=E[a*s+u];b>T&&(T=b,P=u,U=a)}let A=P/f,I=U/f;console.log(`[findDartboardRings] Voting Peak: (${Math.round(A)}, ${Math.round(I)}) Votes=${T}`);const i=400,h=i/n,p=Math.floor(l*h),L=new OffscreenCanvas(i,p).getContext("2d");if(!L)return null;L.drawImage(t,0,0,i,p);const M=L.getImageData(0,0,i,p).data,z=new Float32Array(i*p),W=new Float32Array(i*p);for(let a=1;a<p-1;a++)for(let u=1;u<i-1;u++){const b=(a*i+u)*4;M[b]*.299+M[b+1]*.587+M[b+2]*.114;const w=b-4,v=b+4,N=b-i*4,g=b+i*4,F=M[w]*.299+M[w+1]*.587+M[w+2]*.114,j=M[v]*.299+M[v+1]*.587+M[v+2]*.114,q=M[N]*.299+M[N+1]*.587+M[N+2]*.114,Y=M[g]*.299+M[g+1]*.587+M[g+2]*.114,J=j-F,K=Y-q;z[a*i+u]=J,W[a*i+u]=K}const G=e.getImageData(0,0,n,l).data,H=(a,u)=>{const b=Math.max(0,Math.min(n-1,Math.round(a))),v=(Math.max(0,Math.min(l-1,Math.round(u)))*n+b)*4;return .299*G[v]+.587*G[v+1]+.114*G[v+2]},ne=60,$={};for(let a=0;a<ne;a++){const u=a/ne*Math.PI*2,b=Math.cos(u),w=Math.sin(u),v=[];for(let g=30;g<Math.min(n,l)/2;g+=1){const F=A+(g-2)*b,j=I+(g-2)*w,q=A+(g+2)*b,Y=I+(g+2)*w,J=H(F,j),K=H(q,Y),Z=Math.abs(K-J);Z>2&&g>20&&v.push({r:g,grad:Z})}const N=[];for(let g=0;g<v.length;g++){const F=g>0?v[g-1].grad:0,j=v[g].grad,q=g<v.length-1?v[g+1].grad:0;j>F&&j>q&&j>2&&N.push(v[g].r)}N.length>0&&N.forEach(g=>{const F=Object.keys($).map(q=>({key:parseInt(q),median:$[parseInt(q)][Math.floor($[parseInt(q)].length/2)]})).filter(q=>Math.abs(q.median-g)<15).sort((q,Y)=>Math.abs(q.median-g)-Math.abs(Y.median-g))[0],j=F?F.key:Math.max(-1,...Object.keys($).map(q=>parseInt(q)))+1;$[j]||($[j]=[]),$[j].push(g)})}const X=Object.keys($).map(a=>{const u=$[parseInt(a)].sort((w,v)=>w-v),b=u[Math.floor(u.length/2)];return{tier:parseInt(a),radius:b,samples:u.length}}).sort((a,u)=>a.radius-u.radius);console.log("[findDartboardRings] Detected ring tiers:",X);const V=[...X];if(V.length>=2){const a=V[V.length-1].radius,u=V[V.length-2].radius,b=a/u;(b>1.15&&V.length>=5||b>1.3)&&(console.log(`[findDartboardRings] Ignoring outermost ring (likely light ring/surround): ${a.toFixed(1)}px (ratio ${b.toFixed(2)} to ${u.toFixed(1)}px)`),V.pop())}const oe=V.length>0?V[V.length-1].radius:Math.min(n,l)*.3;let o=50+V.length*6;return V.length>=7?o=98:V.length===6?o=96:V.length===5&&(o=94),{cx:A,cy:I,r:oe,confidence:o,ringCount:V.length,ringStrength:V.length>0?V[V.length-1].radius:0,detectedRings:V.map(a=>a.radius)}}function ct(t,r,e,n){const l=t.getContext("2d");if(!l)return null;const s=t.width,f=t.height,c=720,y=n,C=new Array(c).fill(0),O=Math.max(2,Math.round(y-8)),d=Math.round(y+8),m=l.getImageData(0,0,s,f).data,R=(i,h)=>{const p=Math.round(i),_=Math.round(h);if(p<0||p>=s||_<0||_>=f)return 127;const L=(_*s+p)*4;return m[L]*.299+m[L+1]*.587+m[L+2]*.114};for(let i=0;i<c;i++){const h=i/c*Math.PI*2;let p=0,_=R(r+O*Math.cos(h),e+O*Math.sin(h));for(let L=O+1;L<=d;L++){const M=R(r+L*Math.cos(h),e+L*Math.sin(h)),z=Math.abs(M-_);z>p&&(p=z),_=M}C[i]=p}const E=[];for(let i=0;i<c;i++){const h=C[(i-1+c)%c],p=C[i],_=C[(i+1)%c];p>h&&p>_&&p>10&&E.push(i)}if(E.length<16){const i=C.map((h,p)=>{let _=0,L=0;for(let M=-2;M<=2;M++)_+=C[(p+M+c)%c],L++;return _/L});for(let h=0;h<c;h++){const p=i[(h-1+c)%c],_=i[h],L=i[(h+1)%c];_>p&&_>L&&_>8&&E.push(h)}}if(E.length===0)return 0;const x=E.map(i=>i/c*Math.PI*2);x.sort((i,h)=>i-h);const T=[];for(let i=0;i<x.length;i++){const h=x[i],_=(x[(i+1)%x.length]-h+Math.PI*2)%(Math.PI*2);T.push((h+_/2)%(Math.PI*2))}const P=20,U=new Array(P).fill(0).map((i,h)=>-Math.PI/2+h*(Math.PI*2/P));let k=0,A=1/0;for(let i=0;i<T.length;i++){let h=0;for(let p=0;p<Math.min(P,T.length);p++){const _=T[(p+i)%T.length],L=U[p],M=Math.abs((_-L+Math.PI)%(Math.PI*2)-Math.PI);h+=M*M}h<A&&(A=h,k=(T[i]-U[0]+Math.PI*2)%(Math.PI*2))}return(k+Math.PI)%(Math.PI*2)-Math.PI}function it(t,r){const e=t.getContext("2d");if(!e)return r;const n=t.width,l=t.height,f=e.getImageData(0,0,n,l).data,c=(P,U)=>{const k=Math.max(0,Math.min(n-1,Math.round(P))),I=(Math.max(0,Math.min(l-1,Math.round(U)))*n+k)*4;return .299*f[I]+.587*f[I+1]+.114*f[I+2]},y=(P,U)=>{const k=c(P+1,U)-c(P-1,U),A=c(P,U+1)-c(P,U-1);return{gx:k,gy:A}},C=te(r,{x:0,y:0}),O=P=>{const U=[B.trebleOuter,B.doubleOuter];let k=0;for(const A of U){const I=Ue(P,A,180);for(let i=0;i<I.length;i++){const h=I[i],p=y(h.x,h.y),_=h.x-C.x,L=h.y-C.y,M=Math.hypot(_,L)||1,z=_/M,W=L/M;k+=Math.abs(p.gx*z+p.gy*W)}}return k/180/2};let d=r,m=O(r);const R=P=>P*Math.PI/180,E=[-4,-2,-1,-.5,0,.5,1,2,4],x=[-3,-2,-1,0,1,2,3],T=[.98,.99,1,1.01,1.02];for(const P of E){const U=Pe(r,R(P));for(const k of x)for(const A of x){const I=Se(U,k,A);for(const i of T){const h=Le(I,i,i),p=O(h);p>m&&(m=p,d=h)}}}return d}function lt(t,r){try{const e=t.width,n=t.height,l=e/2,s=n/2;let f=t;r?.colorAssist;const c=st(f,r?.centerHint);if(!c)return{success:!1,cx:l,cy:s,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:"No dartboard detected. Ensure board is clearly visible with good contrast between rings and background."};const y=(()=>{const I=c.detectedRings||[];if(I.length>=6)return{cx:c.cx,cy:c.cy,bullInner:I[0],bullOuter:I[1],trebleInner:I[2],trebleOuter:I[3],doubleInner:I[4],doubleOuter:I[5]};{const i=c.r/B.doubleOuter;return{cx:c.cx,cy:c.cy,bullInner:B.bullInner*i,bullOuter:B.bullOuter*i,trebleInner:B.trebleInner*i,trebleOuter:B.trebleOuter*i,doubleInner:B.doubleInner*i,doubleOuter:c.r}}})(),C=ct(t,y.cx,y.cy,y.doubleOuter)||0,O=Ne("outer"),d=O.map(I=>{if(I.x===0&&I.y===0)return{x:y.cx,y:y.cy};const i=Math.cos(C),h=Math.sin(C),p=y.doubleOuter/B.doubleOuter,_=I.x*p,L=I.y*p;return{x:y.cx+(_*i-L*h),y:y.cy+(_*h+L*i)}});let m=null,R=null,E=c.confidence,x=1;try{let I=!0;try{I=!!nt.getState?.()?.calibrationUseRansac}catch{}if(I){const p=$e(O,d,{thresholdPx:8,maxIter:300});p.H?(m=p.H,R=p.errorPx,x=p.inliers.filter(Boolean).length/d.length,E=Math.max(E,Math.round(E*.6+x*40))):(m=re(O,d),R=Q(m,O,d))}else m=re(O,d),R=Q(m,O,d);if(m&&(m=it(t,m),R=Q(m,O,d)),m){const p=te(m,{x:0,y:0}),_=y.cx-p.x,L=y.cy-p.y;Math.hypot(_,L)>.25&&(m=Se(m,_,L),R=Q(m,O,d))}const h=je(typeof R=="number"?R:null);typeof h=="number"?E=h:E=Math.max(x*100,c.confidence)}catch{E=Math.max(65,c.confidence)}const T=d.every(ot),P=at(m),U=!!P&&T&&E>50,k=c.ringCount??0,A={success:U,cx:y.cx,cy:y.cy,bullInner:y.bullInner,bullOuter:y.bullOuter,trebleInner:y.trebleInner,trebleOuter:y.trebleOuter,doubleInner:y.doubleInner,doubleOuter:y.doubleOuter,confidence:Math.round(E),homography:P?m:null,errorPx:P?R:null,calibrationPoints:T?d:[],theta:typeof C=="number"?C:void 0,message:!T||!P?`❌ Detection produced unstable calibration data. Adjust camera framing or calibrate manually. (rings: ${k}, r:${Math.round(c.r)})`:E>85?`✅ Excellent detection (rings: ${k}, r:${Math.round(c.r)})`:`✅ Board detected - may need angle adjustment (rings: ${k}, r:${Math.round(c.r)})`};return console.log("[detectBoard] Final result:",{success:A.success,confidence:A.confidence,homographyValid:P,pointsValid:T,cx:Math.round(A.cx),cy:Math.round(A.cy),doubleOuter:Math.round(A.doubleOuter),rings:k,errorPx:A.errorPx?A.errorPx.toFixed(2):null,calibrationPoints:d.map(I=>({x:Math.round(I.x),y:Math.round(I.y)}))},A.message),A}catch(e){return{success:!1,cx:t.width/2,cy:t.height/2,bullInner:0,bullOuter:0,trebleInner:0,trebleOuter:0,doubleInner:0,doubleOuter:0,confidence:0,homography:null,errorPx:null,calibrationPoints:[],message:e instanceof Error?e.message:"Board detection failed"}}}function mt(t){return t}const ut=t=>{const r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("Unable to get 2D context for detection");return r};self.addEventListener("message",t=>{const r=t.data;if(!r||r.type!=="detect")return;const{bitmap:e}=r;try{const n=new OffscreenCanvas(e.width,e.height);ut(n).drawImage(e,0,0,e.width,e.height);const s=lt(n),f=s&&s;self.postMessage({type:"result",detection:f??s})}catch(n){const l=n instanceof Error?n.message:String(n);self.postMessage({error:l})}finally{try{e.close?.()}catch{}}})})();
//# sourceMappingURL=boardDetection.worker-BkHf4Qpf.js.map

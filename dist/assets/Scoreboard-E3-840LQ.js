import{j as e,i as V,K as W,R as I}from"./index-0oBsAK_j.js";import{f as R}from"./stats-X3jz_E9o.js";import{r as M,N as T}from"./ui-Cl5S-Tv0.js";import{S as $}from"./ScoreNumberPad-v_yHOeKc.js";import"./vendor-D3F3s8fL.js";function L({inProgress:i=!0,startingScore:u=501,pendingEntries:p=[],onAddVisit:v,onUndo:y,onEndLeg:j,onNextPlayer:f,onEndGame:w,showDartsSelect:S=!0,showCheckoutSelectors:g=!0,showActionButtons:N=!0,showQuickButtons:D=!0,showUndo:E=!0,showVisitInputRow:P=!0,showHelperText:t=!0,showNumberPadLabel:s=!0,quickButtons:a=[180,140,100,60]}){const[n,l]=M.useState("0"),[m,o]=M.useState(3),[c,x]=M.useState(3),[d,h]=M.useState(1),b=Number(n||0),C=Number.isFinite(b)?b:0,k=()=>{v(Math.max(0,C),m),l("0")};return i?e.jsxs("div",{className:"space-y-3",children:[P&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{className:"input w-32",type:"number",value:n,onChange:r=>l(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),k())},placeholder:"Score"}),S&&e.jsxs("select",{className:"input",value:m,onChange:r=>o(parseInt(r.target.value)),children:[e.jsx("option",{value:1,children:"1 dart"}),e.jsx("option",{value:2,children:"2 darts"}),e.jsx("option",{value:3,children:"3 darts"})]}),e.jsx("button",{className:"btn",onClick:k,children:"Add Visit âž•"}),E&&e.jsx("button",{className:"px-3 py-2 rounded-xl border border-slate-200",onClick:()=>y&&y(),title:"Undo",children:e.jsx(T,{className:"w-4 h-4"})})]}),D&&a&&a.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-xs",children:[e.jsx("span",{className:"opacity-70",children:"Quick:"}),a.map(r=>e.jsx("button",{className:"btn px-2 py-0.5 text-xs",onClick:()=>v(r,3),children:r},String(r)))]}),e.jsx($,{value:n,onChange:l,onSubmit:k,label:s?"Number pad":void 0,helperText:t?"Tap numbers then press Enter to submit.":void 0}),N&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{className:"btn",onClick:()=>{j&&j(Math.max(0,C),c,{doubleDarts:d}),l("0")},children:["End Leg (Checkout ",C||0,") ï¿½"]}),e.jsx("button",{className:"btn bg-slate-700 hover:bg-slate-800",onClick:()=>f&&f(),children:"Next Player ðŸ‘¤"}),e.jsx("button",{className:"btn bg-emerald-600 hover:bg-emerald-700",onClick:()=>{w&&w()},children:"End Game ï¿½"})]}),g&&e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts used at double"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[0,1,2,3].map(r=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${d===r?"bg-brand-600":"btn--ghost"}`,onClick:()=>h(r),children:r},`double-${r}`))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white/60 mb-1",children:"Darts at checkout"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[0,1,2,3].map(r=>e.jsx("button",{className:`btn px-3 py-1 text-sm ${c===r?"bg-brand-600":"btn--ghost"}`,onClick:()=>x(r),children:r},`checkout-${r}`))})]})]})]}):e.jsx("p",{className:"text-slate-600",children:"No game in progress."})}function U({matchActions:i}={}){const{players:u,currentPlayerIdx:p,addVisit:v,undoVisit:y,endLeg:j,nextPlayer:f,endGame:w,inProgress:S,startingScore:g,bestLegThisMatch:N}=V(),D=W(t=>t.entries),E=t=>{try{const s=u[t],a=s?.legs?.[s.legs.length-1],l=a?.visits?.[a.visits.length-1]?.entries;return Array.isArray(l)?l:null}catch{return null}};function P(){try{const t={ts:Date.now(),players:u.map(s=>{const a=s.legs.reduce((m,o)=>{m.points+=o.totalScoreStart-o.totalScoreRemaining;const c=(o.visits||[]).reduce((x,d)=>x+(d.darts||0),0);return m.darts+=c,m},{points:0,darts:0}),n=a.darts,l=n>0?a.points/n*3:0;return{id:s.id,name:s.name,legsWon:s.legsWon,dartsThrown:n,avg:Math.round(l*100)/100}}),winner:u.reduce((s,a)=>a.legsWon>(s?.legsWon||0)?a:s,u[0])?.name};try{localStorage.setItem("ndn_last_match",JSON.stringify(t))}catch{}}catch{}(i?.endGame??w)()}return e.jsx(I,{storageKey:"ndn:modal:scoreboard",className:"ndn-modal w-full h-full relative",defaultWidth:1100,defaultHeight:720,minWidth:720,minHeight:480,maxWidth:1600,maxHeight:1200,initialFitHeight:!0,children:e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-3",children:e.jsx("div",{className:"ndn-hscroll",children:e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-3",children:e.jsxs("div",{className:"col-span-2 card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Score Input"}),S?e.jsx(L,{inProgress:S,startingScore:g,pendingEntries:D,onAddVisit:(t,s)=>{const a=u[p],n=a.legs[a.legs.length-1];let o=(n?n.totalScoreRemaining:g)-(typeof t=="number"?t:0);(!Number.isFinite(o)||o<0)&&(o=0),i?.addVisit?i.addVisit(t,s):v(t,s),o===0?i?.endLeg?i.endLeg(t):j(t):(i?.nextPlayer??f)()},onUndo:()=>(i?.undoVisit??y)(),onEndLeg:(t,s,a)=>{const n=typeof t=="number"?t:0,l=typeof s=="number"?Math.max(0,s):0;i?.addVisit?i.addVisit(n,l,{visitTotal:n,doubleWindowDarts:a?.doubleDarts??0}):v(n,l,{visitTotal:n,doubleWindowDarts:a?.doubleDarts??0}),(i?.endLeg??j)(n)},onNextPlayer:()=>(i?.nextPlayer??f)(),onEndGame:P,quickButtons:[180,140,100,60]}):e.jsx("p",{className:"text-slate-600",children:"No game in progress."}),e.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:u.map((t,s)=>{const a=t.legs[t.legs.length-1],n=a?a.totalScoreRemaining:g,l=t.legs.reduce((c,x)=>{c.points+=x.totalScoreStart-x.totalScoreRemaining;const d=(x.visits||[]).reduce((h,b)=>h+(b.darts||0),0);return c.darts+=d,c},{points:0,darts:0}),m=l.darts,o=m>0?l.points/m*3:0;return e.jsxs("div",{className:`card glass transition-shadow transition-all duration-150 ease-out ${s===p?"ring-2 ring-brand-400":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold",children:t.name}),e.jsxs("span",{className:"badge w-32 justify-center",children:["Legs Won: ",t.legsWon]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Remaining"}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-1 h-3 w-full","aria-hidden":!0,children:[0,1,2].map(c=>{const x=E(s),d=s===p?D[c]??null:x?.[c]??null,h=d==null,b=d!=null&&(typeof d.ring=="string"?d.ring!=="MISS":typeof d.value=="number"?d.value>0:!0),r=`visit-dot ${s===p&&!h?"active":"inactive"} ${h?"bg-gray-400/60":b?"bg-emerald-400":"bg-rose-500"}`;return e.jsx("span",{className:r},c)})}),e.jsx("div",{className:"text-2xl font-bold",children:n}),e.jsx("div",{className:"h-1 w-full bg-white/10 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400/70 transition-all duration-200 ease-out",style:{width:`${Math.max(0,Math.min(100,(1-n/g)*100))}%`}})})]}),e.jsxs("div",{className:"p-2 rounded-xl bg-white/10 border border-white/10 metric-tile",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Darts"}),e.jsx("div",{className:"text-xl font-bold",children:m})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-white/10 border border-white/10 metric-tile flex flex-col justify-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"3-Dart Avg (Live)"}),e.jsx("div",{className:"text-xl font-bold",children:R(t.currentThreeDartAvg??0)})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-white/10 border border-white/10 metric-tile flex flex-col justify-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"3-Dart Avg (Match)"}),e.jsx("div",{className:"text-xl font-bold",children:R(o)})]})]})]},t.id)})}),N&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl bg-emerald-50 border border-emerald-200",children:[e.jsx("strong",{children:"Best Leg (this match):"})," Player"," ",u.find(t=>t.id===N.playerId)?.name," ","in ",N.darts," darts"]})]})})})})})}export{U as default};
//# sourceMappingURL=Scoreboard-E3-840LQ.js.map

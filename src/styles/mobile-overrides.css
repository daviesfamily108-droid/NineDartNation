/* Mobile-first visual overhaul (phones + small tablets)
   Goals:
   - Everything is readable, tappable, and not cramped.
   - Header stays usable but doesn't steal vertical space.
   - Content never hides under fixed UI (header / bottom nav).
   - Works in portrait + landscape.

   NOTE: This file is loaded after Tailwind in `src/main.tsx`.
*/

@media (max-width: 768px) {
  :root {
    /* Shared sizing tokens */
    --ndn-header-h: 48px;
    --ndn-bottomnav-h: 64px;
    --ndn-safe-top: env(safe-area-inset-top, 0px);
    --ndn-safe-bottom: env(safe-area-inset-bottom, 0px);
  }

  /* Prevent iOS text-size auto bumping layouts */
  html {
    -webkit-text-size-adjust: 100%;
  }

  /* Provide a stable viewport baseline and reduce sideways scroll accidents */
  html,
  body {
    width: 100%;
    overflow-x: hidden;
  }

  /* Simplify background to reduce visual noise on phones */
  body {
    background: #0f172a; /* Solid dark slate for cleaner look */
    color: #f8fafc;
    font-size: 16px; /* base readable size */
    line-height: 1.35;
  }

  /* Header becomes compact and fixed */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 300; /* ensure header stays above mobile drawer/backdrop */
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: var(--ndn-header-h);
    padding: 8px 10px;
    padding-top: calc(8px + var(--ndn-safe-top));
    border-radius: 0;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,0.05);
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  /* Header layout: allow left greeting block to shrink so the hamburger stays at far-left */
  #ndn-header {
    gap: 8px !important;
  }
  #ndn-header > :nth-child(2) {
    min-width: 0 !important;
  }
  .logo { font-size: 1.25rem; font-weight: 800; }

  /* Home page: clean separation, no overlap, professional spacing */
  .home-shell {
    min-height: auto !important;
    justify-content: flex-start !important;
    padding: 0 !important;
    padding-top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 12px) !important;
  }
  
  .home-content {
    max-width: 720px !important;
    margin: 0 auto !important;
    padding: 20px !important;
    border-radius: 18px !important;
    margin-top: 0 !important;
  }
  
  .home-intro { 
    gap: 12px !important;
    margin-bottom: 16px !important;
  }
  
  .home-brand-row {
    flex-wrap: wrap !important;
    row-gap: 10px !important;
    column-gap: 10px !important;
    letter-spacing: 0.14em !important;
  }
  
  .home-brand-tag {
    font-size: 12px;
    opacity: 0.9;
  }
  
  .home-brand-row .home-menu-button {
    width: auto !important;
    border-radius: 999px !important;
    padding: 10px 14px !important;
    min-height: 40px;
  }

  /* Headline hierarchy (avoid giant jumps and prevent crowding) */
  .home-content h2 {
    font-size: 28px !important;
    line-height: 1.1 !important;
    letter-spacing: -0.02em;
  }
  .home-content p {
    line-height: 1.35;
  }

  /* Force the home buttons grid to be 2 columns on phones for comfortable spacing */
  .home-content .grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 12px !important;
  }
  .home-content .grid > button {
    border-radius: 18px !important;
    padding: 14px 12px !important;
    min-height: 68px;
    font-size: 15px !important;
    line-height: 1.2;
    white-space: normal;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  /* Keep the "Did you know" pill from causing horizontal overflow */
  .home-content .home-intro + div {
    margin-top: 10px;
  }
  .home-content .home-intro + div > div {
    max-width: 100% !important;
    border-radius: 999px !important;
    padding-left: 14px !important;
    padding-right: 14px !important;
  }

  /* Ensure the hamburger/menu button is always visible and tappable on mobile.
     Avoid relying on aria-label text (can change); target common patterns. */
  #ndn-header button[aria-label],
  #ndn-header [data-testid="mobile-menu-button"],
  #ndn-header .ndn-mobile-menu-btn {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 70;
    min-width: 44px;
    min-height: 44px;
    margin-right: 6px;
    flex: 0 0 auto;
  }

  /* Mobile brand pill above the hamburger */
  .ndn-mobile-brand {
    display: none;
  }
  @media (max-width: 768px) {
    .ndn-mobile-brand {
      display: inline-flex;
      position: absolute;
      left: 10px;
      top: calc(var(--ndn-safe-top) + 6px);
      z-index: 310;
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(90deg,#111827,#0f172a);
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
      color: white;
      font-weight: 800;
      font-size: 0.9rem;
    }
  }

  /* Hide large sidebar on mobile EXCEPT when explicitly shown in drawer */
  .sidebar:not(.mobile-sidebar-visible) { 
    display: none !important; 
  }
  
  /* Drawer sidebar polish (mobile) - make it visible and styled */
  .sidebar.mobile-sidebar-visible {
    display: flex !important;
    padding: 16px !important;
    gap: 20px !important;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    position: relative !important;
    top: auto !important;
    left: auto !important;
    bottom: auto !important;
    width: 100% !important;
  }
  
  .sidebar.mobile-sidebar-visible h3 {
    margin: 8px 0 4px 0 !important;
    padding-left: 8px !important;
    letter-spacing: 0.14em !important;
    font-size: 10px !important;
  }
  
  .sidebar.mobile-sidebar-visible .tab {
    width: 100% !important;
    padding: 14px 16px !important;
    border-radius: 12px !important;
    white-space: normal !important;
    font-size: 15px !important;
  }

  /* Let the hamburger drawer behave like a proper mobile sheet */
  .ndn-drawer {
    max-width: min(92vw, 420px) !important;
  }

  /* Keep drawer panel below the fixed header on phones so header does not look overlapped */
  /* Keep drawer panel and backdrop just below the header with a small gap */
  .ndn-drawer-root .ndn-drawer-panel {
    top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 6px);
    height: calc(100% - (var(--ndn-header-h) + var(--ndn-safe-top) + 6px));
    border-top-left-radius: 0 !important;
    border-top-right-radius: 0 !important;
  }

  /* Backdrop should also start below the header so header remains visible */
  .ndn-drawer-root .ndn-drawer-backdrop {
    top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 6px);
    height: calc(100% - (var(--ndn-header-h) + var(--ndn-safe-top) + 6px));
  }

  /* Ensure main scroll area gets a small top padding so content sits under header with a tiny gap */
  #ndn-main-scroll {
    padding-top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 6px) !important;
  }

  /* Convert main layout to a single-column flow with proper header clearance */
  .container, .app-shell, .main-content, .ndn-game-shell { 
    padding: 0.5rem !important; 
  }
  
  /* Main scroll area needs space below the fixed header */
  #ndn-main-scroll {
    padding-top: 8px !important;
  }
  
  .ndn-game-shell {
    margin-top: calc(var(--ndn-header-h) + var(--ndn-safe-top)); /* account for fixed header */
  }

  /* Cards should be edge-to-edge with comfortable padding */
  .card, .glass {
    border-radius: 12px !important;
    margin: 0.5rem 0 !important;
    padding: 16px !important;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
    background: #1e293b !important; /* Solid card bg */
    border: 1px solid rgba(255,255,255,0.05) !important;
  }

  /* Make buttons full width where appropriate and bigger tap targets */
  .btn { width: 100% !important; padding: 14px 16px !important; font-size: 16px !important; border-radius: 10px !important; }
  .btn-inline { width: auto !important; }

  /* Forms and inputs comfortable on mobile */
  .input, input, textarea, select { font-size: 16px !important; padding: 12px 14px !important; border-radius: 10px !important; background: #0f172a !important; border: 1px solid rgba(255,255,255,0.1) !important; }

  /* Camera and video panes should be shorter and responsive */
  .ndn-camera-tall { min-height: 200px !important; }
  .camera-fullwidth-card { padding: 0 !important; border-radius: 10px !important; }

  /* --- Camera / Calibration specific helpers --- */
  /* Make any camera viewport fill the available vertical space cleanly */
  .camera-fullwidth-card,
  .calibrator-camera-card,
  .ndn-camera-card {
    overflow: hidden !important;
  }

  /* If a page uses an in-card camera container, keep it tall enough on phones */
  .ndn-camera-viewport,
  .camera-viewport {
    width: 100% !important;
    min-height: 42vh !important;
    max-height: 62vh !important;
  }

  /* Inline camera selector (CameraView) sits away from notches/edges */
  .camera-selector,
  .ndn-camera-selector {
    top: calc(10px + var(--ndn-safe-top)) !important;
    right: 10px !important;
    left: auto !important;
    max-width: calc(100vw - 20px) !important;
  }

  /* Give camera overlays/panels safe padding around header/bottom nav */
  .camera-page,
  .calibrator-page,
  .ndn-camera-page {
    padding-bottom: calc(var(--ndn-safe-bottom) + 18px) !important;
  }

  /* A sticky bottom action bar for camera/calibration screens */
  .ndn-action-rail {
    position: sticky;
    bottom: calc(var(--ndn-safe-bottom) + 8px);
    z-index: 45;
    padding: 10px;
    margin: 10px 0 0 0;
    background: rgba(15, 23, 42, 0.65);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
  }

  .ndn-action-rail .btn {
    width: 100% !important;
  }

  /* Game controls stacked vertically and spaced */
  .match-controls, .match-actions, .controls-row { display: flex !important; flex-direction: column !important; gap: 10px !important; }

  /* Reduce footer/panels and make floating controls reachable */
  .floating-controls { bottom: 14px !important; left: 10px !important; right: 10px !important; width: auto !important; }

  /* Promote important text and increase contrast for readability */
  h1, h2, h3 { font-weight: 700; color: #fff; }
  p, label { color: #cbd5e1; }

  /* Compact modals to fill the viewport on mobile */
  .ndn-modal-full, .modal { border-radius: 8px !important; padding: 12px !important; }

  /* Make nav tabs easier to tap (bottom tab bar) */
  .tabs, .tab-list { display: flex !important; gap: 6px !important; justify-content: space-between; }
  .tab { flex: 1 1 auto !important; text-align: center !important; padding: 10px 6px !important; font-weight: 700 !important; border-radius: 8px !important; }

  /* Hide decorative background animation on mobile for perf */
  .background-animated { display: none !important; }

  /* Mobile scroll area: keep header clearance, but don't reserve space for a bottom tab bar */
  #ndn-main-scroll {
    padding-bottom: calc(var(--ndn-safe-bottom) + 18px) !important;
    scroll-padding-bottom: calc(var(--ndn-safe-bottom) + 18px) !important;
    padding-top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 12px) !important;
    scroll-padding-top: calc(var(--ndn-header-h) + var(--ndn-safe-top) + 12px) !important;
  }

  .card, .glass {
    width: 100% !important;
  }

  footer { margin-bottom: 16px !important; }

  /* Improve scoreboard readability: single-column items */
  .scoreboard, .stats-panel { display: block !important; width: 100% !important; }
  .scoreboard .row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

  /* Footer spacing to avoid UI overlap */
  .ndn-shell-body { padding-bottom: calc(var(--ndn-safe-bottom) + 18px) !important; }

  /* Bottom nav removed from layout; keep any leftover markup hidden just in case */
  .ndn-bottom-nav { display: none !important; }

  /* Landscape tuning: reclaim vertical space */
  @media (orientation: landscape) {
    :root {
      --ndn-header-h: 48px;
      --ndn-bottomnav-h: 56px;
    }
    .ndn-bottom-nav-label {
      font-size: 10px;
    }

    /* In landscape, keep the camera viewport from being too short */
    .ndn-camera-viewport,
    .camera-viewport {
      min-height: 50vh !important;
      max-height: 70vh !important;
    }
  }

  /* Reduce visual noise in lists */
  .list-item { padding: 14px 12px !important; border-radius: 8px !important; background: #1e293b !important; margin-bottom: 8px !important; border: 1px solid rgba(255,255,255,0.05); }

  /* Ensure overlays and popovers are full width and readable */
  .popover, .dropdown { left: 8px !important; right: 8px !important; width: auto !important; }

  /* Accessibility: increase tap target for small icons */
  .icon-btn { padding: 12px !important; border-radius: 8px !important; }

  /* --- General page helpers (other sections) --- */
  /* Many pages use inline grids/flex. These helpers prevent side overflow on phones. */
  .ndn-page {
    padding-bottom: calc(var(--ndn-bottomnav-h) + var(--ndn-safe-bottom) + 16px) !important;
  }

  /* Tables and wide scoreboards: allow horizontal scroll instead of clipping */
  .ndn-table-scroll,
  .ndn-scoreboard-scroll,
  .ndn-hscroll {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  .ndn-table-scroll > *,
  .ndn-scoreboard-scroll > *,
  .ndn-hscroll > * {
    min-width: max-content;
  }

  /* Lists of cards (lobbies / tournaments / friends): one column, comfortable gaps */
  .ndn-card-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Filter bars: wrap instead of crushing */
  .ndn-filterbar {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 10px !important;
    align-items: stretch !important;
  }
  .ndn-filterbar > * {
    flex: 1 1 160px !important;
    min-width: 140px !important;
  }

  /* Modal/fullscreen panels: make sure content fits and scrolls */
  .ndn-modal,
  .ndn-drawer {
    max-height: calc(100vh - var(--ndn-header-h) - var(--ndn-safe-top) - 18px) !important;
    overflow: auto !important;
  }

  /* Sidebar drawer on mobile (when explicitly shown): make it usable as a sheet */
  .sidebar.mobile-sidebar-visible {
    position: fixed !important;
    top: calc(var(--ndn-header-h) + var(--ndn-safe-top)) !important;
    left: 0 !important;
    right: 0 !important;
    bottom: calc(var(--ndn-bottomnav-h) + var(--ndn-safe-bottom)) !important;
    z-index: 60 !important;
    overflow: auto !important;
    background: rgba(15, 23, 42, 0.98) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.08) !important;
    padding: 10px !important;
  }

  /* Online/Offline/Settings: shrink dense headings and tighten spacing */
  .ndn-section-title {
    font-size: 1.05rem !important;
    line-height: 1.2 !important;
    margin-bottom: 8px !important;
  }
  .ndn-muted {
    color: rgba(226, 232, 240, 0.72) !important;
  }

  /* Landscape: reduce big paddings so more content fits */
  @media (orientation: landscape) {
    .card, .glass {
      padding: 12px !important;
    }
    .btn {
      padding: 12px 14px !important;
    }
  }

  /* Minor typography tuning */
  .logo, .brand { letter-spacing: -0.02em; }

}
